<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LuckyBoyğŸ¥</title>
  
  
  <link href="https://wuwawawa.github.io/atom.xml" rel="self"/>
  
  <link href="https://wuwawawa.github.io/"/>
  <updated>2023-05-10T12:14:01.754Z</updated>
  <id>https://wuwawawa.github.io/</id>
  
  <author>
    <name>LuckyBoyğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Java8æ–°ç‰¹æ€§</title>
    <link href="https://wuwawawa.github.io/posts/397c083a.html"/>
    <id>https://wuwawawa.github.io/posts/397c083a.html</id>
    <published>2023-05-10T08:05:42.000Z</published>
    <updated>2023-05-10T12:14:01.754Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Java8æ–°ç‰¹æ€§çš„å¥½å¤„">Java8æ–°ç‰¹æ€§çš„å¥½å¤„</h2><ol><li>é€Ÿåº¦æ›´å¿«</li><li>ä»£ç æ›´å°‘ï¼ˆLambdaç®€åŒ–ä»£ç ä¹¦å†™ï¼‰</li><li>å¼ºå¤§çš„Stream API</li><li>ä¾¿äºå¹¶è¡Œ</li><li>æœ€å¤§åŒ–å‡å°‘ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼šOptional</li><li>Nashornå¼•æ“ï¼Œå…è®¸åœ¨JVMä¸Šè¿è¡ŒJSåº”ç”¨</li></ol><hr><hr><h2 id="å¹¶è¡Œæµä¸ä¸²è¡Œæµ">å¹¶è¡Œæµä¸ä¸²è¡Œæµ</h2><ul><li>å¹¶è¡Œæµå°±æ˜¯æŠŠä¸€ä¸ªå†…å®¹åˆ†ä¸ºå¤šä¸ªæ•°æ®å—ï¼Œå¹¶ç”¨ä¸åŒçš„çº¿ç¨‹åˆ†åˆ«å¤„ç†æ¯ä¸ªæ•°æ®å—çš„æµï¼Œç›¸æ¯”è¾ƒäºä¸²è¡Œæµï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡</li><li>Java8ä¸­å°†å…¶è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å¯¹æ•°æ®è¿›è¡Œå¹¶è¡Œæ“ä½œã€‚</li><li>Stream API å¯ä»¥å£°æ˜æ€§åœ°é€šè¿‡parallel()å’Œsequential()åœ¨å¹¶è¡Œæµä¸é¡ºåºæµä¹‹é—´è¿›è¡Œåˆ‡æ¢</li></ul><hr><hr><h2 id="Lambdaè¡¨è¾¾å¼">Lambdaè¡¨è¾¾å¼</h2><ul><li>Lambdaæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠLambdaè¡¨è¾¾å¼ç†è§£ä¸ºæ˜¯ä¸€æ®µå¯ä»¥ä¼ é€’çš„ä»£ç ï¼ˆå°†ä»£ç åƒæ•°æ®ä¸€æ ·è¿›è¡Œä¼ é€’ï¼‰ã€‚</li><li>ä½¿ç”¨å®ƒå¯ä»¥å†™å‡ºæ›´ç®€æ´ã€æ›´çµæ´»çš„ä»£ç ã€‚ä½œä¸ºä¸€ç§æ›´ç´§å‡‘çš„ä»£ç é£æ ¼ï¼Œæ˜¯Javaçš„è¯­è¨€è¡¨è¾¾èƒ½åŠ›å¾—åˆ°äº†æå‡</li></ul><blockquote><span class='p red'>lambdaè¡¨è¾¾å¼ä½¿ç”¨å‰æ</span></blockquote><p>å¿…é¡»æœ‰æ¥å£,æ¥å£ä¸­æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•(å‡½æ•°å¼æ¥å£)</p><p>Lambdaè¡¨è¾¾å¼æ˜¯å¯æ¨å¯¼å¯ä»¥çœç•¥çš„ï¼ŒLambdaè¡¨è¾¾å¼å¯ä»¥æ¨å¯¼å‡ºæ¥ï¼Œçœç•¥å°±æ˜¯é‡å†™å”¯ä¸€çš„æŠ½è±¡æ–¹æ³•è¿›è€Œå¯ä»¥è¿›ä¸€æ­¥å¯¹å‚æ•°å’Œè¿”å›å€¼è¿›è¡Œç®€åŒ–</p><ol><li>ä¸¾ä¾‹ï¼š (o1,o2) -&gt; Integer.compare(o1,o2);</li><li>æ ¼å¼ï¼š<ul><li><code>-&gt;ï¼š</code>lambdaæ“ä½œç¬¦æˆ–ç®­å¤´æ“ä½œç¬¦</li><li><code>-&gt;å·¦è¾¹ï¼š</code>lambdaå½¢å‚åˆ—è¡¨ï¼ˆå…¶å®å°±æ˜¯æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•çš„å½¢å‚åˆ—è¡¨ï¼‰</li><li><code>-&gt;å³è¾¹ï¼š</code>lambdaä½“ï¼ˆå…¶å®å°±æ˜¯é‡å†™çš„æŠ½è±¡æ–¹æ³•çš„æ–¹æ³•ä½“ï¼‰</li></ul></li><li>Lambdaè¡¨è¾¾å¼çš„ä½¿ç”¨ï¼šï¼ˆåˆ†ä¸º6ç§æƒ…å†µä»‹ç»ï¼‰</li></ol><div class="tabs" id="a8a76b8b-df65-4a0a-a2c4-660e9341c1fe"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-1"><i class="fas fa-bug"></i>æ ¼å¼ä¸€</button></li><li class="tab"><button type="button" data-href="#a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-2"><i class="fas fa-cannabis"></i>æ ¼å¼äºŒ</button></li><li class="tab"><button type="button" data-href="#a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-3"><i class="fas fa-candy-cane"></i>æ ¼å¼ä¸‰</button></li><li class="tab"><button type="button" data-href="#a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-4"><i class="fas fa-child"></i>æ ¼å¼å››</button></li><li class="tab"><button type="button" data-href="#a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-5"><i class="fas fa-heartbeat"></i>æ ¼å¼äº”</button></li><li class="tab"><button type="button" data-href="#a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-6"><i class="fas fa-cookie-bite"></i>æ ¼å¼å…­</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-1"><p><code>è¯­æ³•æ ¼å¼ä¸€ï¼š</code>æ— å‚æ— è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1. ä»¥å‰çš„å†™æ³•</span></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">runnable01</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä½  çš„ åŸ å¸‚ å¥½ åƒ ä¸ æ¬¢ è¿ æˆ‘&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    runnable01.run();</span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line">    <span class="comment">//2. Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">runnable02</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;æ‰€ ä»¥ æˆ‘ åª å¥½ è½¬ èº« ç¦» å¼€ äº†&quot;</span>);</span><br><span class="line">    runnable02.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-2"><p><code>è¯­æ³•æ ¼å¼äºŒï¼š</code>Lambdaéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯æ²¡æœ‰è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1. ä»¥å‰çš„å†™æ³•</span></span><br><span class="line">    Consumer&lt;String&gt; consumer01 = <span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(String s)</span> &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    consumer01.accept(<span class="string">&quot;å…¶å®æˆ‘å­˜è¿‡ä½ ç…§ç‰‡ ä¹Ÿç ”ç©¶è¿‡ä½ çš„æ˜Ÿåº§&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line">    <span class="comment">//2. Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">    Consumer&lt;String&gt; consumer02 = (String s) -&gt; &#123;System.out.println(s);&#125;;</span><br><span class="line">    consumer02.accept(<span class="string">&quot;ä½ å–œæ¬¢çš„æ­Œæˆ‘ä¹Ÿä¼šå»å¬ ä½ å–œæ¬¢çš„äº‹ç‰©æˆ‘ä¹Ÿä¼šæƒ³å»äº†è§£&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-3"><p><code>è¯­æ³•æ ¼å¼ä¸‰ï¼š</code>æ•°æ®ç±»å‹å¯ä»¥çœç•¥ï¼Œå› ä¸ºå¯ç”±<code>ç±»å‹æ¨æ–­</code>å¾—å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1. ä»¥å‰çš„å†™æ³•</span></span><br><span class="line">    Consumer&lt;String&gt; consumer01 = <span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(String s)</span> &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    consumer01.accept(<span class="string">&quot;æˆ‘è¿œæ¯”è¡¨é¢ä¸Šæ›´å–œæ¬¢ä½ &quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line">    <span class="comment">//2. Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">    Consumer&lt;String&gt; consumer02 = (s) -&gt; &#123;System.out.println(s);&#125;;</span><br><span class="line">    consumer02.accept(<span class="string">&quot;ä½†æˆ‘æ²¡æœ‰è¯´&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-4"><p><code>è¯­æ³•æ ¼å¼å››ï¼š</code>Lambdaè‹¥åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°çš„å°æ‹¬å·å¯ä»¥çœç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1. ä»¥å‰çš„å†™æ³•</span></span><br><span class="line">    Consumer&lt;String&gt; consumer01 = <span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(String s)</span> &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    consumer01.accept(<span class="string">&quot;æˆ‘è¿œæ¯”è¡¨é¢ä¸Šæ›´å–œæ¬¢ä½ &quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line">    <span class="comment">//2. Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">    Consumer&lt;String&gt; consumer02 = s -&gt; &#123;System.out.println(s);&#125;;</span><br><span class="line">    consumer02.accept(<span class="string">&quot;ä½†æˆ‘æ²¡æœ‰è¯´&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-5"><p><code>è¯­æ³•æ ¼å¼äº”ï¼š</code>Lambdaéœ€è¦ä¸¤ä¸ªæˆ–ä»¥ä¸Šå‚æ•°ï¼Œå¤šæ¡æ‰§è¡Œè¯­å¥ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1. ä»¥å‰çš„å†™æ³•</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator01 = <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> &#123;</span><br><span class="line">            System.out.println(o1);</span><br><span class="line">            System.out.println(o2);</span><br><span class="line">            <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(comparator01.compare(<span class="number">95</span>, <span class="number">27</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator02 = (o1, o2) -&gt; &#123;</span><br><span class="line">        System.out.println(o1);</span><br><span class="line">        System.out.println(o2);</span><br><span class="line">        <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(comparator02.compare(<span class="number">12</span>, <span class="number">21</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a8a76b8b-df65-4a0a-a2c4-660e9341c1fe-6"><p><code>è¯­æ³•æ ¼å¼å…­ï¼š</code>å½“Lambdaä½“åªæœ‰ä¸€æ¡è¯­å¥æ—¶ï¼Œreturnä¸{}è‹¥æœ‰ï¼Œåˆ™éƒ½å¯ä»¥çœç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1. ä»¥å‰çš„å†™æ³•</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator01 = <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(comparator01.compare(<span class="number">95</span>, <span class="number">27</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator02 = (o1, o2) -&gt; o1.compareTo(o2);</span><br><span class="line">    System.out.println(comparator02.compare(<span class="number">12</span>, <span class="number">21</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><hr><h2 id="å‡½æ•°å¼æ¥å£">å‡½æ•°å¼æ¥å£</h2><ul><li>Lambdaè¡¨è¾¾å¼çš„æœ¬è´¨ï¼šä½œä¸ºå‡½æ•°å¼æ¥å£çš„å®ä¾‹</li><li>å¦‚æœåœ¨ä¸€ä¸ªæ¥å£ä¸­ï¼Œåªå£°æ˜äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œåˆ™æ­¤æ¥å£å°±è¢«ç§°ä¸ºå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªæ¥å£ä¸Šä½¿ç”¨@FunctionalInterfaceæ³¨è§£æ¥éªŒè¯è¯¥æ¥å£æ˜¯å¦ä¸ºå‡½æ•°å¼æ¥å£ï¼ˆå¦‚æœä½ åœ¨è¯¥æ¥å£ä¸­å†™äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ™ç¼–è¯‘æœŸå°±ä¼šæŠ¥é”™ï¼‰</li><li>æ­£æ˜¯å› ä¸ºæŠ½è±¡æ–¹æ³•ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰å¯ä»¥çœç•¥@Overrideå‡½æ•°å£°æ˜ç­‰å†…å®¹</li><li>åœ¨<code>java.util.function</code>åŒ…ä¸‹å®šä¹‰äº†Java 8 çš„ä¸°å¯Œçš„å‡½æ•°å¼æ¥å£</li><li>Javaä»è¯ç”Ÿæ—¥èµ·å°±æ˜¯ä¸€ç›´å€¡å¯¼â€œä¸€åˆ‡çš†å¯¹è±¡â€ï¼Œåœ¨Javaé‡Œé¢é¢å‘å¯¹è±¡(OOP)ç¼–ç¨‹æ˜¯ä¸€åˆ‡ã€‚ä½†æ˜¯éšç€Pythonã€Scalaç­‰è¯­è¨€çš„å…´èµ·å’Œæ–°æŠ€æœ¯çš„æŒ‘æˆ˜ï¼ŒJavaä¸å¾—ä¸åšå‡ºè°ƒæ•´ä»¥ä¾¿æ”¯æŒæ›´åŠ å¹¿æ³›çš„æŠ€æœ¯è¦æ±‚ï¼Œä¹Ÿå³javaä¸ä½†å¯ä»¥æ”¯æŒOOPè¿˜å¯ä»¥æ”¯æŒOOFï¼ˆé¢å‘å‡½æ•°ç¼–ç¨‹ï¼‰</li><li>åœ¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€å½“ä¸­ï¼Œå‡½æ•°è¢«å½“åšä¸€ç­‰å…¬æ°‘å¯¹å¾…ã€‚åœ¨å°†å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒLambdaè¡¨è¾¾å¼çš„ç±»å‹æ˜¯å‡½æ•°ã€‚ä½†æ˜¯åœ¨Java8ä¸­ï¼Œæœ‰æ‰€ä¸åŒã€‚åœ¨Java8ä¸­ï¼ŒLambdaè¡¨è¾¾å¼æ˜¯å¯¹è±¡ï¼Œè€Œä¸æ˜¯å‡½æ•°ï¼Œå®ƒä»¬å¿…é¡»ä¾é™„äºä¸€ç±»ç‰¹åˆ«çš„å¯¹è±¡ç±»å‹â€”â€”å‡½æ•°å¼æ¥å£ã€‚</li><li>ç®€å•çš„è¯´ï¼Œåœ¨Java8ä¸­ï¼ŒLambdaè¡¨è¾¾å¼å°±æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£çš„å®ä¾‹ã€‚è¿™å°±æ˜¯Lambdaè¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£çš„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä¸€ä¸ªå¯¹è±¡æ˜¯å‡½æ•°å¼æ¥å£çš„å®ä¾‹ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±å¯ä»¥ç”¨Lambdaè¡¨è¾¾å¼æ¥è¡¨ç¤ºã€‚</li><li>æ‰€ä»¥ä»¥å‰ç”¨åŒ¿åå®ç°ç±»è¡¨ç¤ºçš„ç°åœ¨éƒ½å¯ä»¥ç”¨Lambdaè¡¨è¾¾å¼æ¥å†™ã€‚</li></ul><blockquote><p>Javaå†…ç½®çš„å‡½æ•°å¼æ¥å£ä»‹ç»åŠä½¿ç”¨ä¸¾ä¾‹</p></blockquote><table><thead><tr><th style="text-align:center">å‡½æ•°å¼æ¥å£</th><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">ç”¨é€”</th></tr></thead><tbody><tr><td style="text-align:center">Consumer æ¶ˆè´¹å‹æ¥å£</td><td style="text-align:center">void accept(T t)</td><td style="text-align:center">å¯¹ç±»å‹ä¸ºTçš„å¯¹è±¡åº”ç”¨æ“ä½œ</td></tr><tr><td style="text-align:center">Supplier ä¾›ç»™å‹æ¥å£</td><td style="text-align:center">T get()</td><td style="text-align:center">è¿”å›ç±»å‹ä¸ºTçš„å¯¹è±¡</td></tr><tr><td style="text-align:center">Function å‡½æ•°å‹æ¥å£</td><td style="text-align:center">R apply(T t)</td><td style="text-align:center">å¯¹ç±»å‹ä¸ºTçš„å¯¹è±¡åº”ç”¨æ“ä½œè¿”å›ç»“æœ</td></tr><tr><td style="text-align:center">Predicate æ–­å®šå‹æ¥å£</td><td style="text-align:center">boolean test(T t)</td><td style="text-align:center">ç¡®å®šç±»å‹ä¸ºTçš„å¯¹è±¡æ˜¯å¦æ»¡è¶³æŸçº¦æŸ</td></tr><tr><td style="text-align:center">BiConsumer</td><td style="text-align:center">void accept(T t,U u)</td><td style="text-align:center">å¯¹ç±»å‹ä¸ºT,Uå‚æ•°åº”ç”¨æ“ä½œ</td></tr><tr><td style="text-align:center">BiPredicate</td><td style="text-align:center">boolean</td><td style="text-align:center">åŒ…å«æ–¹æ³•ä¸ºï¼šboolean test(T t,U u)</td></tr><tr><td style="text-align:center">BiFunction</td><td style="text-align:center">R apply(T t,U u)</td><td style="text-align:center">å¯¹ç±»å‹ä¸ºT,Uå‚æ•°åº”ç”¨æ“ä½œï¼Œè¿”å›Rç±»å‹çš„ç»“æœ</td></tr><tr><td style="text-align:center">UnaryOperator(Functionå­æ¥å£)</td><td style="text-align:center">T apply(T t)</td><td style="text-align:center">å¯¹ç±»å‹ä¸ºTçš„å¯¹è±¡è¿›è¡Œä¸€å…ƒè¿ç®—</td></tr><tr><td style="text-align:center">BinaryOperator(BiFunctionå­æ¥å£)</td><td style="text-align:center">T apply(T t1,T t2)</td><td style="text-align:center">å¯¹ç±»å‹ä¸ºTçš„å¯¹è±¡è¿›è¡ŒäºŒå…ƒè¿ç®—</td></tr></tbody></table><div class="tabs" id="10d20ccf-24f3-4841-8532-22635d831135"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#10d20ccf-24f3-4841-8532-22635d831135-1"><i class="fas fa-cat"></i>æ¶ˆè´¹å‹</button></li><li class="tab"><button type="button" data-href="#10d20ccf-24f3-4841-8532-22635d831135-2"><i class="fas fa-horse"></i>æ–­å®šå‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="10d20ccf-24f3-4841-8532-22635d831135-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">happyTime</span><span class="params">(<span class="type">double</span> money, Consumer&lt;Double&gt; consumer)</span> &#123;</span><br><span class="line">    consumer.accept(money);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1. ä»¥å‰çš„å†™æ³•</span></span><br><span class="line">    happyTime(<span class="number">1241</span>, <span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;Double&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Double money)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çªç„¶æƒ³å›ä¸€è¶Ÿæˆéƒ½äº†ï¼Œæœºç¥¨èŠ±è´¹&quot;</span> + money);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. Lambdaè¡¨è¾¾å¼ï¼Œå°†ä¹‹å‰çš„6è¡Œä»£ç å‹ç¼©åˆ°äº†1è¡Œ</span></span><br><span class="line">    happyTime(<span class="number">648</span>, money -&gt; System.out.println(<span class="string">&quot;å­¦ä¹ å¤ªç´¯äº†ï¼Œå¥–åŠ±è‡ªå·±ä¸€å‘648ï¼ŒèŠ±è´¹&quot;</span> + money));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">çªç„¶æƒ³å›ä¸€è¶Ÿæˆéƒ½äº†ï¼Œæœºç¥¨èŠ±è´¹1241.0</span></span><br><span class="line"><span class="comment">------------------------</span></span><br><span class="line"><span class="comment">å­¦ä¹ å¤ªç´¯äº†ï¼Œå¥–åŠ±è‡ªå·±ä¸€å‘648ï¼ŒèŠ±è´¹648.0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="10d20ccf-24f3-4841-8532-22635d831135-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¹æ®ç»™å®šçš„è§„åˆ™ï¼Œè¿‡æ»¤é›†åˆä¸­çš„å­—ç¬¦ä¸²ã€‚æ­¤è§„åˆ™ç”±Predicateçš„æ–¹æ³•å†³å®š</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">filterString</span><span class="params">(List&lt;String&gt; strings, Predicate&lt;String&gt; predicate)</span> &#123;</span><br><span class="line">    ArrayList&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String string : strings) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate.test(string))</span><br><span class="line">            res.add(string);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;ä¸œäº¬&quot;</span>, <span class="string">&quot;è¥¿äº¬&quot;</span>, <span class="string">&quot;å—äº¬&quot;</span>, <span class="string">&quot;åŒ—äº¬&quot;</span>, <span class="string">&quot;å¤©æ´¥&quot;</span>, <span class="string">&quot;ä¸­äº¬&quot;</span>);</span><br><span class="line">    <span class="comment">//1. ä»¥å‰çš„å†™æ³•</span></span><br><span class="line">    List&lt;String&gt; list = filterString(string s, <span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(String s)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> s.contains(<span class="string">&quot;äº¬&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. ç°åœ¨çš„å†™æ³•ï¼Œç›¸æ¯”è¾ƒä¹‹å‰çš„ä»£ç ä¼˜é›…äº†è®¸å¤š</span></span><br><span class="line">    List&lt;String&gt; res = filterString(string s, s -&gt; s.contains(<span class="string">&quot;äº¬&quot;</span>));</span><br><span class="line">    System.out.println(res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[ä¸œäº¬, è¥¿äº¬, å—äº¬, åŒ—äº¬, ä¸­äº¬]</span></span><br><span class="line"><span class="comment">------------------------</span></span><br><span class="line"><span class="comment">[ä¸œäº¬, è¥¿äº¬, å—äº¬, åŒ—äº¬, ä¸­äº¬]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><hr><h2 id="æ–¹æ³•å¼•ç”¨å’Œæ„é€ å™¨å¼•ç”¨">æ–¹æ³•å¼•ç”¨å’Œæ„é€ å™¨å¼•ç”¨</h2><ul><li>å½“è¦ä¼ é€’ç»™Lambdaä½“çš„æ“ä½œï¼Œå·²ç»æœ‰å®ç°çš„æ–¹æ³•äº†ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨</li><li>æ–¹æ³•å¼•ç”¨å¯ä»¥çœ‹åšä¼šLambdaè¡¨è¾¾å¼çš„æ·±å±‚æ¬¡è¡¨è¾¾ï¼Œæ¢å¥è¯è¯´ï¼Œæ–¹æ³•å¼•ç”¨å°±æ˜¯Lambdaè¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°å¼æ¥å£çš„ä¸€ä¸ªå®ä¾‹ï¼Œé€šè¿‡æ–¹æ³•çš„åå­—æ¥æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯Lambdaè¡¨è¾¾å¼çš„ä¸€ä¸ªè¯­æ³•ç³–</li><li>è¦æ±‚ï¼šå®ç°æ¥å£çš„æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»ä¸æ–¹æ³•å¼•ç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ä¿æŒä¸€è‡´</li><li>æ ¼å¼ï¼šä½¿ç”¨æ“ä½œç¬¦<code>::</code>å°†ç±»æˆ–å¯¹è±¡ä¸æ–¹æ³•ååˆ†å‰²å¼€æ¥</li><li>æœ‰å¦‚ä¸‹ä¸‰ç§ä½¿ç”¨æƒ…å†µ<ol><li>å¯¹è±¡::å®ä¾‹æ–¹æ³•å</li><li>ç±»::é™æ€æ–¹æ³•å</li><li>ç±»::å®ä¾‹æ–¹æ³•å</li></ol></li></ul><hr><h3 id="æ–¹æ³•å¼•ç”¨">æ–¹æ³•å¼•ç”¨</h3><p>æ–¹æ³•å¼•ç”¨çš„ä½¿ç”¨</p><ol><li>ä½¿ç”¨æƒ…å¢ƒï¼šå½“è¦ä¼ é€’ç»™Lambdaä½“çš„æ“ä½œï¼Œå·²ç»æœ‰å®ç°çš„æ–¹æ³•äº†ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨ï¼</li><li>æ–¹æ³•å¼•ç”¨ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯Lambdaè¡¨è¾¾å¼ï¼Œè€ŒLambdaè¡¨è¾¾å¼ä½œä¸ºå‡½æ•°å¼æ¥å£çš„å®ä¾‹ã€‚æ‰€ä»¥æ–¹æ³•å¼•ç”¨ï¼Œä¹Ÿæ˜¯å‡½æ•°å¼æ¥å£çš„å®ä¾‹ã€‚</li><li>ä½¿ç”¨æ ¼å¼ï¼š ç±»(æˆ–å¯¹è±¡) :: æ–¹æ³•å</li><li>å…·ä½“åˆ†ä¸ºå¦‚ä¸‹çš„ä¸‰ç§æƒ…å†µï¼š<ul><li>æƒ…å†µ1ï¼šå¯¹è±¡ :: éé™æ€æ–¹æ³•</li><li>æƒ…å†µ2ï¼šç±» :: é™æ€æ–¹æ³•</li><li>æƒ…å†µ3ï¼šç±» :: éé™æ€æ–¹æ³•</li></ul></li><li>æ–¹æ³•å¼•ç”¨ä½¿ç”¨çš„è¦æ±‚ï¼šè¦æ±‚æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•çš„å½¢å‚åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ä¸æ–¹æ³•å¼•ç”¨çš„æ–¹æ³•çš„å½¢å‚åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ç›¸åŒï¼ï¼ˆé’ˆå¯¹äºæƒ…å†µ1å’Œæƒ…å†µ2ï¼‰</li></ol><div class="tabs" id="5a1398c5-f32b-470b-81f3-16840cd41579"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#5a1398c5-f32b-470b-81f3-16840cd41579-1"><i class="far fa-sun"></i>å¯¹è±¡::éé™æ€æ–¹æ³•</button></li><li class="tab"><button type="button" data-href="#5a1398c5-f32b-470b-81f3-16840cd41579-2"><i class="fas fa-wind"></i>ç±»::é™æ€æ–¹æ³•</button></li><li class="tab"><button type="button" data-href="#5a1398c5-f32b-470b-81f3-16840cd41579-3"><i class="fas fa-fire-alt"></i>ç±»::å®ä¾‹æ–¹æ³•</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="5a1398c5-f32b-470b-81f3-16840cd41579-1"><p>æŠ½è±¡æ–¹æ³•çš„<code>å½¢å‚åˆ—è¡¨</code>å’Œ<code>è¿”å›å€¼ç±»å‹</code>ä¸<code>æ–¹æ³•å¼•ç”¨</code>çš„æ–¹æ³•çš„<code>å½¢å‚åˆ—è¡¨</code>å’Œè¿”å›å€¼ç±»å‹ç›¸åŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Consumerä¸­çš„void accept(T t)</span></span><br><span class="line"><span class="comment">//PrintStreamä¸­çš„void println(T t)</span></span><br><span class="line"><span class="comment">//å½¢å‚åˆ—è¡¨å‡ä¸º(T t)ï¼Œè¿”å›å€¼å‡ä¸ºvoidï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1. Lambda</span></span><br><span class="line">    Consumer&lt;String&gt; consumer01 = s -&gt; System.out.println(s);</span><br><span class="line">    consumer01.accept(<span class="string">&quot;å¥¹çš„æ‰‹åªæœ‰æˆ‘çš„æ‰‹å››åˆ†ä¹‹ä¸‰é‚£éº¼å¤§&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-----------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">    <span class="type">PrintStream</span> <span class="variable">printStream</span> <span class="operator">=</span> System.out;</span><br><span class="line">    Consumer&lt;String&gt; consumer02 = printStream::println;</span><br><span class="line">    consumer02.accept(<span class="string">&quot;å¯æˆ‘é‚„æ˜¯æ²’èƒ½æŠ“ä½&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-----------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. ä½†è²Œä¼¼ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™</span></span><br><span class="line">    Consumer&lt;String&gt; consumer03 = System.out::println;</span><br><span class="line">    consumer03.accept(<span class="string">&quot;èŠ±è½ä¸‹çš„æ—¶å€™æ²¡æ­» é£æ¡èµ·èŠ± åˆä¸¢ä¸‹ èŠ±æ‰æ­»äº†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å¥¹çš„æ‰‹åªæœ‰æˆ‘çš„æ‰‹å››åˆ†ä¹‹ä¸‰é‚£éº¼å¤§</span></span><br><span class="line"><span class="comment">-----------------------------</span></span><br><span class="line"><span class="comment">å¯æˆ‘é‚„æ˜¯æ²’èƒ½æŠ“ä½</span></span><br><span class="line"><span class="comment">-----------------------------</span></span><br><span class="line"><span class="comment">èŠ±è½ä¸‹çš„æ—¶å€™æ²¡æ­» é£æ¡èµ·èŠ± åˆä¸¢ä¸‹ èŠ±æ‰æ­»äº†</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5a1398c5-f32b-470b-81f3-16840cd41579-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Comparatorä¸­çš„int compare(T t1,T t2)</span></span><br><span class="line"><span class="comment">//Integerä¸­çš„int compare(T t1,T t2)</span></span><br><span class="line"><span class="comment">//å½¢å‚åˆ—è¡¨å‡ä¸º(T t1,T t2)ï¼Œè¿”å›å€¼å‡ä¸ºintï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1. Lambda</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator01 = (o1, o2) -&gt; Integer.compare(o1, o2);</span><br><span class="line">    System.out.println(comparator01.compare(<span class="number">20</span>, <span class="number">77</span>));</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator02 = Integer::compare;</span><br><span class="line">    System.out.println(comparator02.compare(<span class="number">94</span>, <span class="number">21</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">-1</span></span><br><span class="line"><span class="comment">----------------------------</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Functionä¸­çš„R apply(T t)</span></span><br><span class="line"><span class="comment">//Mathä¸­çš„Long round(Double d)</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼å’Œå‚æ•°åˆ—è¡¨ä¸ºæ³›å‹ï¼Œä¹Ÿå¯ä»¥åŒ¹é…ä¸Šï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1. Lambda</span></span><br><span class="line">    Function&lt;Double,Long&gt; function01 = aDouble -&gt; Math.round(aDouble);</span><br><span class="line">    System.out.println(function01.apply(<span class="number">3.141</span>));</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">    Function&lt;Double,Long&gt; function02 = Math::round;</span><br><span class="line">    System.out.println(function02.apply(<span class="number">2.717</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">------------------------------</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5a1398c5-f32b-470b-81f3-16840cd41579-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Comparatorä¸­çš„int comapre(T t1,T t2)</span></span><br><span class="line"><span class="comment">// Stringä¸­çš„int t1.compareTo(t2)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test09</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1. Lambda</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator01 = (o1, o2) -&gt; o1.compareTo(o2);</span><br><span class="line">    System.out.println(comparator01.compare(<span class="number">94</span>, <span class="number">21</span>));</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;---------------------------&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2. æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator02 = Integer::compareTo;</span><br><span class="line">    System.out.println(comparator02.compare(<span class="number">43</span>, <span class="number">96</span>));</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">---------------------------</span></span><br><span class="line"><span class="comment">-1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//BiPredicateä¸­çš„boolean test(T t1, T t2);</span></span><br><span class="line"><span class="comment">//Stringä¸­çš„boolean t1.equals(t2)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test10</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1. Lambda</span></span><br><span class="line">    BiPredicate&lt;String,String&gt; biPredicate01 = (o1, o2) -&gt; o1.equals(o2);</span><br><span class="line">    System.out.println(biPredicate01.test(<span class="string">&quot;Kyle&quot;</span>, <span class="string">&quot;Kyle&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;----------------------------------&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2. æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">    BiPredicate&lt;String,String&gt; biPredicate02 = String::equals;</span><br><span class="line">    System.out.println(biPredicate02.test(<span class="string">&quot;Violet&quot;</span>, <span class="string">&quot;Violet&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">true</span></span><br><span class="line"><span class="comment">----------------------------------</span></span><br><span class="line"><span class="comment">true</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Functionä¸­çš„R apply(T t)</span></span><br><span class="line"><span class="comment">// Employeeä¸­çš„String toString();</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test11</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Stu</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Stu</span>(<span class="string">&quot;Kyle&quot;</span>, <span class="number">9527</span>);</span><br><span class="line">    <span class="comment">//1. Lambda</span></span><br><span class="line">    Function&lt;Stu,String&gt; function01 = stu -&gt; stu.toString();</span><br><span class="line">    System.out.println(function01.apply(student));</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">    Function&lt;Stu,String&gt; function02 = Stu::toString;</span><br><span class="line">    System.out.println(function02.apply(student));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Stu&#123;name=&#x27;Kyle&#x27;, id=9527&#125;</span></span><br><span class="line"><span class="comment">------------------------------</span></span><br><span class="line"><span class="comment">Stu&#123;name=&#x27;Kyle&#x27;, id=9527&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="æ„é€ å™¨å¼•ç”¨å’Œæ•°ç»„å¼•ç”¨">æ„é€ å™¨å¼•ç”¨å’Œæ•°ç»„å¼•ç”¨</h3><ul><li>ä¸å‡½æ•°å¼æ¥å£ç›¸ç»“åˆï¼Œè‡ªåŠ¨ä¸å‡½æ•°å¼æ¥å£ä¸­æ–¹æ³•å…¼å®¹ã€‚</li><li>å¯ä»¥æŠŠæ„é€ å™¨å¼•ç”¨èµ‹å€¼ç»™å®šä¹‰çš„æ–¹æ³•ï¼Œè¦æ±‚æ„é€ å™¨å‚æ•°åˆ—è¡¨è¦ä¸æ¥å£ä¸­æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸€è‡´ï¼ä¸”æ–¹æ³•çš„è¿”å›å€¼å³ä¸ºæ„é€ å™¨å¯¹åº”ç±»çš„å¯¹è±¡ã€‚</li></ul><div class="tabs" id="a1dd04d3-232a-4861-a5b8-a514f0e242d6"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#a1dd04d3-232a-4861-a5b8-a514f0e242d6-1"><i class="fas fa-atom"></i>æ„é€ å™¨å¼•ç”¨</button></li><li class="tab"><button type="button" data-href="#a1dd04d3-232a-4861-a5b8-a514f0e242d6-2"><i class="far fa-sun"></i>æ•°ç»„å¼•ç”¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="a1dd04d3-232a-4861-a5b8-a514f0e242d6-1"><p>å’Œæ–¹æ³•å¼•ç”¨ç±»ä¼¼ï¼Œå‡½æ•°å¼æ¥å£çš„æŠ½è±¡æ–¹æ³•çš„å½¢å‚åˆ—è¡¨å’Œæ„é€ å™¨çš„å½¢å‚åˆ—è¡¨ä¸€è‡´ã€‚</p><p>æŠ½è±¡æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å³ä¸ºæ„é€ å™¨æ‰€å±çš„ç±»çš„ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test12</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1. Lambda</span></span><br><span class="line">    BiFunction&lt;String, Integer, Stu&gt; function01 = (string, integer) -&gt; <span class="keyword">new</span> <span class="title class_">Stu</span>(string, integer);</span><br><span class="line">    System.out.println(function01.apply(<span class="string">&quot;Kyle&quot;</span>, <span class="number">9527</span>));</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------------&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2. æ„é€ å™¨å¼•ç”¨</span></span><br><span class="line">    BiFunction&lt;String, Integer, Stu&gt; function02 = Stu::<span class="keyword">new</span>;</span><br><span class="line">    System.out.println(function02.apply(<span class="string">&quot;Lucy&quot;</span>, <span class="number">9421</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Stu&#123;name=&#x27;Kyle&#x27;, id=9527&#125;</span></span><br><span class="line"><span class="comment">-------------------------------</span></span><br><span class="line"><span class="comment">Stu&#123;name=&#x27;Lucy&#x27;, id=9421&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a1dd04d3-232a-4861-a5b8-a514f0e242d6-2"><p>å¯ä»¥æŠŠæ•°ç»„çœ‹åšæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œåˆ™å†™æ³•ä¸æ„é€ å™¨å¼•ç”¨ä¸€è‡´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test13</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1. Lambda åˆ›å»ºä¸€ä¸ªæŒ‡å®šé•¿åº¦çš„stringæ•°ç»„</span></span><br><span class="line">    Function&lt;Integer, String[]&gt; function01 = (integer -&gt; <span class="keyword">new</span> <span class="title class_">String</span>[integer]);</span><br><span class="line">    System.out.println(Arrays.toString(function01.apply(<span class="number">5</span>)));</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-----------------------------&quot;</span>);</span><br><span class="line">    <span class="comment">//2. æ•°ç»„å¼•ç”¨</span></span><br><span class="line">    Function&lt;Integer, String[]&gt; function02 = String[]::<span class="keyword">new</span>;</span><br><span class="line">    System.out.println(Arrays.toString(function02.apply(<span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[null, null, null, null, null]</span></span><br><span class="line"><span class="comment">-----------------------------</span></span><br><span class="line"><span class="comment">[null, null, null, null, null, null, null]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><hr><h2 id="å¼ºå¤§çš„Stream-APIâ­ï¸">å¼ºå¤§çš„Stream APIâ­ï¸</h2><h3 id="Stream-APIæ¦‚è¿°">Stream APIæ¦‚è¿°</h3><ul><li>Java8ä¸­æœ‰ä¸¤ä¸ªæœ€ä¸ºé‡è¦çš„æ”¹å˜ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯Lambdaè¡¨è¾¾å¼ï¼Œå¦å¤–ä¸€ä¸ªåˆ™æ˜¯Stream API</li><li>Stream API(java.util.stream)æŠŠçœŸæ­£çš„å‡½æ•°å¼ç¼–ç¨‹é£æ ¼å¼•å…¥åˆ°Javaä¸­ï¼Œè¿™æ˜¯ç›®å‰ä¸ºæ­¢å¯¹Javaç±»åº“æœ€å¥½çš„è¡¥å……ï¼Œå› ä¸ºStream APIå¯ä»¥æå¤§åœ°æé«˜ç¨‹åºå‘˜ç”Ÿäº§åŠ›ï¼Œè®©ç¨‹åºå‘˜å†™å‡ºé«˜æ•ˆã€ç®€ä»‹çš„ä»£ç </li><li>Streamæ˜¯Java8 ä¸­å¤„ç†é›†åˆçš„å…³é”®æŠ½è±¡æ¦‚å¿µï¼Œå®ƒå¯ä»¥æŒ‡å®šä½ å¸Œæœ›å¯¹é›†åˆè¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥æ‰§è¡Œéå¸¸å¤æ‚çš„æŸ¥æ‰¾ã€è¿‡æ»¤å’Œæ˜ å°„æ•°æ®ç­‰æ“ä½œã€‚</li><li>ä½¿ç”¨Stream API å¯¹é›†åˆæ•°æ®è¿›è¡Œæ“ä½œï¼Œå°±ç±»ä¼¼äºä½¿ç”¨SQL æ‰§è¡Œçš„æ•°æ®åº“æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Stream API æ¥å¹¶è¡Œæ‰§è¡Œæ“ä½œã€‚ç®€è¨€ä¹‹ï¼ŒStream API æä¾›äº†ä¸€ç§é«˜æ•ˆä¸”æ˜“äºä½¿ç”¨çš„å¤„ç†æ•°æ®çš„æ–¹å¼</li><li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Stream API<ul><li>å®é™…å¼€å‘ä¸­ï¼Œé¡¹ç›®ä¸­å¤šæ•°æ•°æ®æºéƒ½æ˜¯æ¥è‡ªMySQLã€Oracle ç­‰ã€‚ä½†ç°åœ¨æ•°æ®æºå¯ä»¥æ›´å¤šäº†ï¼Œæœ‰MongDBã€Redisç­‰ï¼Œè€Œè¿™äº›NoSQLçš„æ•°æ®å°±éœ€è¦Javaå±‚é¢å»å¤„ç†ã€‚</li><li>Stream å’ŒCollectioné›†åˆçš„åŒºåˆ«ï¼šCollection æ˜¯ä¸€ç§é™æ€çš„å†…å­˜æ•°æ®ç»“æ„ï¼Œè€ŒStream æ˜¯æœ‰å…³è®¡ç®—çš„ã€‚å‰è€…æ˜¯ä¸»è¦é¢å‘å†…å­˜ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œåè€…ä¸»è¦æ˜¯é¢å‘CPUï¼Œé€šè¿‡CPU å®ç°è®¡ç®—ï¼ˆè¿™ä¹Ÿå°±æ˜¯ä¸ºå•¥ä¸€æ—¦æ‰§è¡Œç»ˆæ­¢æ“ä½œä¹‹åï¼ŒStream å°±ä¸èƒ½è¢«å†æ¬¡ä½¿ç”¨ï¼Œå¾—é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æµæ‰è¡Œï¼‰</li></ul></li></ul><blockquote><p>å°ç»“</p></blockquote><ol><li>Stream å…³æ³¨çš„æ˜¯å¯¹æ•°æ®çš„è¿ç®—ï¼Œä¸CPU æ‰“äº¤é“ï¼›<br>é›†åˆå…³æ³¨çš„æ˜¯æ•°æ®çš„å­˜å‚¨ï¼Œä¸å†…å­˜æ‰“äº¤é“</li><li>Stream è‡ªå·±ä¸ä¼šå­˜å‚¨æ•°æ®ï¼›<br>Stream ä¸ä¼šæ”¹å˜æºå¯¹è±¡ï¼Œç›¸åï¼Œä»–ä»¬ä¼šè¿”å›ä¸€ä¸ªæŒæœ‰ç»“æœçš„æ–°Stream<br>Stream æ“ä½œæ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ï¼Œè¿™æ„å‘³ç€ä»–ä»¬ä¼šç­‰åˆ°éœ€è¦ç»“æœçš„æ—¶å€™æ‰æ‰§è¡Œ</li><li>Stream æ‰§è¡Œæµç¨‹<ul><li>Streamå®ä¾‹åŒ–</li><li>ä¸€ç³»åˆ—ä¸­é—´æ“ä½œï¼ˆè¿‡æ»¤ã€æ˜ å°„ã€â€¦ï¼‰</li><li>ç»ˆæ­¢æ“ä½œ</li></ul></li><li>è¯´æ˜<ul><li>ä¸€ç³»åˆ—ä¸­é—´æ“ä½œè¿ï¼Œå¯¹æ•°æ®æºçš„æ•°æ®è¿›è¡Œå¤„ç†</li><li>ä¸€æ—¦æ‰§è¡Œç»ˆæ­¢æ“ä½œï¼Œå°±æ‰§è¡Œä¸­é—´æ“ä½œè¿ï¼Œå¹¶äº§ç”Ÿç»“æœï¼Œä¹‹åï¼Œä¸ä¼šå†è¢«ä½¿ç”¨</li></ul></li></ol><hr><h3 id="Streamçš„å®ä¾‹åŒ–">Streamçš„å®ä¾‹åŒ–</h3><div class="tabs" id="495d7dff-9394-4804-8bf5-e1083ed7e664"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#495d7dff-9394-4804-8bf5-e1083ed7e664-1"><i class="fas fa-award"></i>å‡†å¤‡</button></li><li class="tab"><button type="button" data-href="#495d7dff-9394-4804-8bf5-e1083ed7e664-2"><i class="fas fa-baseball-ball"></i>æ–¹å¼ä¸€</button></li><li class="tab"><button type="button" data-href="#495d7dff-9394-4804-8bf5-e1083ed7e664-3"><i class="fas fa-bone"></i>æ–¹å¼äºŒ</button></li><li class="tab"><button type="button" data-href="#495d7dff-9394-4804-8bf5-e1083ed7e664-4"><i class="fas fa-heartbeat"></i>æ–¹å¼ä¸‰</button></li><li class="tab"><button type="button" data-href="#495d7dff-9394-4804-8bf5-e1083ed7e664-5"><i class="fas fa-cookie-bite"></i>æ–¹å¼å››</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="495d7dff-9394-4804-8bf5-e1083ed7e664-1"><p>å‡è®¾æœ‰ä¸¤ä¸ªç±»</p><ul><li>Employee</li><li>EmployeeData</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="495d7dff-9394-4804-8bf5-e1083ed7e664-2"><p>é€šè¿‡é›†åˆåˆ›å»ºStream</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test14</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line">    <span class="comment">//default Stream&lt;E&gt; stream()  è¿”å›ä¸€ä¸ªé¡ºåºæµ</span></span><br><span class="line">    Stream&lt;Employee&gt; stream = employees.stream();</span><br><span class="line">    <span class="comment">//default Stream&lt;E&gt; parallelStream  è¿”å›ä¸€ä¸ªå¹¶è¡Œæµ</span></span><br><span class="line">    Stream&lt;Employee&gt; employeeStream = employees.parallelStream();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="495d7dff-9394-4804-8bf5-e1083ed7e664-3"><p>é€šè¿‡æ•°ç»„åˆ›å»ºString</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test15</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>&#125;;</span><br><span class="line">    <span class="comment">//è°ƒç”¨Arraysçš„static &lt;T&gt; Stream&lt;T&gt; stream(T[] array)   è¿”å›ä¸€ä¸ªæµ</span></span><br><span class="line">    <span class="type">IntStream</span> <span class="variable">stream</span> <span class="operator">=</span> Arrays.stream(arr);</span><br><span class="line">    </span><br><span class="line">    <span class="type">Employee</span> <span class="variable">kyle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">9527</span>, <span class="string">&quot;Kyle&quot;</span>);</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">lucy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">9421</span>, <span class="string">&quot;Lucy&quot;</span>);</span><br><span class="line">    Employee[] employees = &#123;kyle, lucy&#125;;</span><br><span class="line">    Stream&lt;Employee&gt; stream1 = Arrays.stream(employees);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="495d7dff-9394-4804-8bf5-e1083ed7e664-4"><p>é€šè¿‡Streamçš„of()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test16</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Integer&gt; stream = Stream.of(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="495d7dff-9394-4804-8bf5-e1083ed7e664-5"><p>åˆ›å»ºæ— é™æµ</p><p>å¦‚æœä¸ç”¨limité™åˆ¶è¾“å‡ºï¼Œåˆ™ä¼šä¸€ç›´è¾“å‡ºä¸‹å»ï¼ŒforEachå°±ç›¸å½“äºæ˜¯ç»ˆæ­¢æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test17</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è¿­ä»£</span></span><br><span class="line">    <span class="comment">// éå†å‰10ä¸ªæ•°</span></span><br><span class="line">    <span class="comment">// public static&lt;T&gt; Stream&lt;T&gt; iterate(final T seed, final UnaryOperator&lt;T&gt; f)</span></span><br><span class="line">    Stream.iterate(<span class="number">0</span>, t -&gt; t + <span class="number">1</span>).limit(<span class="number">10</span>).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿæˆ</span></span><br><span class="line">    <span class="comment">// 10ä¸ªéšæœºæ•°</span></span><br><span class="line">    <span class="comment">// public static&lt;T&gt; Stream&lt;T&gt; generate(Supplier&lt;T&gt; s)</span></span><br><span class="line">    Stream.generate(Math::random).limit(<span class="number">10</span>).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="Streamçš„ä¸­é—´æ“ä½œ">Streamçš„ä¸­é—´æ“ä½œ</h3><div class="tabs" id="d3b0262c-b223-4bb1-b1a2-91366ab594fc"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#d3b0262c-b223-4bb1-b1a2-91366ab594fc-1"><i class="fas fa-seedling"></i>ç­›é€‰ä¸åˆ‡ç‰‡</button></li><li class="tab"><button type="button" data-href="#d3b0262c-b223-4bb1-b1a2-91366ab594fc-2"><i class="fas fa-leaf"></i>æ˜ å°„</button></li><li class="tab"><button type="button" data-href="#d3b0262c-b223-4bb1-b1a2-91366ab594fc-3"><i class="fab fa-apple"></i>æ’åº</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="d3b0262c-b223-4bb1-b1a2-91366ab594fc-1"><p>å¤šä¸ªä¸­é—´æ“ä½œå¯ä»¥è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªæµæ°´çº¿ï¼Œé™¤éæµæ°´çº¿ä¸Šè§¦å‘ç»ˆæ­¢æ“ä½œï¼Œå¦åˆ™ä¸­é—´æ“ä½œä¸ä¼šæ‰§è¡Œä»»ä½•çš„å¤„ç†ï¼Œè€Œåœ¨ç»ˆæ­¢æ“ä½œæ—¶ä¸€æ¬¡æ€§å…¨éƒ¨å¤„ç†ï¼Œç§°ä¸º<code>æƒ°æ€§æ±‚å€¼</code></p><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">filter(Predicate p)</td><td style="text-align:center">æ¥æ”¶Lambda ï¼Œä»æµä¸­æ’é™¤æŸäº›å…ƒç´ </td></tr><tr><td style="text-align:center">distinct()</td><td style="text-align:center">ç­›é€‰ï¼Œé€šè¿‡æµæ‰€ç”Ÿæˆå…ƒç´ çš„hashCode() å’Œequals() å»é™¤é‡å¤å…ƒç´ </td></tr><tr><td style="text-align:center">limit(long maxSize)</td><td style="text-align:center">æˆªæ–­æµï¼Œä½¿å…¶å…ƒç´ ä¸è¶…è¿‡ç»™å®šæ•°é‡</td></tr><tr><td style="text-align:center">skip(long n)</td><td style="text-align:center">è·³è¿‡å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ‰”æ‰äº†å‰n ä¸ªå…ƒç´ çš„æµã€‚è‹¥æµä¸­å…ƒç´ ä¸è¶³n ä¸ªï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæµã€‚ä¸limit(n)äº’è¡¥</td></tr></tbody></table><div class="tabs" id="825df2d2-b66b-4271-bb30-790f58e7ac14"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#825df2d2-b66b-4271-bb30-790f58e7ac14-1"><i class="fas fa-bug"></i>filter</button></li><li class="tab"><button type="button" data-href="#825df2d2-b66b-4271-bb30-790f58e7ac14-2"><i class="fas fa-cannabis"></i>limit</button></li><li class="tab"><button type="button" data-href="#825df2d2-b66b-4271-bb30-790f58e7ac14-3"><i class="fas fa-candy-cane"></i>skip</button></li><li class="tab"><button type="button" data-href="#825df2d2-b66b-4271-bb30-790f58e7ac14-4"><i class="fas fa-child"></i>4</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="825df2d2-b66b-4271-bb30-790f58e7ac14-1"><p>æŸ¥è¯¢å·¥èµ„å¤§äº7000çš„å‘˜å·¥ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line">employees.stream().filter(employee -&gt; employee.getSalary() &gt; <span class="number">7000</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="825df2d2-b66b-4271-bb30-790f58e7ac14-2"><p>åªè¾“å‡º3æ¡å‘˜å·¥ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line">employees.stream().limit(<span class="number">3</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="825df2d2-b66b-4271-bb30-790f58e7ac14-3"><p>è·³è¿‡å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ‰”æ‰äº†å‰ n ä¸ªå…ƒç´ çš„æµã€‚è‹¥æµä¸­å…ƒç´ ä¸è¶³ n ä¸ªï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæµã€‚ä¸ limit(n) äº’è¡¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line">employees.stream().skip(<span class="number">3</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="825df2d2-b66b-4271-bb30-790f58e7ac14-4"><p>é€šè¿‡æµæ‰€ç”Ÿæˆå…ƒç´ çš„ hashCode() å’Œ equals() å»é™¤é‡å¤å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">9527</span>, <span class="string">&quot;Kyle&quot;</span>, <span class="number">20</span>, <span class="number">9999</span>));</span><br><span class="line">employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">9527</span>, <span class="string">&quot;Kyle&quot;</span>, <span class="number">20</span>, <span class="number">9999</span>));</span><br><span class="line">employees.stream().distinct().forEach(System.out::println);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d3b0262c-b223-4bb1-b1a2-91366ab594fc-2"><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">map(Function f)</td><td style="text-align:center">æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚</td></tr><tr><td style="text-align:center">mapToDouble(ToDoubleFunction f)</td><td style="text-align:center">æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„DoubleStreamã€‚</td></tr><tr><td style="text-align:center">mapToInt(ToIntFunction f)</td><td style="text-align:center">æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„IntStreamã€‚</td></tr><tr><td style="text-align:center">mapToLong(ToLongFunction f)</td><td style="text-align:center">æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„LongStreamã€‚</td></tr><tr><td style="text-align:center">flatMap(Function f)</td><td style="text-align:center">æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰æµè¿æ¥æˆä¸€ä¸ªæµ</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test19</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;aa&quot;</span>, <span class="string">&quot;bb&quot;</span>, <span class="string">&quot;cc&quot;</span>, <span class="string">&quot;dd&quot;</span>);</span><br><span class="line">    List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line">    <span class="comment">//map(Function f)â€”â€”æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†å…ƒç´ è½¬æ¢æˆå…¶ä»–å½¢å¼æˆ–æå–ä¿¡æ¯ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚</span></span><br><span class="line">    <span class="comment">// ç»ƒä¹ ï¼šå°†å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™å¹¶è¾“å‡º</span></span><br><span class="line">    strings.stream().map(s -&gt; s.toUpperCase()).forEach(System.out::println);</span><br><span class="line">    System.out.println(<span class="string">&quot;--------------------------&quot;</span>);</span><br><span class="line">    <span class="comment">// ç»ƒä¹ ï¼šè·å–å‘˜å·¥å§“åé•¿åº¦å¤§äº3çš„å‘˜å·¥çš„å§“åã€‚</span></span><br><span class="line">    <span class="comment">// è·å–nameæµ</span></span><br><span class="line">    employees.stream().map(Employee::getName).</span><br><span class="line">            <span class="comment">// è¿‡æ»¤å‡ºnameé•¿åº¦ &gt; 3çš„</span></span><br><span class="line">                    filter(name -&gt; name.length() &gt; <span class="number">3</span>).</span><br><span class="line">            <span class="comment">// éå†è¾“å‡º</span></span><br><span class="line">                    forEach(System.out::println);</span><br><span class="line">    System.out.println(<span class="string">&quot;--------------------------&quot;</span>);</span><br><span class="line">    <span class="comment">// ç»ƒä¹ ï¼šå°†å­—ç¬¦ä¸²ä¸­çš„å¤šä¸ªå­—ç¬¦æ„æˆçš„é›†åˆè½¬æ¢ä¸ºå¯¹åº”çš„Streamå®ä¾‹</span></span><br><span class="line">    strings.stream().map(LambdaTest::formStringToStream).</span><br><span class="line">            forEach(characterStream -&gt;</span><br><span class="line">            characterStream.forEach(System.out::println));</span><br><span class="line">    <span class="comment">// ä½¿ç”¨flatMap(Function f)è¾¾åˆ°åŒæ ·çš„æ•ˆæœ</span></span><br><span class="line">    System.out.println(<span class="string">&quot;--------------------------&quot;</span>);</span><br><span class="line">    strings.stream().flatMap(LambdaTest::formStringToStream).forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Stream&lt;Character&gt; <span class="title function_">formStringToStream</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    ArrayList&lt;Character&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : str.toCharArray()) &#123;</span><br><span class="line">        list.add(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list.stream();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">AA</span></span><br><span class="line"><span class="comment">BB</span></span><br><span class="line"><span class="comment">CC</span></span><br><span class="line"><span class="comment">DD</span></span><br><span class="line"><span class="comment">--------------------------</span></span><br><span class="line"><span class="comment">æ¯”å°”ç›–èŒ¨</span></span><br><span class="line"><span class="comment">æ‰å…‹ä¼¯æ ¼</span></span><br><span class="line"><span class="comment">--------------------------</span></span><br><span class="line"><span class="comment">a</span></span><br><span class="line"><span class="comment">a</span></span><br><span class="line"><span class="comment">b</span></span><br><span class="line"><span class="comment">b</span></span><br><span class="line"><span class="comment">c</span></span><br><span class="line"><span class="comment">c</span></span><br><span class="line"><span class="comment">d</span></span><br><span class="line"><span class="comment">d</span></span><br><span class="line"><span class="comment">--------------------------</span></span><br><span class="line"><span class="comment">a</span></span><br><span class="line"><span class="comment">a</span></span><br><span class="line"><span class="comment">b</span></span><br><span class="line"><span class="comment">b</span></span><br><span class="line"><span class="comment">c</span></span><br><span class="line"><span class="comment">c</span></span><br><span class="line"><span class="comment">d</span></span><br><span class="line"><span class="comment">d</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d3b0262c-b223-4bb1-b1a2-91366ab594fc-3"><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">sorted()</td><td style="text-align:center">äº§ç”Ÿä¸€ä¸ªæ–°æµï¼Œå…¶ä¸­æŒ‰è‡ªç„¶é¡ºåºæ’åº</td></tr><tr><td style="text-align:center">sorted(Comparator com)</td><td style="text-align:center">äº§ç”Ÿä¸€ä¸ªæ–°æµï¼Œå…¶ä¸­æŒ‰æ¯”è¾ƒå™¨é¡ºåºæ’åº</td></tr></tbody></table><div class="tabs" id="f93dd61b-e0dd-4623-9b0b-663db8f61924"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#f93dd61b-e0dd-4623-9b0b-663db8f61924-1"><i class="fas fa-cat"></i>è‡ªç„¶æ’åº</button></li><li class="tab"><button type="button" data-href="#f93dd61b-e0dd-4623-9b0b-663db8f61924-2"><i class="fas fa-horse"></i>æ¯”è¾ƒå™¨æ’åº</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="f93dd61b-e0dd-4623-9b0b-663db8f61924-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; nums = Arrays.asList(<span class="number">13</span>, <span class="number">54</span>, <span class="number">97</span>, <span class="number">52</span>, <span class="number">43</span>, <span class="number">64</span>, <span class="number">27</span>);</span><br><span class="line">nums.stream().sorted().forEach(System.out::println);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">13</span></span><br><span class="line"><span class="comment">27</span></span><br><span class="line"><span class="comment">43</span></span><br><span class="line"><span class="comment">52</span></span><br><span class="line"><span class="comment">54</span></span><br><span class="line"><span class="comment">64</span></span><br><span class="line"><span class="comment">97</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f93dd61b-e0dd-4623-9b0b-663db8f61924-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šåˆ¶æ’åºï¼Œå…ˆæŒ‰ç…§å¹´é¾„å‡åºæ’ï¼Œå†æŒ‰ç…§å·¥èµ„é™åºæ’</span></span><br><span class="line">employees.stream().sorted((o1, o2) -&gt; &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">compare</span> <span class="operator">=</span> Integer.compare(o1.getAge(), o2.getAge());</span><br><span class="line">    <span class="keyword">if</span> (compare != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> compare;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">return</span> -Double.compare(o1.getSalary(), o2.getSalary());</span><br><span class="line">&#125;).forEach(System.out::println);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Employee&#123;id=1002, name=&#x27;é©¬äº‘&#x27;, age=12, salary=9876.12&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1004, name=&#x27;é›·å†›&#x27;, age=26, salary=7657.37&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1007, name=&#x27;ä»»æ­£é&#x27;, age=26, salary=4333.32&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1003, name=&#x27;åˆ˜å¼ºä¸œ&#x27;, age=33, salary=3000.82&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1001, name=&#x27;é©¬åŒ–è…¾&#x27;, age=34, salary=6000.38&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1008, name=&#x27;æ‰å…‹ä¼¯æ ¼&#x27;, age=35, salary=2500.32&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1006, name=&#x27;æ¯”å°”ç›–èŒ¨&#x27;, age=42, salary=9500.43&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1005, name=&#x27;æå½¦å®&#x27;, age=65, salary=5555.32&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="Streamçš„ç»ˆæ­¢æ“ä½œ">Streamçš„ç»ˆæ­¢æ“ä½œ</h3><div class="tabs" id="2f2c6303-0cfc-4618-b83c-5ae4ef119600"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2f2c6303-0cfc-4618-b83c-5ae4ef119600-1"><i class="fas fa-cat"></i>åŒ¹é…ä¸æŸ¥æ‰¾</button></li><li class="tab"><button type="button" data-href="#2f2c6303-0cfc-4618-b83c-5ae4ef119600-2"><i class="fas fa-horse"></i>å½’çº¦</button></li><li class="tab"><button type="button" data-href="#2f2c6303-0cfc-4618-b83c-5ae4ef119600-3"><i class="fas fa-dove"></i>æ”¶é›†1</button></li><li class="tab"><button type="button" data-href="#2f2c6303-0cfc-4618-b83c-5ae4ef119600-4"><i class="fas fa-cookie-bite"></i>æ”¶é›†2</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2f2c6303-0cfc-4618-b83c-5ae4ef119600-1"><ul><li>ç»ˆç«¯æ“ä½œä¼šä»æµçš„æµæ°´çº¿ç”Ÿæˆç»“æœã€‚å…¶ç»“æœå¯ä»¥æ˜¯ä»»ä½•ä¸æ˜¯æµçš„å€¼ï¼Œä¾‹å¦‚ï¼šListã€Integerï¼Œç”šè‡³æ˜¯void ã€‚</li><li>æµè¿›è¡Œäº†ç»ˆæ­¢æ“ä½œåï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨ã€‚</li></ul><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">allMatch(Predicate p)</td><td style="text-align:center">æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´ </td></tr><tr><td style="text-align:center">anyMatch(Predicate p)</td><td style="text-align:center">æ£€æŸ¥æ˜¯å¦è‡³å°‘åŒ¹é…ä¸€ä¸ªå…ƒç´ </td></tr><tr><td style="text-align:center">noneMatch(Predicate p)</td><td style="text-align:center">æ£€æŸ¥æ˜¯å¦æ²¡æœ‰åŒ¹é…æ‰€æœ‰å…ƒç´ </td></tr><tr><td style="text-align:center">findFirst()</td><td style="text-align:center">è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td style="text-align:center">findAny()</td><td style="text-align:center">è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ </td></tr><tr><td style="text-align:center">count()</td><td style="text-align:center">è¿”å›æµä¸­å…ƒç´ æ€»æ•°</td></tr><tr><td style="text-align:center">max(Comparator c)</td><td style="text-align:center">è¿”å›æµä¸­æœ€å¤§å€¼</td></tr><tr><td style="text-align:center">min(Comparator c)</td><td style="text-align:center">è¿”å›æµä¸­æœ€å°å€¼</td></tr><tr><td style="text-align:center">forEach(Consumer c)</td><td style="text-align:center">å†…éƒ¨è¿­ä»£(ä½¿ç”¨Collection æ¥å£éœ€è¦ç”¨æˆ·å»åšè¿­ä»£ï¼Œç§°ä¸ºå¤–éƒ¨è¿­ä»£ã€‚ç›¸åï¼ŒStream API ä½¿ç”¨å†…éƒ¨è¿­ä»£â€”â€”å®ƒå¸®ä½ æŠŠè¿­ä»£åšäº†)</td></tr></tbody></table><div class="tabs" id="4af6855a-8991-4e3b-a193-e90a459a705e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#4af6855a-8991-4e3b-a193-e90a459a705e-1"><i class="fas fa-cat"></i>æµ‹è¯•æ–¹æ³•</button></li><li class="tab"><button type="button" data-href="#4af6855a-8991-4e3b-a193-e90a459a705e-2"><i class="fas fa-horse"></i>è¾“å‡º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="4af6855a-8991-4e3b-a193-e90a459a705e-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test21</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line">    <span class="comment">// allMatch(Predicate p)â€”â€”æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´ ã€‚</span></span><br><span class="line">    <span class="comment">// ç»ƒä¹ ï¼šæ˜¯å¦æ‰€æœ‰çš„å‘˜å·¥çš„å·¥èµ„æ˜¯å¦éƒ½å¤§äº5000</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦æ‰€æœ‰çš„å‘˜å·¥çš„å·¥èµ„æ˜¯å¦éƒ½å¤§äº5000ï¼š&quot;</span>+employees.stream().allMatch(employee -&gt; employee.getSalary() &gt; <span class="number">5000</span>));</span><br><span class="line">    <span class="comment">// anyMatch(Predicate p)â€”â€”æ£€æŸ¥æ˜¯å¦è‡³å°‘åŒ¹é…ä¸€ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line">    <span class="comment">// ç»ƒä¹ ï¼šæ˜¯å¦å­˜åœ¨å‘˜å·¥å¹´é¾„å°äº15</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦å­˜åœ¨å‘˜å·¥å¹´é¾„å°äº15ï¼š&quot;</span>+employees.stream().anyMatch(employee -&gt; employee.getAge() &lt; <span class="number">15</span>));</span><br><span class="line">    <span class="comment">// noneMatch(Predicate p)â€”â€”æ£€æŸ¥æ˜¯å¦æ²¡æœ‰åŒ¹é…çš„å…ƒç´ ã€‚</span></span><br><span class="line">    <span class="comment">// ç»ƒä¹ ï¼šæ˜¯å¦ä¸å­˜åœ¨å‘˜å·¥å§“â€œé©¬â€</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦ä¸å­˜åœ¨å‘˜å·¥å§“é©¬ï¼š&quot;</span>+employees.stream().noneMatch(employee -&gt; employee.getName().startsWith(<span class="string">&quot;é©¬&quot;</span>)));</span><br><span class="line">    <span class="comment">//findFirstâ€”â€”è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    System.out.println(<span class="string">&quot;è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š&quot;</span>+employees.stream().findFirst());</span><br><span class="line">    <span class="comment">//findAnyâ€”â€”è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ </span></span><br><span class="line">    System.out.println(<span class="string">&quot;è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ &quot;</span>+employees.stream().findAny());</span><br><span class="line">    <span class="comment">//countâ€”â€”è¿”å›æµä¸­å…ƒç´ çš„æ€»ä¸ªæ•°</span></span><br><span class="line">    System.out.println(<span class="string">&quot;è¿”å›å…ƒç´ æ€»æ•°ï¼š&quot;</span>+employees.stream().count());</span><br><span class="line">    <span class="comment">//max(Comparator c)â€”â€”è¿”å›æµä¸­æœ€å¤§å€¼</span></span><br><span class="line">    System.out.println(<span class="string">&quot;è¿”å›æœ€é«˜å·¥èµ„ï¼š&quot;</span>+employees.stream().map(Employee::getSalary).max(Double::compare));</span><br><span class="line">    <span class="comment">//min(Comparator c)â€”â€”è¿”å›æµä¸­æœ€å°å€¼</span></span><br><span class="line">    System.out.println(<span class="string">&quot;è¿”å›æœ€å°å¹´é¾„ï¼š&quot;</span>+employees.stream().map(Employee::getAge).min(Integer::compare));</span><br><span class="line">    <span class="comment">//forEach(Consumer c)â€”â€”å†…éƒ¨è¿­ä»£</span></span><br><span class="line">    employees.stream().forEach(System.out::println);</span><br><span class="line">    System.out.println(<span class="string">&quot;-------------&quot;</span>);</span><br><span class="line">    <span class="comment">////ä½¿ç”¨é›†åˆçš„éå†æ“ä½œ</span></span><br><span class="line">    employees.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4af6855a-8991-4e3b-a193-e90a459a705e-2"><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">æ˜¯å¦æ‰€æœ‰çš„å‘˜å·¥çš„å·¥èµ„æ˜¯å¦éƒ½å¤§äº<span class="number">5000</span><span class="built_in">ï¼šfalse</span></span><br><span class="line">æ˜¯å¦å­˜åœ¨å‘˜å·¥å¹´é¾„å°äº<span class="number">15</span><span class="built_in">ï¼štrue</span></span><br><span class="line">æ˜¯å¦ä¸å­˜åœ¨å‘˜å·¥å§“é©¬<span class="built_in">ï¼šfalse</span></span><br><span class="line">è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šOptional[Employee<span class="built_in">&#123;id</span>=<span class="number">1001</span>,<span class="built_in"> name</span>=<span class="string">&#x27;é©¬åŒ–è…¾&#x27;</span>, age=<span class="number">34</span>, salary=<span class="number">6000.38</span>&#125;]</span><br><span class="line">è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ Optional[Employee<span class="built_in">&#123;id</span>=<span class="number">1001</span>,<span class="built_in"> name</span>=<span class="string">&#x27;é©¬åŒ–è…¾&#x27;</span>, age=<span class="number">34</span>, salary=<span class="number">6000.38</span>&#125;]</span><br><span class="line">è¿”å›å…ƒç´ æ€»æ•°ï¼š<span class="number">8</span></span><br><span class="line">è¿”å›æœ€é«˜å·¥èµ„ï¼šOptional[<span class="number">9876.12</span>]</span><br><span class="line">è¿”å›æœ€å°å¹´é¾„ï¼šOptional[<span class="number">12</span>]</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1001</span>,<span class="built_in"> name</span>=<span class="string">&#x27;é©¬åŒ–è…¾&#x27;</span>, age=<span class="number">34</span>, salary=<span class="number">6000.38</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1002</span>,<span class="built_in"> name</span>=<span class="string">&#x27;é©¬äº‘&#x27;</span>, age=<span class="number">12</span>, salary=<span class="number">9876.12</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1003</span>,<span class="built_in"> name</span>=<span class="string">&#x27;åˆ˜å¼ºä¸œ&#x27;</span>, age=<span class="number">33</span>, salary=<span class="number">3000.82</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1004</span>,<span class="built_in"> name</span>=<span class="string">&#x27;é›·å†›&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">7657.37</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1005</span>,<span class="built_in"> name</span>=<span class="string">&#x27;æå½¦å®&#x27;</span>, age=<span class="number">65</span>, salary=<span class="number">5555.32</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1006</span>,<span class="built_in"> name</span>=<span class="string">&#x27;æ¯”å°”ç›–èŒ¨&#x27;</span>, age=<span class="number">42</span>, salary=<span class="number">9500.43</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1007</span>,<span class="built_in"> name</span>=<span class="string">&#x27;ä»»æ­£é&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">4333.32</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1008</span>,<span class="built_in"> name</span>=<span class="string">&#x27;æ‰å…‹ä¼¯æ ¼&#x27;</span>, age=<span class="number">35</span>, salary=<span class="number">2500.32</span>&#125;</span><br><span class="line">-------------</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1001</span>,<span class="built_in"> name</span>=<span class="string">&#x27;é©¬åŒ–è…¾&#x27;</span>, age=<span class="number">34</span>, salary=<span class="number">6000.38</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1002</span>,<span class="built_in"> name</span>=<span class="string">&#x27;é©¬äº‘&#x27;</span>, age=<span class="number">12</span>, salary=<span class="number">9876.12</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1003</span>,<span class="built_in"> name</span>=<span class="string">&#x27;åˆ˜å¼ºä¸œ&#x27;</span>, age=<span class="number">33</span>, salary=<span class="number">3000.82</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1004</span>,<span class="built_in"> name</span>=<span class="string">&#x27;é›·å†›&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">7657.37</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1005</span>,<span class="built_in"> name</span>=<span class="string">&#x27;æå½¦å®&#x27;</span>, age=<span class="number">65</span>, salary=<span class="number">5555.32</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1006</span>,<span class="built_in"> name</span>=<span class="string">&#x27;æ¯”å°”ç›–èŒ¨&#x27;</span>, age=<span class="number">42</span>, salary=<span class="number">9500.43</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1007</span>,<span class="built_in"> name</span>=<span class="string">&#x27;ä»»æ­£é&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">4333.32</span>&#125;</span><br><span class="line">Employee<span class="built_in">&#123;id</span>=<span class="number">1008</span>,<span class="built_in"> name</span>=<span class="string">&#x27;æ‰å…‹ä¼¯æ ¼&#x27;</span>, age=<span class="number">35</span>, salary=<span class="number">2500.32</span>&#125;</span><br><span class="line">*/    </span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2f2c6303-0cfc-4618-b83c-5ae4ef119600-2"><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">reduce(T iden, BinaryOperator b)</td><td style="text-align:center">å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å›T</td></tr><tr><td style="text-align:center">reduce(BinaryOperator b)</td><td style="text-align:center">å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å›Optional</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test22</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; nums = Arrays.asList(<span class="number">13</span>, <span class="number">32</span>, <span class="number">23</span>, <span class="number">31</span>, <span class="number">94</span>, <span class="number">20</span>, <span class="number">77</span>, <span class="number">21</span>, <span class="number">17</span>);</span><br><span class="line">    List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line">    <span class="comment">// reduce(T identity, BinaryOperator)â€”â€”å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› T</span></span><br><span class="line">    <span class="comment">// ç»ƒä¹ 1ï¼šè®¡ç®—1-10çš„è‡ªç„¶æ•°çš„å’Œ</span></span><br><span class="line">    System.out.println(nums.stream().reduce(<span class="number">0</span>, Integer::sum));</span><br><span class="line">    <span class="comment">//reduce(BinaryOperator) â€”â€”å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› Optional&lt;T&gt;</span></span><br><span class="line">    <span class="comment">// ç»ƒä¹ 2ï¼šè®¡ç®—å…¬å¸æ‰€æœ‰å‘˜å·¥å·¥èµ„æ€»å’Œ</span></span><br><span class="line">    System.out.println(employees.stream().map(Employee::getSalary).reduce((o1, o2) -&gt; o1 + o2));</span><br><span class="line">    <span class="comment">// åˆ«çš„å†™æ³•ï¼Œè®¡ç®—å¹´é¾„æ€»å’Œ</span></span><br><span class="line">    System.out.println(employees.stream().map(Employee::getAge).reduce(Integer::sum));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">328</span></span><br><span class="line"><span class="comment">Optional[48424.08]</span></span><br><span class="line"><span class="comment">Optional[273]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2f2c6303-0cfc-4618-b83c-5ae4ef119600-3"><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">collect(Collector c)</td><td style="text-align:center">å°†æµè½¬æ¢ä¸ºå…¶ä»–å½¢å¼ã€‚æ¥æ”¶ä¸€ä¸ªCollectoræ¥å£çš„å®ç°ï¼Œç”¨äºç»™Streamä¸­å…ƒç´ åšæ±‡æ€»çš„æ–¹æ³•</td></tr></tbody></table><p>æ–¹æ³•æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test23</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// collect(Collector c)â€”â€”å°†æµè½¬æ¢ä¸ºå…¶ä»–å½¢å¼ã€‚æ¥æ”¶ä¸€ä¸ª Collectoræ¥å£çš„å®ç°ï¼Œç”¨äºç»™Streamä¸­å…ƒç´ åšæ±‡æ€»çš„æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// ç»ƒä¹ 1ï¼šæŸ¥æ‰¾å·¥èµ„å¤§äº6000çš„å‘˜å·¥ï¼Œç»“æœè¿”å›ä¸ºä¸€ä¸ªList</span></span><br><span class="line">    List&lt;Employee&gt; employees = EmployeeData.getEmployees();</span><br><span class="line">    List&lt;Employee&gt; list = employees.stream().filter(employee -&gt; employee.getSalary() &gt; <span class="number">6000</span>).collect(Collectors.toList());</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">    System.out.println(<span class="string">&quot;--------------------&quot;</span>);</span><br><span class="line">    <span class="comment">// ç»ƒä¹ 2ï¼šæŸ¥æ‰¾å¹´é¾„å¤§äº20çš„å‘˜å·¥ï¼Œç»“æœè¿”å›ä¸ºä¸€ä¸ªList</span></span><br><span class="line">    employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">9527</span>,<span class="string">&quot;Kyle&quot;</span>,<span class="number">21</span>,<span class="number">9999</span>));</span><br><span class="line">    employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">9527</span>,<span class="string">&quot;Kyle&quot;</span>,<span class="number">21</span>,<span class="number">9999</span>));</span><br><span class="line">    employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">9527</span>,<span class="string">&quot;Kyle&quot;</span>,<span class="number">21</span>,<span class="number">9999</span>));</span><br><span class="line">    employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">9527</span>,<span class="string">&quot;Kyle&quot;</span>,<span class="number">21</span>,<span class="number">9999</span>));</span><br><span class="line">    Set&lt;Employee&gt; set = employees.stream().filter(employee -&gt; employee.getAge() &gt; <span class="number">20</span>).collect(Collectors.toSet());</span><br><span class="line">    set.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Employee&#123;id=1001, name=&#x27;é©¬åŒ–è…¾&#x27;, age=34, salary=6000.38&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1002, name=&#x27;é©¬äº‘&#x27;, age=12, salary=9876.12&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1004, name=&#x27;é›·å†›&#x27;, age=26, salary=7657.37&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1006, name=&#x27;æ¯”å°”ç›–èŒ¨&#x27;, age=42, salary=9500.43&#125;</span></span><br><span class="line"><span class="comment">--------------------</span></span><br><span class="line"><span class="comment">Employee&#123;id=1001, name=&#x27;é©¬åŒ–è…¾&#x27;, age=34, salary=6000.38&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1007, name=&#x27;ä»»æ­£é&#x27;, age=26, salary=4333.32&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1008, name=&#x27;æ‰å…‹ä¼¯æ ¼&#x27;, age=35, salary=2500.32&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1006, name=&#x27;æ¯”å°”ç›–èŒ¨&#x27;, age=42, salary=9500.43&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1005, name=&#x27;æå½¦å®&#x27;, age=65, salary=5555.32&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1003, name=&#x27;åˆ˜å¼ºä¸œ&#x27;, age=33, salary=3000.82&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=9527, name=&#x27;Kyle&#x27;, age=21, salary=9999.0&#125;</span></span><br><span class="line"><span class="comment">Employee&#123;id=1004, name=&#x27;é›·å†›&#x27;, age=26, salary=7657.37&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2f2c6303-0cfc-4618-b83c-5ae4ef119600-4"><p>Collector æ¥å£ä¸­æ–¹æ³•çš„å®ç°å†³å®šäº†å¦‚ä½•å¯¹æµæ‰§è¡Œæ”¶é›†çš„æ“ä½œ(å¦‚æ”¶é›†åˆ°Listã€Setã€Map)ã€‚</p><p>Collectorså®ç”¨ç±»æä¾›äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå¸¸è§æ”¶é›†å™¨å®ä¾‹ï¼Œå…·ä½“æ–¹æ³•ä¸å®ä¾‹å¦‚ä¸‹è¡¨ï¼š</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    
    <summary type="html">Lambdaè¡¨è¾¾å¼ã€å‡½æ•°å¼æ¥å£ã€Stream API</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>äºŒå‰æ ‘</title>
    <link href="https://wuwawawa.github.io/posts/e85d694a.html"/>
    <id>https://wuwawawa.github.io/posts/e85d694a.html</id>
    <published>2023-05-10T05:04:05.000Z</published>
    <updated>2023-05-10T07:15:28.911Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¿»è½¬äºŒå‰æ ‘">ç¿»è½¬äºŒå‰æ ‘</h2><div class="tag link"><a class="link-card" title="226. ç¿»è½¬äºŒå‰æ ‘" href="https://leetcode.cn/problems/invert-binary-tree/"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/leetcode.jpg"/></div><div class="right"><p class="text">226. ç¿»è½¬äºŒå‰æ ‘</p><p class="url">https://leetcode.cn/problems/invert-binary-tree/</p></div></a></div><p>ç»™ä½ ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> ï¼Œç¿»è½¬è¿™æ£µäºŒå‰æ ‘ï¼Œå¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><img src="https://assets.leetcode.com/uploads/2021/03/14/invert1-tree.jpg" alt="img" style="zoom:67%;" /><p>é€’å½’ä¸‰éƒ¨æ›²</p><ol><li>ç¡®å®šé€’å½’å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ã€‚</li><li>ç¡®å®šç»ˆæ­¢æ¡ä»¶ã€‚å½“å‰èŠ‚ç‚¹ä¸ºç©ºçš„æ—¶å€™ï¼Œå°±è¿”å›</li><li>ç¡®å®šå•å±‚é€’å½’çš„é€»è¾‘ã€‚å› ä¸ºæ˜¯å…ˆå‰åºéå†ï¼Œæ‰€ä»¥å…ˆè¿›è¡Œäº¤æ¢å·¦å³å­©å­èŠ‚ç‚¹ï¼Œç„¶ååè½¬å·¦å­æ ‘ï¼Œåè½¬å³å­æ ‘ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="comment">//é€’å½’å‡½æ•°çš„ç»ˆæ­¢æ¡ä»¶ï¼ŒèŠ‚ç‚¹ä¸ºç©ºæ—¶è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸‹é¢ä¸‰å¥æ˜¯å°†å½“å‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘äº¤æ¢</span></span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> root.right;</span><br><span class="line">    root.right = root.left;</span><br><span class="line">    root.left = tmp;</span><br><span class="line">    <span class="comment">//é€’å½’äº¤æ¢å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘</span></span><br><span class="line">    invertTree(root.left);</span><br><span class="line">    <span class="comment">//é€’å½’äº¤æ¢å½“å‰èŠ‚ç‚¹çš„ å³å­æ ‘</span></span><br><span class="line">    invertTree(root.right);</span><br><span class="line">    <span class="comment">//å‡½æ•°è¿”å›æ—¶å°±è¡¨ç¤ºå½“å‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œä»¥åŠå®ƒçš„å·¦å³å­æ ‘</span></span><br><span class="line">    <span class="comment">//éƒ½å·²ç»äº¤æ¢å®Œäº†</span></span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><hr><h2 id="å¯¹ç§°äºŒå‰æ ‘">å¯¹ç§°äºŒå‰æ ‘</h2><div class="tag link"><a class="link-card" title="101. å¯¹ç§°äºŒå‰æ ‘" href="https://leetcode.cn/problems/symmetric-tree/"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/leetcode.jpg"/></div><div class="right"><p class="text">101. å¯¹ç§°äºŒå‰æ ‘</p><p class="url">https://leetcode.cn/problems/symmetric-tree/</p></div></a></div><p>ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> ï¼Œ æ£€æŸ¥å®ƒæ˜¯å¦è½´å¯¹ç§°ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><img src="https://assets.leetcode.com/uploads/2021/02/19/symtree1.jpg" alt="img" style="zoom:67%;" /><p>é€’å½’ä¸‰éƒ¨æ›²</p><ol><li>ç¡®å®šé€’å½’å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼</li></ol><p>å› ä¸ºæˆ‘ä»¬è¦æ¯”è¾ƒçš„æ˜¯æ ¹èŠ‚ç‚¹çš„ä¸¤ä¸ªå­æ ‘æ˜¯å¦æ˜¯ç›¸äº’ç¿»è½¬çš„ï¼Œè¿›è€Œåˆ¤æ–­è¿™ä¸ªæ ‘æ˜¯ä¸æ˜¯å¯¹ç§°æ ‘ï¼Œæ‰€ä»¥è¦æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæ ‘ï¼Œå‚æ•°è‡ªç„¶ä¹Ÿæ˜¯å·¦å­æ ‘èŠ‚ç‚¹å’Œå³å­æ ‘èŠ‚ç‚¹ã€‚</p><p>è¿”å›å€¼è‡ªç„¶æ˜¯boolç±»å‹ã€‚</p><ol start="2"><li>ç¡®å®šç»ˆæ­¢æ¡ä»¶</li></ol><p>è¦æ¯”è¾ƒä¸¤ä¸ªèŠ‚ç‚¹æ•°å€¼ç›¸ä¸ç›¸åŒï¼Œé¦–å…ˆè¦æŠŠä¸¤ä¸ªèŠ‚ç‚¹ä¸ºç©ºçš„æƒ…å†µå¼„æ¸…æ¥šï¼å¦åˆ™åé¢æ¯”è¾ƒæ•°å€¼çš„æ—¶å€™å°±ä¼šæ“ä½œç©ºæŒ‡é’ˆäº†ã€‚</p><p>èŠ‚ç‚¹ä¸ºç©ºçš„æƒ…å†µæœ‰ï¼šï¼ˆæ³¨æ„æˆ‘ä»¬æ¯”è¾ƒçš„å…¶å®ä¸æ˜¯å·¦å­©å­å’Œå³å­©å­ï¼Œæ‰€ä»¥å¦‚ä¸‹æˆ‘ç§°ä¹‹ä¸ºå·¦èŠ‚ç‚¹å³èŠ‚ç‚¹ï¼‰</p><ul><li>å·¦èŠ‚ç‚¹ä¸ºç©ºï¼Œå³èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œä¸å¯¹ç§°ï¼Œreturn false</li><li>å·¦ä¸ä¸ºç©ºï¼Œå³ä¸ºç©ºï¼Œä¸å¯¹ç§° return false</li><li>å·¦å³éƒ½ä¸ºç©ºï¼Œå¯¹ç§°ï¼Œè¿”å›true</li></ul><p>æ­¤æ—¶å·²ç»æ’é™¤æ‰äº†èŠ‚ç‚¹ä¸ºç©ºçš„æƒ…å†µï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å°±æ˜¯å·¦å³èŠ‚ç‚¹ä¸ä¸ºç©ºï¼š</p><ul><li>å·¦å³éƒ½ä¸ä¸ºç©ºï¼Œæ¯”è¾ƒèŠ‚ç‚¹æ•°å€¼ï¼Œä¸ç›¸åŒå°±return false</li></ul><p>æ­¤æ—¶å·¦å³èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œä¸”æ•°å€¼ä¹Ÿä¸ç›¸åŒçš„æƒ…å†µæˆ‘ä»¬ä¹Ÿå¤„ç†äº†ã€‚</p><ol start="3"><li>ç¡®å®šå•å±‚é€’å½’çš„é€»è¾‘</li></ol><p>æ­¤æ—¶æ‰è¿›å…¥å•å±‚é€’å½’çš„é€»è¾‘ï¼Œå•å±‚é€’å½’çš„é€»è¾‘å°±æ˜¯å¤„ç† å·¦å³èŠ‚ç‚¹éƒ½ä¸ä¸ºç©ºï¼Œä¸”æ•°å€¼ç›¸åŒçš„æƒ…å†µã€‚</p><ul><li>æ¯”è¾ƒäºŒå‰æ ‘å¤–ä¾§æ˜¯å¦å¯¹ç§°ï¼šä¼ å…¥çš„æ˜¯å·¦èŠ‚ç‚¹çš„å·¦å­©å­ï¼Œå³èŠ‚ç‚¹çš„å³å­©å­ã€‚</li><li>æ¯”è¾ƒå†…æµ‹æ˜¯å¦å¯¹ç§°ï¼Œä¼ å…¥å·¦èŠ‚ç‚¹çš„å³å­©å­ï¼Œå³èŠ‚ç‚¹çš„å·¦å­©å­ã€‚</li><li>å¦‚æœå·¦å³éƒ½å¯¹ç§°å°±è¿”å›true ï¼Œæœ‰ä¸€ä¾§ä¸å¯¹ç§°å°±è¿”å›false ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è°ƒç”¨é€’å½’å‡½æ•°ï¼Œæ¯”è¾ƒå·¦èŠ‚ç‚¹ï¼Œå³èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> dfs(root.left,root.right);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(TreeNode left, TreeNode right)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (left == <span class="literal">null</span> &amp;&amp; right == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (left==<span class="literal">null</span> || right == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (left.val!=right.val)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dfs(left.left,right.right)&amp;&amp;dfs(left.right,right.left);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><hr><h2 id="äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦">äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</h2><div class="tag link"><a class="link-card" title="104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" href="https://leetcode.cn/problems/maximum-depth-of-binary-tree/"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/leetcode.jpg"/></div><div class="right"><p class="text">104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</p><p class="url">https://leetcode.cn/problems/maximum-depth-of-binary-tree/</p></div></a></div><div class="tag link"><a class="link-card" title="559. nå‰æ ‘çš„æœ€å¤§æ·±åº¦" href="https://leetcode.cn/problems/maximum-depth-of-n-ary-tree/"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/leetcode.jpg"/></div><div class="right"><p class="text">559. nå‰æ ‘çš„æœ€å¤§æ·±åº¦</p><p class="url">https://leetcode.cn/problems/maximum-depth-of-n-ary-tree/</p></div></a></div><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong><br>ç»™å®šäºŒå‰æ ‘ <code>[3,9,20,null,null,15,7]</code>ï¼Œ</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">3</span></span><br><span class="line">  / <span class="string">\</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">20</span></span><br><span class="line"> /  <span class="string">\</span></span><br><span class="line"><span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></table></figure><ol><li>ç¡®å®šé€’å½’å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼šå‚æ•°å°±æ˜¯ä¼ å…¥æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œè¿”å›å°±è¿”å›è¿™æ£µæ ‘çš„æ·±åº¦ï¼Œæ‰€ä»¥è¿”å›å€¼ä¸ºintç±»å‹ã€‚</li><li>ç¡®å®šç»ˆæ­¢æ¡ä»¶ï¼šå¦‚æœä¸ºç©ºèŠ‚ç‚¹çš„è¯ï¼Œå°±è¿”å›0ï¼Œè¡¨ç¤ºé«˜åº¦ä¸º0ã€‚</li><li>ç¡®å®šå•å±‚é€’å½’çš„é€»è¾‘ï¼šå…ˆæ±‚å®ƒçš„å·¦å­æ ‘çš„æ·±åº¦ï¼Œå†æ±‚å³å­æ ‘çš„æ·±åº¦ï¼Œæœ€åå–å·¦å³æ·±åº¦æœ€å¤§çš„æ•°å€¼å†+1 ï¼ˆåŠ 1æ˜¯å› ä¸ºç®—ä¸Šå½“å‰ä¸­é—´èŠ‚ç‚¹ï¼‰å°±æ˜¯ç›®å‰èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„æ ‘çš„æ·±åº¦ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftDepth</span> <span class="operator">=</span> maxDepth(root.left);</span><br><span class="line">        <span class="type">int</span> rightDepth= maxDepth(root.right);</span><br><span class="line">        <span class="keyword">return</span> Math.max(leftDepth,rightDepth)+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><hr><h2 id="äºŒå‰æ ‘çš„æœ€å°æ·±åº¦">äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å°æ·±åº¦ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><img src="https://assets.leetcode.com/uploads/2020/10/12/ex_depth.jpg" alt="img" style="zoom:67%;" /><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="attr">root</span> = [<span class="number">3</span>,<span class="number">9</span>,<span class="number">20</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="number">15</span>,<span class="number">7</span>]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">2</span></span><br></pre></td></tr></table></figure><hr><hr><h2 id="å¹³è¡¡äºŒå‰æ ‘">å¹³è¡¡äºŒå‰æ ‘</h2><hr><hr><h2 id="äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„">äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„</h2><div class="tag link"><a class="link-card" title="257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„" href="https://leetcode.cn/problems/binary-tree-paths/"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/leetcode.jpg"/></div><div class="right"><p class="text">257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„</p><p class="url">https://leetcode.cn/problems/binary-tree-paths/</p></div></a></div><p>ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼ŒæŒ‰ ä»»æ„é¡ºåº ï¼Œè¿”å›æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚</p><p>å¶å­èŠ‚ç‚¹ æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><img src="https://assets.leetcode.com/uploads/2021/03/12/paths-tree.jpg" alt="img" style="zoom:67%;" /><p>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼šroot = [1,2,3,null,5]<br>è¾“å‡ºï¼š[â€œ1-&gt;2-&gt;5â€,â€œ1-&gt;3â€]</p><hr><hr><h2 id="â­ï¸æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼">â­ï¸æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼</h2><div class="tag link"><a class="link-card" title="513. æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼" href="https://leetcode.cn/problems/find-bottom-left-tree-value/"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/leetcode.jpg"/></div><div class="right"><p class="text">513. æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼</p><p class="url">https://leetcode.cn/problems/find-bottom-left-tree-value/</p></div></a></div><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„ <strong>æ ¹èŠ‚ç‚¹</strong> <code>root</code>ï¼Œè¯·æ‰¾å‡ºè¯¥äºŒå‰æ ‘çš„ <strong>æœ€åº•å±‚ æœ€å·¦è¾¹</strong> èŠ‚ç‚¹çš„å€¼ã€‚</p><p>å‡è®¾äºŒå‰æ ‘ä¸­è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><img src="https://assets.leetcode.com/uploads/2020/12/14/tree2.jpg" alt="img" style="zoom:67%;" /><p>è¾“å‡º: 7</p><div class="tabs" id="0e595ee9-d0e0-428a-b10c-1f89283cc4f9"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#0e595ee9-d0e0-428a-b10c-1f89283cc4f9-1"><i class="fas fa-cat"></i>å›æº¯å†™æ³•</button></li><li class="tab"><button type="button" data-href="#0e595ee9-d0e0-428a-b10c-1f89283cc4f9-2"><i class="fas fa-horse"></i>ç²¾ç®€å›æº¯</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="0e595ee9-d0e0-428a-b10c-1f89283cc4f9-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">maxDepth</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        traversal(root, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">traversal</span><span class="params">(TreeNode root, <span class="type">int</span> depth)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root.left== <span class="literal">null</span> &amp;&amp; root .right ==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(depth&gt;maxDepth)&#123;</span><br><span class="line">                maxDepth=depth;</span><br><span class="line">                result=root.val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            depth++;</span><br><span class="line">            traversal(root.left,depth);</span><br><span class="line">            depth--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            depth++;</span><br><span class="line">            traversal(root.right,depth);</span><br><span class="line">            depth--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0e595ee9-d0e0-428a-b10c-1f89283cc4f9-2"><p>å›æº¯é€»è¾‘å…¶å®å°±éšè—åœ¨<code>traversal(root.left,depth+1);</code>ä¸­çš„ <code>depth+1</code>ã€‚ æ¯æ¬¡å‡½æ•°è°ƒç”¨å®Œï¼Œdepthä¾ç„¶æ˜¯æ²¡æœ‰åŠ ä¸Š1çš„ï¼Œè¿™å°±æ˜¯å›æº¯äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">maxDepth</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line"><span class="type">int</span> result;</span><br><span class="line"><span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    traversal(root, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">traversal</span><span class="params">(TreeNode root, <span class="type">int</span> depth)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root.left== <span class="literal">null</span> &amp;&amp; root .right ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(depth&gt;maxDepth)&#123;</span><br><span class="line">            maxDepth=depth;</span><br><span class="line">            result=root.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        traversal(root.left,depth+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">        traversal(root.right,depth+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><hr><h2 id="å·¦å¶å­ä¹‹å’Œ">å·¦å¶å­ä¹‹å’Œ</h2><hr><hr><h2 id="è·¯å¾„æ€»å’Œ">è·¯å¾„æ€»å’Œ</h2><hr><hr><h2 id="æ ¹æ®åºåˆ—æ„é€ äºŒå‰æ ‘">æ ¹æ®åºåˆ—æ„é€ äºŒå‰æ ‘</h2><hr><hr><h2 id="æœ€å¤§äºŒå‰æ ‘">æœ€å¤§äºŒå‰æ ‘</h2>]]></content>
    
    
    <summary type="html">äºŒå‰æ ‘ä¸“é¢˜</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://wuwawawa.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="é€’å½’" scheme="https://wuwawawa.github.io/tags/%E9%80%92%E5%BD%92/"/>
    
    <category term="å›æº¯" scheme="https://wuwawawa.github.io/tags/%E5%9B%9E%E6%BA%AF/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootWebå¼€å‘</title>
    <link href="https://wuwawawa.github.io/posts/3fc60a15.html"/>
    <id>https://wuwawawa.github.io/posts/3fc60a15.html</id>
    <published>2023-05-04T07:21:40.000Z</published>
    <updated>2023-05-03T12:51:14.094Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-åŠŸèƒ½æ”¯æŒ">1. åŠŸèƒ½æ”¯æŒ</h2><p>Spring Bootä¸ºSpring MVCæä¾›äº†è‡ªåŠ¨é…ç½®ï¼Œå¤§å¤šåœºæ™¯éƒ½æ— éœ€è‡ªå®šä¹‰é…ç½®</p><ul><li>å†…å®¹åå•†è§†å›¾è§£æå™¨ ContentNegotiatingViewResolver å’Œ BeanName è§†å›¾è§£æå™¨ BeanNameViewResolver</li><li>æ”¯æŒé™æ€èµ„æºï¼ˆåŒ…æ‹¬ webjarsï¼‰å’Œé™æ€ index.html é¡µæ”¯æŒ</li><li>è‡ªåŠ¨æ³¨å†Œç›¸å…³ç±»ï¼šConverterã€GenericConverterã€Formatter</li><li>å†…å®¹åå•†å¤„ç†å™¨ï¼šHttpMessageConverters</li><li>å›½é™…åŒ–ï¼šMessageCodesResolver</li></ul><p>å¼€å‘è§„èŒƒï¼š</p><ul><li>ä½¿ç”¨ <code>@Configuration</code> + <code>WebMvcConfigurer</code> è‡ªå®šä¹‰è§„åˆ™ï¼Œä¸ä½¿ç”¨ <code>@EnableWebMvc</code> æ³¨è§£</li><li>å£°æ˜ <code>WebMvcRegistrations</code> çš„å®ç°ç±»æ”¹å˜é»˜è®¤åº•å±‚ç»„ä»¶</li><li>ä½¿ç”¨ <code>@EnableWebMvc</code> + <code>@Configuration</code> + <code>DelegatingWebMvcConfiguration</code> å…¨é¢æ¥ç®¡ SpringMVC</li></ul><hr><h2 id="2-é™æ€èµ„æº">2. é™æ€èµ„æº</h2><h3 id="2-1-è®¿é—®è§„åˆ™">2.1 è®¿é—®è§„åˆ™</h3><p>ä½¿ç”¨äº†Spring MVCä¸­çš„<code>ResourceHttpRequestHandler</code></p><p>é»˜è®¤çš„é™æ€èµ„æºè·¯å¾„æ˜¯ classpath ä¸‹çš„ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°ä½ä¸ºï¼š</p><ul><li><code>/META-INF/resources</code></li><li><code>/resources</code></li><li><code>/static</code></li><li><code>/public</code></li></ul><p>çš„åŒ…å†…ï¼Œ<code>/</code> è¡¨ç¤ºå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230502154538517.png" alt="image-20230502154538517" style="zoom:50%;" /><p>è¯·æ±‚æ–¹å¼ï¼š <code>/ + é™æ€èµ„æºå</code></p><p>å¤„ç†åŸç†ï¼šè¯·æ±‚å…ˆå»å¯»æ‰¾ Controller å¤„ç†ï¼Œä¸èƒ½å¤„ç†çš„è¯·æ±‚å°±ä¼šäº¤ç»™é™æ€èµ„æºå¤„ç†å™¨ï¼Œé™æ€èµ„æºä¹Ÿæ‰¾ä¸åˆ°å°±å“åº” 404 é¡µé¢</p><div class="tabs" id="8c8c2f44-af52-4ecf-b88d-770f470b8a9e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#8c8c2f44-af52-4ecf-b88d-770f470b8a9e-1"><i class="fas fa-cat"></i>ä¿®æ”¹é»˜è®¤èµ„æºè·¯å¾„</button></li><li class="tab"><button type="button" data-href="#8c8c2f44-af52-4ecf-b88d-770f470b8a9e-2"><i class="fas fa-horse"></i>ä¿®æ”¹é™æ€èµ„æºè®¿é—®å‰ç¼€</button></li><li class="tab"><button type="button" data-href="#8c8c2f44-af52-4ecf-b88d-770f470b8a9e-3"><i class="fas fa-dove"></i>webjarè®¿é—®èµ„æº</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="8c8c2f44-af52-4ecf-b88d-770f470b8a9e-1"><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">static-locations::</span> [<span class="string">classpath:/haha/</span>]</span><br></pre></td></tr></table></figure><p>é»˜è®¤çš„é™æ€èµ„æºè·¯å¾„å°†æ‰¾ä¸åˆ°äº†</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8c8c2f44-af52-4ecf-b88d-770f470b8a9e-2"><p>é»˜è®¤æ˜¯ <code>/**</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/resources/**</span></span><br></pre></td></tr></table></figure><p>è®¿é—® URLï¼š<a href="http://localhost:8080/resources/">http://localhost:8080/resources/</a> + é™æ€èµ„æºå</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8c8c2f44-af52-4ecf-b88d-770f470b8a9e-3"><p>æŠŠä¸€äº›é™æ€èµ„æºåšæˆjaråŒ…ï¼Œè®¿é—®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è®¿é—®åœ°å€ï¼š<a href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js%EF%BC%8C%E5%90%8E%E9%9D%A2%E5%9C%B0%E5%9D%80%E8%A6%81%E6%8C%89%E7%85%A7%E4%BE%9D%E8%B5%96%E9%87%8C%E9%9D%A2%E7%9A%84%E5%8C%85%E8%B7%AF%E5%BE%84">http://localhost:8080/webjars/jquery/3.5.1/jquery.jsï¼Œåé¢åœ°å€è¦æŒ‰ç…§ä¾èµ–é‡Œé¢çš„åŒ…è·¯å¾„</a></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230502155735696.png" alt="image-20230502155735696" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="2-2-æ¬¢è¿é¡µé¢">2.2 æ¬¢è¿é¡µé¢</h3><ul><li><p>é™æ€èµ„æºè·¯å¾„ä¸‹  index.htmlã€‚</p><ul><li>å¯ä»¥é…ç½®é™æ€èµ„æºè·¯å¾„</li><li>ä½†æ˜¯ä¸å¯ä»¥é…ç½®é™æ€èµ„æºçš„è®¿é—®å‰ç¼€ã€‚å¦åˆ™å¯¼è‡´ index.htmlä¸èƒ½è¢«é»˜è®¤è®¿é—®</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="comment">#  mvc:</span></span><br><span class="line"><span class="comment">#    static-path-pattern: /res/**   è¿™ä¸ªä¼šå¯¼è‡´welcome pageåŠŸèƒ½å¤±æ•ˆ</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">static-locations:</span> [<span class="string">classpath:/haha/</span>]</span><br></pre></td></tr></table></figure><ul><li>controllerèƒ½å¤„ç†/indexã€‚</li></ul><p>ç½‘é¡µæ ‡ç­¾ä¸Šçš„å°å›¾æ ‡å¯ä»¥è‡ªå®šä¹‰è§„åˆ™ï¼ŒæŠŠèµ„æºé‡å‘½åä¸º favicon.ico æ”¾åœ¨é™æ€èµ„æºç›®å½•ä¸‹å³å¯</p><hr><h3 id="2-3-æºç åˆ†æ">2.3 æºç åˆ†æ</h3><ul><li>SpringBootå¯åŠ¨é»˜è®¤åŠ è½½ xxxAutoConfigurationç±»ï¼ˆè‡ªåŠ¨é…ç½®ç±»ï¼‰</li><li>SpringMVCåŠŸèƒ½çš„è‡ªåŠ¨é…ç½®ç±»<code>WebMvcAutoConfiguration</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">//å½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SERVLET_LOCATION</span> <span class="operator">=</span> <span class="string">&quot;/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tabs" id="3b8ad86e-8e1b-4e01-a278-58bd0497dd4a"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#3b8ad86e-8e1b-4e01-a278-58bd0497dd4a-1"><i class="fas fa-award"></i>å†…éƒ¨ç±»</button></li><li class="tab"><button type="button" data-href="#3b8ad86e-8e1b-4e01-a278-58bd0497dd4a-2"><i class="fas fa-baseball-ball"></i>é™æ€èµ„æºæ˜ å°„è§„åˆ™</button></li><li class="tab"><button type="button" data-href="#3b8ad86e-8e1b-4e01-a278-58bd0497dd4a-3"><i class="fas fa-bone"></i>æ¬¢è¿é¡µ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="3b8ad86e-8e1b-4e01-a278-58bd0497dd4a-1"><p>å†…éƒ¨ç±» WebMvcAutoConfigurationAdapteræ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span></span><br><span class="line"><span class="comment">// ç»‘å®š spring.mvcã€spring.webã€spring.resources ç›¸å…³çš„é…ç½®å±æ€§</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class,ResourceProperties.class, WebProperties.class &#125;)</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, ServletContextAware &#123;</span><br><span class="line"><span class="comment">//æœ‰å‚æ„é€ å™¨æ‰€æœ‰å‚æ•°çš„å€¼éƒ½ä¼šä»å®¹å™¨ä¸­ç¡®å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebMvcAutoConfigurationAdapter</span><span class="params">(<span class="comment">/*å‚æ•°*/</span>)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.resourceProperties = resourceProperties.hasBeenCustomized() ? resourceProperties</span><br><span class="line">: webProperties.getResources();</span><br><span class="line"><span class="built_in">this</span>.mvcProperties = mvcProperties;</span><br><span class="line"><span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line"><span class="built_in">this</span>.messageConvertersProvider = messageConvertersProvider;</span><br><span class="line"><span class="built_in">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();</span><br><span class="line"><span class="built_in">this</span>.dispatcherServletPath = dispatcherServletPath;</span><br><span class="line"><span class="built_in">this</span>.servletRegistrations = servletRegistrations;</span><br><span class="line"><span class="built_in">this</span>.mvcProperties.checkConfiguration();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦çš„å‚æ•°ï¼š</p><ul><li>ResourceProperties resourcePropertiesï¼šè·å–å’Œ spring.resources ç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</li><li>WebMvcProperties mvcPropertiesï¼šè·å–å’Œ spring.mvc ç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</li><li>ListableBeanFactory beanFactoryï¼šSpring çš„ beanFactory</li><li>HttpMessageConvertersï¼šæ‰¾åˆ°æ‰€æœ‰çš„ HttpMessageConverters</li><li>ResourceHandlerRegistrationCustomizerï¼šæ‰¾åˆ° èµ„æºå¤„ç†å™¨çš„è‡ªå®šä¹‰å™¨ã€‚</li><li>DispatcherServletPathï¼šé¡¹ç›®è·¯å¾„</li><li>ServletRegistrationBeanï¼šç»™åº”ç”¨æ³¨å†Œ Servletã€Filter</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3b8ad86e-8e1b-4e01-a278-58bd0497dd4a-2"><p>ä¸¤ç§é™æ€èµ„æºæ˜ å°„è§„åˆ™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    <span class="comment">//é…ç½®æ–‡ä»¶è®¾ç½® spring.resources.add-mappings: falseï¼Œç¦ç”¨æ‰€æœ‰é™æ€èµ„æº</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);<span class="comment">//è¢«ç¦ç”¨</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ³¨å†Œwebjarsé™æ€èµ„æºçš„æ˜ å°„è§„åˆ™æ˜ å°„è·¯å¾„</span></span><br><span class="line">    addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    <span class="comment">//æ³¨å†Œé™æ€èµ„æºè·¯å¾„çš„æ˜ å°„è§„åˆ™ é»˜è®¤æ˜ å°„ staticPathPattern = &quot;/**&quot; </span></span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">        <span class="comment">//staticLocations = CLASSPATH_RESOURCE_LOCATIONS</span></span><br><span class="line">        registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, SERVLET_LOCATION);</span><br><span class="line">            registration.addResourceLocations(resource);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;spring.web&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Resources</span> &#123;</span><br><span class="line">    <span class="comment">//é»˜è®¤èµ„æºè·¯å¾„ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="string">&quot;classpath:/META-INF/resources/&quot;</span>,</span><br><span class="line">                                                 <span class="string">&quot;classpath:/resources/&quot;</span>, </span><br><span class="line">                                                 <span class="string">&quot;classpath:/static/&quot;</span>, <span class="string">&quot;classpath:/public/&quot;</span> &#125;</span><br><span class="line">        <span class="keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;</span><br><span class="line">        <span class="comment">//å¯ä»¥è¿›è¡Œè§„åˆ™é‡å†™</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStaticLocations</span><span class="params">(String[] staticLocations)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.staticLocations = appendSlashIfNecessary(staticLocations);</span><br><span class="line"><span class="built_in">this</span>.customized = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3b8ad86e-8e1b-4e01-a278-58bd0497dd4a-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spring.web å±æ€§</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(WebProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(<span class="comment">/*å‚æ•°*/</span>)</span> &#123;</span><br><span class="line">        <span class="type">WelcomePageHandlerMapping</span> <span class="variable">welcomePageHandlerMapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TemplateAvailabilityProviders</span>(applicationContext), </span><br><span class="line">            applicationContext, getWelcomePage(),</span><br><span class="line">            <span class="comment">//staticPathPattern = &quot;/**&quot;</span></span><br><span class="line">            <span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">        <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">WelcomePageHandlerMapping(<span class="comment">/*å‚æ•°*/</span>) &#123;</span><br><span class="line">    <span class="comment">//æ‰€ä»¥é™åˆ¶ staticPathPattern å¿…é¡»ä¸º /** æ‰èƒ½å¯ç”¨è¯¥åŠŸèƒ½</span></span><br><span class="line">    <span class="keyword">if</span> (welcomePage != <span class="literal">null</span> &amp;&amp; <span class="string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Adding welcome page: &quot;</span> + welcomePage);</span><br><span class="line">        <span class="comment">//é‡å®šå‘</span></span><br><span class="line">        setRootViewName(<span class="string">&quot;forward:index.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Adding welcome page template: index&quot;</span>);</span><br><span class="line">        setRootViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>WelcomePageHandlerMappingï¼Œè®¿é—® / èƒ½è®¿é—®åˆ° index.html</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><hr><h2 id="3-Restæ˜ å°„">3. Restæ˜ å°„</h2><p>å¼€å¯ Rest åŠŸèƒ½</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment">#å¼€å¯é¡µé¢è¡¨å•çš„ReståŠŸèƒ½</span></span><br></pre></td></tr></table></figure><p>æºç åˆ†æï¼Œæ³¨å…¥äº† HiddenHttpMethodFilte è§£æ Rest é£æ ¼çš„è®¿é—®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;)</span></span><br><span class="line"><span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="4-å†…åµŒå®¹å™¨">4. å†…åµŒå®¹å™¨</h2><p>SpringBoot åµŒå…¥å¼ Servlet å®¹å™¨ï¼Œé»˜è®¤æ”¯æŒçš„ WebServeï¼šTomcatã€Jettyã€Undertow</p><p>é…ç½®æ–¹å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span> <span class="comment">&lt;!--å¿…é¡»è¦æŠŠå†…åµŒçš„ Tomcat å®¹å™¨--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Web åº”ç”¨å¯åŠ¨ï¼ŒSpringBoot å¯¼å…¥ Web åœºæ™¯åŒ… tomcatï¼Œåˆ›å»ºä¸€ä¸ª Web ç‰ˆçš„ IOC å®¹å™¨ï¼š</p><ul><li><p><code>SpringApplication.run(BootApplication.class, args)</code>ï¼šåº”ç”¨å¯åŠ¨</p></li><li><p><code>ConfigurableApplicationContext.run()</code>ï¼š</p><ul><li><p><code>context = createApplicationContext()</code>ï¼š<strong>åˆ›å»ºå®¹å™¨</strong></p><ul><li><p><code>applicationContextFactory = ApplicationContextFactory.DEFAULT</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContextFactory</span> <span class="variable">DEFAULT</span> <span class="operator">=</span> (webApplicationType) -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (webApplicationType) &#123;</span><br><span class="line">            <span class="keyword">case</span> SERVLET:</span><br><span class="line">                <span class="comment">// Servlet å®¹å™¨ï¼Œç»§æ‰¿è‡ª ServletWebServerApplicationContext</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigServletWebServerApplicationContext</span>();</span><br><span class="line">            <span class="keyword">case</span> REACTIVE:</span><br><span class="line">                <span class="comment">// å“åº”å¼ç¼–ç¨‹</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigReactiveWebServerApplicationContext</span>();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// æ™®é€š Spring å®¹å™¨</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>applicationContextFactory.create(this.webApplicationType)</code>ï¼šæ ¹æ®åº”ç”¨ç±»å‹åˆ›å»ºå®¹å™¨</p></li></ul></li><li><p><code>refreshContext(context)</code>ï¼šå®¹å™¨å¯åŠ¨åˆ·æ–°</p></li></ul></li></ul><p>å†…åµŒå®¹å™¨å·¥ä½œæµç¨‹ï¼š</p><ul><li><p>Spring å®¹å™¨å¯åŠ¨é€»è¾‘ä¸­ï¼Œåœ¨å®ä¾‹åŒ–éæ‡’åŠ è½½çš„å•ä¾‹ Bean ä¹‹å‰æœ‰ä¸€ä¸ªæ–¹æ³• <strong>onRefresh()</strong>ï¼Œç•™ç»™å­ç±»å»æ‰©å±•ï¼ŒWeb å®¹å™¨å°±æ˜¯é‡å†™è¿™ä¸ªæ–¹æ³•åˆ›å»º WebServer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onRefresh</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//çœç•¥....</span></span><br><span class="line">createWebServer();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createWebServer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ServletWebServerFactory</span> <span class="variable">factory</span> <span class="operator">=</span> getWebServerFactory();</span><br><span class="line">    <span class="built_in">this</span>.webServer = factory.getWebServer(getSelfInitializer());</span><br><span class="line">    createWebServer.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å– WebServer å·¥å‚ ServletWebServerFactoryï¼Œå¹¶ä¸”è·å–çš„æ•°é‡ä¸ç­‰äº 1 ä¼šæŠ¥é”™ï¼ŒSpring åº•å±‚æœ‰ä¸‰ç§ï¼š</p><p><code>TomcatServletWebServerFactory</code>ã€<code>JettyServletWebServerFactory</code>ã€<code>UndertowServletWebServerFactory</code></p></li><li><p><strong>è‡ªåŠ¨é…ç½®ç±» ServletWebServerFactoryAutoConfiguration</strong> å¯¼å…¥äº† ServletWebServerFactoryConfigurationï¼ˆé…ç½®ç±»ï¼‰ï¼Œæ ¹æ®æ¡ä»¶è£…é…åˆ¤æ–­ç³»ç»Ÿä¸­åˆ°åº•å¯¼å…¥äº†å“ªä¸ª Web æœåŠ¡å™¨çš„åŒ…ï¼Œåˆ›å»ºå‡ºæœåŠ¡å™¨å¹¶å¯åŠ¨</p></li><li><p>é»˜è®¤æ˜¯ web-starter å¯¼å…¥ tomcat åŒ…ï¼Œå®¹å™¨ä¸­å°±æœ‰ TomcatServletWebServerFactoryï¼Œåˆ›å»ºå‡º Tomcat æœåŠ¡å™¨å¹¶å¯åŠ¨ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">TomcatWebServer</span><span class="params">(Tomcat tomcat, <span class="type">boolean</span> autoStart, Shutdown shutdown)</span> &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">   initialize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ–¹æ³• initialize ä¸­æœ‰å¯åŠ¨æ–¹æ³•ï¼š<code>this.tomcat.start()</code></p></li></ul><hr><hr><h2 id="5-è‡ªå®šä¹‰">5. è‡ªå®šä¹‰</h2><h4 id="å®šåˆ¶è§„åˆ™">å®šåˆ¶è§„åˆ™</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebMvcConfigurer</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="comment">//è¿›è¡Œä¸€äº›æ–¹æ³•é‡å†™ï¼Œæ¥å®ç°è‡ªå®šä¹‰çš„è§„åˆ™</span></span><br><span class="line">            <span class="comment">//æ¯”å¦‚æ·»åŠ ä¸€äº›è§£æå™¨å’Œæ‹¦æˆªå™¨ï¼Œå°±æ˜¯å¯¹åŸå§‹å®¹å™¨åŠŸèƒ½çš„å¢åŠ </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¹Ÿå¯ä»¥ä¸åŠ  @Beanï¼Œç›´æ¥ä»è¿™é‡Œé‡å†™æ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¢åŠ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="å®šåˆ¶å®¹å™¨">å®šåˆ¶å®¹å™¨</h4><p>@EnableWebMvcï¼šå…¨é¢æ¥ç®¡ SpringMVCï¼Œæ‰€æœ‰è§„åˆ™å…¨éƒ¨è‡ªå·±é‡æ–°é…ç½®</p><ul><li><p>@EnableWebMvc + WebMvcConfigurer + @Bean  å…¨é¢æ¥ç®¡SpringMVC</p></li><li><p>@Import(DelegatingWebMvcConfiguration.<strong>class</strong>)ï¼Œè¯¥ç±»ç»§æ‰¿ WebMvcConfigurationSupportï¼Œè‡ªåŠ¨é…ç½®äº†ä¸€äº›éå¸¸åº•å±‚çš„ç»„ä»¶ï¼Œåªèƒ½ä¿è¯ SpringMVC æœ€åŸºæœ¬çš„ä½¿ç”¨</p></li></ul><p>åŸç†ï¼šè‡ªåŠ¨é…ç½®ç±» <strong>WebMvcAutoConfiguration</strong> é‡Œé¢çš„é…ç½®è¦èƒ½ç”Ÿæ•ˆï¼ŒWebMvcConfigurationSupport ç±»ä¸èƒ½è¢«åŠ è½½ï¼Œæ‰€ä»¥ @EnableWebMvc å¯¼è‡´é…ç½®ç±»å¤±æ•ˆï¼Œä»è€Œæ¥ç®¡äº† SpringMVC</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸€èˆ¬ä¸é€‚ç”¨æ­¤æ³¨è§£</p>]]></content>
    
    
    <summary type="html">SpringBoot webå¼€å‘åœºæ™¯</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="SpringMVC" scheme="https://wuwawawa.github.io/tags/SpringMVC/"/>
    
    <category term="SpringBoot" scheme="https://wuwawawa.github.io/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootè‡ªåŠ¨é…ç½®åŸç†</title>
    <link href="https://wuwawawa.github.io/posts/ec6e45b4.html"/>
    <id>https://wuwawawa.github.io/posts/ec6e45b4.html</id>
    <published>2023-05-03T14:26:54.000Z</published>
    <updated>2023-05-05T06:28:11.536Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-åº•å±‚æ³¨è§£">1. åº•å±‚æ³¨è§£</h2><h3 id="1-1-ç»„ä»¶æ·»åŠ ">1.1 ç»„ä»¶æ·»åŠ </h3><div class="tabs" id="ded05754-ee65-4d86-9ba1-c4e945edc966"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ded05754-ee65-4d86-9ba1-c4e945edc966-1"><i class="fas fa-atom"></i>Configuration</button></li><li class="tab"><button type="button" data-href="#ded05754-ee65-4d86-9ba1-c4e945edc966-2"><i class="far fa-sun"></i>Condition</button></li><li class="tab"><button type="button" data-href="#ded05754-ee65-4d86-9ba1-c4e945edc966-3"><i class="fas fa-wind"></i>å…¶ä»–</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ded05754-ee65-4d86-9ba1-c4e945edc966-1"><p>@Configurationï¼šè®¾ç½®å½“å‰ç±»ä¸ºé…ç½®ç±»</p><ul><li>proxyBeanMethods = trueï¼šFull å…¨æ¨¡å¼ï¼Œæ¯ä¸ª @Bean æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯å•å®ä¾‹çš„ï¼Œé»˜è®¤å€¼ï¼Œç±»ç»„ä»¶ä¹‹é—´<span class='p green'>æœ‰ä¾èµ–å…³ç³»</span>ï¼Œæ–¹æ³•ä¼šè¢«è°ƒç”¨å¾—åˆ°ä¹‹å‰å•å®ä¾‹ç»„ä»¶</li><li>proxyBeanMethods = falseï¼šLite è½»é‡çº§æ¨¡å¼ï¼Œæ¯ä¸ª @Bean æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯æ–°åˆ›å»ºçš„ï¼Œç±»ç»„ä»¶ä¹‹é—´<span class='p blue'>æ— ä¾èµ–å…³ç³»</span>ç”¨ Lite æ¨¡å¼åŠ é€Ÿå®¹å™¨å¯åŠ¨è¿‡ç¨‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ã€‚ä»¥æ–¹æ³•åä½œä¸ºç»„ä»¶çš„ idã€‚è¿”å›ç±»å‹å°±æ˜¯ç»„ä»¶ç±»å‹ã€‚è¿”å›çš„å€¼ï¼Œå°±æ˜¯ç»„ä»¶åœ¨å®¹å™¨ä¸­çš„å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;zhangsan&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ded05754-ee65-4d86-9ba1-c4e945edc966-2"><p>æ¡ä»¶è£…é…ï¼šæ»¡è¶³ConditionalæŒ‡å®šçš„æ¡ä»¶ï¼Œåˆ™è¿›è¡Œç»„ä»¶æ³¨å…¥</p><table><thead><tr><th style="text-align:left">æ³¨è§£</th><th style="text-align:left">åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">@ConditionalOnBean</td><td style="text-align:left">ä»…åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨æŸä¸ªbeanæ—¶ï¼Œæ‰ä¼šå®ä¾‹åŒ–è¿™ä¸ªBean</td></tr><tr><td style="text-align:left">@ConditionalOnClass</td><td style="text-align:left">æŸä¸ªclassä½äºç±»è·¯å¾„ä¸Šï¼Œæ‰ä¼šå®ä¾‹åŒ–è¿™ä¸ªBean</td></tr><tr><td style="text-align:left">@ConditionalOnExpression</td><td style="text-align:left">å½“è¡¨è¾¾å¼ä¸ºtrueçš„æ—¶å€™ï¼Œæ‰ä¼šå®ä¾‹åŒ–è¿™ä¸ªBean</td></tr><tr><td style="text-align:left">@ConditionalOnMissingBean</td><td style="text-align:left">ä»…åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨æŸä¸ªbeanæ—¶ï¼Œæ‰ä¼šå®ä¾‹åŒ–è¿™ä¸ªBean</td></tr><tr><td style="text-align:left">@ConditionalOnMissingClass</td><td style="text-align:left">æŸä¸ªclassåœ¨ç±»è·¯å¾„ä¸Šä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰ä¼šå®ä¾‹åŒ–è¿™ä¸ªBean</td></tr><tr><td style="text-align:left">@ConditionalOnNotWebApplication</td><td style="text-align:left">ä¸æ˜¯webåº”ç”¨æ—¶æ‰ä¼šå®ä¾‹åŒ–è¿™ä¸ªBean</td></tr><tr><td style="text-align:left">@AutoConfigureAfter</td><td style="text-align:left">åœ¨æŸä¸ªbeanå®Œæˆè‡ªåŠ¨é…ç½®åå®ä¾‹åŒ–è¿™ä¸ªbean</td></tr><tr><td style="text-align:left">@AutoConfigureBefore</td><td style="text-align:left">åœ¨æŸä¸ªbeanå®Œæˆè‡ªåŠ¨é…ç½®å‰å®ä¾‹åŒ–è¿™ä¸ªbean</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ded05754-ee65-4d86-9ba1-c4e945edc966-3"><p>@Beanã€@Componentã€@Controllerã€@Serviceã€@Repositoryå’ŒSpringä¸­ç›¸åŒå°±ä¸åœ¨ä»‹ç»</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="1-2-åŸç”Ÿé…ç½®æ–‡ä»¶å¼•å…¥">1.2 åŸç”Ÿé…ç½®æ–‡ä»¶å¼•å…¥</h3><p>æ¯”å¦‚ï¼Œå…¬å¸ä½¿ç”¨bean.xmlæ–‡ä»¶ç”Ÿæˆé…ç½®beanï¼Œç„¶è€Œä½ ä¸ºäº†çœäº‹ï¼Œæƒ³ç»§ç»­å¤ç”¨bean.xmlï¼Œ@ImportResourceç²‰å¢¨ç™»åœºã€‚</p><div class="tabs" id="b86eff17-ac9c-4c8c-86af-bc6296b6457e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#b86eff17-ac9c-4c8c-86af-bc6296b6457e-1"><i class="fas fa-seedling"></i>bean.xml</button></li><li class="tab"><button type="button" data-href="#b86eff17-ac9c-4c8c-86af-bc6296b6457e-2"><i class="fas fa-leaf"></i>ä½¿ç”¨æ–¹æ³•</button></li><li class="tab"><button type="button" data-href="#b86eff17-ac9c-4c8c-86af-bc6296b6457e-3"><i class="fab fa-apple"></i>æµ‹è¯•ç±»</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="b86eff17-ac9c-4c8c-86af-bc6296b6457e-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">...</span>&quot;&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;haha&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.boot.bean.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hehe&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.boot.bean.Pet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tomcat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="b86eff17-ac9c-4c8c-86af-bc6296b6457e-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(&quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="b86eff17-ac9c-4c8c-86af-bc6296b6457e-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//1ã€è¿”å›æˆ‘ä»¬IOCå®¹å™¨</span></span><br><span class="line">    <span class="type">ConfigurableApplicationContext</span> <span class="variable">run</span> <span class="operator">=</span> SpringApplication.run(MainApplication.class, args);</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">haha</span> <span class="operator">=</span> run.containsBean(<span class="string">&quot;haha&quot;</span>);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">hehe</span> <span class="operator">=</span> run.containsBean(<span class="string">&quot;hehe&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;hahaï¼š&quot;</span>+haha);<span class="comment">//true</span></span><br><span class="line">System.out.println(<span class="string">&quot;heheï¼š&quot;</span>+hehe);<span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="1-3-é…ç½®ç»‘å®š">1.3 é…ç½®ç»‘å®š</h3><p>æˆ‘ä»¬ä¹ æƒ¯äºæŠŠç»å¸¸å˜åŒ–çš„ä¸€ä¸ªä¸œè¥¿é…åˆ°é…ç½®æ–‡ä»¶é‡Œé¢ã€‚æ¯”å¦‚æŠŠæ•°æ®åº“çš„ä¸€äº›é“¾æ¥åœ°å€ã€è´¦å·ã€å¯†ç åŒ…æ‹¬æ•°æ®åº“è¿æ¥æ± çš„å¤§å°ç­‰ç­‰è¿™äº›å±æ€§é…åˆ°propertiesé…ç½®æ–‡ä»¶é‡Œé¢ï¼Œç„¶åä¸ºäº†æ–¹ä¾¿ , å› ä¸ºæˆ‘ä»¬æœªæ¥å¯èƒ½è¦åˆ›å»ºæ•°æ®åº“è¿æ¥æ± ï¼Œæˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹åˆä¸€ä¸€è§£æåˆ°æˆ‘ä»¬æ•°æ®åº“è¿æ¥æ± (æ¯”å¦‚javaBeanæˆ‘ä»¬è¿™ä¸ªå¯¹è±¡é‡Œé¢)ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªå®ç°åœºæ™¯å°±æ˜¯æŠŠpropertiesé‡Œé¢çš„æ‰€æœ‰é…ç½®ç»‘å®šJavaBeané‡Œé¢ã€‚</p><div class="tabs" id="a3219530-2c0b-448a-a9a1-4dc2982e356b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#a3219530-2c0b-448a-a9a1-4dc2982e356b-1"><i class="fas fa-cat"></i>JavaBean</button></li><li class="tab"><button type="button" data-href="#a3219530-2c0b-448a-a9a1-4dc2982e356b-2"><i class="fas fa-horse"></i>properties</button></li><li class="tab"><button type="button" data-href="#a3219530-2c0b-448a-a9a1-4dc2982e356b-3"><i class="fas fa-dove"></i>æ–¹å¼ä¸€</button></li><li class="tab"><button type="button" data-href="#a3219530-2c0b-448a-a9a1-4dc2982e356b-4"><i class="fas fa-dragon"></i>æ–¹å¼äºŒ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="a3219530-2c0b-448a-a9a1-4dc2982e356b-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrand</span><span class="params">()</span>&#123;<span class="keyword">return</span> brand;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBrand</span><span class="params">(String brand)</span>&#123;<span class="built_in">this</span>.brand = brand;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getPrice</span><span class="params">()</span>&#123;<span class="keyword">return</span> price;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(Integer price)</span>&#123;<span class="built_in">this</span>.price = price;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Car&#123;&quot;</span> + </span><br><span class="line">                <span class="string">&quot;brand = &quot;</span> + brand + <span class="string">&#x27;\&#x27;&#x27;</span> + </span><br><span class="line">                <span class="string">&quot;, price = &quot;</span> + price + </span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a3219530-2c0b-448a-a9a1-4dc2982e356b-2"><p>å‡è®¾æœ‰é…ç½®æ–‡ä»¶<code>application.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mycar.brand</span>=<span class="string">BYD</span></span><br><span class="line"><span class="attr">mycar.price</span>=<span class="string">100000</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a3219530-2c0b-448a-a9a1-4dc2982e356b-3"><p><mark class="hl-label green">@ConfigurationProperties+@Component</mark></p><p>è¿™ç§æ–¹å¼æ¯”è¾ƒé€‚ç”¨äºä¸€äº›è‡ªå®šä¹‰çš„é…ç½®</p><p>ç¼–å†™ä¸€ä¸ªéœ€è¦ç»‘å®šå±æ€§çš„Carç±»,ç„¶ååœ¨Carä¸Šä½¿ç”¨è¿™ä¸¤ä¸ªæ³¨è§£ï¼Œprefixçš„å€¼ä¸é…ç½®æ–‡ä»¶ä¸­çš„é¦–ä¸ªå€¼å¯¹åº”ï¼ˆå¯éšæ„å‘½åï¼‰ï¼›åªæœ‰å°†beanæ”¾å…¥åˆ°Springå®¹å™¨ä¸­ï¼Œæ‰èƒ½ä½¿ç”¨SpringBootçš„å¼ºå¤§å·¥ç¨‹ï¼Œå› ä¸ºå¿…é¡»è¦ä½¿ç”¨@Componentå°†å…¶æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a3219530-2c0b-448a-a9a1-4dc2982e356b-4"><p><mark class="hl-label blue">@ConfigurationProperties+@EnableConfigurationProperties</mark></p><p>è¿™ç§æ–¹å¼æ¯”è¾ƒé€‚ç”¨äºå¼•å…¥ç¬¬ä¸‰æ–¹ç»„ä»¶çš„æ—¶å€™ï¼Œå¦‚æœå¼•å…¥è¿™ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶å¹¶æ²¡æœ‰ä½¿ç”¨@Componentæ³¨è§£å°†å…¶æ³¨å…¥åˆ°å®¹å™¨ä¸­</p><p>è¿™ç§æ–¹å¼é€šå¸¸æ˜¯å€ŸåŠ©ä¸ä¸€ä¸ªé…ç½®ç±»æ¥å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(Car.class)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><hr><h2 id="2-è£…é…åŸç†">2. è£…é…åŸç†</h2><p>è‡ªåŠ¨è£…é…ï¼Œç®€å•æ¥è¯´å°±æ˜¯è‡ªåŠ¨æŠŠç¬¬ä¸‰æ–¹ç»„ä»¶çš„Beanè£…è½½åˆ°Spring IOCå™¨é‡Œé¢ï¼Œä¸éœ€è¦å¼€å‘äººå‘˜å†å»å†™Beançš„è£…é…é…ç½®ã€‚</p><p>åœ¨Spring Bootåº”ç”¨é‡Œé¢ï¼Œåªéœ€è¦åœ¨å¯åŠ¨ç±»åŠ ä¸Š<code>@SpringBootApplication</code>æ³¨è§£å°±å¯ä»¥å®ç°è‡ªåŠ¨è£…é…ã€‚<span class='p green'>@SpringBootApplicationæ˜¯ä¸€ä¸ªå¤åˆæ³¨è§£ï¼ŒçœŸæ­£å®ç°è‡ªåŠ¨è£…é…çš„æ³¨è§£æ˜¯ @EnableAutoConfigurationã€‚</span>è‡ªåŠ¨è£…é…çš„å®ç°ä¸»è¦ä¾é ä¸‰ä¸ªæ ¸å¿ƒå…³é”®æŠ€æœ¯ã€‚</p><ol><li><p>å¼•å…¥Starterå¯åŠ¨ä¾èµ–ç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªç»„ä»¶é‡Œé¢å¿…é¡»è¦åŒ…å«<code>@Configurationé…ç½®ç±»</code>ï¼Œåœ¨è¿™ä¸ªé…ç½®ç±»é‡Œé¢é€šè¿‡@Beanæ³¨è§£å£°æ˜éœ€è¦è£…é…åˆ°IOCå®¹å™¨çš„Beanå¯¹è±¡ã€‚</p></li><li><p>è¿™ä¸ªé…ç½®ç±»æ˜¯æ”¾åœ¨ç¬¬ä¸‰æ–¹çš„jaråŒ…é‡Œé¢ï¼Œç„¶åé€šè¿‡SpringBootä¸­çš„<code>çº¦å®šä¼˜äºé…ç½®æ€æƒ³</code>ï¼ŒæŠŠè¿™ä¸ªé…ç½®ç±»çš„å…¨è·¯å¾„æ”¾åœ¨<code>classpath:/META-INF/spring.factories</code>æ–‡ä»¶ä¸­ã€‚è¿™æ ·SpringBootå°±å¯ä»¥çŸ¥é“ç¬¬ä¸‰æ–¹jaråŒ…é‡Œé¢çš„é…ç½®ç±»çš„ä½ç½®ï¼Œè¿™ä¸ªæ­¥éª¤ä¸»è¦æ˜¯ç”¨åˆ°äº†Springé‡Œé¢çš„SpringFactoriesLoaderæ¥å®Œæˆçš„ã€‚</p></li><li><p>SpringBootæ‹¿åˆ°æ‰€ç¬¬ä¸‰æ–¹jaråŒ…é‡Œé¢å£°æ˜çš„é…ç½®ç±»ä»¥åï¼Œå†é€šè¿‡Springæä¾›çš„<code>ImportSelector</code>æ¥å£ï¼Œå®ç°å¯¹è¿™äº›é…ç½®ç±»çš„åŠ¨æ€åŠ è½½ã€‚</p></li></ol><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230501155237141.png" alt="image-20230501155237141" style="zoom:67%;" /><p><code>@SpringBootApplication</code>æ³¨è§£æ˜¯ <code>@SpringBootConfiguration</code>ã€<code>@EnableAutoConfiguration</code>ã€<code>@ComponentScan</code> æ³¨è§£çš„é›†åˆ</p><h3 id="2-1-SpringBootConfiguration">2.1 @SpringBootConfiguration</h3><p>ä»£è¡¨æ˜¯ä¸€ä¸ªé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br><span class="line"><span class="meta">@AliasFor(annotation = Configuration.class)</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">proxyBeanMethods</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-2-ComponentScan">2.2 @ComponentScan</h3><p>é»˜è®¤æ‰«æå½“å‰ç±»æ‰€åœ¨åŒ…åŠå…¶å­çº§åŒ…ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</p><p>åœ¨<code>ConfigurationClassParser#doProcessConfigurationClass</code>å¼€å§‹ComponentScan</p><p><code>Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =        this.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());</code></p><div class="tabs" id="657de342-5735-44c4-a46e-14abe8543c80"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#657de342-5735-44c4-a46e-14abe8543c80-1"><i class="fas fa-cat"></i>basePackagesè®¾ç½®</button></li><li class="tab"><button type="button" data-href="#657de342-5735-44c4-a46e-14abe8543c80-2"><i class="fas fa-horse"></i>æ‰«æä½ç½®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="657de342-5735-44c4-a46e-14abe8543c80-1"><p>æŸ¥çœ‹æºç <code>ComponentScanAnnotationParser#parse</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (basePackages.isEmpty()) &#123;</span><br><span class="line">basePackages.add(ClassUtils.getPackageName(declaringClass));</span><br><span class="line">&#125;</span><br><span class="line">  scanner.doScan(StringUtils.toStringArray(basePackages));</span><br></pre></td></tr></table></figure><p>basePackagesè®¾ç½®çš„æ­£æ˜¯å¯åŠ¨ç±»</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230501184021671.png" alt="image-20230501184021671" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="657de342-5735-44c4-a46e-14abe8543c80-2"><p>æŸ¥çœ‹æºç <code>ClassPathScanningCandidateComponentProvider#scanCandidateComponents</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">packageSearchPath</span> <span class="operator">=</span> ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +</span><br><span class="line">resolveBasePackage(basePackage) + <span class="string">&#x27;/&#x27;</span> + <span class="built_in">this</span>.resourcePattern;</span><br><span class="line">Resource[] resources = getResourcePatternResolver().getResources(packageSearchPath);</span><br></pre></td></tr></table></figure><p>packageSearchPathè¢«è®¾å®šä¸º<code>&quot;classpath*:com/atguigu/boot/**/*.class&quot;</code>ï¼Œå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>@ComponentScanå’Œ@EnableAutoConfigurationæ¯”è¾ƒ</p></blockquote><div class="tabs" id="7d3c7868-8dd3-400f-908b-d10e2e8e170b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7d3c7868-8dd3-400f-908b-d10e2e8e170b-1"><i class="fas fa-cat"></i>ä½œç”¨ä¸åŒ</button></li><li class="tab"><button type="button" data-href="#7d3c7868-8dd3-400f-908b-d10e2e8e170b-2"><i class="fas fa-horse"></i>æ‰«æèŒƒå›´ä¸åŒ</button></li><li class="tab"><button type="button" data-href="#7d3c7868-8dd3-400f-908b-d10e2e8e170b-3"><i class="fas fa-dove"></i>æ‰«æç›®çš„ä¸åŒ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7d3c7868-8dd3-400f-908b-d10e2e8e170b-1"><ul><li>@ComponentScanæ³¨è§£ç”¨äºæŒ‡å®šè¦æ‰«æçš„åŒ…åŠå…¶å­åŒ…ä¸­å¸¦æœ‰ç‰¹å®šæ³¨è§£çš„ç±»(@Controller,@Service,@Respority,@Component)ï¼Œå¹¶å°†è¿™äº›ç±»æ³¨å†Œåˆ°Springçš„IOCå®¹å™¨ä¸­ã€‚</li><li>@EnableAutoConfigurationæ³¨è§£ç”¨äºå¯ç”¨Spring Bootçš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œæ ¹æ®classpathä¸‹çš„jaråŒ…ã€é…ç½®æ–‡ä»¶ç­‰ä¿¡æ¯ï¼Œè‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºæ‰€éœ€çš„beanå’Œå…¶ä»–ç»„ä»¶ã€‚è€Œspring.factoriesæ–‡ä»¶ï¼Œåˆ™æ˜¯ç”¨æ¥è®°å½•é¡¹ç›®åŒ…å¤–éœ€è¦æ³¨å†Œçš„beanç±»åã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7d3c7868-8dd3-400f-908b-d10e2e8e170b-2"><ul><li>@ComponentScanæ³¨è§£åªæ‰«ææŒ‡å®šçš„åŒ…åŠå…¶å­åŒ…ä¸­å¸¦æœ‰ç‰¹å®šæ³¨è§£çš„ç±»ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚</li><li>@EnableAutoConfigurationæ³¨è§£ä¼šæ‰«æclasspathä¸‹çš„æ‰€æœ‰jaråŒ…ï¼Œå¹¶è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºæ‰€éœ€çš„beanå’Œå…¶ä»–ç»„ä»¶ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7d3c7868-8dd3-400f-908b-d10e2e8e170b-3"><ul><li>@ComponentScanæ³¨è§£çš„ç›®çš„æ˜¯å°†æŒ‡å®šçš„åŒ…åŠå…¶å­åŒ…ä¸­å¸¦æœ‰ç‰¹å®šæ³¨è§£çš„ç±»æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚</li><li>@EnableAutoConfigurationæ³¨è§£çš„ç›®çš„æ˜¯æ ¹æ®åº”ç”¨ç¨‹åºçš„classpathã€jaråŒ…å’Œé…ç½®æ–‡ä»¶ç­‰ä¿¡æ¯ï¼Œè‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºæ‰€éœ€çš„beanå’Œå…¶ä»–ç»„ä»¶ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="2-3-SPIæœºåˆ¶">2.3 SPIæœºåˆ¶</h3><p>SPIï¼šService Provider Interface</p><p>æœåŠ¡æä¾›è€…æ¥å£ï¼Œå­¦åä¸ºæœåŠ¡å‘ç°æœºåˆ¶ï¼Œå®ƒé€šè¿‡åœ¨ClassPathè·¯å¾„ä¸‹çš„<code>META-INF/services</code>æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨åŠ è½½æ–‡ä»¶é‡Œæ‰€å®šä¹‰çš„ç±»ã€‚</p><blockquote><p>æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿä¸ç”¨è¡Œä¸è¡Œï¼Ÿåˆ°åº•ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä½•è¢«å¹æ§çš„å¦‚æ­¤å‰å®³ï¼Ÿ</p></blockquote><mark class="hl-label blue">åˆ—ä¸¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šJavaä¸­è¿æ¥æ•°æ®åº“</mark> <div class="tabs" id="43c90029-eada-4f12-a525-da2ed38ed50b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#43c90029-eada-4f12-a525-da2ed38ed50b-1"><i class="fas fa-cat"></i>å­˜åœ¨é—®é¢˜</button></li><li class="tab"><button type="button" data-href="#43c90029-eada-4f12-a525-da2ed38ed50b-2"><i class="fas fa-horse"></i>è§£å†³æ–¹æ³•</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="43c90029-eada-4f12-a525-da2ed38ed50b-1"><p>åœ¨é¡¹ç›®ä¸­æˆ‘ä»¬é€šè¿‡JDBCï¼Œå‘æ•°æ®åº“å‘é€å‘½ä»¤å»æ‰§è¡Œï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ï¼Œå…ˆåŠ è½½æ•°æ®åº“é©±åŠ¨ï¼Œç„¶åé€šè¿‡driverManagerå¯¹è±¡è·å–connectionè¿æ¥å¯¹è±¡ï¼Œå†åˆ›å»ºStatementæ‰§è¡ŒSQLè¯­å¥ï¼Œæœ€åå†å¤„ç†ç»“æœé›†ã€‚è€Œä¸åŒçš„æ•°æ®åº“é©±åŠ¨ç”±ä¸åŒçš„æ•°æ®åº“å‚å•†æä¾›ï¼Œæ¯”å¦‚ MySQLé©±åŠ¨ï¼ŒOracleé©±åŠ¨ï¼Œ SQL Serveré©±åŠ¨æˆ–è€…ä¸€äº›å…¶å®ƒé©±åŠ¨ã€‚ä½†ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œjavaä¸­æä¾›çš„é©±åŠ¨æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œå…·ä½“çš„å®ç°ç±»æ˜¯ç”±å„ä¸ªæ•°æ®åº“å‚å•†æä¾›çš„ï¼Œè€Œæ¥å£æ˜¯ä¸å¯ä»¥è¿›è¡Œå®ä¾‹åŒ–çš„ï¼Œå½“ä½ è¦å®ä¾‹åŒ–ä¸€ä¸ªæ¥å£æ—¶å¿…é¡»å¾—çŸ¥é“è¿™ä¸ªæ¥å£çš„å…¨é™å®šåã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230501150254996.png" alt="image-20230501150254996" style="zoom: 60%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="43c90029-eada-4f12-a525-da2ed38ed50b-2"><p>å…¶å®éœ€è¦è§£å†³çš„æ ¹æœ¬é—®é¢˜æ˜¯ï¼šä½ å¾—å‘Šè¯‰æˆ‘è¿™ä¸ªæ¥å£å®ç°ç±»çš„å…¨é™å®šåï¼Œç„¶åå°±å¯ä»¥é€šè¿‡åå°„æˆ–è€…å…¶å®ƒçš„æ–¹å¼ï¼Œæ„é€ å‡ºè¿™ä¸ªæ¥å£çš„å®ä¾‹è¿›è€Œå°±å¯ä»¥è°ƒç”¨å…·ä½“çš„æ–¹æ³•ã€‚</p><p>äºæ˜¯ java å¼€å‘è€…ä»¬æƒ³äº†è¿™æ ·ä¸€ç§æ–¹æ³•ï¼Œåœ¨é¡¹ç›®ä¸‹çš„ ClassPathç›®å½•ä¸­åˆ›å»º<code>META-INF/services</code>æ–‡ä»¶,å¹¶åœ¨è¿™ä¸ªé‡Œé¢åˆ›å»ºä»¥æ¥å£åä¸ºæ–‡ä»¶åä»¥å®ç°ç±»å…¨é™å®šåä¸ºæ–‡ä»¶å†…å®¹çš„æ–‡ä»¶,ç„¶åå°±å¯ä»¥é€šè¿‡IOè·å–åˆ°æ‰€æœ‰çš„å…¨é™å®šåã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡IOè·å–åˆ°æ‰€æœ‰çš„å…¨é™å®šå</span></span><br><span class="line">List&lt;String&gt; calssNameList = IoUtil.spiLoad(Driver.class)ï¼›</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªå®¹å™¨å­˜å‚¨å®ä¾‹</span></span><br><span class="line">List&lt;Driver&gt; providers = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//å¾ªç¯éå†ï¼Œå°†classå®ä¾‹åŒ–ï¼Œå¹¶æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="keyword">for</span> (String className : calssNameList) &#123;</span><br><span class="line">    Class&lt;?&gt; c = Class.forName(className);</span><br><span class="line">    providers.add(c.newInstance());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230501151440654.png" alt="image-20230501151440654" style="zoom: 60%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>SPIè¿™ç§æ–¹å¼å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³ä¸åŒæ¡†æ¶ä¹‹é—´çš„æ‰©å±•é—®é¢˜ã€‚åœ¨<code>java.util.ServiceLoader#load(Class clazz)</code>å®Œæˆäº†spiçš„å®ç°ï¼Œå…·ä½“çš„æ€è·¯è·Ÿä¸Šè¿°æµç¨‹ç±»ä¼¼ã€‚</p><mark class="hl-label green">SPIçš„å˜ç§ï¼šSpringBootè‡ªåŠ¨è£…é…åŸç†</mark> <div class="tabs" id="d2bb1a0b-4b17-4fe7-a714-daafc0259d37"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#d2bb1a0b-4b17-4fe7-a714-daafc0259d37-1"><i class="fas fa-bug"></i>å­˜åœ¨é—®é¢˜</button></li><li class="tab"><button type="button" data-href="#d2bb1a0b-4b17-4fe7-a714-daafc0259d37-2"><i class="fas fa-cannabis"></i>è§£å†³æ–¹æ³•</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="d2bb1a0b-4b17-4fe7-a714-daafc0259d37-1"><p>åœ¨ä¸€ä¸ªSpringBooté¡¹ç›®ä¸­è‚¯å®šä¼šä¾èµ–ä¸€äº›å…¶å®ƒæ¡†æ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬ç†Ÿæ‚‰çš„mybatis-plusæ¡†æ¶è€ŒStringBooté»˜è®¤ä¼šå°†å½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹çš„beanæ³¨å…¥åˆ°iocä¸­ã€‚ä½†æ­¤æ—¶å¦‚æœå…¶å®ƒæ¡†æ¶éœ€è¦å°†beanæ³¨å…¥åˆ°iocä¸­ã€‚å› ä¸ºåŒ…åæ˜¯ä¸æƒ³åŒçš„ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡æ‰«ææ³¨å…¥ã€‚è€Œä¸”åœ¨æ³¨å…¥çš„è¿‡ç¨‹ä¸­ï¼Œè¦å’Œé¡¹ç›®å°½å¯èƒ½çš„è§£è€¦ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230501153354655.png" alt="image-20230501153354655" style="zoom: 67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d2bb1a0b-4b17-4fe7-a714-daafc0259d37-2"><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSpringBoot å‚è€ƒäº†spiæœºåˆ¶çš„è®¾è®¡æ€æƒ³ï¼šè§„å®šäº†åœ¨ classPathç›®å½•ä¸‹<code>META-INF</code>æ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰<code>spring.factories</code>çš„æ–‡ä»¶,åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ä¼šéå†æ‰€æœ‰jaråŒ…ä¸‹çš„<code>spring.factories</code>æ–‡ä»¶,è¿™æ ·å°±å¯ä»¥å°†spring.factoriesæ–‡ä»¶ä¸­å®šä¹‰çš„ç±»,åŠ è½½åˆ° ioc ä¸­ã€‚</p><div class="fj-gallery"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230501154019068.png" alt="image-20230501154019068" style="zoom:45%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230501154035913.png" alt="image-20230501154035913" style="zoom:45%;" />          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>æ€»ç»“</p><ol><li><p>SPIæœºåˆ¶èƒ½å¤Ÿä½¿æ¥å£ä¸å…·ä½“çš„å®ç°ç±»è§£è€¦ï¼Œå¯ä»¥æ ¹æ®å®é™…çš„ä¸šåŠ¡æƒ…å†µå¯ç”¨æˆ–æ›¿æ¢å…·ä½“ç»„ä»¶ã€‚</p></li><li><p>SPIæœºåˆ¶ä¸ºå¾ˆå¤šæ¡†æ¶çš„æ‰©å±•æä¾›äº†å¯èƒ½ã€‚</p></li><li><p>SPIæœºåˆ¶æ›´å¤šçš„æ˜¯ä¸€ç§æ€æƒ³ã€‚</p></li></ol><hr><h3 id="2-4-EnableAutoConfiguration">2.4 @EnableAutoConfiguration</h3><p>å¯ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="operator">=</span> <span class="string">&quot;spring.boot.enableautoconfiguration&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@EnableAutoConfiguration</code>æ³¨è§£æ˜¯ <code>@AutoConfigurationPackage</code>ã€<code>@Import(&#123;AutoConfigurationImportSelector.class&#125;)</code> æ³¨è§£çš„é›†åˆ</p><p><code>@AutoConfigurationPackage</code>æ³¨è§£çš„ä½œç”¨æ˜¯å°†ä½¿ç”¨äº†@SpringBootApplicationæ³¨è§£çš„ç±»æ‰€åœ¨çš„åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ä½¿ç”¨äº†@Configurationæ³¨è§£çš„ç±»éƒ½çº³å…¥åˆ°Spring Bootè‡ªåŠ¨é…ç½®çš„æ‰«æèŒƒå›´å†…ï¼Œä»è€Œè®©è¿™äº›ç±»çš„Beanå®šä¹‰èƒ½å¤Ÿè¢«è‡ªåŠ¨è£…é…ã€‚</p><p>è€Œ<code>@Import(AutoConfigurationImportSelector.class)</code>æ³¨è§£çš„ä½œç”¨åˆ™æ˜¯å°†Spring Booté»˜è®¤çš„è‡ªåŠ¨é…ç½®ç±»å¼•å…¥åˆ°IOCå®¹å™¨ä¸­ï¼Œè¿™äº›è‡ªåŠ¨é…ç½®ç±»éƒ½æ˜¯ä½¿ç”¨@Configurationæ³¨è§£æ ‡æ³¨çš„ï¼Œé€šè¿‡è‡ªåŠ¨æ‰«æå’Œæ¡ä»¶åŒ–é…ç½®çš„æ–¹å¼ï¼Œæ ¹æ®ç”¨æˆ·çš„é…ç½®å’Œç¯å¢ƒæ¥é€‰æ‹©æ€§åœ°å°†ç‰¹å®šçš„Beanå®šä¹‰æ³¨å…¥åˆ°IOCå®¹å™¨ä¸­ï¼Œä»¥æ»¡è¶³åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚</p><div class="tabs" id="a10aab32-5823-4cb0-a142-4f021b92d486"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#a10aab32-5823-4cb0-a142-4f021b92d486-1"><i class="fas fa-bug"></i>AutoConfigurationPackage</button></li><li class="tab"><button type="button" data-href="#a10aab32-5823-4cb0-a142-4f021b92d486-2"><i class="fas fa-cannabis"></i>â­ï¸Import({AutoConfigurationImportSelector.class})</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="a10aab32-5823-4cb0-a142-4f021b92d486-1"><p>æ ‡ç­¾åç›´è¯‘ä¸ºï¼šè‡ªåŠ¨é…ç½®åŒ…ï¼ŒæŒ‡å®šäº†é»˜è®¤çš„åŒ…è§„åˆ™ã€‚å°†æŒ‡å®šçš„åŒ…åæ³¨å†Œä¸ºSpring Bootè‡ªåŠ¨é…ç½®çš„åŸºæœ¬åŒ…ï¼Œä»è€Œä½¿Spring Bootè‡ªåŠ¨é…ç½®åŠŸèƒ½èƒ½å¤Ÿæ‰«æåˆ°è¿™ä¸ªåŒ…ä¸­çš„æ‰€æœ‰é…ç½®ç±»ã€‚</p><p>ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨é…ç½®åŒ…å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºSpring Bootè‡ªåŠ¨é…ç½®æœºåˆ¶æ˜¯é€šè¿‡åœ¨è‡ªåŠ¨é…ç½®åŒ…åŠå…¶å­åŒ…ä¸­æŸ¥æ‰¾æ ‡æ³¨äº†@Configurationæ³¨è§£çš„ç±»ï¼Œå¹¶è§£æå…¶ä¸­çš„@Beanæ³¨è§£æ¥å®ç°çš„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè‡ªåŠ¨é…ç½®åŒ…ï¼ŒSpring Bootå°±æ— æ³•ç¡®å®šåº”è¯¥åœ¨å“ªäº›åŒ…ä¸­æŸ¥æ‰¾è‡ªåŠ¨é…ç½®ç±»ã€‚è€ŒæŒ‡å®šè‡ªåŠ¨é…ç½®åŒ…ï¼Œå°±å¯ä»¥è®©Spring Bootè‡ªåŠ¨æ‰«ææŒ‡å®šåŒ…åŠå…¶å­åŒ…ä¸­çš„æ‰€æœ‰é…ç½®ç±»ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œæ¡ä»¶åŒ–è£…é…ï¼Œä»è€Œå®ç°è‡ªåŠ¨é…ç½®çš„åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(AutoConfigurationPackages.Registrar.class)</span><span class="comment">// åˆ©ç”¨ Registrar ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123; </span><br><span class="line">String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;?&gt;[] basePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Registrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span>, DeterminableImports &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">register(registry, <span class="keyword">new</span> <span class="title class_">PackageImports</span>(metadata).getPackageNames().toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title function_">determineImports</span><span class="params">(AnnotationMetadata metadata)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> <span class="title class_">PackageImports</span>(metadata));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230430162512630.png" alt="image-20230430162512630" style="zoom: 50%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(BeanDefinitionRegistry registry, String... packageNames)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">BEAN</span> <span class="operator">=</span> AutoConfigurationPackages.class.getName();</span><br><span class="line">    <span class="keyword">if</span> (registry.containsBeanDefinition(BEAN)) &#123;</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> registry.getBeanDefinition(BEAN);</span><br><span class="line">        <span class="type">ConstructorArgumentValues</span> <span class="variable">constructorArguments</span> <span class="operator">=</span> beanDefinition.getConstructorArgumentValues();</span><br><span class="line">        constructorArguments.addIndexedArgumentValue(<span class="number">0</span>, addBasePackages(constructorArguments, packageNames));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">GenericBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericBeanDefinition</span>();</span><br><span class="line">        beanDefinition.setBeanClass(AutoConfigurationPackages.BasePackages.class);</span><br><span class="line">        beanDefinition.getConstructorArgumentValues().addIndexedArgumentValue(<span class="number">0</span>, packageNames);</span><br><span class="line">        beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">        registry.registerBeanDefinition(BEAN, beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ‰“æ–­ç‚¹å¾—çŸ¥ï¼Œ<code>packageNames</code>ä¼ çš„å°±æ˜¯å¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…åï¼Œç„¶åè¿™ä¸ªæ–¹æ³•å°±æ˜¯åˆ¤æ–­å®¹å™¨æ˜¯å¦æ³¨å…¥äº†<code>BasePackagesBeanDefinition</code>ã€‚å¦‚æœæ³¨å…¥äº†å°±ä»å®¹å™¨è·å–ï¼Œå¹¶å°†åŒ…åèµ‹å€¼ç»™ä»–çš„<code>basePackages</code>å±æ€§ï¼Œç„¶åæ‰§è¡Œè¿™å—çš„æ—¶å€™å…¶å®æ˜¯å¹¶æ²¡æœ‰æ³¨å†Œçš„ï¼Œæ‰€ä»¥ç›´æ¥æ‰§è¡Œelseã€‚elseå°±æ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ª<code>BasePackagesBeanDefinition</code>å¯¹è±¡ï¼Œç„¶åå°†åŒ…åèµ‹å€¼ç»™ä»–çš„<code>basePackages</code>å±æ€§ã€‚</p><p><code>basePackages</code>æ˜¯ä¸ªseté›†åˆï¼Œä½†æ˜¯å®¹å™¨å½“ä¸­å§‹ç»ˆåªæœ‰ä¸€ä¸ª<code>BasePackagesBeanDefinition</code>å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯åªè¦ä»£ç å½“ä¸­æ·»åŠ <code>@AutoConfigurationPackage</code>æ³¨è§£ï¼Œå°±ä¼šå°†æ³¨è§£æ‰€åœ¨çš„åŒ…åæ·»åŠ åˆ°<code>basePackages</code>é›†åˆå½“ä¸­ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a10aab32-5823-4cb0-a142-4f021b92d486-2"><p>AutoConfigurationImportSelectorç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶</span></span><br><span class="line">    <span class="type">AutoConfigurationEntry</span> <span class="variable">autoConfigurationEntry</span> <span class="operator">=</span> getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">    <span class="keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationEntry <span class="title function_">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœè‡ªåŠ¨é…ç½®æ²¡æœ‰å¯ç”¨ï¼Œåˆ™è¿”å›ç©ºçš„AutoConfigurationEntryå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–æ³¨è§£å±æ€§</span></span><br><span class="line">    <span class="type">AnnotationAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> getAttributes(annotationMetadata);</span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¹¶å»é™¤é‡å¤</span></span><br><span class="line">    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">    configurations = removeDuplicates(configurations);</span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰æ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨é‡å¤</span></span><br><span class="line">    Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);</span><br><span class="line">    checkExcludedClasses(configurations, exclusions);</span><br><span class="line">    <span class="comment">// ä»å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ä¸­ç§»é™¤æ‰€æœ‰æ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¹¶è¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">    configurations.removeAll(exclusions);</span><br><span class="line">    configurations = getConfigurationClassFilter().filter(configurations);</span><br><span class="line">    <span class="comment">// è§¦å‘è‡ªåŠ¨é…ç½®å¯¼å…¥äº‹ä»¶ï¼Œé€šçŸ¥æ‰€æœ‰è‡ªåŠ¨é…ç½®å¯¼å…¥ç›‘å¬å™¨è‡ªåŠ¨é…ç½®çš„æƒ…å†µ</span></span><br><span class="line">    fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªAutoConfigurationEntryå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«åº”ç”¨çš„è‡ªåŠ¨é…ç½®ç±»å’Œæ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AutoConfigurationEntry</span>(configurations, exclusions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ã€åˆ©ç”¨<code>getAutoConfigurationEntry(annotationMetadata);</code>ç»™å®¹å™¨ä¸­æ‰¹é‡å¯¼å…¥ä¸€äº›ç»„ä»¶<br>2ã€è°ƒç”¨<code>List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes)</code>è·å–åˆ°æ‰€æœ‰éœ€è¦å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„é…ç½®ç±»<br>3ã€åˆ©ç”¨å·¥å‚åŠ è½½ <code>Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(@Nullable ClassLoader classLoader)ï¼›</code>å¾—åˆ°æ‰€æœ‰çš„ç»„ä»¶<br>4ã€ä»<code>META-INF/spring.factories</code>ä½ç½®æ¥åŠ è½½ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>é»˜è®¤æ‰«æjaråŒ…é‡Œé¢æ‰€æœ‰META-INF/spring.factoriesä½ç½®çš„æ–‡ä»¶</p><p>spring-boot-autoconfigure-2.3.4.RELEASE.jaråŒ…é‡Œé¢ä¹Ÿæœ‰META-INF/spring.factoriesï¼Œæ–‡ä»¶é‡Œé¢å†™æ­»äº†spring-bootä¸€å¯åŠ¨å°±è¦ç»™å®¹å™¨ä¸­åŠ è½½çš„æ‰€æœ‰é…ç½®ç±»</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/SpringBoot-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" style="zoom:50%;" /><blockquote><p>ç­›é€‰å‰size=130 vsç­›é€‰åsize=26</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230430172712413.png" alt="image-20230430172712413" style="zoom: 25%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230430172756327.png" alt="image-20230430172756327" style="zoom: 25%;" /><p>è™½ç„¶æˆ‘ä»¬127ä¸ªåœºæ™¯çš„æ‰€æœ‰è‡ªåŠ¨é…ç½®å¯åŠ¨çš„æ—¶å€™é»˜è®¤å…¨éƒ¨åŠ è½½ã€‚xxxxAutoConfiguration<br>æŒ‰ç…§æ¡ä»¶è£…é…è§„åˆ™ï¼ˆ@Conditionalï¼‰ï¼Œæœ€ç»ˆä¼šæŒ‰éœ€é…ç½®ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230430174625456.png" alt="image-20230430174625456" style="zoom:50%;" /><ul><li></li></ul><p>ä»¥DispatcherServletAutoConfigurationä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span> <span class="comment">// æŒ‡å®šè¯¥è‡ªåŠ¨é…ç½®ç±»çš„é¡ºåºï¼Œä¼˜å…ˆçº§æœ€é«˜</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span> <span class="comment">// å£°æ˜è¯¥ç±»æ˜¯ä¸€ä¸ªSpringé…ç½®ç±»ï¼Œä¸ä½¿ç”¨ä»£ç†beançš„æ–¹å¼</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)</span> <span class="comment">// ä»…åœ¨Webåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DispatcherServlet.class)</span> <span class="comment">// ä»…å½“ç±»è·¯å¾„ä¸­å­˜åœ¨æŒ‡å®šçš„ç±»DispatcherServletæ—¶æ‰åº”ç”¨æ­¤é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(ServletWebServerFactoryAutoConfiguration.class)</span> <span class="comment">// åœ¨ServletWebServerFactoryAutoConfigurationè‡ªåŠ¨é…ç½®ä¹‹ååº”ç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServletAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">    <span class="meta">@Conditional(org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration.DefaultDispatcherServletCondition.class)</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(ServletRegistration.class)</span></span><br><span class="line">    <span class="meta">@EnableConfigurationProperties(WebMvcProperties.class)</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DispatcherServletConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean(name = &quot;dispatcherServlet&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> DispatcherServlet <span class="title function_">dispatcherServlet</span><span class="params">(WebMvcProperties webMvcProperties)</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ªDispatcherServletå¯¹è±¡</span></span><br><span class="line">            <span class="type">DispatcherServlet</span> <span class="variable">dispatcherServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DispatcherServlet</span>();</span><br><span class="line">            <span class="comment">// é…ç½®DispatcherServletå±æ€§</span></span><br><span class="line">            dispatcherServlet.setDispatchOptionsRequest(webMvcProperties.isDispatchOptionsRequest());</span><br><span class="line">            dispatcherServlet.setDispatchTraceRequest(webMvcProperties.isDispatchTraceRequest());</span><br><span class="line">            dispatcherServlet.setThrowExceptionIfNoHandlerFound(webMvcProperties.isThrowExceptionIfNoHandlerFound());</span><br><span class="line">            dispatcherServlet.setPublishEvents(webMvcProperties.isPublishRequestHandledEvents());</span><br><span class="line">            dispatcherServlet.setEnableLoggingRequestDetails(webMvcProperties.isLogRequestDetails());</span><br><span class="line">            <span class="keyword">return</span> dispatcherServlet; <span class="comment">// è¿”å›DispatcherServletå¯¹è±¡</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@ConditionalOnBean(MultipartResolver.class)</span> <span class="comment">// å®¹å™¨ä¸­æœ‰è¿™ä¸ªç±»å‹çš„ç»„ä»¶</span></span><br><span class="line">        <span class="meta">@ConditionalOnMissingBean(name = &quot;multipartResolver&quot;)</span> <span class="comment">//å®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªåå­—multipartResolverçš„ç»„ä»¶  </span></span><br><span class="line">        <span class="keyword">public</span> MultipartResolver <span class="title function_">multipartResolver</span><span class="params">(MultipartResolver resolver)</span> &#123;</span><br><span class="line">            <span class="comment">// å½“å®¹å™¨ä¸­å­˜åœ¨MultipartResolverå¯¹è±¡ä¸”æ²¡æœ‰æŒ‡å®šåå­—ä¸ºDispatcherServlet.MULTIPART_RESOLVER_BEAN_NAMEæ—¶ï¼Œè¿”å›è¯¥å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// ä¸»è¦ç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦å·²åˆ›å»ºä¸€ä¸ªMultipartResolverä½†åç§°ä¸æ­£ç¡®</span></span><br><span class="line">            <span class="keyword">return</span> resolver;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>SpringBooté»˜è®¤ä¼šåœ¨åº•å±‚é…å¥½æ‰€æœ‰çš„ç»„ä»¶ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·è‡ªå·±é…ç½®äº†ä»¥ç”¨æˆ·çš„ä¼˜å…ˆ</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>Spring Boot é€šè¿‡ <code>@EnableAutoConfiguration</code> å¼€å¯è‡ªåŠ¨è£…é…ï¼Œé€šè¿‡ SpringFactoriesLoader åŠ è½½ <code>META-INF/spring.factories</code> ä¸­çš„è‡ªåŠ¨é…ç½®ç±»å®ç°è‡ªåŠ¨è£…é…ï¼Œè‡ªåŠ¨é…ç½®ç±»å…¶å®å°±æ˜¯é€šè¿‡ <code>@Conditional</code> æ³¨è§£æŒ‰éœ€åŠ è½½çš„é…ç½®ç±»ï¼Œæƒ³è¦å…¶ç”Ÿæ•ˆå¿…é¡»å¼•å…¥ <code>spring-boot-starter-xxx</code> åŒ…å®ç°èµ·æ­¥ä¾èµ–</p><ul><li>SpringBoot å…ˆåŠ è½½æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±» xxxxxAutoConfiguration</li><li>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»è¿›è¡Œæ¡ä»¶è£…é…ï¼Œé»˜è®¤éƒ½ä¼šç»‘å®šé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼ˆxxxProperties å’Œé…ç½®æ–‡ä»¶è¿›è¡Œäº†ç»‘å®šï¼‰</li><li>SpringBoot é»˜è®¤ä¼šåœ¨åº•å±‚é…å¥½æ‰€æœ‰çš„ç»„ä»¶ï¼Œå¦‚æœç”¨æˆ·è‡ªå·±é…ç½®äº†ä»¥ç”¨æˆ·çš„ä¼˜å…ˆ</li><li>å®šåˆ¶åŒ–é…ç½®ï¼š<ul><li>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ @Bean æ–°å»ºè‡ªå·±çš„ç»„ä»¶æ¥æ›¿æ¢åº•å±‚çš„ç»„ä»¶</li><li>ç”¨æˆ·å¯ä»¥å»çœ‹è¿™ä¸ªç»„ä»¶æ˜¯è·å–çš„é…ç½®æ–‡ä»¶å‰ç¼€å€¼ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹</li></ul></li></ul><blockquote><p>å¦‚ä½•æŸ¥çœ‹è‡ªåŠ¨é…ç½®äº†å“ªäº›</p></blockquote><p>application.propertiesä¸­debug=trueå¼€å¯è‡ªåŠ¨é…ç½®æŠ¥å‘Šã€‚å¯ä»¥æ˜¾ç¤ºå“ªäº›ç”Ÿæ•ˆå“ªäº›æ²¡ç”Ÿæ•ˆ Negativeä¸ç”Ÿæ•ˆ\Positiveç”Ÿæ•ˆ</p><hr><hr><h2 id="3-å¯åŠ¨æµç¨‹">3. å¯åŠ¨æµç¨‹</h2><p>å¦‚æœæƒ³debugæŸ¥çœ‹SpringBootè‡ªåŠ¨è£…é…çš„æµç¨‹ï¼Œå¯ä»¥åœ¨ä¸‹é¢æ–¹æ³•æ‰“ä¸Šæ–­ç‚¹</p><blockquote><ul><li><p>SpringApplication#refreshContext(context);</p></li><li><p>AbstractApplicationContext#invokeBeanFactoryPostProcessors(beanFactory);</p></li><li><p>PostProcessorRegistrationDelegate#invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</p></li><li><p>ConfigurationClassPostProcessor#processConfigBeanDefinitions(BeanDefinitionRegistry registry);</p><ul><li>parser.parse(candidates);<ul><li>this.deferredImportSelectorHandler.process();<ul><li>handler.processGroupImports(); è§£æAutoConfigurationImportSelector.class</li></ul></li></ul></li><li>this.reader.loadBeanDefinitions(configClasses);</li></ul></li></ul></blockquote><p>åº”ç”¨å¯åŠ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BootApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å¯åŠ¨ä»£ç </span></span><br><span class="line">        SpringApplication.run(BootApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>SpringApplication æ„é€ æ–¹æ³•</code></p><ul><li><p><code>this.resourceLoader = resourceLoader</code>ï¼šèµ„æºåŠ è½½å™¨ï¼Œåˆå§‹ä¸º null</p></li><li><p><code>this.webApplicationType = WebApplicationType.deduceFromClasspath()</code>ï¼šåˆ¤æ–­å½“å‰åº”ç”¨çš„ç±»å‹ï¼Œæ˜¯å“åº”å¼è¿˜æ˜¯ Web ç±»</p></li><li><p><code>setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));</code></p><ul><li><p><code>Set&lt;String&gt; names = new LinkedHashSet&lt;&gt;(SpringFactoriesLoader.loadFactoryNames(type, classLoader));</code></p></li><li><p>å¯¼å…¥<code>META-INF/spring.factories</code> ï¼Œå¹¶å­˜å…¥ç¼“å­˜ï¼Œä¸‹é¢ä¼šç”¨åˆ°</p></li></ul></li></ul><p><code>(new SpringApplication(primarySources)).run(args)</code></p><div class="tabs" id="9e15277e-9f6e-4253-b9c1-05e40b94a476"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#9e15277e-9f6e-4253-b9c1-05e40b94a476-1"><i class="fas fa-cannabis"></i>1</button></li><li class="tab"><button type="button" data-href="#9e15277e-9f6e-4253-b9c1-05e40b94a476-2"><i class="fas fa-leaf"></i>2</button></li><li class="tab"><button type="button" data-href="#9e15277e-9f6e-4253-b9c1-05e40b94a476-3"><i class="fas fa-tree"></i>4</button></li><li class="tab"><button type="button" data-href="#9e15277e-9f6e-4253-b9c1-05e40b94a476-4"><i class="fas fa-cookie-bite"></i>5â­ï¸</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="9e15277e-9f6e-4253-b9c1-05e40b94a476-1"><p><mark class="hl-label blue">SpringApplication#runæ–¹æ³•</mark></p><p>åˆ›å»º IOC å®¹å™¨å¹¶å®ç°äº†è‡ªåŠ¨è£…é…</p><ul><li><p><code>StopWatch stopWatch = new StopWatch()</code>ï¼šåœæ­¢ç›‘å¬å™¨ï¼Œ<span class='p green'>ç›‘æ§æ•´ä¸ªåº”ç”¨çš„å¯åœ</span></p></li><li><p><code>stopWatch.start()</code>ï¼šè®°å½•åº”ç”¨çš„å¯åŠ¨æ—¶é—´</p></li><li><p><code>printedBanner = printBanner(environment)</code>ï¼šæ‰“å° SpringBoot æ ‡å¿—</p></li><li><p><code>context = createApplicationContext()</code>ï¼š<span class='p red'>åˆ›å»º IOC å®¹å™¨</span></p><p><code>switch (this.webApplicationType)</code>ï¼šæ ¹æ®å½“å‰åº”ç”¨çš„ç±»å‹åˆ›å»º IOC å®¹å™¨</p><ul><li><code>case SERVLET</code>ï¼šWeb åº”ç”¨ç¯å¢ƒå¯¹åº” AnnotationConfigServletWebServerApplicationContext</li><li><code>case REACTIVE</code>ï¼šå“åº”å¼ç¼–ç¨‹å¯¹åº” AnnotationConfigReactiveWebServerApplicationContext</li><li><code>default</code>ï¼šé»˜è®¤ä¸º Spring ç¯å¢ƒ AnnotationConfigApplicationContext</li></ul></li><li><p><code>context.setApplicationStartup(this.applicationStartup)</code>ï¼šè®¾ç½®ä¸€ä¸ªå¯åŠ¨å™¨</p></li><li><p><code>prepareContext()</code>ï¼š<span class='p green'>é…ç½® IOC å®¹å™¨çš„åŸºæœ¬ä¿¡æ¯</span></p><ul><li><code>beanFactory.registerSingleton(&quot;springBootBanner&quot;, printedBanner);</code>ï¼šå‘å•ä¾‹æ± ä¸­æ·»åŠ springBootBanner</li><li><code>load(context, sources.toArray(new Object[0]));</code>ï¼šå‘beanDefinitionMapæ·»åŠ å¯åŠ¨ç±»</li></ul></li><li><p><code>refreshContext(context)</code>ï¼š<span class='p green'>åˆ·æ–° IOC å®¹å™¨ï¼ŒSpring çš„å®¹å™¨å¯åŠ¨æµç¨‹</span></p><ul><li><p><code>refresh(context);</code></p><ul><li><p><code>prepareRefresh();</code>ï¼šå‡†å¤‡åˆ·æ–°åº”ç”¨ä¸Šä¸‹æ–‡</p></li><li><p><code>prepareBeanFactory(beanFactory);</code>ï¼šè®¾ç½®ä¸€äº›BeanClassLoaderå’ŒBeanPostProcessor</p></li><li><p><code>invokeBeanFactoryPostProcessors(beanFactory)</code>ï¼šå®ä¾‹åŒ–å¹¶è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„BeanFactoryPostProcessor beanï¼Œå¦‚æœç»™å®šï¼Œåˆ™éµå¾ªæ˜¾å¼é¡ºåºã€‚<span class='p red'>åœ¨æ­¤å¤„å®ç°äº†è‡ªåŠ¨è£…é…</span>  <mark class="hl-label green">è¯¦è§2</mark></p></li><li><p><code>registerBeanPostProcessors(beanFactory);</code>ï¼šå‘å®¹å™¨ä¸­æ·»åŠ BeanPostProcessor</p></li><li><p>â€¦</p></li></ul></li></ul></li><li><p><code>afterRefresh(context, applicationArguments)</code>ï¼šç•™ç»™ç”¨æˆ·è‡ªå®šä¹‰å®¹å™¨åˆ·æ–°å®Œæˆåçš„å¤„ç†é€»è¾‘</p></li><li><p><code>stopWatch.stop()</code>ï¼šè®°å½•åº”ç”¨å¯åŠ¨å®Œæˆçš„æ—¶é—´</p></li><li><p><code>listeners.started(context)</code>ï¼šæ‰€æœ‰çš„è¿è¡Œç›‘å¬å™¨è°ƒç”¨ started() æ–¹æ³•</p></li><li><p><code>listeners.running(context)</code>ï¼šæ‰€æœ‰çš„è¿è¡Œç›‘å¬å™¨è°ƒç”¨ running() æ–¹æ³•</p><ul><li>è·å–å®¹å™¨ä¸­çš„ ApplicationRunnerã€CommandLineRunner</li><li><code>AnnotationAwareOrderComparator.sort(runners)</code>ï¼šåˆå¹¶æ‰€æœ‰ runner å¹¶ä¸”æŒ‰ç…§ @Order è¿›è¡Œæ’åº</li><li><code>callRunner()</code>ï¼šéå†æ‰€æœ‰çš„ runnerï¼Œè°ƒç”¨ run æ–¹æ³•</li></ul></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9e15277e-9f6e-4253-b9c1-05e40b94a476-2"><p><mark class="hl-label blue">PostProcessorRegistrationDelegate#invokeBeanFactoryPostProcessorsæ–¹æ³•</mark></p><p>//åˆ†ä¸ºä¸¤ç±»</p><ul><li><code>List&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = new ArrayList&lt;&gt;();</code></li><li><code>List&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = new ArrayList&lt;&gt;();</code></li></ul><br/><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå†æ‰€æœ‰çš„ BeanFactoryPostProcessor</span></span><br><span class="line"><span class="keyword">for</span> (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸º BeanDefinitionRegistryPostProcessor ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (postProcessor <span class="keyword">instanceof</span> BeanDefinitionRegistryPostProcessor) &#123;</span><br><span class="line">        <span class="comment">// å°†å½“å‰çš„ BeanFactoryPostProcessor è½¬æ¢ä¸º BeanDefinitionRegistryPostProcessor</span></span><br><span class="line">        <span class="type">BeanDefinitionRegistryPostProcessor</span> <span class="variable">registryProcessor</span> <span class="operator">=</span></span><br><span class="line">            (BeanDefinitionRegistryPostProcessor) postProcessor;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ BeanDefinitionRegistryPostProcessor çš„æ–¹æ³•å¯¹ BeanDefinitionRegistry è¿›è¡Œå¤„ç†</span></span><br><span class="line">        registryProcessor.postProcessBeanDefinitionRegistry(registry);</span><br><span class="line">        <span class="comment">// å°†å¤„ç†åçš„ BeanDefinitionRegistryPostProcessor æ·»åŠ åˆ° registryProcessors é›†åˆä¸­</span></span><br><span class="line">        registryProcessors.add(registryProcessor);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å°†æ™®é€šçš„ BeanFactoryPostProcessor æ·»åŠ åˆ° regularPostProcessors é›†åˆä¸­</span></span><br><span class="line">        regularPostProcessors.add(postProcessor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>// First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered.</p><ul><li><p><code>invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</code></p><ul><li><p><code>currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));</code><span class='p red'>getBeanæ–¹æ³•å®ä¾‹åŒ–BeanDefinitionRegistryPostProcessor</span></p></li><li><p><code>invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</code></p><ul><li><span class='p red'>ConfigurationClassPostProcessoræ‰§è¡Œ</span> <mark class="hl-label green">è·³è½¬åˆ°4</mark></li></ul></li></ul></li></ul><p>// Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered.</p><p>// Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear.</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9e15277e-9f6e-4253-b9c1-05e40b94a476-3"><p><mark class="hl-label blue">ConfigurationClassPostProcessor</mark></p><p>ç”¨æ¥è§£æé…ç½®ç±»ï¼Œå¦‚æœç±»ä¸Šé¢åŠ å…¥äº†@Configurationï¼Œ@CompentScanç­‰ï¼Œå®ƒå°±ä¼šä½ çš„è¿™äº›é…ç½®è§£æå‡ºæ¥</p><p>è§£æå¤„ç†@PropertySource æ³¨è§£<br>è§£æ@ComponentScanæ³¨è§£,æ‰«æ@Configurationã€@Serviceã€@Controllerã€@Repositoryå’Œ@Componentæ³¨è§£å¹¶æ³¨å†ŒBeanDefinition<br>è§£æ@Importæ³¨è§£,ç„¶åè¿›è¡Œå®ä¾‹åŒ–,å¹¶æ‰§è¡ŒImportBeanDefinitionRegistrarçš„registerBeanDefinitionsé€»è¾‘,æˆ–è€…ImportSelectorçš„selectImportsé€»è¾‘<br>è§£æ@ImportResourceæ³¨è§£,å¹¶åŠ è½½ç›¸å…³é…ç½®ä¿¡æ¯<br>è§£ææ–¹æ³•çº§åˆ«@Beanæ³¨è§£å¹¶å°†è¿”å›å€¼æ³¨å†ŒæˆBeanDefinition<br>æ³¨å†ŒImportRegistryåˆ°å®¹å™¨ä¸­,ç”¨äºå¤„ç†ImportAware</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">List&lt;BeanDefinitionHolder&gt; configCandidates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//è·å–bdmapæ‰€æœ‰çš„beanName</span></span><br><span class="line">String[] candidateNames = registry.getBeanDefinitionNames();</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æ‰€æœ‰å€™é€‰çš„ bean åç§°</span></span><br><span class="line"><span class="keyword">for</span> (String beanName : candidateNames) &#123;</span><br><span class="line">    <span class="comment">// è·å–è¯¥ bean çš„ BeanDefinition å¯¹è±¡</span></span><br><span class="line">    <span class="type">BeanDefinition</span> <span class="variable">beanDef</span> <span class="operator">=</span> registry.getBeanDefinition(beanName);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­è¯¥ bean æ˜¯å¦å·²è¢«æ ‡è®°ä¸ºé…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">if</span> (beanDef.getAttribute(ConfigurationClassUtils.CONFIGURATION_CLASS_ATTRIBUTE) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå·²è¢«æ ‡è®°ï¼Œåˆ™åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è®°å½•æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;Bean definition has already been processed as a configuration class: &quot;</span> + beanDef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(beanDef, <span class="built_in">this</span>.metadataReaderFactory)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¯¥ bean æ»¡è¶³é…ç½®ç±»çš„å€™é€‰æ¡ä»¶ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°é…ç½®ç±»çš„å€™é€‰é›†åˆä¸­</span></span><br><span class="line">        configCandidates.add(<span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(beanDef, beanName));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­é€»è¾‘ï¼šcheckConfigurationClassCandidateï¼Œåˆ¤æ–­å®Œæˆååªæœ‰å¯åŠ¨ç±»è¢«åŠ å…¥åˆ°äº†configCandidatesé›†åˆä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»metadataä¸­è·å–Confugurationæ³¨è§£</span></span><br><span class="line">Map&lt;String, Object&gt; config = metadata.getAnnotationAttributes(Configuration.class.getName());</span><br><span class="line"><span class="comment">// æ ¹æ®metadataä¸­çš„æ³¨è§£åˆ¤æ–­æ˜¯fullåŒ¹é…è¿˜æ˜¯liteåŒ¹é…ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (config != <span class="literal">null</span> &amp;&amp; !Boolean.FALSE.equals(config.get(<span class="string">&quot;proxyBeanMethods&quot;</span>))) &#123;</span><br><span class="line">    beanDef.setAttribute(CONFIGURATION_CLASS_ATTRIBUTE, CONFIGURATION_CLASS_FULL);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (config != <span class="literal">null</span> || isConfigurationCandidate(metadata)) &#123;</span><br><span class="line">    beanDef.setAttribute(CONFIGURATION_CLASS_ATTRIBUTE, CONFIGURATION_CLASS_LITE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®ç±»è§£æçš„æ ¸å¿ƒä»£ç ï¼šéå†å€™é€‰çš„ <code>BeanDefinition</code> å¯¹è±¡æ¥è§£æ <code>@Configuration</code> ç±»ï¼Œä»è€Œç”Ÿæˆå¯¹åº”çš„ <code>BeanDefinition</code> å¯¹è±¡ã€‚åœ¨è§£æå®Œä¸€æ‰¹å€™é€‰çš„ <code>@Configuration</code> ç±»ä¹‹åï¼Œä¼šæ£€æŸ¥å®¹å™¨ä¸­æ˜¯å¦è¿˜æœ‰æ–°çš„å€™é€‰ <code>@Configuration</code> ç±»éœ€è¦è§£æï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¼šç»§ç»­å¯¹æ–°çš„å€™é€‰ <code>@Configuration</code> ç±»è¿›è¡Œè§£æï¼Œç›´åˆ°å®¹å™¨ä¸­æ²¡æœ‰æ–°çš„å€™é€‰ <code>@Configuration</code> ç±»ä¸ºæ­¢ã€‚æœ€ç»ˆï¼Œå®¹å™¨ä¸­çš„æ‰€æœ‰ <code>@Configuration</code> ç±»éƒ½ä¼šè¢«è§£æå¹¶è½¬æ¢ä¸ºå¯¹åº”çš„ <code>BeanDefinition</code> å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å€™é€‰BeanDefinitionçš„è§£æå™¨</span></span><br><span class="line"><span class="type">ConfigurationClassParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationClassParser</span>(</span><br><span class="line">        <span class="built_in">this</span>.metadataReaderFactory, <span class="built_in">this</span>.problemReporter, <span class="built_in">this</span>.environment,</span><br><span class="line">        <span class="built_in">this</span>.resourceLoader, <span class="built_in">this</span>.componentScanBeanNameGenerator, registry);</span><br><span class="line"><span class="comment">// éœ€è¦è§£æçš„BeanDefinitionHolderå®¹å™¨ï¼Œåˆå§‹å€¼ä¸ºconfigCandidates</span></span><br><span class="line">Set&lt;BeanDefinitionHolder&gt; candidates = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(configCandidates);</span><br><span class="line"><span class="comment">// å·²ç»è§£æè¿‡çš„ConfigurationClasså®¹å™¨</span></span><br><span class="line">Set&lt;ConfigurationClass&gt; alreadyParsed = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(configCandidates.size());</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// è§£æå€™é€‰BeanDefinitionä¸­çš„@Configurationç±»</span></span><br><span class="line">    parser.parse(candidates);</span><br><span class="line">    <span class="comment">// éªŒè¯@Configurationç±»çš„ä¾èµ–å…³ç³»å’Œé‡å¤å¯¼å…¥</span></span><br><span class="line">    parser.validate();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰è¢«è§£æçš„@Configurationç±»</span></span><br><span class="line">    Set&lt;ConfigurationClass&gt; configClasses = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(parser.getConfigurationClasses());</span><br><span class="line">    <span class="comment">// ä»è§£æè¿‡çš„@Configurationç±»ä¸­å‰”é™¤å·²ç»è¢«å¤„ç†è¿‡çš„</span></span><br><span class="line">    configClasses.removeAll(alreadyParsed);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®@Configurationç±»çš„ä¿¡æ¯ï¼Œè¯»å–å…¶å†…å®¹å¹¶åˆ›å»ºBeanDefinition</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.reader == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.reader = <span class="keyword">new</span> <span class="title class_">ConfigurationClassBeanDefinitionReader</span>(</span><br><span class="line">                registry, <span class="built_in">this</span>.sourceExtractor, <span class="built_in">this</span>.resourceLoader, <span class="built_in">this</span>.environment,</span><br><span class="line">                <span class="built_in">this</span>.importBeanNameGenerator, parser.getImportRegistry());</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// â­ï¸â­ï¸â­ï¸ â‘¢å¯¼å…¥æ ¹æ®importè§£æå‡ºæ¥çš„AutoConfigurationç±»ä¸­é‡Œé¢çš„bean</span></span><br><span class="line">    <span class="built_in">this</span>.reader.loadBeanDefinitions(configClasses);</span><br><span class="line">    <span class="comment">// å°†å·²ç»è§£æè¿‡çš„@Configurationç±»åŠ å…¥å·²å¤„ç†é›†åˆ</span></span><br><span class="line">    alreadyParsed.addAll(configClasses);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…ç©ºå½“å‰çš„å€™é€‰é›†åˆ</span></span><br><span class="line">    candidates.clear();</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰BeanDefinitionæ•°é‡å¤§äºå€™é€‰é›†åˆä¸­çš„æ•°é‡ï¼Œåˆ™éœ€è¦é‡æ–°æ‰«ææ–°çš„BeanDefinition</span></span><br><span class="line">    <span class="keyword">if</span> (registry.getBeanDefinitionCount() &gt; candidateNames.length) &#123;</span><br><span class="line">        <span class="comment">// æ›´æ–°å€™é€‰BeanDefinitionçš„åç§°é›†åˆ</span></span><br><span class="line">        String[] newCandidateNames = registry.getBeanDefinitionNames();</span><br><span class="line">        <span class="comment">// å°†æ—§çš„å€™é€‰åç§°é›†åˆè½¬æ¢ä¸ºHashSetï¼Œä¾¿äºæŸ¥è¯¢</span></span><br><span class="line">        Set&lt;String&gt; oldCandidateNames = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(Arrays.asList(candidateNames));</span><br><span class="line">        <span class="comment">// å°†å·²ç»è§£æè¿‡çš„@Configurationç±»çš„åç§°åŠ å…¥Seté›†åˆ</span></span><br><span class="line">        Set&lt;String&gt; alreadyParsedClasses = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (ConfigurationClass configurationClass : alreadyParsed) &#123;</span><br><span class="line">            alreadyParsedClasses.add(configurationClass.getMetadata().getClassName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰æ–°çš„å€™é€‰åç§°</span></span><br><span class="line">        <span class="keyword">for</span> (String candidateName : newCandidateNames) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè¯¥åç§°ä¸åœ¨æ—§çš„å€™é€‰åç§°ä¸­ï¼Œåˆ™åŠ å…¥å€™é€‰é›†åˆ</span></span><br><span class="line">            <span class="keyword">if</span> (!oldCandidateNames.contains(candidateName)) &#123;</span><br><span class="line">                <span class="comment">// è·å–è¯¥BeanDefinitionå¯¹è±¡</span></span><br><span class="line">                <span class="type">BeanDefinition</span> <span class="variable">bd</span> <span class="operator">=</span> registry.getBeanDefinition(candidateName);</span><br><span class="line">                <span class="comment">// å¦‚æœè¯¥BeanDefinitionç¬¦åˆ@Configurationç±»çš„æ¡ä»¶ï¼Œå¹¶ä¸”æ²¡æœ‰è¢«è§£æè¿‡ï¼Œåˆ™åŠ å…¥å€™é€‰é›†åˆ</span></span><br><span class="line">                <span class="keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bd, <span class="built_in">this</span>.metadataReaderFactory) &amp;&amp;</span><br><span class="line">                        !alreadyParsedClasses.contains(bd.getBeanClassName())) &#123;</span><br><span class="line">                    candidates.add(<span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(bd, candidateName));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ›´æ–°å€™é€‰åç§°é›†åˆ</span></span><br><span class="line">        candidateNames = newCandidateNames;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (!candidates.isEmpty());</span><br></pre></td></tr></table></figure><p><code>parser.parse(candidates);</code>å…·ä½“çš„è§£æè¿‡ç¨‹æ ¸å¿ƒé€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parse</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> &#123;</span><br><span class="line">    <span class="comment">// éå†æ¯ä¸€ä¸ªå€™é€‰çš„ BeanDefinitionHolderï¼Œå¯¹å…¶è¿›è¡Œè§£æ</span></span><br><span class="line">    <span class="keyword">for</span> (BeanDefinitionHolder holder : configCandidates) &#123;</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">bd</span> <span class="operator">=</span> holder.getBeanDefinition();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ AnnotatedBeanDefinition ç±»å‹ï¼Œå¦‚æœæ˜¯åˆ™è§£ææ³¨è§£å…ƒæ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AnnotatedBeanDefinition) &#123;</span><br><span class="line">                parse(((AnnotatedBeanDefinition) bd).getMetadata(), holder.getBeanName());</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ AbstractBeanDefinition ç±»å‹ä¸”å·²ç»è®¾ç½® BeanClassï¼Œå¦‚æœæ˜¯åˆ™è§£ææ³¨è§£å…ƒæ•°æ®</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AbstractBeanDefinition &amp;&amp; ((AbstractBeanDefinition) bd).hasBeanClass()) &#123;</span><br><span class="line">                parse(((AbstractBeanDefinition) bd).getBeanClass(), holder.getBeanName());</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// å¦åˆ™è§£æ BeanClassName å¯¹åº”çš„ç±»çš„æ³¨è§£å…ƒæ•°æ®</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                parse(bd.getBeanClassName(), holder.getBeanName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BeanDefinitionStoreException ex) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè§£æå¼‚å¸¸åˆ™ç›´æ¥æŠ›å‡º BeanDefinitionStoreException</span></span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè§£æå¼‚å¸¸åˆ™æŠ›å‡º BeanDefinitionStoreExceptionï¼Œç»™å‡ºå¤±è´¥çš„ç±»å</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">                    <span class="string">&quot;Failed to parse configuration class [&quot;</span> + bd.getBeanClassName() + <span class="string">&quot;]&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// â­ï¸â­ï¸â­ï¸â‘¡å¯¼å…¥äº†éœ€è¦è§£æçš„é…ç½®ç±» æ­¤å¤„æ‰§è¡Œäº†AutoConfigurationImportSelector#processæ–¹æ³•</span></span><br><span class="line">    <span class="built_in">this</span>.deferredImportSelectorHandler.process();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>doProcessConfigurationClass  <mark class="hl-label green">è¯¦è§5</mark>   é‡ç‚¹</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9e15277e-9f6e-4253-b9c1-05e40b94a476-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœ ConfigurationClass ä½¿ç”¨äº† @Component æ³¨è§£ï¼Œåˆ™å…ˆé€’å½’å¤„ç†æ‰€æœ‰åµŒå¥—ç±»</span></span><br><span class="line"><span class="keyword">if</span> (configClass.getMetadata().isAnnotated(Component.class.getName())) &#123;</span><br><span class="line">    processMemberClasses(configClass, sourceClass);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç† @PropertySource æ³¨è§£</span></span><br><span class="line"><span class="keyword">for</span> (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(</span><br><span class="line">        sourceClass.getMetadata(), PropertySources.class,</span><br><span class="line">        org.springframework.context.annotation.PropertySource.class)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.environment <span class="keyword">instanceof</span> ConfigurableEnvironment) &#123;</span><br><span class="line">        processPropertySource(propertySource);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Ignoring @PropertySource annotation on [&quot;</span> + sourceClass.getMetadata().getClassName() +</span><br><span class="line">                <span class="string">&quot;]. Reason: Environment must implement ConfigurableEnvironment&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç† @ComponentScan æ³¨è§£  basePackagesè®¾ç½®çš„æ­£æ˜¯å¯åŠ¨ç±»</span></span><br><span class="line">Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(</span><br><span class="line">        sourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);</span><br><span class="line"><span class="keyword">if</span> (!componentScans.isEmpty() &amp;&amp;</span><br><span class="line">        !<span class="built_in">this</span>.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (AnnotationAttributes componentScan : componentScans) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰é…ç½®ç±»è¢« @ComponentScan æ³¨è§£ï¼Œåˆ™ç«‹å³æ‰§è¡Œæ‰«æ</span></span><br><span class="line">        Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =</span><br><span class="line">                <span class="built_in">this</span>.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());</span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ‰«æåˆ°çš„ BeanDefinition é›†åˆä¸­æ˜¯å¦æœ‰é…ç½®ç±»ï¼Œå¦‚æœæœ‰åˆ™é€’å½’è§£æ</span></span><br><span class="line">        <span class="keyword">for</span> (BeanDefinitionHolder holder : scannedBeanDefinitions) &#123;</span><br><span class="line">            <span class="type">BeanDefinition</span> <span class="variable">bdCand</span> <span class="operator">=</span> holder.getBeanDefinition().getOriginatingBeanDefinition();</span><br><span class="line">            <span class="keyword">if</span> (bdCand == <span class="literal">null</span>) &#123;</span><br><span class="line">                bdCand = holder.getBeanDefinition();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, <span class="built_in">this</span>.metadataReaderFactory)) &#123;</span><br><span class="line">                parse(bdCand.getBeanClassName(), holder.getBeanName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»ä¸Šä¸¤ä¸ªimport</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230502104957759.png" alt="image-20230502104957759"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// â‘ å¤„ç† @Import æ³¨è§£</span></span><br><span class="line">processImports(configClass, sourceClass, getImports(sourceClass), <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç† @ImportResource æ³¨è§£</span></span><br><span class="line"><span class="type">AnnotationAttributes</span> <span class="variable">importResource</span> <span class="operator">=</span></span><br><span class="line">        AnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);</span><br><span class="line"><span class="keyword">if</span> (importResource != <span class="literal">null</span>) &#123;</span><br><span class="line">    String[] resources = importResource.getStringArray(<span class="string">&quot;locations&quot;</span>);</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">BeanDefinitionReader</span>&gt; readerClass = importResource.getClass(<span class="string">&quot;reader&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (String resource : resources) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">resolvedResource</span> <span class="operator">=</span> <span class="built_in">this</span>.environment.resolveRequiredPlaceholders(resource);</span><br><span class="line">        configClass.addImportedResource(resolvedResource, readerClass);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç† @Bean æ–¹æ³•</span></span><br><span class="line">Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);</span><br><span class="line"><span class="keyword">for</span> (MethodMetadata methodMetadata : beanMethods) &#123;</span><br><span class="line">    configClass.addBeanMethod(<span class="keyword">new</span> <span class="title class_">BeanMethod</span>(methodMetadata, configClass));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†æ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•</span></span><br><span class="line">processInterfaces(configClass, sourceClass);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><hr><h2 id="4-äº‹ä»¶ç›‘å¬">4. äº‹ä»¶ç›‘å¬</h2><p>SpringBoot åœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œä¼šå¯¹å‡ ä¸ªç›‘å¬å™¨è¿›è¡Œå›è°ƒï¼Œå¯ä»¥å®ç°ç›‘å¬å™¨æ¥å£ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å®Œæˆä¸€äº›æ“ä½œ</p><p><code>ApplicationContextInitializer</code>ã€<code>SpringApplicationRunListener</code>ã€<code>CommandLineRunner</code>ã€<code>ApplicationRunner</code></p><div class="tabs" id="bf7c81bb-1e37-4601-af56-417721997df7"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#bf7c81bb-1e37-4601-af56-417721997df7-1"><i class="fas fa-cat"></i>1</button></li><li class="tab"><button type="button" data-href="#bf7c81bb-1e37-4601-af56-417721997df7-2"><i class="fas fa-horse"></i>2</button></li><li class="tab"><button type="button" data-href="#bf7c81bb-1e37-4601-af56-417721997df7-3"><i class="fas fa-dove"></i>3</button></li><li class="tab"><button type="button" data-href="#bf7c81bb-1e37-4601-af56-417721997df7-4"><i class="fas fa-dragon"></i>4</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="bf7c81bb-1e37-4601-af56-417721997df7-1"><p>MyApplicationRunner</p><p>è‡ªå®šä¹‰ç›‘å¬å™¨çš„å¯åŠ¨æ—¶æœºï¼šMyApplicationRunner å’Œ MyCommandLineRunner éƒ½æ˜¯å½“é¡¹ç›®å¯åŠ¨åæ‰§è¡Œï¼Œä½¿ç”¨ @Component æ”¾å…¥å®¹å™¨å³å¯ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½“é¡¹ç›®å¯åŠ¨åæ‰§è¡Œrunæ–¹æ³•</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ApplicationRunner...run&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.asList(args.getSourceArgs()));<span class="comment">//propertiesé…ç½®ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bf7c81bb-1e37-4601-af56-417721997df7-2"><p>MyCommandLineRunner</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CommandLineRunner...run&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bf7c81bb-1e37-4601-af56-417721997df7-3"><p>MyApplicationContextInitializer çš„å¯ç”¨è¦åœ¨ resource æ–‡ä»¶å¤¹ä¸‹æ·»åŠ  META-INF/spring.factories</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.example.springbootlistener.listener.MyApplicationContextInitializer</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ApplicationContextInitializer....initialize&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bf7c81bb-1e37-4601-af56-417721997df7-4"><p>MySpringApplicationRunListener çš„ä½¿ç”¨è¦æ·»åŠ æ„é€ å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> &#123;</span><br><span class="line"><span class="comment">//æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MySpringApplicationRunListener</span><span class="params">(SpringApplication sa, String[] args)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;starting...é¡¹ç›®å¯åŠ¨ä¸­&quot;</span>);<span class="comment">//è¾“å‡ºSPRINGä¹‹å‰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableEnvironment environment)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;environmentPrepared...ç¯å¢ƒå¯¹è±¡å¼€å§‹å‡†å¤‡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;contextPrepared...ä¸Šä¸‹æ–‡å¯¹è±¡å¼€å§‹å‡†å¤‡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;contextLoaded...ä¸Šä¸‹æ–‡å¯¹è±¡å¼€å§‹åŠ è½½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">started</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;started...ä¸Šä¸‹æ–‡å¯¹è±¡åŠ è½½å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">running</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;running...é¡¹ç›®å¯åŠ¨å®Œæˆï¼Œå¼€å§‹è¿è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;failed...é¡¹ç›®å¯åŠ¨å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="5-é…ç½®æ–‡ä»¶">5. é…ç½®æ–‡ä»¶</h2><p>SpringBoot æ˜¯åŸºäºçº¦å®šçš„ï¼Œå¾ˆå¤šé…ç½®éƒ½æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„é…ç½®æ›¿æ¢é»˜è®¤é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨application.propertiesæˆ–è€… application.ymlï¼ˆapplication.yamlï¼‰è¿›è¡Œé…ç½®</p><ul><li>é»˜è®¤é…ç½®æ–‡ä»¶åç§°ï¼šapplication</li><li>åœ¨åŒä¸€çº§ç›®å½•ä¸‹ä¼˜å…ˆçº§ä¸ºï¼šproperties &gt; yml &gt; yaml</li></ul><h3 id="4-1-yamlè¯­æ³•">4.1 yamlè¯­æ³•</h3><p>åŸºæœ¬è¯­æ³•ï¼š</p><ul><li><p>å¤§å°å†™æ•æ„Ÿ</p></li><li><p>æ•°æ®å€¼å‰è¾¹å¿…é¡»æœ‰ç©ºæ ¼ï¼Œä½œä¸ºåˆ†éš”ç¬¦</p></li><li><p>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</p></li><li><p>ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨Tabé”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ï¼ˆå„ä¸ªç³»ç»Ÿ Tabå¯¹åº”ç©ºæ ¼æ•°ç›®å¯èƒ½ä¸åŒï¼Œå¯¼è‡´å±‚æ¬¡æ··ä¹±ï¼‰</p></li><li><p>ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯</p></li><li><p>â€˜â€™#&quot; è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line"><span class="attr">port:</span> <span class="number">8080</span>  </span><br><span class="line">    <span class="attr">address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure></li></ul><p>æ•°æ®æ ¼å¼ï¼š</p><div class="tabs" id="8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7-1"><i class="fas fa-award"></i>çº¯é‡</button></li><li class="tab"><button type="button" data-href="#8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7-2"><i class="fas fa-baseball-ball"></i>å¯¹è±¡</button></li><li class="tab"><button type="button" data-href="#8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7-3"><i class="fas fa-bone"></i>æ•°ç»„</button></li><li class="tab"><button type="button" data-href="#8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7-4"><i class="fas fa-anchor"></i>å‚æ•°å¼•ç”¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7-1"><p>å•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msg1:</span> <span class="string">&#x27;hello \n world&#x27;</span>  <span class="comment"># å•å¼•å¿½ç•¥è½¬ä¹‰å­—ç¬¦</span></span><br><span class="line"><span class="attr">msg2:</span> <span class="string">&quot;hello \n world&quot;</span>  <span class="comment"># åŒå¼•è¯†åˆ«è½¬ä¹‰å­—ç¬¦</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7-2"><p>é”®å€¼å¯¹é›†åˆï¼ŒMapã€Hash</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span>  </span><br><span class="line">   <span class="attr">name:</span> <span class="string">zhangsan</span></span><br><span class="line">   <span class="attr">age:</span> <span class="number">20</span></span><br><span class="line"><span class="comment"># è¡Œå†…å†™æ³•</span></span><br><span class="line"><span class="attr">person:</span> &#123;<span class="attr">name:</span> <span class="string">zhangsan</span>&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸å»ºè®®ä½¿ç”¨ JSONï¼Œåº”è¯¥ä½¿ç”¨ yaml è¯­æ³•</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7-3"><p>ä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼ŒListã€Array</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">address:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">beijing</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">shanghai</span></span><br><span class="line"><span class="comment"># è¡Œå†…å†™æ³•</span></span><br><span class="line"><span class="attr">address:</span> [<span class="string">beijing</span>,<span class="string">shanghai</span>]</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">allPerson</span><span class="comment">#List&lt;Person&gt;</span></span><br><span class="line">  <span class="bullet">-</span> &#123;<span class="string">name:lisi</span>, <span class="string">age:18</span>&#125;</span><br><span class="line">  <span class="bullet">-</span> &#123;<span class="string">name:wangwu</span>, <span class="string">age:20</span>&#125;</span><br><span class="line"><span class="comment"># è¡Œå†…å†™æ³•</span></span><br><span class="line"><span class="attr">allPerson:</span> [&#123;<span class="string">name:lisi</span>, <span class="string">age:18</span>&#125;, &#123;<span class="string">name:wangwu</span>, <span class="string">age:20</span>&#125;]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8c706fa9-4b8b-4bfb-aac6-92a8c17c7be7-4"><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">lisi</span> </span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">$&#123;name&#125;</span> <span class="comment"># å¼•ç”¨ä¸Šè¾¹å®šä¹‰çš„nameå€¼</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="4-2-è·å–é…ç½®">4.2 è·å–é…ç½®</h3><p>ä¸‰ç§è·å–é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼š</p><div class="tabs" id="2db43a24-e20c-4b2a-aa39-fd15c4f39ae0"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2db43a24-e20c-4b2a-aa39-fd15c4f39ae0-1"><i class="fas fa-seedling"></i>1</button></li><li class="tab"><button type="button" data-href="#2db43a24-e20c-4b2a-aa39-fd15c4f39ae0-2"><i class="fas fa-leaf"></i>2</button></li><li class="tab"><button type="button" data-href="#2db43a24-e20c-4b2a-aa39-fd15c4f39ae0-3"><i class="fab fa-apple"></i>3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2db43a24-e20c-4b2a-aa39-fd15c4f39ae0-1"><p>æ³¨è§£ @Value</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;address[0]&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String address1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;msg1&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;msg2&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg2;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰çš„æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot; hello Spring Boot !&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2db43a24-e20c-4b2a-aa39-fd15c4f39ae0-2"><p>Evironment å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Environment env;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(env.getProperty(<span class="string">&quot;person.name&quot;</span>));</span><br><span class="line">    System.out.println(env.getProperty(<span class="string">&quot;address[0]&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; hello Spring Boot !&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2db43a24-e20c-4b2a-aa39-fd15c4f39ae0-3"><p>æ³¨è§£ @ConfigurationProperties é…åˆ @Component ä½¿ç”¨</p><p>æ³¨æ„ï¼šå‚æ•° prefix ä¸€å®šè¦æŒ‡å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//ä¸æ‰«æè¯¥ç»„ä»¶åˆ°å®¹å™¨å†…ï¼Œæ— æ³•å®Œæˆè‡ªåŠ¨è£…é…</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String[] address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(person);</span><br><span class="line">    <span class="comment">//Person&#123;name=&#x27;zhangsan&#x27;, age=20, address=[beijing, shanghai]&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; hello Spring Boot !&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="6-è‡ªå®šä¹‰Starter">6. è‡ªå®šä¹‰Starter</h2><p>spring boot åœ¨é…ç½®ä¸Šç›¸æ¯”springè¦ç®€å•è®¸å¤š, å…¶æ ¸å¿ƒåœ¨äºspring-boot-starter, åœ¨ä½¿ç”¨spring bootæ¥æ­å»ºä¸€ä¸ªé¡¹ç›®æ—¶, åªéœ€è¦å¼•å…¥å®˜æ–¹æä¾›çš„starter, å°±å¯ä»¥ç›´æ¥ä½¿ç”¨, å…å»äº†å„ç§é…ç½®ã€‚starterç®€å•æ¥è®²å°±æ˜¯å¼•å…¥äº†ä¸€äº›ç›¸å…³ä¾èµ–å’Œä¸€äº›åˆå§‹åŒ–çš„é…ç½®ã€‚</p><h3 id="6-1-æ¡ˆä¾‹ä¸€">6.1 æ¡ˆä¾‹ä¸€</h3><mark class="hl-label blue">å¼€å‘starter</mark> <div class="tabs" id="f449984b-9e18-4b00-b258-d815a8483b62"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#f449984b-9e18-4b00-b258-d815a8483b62-1"><i class="fas fa-seedling"></i>ç¬¬ä¸€æ­¥</button></li><li class="tab"><button type="button" data-href="#f449984b-9e18-4b00-b258-d815a8483b62-2"><i class="fas fa-leaf"></i>ç¬¬äºŒæ­¥</button></li><li class="tab"><button type="button" data-href="#f449984b-9e18-4b00-b258-d815a8483b62-3"><i class="fab fa-apple"></i>ç¬¬ä¸‰æ­¥</button></li><li class="tab"><button type="button" data-href="#f449984b-9e18-4b00-b258-d815a8483b62-4"><i class="fas fa-tree"></i>ç¬¬å››æ­¥</button></li><li class="tab"><button type="button" data-href="#f449984b-9e18-4b00-b258-d815a8483b62-5"><i class="fas fa-heartbeat"></i>ç¬¬äº”æ­¥</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="f449984b-9e18-4b00-b258-d815a8483b62-1"><p>åˆ›å»ºstarterå·¥ç¨‹hello-spring-boot-starterå¹¶é…ç½®pom.xmlæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hello-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f449984b-9e18-4b00-b258-d815a8483b62-2"><p>åˆ›å»ºé…ç½®å±æ€§ç±»HelloProperties</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *è¯»å–é…ç½®æ–‡ä»¶è½¬æ¢ä¸ºbean</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HelloProperties&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, address=&#x27;&quot;</span> + address + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f449984b-9e18-4b00-b258-d815a8483b62-3"><p>åˆ›å»ºæœåŠ¡ç±»HelloService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloService</span><span class="params">(String name, String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ä½ å¥½ï¼æˆ‘çš„åå­—å« &quot;</span> + name + <span class="string">&quot;ï¼Œæˆ‘æ¥è‡ª &quot;</span> + address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f449984b-9e18-4b00-b258-d815a8483b62-4"><p>åˆ›å»ºè‡ªåŠ¨é…ç½®ç±»HelloServiceAutoConfiguration</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.service.HelloService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* é…ç½®ç±»ï¼ŒåŸºäºJavaä»£ç çš„beané…ç½®</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥é…ç½®å±æ€§å¯¹è±¡HelloProperties</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloServiceAutoConfiguration</span><span class="params">(HelloProperties helloProperties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ä¾‹åŒ–HelloServiceå¹¶è½½å…¥Spring IoCå®¹å™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>(helloProperties.getName(),helloProperties.getAddress());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f449984b-9e18-4b00-b258-d815a8483b62-5"><p>åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºMETA-INF/spring.factories</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">cn.itcast.config.HelloServiceAutoConfiguration</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤starterå·²ç»å¼€å‘å®Œæˆäº†ï¼Œå¯ä»¥å°†å½“å‰starterå®‰è£…åˆ°æœ¬åœ°mavenä»“åº“ä¾›å…¶ä»–åº”ç”¨æ¥ä½¿ç”¨ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><mark class="hl-label green">ä½¿ç”¨starter</mark> <div class="tabs" id="dd433e8a-b1b4-46a3-8443-6088615e447a"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#dd433e8a-b1b4-46a3-8443-6088615e447a-1"><i class="fas fa-cat"></i>ç¬¬ä¸€æ­¥</button></li><li class="tab"><button type="button" data-href="#dd433e8a-b1b4-46a3-8443-6088615e447a-2"><i class="fas fa-horse"></i>ç¬¬äºŒæ­¥</button></li><li class="tab"><button type="button" data-href="#dd433e8a-b1b4-46a3-8443-6088615e447a-3"><i class="fas fa-dove"></i>ç¬¬ä¸‰æ­¥</button></li><li class="tab"><button type="button" data-href="#dd433e8a-b1b4-46a3-8443-6088615e447a-4"><i class="fas fa-dragon"></i>ç¬¬å››æ­¥</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="dd433e8a-b1b4-46a3-8443-6088615e447a-1"><p>åˆ›å»ºmavenå·¥ç¨‹myappå¹¶é…ç½®pom.xmlæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myapp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¯¼å…¥è‡ªå®šä¹‰starter--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hello-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dd433e8a-b1b4-46a3-8443-6088615e447a-2"><p>åˆ›å»ºapplication.ymlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">hello:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">xiaoming</span></span><br><span class="line">  <span class="attr">address:</span> <span class="string">beijing</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dd433e8a-b1b4-46a3-8443-6088615e447a-3"><p>åˆ›å»ºHelloController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.service.HelloService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="comment">//HelloServiceåœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„starterä¸­å·²ç»å®Œæˆäº†è‡ªåŠ¨é…ç½®ï¼Œæ‰€ä»¥æ­¤å¤„å¯ä»¥ç›´æ¥æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/say&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dd433e8a-b1b4-46a3-8443-6088615e447a-4"><p>åˆ›å»ºå¯åŠ¨ç±»HelloApplication</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(HelloApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå¯åŠ¨ç±»mainæ–¹æ³•ï¼Œè®¿é—®åœ°å€http://localhost:8080/hello/say</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20200310103528648.png" alt="image-20200310103528648"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="6-2-æ¡ˆä¾‹äºŒ">6.2 æ¡ˆä¾‹äºŒ</h3><p>åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸€ä¸­æˆ‘ä»¬é€šè¿‡å®šä¹‰starterï¼Œè‡ªåŠ¨é…ç½®äº†ä¸€ä¸ªHelloServiceå®ä¾‹ã€‚æœ¬æ¡ˆä¾‹æˆ‘ä»¬éœ€è¦é€šè¿‡è‡ªåŠ¨é…ç½®æ¥åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨å¯¹è±¡ï¼Œé€šè¿‡æ­¤æ‹¦æˆªå™¨å¯¹è±¡æ¥å®ç°è®°å½•æ—¥å¿—åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¡ˆä¾‹ä¸€çš„åŸºç¡€ä¸Šç»§ç»­å¼€å‘æ¡ˆä¾‹äºŒã€‚</p><mark class="hl-label blue">å¼€å‘starter</mark> <div class="tabs" id="421b7b5d-e977-4116-b671-5a181d0ca04c"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#421b7b5d-e977-4116-b671-5a181d0ca04c-1"><i class="fas fa-atom"></i>ç¬¬ä¸€æ­¥</button></li><li class="tab"><button type="button" data-href="#421b7b5d-e977-4116-b671-5a181d0ca04c-2"><i class="far fa-sun"></i>ç¬¬äºŒæ­¥</button></li><li class="tab"><button type="button" data-href="#421b7b5d-e977-4116-b671-5a181d0ca04c-3"><i class="fas fa-wind"></i>ç¬¬ä¸‰æ­¥</button></li><li class="tab"><button type="button" data-href="#421b7b5d-e977-4116-b671-5a181d0ca04c-4"><i class="fas fa-fire-alt"></i>ç¬¬å››æ­¥</button></li><li class="tab"><button type="button" data-href="#421b7b5d-e977-4116-b671-5a181d0ca04c-5"><i class="fas fa-cookie-bite"></i>ç¬¬äº”æ­¥</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="421b7b5d-e977-4116-b671-5a181d0ca04c-1"><p>åœ¨hello-spring-boot-starterçš„pom.xmlæ–‡ä»¶ä¸­è¿½åŠ å¦‚ä¸‹mavenåæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="421b7b5d-e977-4116-b671-5a181d0ca04c-2"><p>è‡ªå®šä¹‰MyLogæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyLog &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•æè¿°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">desc</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="421b7b5d-e977-4116-b671-5a181d0ca04c-3"><p>è‡ªå®šä¹‰æ—¥å¿—æ‹¦æˆªå™¨MyLogInterceptor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ—¥å¿—æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogInterceptor</span> <span class="keyword">extends</span> <span class="title class_">HandlerInterceptorAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Long&gt; startTimeThreadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, </span></span><br><span class="line"><span class="params">                             Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> (HandlerMethod)handler;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> handlerMethod.getMethod();<span class="comment">//è·å¾—è¢«æ‹¦æˆªçš„æ–¹æ³•å¯¹è±¡</span></span><br><span class="line">        <span class="type">MyLog</span> <span class="variable">myLog</span> <span class="operator">=</span> method.getAnnotation(MyLog.class);<span class="comment">//è·å¾—æ–¹æ³•ä¸Šçš„æ³¨è§£</span></span><br><span class="line">        <span class="keyword">if</span>(myLog != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//æ–¹æ³•ä¸ŠåŠ äº†MyLogæ³¨è§£ï¼Œéœ€è¦è¿›è¡Œæ—¥å¿—è®°å½•</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            startTimeThreadLocal.set(startTime);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, </span></span><br><span class="line"><span class="params">                           Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> (HandlerMethod)handler;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> handlerMethod.getMethod();<span class="comment">//è·å¾—è¢«æ‹¦æˆªçš„æ–¹æ³•å¯¹è±¡</span></span><br><span class="line">        <span class="type">MyLog</span> <span class="variable">myLog</span> <span class="operator">=</span> method.getAnnotation(MyLog.class);<span class="comment">//è·å¾—æ–¹æ³•ä¸Šçš„æ³¨è§£</span></span><br><span class="line">        <span class="keyword">if</span>(myLog != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//æ–¹æ³•ä¸ŠåŠ äº†MyLogæ³¨è§£ï¼Œéœ€è¦è¿›è¡Œæ—¥å¿—è®°å½•</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            <span class="type">Long</span> <span class="variable">startTime</span> <span class="operator">=</span> startTimeThreadLocal.get();</span><br><span class="line">            <span class="type">long</span> <span class="variable">optTime</span> <span class="operator">=</span> endTime - startTime;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">requestUri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">            <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> method.getDeclaringClass().getName() + <span class="string">&quot;.&quot;</span> + </span><br><span class="line">                method.getName();</span><br><span class="line">            <span class="type">String</span> <span class="variable">methodDesc</span> <span class="operator">=</span> myLog.desc();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;è¯·æ±‚uriï¼š&quot;</span> + requestUri);</span><br><span class="line">            System.out.println(<span class="string">&quot;è¯·æ±‚æ–¹æ³•åï¼š&quot;</span> + methodName);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–¹æ³•æè¿°ï¼š&quot;</span> + methodDesc);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œæ—¶é—´ï¼š&quot;</span> + optTime + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="421b7b5d-e977-4116-b671-5a181d0ca04c-4"><p>åˆ›å»ºè‡ªåŠ¨é…ç½®ç±»MyLogAutoConfigurationï¼Œç”¨äºè‡ªåŠ¨é…ç½®æ‹¦æˆªå™¨ã€å‚æ•°è§£æå™¨ç­‰webç»„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.log.MyLogInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®ç±»ï¼Œç”¨äºè‡ªåŠ¨é…ç½®æ‹¦æˆªå™¨ã€å‚æ•°è§£æå™¨ç­‰webç»„ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogAutoConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>&#123;</span><br><span class="line">    <span class="comment">//æ³¨å†Œè‡ªå®šä¹‰æ—¥å¿—æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">MyLogInterceptor</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="421b7b5d-e977-4116-b671-5a181d0ca04c-5"><p>åœ¨spring.factoriesä¸­è¿½åŠ MyLogAutoConfigurationé…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">cn.itcast.config.HelloServiceAutoConfiguration,\</span></span><br><span class="line"><span class="string">cn.itcast.config.MyLogAutoConfiguration</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæˆ‘ä»¬åœ¨hello-spring-boot-starterä¸­è¿½åŠ äº†æ–°çš„å†…å®¹ï¼Œéœ€è¦é‡æ–°æ‰“åŒ…å®‰è£…åˆ°mavenä»“åº“ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <mark class="hl-label green">ä½¿ç”¨starter</mark> <p>åœ¨myappå·¥ç¨‹çš„Controlleræ–¹æ³•ä¸ŠåŠ å…¥@MyLogæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.log.MyLog;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.service.HelloService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="comment">//HelloServiceåœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„starterä¸­å·²ç»å®Œæˆäº†è‡ªåŠ¨é…ç½®ï¼Œæ‰€ä»¥æ­¤å¤„å¯ä»¥ç›´æ¥æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MyLog(desc = &quot;sayHelloæ–¹æ³•&quot;)</span> <span class="comment">//æ—¥å¿—è®°å½•æ³¨è§£</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/say&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®åœ°å€ï¼š<a href="http://localhost:8080/hello/say%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%BE%93%E5%87%BA%EF%BC%9A">http://localhost:8080/hello/sayï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š</a></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">è¯·æ±‚uriï¼š/hello/say</span></span><br><span class="line"><span class="attr">è¯·æ±‚æ–¹æ³•åï¼šcn.itcast.controller.HelloController.sayHello</span></span><br><span class="line"><span class="attr">æ–¹æ³•æè¿°ï¼šsayHelloæ–¹æ³•</span></span><br><span class="line"><span class="attr">æ–¹æ³•æ‰§è¡Œæ—¶é—´ï¼š36ms</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è‡ªåŠ¨è£…é…æµç¨‹è¯¦è§£ã€è‡ªå®šä¹‰Starter</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="SpringBoot" scheme="https://wuwawawa.github.io/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootæ¦‚è¿°</title>
    <link href="https://wuwawawa.github.io/posts/4e03c5a1.html"/>
    <id>https://wuwawawa.github.io/posts/4e03c5a1.html</id>
    <published>2023-05-02T10:30:30.000Z</published>
    <updated>2023-05-02T07:13:40.112Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Spring-Bootæ¦‚è¿°">1. Spring Bootæ¦‚è¿°</h2><p>Spring Bootæ˜¯ç”±Pivotalå›¢é˜Ÿæä¾›çš„å…¨æ–°æ¡†æ¶ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥ç®€åŒ–Springåº”ç”¨çš„åˆ›å»ºã€è¿è¡Œã€è°ƒè¯•ã€éƒ¨ç½²ç­‰ã€‚ä½¿ç”¨Spring Bootå¯ä»¥åšåˆ°ä¸“æ³¨äºSpringåº”ç”¨çš„å¼€å‘ï¼Œè€Œæ— éœ€è¿‡å¤šå…³æ³¨XMLçš„é…ç½®ã€‚Spring Bootä½¿ç”¨â€œçº¦å®šå¤§äºé…ç½®â€çš„ç†å¿µï¼Œç®€å•æ¥è¯´ï¼Œå®ƒæä¾›äº†ä¸€å †ä¾èµ–æ‰“åŒ…ï¼Œå¹¶å·²ç»æŒ‰ç…§ä½¿ç”¨ä¹ æƒ¯è§£å†³äº†ä¾èµ–é—®é¢˜ã€‚ä½¿ç”¨Spring Bootå¯ä»¥ä¸ç”¨æˆ–è€…åªéœ€è¦å¾ˆå°‘çš„Springé…ç½®å°±å¯ä»¥è®©ä¼ä¸šé¡¹ç›®å¿«é€Ÿè¿è¡Œèµ·æ¥ã€‚</p><p>Spring Bootæ˜¯å¼€å‘è€…å’ŒSpring æœ¬èº«æ¡†æ¶çš„ä¸­é—´å±‚ï¼Œå¸®åŠ©å¼€å‘è€…ç»Ÿç­¹ç®¡ç†åº”ç”¨çš„é…ç½®ï¼Œæä¾›åŸºäºå®é™…å¼€å‘ä¸­å¸¸è§é…ç½®çš„é»˜è®¤å¤„ç†ï¼ˆ<span class='p red'>çº¦å®šå¤§äºé…ç½®</span>ï¼‰ï¼Œç®€åŒ–åº”ç”¨çš„å¼€å‘ï¼Œç®€åŒ–åº”ç”¨çš„è¿ç»´ï¼›æ€»çš„æ¥è¯´ï¼Œå…¶ç›®çš„Spring Bootå°±æ˜¯ä¸ºäº†å¯¹Java web çš„å¼€å‘è¿›è¡Œâ€œç®€åŒ–â€å’ŒåŠ â€œå¿«â€é€Ÿåº¦ï¼Œç®€åŒ–å¼€å‘è¿‡ç¨‹ä¸­å¼•å…¥æˆ–å¯åŠ¨ç›¸å…³Spring åŠŸèƒ½çš„é…ç½®ã€‚è¿™æ ·å¸¦æ¥çš„å¥½å¤„å°±æ˜¯é™ä½å¼€å‘äººå‘˜å¯¹äºæ¡†æ¶çš„å…³æ³¨ç‚¹ï¼Œå¯ä»¥æŠŠæ›´å¤šçš„ç²¾åŠ›æ”¾åœ¨è‡ªå·±çš„ä¸šåŠ¡ä»£ç ä¸Šã€‚</p><hr><hr><h2 id="2-ä¸ºä»€ä¹ˆä½¿ç”¨SpringBoot">2. ä¸ºä»€ä¹ˆä½¿ç”¨SpringBoot</h2><blockquote><p>Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications that you can â€œjust runâ€.</p><p>èƒ½å¿«é€Ÿåˆ›å»ºå‡ºç”Ÿäº§çº§åˆ«çš„Springåº”ç”¨</p></blockquote><h3 id="2-1-SpringBootä¼˜ç‚¹">2.1. SpringBootä¼˜ç‚¹</h3><ol><li>ç‹¬ç«‹è¿è¡Œçš„ Spring é¡¹ç›®</li></ol><p>Spring Boot å¯ä»¥ä»¥ jar åŒ…çš„å½¢å¼ç‹¬ç«‹è¿è¡Œï¼ŒSpring Boot é¡¹ç›®åªéœ€é€šè¿‡å‘½ä»¤â€œ javaâ€“jar xx.jarâ€ å³å¯è¿è¡Œã€‚</p><ol start="2"><li>å†…åµŒ Servlet å®¹å™¨</li></ol><p>Spring Boot ä½¿ç”¨åµŒå…¥å¼çš„ Servlet å®¹å™¨ï¼ˆä¾‹å¦‚ Tomcatã€Jetty æˆ–è€… Undertow ç­‰ï¼‰ï¼Œåº”ç”¨æ— éœ€æ‰“æˆ WAR åŒ… ã€‚</p><ol start="3"><li>æä¾› starter ç®€åŒ– Maven é…ç½®</li></ol><p>Spring Boot æä¾›äº†ä¸€ç³»åˆ—çš„â€œstarterâ€é¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ˆPOMSï¼‰æ¥ç®€åŒ– Maven é…ç½®ã€‚</p><ol start="4"><li>æä¾›äº†å¤§é‡çš„è‡ªåŠ¨é…ç½®</li></ol><p>Spring Boot æä¾›äº†å¤§é‡çš„é»˜è®¤è‡ªåŠ¨é…ç½®ï¼Œæ¥ç®€åŒ–é¡¹ç›®çš„å¼€å‘ï¼Œå¼€å‘äººå‘˜ä¹Ÿé€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹é»˜è®¤é…ç½®ã€‚</p><ol start="5"><li>è‡ªå¸¦åº”ç”¨ç›‘æ§</li></ol><p>Spring Boot å¯ä»¥å¯¹æ­£åœ¨è¿è¡Œçš„é¡¹ç›®æä¾›ç›‘æ§ã€‚</p><ol start="6"><li>æ— ä»£ç ç”Ÿæˆå’Œ xml é…ç½®</li></ol><p>Spring Boot ä¸éœ€è¦ä»»ä½• xml é…ç½®å³å¯å®ç° Spring çš„æ‰€æœ‰é…ç½®ã€‚</p><blockquote><p>SpringBootæ˜¯æ•´åˆSpringæŠ€æœ¯æ ˆçš„ä¸€ç«™å¼æ¡†æ¶ã€‚SpringBootæ˜¯ç®€åŒ–SpringæŠ€æœ¯æ ˆçš„å¿«é€Ÿå¼€å‘è„šæ‰‹æ¶</p></blockquote><h3 id="2-2-SpringBootç¼ºç‚¹">2.2. SpringBootç¼ºç‚¹</h3><ul><li>äººç§°ç‰ˆæœ¬å¸ï¼Œè¿­ä»£å¿«ï¼Œéœ€è¦æ—¶åˆ»å…³æ³¨å˜åŒ–</li><li>å°è£…å¤ªæ·±ï¼Œå†…éƒ¨åŸç†å¤æ‚ï¼Œä¸å®¹æ˜“ç²¾é€š</li></ul><hr><hr><h2 id="3-SpringBootå…¥é—¨æ¡ˆä¾‹">3. SpringBootå…¥é—¨æ¡ˆä¾‹</h2><div class="tabs" id="af6bffe9-6ec7-427e-ab96-5aa3b94e35fb"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-1"><i class="fas fa-seedling"></i>å¯¼å…¥ä¾èµ–</button></li><li class="tab"><button type="button" data-href="#af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-2"><i class="fas fa-leaf"></i>åˆ›å»ºä¸»ç¨‹åº</button></li><li class="tab"><button type="button" data-href="#af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-3"><i class="fab fa-apple"></i>ç¼–å†™ä¸šåŠ¡</button></li><li class="tab"><button type="button" data-href="#af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-4"><i class="fas fa-tree"></i>è®¾ç½®é…ç½®</button></li><li class="tab"><button type="button" data-href="#af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-5"><i class="fas fa-heartbeat"></i>è¿è¡Œ&æµ‹è¯•</button></li><li class="tab"><button type="button" data-href="#af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-6"><i class="fas fa-cookie-bite"></i>æ‰“åŒ…éƒ¨ç½²</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handle01</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, Spring Boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-4"><p>mavenå·¥ç¨‹çš„resourceæ–‡ä»¶å¤¹ä¸­åˆ›å»ºapplication.propertiesæ–‡ä»¶ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç«¯å£å·</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8888</span></span><br></pre></td></tr></table></figure><p><a href="https://docs.spring.io/spring-boot/docs/2.3.7.RELEASE/reference/html/appendix-application-properties.html#common-application-properties-server">æ›´å¤šé…ç½®ä¿¡æ¯</a></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-5"><ul><li>è¿è¡Œ<code>MainApplication</code>ç±»</li><li>æµè§ˆå™¨è¾“å…¥<code>http://localhost:8888/hello</code>ï¼Œå°†ä¼šè¾“å‡º<code>Hello, Spring Boot!</code>ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="af6bffe9-6ec7-427e-ab96-5aa3b94e35fb-6"><p>åœ¨pom.xmlæ·»åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨IDEAçš„Mavenæ’ä»¶ä¸Šç‚¹å‡»è¿è¡Œ clean ã€packageï¼ŒæŠŠhelloworldå·¥ç¨‹é¡¹ç›®çš„æ‰“åŒ…æˆjaråŒ…ï¼Œ</p><p>æ‰“åŒ…å¥½çš„jaråŒ…è¢«ç”Ÿæˆåœ¨helloworldå·¥ç¨‹é¡¹ç›®çš„targetæ–‡ä»¶å¤¹å†…ã€‚</p><p>ç”¨cmdè¿è¡Œ<code>java -jar boot-01-helloworld-1.0-SNAPSHOT.jar</code>ï¼Œæ—¢å¯ä»¥è¿è¡Œhelloworldå·¥ç¨‹é¡¹ç›®ã€‚</p><p>å°†jaråŒ…ç›´æ¥åœ¨ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œå³å¯ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><hr><h2 id="4-SpringBootä¾èµ–ç®¡ç†ç‰¹æ€§">4. SpringBootä¾èµ–ç®¡ç†ç‰¹æ€§</h2><blockquote><p>çˆ¶é¡¹ç›®åšä¾èµ–ç®¡ç†</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢é¡¹ç›®çš„çˆ¶é¡¹ç›®å¦‚ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å®ƒå‡ ä¹å£°æ˜äº†æ‰€æœ‰å¼€å‘ä¸­å¸¸ç”¨çš„ä¾èµ–çš„ç‰ˆæœ¬å·ï¼Œè‡ªåŠ¨ç‰ˆæœ¬ä»²è£æœºåˆ¶</p><blockquote><p>å¼€å‘å¯¼å…¥starteråœºæ™¯å¯åŠ¨å™¨</p></blockquote><ol><li>è§åˆ°å¾ˆå¤š spring-boot-starter-* ï¼š *å°±æŸç§åœºæ™¯</li><li>åªè¦å¼•å…¥starterï¼Œè¿™ä¸ªåœºæ™¯çš„æ‰€æœ‰å¸¸è§„éœ€è¦çš„ä¾èµ–æˆ‘ä»¬éƒ½è‡ªåŠ¨å¼•å…¥</li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">æ›´å¤šSpringBootæ‰€æœ‰æ”¯æŒçš„åœºæ™¯</a></li><li>è§åˆ°çš„  *-spring-boot-starterï¼š ç¬¬ä¸‰æ–¹ä¸ºæˆ‘ä»¬æä¾›çš„ç®€åŒ–å¼€å‘çš„åœºæ™¯å¯åŠ¨å™¨ã€‚</li></ol><mark class="hl-label blue">æ‰€æœ‰åœºæ™¯å¯åŠ¨å™¨æœ€åº•å±‚çš„ä¾èµ–</mark> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>æ— éœ€å…³æ³¨ç‰ˆæœ¬å·ï¼Œè‡ªåŠ¨ç‰ˆæœ¬ä»²è£</p><ol><li>å¼•å…¥ä¾èµ–é»˜è®¤éƒ½å¯ä»¥ä¸å†™ç‰ˆæœ¬</li><li>å¼•å…¥éç‰ˆæœ¬ä»²è£çš„jarï¼Œè¦å†™ç‰ˆæœ¬å·ã€‚</li></ol></li><li><p>å¯ä»¥ä¿®æ”¹é»˜è®¤ç‰ˆæœ¬å·</p><ol><li>æŸ¥çœ‹spring-boot-dependenciesé‡Œé¢è§„å®šå½“å‰ä¾èµ–çš„ç‰ˆæœ¬ ç”¨çš„ keyã€‚</li><li>åœ¨å½“å‰é¡¹ç›®é‡Œé¢é‡å†™é…ç½®ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ã€‚</li></ol></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.43<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><hr><h2 id="5-SpringBootè‡ªåŠ¨é…ç½®ç‰¹æ€§">5. SpringBootè‡ªåŠ¨é…ç½®ç‰¹æ€§</h2><p>é€šè¿‡ä¸Šé¢çš„å…¥é—¨æ¡ˆä¾‹</p><ul><li>è‡ªåŠ¨é…å¥½Tomcat<ul><li>å¼•å…¥Tomcatä¾èµ–ã€‚</li><li>é…ç½®Tomcat</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>è‡ªåŠ¨é…å¥½SpringMVC</p><ul><li>å¼•å…¥SpringMVCå…¨å¥—ç»„ä»¶</li><li>è‡ªåŠ¨é…å¥½SpringMVCå¸¸ç”¨ç»„ä»¶ï¼ˆåŠŸèƒ½ï¼‰</li></ul></li><li><p>è‡ªåŠ¨é…å¥½Webå¸¸è§åŠŸèƒ½ï¼Œå¦‚ï¼šå­—ç¬¦ç¼–ç é—®é¢˜</p><ul><li>SpringBootå¸®æˆ‘ä»¬é…ç½®å¥½äº†æ‰€æœ‰webå¼€å‘çš„å¸¸è§åœºæ™¯</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//1ã€è¿”å›æˆ‘ä»¬IOCå®¹å™¨</span></span><br><span class="line">    <span class="type">ConfigurableApplicationContext</span> <span class="variable">run</span> <span class="operator">=</span> SpringApplication.run(MainApplication.class, args);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2ã€æŸ¥çœ‹å®¹å™¨é‡Œé¢çš„ç»„ä»¶</span></span><br><span class="line">    String[] names = run.getBeanDefinitionNames();</span><br><span class="line">    <span class="keyword">for</span> (String name : names) &#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é»˜è®¤çš„åŒ…ç»“æ„<ul><li>ä¸»ç¨‹åºæ‰€åœ¨åŒ…åŠå…¶ä¸‹é¢çš„æ‰€æœ‰å­åŒ…é‡Œé¢çš„ç»„ä»¶éƒ½ä¼šè¢«é»˜è®¤æ‰«æè¿›æ¥</li><li>æ— éœ€ä»¥å‰çš„åŒ…æ‰«æé…ç½®</li><li>æƒ³è¦æ”¹å˜æ‰«æè·¯å¾„<ul><li>@SpringBootApplication(scanBasePackages=â€œcom.atguigu.bootâ€)</li><li>@ComponentScan æŒ‡å®šæ‰«æè·¯å¾„</li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line">ç­‰åŒäº</span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.atguigu.boot&quot;)</span></span><br></pre></td></tr></table></figure><ul><li>å„ç§é…ç½®æ‹¥æœ‰é»˜è®¤å€¼<ul><li>é»˜è®¤é…ç½®æœ€ç»ˆéƒ½æ˜¯æ˜ å°„åˆ°æŸä¸ªç±»ä¸Šï¼Œå¦‚ï¼š<code>MultipartProperties</code></li><li>é…ç½®æ–‡ä»¶çš„å€¼æœ€ç»ˆä¼šç»‘å®šæ¯ä¸ªç±»ä¸Šï¼Œè¿™ä¸ªç±»ä¼šåœ¨å®¹å™¨ä¸­åˆ›å»ºå¯¹è±¡</li></ul></li><li>æŒ‰éœ€åŠ è½½æ‰€æœ‰è‡ªåŠ¨é…ç½®é¡¹<ul><li>éå¸¸å¤šçš„starter</li><li>å¼•å…¥äº†å“ªäº›åœºæ™¯è¿™ä¸ªåœºæ™¯çš„è‡ªåŠ¨é…ç½®æ‰ä¼šå¼€å¯</li><li>SpringBootæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½éƒ½åœ¨ spring-boot-autoconfigure åŒ…é‡Œé¢</li></ul></li><li>â€¦</li></ul>]]></content>
    
    
    <summary type="html">ä¸ºä»€ä¹ˆä½¿ç”¨SpringBootã€SpringBootå…¥é—¨æ¡ˆä¾‹</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="SpringBoot" scheme="https://wuwawawa.github.io/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC</title>
    <link href="https://wuwawawa.github.io/posts/ae0f95e0.html"/>
    <id>https://wuwawawa.github.io/posts/ae0f95e0.html</id>
    <published>2023-05-01T01:32:14.000Z</published>
    <updated>2023-05-05T08:52:56.367Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-SpringMVCç®€ä»‹">1. SpringMVCç®€ä»‹</h2><h3 id="1-1-SpringMVCæ¦‚è¿°">1.1 SpringMVCæ¦‚è¿°</h3><p>SpringMVCæ˜¯ä¸€ä¸ªåŸºäºSpringå¼€å‘çš„MVCè½»é‡çº§æ¡†æ¶ï¼ŒSpring3.0åå‘å¸ƒçš„ç»„ä»¶ï¼ŒSpringMVCå’ŒSpringå¯ä»¥æ— ç¼æ•´åˆï¼Œä½¿ç”¨<code>DispatcherServlet</code>ä½œä¸ºå‰ç«¯æ§åˆ¶å™¨ï¼Œä¸”å†…éƒ¨æä¾›äº†<code>å¤„ç†å™¨æ˜ å°„å™¨</code>ã€<code>å¤„ç†å™¨é€‚é…å™¨</code>ã€<code>è§†å›¾è§£æå™¨</code>ç­‰ç»„ä»¶ï¼Œå¯ä»¥ç®€åŒ–JavaBeanå°è£…ï¼ŒJsonè½¬åŒ–ã€æ–‡ä»¶ä¸Šä¼ ç­‰æ“ä½œã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427101142279.png" alt="image-20230427101142279"></p><hr><h3 id="1-2-SpringMVCå¿«é€Ÿå…¥é—¨">1.2 SpringMVCå¿«é€Ÿå…¥é—¨</h3><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427101429465.png" alt="image-20230427101429465" style="zoom: 50%;" /><div class="tabs" id="7d28f7cb-0e19-432e-b68e-e2756885d4e9"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7d28f7cb-0e19-432e-b68e-e2756885d4e9-1"><i class="fas fa-seedling"></i>å¯¼å…¥åæ ‡</button></li><li class="tab"><button type="button" data-href="#7d28f7cb-0e19-432e-b68e-e2756885d4e9-2"><i class="fas fa-leaf"></i>é…ç½®å‰ç«¯æ§åˆ¶å™¨</button></li><li class="tab"><button type="button" data-href="#7d28f7cb-0e19-432e-b68e-e2756885d4e9-3"><i class="fas fa-tree"></i>é…ç½®spring-mvc.xml</button></li><li class="tab"><button type="button" data-href="#7d28f7cb-0e19-432e-b68e-e2756885d4e9-4"><i class="fab fa-apple"></i>ç¼–å†™æ§åˆ¶å™¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7d28f7cb-0e19-432e-b68e-e2756885d4e9-1"><p>å¯¼å…¥Springæ•´åˆSpringMVCçš„åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7d28f7cb-0e19-432e-b68e-e2756885d4e9-2"><p>åœ¨web.xmlä¸­é…ç½®SpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ServletDispatcher</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æŒ‡å®šspringMVCé…ç½®æ–‡ä»¶ä½ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æœåŠ¡å™¨å¯åŠ¨å°±åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7d28f7cb-0e19-432e-b68e-e2756885d4e9-3"><p>åˆ›å»ºspringMVCçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ spring-mvc.xmlï¼Œå¹¶é…ç½®ç»„ä»¶æ‰«æwebå±‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç»„ä»¶æ‰«æ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima.controller&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7d28f7cb-0e19-432e-b68e-e2756885d4e9-4"><p>ç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨Controllerï¼Œé…ç½®æ˜ å°„ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/show&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show æ‰§è¡Œ....&quot;</span>);</span><br><span class="line">        <span class="comment">//è§†å›¾è·³è½¬åˆ°index.jsp</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="1-3-Controllerè®¿é—®å®¹å™¨Bean">1.3 Controllerè®¿é—®å®¹å™¨Bean</h3><p><code>DispatcherServlet</code>åœ¨è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼ŒåŠ è½½çš„spring-mvc.xmlé…ç½®æ–‡ä»¶åˆ›å»ºçš„SpringMVCå®¹å™¨ï¼Œé‚£ä¹ˆwebå±‚Controllerè¢«æ‰«æè¿›å…¥åˆ°äº†å®¹å™¨ä¸­ï¼Œè€Œä¹‹å‰Springå®¹å™¨ä¸­çš„Serviceæ˜¯å¦å¯ä»¥è·å–åˆ°å‘¢ï¼Ÿä¸‹é¢æ­å»ºSpringçš„webç¯å¢ƒè¿›è¡ŒéªŒè¯</p><div class="tabs" id="35c07813-7047-4374-96bb-22a4522e4cea"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#35c07813-7047-4374-96bb-22a4522e4cea-1"><i class="fas fa-cat"></i>1</button></li><li class="tab"><button type="button" data-href="#35c07813-7047-4374-96bb-22a4522e4cea-2"><i class="fas fa-horse"></i>2</button></li><li class="tab"><button type="button" data-href="#35c07813-7047-4374-96bb-22a4522e4cea-3"><i class="fas fa-dove"></i>3</button></li><li class="tab"><button type="button" data-href="#35c07813-7047-4374-96bb-22a4522e4cea-4"><i class="fas fa-dragon"></i>4</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="35c07813-7047-4374-96bb-22a4522e4cea-1"><p>åˆ›å»ºä¸€ä¸ªapplicationContext.xmlæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç»„ä»¶æ‰«æéwebå±‚ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ’é™¤com.itheimaåŒ…ä¸‹ä½¿ç”¨@Controlleræ³¨è§£çš„ç±»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="35c07813-7047-4374-96bb-22a4522e4cea-2"><p>åœ¨web.xmlä¸­é…ç½®ContextLoaderListener</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®ContextLoaderListener--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applictionContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="35c07813-7047-4374-96bb-22a4522e4cea-3"><p>ç¼–å†™UserServiceå’ŒUserServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserServiceImpl show running ... ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="35c07813-7047-4374-96bb-22a4522e4cea-4"><p>ä¿®æ”¹UserControllerï¼Œä»Springå®¹å™¨ä¸­åŒ¹é…Serviceè¿›è¡Œæ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/show&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show æ‰§è¡Œ....&quot;</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨userServiceçš„showæ–¹æ³•</span></span><br><span class="line">        userService.show();</span><br><span class="line">        <span class="comment">//è§†å›¾è·³è½¬åˆ°index.jsp</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="1-4-SpringMVCå…³é”®ç»„ä»¶æµ…æ">1.4 SpringMVCå…³é”®ç»„ä»¶æµ…æ</h3><p>ä¸Šé¢å·²ç»å®Œæˆçš„å¿«é€Ÿå…¥é—¨çš„æ“ä½œï¼Œä¹Ÿåœ¨ä¸çŸ¥ä¸è§‰ä¸­å®Œæˆçš„Springå’ŒSpringMVCçš„æ•´åˆï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§è§„åˆ™å»å®šä¹‰Controllerå’Œä¸šåŠ¡æ–¹æ³•å°±å¯ä»¥ã€‚ä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè‚¯å®šæ˜¯å¾ˆå¤šæ ¸å¿ƒåŠŸèƒ½ç±»å‚ä¸åˆ°å…¶ä¸­ï¼Œè¿™äº›æ ¸å¿ƒåŠŸèƒ½ç±»ï¼Œä¸€èˆ¬ç§°ä¸ºç»„ä»¶ã€‚å½“è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œæ˜¯å“ªä¸ªç»„ä»¶æ¥æ”¶çš„è¯·æ±‚ï¼Œæ˜¯å“ªä¸ªç»„ä»¶å¸®æˆ‘ä»¬æ‰¾åˆ°çš„Controllerï¼Œæ˜¯å“ªä¸ªç»„ä»¶å¸®æˆ‘ä»¬è°ƒç”¨çš„æ–¹æ³•ï¼Œåˆæ˜¯å“ªä¸ªç»„ä»¶æœ€ç»ˆè§£æçš„è§†å›¾ï¼Ÿ</p><p><span id="jump1"></span></p><table><thead><tr><th style="text-align:left">ç»„ä»¶</th><th style="text-align:left">æè¿°</th><th style="text-align:left">å¸¸ç”¨ç»„</th></tr></thead><tbody><tr><td style="text-align:left">å¤„ç†å™¨æ˜ å°„å™¨ï¼šHandlerMapping</td><td style="text-align:left">åŒ¹é…æ˜ å°„è·¯å¾„å¯¹åº”çš„Handlerï¼Œè¿”å›å¯æ‰§è¡Œçš„å¤„ç†å™¨é“¾å¯¹è±¡HandlerExecutionChainå¯¹è±¡</td><td style="text-align:left">RequestMappingHandlerMapping</td></tr><tr><td style="text-align:left">å¤„ç†å™¨é€‚é…å™¨ï¼šHandlerAdapter</td><td style="text-align:left">åŒ¹é…HandlerExecutionChainå¯¹åº”çš„é€‚é…å™¨è¿›è¡Œå¤„ç†å™¨è°ƒç”¨ï¼Œè¿”å›è§†å›¾æ¨¡å‹å¯¹è±¡</td><td style="text-align:left">RequestMappingHandlerAdapter</td></tr><tr><td style="text-align:left">è§†å›¾è§£æå™¨ï¼šViewResolver</td><td style="text-align:left">å¯¹è§†å›¾æ¨¡å‹å¯¹è±¡è¿›è¡Œè§£æ</td><td style="text-align:left">InternalResourceViewResolver</td></tr></tbody></table><p>å…ˆç®€å•äº†è§£ä¸€ä¸‹ä»¥ä¸Šä¸‰ä¸ªé‡è¦ç»„ä»¶çš„å…³ç³»<a href="#jump2">ç‚¹å‡»è·³è½¬â†“â†“â†“â†“</a></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427103049084.png" alt="image-20230427103049084" style="zoom:80%;" /><p>SpringMVCçš„é»˜è®¤ç»„ä»¶ï¼ŒSpringMVCåœ¨å‰ç«¯æ§åˆ¶å™¨DispatcherServletåŠ è½½æ—¶ï¼Œå°±ä¼šè¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œåœ¨è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œå°±ä¼šåŠ è½½SpringMVCé»˜è®¤æŒ‡å®šçš„ä¸€äº›ç»„ä»¶ï¼Œè¿™äº›é»˜è®¤ç»„ä»¶é…ç½®åœ¨<code>DispatcherServlet.properties</code>æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶å­˜åœ¨ä¸spring-webmvc-5.3.7.jaråŒ…ä¸‹çš„org\springframework\web\servlet\DispatcherServlet.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.web.servlet.HandlerMapping</span>=<span class="string">org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\</span></span><br><span class="line"><span class="string">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping,\</span></span><br><span class="line"><span class="string">org.springframework.web.servlet.function.support.RouterFunctionMapping</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.HandlerAdapter</span>=<span class="string">org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\</span></span><br><span class="line"><span class="string">org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\</span></span><br><span class="line"><span class="string">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter,\</span></span><br><span class="line"><span class="string">org.springframework.web.servlet.function.support.HandlerFunctionAdapter</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.ViewResolver</span>=<span class="string">org.springframework.web.servlet.view.InternalResourceViewResolver</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#çœç•¥å…¶ä»–ä»£ç </span></span><br></pre></td></tr></table></figure><blockquote><ol><li>BeanNameUrlHandlerMappingï¼š</li></ol><p><code>BeanNameUrlHandlerMapping</code> æ˜¯ Spring MVC æ¡†æ¶ä¸­æœ€ç®€å•çš„å¤„ç†å™¨æ˜ å°„å™¨ä¹‹ä¸€ï¼Œå®ƒæ˜¯å°†è¯·æ±‚çš„ URL æ˜ å°„åˆ° Spring å®¹å™¨ä¸­çš„ Bean åç§°ä¸Šã€‚å½“ç”¨æˆ·å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° Spring MVC æ¡†æ¶æ—¶ï¼Œ<code>BeanNameUrlHandlerMapping</code> ä¼šæ ¹æ®è¯·æ±‚çš„ URL æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ Beanã€‚</p><ol start="2"><li>RequestMappingHandlerMappingï¼š</li></ol><p><code>RequestMappingHandlerMapping</code> æ˜¯ Spring MVC æ¡†æ¶ä¸­å¸¸ç”¨çš„å¤„ç†å™¨æ˜ å°„å™¨ï¼Œå®ƒé€šè¿‡æ³¨è§£ <code>@RequestMapping</code> å’Œå¤„ç†å™¨æ–¹æ³•çš„å‚æ•°æ¥ç¡®å®šè¯·æ±‚çš„å¤„ç†å™¨ã€‚å®ƒå¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ª <code>@RequestMapping</code> æ³¨è§£å’Œä¸€ä¸ªå¤„ç†å™¨æ–¹æ³•æ˜ å°„åœ¨ä¸€èµ·ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ Ant é£æ ¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¯·æ±‚è·¯å¾„ã€‚</p><ol start="3"><li>RouterFunctionMappingï¼š</li></ol><p><code>RouterFunctionMapping</code> æ˜¯ Spring WebFlux æ¡†æ¶ä¸­çš„å¤„ç†å™¨æ˜ å°„å™¨ï¼Œå®ƒåŸºäºå‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹æ¥å®šä¹‰è¯·æ±‚å¤„ç†å™¨çš„è·¯ç”±ï¼Œæ”¯æŒ Reactive Streams è§„èŒƒï¼Œå¯ä»¥å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ã€‚åœ¨ Spring WebFlux ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>RouterFunction</code> æ¥å®šä¹‰è¯·æ±‚çš„å¤„ç†è·¯ç”±ï¼Œ<code>RouterFunctionMapping</code> ä¼šæ ¹æ®è¯·æ±‚çš„è·¯å¾„å’Œ HTTP æ–¹æ³•æ¥åŒ¹é…å¯¹åº”çš„ <code>RouterFunction</code>ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªåŒ¹é…çš„å¤„ç†å™¨å‡½æ•°ã€‚ä¸ Spring MVC ä¸åŒï¼ŒSpring WebFlux ä¸éœ€è¦å°†è¯·æ±‚å¤„ç†å™¨æ˜ å°„åˆ°å…·ä½“çš„ Java æ–¹æ³•ä¸Šï¼Œè€Œæ˜¯å¯ä»¥åŸºäºå‡½æ•°å¼ç¼–ç¨‹é£æ ¼æ¥å®ç°ä¸šåŠ¡é€»è¾‘ã€‚</p></blockquote><p>è¿™äº›é»˜è®¤çš„ç»„ä»¶æ˜¯åœ¨<code>DispatcherServlet</code>ä¸­è¿›è¡Œåˆå§‹åŒ–åŠ è½½çš„ï¼Œåœ¨DispatcherServletä¸­å­˜åœ¨é›†åˆå­˜å‚¨ç€è¿™äº›ç»„ä»¶ï¼Œ SpringMVCçš„é»˜è®¤ç»„ä»¶ä¼šåœ¨<code>DispatcherServlet</code>ä¸­è¿›è¡Œç»´æŠ¤ï¼Œ<span class='p red'>ä½†æ˜¯å¹¶æ²¡æœ‰å­˜å‚¨åœ¨ä¸SpringMVCçš„å®¹å™¨ä¸­</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">FrameworkServlet</span> &#123;</span><br><span class="line">    <span class="comment">//å­˜å‚¨å¤„ç†å™¨æ˜ å°„å™¨</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;HandlerMapping&gt; handlerMappings;</span><br><span class="line">    <span class="comment">//å­˜å‚¨å¤„ç†å™¨é€‚é…å™¨</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;HandlerAdapter&gt; handlerAdapters;</span><br><span class="line">    <span class="comment">//å­˜å‚¨è§†å›¾è§£æå™¨</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ViewResolver&gt; viewResolvers;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–ä»£ç  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®ç»„ä»¶ä»£æ›¿é»˜è®¤ç»„ä»¶ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨é»˜è®¤ç»„ä»¶ï¼Œå¯ä»¥å°†æ›¿ä»£æ–¹æ¡ˆä½¿ç”¨Spring Beançš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä¾‹å¦‚ï¼Œåœ¨spring-mvc.xmlä¸­é…ç½®<code>RequestMappingHandlerMapping</code></p><p><code>&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;/&gt;</code></p><p>å½“æˆ‘ä»¬åœ¨Springå®¹å™¨ä¸­é…ç½®äº†HandlerMappingï¼Œåˆ™å°±ä¸ä¼šåœ¨åŠ è½½é»˜è®¤çš„HandlerMappingç­–ç•¥äº†ï¼ŒåŸç†æ¯”è¾ƒç®€å•ï¼Œ DispatcherServlet åœ¨è¿›è¡ŒHandlerMappingåˆå§‹åŒ–æ—¶ï¼Œå…ˆä»SpringMVCå®¹å™¨ä¸­æ‰¾æ˜¯å¦å­˜åœ¨HandlerMappingï¼Œå¦‚æœå­˜åœ¨ç›´æ¥å–å‡ºå®¹å™¨ä¸­çš„HandlerMappingï¼Œåœ¨å­˜å‚¨åˆ° DispatcherServlet ä¸­çš„handlerMappingsé›†åˆä¸­å»ã€‚</p><hr><hr><h2 id="2-SpringMVCçš„è¯·æ±‚å¤„ç†">2. SpringMVCçš„è¯·æ±‚å¤„ç†</h2><h3 id="2-1-è¯·æ±‚æ˜ å°„è·¯å¾„çš„é…ç½®">2.1 è¯·æ±‚æ˜ å°„è·¯å¾„çš„é…ç½®</h3><p>é…ç½®æ˜ å°„è·¯å¾„ï¼Œæ˜ å°„å™¨å¤„ç†å™¨æ‰èƒ½æ‰¾åˆ°Controllerçš„æ–¹æ³•èµ„æºï¼Œç›®å‰ä¸»æµæ˜ å°„è·¯å¾„é…ç½®æ–¹å¼å°±æ˜¯@RequestMapping</p><table><thead><tr><th style="text-align:left">ç›¸å…³æ³¨è§£</th><th style="text-align:left">ä½œç”¨</th><th style="text-align:left">ä½¿ç”¨ä½ç½®</th></tr></thead><tbody><tr><td style="text-align:left">@RequestMapping</td><td style="text-align:left">è®¾ç½®æ§åˆ¶å™¨æ–¹æ³•çš„è®¿é—®èµ„æºè·¯å¾„ï¼Œå¯ä»¥æ¥æ”¶ä»»ä½•è¯·æ±‚</td><td style="text-align:left">æ–¹æ³•å’Œç±»ä¸Š</td></tr><tr><td style="text-align:left">@GetMapping</td><td style="text-align:left">è®¾ç½®æ§åˆ¶å™¨æ–¹æ³•çš„è®¿é—®èµ„æºè·¯å¾„ï¼Œå¯ä»¥æ¥æ”¶GETè¯·æ±‚</td><td style="text-align:left">æ–¹æ³•å’Œç±»ä¸Š</td></tr><tr><td style="text-align:left">@PostMapping</td><td style="text-align:left">è®¾ç½®æ§åˆ¶å™¨æ–¹æ³•çš„è®¿é—®èµ„æºè·¯å¾„ï¼Œå¯ä»¥æ¥æ”¶POSTè¯·æ±‚</td><td style="text-align:left">æ–¹æ³•å’Œç±»ä¸Š</td></tr></tbody></table><p>@RequestMappingæ³¨è§£ï¼Œä¸»è¦ä½¿ç”¨åœ¨æ§åˆ¶å™¨çš„æ–¹æ³•ä¸Šï¼Œç”¨äºæ ‡è¯†å®¢æˆ·ç«¯è®¿é—®èµ„æºè·¯å¾„ï¼Œå¸¸ç”¨çš„å±æ€§æœ‰valueã€path ã€methodã€headersã€paramsç­‰ã€‚å½“@RequestMappingåªæœ‰ä¸€ä¸ªè®¿é—®è·¯å¾„éœ€è¦æŒ‡å®šæ—¶ï¼Œä½¿ç”¨valueå±æ€§ã€pathå±æ€§æˆ–çœç•¥valueå’Œpathï¼Œå½“æœ‰å¤šä¸ªå±æ€§æ—¶ï¼Œvalueå’Œpathä¸èƒ½çœç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/show&quot;)</span><span class="comment">//ä½¿ç”¨valueå±æ€§æŒ‡å®šä¸€ä¸ªè®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"><span class="meta">@RequestMapping(value = &#123;&quot;/show&quot;,&quot;/haohao&quot;,&quot;/abc&quot;&#125;)</span><span class="comment">//ä½¿ç”¨valueå±æ€§æŒ‡å®šå¤šä¸ªè®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/show&quot;)</span><span class="comment">//ä½¿ç”¨pathå±æ€§æŒ‡å®šä¸€ä¸ªè®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"><span class="meta">@RequestMapping(path = &#123;&quot;/show&quot;,&quot;/haohao&quot;,&quot;/abc&quot;&#125;)</span><span class="comment">//ä½¿ç”¨pathå±æ€§æŒ‡å®šå¤šä¸ªè®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/show&quot;)</span><span class="comment">//å¦‚æœåªè®¾ç½®è®¿é—®è·¯å¾„æ—¶ï¼Œvalueå’Œpathå¯ä»¥çœç•¥</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&#123;&quot;/show&quot;,&quot;/haohao&quot;,&quot;/abc&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å½“@RequestMapping éœ€è¦é™å®šè®¿é—®æ–¹å¼æ—¶ï¼Œå¯ä»¥é€šè¿‡methodå±æ€§è®¾ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯·æ±‚åœ°å€æ˜¯/show,ä¸”è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯POSTæ‰èƒ½åŒ¹é…æˆåŠŸ</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/show&quot;,method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>methodçš„å±æ€§å€¼æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">RequestMethod</span> &#123;</span><br><span class="line">    GET,</span><br><span class="line">    HEAD,</span><br><span class="line">    POST,</span><br><span class="line">    PUT,</span><br><span class="line">    PATCH,</span><br><span class="line">    DELETE,</span><br><span class="line">    OPTIONS,</span><br><span class="line">    TRACE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">RequestMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@GetMappingï¼Œå½“è¯·æ±‚æ–¹å¼æ˜¯GETæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@GetMappingæ›¿ä»£@RequestMapping</p><p>@PostMappingï¼Œå½“è¯·æ±‚æ–¹å¼æ˜¯POSTæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@PostMappingæ›¿ä»£@RequestMapping</p><p>@RequestMapping åœ¨ç±»ä¸Šä½¿ç”¨ï¼Œ@RequestMapping ã€@GetMappingã€@PostMappingè¿˜å¯ä»¥ä½¿ç”¨åœ¨Controllerç±»ä¸Šï¼Œä½¿ç”¨åœ¨ç±»ä¸Šåï¼Œè¯¥ç±»æ‰€æœ‰æ–¹æ³•éƒ½å…¬ç”¨è¯¥@RequestMappingè®¾ç½®çš„å±æ€§ï¼Œè®¿é—®è·¯å¾„åˆ™ä¸ºç±»ä¸Šçš„æ˜ å°„åœ°å€+æ–¹æ³•ä¸Šçš„æ˜ å°„åœ°å€ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/xxx&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span>, ServletContextAware &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/aaa&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">aaa</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException, ModelAndViewDefiningException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„è®¿é—®è·¯å¾„ä¸ºï¼š/xxx/aaa</p><hr><h3 id="2-2-è¯·æ±‚æ•°æ®çš„æ¥æ”¶">2.2 è¯·æ±‚æ•°æ®çš„æ¥æ”¶</h3><h4 id="2-2-1-æ™®é€šæ•°æ®æ¥æ”¶">2.2.1 æ™®é€šæ•°æ®æ¥æ”¶</h4><div class="tabs" id="ecb55e13-9f27-42be-bc95-be55bab0db3e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ecb55e13-9f27-42be-bc95-be55bab0db3e-1"><i class="fas fa-award"></i>æ™®é€šè¯·æ±‚æ•°æ®</button></li><li class="tab"><button type="button" data-href="#ecb55e13-9f27-42be-bc95-be55bab0db3e-2"><i class="fas fa-baseball-ball"></i>æ•°ç»„æˆ–é›†åˆæ•°æ®</button></li><li class="tab"><button type="button" data-href="#ecb55e13-9f27-42be-bc95-be55bab0db3e-3"><i class="fas fa-bone"></i>å®ä½“JavaBeanå±æ€§æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ecb55e13-9f27-42be-bc95-be55bab0db3e-1"><blockquote><p>æ¥æ”¶æ™®é€šè¯·æ±‚æ•°æ®ï¼Œå½“å®¢æˆ·ç«¯æäº¤çš„æ•°æ®æ˜¯æ™®é€šé”®å€¼å¯¹å½¢å¼æ—¶ï¼Œç›´æ¥ä½¿ç”¨åŒåå½¢å‚æ¥æ”¶å³å¯</p></blockquote><p><code>username=haohao&amp;age=35</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(String username, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">    System.out.println(username+<span class="string">&quot;==&quot;</span>+age); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ¥æ”¶æ™®é€šè¯·æ±‚æ•°æ®ï¼Œå½“è¯·æ±‚å‚æ•°çš„åç§°ä¸æ–¹æ³•å‚æ•°åä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨@RequestParamæ³¨è§£è¿›è¡Œæ ‡æ³¨</p></blockquote><p><code>username=haohao&amp;age=35</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(<span class="meta">@RequestParam(name = &quot;username&quot;,required = true)</span> String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">    System.out.println(name+<span class="string">&quot;==&quot;</span>+age); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ecb55e13-9f27-42be-bc95-be55bab0db3e-2"><blockquote><p>æ¥æ”¶æ•°ç»„æˆ–é›†åˆæ•°æ®ï¼Œå®¢æˆ·ç«¯ä¼ é€’å¤šä¸ªåŒåå‚æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„æ¥æ”¶</p></blockquote><p><code>hobbies=eat&amp;hobbies=sleep</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(String[] hobbies)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (String hobby : hobbies) &#123;</span><br><span class="line">        System.out.println(hobby);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä¼ é€’å¤šä¸ªåŒåå‚æ•°æ—¶ï¼Œ<span class='p blue'>ä¹Ÿå¯ä»¥ä½¿ç”¨å•åˆ—é›†åˆæ¥æ”¶ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨@RequestParam</span>ï¼Œå‘ŠçŸ¥æ¡†æ¶ä¼ é€’çš„å‚æ•°æ˜¯è¦åŒåè®¾ç½®çš„ï¼Œä¸æ˜¯å¯¹è±¡å±æ€§è®¾ç½®çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;String&gt; hobbies)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (String hobby : hobbies) &#123;</span><br><span class="line">        System.out.println(hobby);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ¥æ”¶æ•°ç»„æˆ–é›†åˆæ•°æ®ï¼Œå®¢æˆ·ç«¯ä¼ é€’å¤šä¸ªä¸åŒå‘½å‚æ•°æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Map&lt;String,Object&gt; è¿›è¡Œæ¥æ”¶ï¼ŒåŒæ ·éœ€è¦ç”¨@RequestParam è¿›è¡Œä¿®é¥°</p></blockquote><p><code>username=haohao&amp;age=18</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String,Object&gt; params)</span>&#123;</span><br><span class="line">    params.forEach((key,value)-&gt;&#123;</span><br><span class="line">        System.out.println(key+<span class="string">&quot;==&quot;</span>+value);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ecb55e13-9f27-42be-bc95-be55bab0db3e-3"><blockquote><p>æ¥æ”¶å®ä½“JavaBeanå±æ€§æ•°æ®ï¼Œå•ä¸ªJavaBeanæ•°æ®ï¼šæäº¤çš„å‚æ•°åç§°åªè¦ä¸Javaçš„å±æ€§åä¸€è‡´ï¼Œå°±å¯ä»¥è¿›è¡Œè‡ªåŠ¨å°è£…</p></blockquote><p><code>username=haohao&amp;age=35&amp;hobbies=eat&amp;hobbies=sleep</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String[] hobbies;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="comment">//... çœç•¥getå’Œsetæ–¹æ³• ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(user); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æ”¶å®ä½“JavaBeanå±æ€§æ•°æ®ï¼ŒåµŒå¥—JavaBeanæ•°æ®ï¼šæäº¤çš„å‚æ•°åç§°ç”¨<code>.</code>å»æè¿°åµŒå¥—å¯¹è±¡çš„å±æ€§å…³ç³»å³å¯</p><p><code>username=haohao&amp;address.city=tianjin&amp;address.area=jinghai</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h4 id="2-2-2-Jsonæ•°æ®æ¥æ”¶">2.2.2 Jsonæ•°æ®æ¥æ”¶</h4><blockquote><p>è¯·æ±‚æ•°æ®çš„æ¥æ”¶æ¥æ”¶Jsonæ•°æ®æ ¼å¼æ•°æ®ï¼Œ<span class='p blue'>Jsonæ•°æ®éƒ½æ˜¯ä»¥è¯·æ±‚ä½“çš„æ–¹å¼æäº¤çš„</span>ï¼Œä¸”ä¸æ˜¯åŸå§‹çš„é”®å€¼å¯¹æ ¼å¼çš„ï¼Œ<span class='p green'>æ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨@RequestBodyæ³¨è§£æ•´ä½“æ¥æ”¶è¯¥æ•°æ®ã€‚</span></p></blockquote><p>å¼€å‘æµ‹è¯•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Postmanè¿›è¡Œæµ‹è¯•</p><div class="tabs" id="0630c36b-b8e8-4a06-a39d-4af3b9da3164"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#0630c36b-b8e8-4a06-a39d-4af3b9da3164-1"><i class="fas fa-atom"></i>æ¥æ”¶Jsonæ•°æ®</button></li><li class="tab"><button type="button" data-href="#0630c36b-b8e8-4a06-a39d-4af3b9da3164-2"><i class="far fa-sun"></i>ä½¿ç”¨Jsonå·¥å…·è¿›è¡Œè½¬æ¢</button></li><li class="tab"><button type="button" data-href="#0630c36b-b8e8-4a06-a39d-4af3b9da3164-3"><i class="fas fa-wind"></i>é…ç½®RequestMappingHandlerAdapter</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="0630c36b-b8e8-4a06-a39d-4af3b9da3164-1"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;haohao&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;hobbies&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;eat&quot;</span><span class="punctuation">,</span><span class="string">&quot;sleep&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;birthday&quot;</span><span class="punctuation">:</span><span class="string">&quot;1986-01-01&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="string">&quot;tj&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;area&quot;</span><span class="punctuation">:</span><span class="string">&quot;binhai&quot;</span></span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/show6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show6</span><span class="params">(<span class="meta">@RequestBody</span> String body)</span>&#123;</span><br><span class="line">    System.out.println(body); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0630c36b-b8e8-4a06-a39d-4af3b9da3164-2"><p>ä½¿ç”¨Jsonå·¥å…·ï¼ˆ jackson ï¼‰å°†Jsonæ ¼å¼çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºJavaBeanè¿›è¡Œæ“ä½œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(<span class="meta">@RequestBody</span> String body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    System.out.println(body);</span><br><span class="line">    <span class="comment">//è·å¾—ObjectMapper</span></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="comment">//å°†jsonæ ¼å¼å­—ç¬¦ä¸²è½¬åŒ–æˆæŒ‡å®šçš„User</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> objectMapper.readValue(body, User.class);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0630c36b-b8e8-4a06-a39d-4af3b9da3164-3"><p>é…ç½®<code>RequestMappingHandlerAdapter</code>ï¼ŒæŒ‡å®šæ¶ˆæ¯è½¬æ¢å™¨ï¼Œå°±ä¸ç”¨æ‰‹åŠ¨è½¬æ¢jsonæ ¼å¼å­—ç¬¦ä¸²äº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageConverters&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æ”¶Jsonæ•°æ®æ ¼å¼æ•°æ®ï¼Œä½¿ç”¨Mapæ¥æ”¶jsonæ ¼å¼å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(<span class="meta">@RequestBody</span> Map map)</span>&#123;</span><br><span class="line">    System.out.println(map); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h4 id="2-2-3-æ¥æ”¶Restfulé£æ ¼æ•°æ®">2.2.3 æ¥æ”¶Restfulé£æ ¼æ•°æ®</h4><p>ä»€ä¹ˆæ˜¯Resté£æ ¼ï¼Ÿ<br>Restï¼ˆRepresentational State Transferï¼‰è¡¨è±¡åŒ–çŠ¶æ€è½¬å˜ï¼ˆè¡¨è¿°æ€§çŠ¶æ€è½¬å˜ï¼‰ï¼Œåœ¨2000å¹´è¢«æå‡ºï¼ŒåŸºäºHTTPã€URI ã€xmlã€JSONç­‰æ ‡å‡†å’Œåè®®ï¼Œæ”¯æŒè½»é‡çº§ã€è·¨å¹³å°ã€è·¨è¯­è¨€çš„æ¶æ„è®¾è®¡ã€‚æ˜¯WebæœåŠ¡çš„ä¸€ç§æ–°ç½‘ç»œåº”ç”¨ç¨‹åºçš„è®¾è®¡é£æ ¼å’Œå¼€å‘æ–¹å¼ã€‚</p><p>Restfulé£æ ¼çš„è¯·æ±‚ï¼Œå¸¸è§çš„è§„åˆ™æœ‰å¦‚ä¸‹ä¸‰ç‚¹ï¼š</p><p>ç”¨URIè¡¨ç¤ºæŸä¸ªæ¨¡å—èµ„æºï¼Œèµ„æºåç§°ä¸ºåè¯ï¼›</p><table><thead><tr><th style="text-align:left">æ¨¡å—</th><th style="text-align:left">URIèµ„æº</th></tr></thead><tbody><tr><td style="text-align:left">ç”¨æˆ·æ¨¡å—user</td><td style="text-align:left"><code>http://localhost/user</code></td></tr><tr><td style="text-align:left">å•†å“æ¨¡å—product</td><td style="text-align:left"><code>http://localhost/product</code></td></tr><tr><td style="text-align:left">è´¦æˆ·æ¨¡å—account</td><td style="text-align:left"><code>http://localhost/account</code></td></tr><tr><td style="text-align:left">æ—¥å¿—æ¨¡å—log</td><td style="text-align:left"><code>http://localhost/log</code></td></tr></tbody></table><p>ç”¨è¯·æ±‚æ–¹å¼è¡¨ç¤ºæ¨¡å—å…·ä½“ä¸šåŠ¡åŠ¨ä½œï¼Œä¾‹å¦‚ï¼šGETè¡¨ç¤ºæŸ¥è¯¢ã€POSTè¡¨ç¤ºæ’å…¥ã€PUTè¡¨ç¤ºæ›´æ–°ã€DELETEè¡¨ç¤ºåˆ é™¤</p><table><thead><tr><th style="text-align:left">URIèµ„æº</th><th style="text-align:left">è¯·æ±‚æ–¹å¼</th><th style="text-align:left">å‚æ•°</th><th style="text-align:left">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left"><code>http://localhost/user/100</code></td><td style="text-align:left">GET</td><td style="text-align:left">å­˜åœ¨URLåœ°å€ä¸­ï¼š100</td><td style="text-align:left">æŸ¥è¯¢id=100çš„Useræ•°æ®</td></tr><tr><td style="text-align:left"><code>http://localhost/user</code></td><td style="text-align:left">POST</td><td style="text-align:left">å­˜åœ¨è¯·æ±‚ä½“ä¸­Jsonï¼š{â€œusernameâ€:â€œhaohaoâ€,â€œageâ€:18}</td><td style="text-align:left">æ’å…¥Useræ•°æ®</td></tr><tr><td style="text-align:left"><code>http://localhost/user</code></td><td style="text-align:left">PUT</td><td style="text-align:left">å­˜åœ¨è¯·æ±‚ä½“ä¸­Jsonï¼š{â€œidâ€:100,â€œusernameâ€:â€œhaohaoâ€,â€œageâ€:18}</td><td style="text-align:left">ä¿®æ”¹id=100çš„Useræ•°æ®</td></tr><tr><td style="text-align:left"><code>http://localhost/user/100</code></td><td style="text-align:left">DELETE</td><td style="text-align:left">å­˜åœ¨URLåœ°å€ä¸­ï¼š100</td><td style="text-align:left">åˆ é™¤id=100çš„Useræ•°æ®</td></tr><tr><td style="text-align:left"><code>http://localhost/product/5</code></td><td style="text-align:left">GET</td><td style="text-align:left">å­˜åœ¨URLåœ°å€ä¸­ï¼š5</td><td style="text-align:left">æŸ¥è¯¢id=5çš„Productæ•°æ®</td></tr><tr><td style="text-align:left"><code>http://localhost/product</code></td><td style="text-align:left">POST</td><td style="text-align:left">å­˜åœ¨è¯·æ±‚ä½“ä¸­Jsonï¼š{â€œproNameâ€:â€œå°ç±³æ‰‹æœºâ€,â€œpriceâ€:1299}</td><td style="text-align:left">æ’å…¥Productæ•°æ®</td></tr><tr><td style="text-align:left"><code>http://localhost/product</code></td><td style="text-align:left">PUT</td><td style="text-align:left">å­˜åœ¨è¯·æ±‚ä½“ä¸­Jsonï¼š{â€œidâ€:5,â€œproNameâ€:â€œå°ç±³æ‰‹æœºâ€,â€œpriceâ€:1299}</td><td style="text-align:left">ä¿®æ”¹id=5çš„Productæ•°æ®</td></tr><tr><td style="text-align:left"><code>http://localhost/product/5</code></td><td style="text-align:left">DELETE</td><td style="text-align:left">å­˜åœ¨URLåœ°å€ä¸­ï¼š5</td><td style="text-align:left">åˆ é™¤id=5çš„Productæ•°æ®</td></tr></tbody></table><p>ç”¨HTTPå“åº”çŠ¶æ€ç è¡¨ç¤ºç»“æœï¼Œå›½å†…å¸¸ç”¨çš„å“åº”åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šçŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ã€å“åº”æ•°æ®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;æˆåŠŸ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;haohao&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">     <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">300</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;æ‰§è¡Œé”™è¯¯&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ¥æ”¶Restfulé£æ ¼æ•°æ®ï¼ŒRestfulè¯·æ±‚æ•°æ®ä¸€èˆ¬ä¼šåœ¨URLåœ°å€ä¸Šæºå¸¦ï¼Œå¯ä»¥ä½¿ç”¨æ³¨è§£ @PathVariable(å ä½ç¬¦å‚æ•°åç§°)</p><p>ä¸åŠ æ³¨è§£ä¼šä»¥ä¸ºæ˜¯å‰é¢é”®å€¼å¯¹çš„å½¢å¼ã€‚</p><p><code>http://localhost/user/100</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">findUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">    System.out.println(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ±‚URLèµ„æºåœ°å€åŒ…å«å¤šä¸ªå‚æ•°æƒ…å†µ</p><p><code>http://localhost/user/haohao/18</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/user/&#123;username&#125;/&#123;age&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">findUserByUsernameAndAge</span><span class="params">(<span class="meta">@PathVariable(&quot;username&quot;)</span> String username,<span class="meta">@PathVariable(&quot;age&quot;)</span> Integer age)</span>&#123;</span><br><span class="line">    System.out.println(username+<span class="string">&quot;==&quot;</span>+age); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="2-2-4-æ¥æ”¶æ–‡ä»¶æ•°æ®">2.2.4 æ¥æ”¶æ–‡ä»¶æ•°æ®</h4><p>æ¥æ”¶æ–‡ä»¶ä¸Šä¼ çš„æ•°æ®ï¼Œæ–‡ä»¶ä¸Šä¼ çš„è¡¨å•éœ€è¦ä¸€å®šçš„è¦æ±‚ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>è¡¨å•çš„æäº¤æ–¹å¼å¿…é¡»æ˜¯POST</li><li>è¡¨å•çš„enctypeå±æ€§å¿…é¡»æ˜¯multipart/form-data</li><li>æ–‡ä»¶ä¸Šä¼ é¡¹éœ€è¦æœ‰nameå±æ€§</li></ul><div class="tabs" id="337f457c-7cf8-407b-9d5b-2b5e3ba1d172"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#337f457c-7cf8-407b-9d5b-2b5e3ba1d172-1"><i class="fas fa-bug"></i>å‰ç«¯</button></li><li class="tab"><button type="button" data-href="#337f457c-7cf8-407b-9d5b-2b5e3ba1d172-2"><i class="fas fa-cannabis"></i>æœåŠ¡å™¨ç«¯é…ç½®</button></li><li class="tab"><button type="button" data-href="#337f457c-7cf8-407b-9d5b-2b5e3ba1d172-3"><i class="fas fa-candy-cane"></i>æ¥æ”¶ä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="337f457c-7cf8-407b-9d5b-2b5e3ba1d172-1"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;myFile&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="337f457c-7cf8-407b-9d5b-2b5e3ba1d172-2"><p>æœåŠ¡å™¨ç«¯ï¼Œç”±äºæ˜ å°„å™¨é€‚é…å™¨éœ€è¦æ–‡ä»¶ä¸Šä¼ è§£æå™¨ï¼Œè€Œè¯¥è§£æå™¨é»˜è®¤æœªè¢«æ³¨å†Œï¼Œæ‰€ä»¥æ‰‹åŠ¨æ³¨å†Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨ï¼Œæ³¨æ„ï¼šidçš„åå­—æ˜¯å›ºå®šå†™æ³•--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span><span class="comment">&lt;!--æ–‡ä»¶çš„ç¼–ç æ ¼å¼ é»˜è®¤æ˜¯ISO8859-1--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSizePerFile&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1048576&quot;</span>/&gt;</span><span class="comment">&lt;!--ä¸Šä¼ çš„æ¯ä¸ªæ–‡ä»¶é™åˆ¶çš„å¤§å° å•ä½å­—èŠ‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3145728&quot;</span>/&gt;</span><span class="comment">&lt;!--ä¸Šä¼ æ–‡ä»¶çš„æ€»å¤§å°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxInMemorySize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1048576&quot;</span>/&gt;</span><span class="comment">&lt;!--ä¸Šä¼ æ–‡ä»¶çš„ç¼“å­˜å¤§å°--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è€ŒCommonsMultipartResolveråº•å±‚ä½¿ç”¨çš„Apacheçš„æ˜¯Common-fileupladç­‰å·¥å…·APIè¿›è¡Œçš„æ–‡ä»¶ä¸Šä¼ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="337f457c-7cf8-407b-9d5b-2b5e3ba1d172-3"><p>ä½¿ç”¨MultipartFileç±»å‹æ¥æ”¶ä¸Šä¼ æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/fileUpload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">fileUpload</span><span class="params">(<span class="meta">@RequestBody</span> MultipartFile myFile)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    System.out.println(myFile);</span><br><span class="line">    <span class="comment">//è·å¾—ä¸Šä¼ çš„æ–‡ä»¶çš„æµå¯¹è±¡</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> myFile.getInputStream(); <span class="comment">//ä½¿ç”¨commons-ioå­˜å‚¨åˆ°C:\haohao\abc.txtä½ç½®</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;C:\\Users\\haohao\\&quot;</span>+myFile.getOriginalFilename());</span><br><span class="line">    IOUtils.copy(inputStream,outputStream);</span><br><span class="line">    <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">    inputStream.close();</span><br><span class="line">    outputStream.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h4 id="2-2-5-æ¥æ”¶è¯·æ±‚å¤´æ•°æ®">2.2.5 æ¥æ”¶è¯·æ±‚å¤´æ•°æ®</h4><p>æ¥æ”¶Httpè¯·æ±‚å¤´æ•°æ®ï¼Œæ¥æ”¶æŒ‡å®šåç§°çš„è¯·æ±‚å¤´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/headers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">headers</span><span class="params">(<span class="meta">@RequestHeader(&quot;Accept-Encoding&quot;)</span> String acceptEncoding)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Accept-Encoding:&quot;</span>+acceptEncoding); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æ”¶æ‰€æœ‰çš„è¯·æ±‚å¤´ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/headersMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">headersMap</span><span class="params">(<span class="meta">@RequestHeader</span> Map&lt;String,String&gt; map)</span>&#123;</span><br><span class="line">    map.forEach((k,v)-&gt;&#123;</span><br><span class="line">        System.out.println(k+<span class="string">&quot;:&quot;</span>+v);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="2-2-6-æ¥æ”¶Cookieä¿¡æ¯">2.2.6 æ¥æ”¶Cookieä¿¡æ¯</h4><p>è·å¾—å®¢æˆ·ç«¯æºå¸¦çš„Cookieæ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/cookies&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">cookies</span><span class="params">(<span class="meta">@CookieValue(value = &quot;JSESSIONID&quot;,defaultValue = &quot;&quot;)</span> String jsessionid)</span>&#123;</span><br><span class="line">    System.out.println(jsessionid); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="2-2-7-æ¥æ”¶RequeståŸŸä¿¡æ¯">2.2.7 æ¥æ”¶RequeståŸŸä¿¡æ¯</h4><p>è·å¾—è½¬å‘RequeståŸŸä¸­æ•°æ®ï¼Œåœ¨è¿›è¡Œèµ„æºä¹‹é—´è½¬å‘æ—¶ï¼Œæœ‰æ—¶éœ€è¦å°†ä¸€äº›å‚æ•°å­˜å‚¨åˆ°requeståŸŸä¸­æºå¸¦ç»™ä¸‹ä¸€ä¸ªèµ„æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/request1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">request1</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="comment">//å­˜å‚¨æ•°æ®</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;haohao&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/request2&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/request2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">request2</span><span class="params">(<span class="meta">@RequestAttribute(&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">    System.out.println(username); </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="2-2-8-è¯·æ±‚å‚æ•°ä¹±ç çš„è§£å†³æ–¹æ¡ˆ">2.2.8 è¯·æ±‚å‚æ•°ä¹±ç çš„è§£å†³æ–¹æ¡ˆ</h4><p>è¯·æ±‚å‚æ•°ä¹±ç çš„è§£å†³æ–¹æ¡ˆï¼ŒSpringå·²ç»æä¾›å¥½çš„CharacterEncodingFilteræ¥è¿›è¡Œç¼–ç è¿‡æ»¤</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®å…¨å±€çš„ç¼–ç è¿‡æ»¤å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span> <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h3 id="2-3-Javawebå¸¸ç”¨å¯¹è±¡è·å–">2.3 Javawebå¸¸ç”¨å¯¹è±¡è·å–</h3><p>è·å¾—Javawebå¸¸è§åŸç”Ÿå¯¹è±¡ï¼Œæœ‰æ—¶åœ¨æˆ‘ä»¬çš„Controlleræ–¹æ³•ä¸­éœ€è¦ç”¨åˆ°Javawebçš„åŸç”Ÿå¯¹è±¡ï¼Œä¾‹å¦‚ï¼šRequestã€ Responseç­‰ï¼Œæˆ‘ä»¬åªéœ€è¦å°†éœ€è¦çš„å¯¹è±¡ä»¥å½¢å‚çš„å½¢å¼å†™åœ¨æ–¹æ³•ä¸Šï¼ŒSpringMVCæ¡†æ¶åœ¨è°ƒç”¨Controlleræ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨ä¼ é€’å®å‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/javawebObject&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">javawebObject</span><span class="params">(HttpServletRequest request, HttpServletResponse response, HttpSession session)</span>&#123;</span><br><span class="line">    System.out.println(request);</span><br><span class="line">    System.out.println(response);</span><br><span class="line">    System.out.println(session);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-4-è¯·æ±‚é™æ€èµ„æº">2.4 è¯·æ±‚é™æ€èµ„æº</h3><p>é™æ€èµ„æºè¯·æ±‚å¤±æ•ˆçš„åŸå› ï¼Œå½“DispatcherServletçš„æ˜ å°„è·¯å¾„é…ç½®ä¸º / çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±è¦†ç›–çš„Tomcatå®¹å™¨é»˜è®¤çš„ç¼ºçœServletï¼Œåœ¨Tomcatçš„configç›®å½•ä¸‹æœ‰ä¸€ä¸ªweb.xml æ˜¯å¯¹æ‰€æœ‰çš„webé¡¹ç›®çš„å…¨å±€é…ç½®ï¼Œå…¶ä¸­æœ‰å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>url-patterné…ç½®ä¸º / çš„Servletæˆ‘ä»¬ç§°å…¶ä¸ºç¼ºçœçš„Servletï¼Œä½œç”¨æ˜¯å½“å…¶ä»–Servletéƒ½åŒ¹é…ä¸æˆåŠŸæ—¶ï¼Œå°±æ‰¾ç¼ºçœçš„Servlet ï¼Œé™æ€èµ„æºç”±äºæ²¡æœ‰åŒ¹é…æˆåŠŸçš„Servletï¼Œæ‰€ä»¥ä¼šæ‰¾ç¼ºçœçš„DefaultServletï¼Œè¯¥DefaultServletå…·å¤‡äºŒæ¬¡å»åŒ¹é…é™æ€èµ„æºçš„åŠŸèƒ½ã€‚ä½†æ˜¯æˆ‘ä»¬é…ç½®DispatcherServletåå°±å°†å…¶è¦†ç›–æ‰äº†ï¼Œè€ŒDispatcherServletä¼šå°†è¯·æ±‚çš„é™æ€èµ„æºçš„åç§°å½“æˆControllerçš„æ˜ å°„è·¯å¾„å»åŒ¹é…ï¼Œå³é™æ€èµ„æºè®¿é—®ä¸æˆåŠŸäº†ï¼</p><mark class="hl-label blue">é™æ€èµ„æºè¯·æ±‚çš„ä¸‰ç§è§£å†³æ–¹æ¡ˆ</mark> <div class="tabs" id="d96bf84b-004a-4603-b9eb-da53a7fe2732"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#d96bf84b-004a-4603-b9eb-da53a7fe2732-1"><i class="fas fa-candy-cane"></i>1</button></li><li class="tab"><button type="button" data-href="#d96bf84b-004a-4603-b9eb-da53a7fe2732-2"><i class="fas fa-child"></i>2</button></li><li class="tab"><button type="button" data-href="#d96bf84b-004a-4603-b9eb-da53a7fe2732-3"><i class="fas fa-cookie-bite"></i>3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="d96bf84b-004a-4603-b9eb-da53a7fe2732-1"><p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œå¯ä»¥å†æ¬¡æ¿€æ´»Tomcatçš„DefaultServletï¼ŒServletçš„url-patternçš„åŒ¹é…ä¼˜å…ˆçº§æ˜¯ï¼šç²¾ç¡®åŒ¹é…&gt;ç›®å½•åŒ¹é…&gt;æ‰©å±•ååŒ¹é…&gt;ç¼ºçœåŒ¹é…ï¼Œæ‰€ä»¥å¯ä»¥æŒ‡å®šæŸä¸ªç›®å½•ä¸‹æˆ–æŸä¸ªæ‰©å±•åçš„èµ„æºä½¿ç”¨DefaultServletè¿›è¡Œè§£æï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/img/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.html<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d96bf84b-004a-4603-b9eb-da53a7fe2732-2"><p>ç¬¬äºŒç§æ–¹å¼ï¼Œåœ¨spring-mvc.xmlä¸­å»é…ç½®é™æ€èµ„æºæ˜ å°„ï¼ŒåŒ¹é…æ˜ å°„è·¯å¾„çš„è¯·æ±‚åˆ°æŒ‡å®šçš„ä½ç½®å»åŒ¹é…èµ„æº</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mappingæ˜¯æ˜ å°„èµ„æºè·¯å¾„ï¼Œlocationæ˜¯å¯¹åº”èµ„æºæ‰€åœ¨çš„ä½ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/img/*&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/img/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/css/*&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/css/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/css/*&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/html/*&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/html/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d96bf84b-004a-4603-b9eb-da53a7fe2732-3"><p>ç¬¬ä¸‰ç§æ–¹å¼ï¼Œåœ¨spring-mvc.xmlä¸­å»é…ç½®&lt; mvc:default-servlet-handler &gt;ï¼Œè¯¥æ–¹å¼æ˜¯æ³¨å†Œäº†ä¸€ä¸ªDefaultServletHttpRequestHandler å¤„ç†å™¨ï¼Œé™æ€èµ„æºçš„è®¿é—®éƒ½ç”±è¯¥å¤„ç†å™¨å»å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯å¼€å‘ä¸­ä½¿ç”¨æœ€å¤šçš„</p><p><code>&lt;mvc:default-servlet-handler/&gt;</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="2-5-æ³¨è§£é©±åŠ¨æ ‡ç­¾">2.5 æ³¨è§£é©±åŠ¨æ ‡ç­¾</h3><p>é™æ€èµ„æºé…ç½®çš„ç¬¬äºŒç¬¬ä¸‰ç§æ–¹å¼æˆ‘ä»¬å¯ä»¥æ­£å¸¸è®¿é—®é™æ€èµ„æºäº†ï¼Œä½†æ˜¯Controlleråˆæ— æ³•è®¿é—®äº†ï¼ŒæŠ¥é”™404ï¼Œå³æ‰¾ä¸åˆ°å¯¹åº”çš„èµ„æº</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427115829513.png" alt="image-20230427115829513"></p><p>ç¬¬äºŒç§æ–¹å¼æ˜¯é€šè¿‡SpringMVCå»è§£æmvcå‘½åç©ºé—´ä¸‹çš„resourcesæ ‡ç­¾å®Œæˆçš„é™æ€èµ„æºè§£æã€‚</p><p>ç¬¬ä¸‰ç§æ–¹å¼å¼é€šè¿‡SpringMVCå»è§£æmvcå‘½åç©ºé—´ä¸‹çš„default-servlet-handleræ ‡ç­¾å®Œæˆçš„é™æ€èµ„æºè§£æï¼Œæ ¹æ®å‰é¢æ‰€å­¦ä¹ çš„è‡ªå®šä¹‰å‘½åç©ºé—´çš„è§£æçš„çŸ¥è¯†ï¼Œå¯ä»¥å‘ç°ä¸ç®¡æ˜¯ä»¥ä¸Šå“ªç§æ–¹å¼ï¼Œæœ€ç»ˆéƒ½ä¼šæ³¨å†ŒSimpleUrlHandlerMapping</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> BeanDefinition <span class="title function_">parse</span><span class="params">(Element element, ParserContext context)</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºSimpleUrlHandlerMappingç±»å‹çš„BeanDefinition</span></span><br><span class="line">    <span class="type">RootBeanDefinition</span> <span class="variable">handlerMappingDef</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(SimpleUrlHandlerMapping.class);</span><br><span class="line">    <span class="comment">//æ³¨å†ŒSimpleUrlHandlerMappingçš„BeanDefinition</span></span><br><span class="line">    context.getRegistry().registerBeanDefinition(beanName, handlerMappingDef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆç»“åˆç»„ä»¶æµ…æçŸ¥è¯†ç‚¹ï¼Œä¸€æ—¦SpringMVCå®¹å™¨ä¸­å­˜åœ¨ HandlerMapping ç±»å‹çš„ç»„ä»¶æ—¶ï¼Œå‰ç«¯æ§åˆ¶å™¨DispatcherServletåœ¨è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œå°±ä¼šä»å®¹å™¨ä¸­è·å¾—HandlerMapping ï¼Œä¸åœ¨åŠ è½½ dispatcherServlet.propertiesä¸­é»˜è®¤å¤„ç†å™¨æ˜ å°„å™¨ç­–ç•¥ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€RequestMappingHandlerMappingä¸ä¼šè¢«åŠ è½½åˆ°äº†ã€‚</p><mark class="hl-label green">è§£å†³æ–¹æ³•</mark> <p>æ‰‹åŠ¨å°†RequestMappingHandlerMappingä¹Ÿæ³¨å†Œåˆ°SpringMVCå®¹å™¨ä¸­å°±å¯ä»¥äº†ï¼Œè¿™æ ·DispatcherServletåœ¨è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œå°±ä¼šä»å®¹å™¨ä¸­åŒæ—¶è·å¾—RequestMappingHandlerMappingå­˜å‚¨åˆ°DispatcherServletä¸­åä¸ºhandlerMappingsçš„Listé›†åˆä¸­ï¼Œå¯¹@RequestMapping æ³¨è§£è¿›è¡Œè§£æã€‚</p><p><code>&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;/&gt;</code></p><p>æ ¹æ®ä¸Šé¢çš„è®²è§£ï¼Œå¯ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œè¦æƒ³ä½¿ç”¨@RequestMappingæ­£å¸¸æ˜ å°„åˆ°èµ„æºæ–¹æ³•ï¼ŒåŒæ—¶é™æ€èµ„æºè¿˜èƒ½æ­£å¸¸è®¿é—®ï¼Œè¿˜å¯ä»¥å°†è¯·æ±‚jsonæ ¼å¼å­—ç¬¦ä¸²å’ŒJavaBeanä¹‹é—´è‡ªç”±è½¬æ¢ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨spring-mvc.xmlä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ˜¾ç¤ºé…ç½®RequestMappingHandlerMapping --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ˜¾ç¤ºé…ç½®RequestMappingHandlerAdapter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageConverters&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>/&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®DefaultServletHttpRequestHandler--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆå¤æ‚ç¹ççš„é…ç½®ï¼Œæ˜¯ä¸æ˜¯çœ‹ä¸Šå»æœ‰ç‚¹å¤´å¤§ï¼ŸSpringæ˜¯ä¸ª&quot;æš–ç”·&quot;ï¼Œå°†ä¸Šè¿°é…ç½®æµ“ç¼©æˆäº†ä¸€ä¸ªç®€å•çš„é…ç½®æ ‡ç­¾ï¼Œé‚£å°±æ˜¯mvcçš„æ³¨è§£é©±åŠ¨ï¼Œè¯¥æ ‡ç­¾å†…éƒ¨ä¼šå¸®æˆ‘ä»¬æ³¨å†ŒRequestMappingHandlerMappingã€æ³¨å†ŒRequestMappingHandlerAdapterå¹¶æ³¨å…¥Jsonæ¶ˆæ¯è½¬æ¢å™¨ç­‰ï¼Œä¸Šè¿°é…ç½®å°±å¯ä»¥ç®€åŒ–æˆå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mvcæ³¨è§£é©±åŠ¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®DefaultServletHttpRequestHandler--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>PSï¼š<code>&lt;mvc:annotation-driven&gt;</code>æ ‡ç­¾åœ¨ä¸åŒçš„ç‰ˆæœ¬ä¸­ï¼Œå¸®æˆ‘ä»¬æ³¨å†Œçš„ç»„ä»¶ä¸åŒï¼ŒSpring 3.0.X ç‰ˆæœ¬æ³¨å†Œæ˜¯DefaultAnnotationHandlerMapping å’Œ AnnotationMethodHandlerAdapterï¼Œç”±äºæ¡†æ¶çš„å‘å±•ï¼Œä»Spring 3.1.X å¼€å§‹æ³¨å†Œç»„ä»¶å˜ä¸º RequestMappingHandlerMappingå’ŒRequestMappingHandlerAdapter</p><hr><hr><h2 id="3-SpringMVCçš„å“åº”å¤„ç†">3. SpringMVCçš„å“åº”å¤„ç†</h2><p>Springçš„æ¥æ”¶è¯·æ±‚çš„éƒ¨åˆ†æˆ‘ä»¬è®²å®Œäº†ï¼Œä¸‹é¢åœ¨çœ‹ä¸€ä¸‹Springæ€ä¹ˆç»™å®¢æˆ·ç«¯å“åº”æ•°æ®ï¼Œå“åº”æ•°æ®ä¸»è¦åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š</p><ul><li>ä¼ ç»ŸåŒæ­¥æ–¹å¼ï¼šå‡†å¤‡å¥½æ¨¡å‹æ•°æ®ï¼Œåœ¨è·³è½¬åˆ°æ‰§è¡Œé¡µé¢è¿›è¡Œå±•ç¤ºï¼Œæ­¤æ–¹å¼ä½¿ç”¨è¶Šæ¥è¶Šå°‘äº†ï¼ŒåŸºäºå†å²åŸå› ï¼Œä¸€äº›æ—§é¡¹ç›®è¿˜åœ¨ä½¿ç”¨ï¼›</li><li>å‰åç«¯åˆ†ç¦»å¼‚æ­¥æ–¹å¼ï¼šå‰ç«¯ä½¿ç”¨AjaxæŠ€æœ¯+Restfulé£æ ¼ä¸æœåŠ¡ç«¯è¿›è¡ŒJsonæ ¼å¼ä¸ºä¸»çš„æ•°æ®äº¤äº’ï¼Œç›®å‰å¸‚åœºä¸Šå‡ ä¹éƒ½æ˜¯æ­¤ç§æ–¹å¼äº†ã€‚</li></ul><hr><h3 id="3-1-ä¼ ç»ŸåŒæ­¥ä¸šåŠ¡æ•°æ®å“åº”">3.1 ä¼ ç»ŸåŒæ­¥ä¸šåŠ¡æ•°æ®å“åº”</h3><p>ä¼ ç»ŸåŒæ­¥ä¸šåŠ¡åœ¨æ•°æ®å“åº”æ—¶ï¼ŒSpringMVCåˆæ¶‰åŠå¦‚ä¸‹å››ç§å½¢å¼ï¼š</p><ul><li>è¯·æ±‚èµ„æºè½¬å‘ï¼›</li><li>è¯·æ±‚èµ„æºé‡å®šå‘ï¼›</li><li>å“åº”æ¨¡å‹æ•°æ®ï¼›</li><li>ç›´æ¥å›å†™æ•°æ®ç»™å®¢æˆ·ç«¯ï¼›</li></ul><div class="tabs" id="1b606fda-ba79-4ab2-a97d-bf3bdc7032b8"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1b606fda-ba79-4ab2-a97d-bf3bdc7032b8-1"><i class="fas fa-seedling"></i>è¯·æ±‚èµ„æºè½¬å‘</button></li><li class="tab"><button type="button" data-href="#1b606fda-ba79-4ab2-a97d-bf3bdc7032b8-2"><i class="fas fa-leaf"></i>è¯·æ±‚èµ„æºé‡å®šå‘</button></li><li class="tab"><button type="button" data-href="#1b606fda-ba79-4ab2-a97d-bf3bdc7032b8-3"><i class="fab fa-apple"></i>å“åº”æ¨¡å‹æ•°æ®</button></li><li class="tab"><button type="button" data-href="#1b606fda-ba79-4ab2-a97d-bf3bdc7032b8-4"><i class="fas fa-tree"></i>ç›´æ¥å›å†™æ•°æ®ç»™å®¢æˆ·ç«¯</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1b606fda-ba79-4ab2-a97d-bf3bdc7032b8-1"><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427130024927.png" alt="image-20230427130024927"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1b606fda-ba79-4ab2-a97d-bf3bdc7032b8-2"><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427130126669.png" alt="image-20230427130126669"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1b606fda-ba79-4ab2-a97d-bf3bdc7032b8-3"><p>å“åº”æ¨¡å‹æ•°æ®ï¼Œå“åº”æ¨¡å‹æ•°æ®æœ¬è´¨ä¹Ÿæ˜¯è½¬å‘ï¼Œåœ¨è½¬å‘æ—¶å¯ä»¥å‡†å¤‡æ¨¡å‹æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/forward5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">forward5</span><span class="params">(ModelAndView modelAndView)</span>&#123;</span><br><span class="line">    <span class="comment">//å‡†å¤‡JavaBeanæ¨¡å‹æ•°æ®</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(<span class="string">&quot;haohao&quot;</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ¨¡å‹</span></span><br><span class="line">    modelAndView.addObject(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">    <span class="comment">//è®¾ç½®è§†å›¾</span></span><br><span class="line">    modelAndView.setViewName(<span class="string">&quot;/index.jsp&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1b606fda-ba79-4ab2-a97d-bf3bdc7032b8-4"><p>ç›´æ¥å›å†™æ•°æ®ï¼Œç›´æ¥é€šè¿‡æ–¹æ³•çš„è¿”å›å€¼è¿”å›ç»™å®¢æˆ·ç«¯çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯SpringMVCé»˜è®¤çš„æ–¹æ³•è¿”å›å€¼æ˜¯è§†å›¾ï¼Œå¯ä»¥é€šè¿‡@ResponseBody æ³¨è§£æ˜¾ç¤ºçš„å‘ŠçŸ¥æ­¤å¤„çš„è¿”å›å€¼ä¸è¦è¿›è¡Œè§†å›¾å¤„ç†ï¼Œæ˜¯è¦ä»¥å“åº”ä½“çš„æ–¹å¼å¤„ç†çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/response2&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">response2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello haohao!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="3-2-å‰åç«¯åˆ†ç¦»å¼‚æ­¥ä¸šåŠ¡æ•°æ®å“åº”">3.2 å‰åç«¯åˆ†ç¦»å¼‚æ­¥ä¸šåŠ¡æ•°æ®å“åº”</h3><p>å…¶å®æ­¤å¤„çš„å›å†™æ•°æ®ï¼Œè·Ÿä¸Šé¢å›å†™æ•°æ®ç»™å®¢æˆ·ç«¯çš„è¯­æ³•æ–¹å¼ä¸€æ ·ï¼Œåªä¸è¿‡æœ‰å¦‚ä¸‹ä¸€äº›åŒºåˆ«ï¼š</p><ul><li>åŒæ­¥æ–¹å¼å›å†™æ•°æ®ï¼Œæ˜¯å°†æ•°æ®å“åº”ç»™æµè§ˆå™¨è¿›è¡Œé¡µé¢å±•ç¤ºçš„ï¼Œè€Œå¼‚æ­¥æ–¹å¼å›å†™æ•°æ®ä¸€èˆ¬æ˜¯å›å†™ç»™Ajaxå¼•æ“çš„ï¼Œå³è°è®¿é—®æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯å°±å°†æ•°æ®å“åº”ç»™è°</li><li>åŒæ­¥æ–¹å¼å›å†™çš„æ•°æ®ï¼Œä¸€èˆ¬å°±æ˜¯ä¸€äº›æ— ç‰¹å®šæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œè€Œå¼‚æ­¥æ–¹å¼å›å†™çš„æ•°æ®å¤§å¤šæ˜¯Jsonæ ¼å¼å­—ç¬¦ä¸²</li></ul><p>å›å†™æ™®é€šæ•°æ®ä½¿ç”¨@ResponseBodyæ ‡æ³¨æ–¹æ³•ï¼Œç›´æ¥è¿”å›å­—ç¬¦ä¸²å³å¯ï¼Œæ­¤å¤„ä¸åœ¨è¯´æ˜ï¼›</p><div class="tabs" id="ab67edd5-269d-496f-bff8-15db18faca6b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ab67edd5-269d-496f-bff8-15db18faca6b-1"><i class="fas fa-cat"></i>å›å†™Jsonæ ¼å¼çš„å­—ç¬¦ä¸²</button></li><li class="tab"><button type="button" data-href="#ab67edd5-269d-496f-bff8-15db18faca6b-2"><i class="fas fa-horse"></i>å›å†™JavaBean</button></li><li class="tab"><button type="button" data-href="#ab67edd5-269d-496f-bff8-15db18faca6b-3"><i class="fas fa-dove"></i>ResponseBodyæ³¨è§£ä½¿ç”¨ä¼˜åŒ–</button></li><li class="tab"><button type="button" data-href="#ab67edd5-269d-496f-bff8-15db18faca6b-4"><i class="fas fa-dragon"></i>RestControlleræ³¨è§£è¿›ä¸€æ­¥ä¼˜åŒ–</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ab67edd5-269d-496f-bff8-15db18faca6b-1"><p>å›å†™Jsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå³å°†ç›´æ¥æ‹¼æ¥Jsonæ ¼å¼çš„å­—ç¬¦ä¸²æˆ–ä½¿ç”¨å·¥å…·å°†JavaBeanè½¬æ¢æˆJsonæ ¼å¼çš„å­—ç¬¦ä¸²å›å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/response3&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">response3</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;username\&quot;:\&quot;haohao\&quot;,\&quot;age\&quot;:18&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/response4&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">response4</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºJavaBean</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(<span class="string">&quot;haohao&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="comment">//ä½¿ç”¨Jacksonè½¬æ¢æˆjsonæ ¼å¼çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(user); </span><br><span class="line">    <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ab67edd5-269d-496f-bff8-15db18faca6b-2"><p>åœ¨è®²è§£SringMVCæ¥æ”¶è¯·æ±‚æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯æäº¤çš„Jsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿæ˜¯ä½¿ç”¨Jacksonè¿›è¡Œçš„æ‰‹åŠ¨è½¬æ¢æˆJavaBean ï¼Œå¯ä»¥å½“æˆ‘ä»¬ä½¿ç”¨äº†@RequestBodyæ—¶ï¼Œç›´æ¥ç”¨JavaBeanå°±æ¥æ”¶äº†Jsonæ ¼å¼çš„æ•°æ®ï¼ŒåŸç†å…¶å®å°±æ˜¯SpringMVCåº•å±‚å¸®æˆ‘ä»¬åšäº†è½¬æ¢ï¼Œæ­¤å¤„@ResponseBodyä¹Ÿå¯ä»¥å°†JavaBeanè‡ªåŠ¨ç»™æˆ‘ä»¬è½¬æ¢æˆJsonæ ¼å¼å­—ç¬¦ä¸²å›å“åº”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/response5&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">response5</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºJavaBean</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(); user.setUsername(<span class="string">&quot;haohao&quot;</span>); </span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="comment">//ç›´æ¥è¿”å›Userå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ab67edd5-269d-496f-bff8-15db18faca6b-3"><p>@ResponseBodyæ³¨è§£ä½¿ç”¨ä¼˜åŒ–ï¼Œåœ¨è¿›è¡Œå‰åç«¯åˆ†ç¦»å¼€å‘æ—¶ï¼ŒControllerçš„æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯ç›´æ¥å›å†™æ•°æ®çš„ï¼Œæ‰€ä»¥æ¯ä¸ªæ–¹æ³•ä¸Šéƒ½å¾—å†™@ResponseBodyï¼Œ<span class='p blue'>å¯ä»¥å°†@ResponseBodyå†™åˆ°Controllerä¸Š</span>ï¼Œé‚£ä¹ˆè¯¥Controllerä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½å…·å¤‡äº†è¿”å›å“åº”ä½“æ•°æ®çš„åŠŸèƒ½äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/response7&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultInfo <span class="title function_">response7</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/response5&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">response5</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–æ–¹æ³• ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ab67edd5-269d-496f-bff8-15db18faca6b-4"><p><span class='p green'>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨@RestControlleræ›¿ä»£@Controllerå’Œ@ResponseBodyï¼Œ@RestControllerå†…éƒ¨å…·å¤‡çš„è¿™ä¸¤ä¸ªæ³¨è§£çš„åŠŸèƒ½</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/response7&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultInfo <span class="title function_">response7</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/response5&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">response5</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–æ–¹æ³• ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><hr><h2 id="4-SpringMVCçš„æ‹¦æˆªå™¨">4. SpringMVCçš„æ‹¦æˆªå™¨</h2><h3 id="4-1-æ‹¦æˆªå™¨-Interceptor-ç®€ä»‹">4.1 æ‹¦æˆªå™¨ Interceptor ç®€ä»‹</h3><p>SpringMVCçš„æ‹¦æˆªå™¨Interceptorè§„èŒƒï¼Œä¸»è¦æ˜¯å¯¹Controllerèµ„æºè®¿é—®æ—¶è¿›è¡Œæ‹¦æˆªæ“ä½œçš„æŠ€æœ¯ï¼Œå½“ç„¶æ‹¦æˆªåå¯ä»¥è¿›è¡Œæƒé™æ§åˆ¶ï¼ŒåŠŸèƒ½å¢å¼ºç­‰éƒ½æ˜¯å¯ä»¥çš„ã€‚æ‹¦æˆªå™¨æœ‰ç‚¹ç±»ä¼¼ Javaweb å¼€å‘ä¸­çš„Filterï¼ŒInterceptorä¸Filterçš„åŒºåˆ«å¦‚ä¸‹å›¾ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230428215535084.png" alt="image-20230428215535084" style="zoom:67%;" /><p>ç”±ä¸Šå›¾ï¼Œå¯¹<code>Filter</code>å’Œ<code>Interceptor</code>åšä¸ªå¯¹æ¯”ï¼š</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:left">FilteræŠ€æœ¯</th><th style="text-align:left">InterceptoræŠ€æœ¯</th></tr></thead><tbody><tr><td style="text-align:left">æŠ€æœ¯èŒƒç•´</td><td style="text-align:left">JavawebåŸç”ŸæŠ€æœ¯</td><td style="text-align:left">SpringMVCæ¡†æ¶æŠ€æœ¯</td></tr><tr><td style="text-align:left">æ‹¦æˆª/è¿‡æ»¤èµ„æº</td><td style="text-align:left">å¯ä»¥å¯¹æ‰€æœ‰è¯·æ±‚éƒ½è¿‡æ»¤ï¼ŒåŒ…æ‹¬ä»»ä½•Servletã€Jspã€å…¶ä»–èµ„æºç­‰</td><td style="text-align:left">åªå¯¹è¿›å…¥äº†SpringMVCç®¡è¾–èŒƒå›´çš„æ‰æ‹¦æˆªï¼Œä¸»è¦æ‹¦æˆªControllerè¯·æ±‚</td></tr><tr><td style="text-align:left">æ‰§è¡Œæ—¶æœº</td><td style="text-align:left">æ—©äºä»»ä½•Servletæ‰§è¡Œ</td><td style="text-align:left">æ™šäºDispatcherServletæ‰§è¡Œ</td></tr></tbody></table><span class='p blue'>å®ç°äº†HandlerInterceptoræ¥å£ï¼Œä¸”è¢«Springç®¡ç†çš„Beanéƒ½æ˜¯æ‹¦æˆªå™¨</span><p>æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line"><span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params"><span class="meta">@Nullable</span> ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params"><span class="meta">@Nullable</span> Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HandlerInterceptoræ¥å£æ–¹æ³•çš„ä½œç”¨åŠå…¶å‚æ•°ã€è¿”å›å€¼è¯¦è§£å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:left">ä½œç”¨</th><th style="text-align:left">å‚æ•°</th><th style="text-align:left">è¿”å›å€¼</th></tr></thead><tbody><tr><td style="text-align:left">preHandle</td><td style="text-align:left">å¯¹æ‹¦æˆªåˆ°çš„è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œè¿”å›trueæ”¾è¡Œæ‰§è¡Œå¤„ç†å™¨æ–¹æ³•ï¼Œfalseä¸æ”¾è¡Œ</td><td style="text-align:left">Handleræ˜¯æ‹¦æˆªåˆ°çš„Controlleræ–¹æ³•å¤„ç†å™¨</td><td style="text-align:left">ä¸€æ—¦è¿”å›falseï¼Œä»£è¡¨ç»ˆæ­¢å‘åæ‰§è¡Œï¼Œæ‰€æœ‰åç½®æ–¹æ³•éƒ½ä¸æ‰§è¡Œï¼Œæœ€ç»ˆæ–¹æ³•åªæ‰§è¡Œå¯¹åº”preHandleè¿”å›äº†trueçš„</td></tr><tr><td style="text-align:left">postHandle</td><td style="text-align:left">åœ¨å¤„ç†å™¨çš„æ–¹æ³•æ‰§è¡Œåï¼Œå¯¹æ‹¦æˆªåˆ°çš„è¯·æ±‚è¿›è¡Œåå¤„ç†ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä¸­å¯¹æ¨¡å‹æ•°æ®å’Œè§†å›¾è¿›è¡Œä¿®æ”¹</td><td style="text-align:left">Handleræ˜¯æ‹¦æˆªåˆ°çš„Controlleræ–¹æ³•å¤„ç†å™¨ï¼›modelAndViewæ˜¯è¿”å›çš„æ¨¡å‹è§†å›¾å¯¹è±¡</td><td style="text-align:left">æ— </td></tr><tr><td style="text-align:left">afterCompletion</td><td style="text-align:left">è§†å›¾æ¸²æŸ“å®Œæˆå(æ•´ä¸ªæµç¨‹ç»“æŸä¹‹å)ï¼Œè¿›è¡Œæœ€åçš„å¤„ç†ï¼Œå¦‚æœè¯·æ±‚æµç¨‹ä¸­æœ‰å¼‚å¸¸ï¼Œå¯ä»¥å¤„ç†å¼‚å¸¸å¯¹è±¡</td><td style="text-align:left">Handleræ˜¯æ‹¦æˆªåˆ°çš„Controlleræ–¹æ³•å¤„ç†å™¨ï¼›exæ˜¯å¼‚å¸¸å¯¹è±¡</td><td style="text-align:left">æ— </td></tr></tbody></table><hr><h3 id="4-2-æ‹¦æˆªå™¨å¿«é€Ÿå…¥é—¨">4.2 æ‹¦æˆªå™¨å¿«é€Ÿå…¥é—¨</h3><div class="tabs" id="177b295e-598d-472a-ab76-335a04e1c870"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#177b295e-598d-472a-ab76-335a04e1c870-1"><i class="fas fa-heartbeat"></i>ç¼–å†™MyInterceptor01å®ç°HandlerInterceptoræ¥å£</button></li><li class="tab"><button type="button" data-href="#177b295e-598d-472a-ab76-335a04e1c870-2"><i class="fas fa-cookie-bite"></i>é…ç½®Interceptor</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="177b295e-598d-472a-ab76-335a04e1c870-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor01</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Controlleræ–¹æ³•æ‰§è¡Œä¹‹å‰...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Controlleræ–¹æ³•æ‰§è¡Œä¹‹å...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¸²æŸ“è§†å›¾ç»“æŸï¼Œæ•´ä¸ªæµç¨‹å®Œæ¯•...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="177b295e-598d-472a-ab76-335a04e1c870-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®æ‹¦æˆªå™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.interceptors.MyInterceptor1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="4-3-æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåº">4.3 æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåº</h3><p>æ‹¦æˆªå™¨ä¸‰ä¸ªæ–¹æ³•çš„æ‰§è¡Œé¡ºåº<br>å½“æ¯ä¸ªæ‹¦æˆªå™¨éƒ½æ˜¯æ”¾è¡ŒçŠ¶æ€æ—¶ï¼Œä¸‰ä¸ªæ–¹æ³•çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230428221116031.png" alt="image-20230428221116031" style="zoom:67%;" /><p>å½“Interceptor1å’ŒInterceptor2å¤„äºæ”¾è¡Œï¼ŒInterceptor3å¤„äºä¸æ”¾è¡Œæ—¶ï¼Œä¸‰ä¸ªæ–¹æ³•çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230428221434011.png" alt="image-20230428221434011" style="zoom:67%;" /><p>æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåºå–å†³äº interceptor çš„é…ç½®é¡ºåº</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/target&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.interceptor.MyInterceptor02&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.interceptor.MyInterceptor01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span id="jump2"></span></p><hr><h3 id="4-4-æ‹¦æˆªå™¨æ‰§è¡ŒåŸç†">4.4 æ‹¦æˆªå™¨æ‰§è¡ŒåŸç†</h3><p><a href="#jump1">ç‚¹å‡»è·³è½¬â†‘â†‘â†‘â†‘</a></p><div class="tabs" id="73c56bbf-a064-4950-b013-efd9d1f432e7"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#73c56bbf-a064-4950-b013-efd9d1f432e7-1"><i class="fas fa-atom"></i>1</button></li><li class="tab"><button type="button" data-href="#73c56bbf-a064-4950-b013-efd9d1f432e7-2"><i class="far fa-sun"></i>2</button></li><li class="tab"><button type="button" data-href="#73c56bbf-a064-4950-b013-efd9d1f432e7-3"><i class="fas fa-wind"></i>3</button></li><li class="tab"><button type="button" data-href="#73c56bbf-a064-4950-b013-efd9d1f432e7-4"><i class="fas fa-fire-alt"></i>4</button></li><li class="tab"><button type="button" data-href="#73c56bbf-a064-4950-b013-efd9d1f432e7-5"><i class="fas fa-cookie-bite"></i>5</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="73c56bbf-a064-4950-b013-efd9d1f432e7-1"><p>è¯·æ±‚åˆ°æ¥æ—¶å…ˆä¼šä½¿ç”¨ç»„ä»¶<code>HandlerMapping</code>å»åŒ¹é…Controllerçš„æ–¹æ³•ï¼ˆHandlerï¼‰å’Œç¬¦åˆæ‹¦æˆªè·¯å¾„çš„Interceptorï¼Œ Handlerå’Œå¤šä¸ªInterceptorè¢«å°è£…æˆä¸€ä¸ª<code>HandlerExecutionChain</code>çš„å¯¹è±¡<code>HandlerExecutionChain</code>å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandlerExecutionChain</span> &#123;</span><br><span class="line">    <span class="comment">//æ˜ å°„çš„Controllerçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object handler;</span><br><span class="line">    <span class="comment">//å½“å‰HandleråŒ¹é…çš„æ‹¦æˆªå™¨é›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;HandlerInterceptor&gt; interceptorList;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–ä»£ç  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="73c56bbf-a064-4950-b013-efd9d1f432e7-2"><p>åœ¨DispatcherServletçš„doDispatchæ–¹æ³•ä¸­æ‰§è¡Œæ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span>&#123;</span><br><span class="line">    <span class="comment">//æ ¹æ®è¯·æ±‚ä¿¡æ¯è·å¾—HandlerExecutionChain</span></span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="built_in">this</span>.getHandler(request);</span><br><span class="line">    <span class="comment">//è·å¾—å¤„ç†å™¨é€‚é…å™¨</span></span><br><span class="line">    <span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> <span class="built_in">this</span>.getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line">    <span class="comment">//æ‰§è¡ŒInterceptorçš„å‰ç½®æ–¹æ³•ï¼Œå‰ç½®æ–¹æ³•å¦‚æœè¿”å›falseï¼Œåˆ™è¯¥æµç¨‹ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (!mappedHandler.applyPreHandle(request, response)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ‰§è¡Œhandlerï¼Œä¸€èˆ¬æ˜¯HandlerMethod</span></span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">    <span class="comment">//æ‰§è¡Œåç½®æ–¹æ³•</span></span><br><span class="line">    mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">    <span class="comment">//æ‰§è¡Œæœ€ç»ˆæ–¹æ³•</span></span><br><span class="line">    <span class="built_in">this</span>.triggerAfterCompletion(processedRequest, response, mappedHandler, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="73c56bbf-a064-4950-b013-efd9d1f432e7-3"><p>è·Ÿè¸ª HandlerExecutionChainçš„applyPreHandleæ–¹æ³•æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">applyPreHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//å¯¹interceptorListè¿›è¡Œéå†,æ­£å‘éå†,ä¸æ­¤åŒæ—¶ä½¿ç”¨interceptorIndexè¿›è¡Œè®¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.interceptorList.size(); <span class="built_in">this</span>.interceptorIndex = i++) &#123;</span><br><span class="line">        <span class="comment">//å–å‡ºæ¯ä¸€ä¸ªInterceptorå¯¹è±¡</span></span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> (HandlerInterceptor)<span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">        <span class="comment">//è°ƒç”¨Interceptorçš„preHandleæ–¹æ³•ï¼Œå¦‚æœè¿”å›falseï¼Œåˆ™ç›´æ¥æ‰§è¡ŒInterceptorçš„æœ€ç»ˆæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (!interceptor.preHandle(request, response, <span class="built_in">this</span>.handler)) &#123;</span><br><span class="line">            <span class="comment">//æ‰§è¡ŒInterceptorçš„æœ€ç»ˆæ–¹æ³•</span></span><br><span class="line">            <span class="built_in">this</span>.triggerAfterCompletion(request, response, (Exception)<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="73c56bbf-a064-4950-b013-efd9d1f432e7-4"><p>è·Ÿè¸ª HandlerExecutionChainçš„applyPostHandleæ–¹æ³•æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">applyPostHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, <span class="meta">@Nullable</span> ModelAndView mv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//å¯¹interceptorListè¿›è¡Œéå†ï¼Œé€†å‘éå†</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        <span class="comment">//å–å‡ºæ¯ä¸€ä¸ªInterceptor</span></span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> (HandlerInterceptor)<span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">        <span class="comment">//æ‰§è¡ŒInterceptorçš„postHandleæ–¹æ³•</span></span><br><span class="line">        interceptor.postHandle(request, response, <span class="built_in">this</span>.handler, mv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="73c56bbf-a064-4950-b013-efd9d1f432e7-5"><p>è·Ÿè¸ªHandlerExecutionChainçš„triggerAfterCompletionæ–¹æ³•æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">triggerAfterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, <span class="meta">@Nullable</span> Exception ex)</span> &#123;</span><br><span class="line">    <span class="comment">//é€†å‘éå†interceptorListï¼Œéå†çš„ä¸ªæ•°ä¸ºæ‰§è¡Œçš„applyPreHandleæ¬¡æ•°-1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorIndex; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        <span class="comment">//å–å‡ºæ¯ä¸€ä¸ªInterceptor</span></span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> (HandlerInterceptor)<span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æ‰§è¡ŒInterceptorçš„afterCompletionæ–¹æ³•</span></span><br><span class="line">            interceptor.afterCompletion(request, response, <span class="built_in">this</span>.handler, ex);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var7) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;HandlerInterceptor.afterCompletion threw exception&quot;</span>, var7);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230428221714196.png" alt="image-20230428221714196" style="zoom:67%;" /><hr><hr><h2 id="5-SpringMVCçš„å…¨æ³¨è§£å¼€å‘">5. SpringMVCçš„å…¨æ³¨è§£å¼€å‘</h2><h3 id="5-1-æ¶ˆé™¤spring-mvc-xmlç»„ä»¶">5.1 æ¶ˆé™¤spring-mvc.xmlç»„ä»¶</h3><div class="tabs" id="15e4bd8b-7d33-4da6-bec9-4983cdcf9b98"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-1"><i class="fas fa-cat"></i>1</button></li><li class="tab"><button type="button" data-href="#15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-2"><i class="fas fa-horse"></i>2</button></li><li class="tab"><button type="button" data-href="#15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-3"><i class="fas fa-dove"></i>3</button></li><li class="tab"><button type="button" data-href="#15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-4"><i class="fas fa-dragon"></i>4</button></li><li class="tab"><button type="button" data-href="#15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-5"><i class="fas fa-heartbeat"></i>5</button></li><li class="tab"><button type="button" data-href="#15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-6"><i class="fas fa-cookie-bite"></i>6</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-1"><p>è·Ÿä¹‹å‰å…¨æ³¨è§£å¼€å‘æ€è·¯ä¸€è‡´ï¼Œ xmlé…ç½®æ–‡ä»¶ä½¿ç”¨æ ¸å¿ƒé…ç½®ç±»æ›¿ä»£ï¼Œxmlä¸­çš„æ ‡ç­¾ä½¿ç”¨å¯¹åº”çš„æ³¨è§£æ›¿ä»£</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç»„ä»¶æ‰«æwebå±‚ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima.controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ³¨è§£é©±åŠ¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®æ‹¦æˆªå™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.interceptor.MyInterceptor01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®DefaultServletHttpRequestHandler--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-2"><ul><li>ç»„ä»¶æ‰«æï¼Œå¯ä»¥é€šè¿‡@ComponentScanæ³¨è§£å®Œæˆï¼›</li><li>æ–‡ä»¶ä¸Šä¼ è§£æå™¨multipartResolverå¯ä»¥é€šè¿‡éè‡ªå®šä¹‰Beançš„æ³¨è§£é…ç½®æ–¹å¼ï¼Œå³@Beanæ³¨è§£å®Œæˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMVCConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CommonsMultipartResolver <span class="title function_">multipartResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CommonsMultipartResolver</span> <span class="variable">multipartResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonsMultipartResolver</span>();</span><br><span class="line">        multipartResolver.setDefaultEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        multipartResolver.setMaxUploadSize(<span class="number">5000000</span>);</span><br><span class="line">        <span class="keyword">return</span> multipartResolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-3"><p><code>&lt;mvc:annotation-driven&gt;</code>ã€<code>&lt;mvc:default-servlet-handler /&gt;</code> å’Œ <code>&lt;mvc:interceptor &gt; </code>æ€ä¹ˆåŠå‘¢ï¼ŸSpringMVC æä¾›äº†ä¸€ä¸ªæ³¨è§£<code>@EnableWebMvc</code>ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æºç ï¼Œå†…éƒ¨é€šè¿‡@Import å¯¼å…¥äº†<code>DelegatingWebMvcConfiguration</code>ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(&#123;DelegatingWebMvcConfiguration.class&#125;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebMvcConfigurerComposite</span> <span class="variable">configurers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerComposite</span>();</span><br><span class="line">    <span class="comment">//ä»å®¹å™¨ä¸­æ³¨å…¥WebMvcConfigurerç±»å‹çš„Bean</span></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>WebMvcConfigurerç±»å‹çš„Beanä¼šè¢«æ³¨å…¥è¿›æ¥ï¼Œç„¶åè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-4"><p>æ‰€ä»¥å¯ä»¥å®ç°WebMvcConfigureræ¥å£ï¼Œå®Œæˆä¸€äº›è§£æå™¨ã€é»˜è®¤Servletç­‰çš„æŒ‡å®šï¼ŒWebMvcConfigureræ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">//é…ç½®é»˜è®¤Servetå¤„ç†å™¨</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123; &#125;</span><br><span class="line">    <span class="comment">//æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123; &#125;</span><br><span class="line">    <span class="comment">//æ·»åŠ èµ„æºå¤„ç†å™¨</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123; &#125;</span><br><span class="line">    <span class="comment">//æ·»åŠ è§†å›¾æ§åˆ¶å™¨</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123; &#125;</span><br><span class="line">    <span class="comment">//é…ç½®è§†å›¾è§£æå™¨</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> &#123; &#125;</span><br><span class="line">    <span class="comment">//æ·»åŠ å‚æ•°è§£æå™¨</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addArgumentResolvers</span><span class="params">(List&lt;HandlerMethodArgumentResolver&gt; resolvers)</span> &#123; &#125;</span><br><span class="line">    <span class="comment">//... çœç•¥å…¶ä»–ä»£ç  ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-5"><p>åˆ›å»ºMyWebMvcConfigurerå®ç°WebMvcConfigureræ¥å£ï¼Œå®ç°addInterceptors å’ŒconfigureDefaultServletHandlingæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebMvcConfigurer</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">        <span class="comment">//å¼€å¯é»˜è®¤çš„Servletå¤„ç†å™¨ï¼Œå¯ä»¥å¤„ç†é™æ€èµ„æºäº†</span></span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//æ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå¹¶é…ç½®æ‹¦æˆªè·¯å¾„</span></span><br><span class="line">        <span class="comment">//Interceptorçš„æ‰§è¡Œé¡ºåºä¹Ÿå–å†³äºæ·»åŠ é¡ºåº</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">MyInterceptor1</span>()).addPathPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="15e4bd8b-7d33-4da6-bec9-4983cdcf9b98-6"><p>æœ€åï¼Œåœ¨SpringMVCæ ¸å¿ƒé…ç½®ç±»ä¸Šæ·»åŠ @EnableWebMvcæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima.controller&quot;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMVCConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CommonsMultipartResolver <span class="title function_">multipartResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CommonsMultipartResolver</span> <span class="variable">multipartResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonsMultipartResolver</span>();</span><br><span class="line">        multipartResolver.setDefaultEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        multipartResolver.setMaxUploadSize(<span class="number">5000000</span>);</span><br><span class="line">        <span class="keyword">return</span> multipartResolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="5-2-DispatcherServleté…ç½®ç±»">5.2 DispatcherServleté…ç½®ç±»</h3><div class="tabs" id="8be97b62-9b86-45b2-aa60-c48a9fd18aeb"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#8be97b62-9b86-45b2-aa60-c48a9fd18aeb-1"><i class="fas fa-cat"></i>xmlé…ç½®</button></li><li class="tab"><button type="button" data-href="#8be97b62-9b86-45b2-aa60-c48a9fd18aeb-2"><i class="fas fa-horse"></i>æ³¨è§£é…ç½®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="8be97b62-9b86-45b2-aa60-c48a9fd18aeb-1"><p>DispatcherServletåœ¨è¿›è¡ŒSpringMVCé…ç½®æ–‡ä»¶åŠ è½½æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ä»¥ä¸‹æ–¹å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æŒ‡å®šspringMVCé…ç½®æ–‡ä»¶ä½ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æœåŠ¡å™¨å¯åŠ¨å°±åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span> <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8be97b62-9b86-45b2-aa60-c48a9fd18aeb-2"><p>ç°åœ¨æ˜¯ä½¿ç”¨SpringMVCConfigæ ¸å¿ƒé…ç½®ç±»ææ›¿ä»£çš„spring-mvc.xmlï¼Œæ€ä¹ˆåŠ è½½å‘¢ï¼Ÿå‚ç…§Springçš„ContextLoaderListeneråŠ è½½æ ¸å¿ƒé…ç½®ç±»çš„åšæ³•ï¼Œå®šä¹‰äº†ä¸€ä¸ªAnnotationConfigWebApplicationContextï¼Œé€šè¿‡ä»£ç æ³¨å†Œæ ¸å¿ƒé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAnnotationConfigWebApplicationContext</span> <span class="keyword">extends</span> <span class="title class_">AnnotationConfigWebApplicationContext</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyAnnotationConfigWebApplicationContext</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//æ³¨å†Œæ ¸å¿ƒé…ç½®ç±»</span></span><br><span class="line">        <span class="built_in">super</span>.register(SpringMVCConfig.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æŒ‡å®šspringMVCçš„applicationContextå…¨é™å®šå --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.itheima.config.MyAnnotationConfigWebApplicationContext<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="5-3-æ¶ˆé™¤web-xml">5.3 æ¶ˆé™¤web.xml</h3><div class="tabs" id="9213ea2e-edef-4166-931e-30d4de02cc8d"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#9213ea2e-edef-4166-931e-30d4de02cc8d-1"><i class="fas fa-award"></i>web.xml</button></li><li class="tab"><button type="button" data-href="#9213ea2e-edef-4166-931e-30d4de02cc8d-2"><i class="fas fa-baseball-ball"></i>è§£å†³æ€è·¯</button></li><li class="tab"><button type="button" data-href="#9213ea2e-edef-4166-931e-30d4de02cc8d-3"><i class="fas fa-bone"></i>æ³¨è§£é…ç½®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="9213ea2e-edef-4166-931e-30d4de02cc8d-1"><p>ç›®å‰ï¼Œå‡ ä¹æ¶ˆé™¤äº†é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯webå·¥ç¨‹çš„å…¥å£è¿˜æ˜¯ä½¿ç”¨çš„web.xmlè¿›è¡Œé…ç½®çš„ï¼Œå¦‚ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®springMVCå‰ç«¯æ§åˆ¶å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--æŒ‡å®šspringMVCçš„applicationContextå…¨é™å®šå --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.itheima.config.MyAnnotationConfigWebApplicationContext<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æœåŠ¡å™¨å¯åŠ¨å°±åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span> <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9213ea2e-edef-4166-931e-30d4de02cc8d-2"><ul><li>Servlet3.0ç¯å¢ƒä¸­ï¼Œwebå®¹å™¨æä¾›äº†javax.servlet.ServletContainerInitializeræ¥å£ï¼Œå®ç°äº†è¯¥æ¥å£åï¼Œåœ¨å¯¹åº”çš„ç±»åŠ è½½è·¯å¾„çš„META-INF/services ç›®å½•åˆ›å»ºä¸€ä¸ªåä¸ºjavax.servlet.ServletContainerInitializerçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æŒ‡å®šå…·ä½“çš„ServletContainerInitializerå®ç°ç±»ï¼Œé‚£ä¹ˆï¼Œå½“webå®¹å™¨å¯åŠ¨æ—¶å°±ä¼šè¿è¡Œè¿™ä¸ªåˆå§‹åŒ–å™¨åšä¸€äº›ç»„ä»¶å†…çš„åˆå§‹åŒ–å·¥ä½œï¼›</li><li>åŸºäºè¿™ä¸ªç‰¹æ€§ï¼ŒSpringå°±å®šä¹‰äº†ä¸€ä¸ªSpringServletContainerInitializerå®ç°äº†ServletContainerInitializeræ¥å£;</li><li>è€ŒSpringServletContainerInitializerä¼šæŸ¥æ‰¾å®ç°äº†WebApplicationInitializerçš„ç±»ï¼ŒSpringåˆæä¾›äº†ä¸€ä¸ªWebApplicationInitializerçš„åŸºç¡€å®ç°ç±»AbstractAnnotationConfigDispatcherServletInitializerï¼Œå½“æˆ‘ä»¬ç¼–å†™ç±»ç»§æ‰¿AbstractAnnotationConfigDispatcherServletInitializeræ—¶ï¼Œå®¹å™¨å°±ä¼šè‡ªåŠ¨å‘ç°æˆ‘ä»¬è‡ªå·±çš„ç±»ï¼Œåœ¨è¯¥ç±»ä¸­æˆ‘ä»¬å°±å¯ä»¥é…ç½®Springå’ŒSpringMVCçš„å…¥å£äº†ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9213ea2e-edef-4166-931e-30d4de02cc8d-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAnnotationConfigDispatcherServletInitializer</span> <span class="keyword">extends</span></span><br><span class="line">        <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line">    <span class="comment">//æä¾›Springå®¹å™¨æ ¸å¿ƒé…ç½®ç±»</span></span><br><span class="line">    <span class="comment">//è¿”å›çš„å¸¦æœ‰@Configurationæ³¨è§£çš„ç±»ç”¨æ¥é…ç½®ContextLoaderListener</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ è½½æ ¸å¿ƒé…ç½®ç±»åˆ›å»ºContextLoaderListener&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;ApplicationContextConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æä¾›SpringMVCå®¹å™¨æ ¸å¿ƒé…ç½®ç±»</span></span><br><span class="line">    <span class="comment">//è¿”å›çš„å¸¦æœ‰@Configurationæ³¨è§£çš„ç±»ç”¨æ¥é…ç½®DispatcherServlet</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ è½½æ ¸å¿ƒé…ç½®ç±»åˆ›å»ºDispatcherServlet&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringMVCConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æä¾›å‰ç«¯æ§åˆ¶å™¨çš„æ˜ å°„è·¯å¾„</span></span><br><span class="line">    <span class="comment">//å°†ä¸€ä¸ªæˆ–å¤šä¸ªè·¯å¾„æ˜ å°„åˆ°DispatcherServletä¸Š</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><hr><h2 id="6-SpringMVCçš„ç»„ä»¶åŸç†å‰–æ">6. SpringMVCçš„ç»„ä»¶åŸç†å‰–æ</h2><h3 id="6-1-å‰ç«¯æ§åˆ¶å™¨åˆå§‹åŒ–">6.1 å‰ç«¯æ§åˆ¶å™¨åˆå§‹åŒ–</h3><p>å‰ç«¯æ§åˆ¶å™¨DispatcherServletæ˜¯SpringMVCçš„å…¥å£ï¼Œä¹Ÿæ˜¯SpringMVCçš„å¤§è„‘ï¼Œä¸»æµç¨‹çš„å·¥ä½œéƒ½æ˜¯åœ¨æ­¤å®Œæˆçš„ï¼Œæ¢³ç†ä¸€ä¸‹DispatcherServlet ä»£ç ã€‚DispatcherServlet æœ¬è´¨æ˜¯ä¸ªServletï¼Œå½“é…ç½®äº† load-on-startup æ—¶ï¼Œä¼šåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å°±æ‰§è¡Œåˆ›å»ºå’Œæ‰§è¡Œåˆå§‹åŒ–initæ–¹æ³•ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰§è¡Œserviceæ–¹æ³•ã€‚<br>DispatcherServletçš„åˆå§‹åŒ–ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š</p><ul><li><p>è·å¾—äº†ä¸€ä¸ª SpringMVC çš„ApplicationContextå®¹å™¨ï¼›</p></li><li><p>æ³¨å†Œäº† SpringMVCçš„ä¹å¤§ç»„ä»¶ã€‚</p></li></ul><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/DispatcherServlet1.png" alt="DispatcherServlet1" style="zoom:67%;" /><div class="tabs" id="ca3a4e03-2303-45ae-916c-f64e2a303cdc"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ca3a4e03-2303-45ae-916c-f64e2a303cdc-1"><i class="fas fa-bug"></i>1</button></li><li class="tab"><button type="button" data-href="#ca3a4e03-2303-45ae-916c-f64e2a303cdc-2"><i class="fas fa-cannabis"></i>2</button></li><li class="tab"><button type="button" data-href="#ca3a4e03-2303-45ae-916c-f64e2a303cdc-3"><i class="fas fa-candy-cane"></i>3</button></li><li class="tab"><button type="button" data-href="#ca3a4e03-2303-45ae-916c-f64e2a303cdc-4"><i class="fas fa-child"></i>4</button></li><li class="tab"><button type="button" data-href="#ca3a4e03-2303-45ae-916c-f64e2a303cdc-5"><i class="fas fa-heartbeat"></i>5</button></li><li class="tab"><button type="button" data-href="#ca3a4e03-2303-45ae-916c-f64e2a303cdc-6"><i class="fas fa-cookie-bite"></i>6</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ca3a4e03-2303-45ae-916c-f64e2a303cdc-1"><p>SpringMVC çš„ApplicationContextå®¹å™¨åˆ›å»ºæ—¶æœºï¼ŒServlet è§„èŒƒçš„ init(ServletConfig config) æ–¹æ³•ç»è¿‡å­ç±»é‡å†™ ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ FrameworkServlet æŠ½è±¡ç±»çš„initWebApplicationContext() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­æœ€ç»ˆè·å¾— ä¸€ä¸ªæ ¹Springå®¹å™¨ï¼ˆSpringäº§ç”Ÿçš„ï¼‰ï¼Œä¸€ä¸ªå­Springå®¹å™¨ï¼ˆSpringMVCäº§ç”Ÿçš„ï¼‰</p><p>HttpServletBean çš„åˆå§‹åŒ–æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="built_in">this</span>.initServletBean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>FrameworkServletçš„initServletBeanæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">initServletBean</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="built_in">this</span>.webApplicationContext = <span class="built_in">this</span>.initWebApplicationContext();<span class="comment">//åˆå§‹åŒ–ApplicationContext </span></span><br><span class="line">    <span class="built_in">this</span>.initFrameworkServlet();<span class="comment">//æ¨¡æ¿è®¾è®¡æ¨¡å¼ï¼Œä¾›å­ç±»è¦†ç›–å®ç°ï¼Œä½†æ˜¯å­ç±»DispatcherServletæ²¡åšä½¿ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ca3a4e03-2303-45ae-916c-f64e2a303cdc-2"><p>åœ¨initWebApplicationContextæ–¹æ³•ä¸­ä½“ç°çš„çˆ¶å­å®¹å™¨çš„é€»è¾‘å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ApplicationContextæ˜¯ä¸€ä¸ªåŠå…¶å…³é”®çš„ä»£ç </span></span><br><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">initWebApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//è·å¾—æ ¹å®¹å™¨ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ContextLoaderListeneråˆ›å»ºçš„ApplicationContext</span></span><br><span class="line">    <span class="comment">//å¦‚æœé…ç½®äº†ContextLoaderListeneråˆ™è·å¾—æ ¹å®¹å™¨ï¼Œæ²¡é…ç½®è·å¾—çš„æ˜¯null</span></span><br><span class="line">    <span class="type">WebApplicationContext</span> <span class="variable">rootContext</span> <span class="operator">=</span></span><br><span class="line">            WebApplicationContextUtils.getWebApplicationContext(<span class="built_in">this</span>.getServletContext());</span><br><span class="line">    <span class="comment">//å®šä¹‰SpringMVCäº§ç”Ÿçš„ApplicationContextå­å®¹å™¨</span></span><br><span class="line">    <span class="type">WebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//==&gt;åˆ›å»ºSpringMVCçš„å­å®¹å™¨ï¼Œåˆ›å»ºåŒæ—¶å°†Springçš„åˆ›å»ºçš„rootContextä¼ é€’äº†è¿‡å»</span></span><br><span class="line">        wac = <span class="built_in">this</span>.createWebApplicationContext(rootContext);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†SpringMVCäº§ç”Ÿçš„ApplicationContextå­å®¹å™¨å­˜å‚¨åˆ°ServletContextåŸŸä¸­</span></span><br><span class="line">    <span class="comment">//keyåæ˜¯ï¼šorg.springframework.web.servlet.FrameworkServlet.CONTEXT.DispatcherServlet</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.publishContext) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContextAttributeName();</span><br><span class="line">        <span class="built_in">this</span>.getServletContext().setAttribute(attrName, wac);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ca3a4e03-2303-45ae-916c-f64e2a303cdc-3"><p>è·Ÿè¿›åˆ›å»ºå­å®¹å™¨çš„æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createWebApplicationContext</span><span class="params">(<span class="meta">@Nullable</span> ApplicationContext parent)</span> &#123;</span><br><span class="line">    <span class="comment">//å®ä¾‹åŒ–å­å®¹å™¨ApplicationContext</span></span><br><span class="line">    <span class="type">ConfigurableWebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span></span><br><span class="line">            (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);</span><br><span class="line">    <span class="comment">//è®¾ç½®ä¼ é€’è¿‡æ¥çš„ContextLoaderListenerçš„rootContextä¸ºçˆ¶å®¹å™¨</span></span><br><span class="line">    wac.setParent(parent);</span><br><span class="line">    <span class="comment">//è·å¾—web.xmlé…ç½®çš„classpath:spring-mvc.xml</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">configLocation</span> <span class="operator">=</span> <span class="built_in">this</span>.getContextConfigLocation();</span><br><span class="line">    <span class="keyword">if</span> (configLocation != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//ä¸ºå­å®¹å™¨è®¾ç½®é…ç½®åŠ è½½è·¯å¾„</span></span><br><span class="line">        wac.setConfigLocation(configLocation);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–å­å®¹å™¨(å°±æ˜¯åŠ è½½spring-mvc.xmlé…ç½®çš„Bean)</span></span><br><span class="line">    <span class="built_in">this</span>.configureAndRefreshWebApplicationContext(wac);</span><br><span class="line">    <span class="keyword">return</span> wac;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ca3a4e03-2303-45ae-916c-f64e2a303cdc-4"><p>å­å®¹å™¨ä¸­çš„parentç»´æŠ¤ç€çˆ¶å®¹å™¨çš„å¼•ç”¨</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427153645421.png" alt="image-20230427153645421"></p><p>çˆ¶å®¹å™¨å’Œå­å®¹å™¨æ¦‚å¿µå’Œå…³ç³»ï¼š</p><ul><li>çˆ¶å®¹å™¨ï¼šSpring é€šè¿‡ContextLoaderListenerä¸ºå…¥å£äº§ç”Ÿçš„applicationContextå®¹å™¨ï¼Œå†…éƒ¨ä¸»è¦ç»´æŠ¤çš„æ˜¯applicationContext.xmlï¼ˆæˆ–ç›¸åº”é…ç½®ç±»ï¼‰é…ç½®çš„Beanä¿¡æ¯ï¼›</li><li>å­å®¹å™¨ï¼šSpringMVCé€šè¿‡DispatcherServletçš„init() æ–¹æ³•äº§ç”Ÿçš„applicationContextå®¹å™¨ï¼Œå†…éƒ¨ä¸»è¦ç»´æŠ¤çš„æ˜¯spring-mvc.xmlï¼ˆæˆ–ç›¸åº”é…ç½®ç±»ï¼‰é…ç½®çš„Beanä¿¡æ¯ï¼Œä¸”å†…éƒ¨è¿˜é€šè¿‡parentå±æ€§ç»´æŠ¤è¿™çˆ¶å®¹å™¨çš„å¼•ç”¨ã€‚</li><li>Beançš„æ£€ç´¢é¡ºåºï¼šæ ¹æ®ä¸Šé¢å­çˆ¶å®¹å™¨çš„æ¦‚å¿µï¼Œå¯ä»¥çŸ¥é“Controllerå­˜åœ¨ä¸å­å®¹å™¨ä¸­ï¼Œè€ŒControllerä¸­è¦æ³¨å…¥Serviceæ—¶ï¼Œä¼šå…ˆä»å­å®¹å™¨æœ¬èº«å»åŒ¹é…ï¼ŒåŒ¹é…ä¸æˆåŠŸæ—¶åœ¨å»çˆ¶å®¹å™¨ä¸­å»åŒ¹é…ï¼Œäºæ˜¯æœ€ç»ˆä»çˆ¶å®¹å™¨ä¸­åŒ¹é…åˆ°çš„UserServiceï¼Œè¿™æ ·å­çˆ¶å®¹å™¨å°±å¯ä»¥è¿›è¡Œè”é€šäº†ã€‚ä½†æ˜¯çˆ¶å®¹å™¨åªèƒ½ä»è‡ªå·±å®¹å™¨ä¸­è¿›è¡ŒåŒ¹é…ï¼Œä¸èƒ½ä»å­å®¹å™¨ä¸­è¿›è¡ŒåŒ¹é…ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ca3a4e03-2303-45ae-916c-f64e2a303cdc-5"><p>æ³¨å†Œ SpringMVCçš„ ä¹å¤§ç»„ä»¶ï¼Œåœ¨åˆå§‹åŒ–å®¹å™¨initWebApplicationContextæ–¹æ³•ä¸­æ‰§è¡Œäº†onRefreshæ–¹æ³•ï¼Œè¿›è€Œæ‰§è¡Œäº†åˆå§‹åŒ–ç­–ç•¥initStrategiesæ–¹æ³•ï¼Œæ³¨å†Œäº†ä¹ä¸ªè§£æå™¨ç»„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DispatcherServletåˆå§‹åŒ–SpringMVCä¹å¤§ç»„ä»¶</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initStrategies</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.initMultipartResolver(context);<span class="comment">//1ã€åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ è§£æå™¨</span></span><br><span class="line">    <span class="built_in">this</span>.initLocaleResolver(context);<span class="comment">//2ã€åˆå§‹åŒ–å›½é™…åŒ–è§£æå™¨</span></span><br><span class="line">    <span class="built_in">this</span>.initThemeResolver(context);<span class="comment">//3ã€åˆå§‹åŒ–æ¨¡æ¿è§£æå™¨</span></span><br><span class="line">    <span class="built_in">this</span>.initHandlerMappings(context);<span class="comment">//4ã€åˆå§‹åŒ–å¤„ç†å™¨æ˜ å°„å™¨</span></span><br><span class="line">    <span class="built_in">this</span>.initHandlerAdapters(context);<span class="comment">//5ã€åˆå§‹åŒ–å¤„ç†å™¨é€‚é…å™¨</span></span><br><span class="line">    <span class="built_in">this</span>.initHandlerExceptionResolvers(context);<span class="comment">//6ã€åˆå§‹åŒ–å¤„ç†å™¨å¼‚å¸¸è§£æå™¨</span></span><br><span class="line">    <span class="built_in">this</span>.initRequestToViewNameTranslator(context);<span class="comment">//7ã€åˆå§‹åŒ–è¯·æ±‚è§†å›¾è½¬æ¢å™¨</span></span><br><span class="line">    <span class="built_in">this</span>.initViewResolvers(context);<span class="comment">//8ã€åˆå§‹åŒ–è§†å›¾è§£æå™¨</span></span><br><span class="line">    <span class="built_in">this</span>.initFlashMapManager(context);<span class="comment">//9ã€åˆå§‹åŒ–lashMapManagerç­–ç•¥ç»„ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ca3a4e03-2303-45ae-916c-f64e2a303cdc-6"><p>ä»¥ this.initHandlerMappings(context) ä¸ºä¾‹ï¼Œè¿›ä¸€æ­¥çœ‹ä¸€ä¸‹åˆå§‹åŒ–å¤„ç†å™¨æ˜ å°„å™¨çš„ç»†èŠ‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰Listå®¹å™¨å­˜å‚¨HandlerMapping</span></span><br><span class="line"><span class="keyword">private</span> List&lt;HandlerMapping&gt; handlerMappings;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–HandlerMappingçš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initHandlerMappings</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.handlerMappings = <span class="literal">null</span>;<span class="comment">//åˆå§‹åŒ–é›†åˆä¸ºnull</span></span><br><span class="line">    <span class="comment">//detectAllHandlerMappingsé»˜è®¤ä¸ºtrueï¼Œä»£è¡¨æ˜¯å¦ä»æ‰€æœ‰å®¹å™¨ä¸­(çˆ¶å­å®¹å™¨)æ£€æµ‹HandlerMapping</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.detectAllHandlerMappings) &#123;</span><br><span class="line">        <span class="comment">//ä»Springå®¹å™¨ä¸­å»åŒ¹é…HandlerMapping</span></span><br><span class="line">        Map&lt;String, HandlerMapping&gt; matchingBeans = BeanFactoryUtils.beansOfTypeIncludingAncestors(context,</span><br><span class="line">                HandlerMapping.class, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//å¦‚æœä»å®¹å™¨ä¸­è·å–çš„HandlerMappingä¸ä¸ºnullå°±åŠ å…¥åˆ°äº‹å…ˆå®šä¹‰å¥½çš„handlerMappingså®¹å™¨ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (!matchingBeans.isEmpty()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.handlerMappings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(matchingBeans.values());</span><br><span class="line">            AnnotationAwareOrderComparator.sort(<span class="built_in">this</span>.handlerMappings);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœä»å®¹å™¨ä¸­æ²¡æœ‰è·å¾—HandlerMappingï¼Œæ„å‘³ç€handlerMappingsé›†åˆæ˜¯ç©ºçš„</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//åŠ è½½é»˜è®¤çš„HandlerMappingï¼Œå°±æ˜¯åŠ è½½DispatcherServlet.propertiesæ–‡ä»¶ä¸­çš„é”®å€¼å¯¹</span></span><br><span class="line">            <span class="built_in">this</span>.handlerMappings = <span class="built_in">this</span>.getDefaultStrategies(context, HandlerMapping.class);</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427154215264.png" alt="image-20230427154215264"></p><p>åˆå§‹åŒ–åï¼Œæ˜ å°„ä¿¡æ¯å°±å·²ç»è¢«å°è£…åˆ°HandlerMappingä¸­äº†ï¼Œå¯ä»¥åœ¨è·å–matchingBeanså¤„æ‰“æ–­ç‚¹éªŒè¯</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="6-2-å‰ç«¯æ§åˆ¶å™¨æ‰§è¡Œä¸»æµç¨‹">6.2 å‰ç«¯æ§åˆ¶å™¨æ‰§è¡Œä¸»æµç¨‹</h3><p>ä¸Šé¢è®²è§£äº†ä¸€ä¸‹ï¼Œå½“æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼ŒDispatcherServlet ä¼šæ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ¥ä¸‹æ¥ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šæ‰§è¡Œserviceæ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆå®è§‚çš„çœ‹ä¸€ä¸‹æ‰§è¡Œæµç¨‹ï¼Œåœ¨å»ç ”ç©¶æºç å’Œç»„ä»¶æ‰§è¡Œç»†èŠ‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230429111137565.png" alt="image-20230429111137565" style="zoom:67%;" /><div class="tabs" id="3437a5f1-ec27-476f-9b69-58f18848f585"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#3437a5f1-ec27-476f-9b69-58f18848f585-1"><i class="fas fa-cat"></i>processRequest</button></li><li class="tab"><button type="button" data-href="#3437a5f1-ec27-476f-9b69-58f18848f585-2"><i class="fas fa-horse"></i>doService</button></li><li class="tab"><button type="button" data-href="#3437a5f1-ec27-476f-9b69-58f18848f585-3"><i class="fas fa-dove"></i>â­ï¸doDispatch</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="3437a5f1-ec27-476f-9b69-58f18848f585-1"><p>FrameworkServlet å¤å†™äº†service(HttpServletRequest request, HttpServletResponse response) ã€ doGet(HttpServletRequest request, HttpServletResponse response)ã€doPost(HttpServletRequest request, HttpServletResponse response)ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½ä¼šè°ƒç”¨processRequestæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.doService(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3437a5f1-ec27-476f-9b69-58f18848f585-2"><p>è¿›ä¸€æ­¥è°ƒç”¨äº†doServiceæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å†…éƒ¨åˆè°ƒç”¨äº†doDispatchæ–¹æ³•ï¼Œè€ŒSpringMVC ä¸»æµç¨‹æœ€æ ¸å¿ƒçš„æ–¹æ³•å°±æ˜¯doDispatch æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.doDispatch(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3437a5f1-ec27-476f-9b69-58f18848f585-3"><p>doDispatchæ–¹æ³•æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹åŸå§‹çš„è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ URL çš„ç¼–ç </span></span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">processedRequest</span> <span class="operator">=</span> checkMultipart(request);</span><br><span class="line">    <span class="comment">//å®šä¹‰å¤„ç†å™¨æ‰§è¡Œé“¾å¯¹è±¡</span></span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//å®šä¹‰æ¨¡å‹è§†å›¾å¯¹è±¡</span></span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="literal">null</span>; </span><br><span class="line">    <span class="comment">//åŒ¹é…å¤„ç†å™¨æ˜ å°„å™¨HandlerMappingï¼Œè¿”å›å¤„ç†å™¨æ‰§è¡Œé“¾å¯¹è±¡</span></span><br><span class="line">    mappedHandler = <span class="built_in">this</span>.getHandler(processedRequest);</span><br><span class="line">    <span class="comment">//åŒ¹é…å¤„ç†å™¨é€‚é…å™¨HandlerAdapterï¼Œè¿”å›å¤„ç†å™¨é€‚é…å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> <span class="built_in">this</span>.getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line">    <span class="comment">//æ‰§è¡ŒInterceptorçš„å‰ç½®æ–¹æ³•preHandle</span></span><br><span class="line">    mappedHandler.applyPreHandle(processedRequest, response);</span><br><span class="line">    <span class="comment">//å¤„ç†å™¨é€‚é…å™¨æ‰§è¡Œæ§åˆ¶å™¨Handlerï¼Œè¿”å›æ¨¡å‹è§†å›¾å¯¹è±¡</span></span><br><span class="line">    mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">    <span class="comment">//æ‰§è¡ŒInterceptorçš„åç½®æ–¹æ³•postHandle</span></span><br><span class="line">    mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">    <span class="comment">//è·å–è§†å›¾æ¸²æŸ“è§†å›¾</span></span><br><span class="line">    <span class="built_in">this</span>.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="6-2-1-getHandleræ–¹æ³•è¯¦è§£">6.2.1 getHandleræ–¹æ³•è¯¦è§£</h4><p>doDispatch() ä¸­è°ƒç”¨ getHandler æ–¹æ³•è·å–æ‰€æœ‰çš„æ˜ å°„å™¨</p><p>æ€»ä½“æµç¨‹ï¼š</p><ul><li>æ‰€æœ‰çš„è¯·æ±‚æ˜ å°„éƒ½åœ¨ HandlerMapping ä¸­ï¼Œ<span class='p green'>RequestMappingHandlerMapping å¤„ç† @RequestMapping æ³¨è§£çš„æ˜ å°„è§„åˆ™</span></li><li>éå†æ‰€æœ‰çš„ HandlerMapping çœ‹æ˜¯å¦å¯ä»¥åŒ¹é…å½“å‰è¯·æ±‚ï¼ŒåŒ¹é…æˆåŠŸåè¿”å›ï¼ŒåŒ¹é…å¤±è´¥è®¾ç½® HTTP 404 å“åº”ç </li><li>ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰çš„æ˜ å°„å¤„ç†ï¼Œä¹Ÿå¯ä»¥ç»™å®¹å™¨ä¸­æ”¾å…¥è‡ªå®šä¹‰ HandlerMapping</li></ul><p>è®¿é—® URLï¼š<a href="http://localhost:8080/hello">http://localhost:8080/hello</a></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/gethandler2.jpg" alt="gethandler2" style="zoom: 33%;" /><div class="tabs" id="aaad200b-ee69-49ad-912a-ba4b279fb02d"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#aaad200b-ee69-49ad-912a-ba4b279fb02d-1"><i class="fas fa-seedling"></i>1.getHandler()</button></li><li class="tab"><button type="button" data-href="#aaad200b-ee69-49ad-912a-ba4b279fb02d-2"><i class="fas fa-leaf"></i>2.getHandler()</button></li><li class="tab"><button type="button" data-href="#aaad200b-ee69-49ad-912a-ba4b279fb02d-3"><i class="fab fa-apple"></i>3.getHandlerInterna()</button></li><li class="tab"><button type="button" data-href="#aaad200b-ee69-49ad-912a-ba4b279fb02d-4"><i class="fas fa-tree"></i>4.lookupHandlerMethod()</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="aaad200b-ee69-49ad-912a-ba4b279fb02d-1"><p>HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨ï¼Œä¿å­˜äº†æ‰€æœ‰ <code>@RequestMapping</code> å’Œ <code>handler</code> çš„æ˜ å°„è§„åˆ™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰çš„ HandlerMapping</span></span><br><span class="line">        <span class="keyword">for</span> (HandlerMapping mapping : <span class="built_in">this</span>.handlerMappings) &#123;</span><br><span class="line">            <span class="comment">// å°è¯•å»æ¯ä¸ª HandlerMapping ä¸­åŒ¹é…å½“å‰è¯·æ±‚çš„å¤„ç† </span></span><br><span class="line">            <span class="type">HandlerExecutionChain</span> <span class="variable">handler</span> <span class="operator">=</span> mapping.getHandler(request);<span class="comment">// è·³è½¬åˆ°2</span></span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> handler;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230430111413036.png" alt="image-20230430111413036" style="zoom: 50%;" /><p>æœ‰ 5 ä¸ª Mapping ï¼ŒæŸ¥çœ‹ RequestMappingHandlerMapping ï¼Œå¯ä»¥æŸ¥çœ‹è¯·æ±‚æ˜ å°„çš„æ³¨å†Œï¼š/errorã€/helloï¼Œè¿™é‡Œå°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼šcom.yuyu.demo.controller.DemoController.test()</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230430111649469.png" alt="image-20230430111649469" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aaad200b-ee69-49ad-912a-ba4b279fb02d-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// è·å–æ˜ å°„å™¨ï¼Œåº•å±‚è°ƒç”¨ RequestMappingInfoHandlerMapping ç±»çš„æ–¹æ³•ï¼Œåˆè°ƒç”¨ AbstractHandlerMethodMapping#getHandlerInternal</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> getHandlerInternal(request); <span class="comment">// è·³è½¬åˆ°3</span></span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">        handler = getDefaultHandler();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Bean name or resolved handler?</span></span><br><span class="line">    <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">handlerName</span> <span class="operator">=</span> (String) handler;</span><br><span class="line">        handler = obtainApplicationContext().getBean(handlerName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure presence of cached lookupPath for interceptors and others</span></span><br><span class="line">    <span class="keyword">if</span> (!ServletRequestPathUtils.hasCachedPath(request)) &#123;</span><br><span class="line">        initLookupPath(request);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸ºå½“å‰è¯·æ±‚å’Œæ–¹æ³•æ„å»ºä¸ºä¸€ä¸ªæ‹¦æˆªå™¨é“¾</span></span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">executionChain</span> <span class="operator">=</span> getHandlerExecutionChain(handler, request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> executionChain; <span class="comment">//è¿”å›åˆ°1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aaad200b-ee69-49ad-912a-ba4b279fb02d-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerMethod <span class="title function_">getHandlerInternal</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// åœ°å€æ çš„ uriï¼Œè¿™é‡Œçš„ lookupPath ä¸º /hello</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lookupPath</span> <span class="operator">=</span> initLookupPath(request);</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    <span class="built_in">this</span>.mappingRegistry.acquireReadLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡è·¯å¾„ä»æ˜ å°„æ³¨å†Œå™¨é‡Œæ‰¾åˆ°å¯¹åº”çš„æ˜ å°„</span></span><br><span class="line">        <span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> lookupHandlerMethod(lookupPath, request); <span class="comment">// è·³è½¬åˆ°4</span></span><br><span class="line">        <span class="keyword">return</span> (handlerMethod != <span class="literal">null</span> ? handlerMethod.createWithResolvedBean() : <span class="literal">null</span>); <span class="comment">//è¿”å›2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mappingRegistry.releaseReadLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aaad200b-ee69-49ad-912a-ba4b279fb02d-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerMethod <span class="title function_">lookupHandlerMethod</span><span class="params">(String lookupPath, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;Match&gt; matches = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çš„æ˜ å°„å™¨ä¸å½“å‰è¯·æ±‚çš„ URI æœ‰å…³çš„æ‰€æœ‰æ˜ å°„è§„åˆ™</span></span><br><span class="line">    List&lt;T&gt; directPathMatches = <span class="built_in">this</span>.mappingRegistry.getMappingsByDirectPath(lookupPath);</span><br><span class="line">    <span class="keyword">if</span> (directPathMatches != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// åŒ¹é…æŸä¸ªæ˜ å°„è§„åˆ™</span></span><br><span class="line">        addMatchingMappings(directPathMatches, matches, request);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// è¿”å›æ‰¾åˆ°çš„æœ€åŒ¹é…çš„ å¤„ç†æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> bestMatch.getHandlerMethod(); <span class="comment">//è¿”å›åˆ°3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230430114056174.png" alt="image-20230430114056174" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h4 id="6-2-2-å‚æ•°å¤„ç†åŸç†">6.2.2 å‚æ•°å¤„ç†åŸç†</h4><p>doDispatchä¸­</p><ul><li>HandlerMappingä¸­æ‰¾åˆ°èƒ½å¤„ç†è¯·æ±‚çš„Handler(controller.method())</li><li>ä¸ºå½“å‰Handleræ‰¾ä¸€ä¸ªé€‚é…å™¨HandlerAdapter</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//åŒ¹é…å¤„ç†å™¨æ˜ å°„å™¨HandlerMappingï¼Œè¿”å›å¤„ç†å™¨æ‰§è¡Œé“¾å¯¹è±¡</span></span><br><span class="line">  mappedHandler = <span class="built_in">this</span>.getHandler(processedRequest);</span><br><span class="line">  <span class="comment">//åŒ¹é…å¤„ç†å™¨é€‚é…å™¨HandlerAdapterï¼Œè¿”å›å¤„ç†å™¨é€‚é…å™¨å¯¹è±¡</span></span><br><span class="line">  <span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> <span class="built_in">this</span>.getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"><span class="comment">// Actually invoke the handler.</span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></pre></td></tr></table></figure><div class="tabs" id="2b53a8bd-c0b4-4fed-bb79-497cd459a76a"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2b53a8bd-c0b4-4fed-bb79-497cd459a76a-1"><i class="fas fa-seedling"></i>getHandlerAdapter</button></li><li class="tab"><button type="button" data-href="#2b53a8bd-c0b4-4fed-bb79-497cd459a76a-2"><i class="fas fa-leaf"></i>handle</button></li><li class="tab"><button type="button" data-href="#2b53a8bd-c0b4-4fed-bb79-497cd459a76a-3"><i class="fab fa-apple"></i>invokeHandlerMethod</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2b53a8bd-c0b4-4fed-bb79-497cd459a76a-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerAdapter <span class="title function_">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.handlerAdapters != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (HandlerAdapter adapter : <span class="built_in">this</span>.handlerAdapters) &#123;</span><br><span class="line"><span class="keyword">if</span> (adapter.supports(handler)) &#123;</span><br><span class="line"><span class="keyword">return</span> adapter;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;No adapter for handler [&quot;</span> + handler +</span><br><span class="line"><span class="string">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§å¤šæ•°æ‰¾åˆ°çš„éƒ½æ˜¯ç¬¬ä¸€ä¸ª<code>RequestMappingHandlerAdapter</code>,æ‰¾åˆ°é€‚é…å™¨åè¿”å›æ”¹é€‚é…å™¨ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230505150121343.png" alt="image-20230505150121343" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2b53a8bd-c0b4-4fed-bb79-497cd459a76a-2"><p><code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</code></p><p>åˆ©ç”¨å‰é¢æ‰¾åˆ°çš„HandlerAdapterï¼ŒæŠŠç›®æ ‡Handlerï¼Œä»¥åŠRequestå’ŒResponseå…¨éƒ¨ä¼ è¿›å»ï¼Œæ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</p><p>å†…éƒ¨çš„å¤„ç†ç»†èŠ‚å°±åˆ°äº†</p><p><code>RequestMappingHandlerAdapter</code>#<code>handleInternal(request, response, handlerMethod)</code>æ–¹æ³•ä¸­</p><p>åœ¨è¯¥æ–¹æ³•é‡Œ</p><p><code>mav = invokeHandlerMethod(request, response, handlerMethod);</code>æ‰§è¡Œç›®æ ‡æ–¹æ³•</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2b53a8bd-c0b4-4fed-bb79-497cd459a76a-3"><p>åœ¨è¯¥æ–¹æ³•ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServletInvocableHandlerMethod</span> <span class="variable">invocableMethod</span> <span class="operator">=</span> createInvocableHandlerMethod(handlerMethod);</span><br><span class="line"><span class="comment">//è®¾ç½®å‚æ•°è§£æå™¨</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">    invocableMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.argumentResolvers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®¾ç½®è¿”å›å€¼å¤„ç†å™¨</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>) &#123;</span><br><span class="line">    invocableMethod.setHandlerMethodReturnValueHandlers(<span class="built_in">this</span>.returnValueHandlers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// è°ƒç”¨å¤„ç†å™¨æ–¹æ³•å¹¶å¤„ç†è¿”å›å€¼</span></span><br><span class="line">invocableMethod.invokeAndHandle(webRequest, mavContainer);</span><br></pre></td></tr></table></figure><div class="tabs" id="7deda36b-990c-4db1-b08b-716deabfeee1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7deda36b-990c-4db1-b08b-716deabfeee1-1"><i class="fas fa-cat"></i>å‚æ•°è§£æå™¨</button></li><li class="tab"><button type="button" data-href="#7deda36b-990c-4db1-b08b-716deabfeee1-2"><i class="fas fa-horse"></i>è¿”å›å€¼å¤„ç†å™¨</button></li><li class="tab"><button type="button" data-href="#7deda36b-990c-4db1-b08b-716deabfeee1-3"><i class="fas fa-dove"></i>æ‰§è¡Œç›®æ ‡æ–¹æ³•</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7deda36b-990c-4db1-b08b-716deabfeee1-1"><p><code>argumentResolvers</code>å‚æ•°è§£æå™¨ï¼šç¡®å®šå°†è¦æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•çš„æ¯ä¸€ä¸ªå‚æ•°çš„å€¼æ˜¯ä»€ä¹ˆ</p><p>å‚æ•°è§£æå™¨å…±æœ‰26ä¸ªï¼ŒSpringMVCç›®æ ‡æ–¹æ³•èƒ½å†™å¤šå°‘ç§å‚æ•°ç±»å‹ã€‚å–å†³äºå‚æ•°è§£æå™¨ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230505152933897.png" alt="image-20230505152933897" style="zoom: 50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7deda36b-990c-4db1-b08b-716deabfeee1-2"><p>è¿”å›å€¼å¤„ç†å™¨å…±æœ‰15ç§</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230505153622226.png" alt="image-20230505153622226" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7deda36b-990c-4db1-b08b-716deabfeee1-3"><p>æŠŠå‚æ•°è§£æå™¨å’Œè¿”å›å€¼å¤„ç†å™¨éƒ½è®¾ç½®åˆ°<code>invocableMethod</code>ä¸­åå°±å¯ä»¥è¿›è¡Œæ–¹æ³•æ‰§è¡Œäº†</p><p>åœ¨<code>invocableMethod.invokeAndHandle(webRequest, mavContainer);</code>æ–¹æ³•ä¸­ï¼ŒçœŸæ­£æ‰§è¡Œäº†Controllerä¸­çš„æ–¹æ³•</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    
    <summary type="html">è¯·æ±‚å¤„ç†ã€å“åº”å¤„ç†ã€æ‹¦æˆªå™¨ã€å…¨æ³¨è§£å¼€å‘ã€ç»„ä»¶åŸç†å‰–æ</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="SpringMVC" scheme="https://wuwawawa.github.io/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>Springæ•´åˆWeb</title>
    <link href="https://wuwawawa.github.io/posts/6b43be99.html"/>
    <id>https://wuwawawa.github.io/posts/6b43be99.html</id>
    <published>2023-04-30T01:31:36.000Z</published>
    <updated>2023-04-29T05:55:15.948Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Springæ•´åˆwebç¯å¢ƒ">1. Springæ•´åˆwebç¯å¢ƒ</h2><h3 id="1-1-Javawebä¸‰å¤§ç»„ä»¶åŠç¯å¢ƒç‰¹ç‚¹">1.1 Javawebä¸‰å¤§ç»„ä»¶åŠç¯å¢ƒç‰¹ç‚¹</h3><p>åœ¨Javaè¯­è¨€èŒƒç•´å†…ï¼Œwebå±‚æ¡†æ¶éƒ½æ˜¯åŸºäºJavawebåŸºç¡€ç»„ä»¶å®Œæˆçš„ï¼Œæ‰€ä»¥æœ‰å¿…è¦å¤ä¹ ä¸€ä¸‹Javawebç»„ä»¶çš„ç‰¹ç‚¹</p><table><thead><tr><th style="text-align:left">ç»„ä»¶</th><th style="text-align:left">ä½œç”¨</th><th style="text-align:left">ç‰¹ç‚¹</th></tr></thead><tbody><tr><td style="text-align:left">Servlet</td><td style="text-align:left">æœåŠ¡ç«¯å°ç¨‹åºï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å¹¶ä½œå‡ºå“åº”çš„</td><td style="text-align:left">å•ä¾‹å¯¹è±¡ï¼Œé»˜è®¤ç¬¬ä¸€æ¬¡è®¿é—®åˆ›å»ºï¼Œå¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šæœåŠ¡å™¨å¯åŠ¨å°±åˆ›å»ºï¼ŒServletåˆ›å»ºå®Œæ¯•ä¼šæ‰§è¡Œåˆå§‹åŒ–initæ–¹æ³•ã€‚æ¯ä¸ªServletæœ‰ä¸€ä¸ªserviceæ–¹æ³•ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šæ‰§è¡Œserviceæ–¹æ³•ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯ä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½å°±éœ€è¦é…ç½®ä¸€ä¸ªServlet</td></tr><tr><td style="text-align:left">Filter</td><td style="text-align:left">è¿‡æ»¤å™¨ï¼Œè´Ÿè´£å¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œè¿‡æ»¤æ“ä½œçš„</td><td style="text-align:left">å•ä¾‹å¯¹è±¡ï¼ŒæœåŠ¡å™¨å¯åŠ¨æ—¶å°±åˆ›å»ºï¼Œå¯¹è±¡åˆ›å»ºå®Œæ¯•æ‰§è¡Œinitæ–¹æ³•ï¼Œå¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œç¬¦åˆè¦æ±‚çš„æ”¾è¡Œï¼Œä¸ç¬¦åˆè¦æ±‚çš„ç›´æ¥å“åº”å®¢æˆ·ç«¯ï¼Œæ‰§è¡Œè¿‡æ»¤çš„æ ¸å¿ƒæ–¹æ³•doFilter</td></tr><tr><td style="text-align:left">Listener</td><td style="text-align:left">ç›‘å¬å™¨ï¼Œè´Ÿè´£å¯¹åŸŸå¯¹è±¡çš„åˆ›å»ºå’Œå±æ€§å˜åŒ–è¿›è¡Œç›‘å¬çš„</td><td style="text-align:left">æ ¹æ®ç±»å‹å’Œä½œç”¨ä¸åŒï¼Œåˆå¯åˆ†ä¸ºç›‘å¬åŸŸå¯¹è±¡åˆ›å»ºé”€æ¯å’ŒåŸŸå¯¹è±¡å±æ€§å†…å®¹å˜åŒ–çš„ï¼Œæ ¹æ®ç›‘å¬çš„åŸŸä¸åŒï¼Œåˆå¯ä»¥åˆ†ä¸ºç›‘å¬RequeståŸŸçš„ï¼Œç›‘å¬SessionåŸŸçš„ï¼Œç›‘å¬ServletContextåŸŸçš„</td></tr></tbody></table><mark class="hl-label green">ServletçŸ¥è¯†è¡¥å……</mark> <div class="tabs" id="ba4120be-81c6-4c79-8d1d-62ec49c11029"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ba4120be-81c6-4c79-8d1d-62ec49c11029-1"><i class="fas fa-cat"></i>å®ç°æ–¹å¼</button></li><li class="tab"><button type="button" data-href="#ba4120be-81c6-4c79-8d1d-62ec49c11029-2"><i class="fas fa-dove"></i>æ‰§è¡ŒåŸç†</button></li><li class="tab"><button type="button" data-href="#ba4120be-81c6-4c79-8d1d-62ec49c11029-3"><i class="fas fa-dragon"></i>ç”Ÿå‘½å‘¨æœŸ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ba4120be-81c6-4c79-8d1d-62ec49c11029-1"><p>Servletå®ç°æ–¹å¼</p><ul><li>å®ç°Servletæ¥å£</li><li>ç»§æ‰¿GenericServeltæŠ½è±¡ç±»ï¼ˆè¿™ä¸ªç±»æ˜¯Servletæ¥å£çš„ä¸€çº§å®ç°ç±»ï¼‰</li><li>ç»§æ‰¿HttpServletæŠ½è±¡ç±»å°±å¯ä»¥é—´æ¥çš„å®ç°Servletæ¥å£ï¼ˆä½äºjavax.servlet.httpåŒ…ä¸­çš„HttpServletæŠ½è±¡ç±»ç»§æ‰¿è‡ªGenericServletç±»ï¼Œæ˜¯Servletæ¥å£çš„äºŒçº§å®ç°ç±»ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig var1)</span> <span class="keyword">throws</span> ServletException;</span><br><span class="line"></span><br><span class="line">    ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest var1, ServletResponse var2)</span> <span class="keyword">throws</span> ServletException, IOException;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getServletInfo</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/874710-20170216094438629-1196159083.png" alt="img" style="zoom:50%;" /><p>åœ¨HttpServletçš„APIä¸­ï¼Œæ–°å¢äº†ä¸¤ä¸ªç‰¹æ®Šçš„æ–¹æ³•doGetå’ŒdoPostï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å¯¹servletæ–¹æ³•çš„æ‹†åˆ†ï¼Œç›®çš„æ˜¯å¸Œæœ›ä¸åŒçš„è¯·æ±‚æ–¹å¼ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å¤„ç†ã€‚è€Œserviceæ–¹æ³•å¯ä»¥å¤„ç†ä»»ä½•ç±»å‹çš„è¯·æ±‚ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ba4120be-81c6-4c79-8d1d-62ec49c11029-2"><ol><li>å½“æœåŠ¡å™¨æ¥å—åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨çš„è¯·æ±‚åï¼Œä¼šè§£æè¯·æ±‚URLè·¯å¾„ï¼Œè·å–è®¿é—®çš„Servletçš„èµ„æºè·¯å¾„</li><li>æŸ¥æ‰¾web.xmlæ–‡ä»¶ï¼Œæ˜¯å¦æœ‰å¯¹åº”çš„<code>&lt;url-pattern&gt;</code>æ ‡ç­¾ä½“å†…å®¹ã€‚</li><li>å¦‚æœæœ‰ï¼Œåˆ™åœ¨æ‰¾åˆ°å¯¹åº”çš„<code>&lt;servlet-class&gt;</code>å…¨ç±»å</li><li>tomcatä¼šå°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œå¹¶ä¸”åˆ›å»ºå…¶å¯¹è±¡</li><li>è°ƒç”¨å…¶Serviceæ–¹æ³•</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ba4120be-81c6-4c79-8d1d-62ec49c11029-3"><ul><li>åŠ è½½å’Œå®ä¾‹åŒ–ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Servletç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶ï¼Œç”±å®¹å™¨åˆ›å»ºServletå¯¹è±¡</li><li>åˆå§‹åŒ–ï¼šåœ¨Servletå®ä¾‹åŒ–ä¹‹åï¼Œå®¹å™¨å°†è°ƒç”¨Servletçš„init()æ–¹æ³•åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡ï¼Œå®Œæˆä¸€äº›å¦‚åŠ è½½é…ç½®æ–‡ä»¶ã€åˆ›å»ºè¿æ¥ç­‰åˆå§‹åŒ–çš„å·¥ä½œã€‚è¯¥æ–¹æ³•åªè°ƒç”¨ä¸€æ¬¡</li><li>è¯·æ±‚å¤„ç†ï¼šæ¯æ¬¡è¯·æ±‚Servletæ—¶ï¼ŒServletå®¹å™¨éƒ½ä¼šè°ƒç”¨Servletçš„service()æ–¹æ³•å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</li><li>æœåŠ¡ç»ˆæ­¢ï¼šå½“éœ€è¦é‡Šæ”¾å†…å­˜æˆ–è€…å®¹å™¨å…³é—­æ—¶ï¼Œå®¹å™¨å°±ä¼šè°ƒç”¨Servletå®ä¾‹çš„destroy()æ–¹æ³•å®Œæˆèµ„æºçš„é‡Šæ”¾ã€‚åœ¨destroy()æ–¹æ³•è°ƒç”¨ä¹‹åï¼Œå®¹å™¨ä¼šé‡Šæ”¾è¿™ä¸ªServletå®ä¾‹ï¼Œè¯¥å®ä¾‹éšåä¼šè¢«Javaçš„åƒåœ¾æ”¶é›†å™¨æ‰€å›æ”¶</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="1-2-æ•´åˆwebç¯å¢ƒæ€è·¯åŠå®ç°">1.2 æ•´åˆwebç¯å¢ƒæ€è·¯åŠå®ç°</h3><p>åœ¨è¿›è¡ŒJavaå¼€å‘æ—¶è¦éµå¾ªä¸‰å±‚æ¶æ„+MVCï¼ŒSpringæ“ä½œæœ€æ ¸å¿ƒçš„å°±æ˜¯Springå®¹å™¨ï¼Œwebå±‚éœ€è¦æ³¨å…¥Serviceï¼Œserviceå±‚éœ€è¦æ³¨å…¥Daoï¼ˆMapperï¼‰ï¼Œwebå±‚ä½¿ç”¨ServletæŠ€æœ¯å……å½“çš„è¯ï¼Œéœ€è¦åœ¨Servletä¸­è·å¾—Springå®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AnnotationConfigApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(ApplicationContextConfig.class);</span><br><span class="line"><span class="type">AccountService</span> <span class="variable">accountService</span> <span class="operator">=</span> (AccountService)applicationContext.getBean(<span class="string">&quot;accountService&quot;</span>);</span><br><span class="line">accountService.transferMoney(<span class="string">&quot;tom&quot;</span>,<span class="string">&quot;lucy&quot;</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>Webå±‚ä»£ç å¦‚æœéƒ½å»ç¼–å†™åˆ›å»ºAnnotationConfigApplicationContextçš„ä»£ç ï¼Œé‚£ä¹ˆé…ç½®ç±»é‡å¤è¢«åŠ è½½äº†ï¼Œ Springå®¹å™¨ä¹Ÿé‡å¤è¢«åˆ›å»ºäº†ï¼Œä¸èƒ½æ¯æ¬¡æƒ³ä»å®¹å™¨ä¸­è·å¾—ä¸€ä¸ªBeanéƒ½å¾—å…ˆåˆ›å»ºä¸€æ¬¡å®¹å™¨ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸å…è®¸ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨çš„è¯‰æ±‚å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š</p><ul><li><code>ApplicationContext</code>åˆ›å»ºä¸€æ¬¡ï¼Œé…ç½®ç±»åŠ è½½ä¸€æ¬¡;</li><li>æœ€å¥½webæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå°±æ‰§è¡Œç¬¬1æ­¥æ“ä½œï¼Œåç»­ç›´æ¥ä»å®¹å™¨ä¸­è·å–Beanä½¿ç”¨å³å¯;</li><li><code>ApplicationContext</code>çš„å¼•ç”¨éœ€è¦åœ¨webå±‚ä»»ä½•ä½ç½®éƒ½å¯ä»¥è·å–åˆ°ã€‚</li></ul><span class='p green'>é’ˆå¯¹ä»¥ä¸Šè¯‰æ±‚æˆ‘ä»¬ç»™å‡ºè§£å†³æ€è·¯ï¼Œå¦‚ä¸‹</span><ul><li>åœ¨<code>ServletContextListener</code>çš„<code>contextInitialized</code>æ–¹æ³•ä¸­æ‰§è¡Œ<code>ApplicationContext</code>çš„åˆ›å»ºã€‚æˆ–åœ¨Servletçš„initæ–¹æ³•ä¸­æ‰§è¡Œ<code>ApplicationContext</code>çš„åˆ›å»ºï¼Œå¹¶ç»™Servletçš„load-on-startupå±æ€§ä¸€ä¸ªæ•°å­—å€¼ï¼Œç¡®ä¿æœåŠ¡å™¨å¯åŠ¨Servletå°±åˆ›å»º;</li><li>å°†åˆ›å»ºå¥½çš„<code>ApplicationContext</code>å­˜å‚¨åˆ°<code>ServletContext</code>åŸŸä¸­ï¼Œè¿™æ ·æ•´ä¸ªwebå±‚ä»»ä½•ä½ç½®å°±éƒ½å¯ä»¥è·å–åˆ°äº†</li></ul><blockquote><p>è‡ªå®šä¹‰ä»£ç å®Œæˆä¸Šè¿°ContextLoaderListenerå’ŒWebApplicationContextUtilsï¼ˆè§ä»£ç ï¼‰</p></blockquote><div class="tabs" id="985af088-6b5b-4ddc-844e-be0c5d5b5dec"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#985af088-6b5b-4ddc-844e-be0c5d5b5dec-1"><i class="fas fa-seedling"></i>ContextLoaderListener</button></li><li class="tab"><button type="button" data-href="#985af088-6b5b-4ddc-844e-be0c5d5b5dec-2"><i class="fab fa-apple"></i>é…ç½®Listeneråˆ°web.xmlä¸­</button></li><li class="tab"><button type="button" data-href="#985af088-6b5b-4ddc-844e-be0c5d5b5dec-3"><i class="fas fa-leaf"></i>è·å–Springå®¹å™¨</button></li><li class="tab"><button type="button" data-href="#985af088-6b5b-4ddc-844e-be0c5d5b5dec-4"><i class="fas fa-tree"></i>å­˜åœ¨çš„é—®é¢˜</button></li><li class="tab"><button type="button" data-href="#985af088-6b5b-4ddc-844e-be0c5d5b5dec-5"><i class="fas fa-cookie-bite"></i>è§£å†³æ–¹å¼</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="985af088-6b5b-4ddc-844e-be0c5d5b5dec-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextLoaderListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        <span class="comment">//1. åˆ›å»ºSpringå®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//2. å°†å®¹å™¨å­˜å‚¨åˆ°ServletContextåŸŸä¸­</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> sce.getServletContext();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;applicationContext&quot;</span>,app);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="985af088-6b5b-4ddc-844e-be0c5d5b5dec-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.itheima.listener.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="985af088-6b5b-4ddc-844e-be0c5d5b5dec-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getServletContext();</span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) servletContext.getAttribute(<span class="string">&quot;applicationContext&quot;</span>);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="985af088-6b5b-4ddc-844e-be0c5d5b5dec-4"><p>é…ç½®æ–‡ä»¶åå­—å’Œè·å–Springå®¹å™¨keyå†™æ­»</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="985af088-6b5b-4ddc-844e-be0c5d5b5dec-5"><div class="tabs" id="a76920d6-2ba5-4775-ac57-231a39a2183d"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#a76920d6-2ba5-4775-ac57-231a39a2183d-1"><i class="fas fa-cat"></i>å®šä¹‰é…ç½®æ–‡ä»¶å…¨å±€å‚æ•°</button></li><li class="tab"><button type="button" data-href="#a76920d6-2ba5-4775-ac57-231a39a2183d-2"><i class="fas fa-horse"></i>è·å–é…ç½®æ–‡ä»¶åç§°</button></li><li class="tab"><button type="button" data-href="#a76920d6-2ba5-4775-ac57-231a39a2183d-3"><i class="fas fa-dove"></i>è§£è€¦æ–¹æ³•</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="a76920d6-2ba5-4775-ac57-231a39a2183d-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®šä¹‰å…¨å±€å‚æ•° --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.itheima.listener.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a76920d6-2ba5-4775-ac57-231a39a2183d-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextLoaderListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String CONTEXT_CONFIG_LOCATION= <span class="string">&quot;contextConfigLocation&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        <span class="comment">//0. è·å–contextConfigLocationé…ç½®æ–‡ä»¶åç§°</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> sce.getServletContext();</span><br><span class="line">        <span class="comment">//è§£æé…ç½®æ–‡ä»¶åå­—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">contextConfigLocation</span> <span class="operator">=</span> servletContext.getInitParameter(CONTEXT_CONFIG_LOCATION);</span><br><span class="line">        contextConfigLocation= contextConfigLocation.substring(<span class="string">&quot;classpath:&quot;</span>.length());</span><br><span class="line">        <span class="comment">//1. åˆ›å»ºSpringå®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(contextConfigLocation);</span><br><span class="line">        <span class="comment">//2. å°†å®¹å™¨å­˜å‚¨åˆ°ServletContextåŸŸä¸­</span></span><br><span class="line"></span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;applicationContext&quot;</span>,app);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a76920d6-2ba5-4775-ac57-231a39a2183d-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebApplicationContextUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title function_">getWebApplicationContext</span><span class="params">(ServletContext servletContext)</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) servletContext.getAttribute(<span class="string">&quot;applicationContext&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="1-3-Webå¼€å‘ç»„ä»¶spring-web">1.3 Webå¼€å‘ç»„ä»¶spring-web</h3><p>åˆ°æ­¤ï¼Œå°±å°†ä¸€å¼€å§‹çš„è¯‰æ±‚éƒ½è§£å†³äº†ï¼Œå½“ç„¶æˆ‘ä»¬èƒ½æƒ³åˆ°çš„Spring æ¡†æ¶è‡ªç„¶ä¹Ÿä¼šæƒ³åˆ°ï¼ŒSpringå…¶å®å·²ç»ä¸ºæˆ‘ä»¬å®šä¹‰å¥½äº†ä¸€ä¸ª<code>ContextLoaderListener</code>ï¼Œä½¿ç”¨æ–¹å¼è·Ÿæˆ‘ä»¬ä¸Šé¢è‡ªå·±å®šä¹‰çš„å¤§ä½“ä¸€æ ·ï¼Œä½†æ˜¯åŠŸèƒ½è¦æ¯”æˆ‘ä»¬å¼ºç™¾å€ï¼Œæ‰€ä»¥ ï¼Œéµå¾ªSpring â€œæ‹¿æ¥ä¸»ä¹‰â€ çš„ç²¾ç¥ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Springæä¾›çš„å°±å¯ä»¥äº†ã€‚å¼€å‘å¦‚ä¸‹ï¼š</p><div class="tabs" id="b05494f3-2fe1-4bf0-935f-436241e8a631"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#b05494f3-2fe1-4bf0-935f-436241e8a631-1"><i class="fas fa-seedling"></i>å¯¼å…¥åæ ‡</button></li><li class="tab"><button type="button" data-href="#b05494f3-2fe1-4bf0-935f-436241e8a631-2"><i class="fas fa-leaf"></i>é…ç½®web.xml</button></li><li class="tab"><button type="button" data-href="#b05494f3-2fe1-4bf0-935f-436241e8a631-3"><i class="fab fa-apple"></i>ä½¿ç”¨</button></li><li class="tab"><button type="button" data-href="#b05494f3-2fe1-4bf0-935f-436241e8a631-4"><i class="fas fa-tree"></i>è¡¥å……</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="b05494f3-2fe1-4bf0-935f-436241e8a631-1"><p>å…ˆå¯¼å…¥Spring-webçš„åæ ‡ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="b05494f3-2fe1-4bf0-935f-436241e8a631-2"><p>åœ¨web.xmlä¸­å»é…ç½®<code>ContextLoaderListener</code>ï¼Œå¹¶æŒ‡å®šé…ç½®æ–‡ä»¶çš„ä½ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å®šä¹‰å…¨å±€å‚æ•°--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®Listener--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="b05494f3-2fe1-4bf0-935f-436241e8a631-3"><p>åœ¨Servletä¸­ç›´æ¥ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/accountServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getServletContext();</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> WebApplicationContextUtils.getWebApplicationContext(servletContext);</span><br><span class="line">        <span class="type">AccountService</span> <span class="variable">accountService</span> <span class="operator">=</span> app.getBean(AccountService.class);</span><br><span class="line">        accountService.transferMoney(<span class="string">&quot;tom&quot;</span>,<span class="string">&quot;lucy&quot;</span>,<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="b05494f3-2fe1-4bf0-935f-436241e8a631-4"><p>å¦‚æœæ ¸å¿ƒé…ç½®ç±»ä½¿ç”¨çš„æ˜¯æ³¨è§£å½¢å¼çš„ï¼Œé‚£ä¹ˆSpringå®¹å™¨æ˜¯<code>AnnotationConfigWebApplicationContext</code>ï¼Œå¦‚ä¸‹é…ç½®æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAnnotationConfigWebApplicationContext</span> <span class="keyword">extends</span> <span class="title class_">AnnotationConfigWebApplicationContext</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyAnnotationConfigWebApplicationContext</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//æ³¨å†Œæ ¸å¿ƒé…ç½®ç±»</span></span><br><span class="line">        <span class="built_in">super</span>.register(ApplicationContextConfig.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.itheima.web.MyAnnotationConfigWebApplicationContext<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="2-Webå±‚MVCæ¡†æ¶æ€æƒ³ä¸è®¾è®¡æ€è·¯">2. Webå±‚MVCæ¡†æ¶æ€æƒ³ä¸è®¾è®¡æ€è·¯</h2><p>Javaç¨‹åºå‘˜åœ¨å¼€å‘ä¸€èˆ¬éƒ½æ˜¯MVC+ä¸‰å±‚æ¶æ„ï¼ŒMVCæ˜¯webå¼€å‘æ¨¡å¼ï¼Œä¼ ç»Ÿçš„JavawebæŠ€æœ¯æ ˆå®ç°çš„MVCå¦‚ä¸‹</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427202851806.png" alt="image-20230427202851806" style="zoom: 50%;" /><p>åŸå§‹Javawebå¼€å‘ä¸­ï¼ŒServletå……å½“Controllerçš„è§’è‰²ï¼ŒJspå……å½“Viewè§’è‰²ï¼ŒJavaBeanå……å½“æ¨¡å‹è§’è‰²ï¼ŒåæœŸAjaxå¼‚æ­¥æµè¡Œåï¼Œåœ¨åŠ ä¸Šç°åœ¨å‰åç«¯åˆ†ç¦»å¼€å‘æ¨¡å¼æˆç†Ÿåï¼ŒViewå°±è¢«åŸå§‹Html+Vueæ›¿ä»£ã€‚åŸå§‹Javawebå¼€å‘ä¸­ï¼Œ Serviceå……å½“Controlleræœ‰å¾ˆå¤šå¼Šç«¯ï¼Œæ˜¾è€Œæ˜“è§çš„æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><table><thead><tr><th style="text-align:left">Servletä½œä¸ºControllerçš„é—®é¢˜</th><th style="text-align:left">è§£å†³æ€è·¯å’Œæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td style="text-align:left">æ¯ä¸ªä¸šåŠ¡åŠŸèƒ½è¯·æ±‚éƒ½å¯¹åº”ä¸€ä¸ªServlet</td><td style="text-align:left">æ ¹æ®ä¸šåŠ¡æ¨¡å—å»åˆ’åˆ†Controller</td></tr><tr><td style="text-align:left">æ¯ä¸ªServletçš„ä¸šåŠ¡æ“ä½œå¤ªç¹ç</td><td style="text-align:left">å°†é€šç”¨çš„è¡Œä¸ºï¼ŒåŠŸèƒ½è¿›è¡ŒæŠ½å–å°è£…</td></tr><tr><td style="text-align:left">Servletè·å¾—Springå®¹å™¨çš„ç»„ä»¶åªèƒ½é€šè¿‡å®¢æˆ·ç«¯ä»£ç å»è·å–ï¼Œä¸èƒ½ä¼˜é›…çš„æ•´åˆ</td><td style="text-align:left">é€šè¿‡Springçš„æ‰©å±•ç‚¹ï¼Œå»å°è£…ä¸€ä¸ªæ¡†æ¶ï¼Œä»åŸæœ‰çš„Servletå®Œå…¨æ¥æ‰‹è¿‡æ¥webå±‚çš„ä¸šåŠ¡</td></tr></tbody></table><p>åˆ†æå‰ç«¯æ§åˆ¶å™¨åŸºæœ¬åŠŸèƒ½å¦‚ä¸‹ï¼š</p><p>1ã€å…·å¤‡å¯ä»¥æ˜ å°„åˆ°ä¸šåŠ¡Beançš„èƒ½åŠ›</p><p>2ã€å…·å¤‡å¯ä»¥è§£æè¯·æ±‚å‚æ•°ã€å°è£…å®ä½“ç­‰å…±æœ‰åŠŸèƒ½</p><p>3ã€å…·å¤‡å“åº”è§†å›¾åŠå“åº”å…¶ä»–æ•°æ®çš„åŠŸèƒ½</p><span class='p green'>è´Ÿè´£å…±æœ‰è¡Œä¸º</span>çš„Servletç§°ä¹‹ä¸º`å‰ç«¯æ§åˆ¶å™¨`<span class='p blue'>è´Ÿè´£ä¸šåŠ¡è¡Œä¸º</span>çš„JavaBeanç§°ä¹‹ä¸º`æ§åˆ¶å™¨Controller`<img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427100450596.png" alt="image-20230427100450596" style="zoom: 67%;" />]]></content>
    
    
    <summary type="html">Springæ•´åˆwebç¯å¢ƒã€Webå±‚MVCæ¡†æ¶æ€æƒ³ä¸è®¾è®¡æ€è·¯</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="SpringMVC" scheme="https://wuwawawa.github.io/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºAOPçš„ç”³æ˜å¼äº‹åŠ¡æ§åˆ¶</title>
    <link href="https://wuwawawa.github.io/posts/8f292d64.html"/>
    <id>https://wuwawawa.github.io/posts/8f292d64.html</id>
    <published>2023-04-29T13:33:55.000Z</published>
    <updated>2023-04-27T01:25:52.267Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Springäº‹åŠ¡ç¼–ç¨‹æ¦‚è¿°">1. Springäº‹åŠ¡ç¼–ç¨‹æ¦‚è¿°</h2><p>äº‹åŠ¡æ˜¯å¼€å‘ä¸­å¿…ä¸å¯å°‘çš„ä¸œè¥¿ï¼Œä½¿ç”¨JDBCå¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨connnectionå¯¹äº‹åŠ¡è¿›è¡Œæ§åˆ¶ï¼Œä½¿ç”¨MyBatisæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>SqlSession</code>å¯¹äº‹åŠ¡è¿›è¡Œæ§åˆ¶ï¼Œç¼ºç‚¹æ˜¾è€Œæ˜“è§ï¼Œå½“æˆ‘ä»¬åˆ‡æ¢æ•°æ®åº“è®¿é—®æŠ€æœ¯æ—¶ï¼Œäº‹åŠ¡æ§åˆ¶çš„æ–¹å¼æ€»ä¼šå˜åŒ–ï¼Œ Spring å°±å°†è¿™äº›æŠ€æœ¯åŸºç¡€ä¸Šï¼Œæä¾›äº†ç»Ÿä¸€çš„æ§åˆ¶äº‹åŠ¡çš„æ¥å£ã€‚Springçš„äº‹åŠ¡åˆ†ä¸ºï¼š<code>ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶</code>å’Œ<code>å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</code></p><table><thead><tr><th>äº‹åŠ¡æ§åˆ¶æ–¹å¼</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶</td><td>Springæä¾›äº†äº‹åŠ¡æ§åˆ¶çš„ç±»å’Œæ–¹æ³•ï¼Œä½¿ç”¨ç¼–ç çš„æ–¹å¼å¯¹ä¸šåŠ¡ä»£ç è¿›è¡Œäº‹åŠ¡æ§åˆ¶ï¼Œäº‹åŠ¡æ§åˆ¶ä»£ç å’Œä¸šåŠ¡æ“ä½œä»£ç è€¦åˆåˆ°äº†ä¸€èµ·ï¼Œå¼€å‘ä¸­ä¸ä½¿ç”¨</td></tr><tr><td>å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</td><td>Springå°†äº‹åŠ¡æ§åˆ¶çš„ä»£ç å°è£…ï¼Œå¯¹å¤–æä¾›äº†Xmlå’Œæ³¨è§£é…ç½®æ–¹å¼ï¼Œé€šè¿‡é…ç½®çš„æ–¹å¼å®Œæˆäº‹åŠ¡çš„æ§åˆ¶ï¼Œå¯ä»¥è¾¾åˆ°äº‹åŠ¡æ§åˆ¶ä¸ä¸šåŠ¡æ“ä½œä»£ç è§£è€¦åˆï¼Œå¼€å‘ä¸­æ¨èä½¿ç”¨</td></tr></tbody></table><p>Springäº‹åŠ¡ç¼–ç¨‹ç›¸å…³çš„ç±»ä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ä¸ª</p><table><thead><tr><th style="text-align:left">äº‹åŠ¡æ§åˆ¶ç›¸å…³ç±»</th><th style="text-align:left">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">å¹³å°äº‹åŠ¡ç®¡ç†å™¨<br/><code>PlatformTransactionManager</code></td><td style="text-align:left">æ˜¯ä¸€ä¸ªæ¥å£æ ‡å‡†ï¼Œå®ç°ç±»éƒ½å…·å¤‡äº‹åŠ¡æäº¤ã€å›æ»šå’Œè·å¾—äº‹åŠ¡å¯¹è±¡çš„åŠŸèƒ½ï¼Œä¸åŒæŒä¹…å±‚æ¡†æ¶å¯èƒ½ä¼šæœ‰ä¸åŒå®ç°æ–¹æ¡ˆ</td></tr><tr><td style="text-align:left">äº‹åŠ¡å®šä¹‰<br/><code>TransactionDefinition</code></td><td style="text-align:left">å°è£…äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¿‡æœŸæ—¶é—´ç­‰å±æ€§ä¿¡æ¯</td></tr><tr><td style="text-align:left">äº‹åŠ¡çŠ¶æ€<br/><code>TransactionStatus</code></td><td style="text-align:left">å­˜å‚¨å½“å‰äº‹åŠ¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚æœäº‹åŠ¡æ˜¯å¦æäº¤ã€æ˜¯å¦å›æ»šã€æ˜¯å¦æœ‰å›æ»šç‚¹ç­‰</td></tr></tbody></table><p>è™½ç„¶ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶æˆ‘ä»¬ä¸å­¦ä¹ ï¼Œä½†æ˜¯ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶å¯¹åº”çš„è¿™äº›ç±»æˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨é€šè¿‡é…ç½®çš„æ–¹å¼è¿›è¡Œå£°æ˜å¼äº‹åŠ¡æ§åˆ¶æ—¶ä¹Ÿä¼šçœ‹åˆ°è¿™äº›ç±»çš„å½±å­</p><hr><h2 id="2-æ­å»ºæµ‹è¯•ç¯å¢ƒ">2. æ­å»ºæµ‹è¯•ç¯å¢ƒ</h2><p>æ­å»ºä¸€ä¸ªè½¬è´¦çš„ç¯å¢ƒï¼Œdaoå±‚ä¸€ä¸ªè½¬å‡ºé’±çš„æ–¹æ³•ï¼Œä¸€ä¸ªè½¬å…¥é’±çš„æ–¹æ³•ï¼Œserviceå±‚ä¸€ä¸ªè½¬è´¦ä¸šåŠ¡æ–¹æ³•ï¼Œå†…éƒ¨åˆ†åˆ«è°ƒç”¨daoå±‚è½¬å‡ºé’±å’Œè½¬å…¥é’±çš„æ–¹æ³•ï¼Œå‡†å¤‡å·¥ä½œå¦‚ä¸‹ï¼š</p><ul><li><p>æ•°æ®åº“å‡†å¤‡ä¸€ä¸ªè´¦æˆ·è¡¨tb_account;</p></li><li><p>daoå±‚å‡†å¤‡ä¸€ä¸ªAccountMapperï¼ŒåŒ…æ‹¬incrMoneyå’ŒdecrMoneyä¸¤ä¸ªæ–¹æ³•ï¼›</p></li><li><p>serviceå±‚å‡†å¤‡ä¸€ä¸ªtransferMoneyæ–¹æ³•ï¼Œåˆ†åˆ«è°ƒç”¨incrMoneyå’ŒdecrMoneyæ–¹æ³•ï¼›</p></li><li><p>åœ¨applicationContextæ–‡ä»¶ä¸­è¿›è¡ŒBeançš„ç®¡ç†é…ç½®ï¼›</p></li><li><p>æµ‹è¯•æ­£å¸¸è½¬è´¦ä¸å¼‚å¸¸è½¬è´¦ã€‚</p></li></ul><hr><h2 id="3-åŸºäºxmlå£°æ˜å¼äº‹åŠ¡æ§åˆ¶">3. åŸºäºxmlå£°æ˜å¼äº‹åŠ¡æ§åˆ¶</h2><p>ç»“åˆä¸Šé¢æˆ‘ä»¬å­¦ä¹ çš„AOPçš„æŠ€æœ¯ï¼Œå¾ˆå®¹æ˜“å°±å¯ä»¥æƒ³åˆ°ï¼Œå¯ä»¥ä½¿ç”¨AOPå¯¹Serviceçš„æ–¹æ³•è¿›è¡Œäº‹åŠ¡çš„å¢å¼ºã€‚</p><ul><li><p>ç›®æ ‡ç±»ï¼šAccountServiceImpl</p></li><li><p>åˆ‡ç‚¹ï¼šserviceä¸šåŠ¡ç±»ä¸­çš„æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•</p></li><li><p>é€šçŸ¥ç±»ï¼šSpringæä¾›çš„ï¼Œé€šçŸ¥æ–¹æ³•å·²ç»å®šä¹‰å¥½ï¼Œåªéœ€è¦é…ç½®å³å¯</p></li></ul><p>æˆ‘ä»¬åˆ†æï¼š</p><p>ç›®æ ‡ç±»æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ï¼›</p><ul><li><p>é€šçŸ¥ç±»æ˜¯Springæä¾›çš„ï¼Œéœ€è¦å¯¼å…¥Springäº‹åŠ¡çš„ç›¸å…³çš„åæ ‡ï¼›</p></li><li><p>é…ç½®ç›®æ ‡ç±»AccountServiceImplï¼›</p></li><li><p>ä½¿ç”¨advisoræ ‡ç­¾é…ç½®åˆ‡é¢ã€‚</p></li></ul><p>å¯¼å…¥Springäº‹åŠ¡çš„ç›¸å…³çš„åæ ‡ï¼Œspring-jdbcåæ ‡å·²ç»å¼•å…¥çš„spring-txåæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.13.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426103319358.png" alt="image-20230426103319358"></p><p>é…ç½®ç›®æ ‡ç±»AccountServiceImpl</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.AccoutServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountMapper&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountMapper&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨advisoræ ‡ç­¾é…ç½®åˆ‡é¢</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;Springæä¾›çš„é€šçŸ¥ç±»&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.itheima.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç–‘é—®ï¼šSpringæä¾›çš„é€šçŸ¥ç±»æ˜¯è°ï¼Ÿæ˜¯è°ï¼Ÿ</p><p>æ˜¯spring-txåŒ…ä¸‹çš„adviceæ ‡ç­¾é…ç½®æä¾›çš„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; </span><br><span class="line">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Springæä¾›çš„äº‹åŠ¡é€šçŸ¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;transferMoney&quot;</span> <span class="attr">isolation</span>=<span class="string">&quot;READ_COMMITTED&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;add*&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;update*&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;delete*&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;select*&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å¹³å°äº‹åŠ¡ç®¡ç†å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.itheima.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹ä¸Šè¿°é…ç½®è¿›è¡Œè¯¦è§£ä¸€ä¸‹<br>é¦–å…ˆï¼Œå¹³å°äº‹åŠ¡ç®¡ç†å™¨PlatformTransactionManageræ˜¯Springæä¾›çš„å°è£…äº‹åŠ¡å…·ä½“æ“ä½œçš„è§„èŒƒæ¥å£ï¼Œå°è£…äº†äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PlatformTransactionManager</span> <span class="keyword">extends</span> <span class="title class_">TransactionManager</span> &#123;</span><br><span class="line">    TransactionStatus <span class="title function_">getTransaction</span><span class="params">(<span class="meta">@Nullable</span> TransactionDefinition var1)</span> <span class="keyword">throws</span> TransactionException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(TransactionStatus var1)</span> <span class="keyword">throws</span> TransactionException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">(TransactionStatus var1)</span> <span class="keyword">throws</span> TransactionException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸åŒçš„æŒä¹…å±‚æ¡†æ¶äº‹åŠ¡æ“ä½œçš„æ–¹å¼æœ‰å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥ä¸åŒçš„æŒä¹…å±‚æ¡†æ¶æœ‰å¯èƒ½ä¼šæœ‰ä¸åŒçš„å¹³å°äº‹åŠ¡ç®¡ç†å™¨å®ç°ï¼Œä¾‹å¦‚ï¼ŒMyBatisä½œä¸ºæŒä¹…å±‚æ¡†æ¶æ—¶ï¼Œä½¿ç”¨çš„å¹³å°äº‹åŠ¡ç®¡ç†å™¨å®ç°æ˜¯DataSourceTransactionManagerã€‚ Hibernateä½œä¸ºæŒä¹…å±‚æ¡†æ¶æ—¶ï¼Œä½¿ç”¨çš„å¹³å°äº‹åŠ¡ç®¡ç†å™¨æ˜¯HibernateTransactionManagerã€‚</p><p>å…¶æ¬¡ï¼Œäº‹åŠ¡å®šä¹‰ä¿¡æ¯é…ç½®ï¼Œæ¯ä¸ªäº‹åŠ¡æœ‰å¾ˆå¤šç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šéš”ç¦»çº§åˆ«ã€åªè¯»çŠ¶æ€ã€è¶…æ—¶æ—¶é—´ç­‰ï¼Œè¿™äº›ä¿¡æ¯åœ¨å¼€å‘æ—¶å¯ä»¥é€šè¿‡connectionè¿›è¡ŒæŒ‡å®šï¼Œè€Œæ­¤å¤„è¦é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;æ–¹æ³•åç§°&quot;</span> <span class="attr">isolation</span>=<span class="string">&quot;éš”ç¦»çº§åˆ«&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;ä¼ æ’­è¡Œä¸º&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;åªè¯»çŠ¶æ€&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;è¶…æ—¶æ—¶é—´&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œnameå±æ€§åç§°æŒ‡å®šå“ªä¸ªæ–¹æ³•è¦è¿›è¡Œå“ªäº›äº‹åŠ¡çš„å±æ€§é…ç½®ï¼Œæ­¤å¤„éœ€è¦åŒºåˆ†çš„æ˜¯åˆ‡ç‚¹è¡¨è¾¾å¼æŒ‡å®šçš„æ–¹æ³•ä¸æ­¤å¤„æŒ‡å®šçš„æ–¹æ³•çš„åŒºåˆ«ï¼Ÿåˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œæ˜¯è¿‡æ»¤å“ªäº›æ–¹æ³•å¯ä»¥è¿›è¡Œäº‹åŠ¡å¢å¼ºï¼›äº‹åŠ¡å±æ€§ä¿¡æ¯çš„nameï¼Œæ˜¯æŒ‡å®šå“ªä¸ªæ–¹æ³•è¦è¿›è¡Œå“ªäº›äº‹åŠ¡å±æ€§çš„é…ç½®</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230427092027314.png" alt="image-20230427092027314" style="zoom:67%;" /><p>ç¬¬ä¸€å±‚ç­›é€‰æ˜¯ç¬¦åˆåˆ‡é¢è¡¨è¾¾å¼çš„æ–¹æ³•</p><p>ç¬¬äºŒå±‚æ˜¯å¯¹æ–¹æ³•æŒ‡å®šäº‹åŠ¡çš„å±æ€§</p><p>æ–¹æ³•ååœ¨é…ç½®æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ * è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ç²¾ç¡®åŒ¹é…transferMoneyæ–¹æ³•--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;transferMoney&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ¨¡ç³ŠåŒ¹é…ä»¥Serviceç»“å°¾çš„æ–¹æ³•--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*Service&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ¨¡ç³ŠåŒ¹é…ä»¥insertå¼€å¤´çš„æ–¹æ³•--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;insert*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ¨¡ç³ŠåŒ¹é…ä»¥updateå¼€å¤´çš„æ–¹æ³•--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;update*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ¨¡ç³ŠåŒ¹é…ä»»æ„æ–¹æ³•ï¼Œä¸€èˆ¬æ”¾åˆ°æœ€åä½œä¸ºä¿åº•åŒ¹é…--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure><p>isolationå±æ€§ï¼šæŒ‡å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡å¹¶å‘å­˜åœ¨ä¸‰å¤§é—®é¢˜ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»/è™šè¯»ã€‚å¯ä»¥é€šè¿‡è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ¥ä¿è¯å¹¶å‘é—®é¢˜çš„å‡ºç°ï¼Œå¸¸ç”¨çš„æ˜¯READ_COMMITTED å’ŒREPEATABLE_READ</p><table><thead><tr><th style="text-align:left">isolationå±æ€§</th><th style="text-align:left">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">DEFAULT</td><td style="text-align:left">é»˜è®¤éš”ç¦»çº§åˆ«ï¼Œå–å†³äºå½“å‰æ•°æ®åº“éš”ç¦»çº§åˆ«ï¼Œä¾‹å¦‚MySQLé»˜è®¤éš”ç¦»çº§åˆ«æ˜¯REPEATABLE_READ</td></tr><tr><td style="text-align:left">READ_UNCOMMITTED</td><td style="text-align:left">Aäº‹åŠ¡å¯ä»¥è¯»å–åˆ°Bäº‹åŠ¡å°šæœªæäº¤çš„äº‹åŠ¡è®°å½•ï¼Œä¸èƒ½è§£å†³ä»»ä½•å¹¶å‘é—®é¢˜ï¼Œå®‰å…¨æ€§æœ€ä½ï¼Œæ€§èƒ½æœ€é«˜</td></tr><tr><td style="text-align:left">READ_COMMITTED</td><td style="text-align:left">Aäº‹åŠ¡åªèƒ½è¯»å–åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„è®°å½•ï¼Œä¸èƒ½è¯»å–åˆ°æœªæäº¤çš„è®°å½•ã€‚å¯ä»¥è§£å†³è„è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¸èƒ½è§£å†³ä¸å¯é‡å¤è¯»å’Œå¹»è¯»</td></tr><tr><td style="text-align:left">REPEATABLE_READ</td><td style="text-align:left">Aäº‹åŠ¡å¤šæ¬¡ä»æ•°æ®åº“è¯»å–æŸæ¡è®°å½•ç»“æœä¸€è‡´ï¼Œå¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»ï¼Œä¸å¯ä»¥è§£å†³å¹»è¯»</td></tr><tr><td style="text-align:left">SERIALIZABLE</td><td style="text-align:left">ä¸²è¡ŒåŒ–ï¼Œå¯ä»¥è§£å†³ä»»ä½•å¹¶å‘é—®é¢˜ï¼Œå®‰å…¨æ€§æœ€é«˜ï¼Œä½†æ˜¯æ€§èƒ½æœ€ä½</td></tr></tbody></table><p>read-onlyå±æ€§ï¼šè®¾ç½®å½“å‰çš„åªè¯»çŠ¶æ€ï¼Œå¦‚æœæ˜¯æŸ¥è¯¢åˆ™è®¾ç½®ä¸ºtrueï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œå¦‚æœæ˜¯æ›´æ–°ï¼ˆå¢åˆ æ”¹ï¼‰æ“ä½œåˆ™è®¾ç½®ä¸ºfalse</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¸€èˆ¬æŸ¥è¯¢ç›¸å…³çš„ä¸šåŠ¡æ“ä½œéƒ½ä¼šè®¾ç½®ä¸ºåªè¯»æ¨¡å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;select*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>timeoutå±æ€§ï¼šè®¾ç½®äº‹åŠ¡æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ ï¼Œä¸åœ¨ç»§ç»­æ‰§è¡Œã€‚é»˜è®¤å€¼æ˜¯-1ï¼Œå³æ²¡æœ‰è¶…æ—¶æ—¶é—´é™åˆ¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è®¾ç½®æŸ¥è¯¢æ“ä½œçš„è¶…æ—¶æ—¶é—´æ˜¯3ç§’ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;select*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>propagationå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œä¸»è¦è§£å†³æ˜¯Aæ–¹æ³•è°ƒç”¨Bæ–¹æ³•æ—¶ï¼Œäº‹åŠ¡çš„ä¼ æ’­æ–¹å¼é—®é¢˜çš„ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨å•æ–¹çš„äº‹åŠ¡ï¼Œè¿˜æ˜¯Aå’ŒBéƒ½ä½¿ç”¨è‡ªå·±çš„äº‹åŠ¡ç­‰ã€‚äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºæœ‰å¦‚ä¸‹ä¸ƒç§å±æ€§å€¼å¯é…ç½®</p><table><thead><tr><th style="text-align:left">äº‹åŠ¡ä¼ æ’­è¡Œä¸º</th><th style="text-align:left">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">REQUIREDï¼ˆé»˜è®¤å€¼ï¼‰</td><td style="text-align:left">Aè°ƒç”¨Bï¼ŒBéœ€è¦äº‹åŠ¡ï¼Œå¦‚æœAæœ‰äº‹åŠ¡Bå°±åŠ å…¥Açš„äº‹åŠ¡ä¸­ï¼Œå¦‚æœAæ²¡æœ‰äº‹åŠ¡ï¼ŒBå°±è‡ªå·±åˆ›å»ºä¸€ä¸ªäº‹åŠ¡</td></tr><tr><td style="text-align:left">REQUIRED_NEW</td><td style="text-align:left">Aè°ƒç”¨Bï¼ŒBéœ€è¦æ–°äº‹åŠ¡ï¼Œå¦‚æœAæœ‰äº‹åŠ¡å°±æŒ‚èµ·ï¼ŒBè‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡</td></tr><tr><td style="text-align:left">SUPPORTS</td><td style="text-align:left">Aè°ƒç”¨Bï¼ŒBæœ‰æ— äº‹åŠ¡æ— æ‰€è°“ï¼ŒAæœ‰äº‹åŠ¡å°±åŠ å…¥åˆ°Aäº‹åŠ¡ä¸­ï¼ŒAæ— äº‹åŠ¡Bå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ</td></tr><tr><td style="text-align:left">NOT_SUPPORTS</td><td style="text-align:left">Aè°ƒç”¨Bï¼ŒBä»¥æ— äº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ŒAå¦‚æœ‰äº‹åŠ¡åˆ™æŒ‚èµ·</td></tr><tr><td style="text-align:left">NEVER</td><td style="text-align:left">Aè°ƒç”¨Bï¼ŒBä»¥æ— äº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ŒAå¦‚æœ‰äº‹åŠ¡åˆ™æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td style="text-align:left">MANDATORY</td><td style="text-align:left">Aè°ƒç”¨Bï¼ŒBè¦åŠ å…¥Açš„äº‹åŠ¡ä¸­ï¼Œå¦‚æœAæ— äº‹åŠ¡å°±æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td style="text-align:left">NESTED</td><td style="text-align:left">Aè°ƒç”¨Bï¼ŒBåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼ŒAæœ‰äº‹åŠ¡å°±ä½œä¸ºåµŒå¥—äº‹åŠ¡å­˜åœ¨ï¼ŒAæ²¡äº‹åŠ¡å°±ä»¥åˆ›å»ºçš„æ–°äº‹åŠ¡æ‰§è¡Œ</td></tr></tbody></table><p>xmlæ–¹å¼å£°æ˜å¼äº‹åŠ¡æ§åˆ¶çš„åŸç†æµ…æä¸€ä¸‹</p><p><code>&lt;tx:advice&gt;</code>æ ‡ç­¾ä½¿ç”¨çš„å‘½åç©ºé—´å¤„ç†å™¨æ˜¯<code>TxNamespaceHandler</code>ï¼Œå†…éƒ¨æ³¨å†Œçš„æ˜¯è§£æå™¨æ˜¯<code>TxAdviceBeanDefinitionParser</code></p><p><code>this.registerBeanDefinitionParser(&quot;advice&quot;, new TxAdviceBeanDefinitionParser());</code></p><p><code>TxAdviceBeanDefinitionParser</code>ä¸­æŒ‡å®šäº†è¦æ³¨å†Œçš„BeanDefinition</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; getBeanClass(Element element) &#123;</span><br><span class="line">    <span class="keyword">return</span> TransactionInterceptor.class;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>TxAdviceBeanDefinitionParser</code>äºŒçº§çˆ¶ç±»AbstractBeanDefinitionParserçš„parseæ–¹æ³•å°†<code>TransactionInterceptor</code>ä»¥é…ç½®çš„åç§°(myAdvice)æ³¨å†Œåˆ°äº†Springå®¹å™¨ä¸­</p><p><code>parserContext.registerComponent(componentDefinition);</code></p><p>TransactionInterceptorå®ç°äº†MethodInterceptoræ¥å£ï¼šAOPçš„å¦ä¸€ç§é…ç½®æ–¹å¼ï¼Œè¯¥æ–¹å¼éœ€è¦é€šçŸ¥ç±»å®ç°Adviceçš„å­åŠŸèƒ½æ¥å£ã€‚ç›¸å½“äºç¯ç»•é€šçŸ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionInterceptor</span> <span class="keyword">extends</span> <span class="title class_">TransactionAspectSupport</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span>, Serializable&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// Work out the target class: may be &#123;@code null&#125;.</span></span><br><span class="line">        <span class="comment">// The TransactionAttributeSource should be passed the target class</span></span><br><span class="line">        <span class="comment">// as well as the method, which may be from an interface.</span></span><br><span class="line">        Class&lt;?&gt; targetClass = (invocation.getThis() != <span class="literal">null</span> ? AopUtils.getTargetClass(invocation.getThis()) : <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Adapt to TransactionAspectSupport&#x27;s invokeWithinTransaction...</span></span><br><span class="line">        <span class="keyword">return</span> invokeWithinTransaction(invocation.getMethod(), targetClass, invocation::proceed);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>TransactionInterceptor</code>ä¸­çš„invokeæ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼Œè·Ÿè¸ªinvokeæ–¹æ³•ï¼Œæœ€ç»ˆä¼šçœ‹åˆ°äº‹åŠ¡çš„å¼€å¯å’Œæäº¤</p><ul><li>åœ¨AbstractPlatformTransactionManagerå¼€å¯çš„äº‹åŠ¡ï¼›</li><li>åœ¨TransactionAspectSupportæäº¤äº†äº‹åŠ¡ã€‚</li></ul><hr><h2 id="4-åŸºäºæ³¨è§£å£°æ˜å¼äº‹åŠ¡æ§åˆ¶">4. åŸºäºæ³¨è§£å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</h2><p>æ³¨è§£å°±æ˜¯å¯¹xmlçš„æ›¿ä»£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;accountService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccoutServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line">    <span class="comment">//&lt;tx:method name=&quot;*&quot; isolation=&quot;REPEATABLE_READ&quot; propagation=&quot;REQUIREDâ€œ/&gt;</span></span><br><span class="line">    <span class="meta">@Transactional(isolation = Isolation.REPEATABLE_READ,propagation = Propagation.REQUIRED,readOnly = false,timeout = 5)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transferMoney</span><span class="params">(String decrAccountName, String incrAccountName, <span class="type">int</span> money)</span> &#123;</span><br><span class="line">        accountMapper.decrMoney(decrAccountName,money); <span class="comment">//è½¬å‡ºé’±</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>; <span class="comment">//æ¨¡æ‹ŸæŸäº›é€»è¾‘äº§ç”Ÿçš„å¼‚å¸¸</span></span><br><span class="line">        accountMapper.incrMoney(incrAccountName,money); <span class="comment">//è½¬å…¥é’±</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œä½¿ç”¨çš„äº‹åŠ¡çš„æ³¨è§£ï¼Œå¹³å°äº‹åŠ¡ç®¡ç†å™¨ä»ç„¶éœ€è¦é…ç½®ï¼Œè¿˜éœ€è¦è¿›è¡Œäº‹åŠ¡æ³¨è§£å¼€å…³çš„å¼€å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®äº‹åŠ¡çš„æ³¨è§£é©±åŠ¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨å…¨æ³¨è§£çš„è¯ï¼Œä½¿ç”¨å¦‚ä¸‹é…ç½®ç±»çš„å½¢å¼ä»£æ›¿é…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima.service&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.itheima.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PlatformTransactionManager <span class="title function_">tansactionManager</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">DataSourceTransactionManager</span> <span class="variable">transactionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">        transactionManager.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–é…ç½® ...</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Springäº‹åŠ¡ç¼–ç¨‹</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Spring" scheme="https://wuwawawa.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºæ³¨è§£é…ç½®çš„AOP</title>
    <link href="https://wuwawawa.github.io/posts/62726e73.html"/>
    <id>https://wuwawawa.github.io/posts/62726e73.html</id>
    <published>2023-04-28T13:33:28.000Z</published>
    <updated>2023-04-26T12:46:24.629Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-æ³¨è§£æ–¹å¼AOPåŸºæœ¬ä½¿ç”¨">1. æ³¨è§£æ–¹å¼AOPåŸºæœ¬ä½¿ç”¨</h2><p>Springçš„AOPä¹Ÿæä¾›äº†æ³¨è§£æ–¹å¼é…ç½®ï¼Œä½¿ç”¨ç›¸åº”çš„æ³¨è§£æ›¿ä»£ä¹‹å‰çš„xmlé…ç½®ï¼Œxmlé…ç½®AOPæ—¶ï¼Œæˆ‘ä»¬ä¸»è¦é…ç½®äº†ä¸‰éƒ¨åˆ†ï¼š<code>ç›®æ ‡ç±»è¢«Springå®¹å™¨ç®¡ç†</code>ã€<code>é€šçŸ¥ç±»è¢«Springç®¡ç†</code>ã€<code>é€šçŸ¥ä¸åˆ‡ç‚¹çš„ç»‡å…¥ï¼ˆåˆ‡é¢ï¼‰</code>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®ç›®æ ‡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;target&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.aop.TargetImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®é€šçŸ¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;advices&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.aop.Advices&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®aop--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;advices&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.itheima.aop.*.*(..))&quot;</span>/&gt;</span> <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç›®æ ‡ç±»è¢«Springå®¹å™¨ç®¡ç†ã€é€šçŸ¥ç±»è¢«Springç®¡ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;target&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TargetImpl</span> <span class="keyword">implements</span> <span class="title class_">Target</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show Target running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnoAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•å‰é€šçŸ¥...&quot;</span>); </span><br><span class="line">        joinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•åé€šçŸ¥...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®aopï¼Œå…¶å®é…ç½®aopä¸»è¦å°±æ˜¯é…ç½®é€šçŸ¥ç±»ä¸­çš„å“ªä¸ªæ–¹æ³•ï¼ˆé€šçŸ¥ç±»å‹ï¼‰å¯¹åº”çš„åˆ‡ç‚¹è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426100037391.png" alt="image-20230426100037391"></p><p>æ³¨è§£@Aspectã€@Aroundéœ€è¦è¢«Springè§£æï¼Œæ‰€ä»¥åœ¨Springæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­éœ€è¦é…ç½®aspectjçš„è‡ªåŠ¨ä»£ç†</p><p><code>&lt;aop:aspectj-autoproxy/&gt;</code></p><p>å¦‚æœæ ¸å¿ƒé…ç½®ä½¿ç”¨çš„æ˜¯é…ç½®ç±»çš„è¯ï¼Œéœ€è¦é…ç½®æ³¨è§£æ–¹å¼çš„aopè‡ªåŠ¨ä»£ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima.aop&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>    <span class="comment">//ç¬¬ä¸‰æ­¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123; &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="2-æ³¨è§£æ–¹å¼AOPé…ç½®è¯¦è§£">2. æ³¨è§£æ–¹å¼AOPé…ç½®è¯¦è§£</h2><p>å„ç§æ³¨è§£æ–¹å¼é€šçŸ¥ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line"><span class="meta">@Before(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span>&#123;&#125;</span><br><span class="line"><span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line"><span class="meta">@AfterReturning(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">AfterReturning</span><span class="params">(JoinPoint joinPoint)</span>&#123;&#125;</span><br><span class="line"><span class="comment">//ç¯ç»•é€šçŸ¥</span></span><br><span class="line"><span class="meta">@Around(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;&#125;</span><br><span class="line"><span class="comment">//å¼‚å¸¸é€šçŸ¥</span></span><br><span class="line"><span class="meta">@AfterThrowing(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">AfterThrowing</span><span class="params">(JoinPoint joinPoint)</span>&#123;&#125;</span><br><span class="line"><span class="comment">//æœ€ç»ˆé€šçŸ¥</span></span><br><span class="line"><span class="meta">@After(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">After</span><span class="params">(JoinPoint joinPoint)</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–ï¼Œä½¿ç”¨ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œå°†åˆ‡ç‚¹è¡¨è¾¾å¼æ ‡æ³¨åœ¨ç©ºæ–¹æ³•ä¸Šï¼Œå…¶ä»–é€šçŸ¥æ–¹æ³•å¼•ç”¨å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnoAdvice</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ‡ç‚¹è¡¨è¾¾å¼æŠ½å–</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span>&#123;&#125;</span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;AnnoAdvice.pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">AfterReturning</span><span class="params">(JoinPoint joinPoint)</span>&#123;&#125;</span><br><span class="line">    <span class="comment">// ...  çœç•¥å…¶ä»–ä»£ç  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="3-æ³¨è§£æ–¹å¼AOPåŸç†å‰–æ">3. æ³¨è§£æ–¹å¼AOPåŸç†å‰–æ</h2><p>ä¹‹å‰åœ¨ä½¿ç”¨xmlé…ç½®AOPæ—¶ï¼Œæ˜¯å€ŸåŠ©çš„Springçš„å¤–éƒ¨å‘½åç©ºé—´çš„åŠ è½½æ–¹å¼å®Œæˆçš„ï¼Œä½¿ç”¨æ³¨è§£é…ç½®åï¼Œå°±æŠ›å¼ƒäº†<code>&lt;aop:config&gt;</code>æ ‡ç­¾ï¼Œè€Œè¯¥æ ‡ç­¾æœ€ç»ˆåŠ è½½äº†åä¸º<code>AspectJAwareAdvisorAutoProxyCreator</code>çš„<code>BeanPostProcessor</code> ï¼Œæœ€ç»ˆï¼Œåœ¨è¯¥<code>BeanPostProcessor</code>ä¸­å®Œæˆäº†ä»£ç†å¯¹è±¡çš„ç”Ÿæˆã€‚åŒæ ·ï¼Œä»aspectj-autoproxyæ ‡ç­¾çš„è§£æå™¨å…¥æ‰‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼€å¯aop aspectjçš„è‡ªåŠ¨ä»£ç†--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><code>this.registerBeanDefinitionParser(&quot;aspectj-autoproxy&quot;, new AspectJAutoProxyBeanDefinitionParser());</code></p><p>è€Œ<code>AspectJAutoProxyBeanDefinitionParser</code>ä»£ç å†…éƒ¨ï¼Œæœ€ç»ˆä¹Ÿæ˜¯æ‰§è¡Œäº†å’Œxmlæ–¹å¼AOPä¸€æ ·çš„ä»£ç </p><p><code>registerOrEscalateApcAsRequired(AnnotationAwareAspectJAutoProxyCreator.class, registry, source)</code></p><p>å¦‚æœä½¿ç”¨çš„æ˜¯æ ¸å¿ƒé…ç½®ç±»çš„è¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima.aop&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<code>@EnableAspectJAutoProxy</code>æºç ï¼Œä½¿ç”¨çš„ä¹Ÿæ˜¯@Importå¯¼å…¥ç›¸å…³è§£æç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(AspectJAutoProxyRegistrar.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAspectJAutoProxy &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">proxyTargetClass</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">exposeProxy</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨@Importå¯¼å…¥çš„<code>AspectJAutoProxyRegistrar</code>æºç ï¼Œä¸€è·¯è¿½è¸ªä¸‹å»ï¼Œæœ€ç»ˆè¿˜æ˜¯æ³¨å†Œäº†<code>AnnotationAwareAspectJAutoProxyCreator</code> è¿™ä¸ªç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AspectJAutoProxyRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(</span></span><br><span class="line"><span class="params">            AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(registry);</span><br><span class="line">       <span class="comment">//çœç•¥éƒ¨åˆ†ä»£ç ã€‚ã€‚ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BeanDefinition <span class="title function_">registerAspectJAnnotationAutoProxyCreatorIfNecessary</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> registerAspectJAnnotationAutoProxyCreatorIfNecessary(registry, (Object)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BeanDefinition <span class="title function_">registerAspectJAnnotationAutoProxyCreatorIfNecessary</span><span class="params">(BeanDefinitionRegistry registry, <span class="meta">@Nullable</span> Object source)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> registerOrEscalateApcAsRequired(AnnotationAwareAspectJAutoProxyCreator.class, registry, source);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426102339961.png" alt="image-20230426102339961"></p>]]></content>
    
    
    <summary type="html">æ³¨è§£æ–¹å¼AOPä½¿ç”¨</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Spring" scheme="https://wuwawawa.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºxmlé…ç½®çš„AOP</title>
    <link href="https://wuwawawa.github.io/posts/a160028.html"/>
    <id>https://wuwawawa.github.io/posts/a160028.html</id>
    <published>2023-04-27T13:33:20.000Z</published>
    <updated>2023-05-05T08:56:52.857Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-xmlæ–¹å¼AOPå¿«é€Ÿå…¥é—¨">1. xmlæ–¹å¼AOPå¿«é€Ÿå…¥é—¨</h2><p>å‰é¢æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„AOPåŸºç¡€ä»£ç è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜çš„ï¼Œä¸»è¦å¦‚ä¸‹ï¼š</p><ul><li><p>è¢«å¢å¼ºçš„åŒ…ååœ¨ä»£ç å†™æ­»äº†</p></li><li><p>é€šçŸ¥å¯¹è±¡çš„æ–¹æ³•åœ¨ä»£ç ä¸­å†™æ­»äº†</p></li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425231850726.png" alt="image-20230425231850726"></p><p>é€šè¿‡é…ç½®æ–‡ä»¶çš„æ–¹å¼å»è§£å†³ä¸Šè¿°é—®é¢˜</p><ul><li><p>é…ç½®å“ªäº›åŒ…ã€å“ªäº›ç±»ã€å“ªäº›æ–¹æ³•éœ€è¦è¢«å¢å¼º</p></li><li><p>é…ç½®ç›®æ ‡æ–¹æ³•è¦è¢«å“ªäº›é€šçŸ¥æ–¹æ³•æ‰€å¢å¼ºï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿˜æ˜¯ä¹‹åæ‰§è¡Œå¢å¼º</p></li></ul><p>é…ç½®æ–¹å¼çš„è®¾è®¡ã€é…ç½®æ–‡ä»¶ï¼ˆæ³¨è§£ï¼‰çš„è§£æå·¥ä½œï¼ŒSpringå·²ç»å¸®æˆ‘ä»¬å°è£…å¥½äº†</p><mark class="hl-label blue">xmlæ–¹å¼é…ç½®AOPçš„æ­¥éª¤</mark> <p>1ã€å¯¼å…¥AOPç›¸å…³åæ ‡ï¼›</p><p>2ã€å‡†å¤‡ç›®æ ‡ç±»ã€å‡†å¤‡å¢å¼ºç±»ï¼Œå¹¶é…ç½®ç»™Springç®¡ç†ï¼›</p><p>3ã€é…ç½®åˆ‡ç‚¹è¡¨è¾¾å¼ï¼ˆå“ªäº›æ–¹æ³•è¢«å¢å¼ºï¼‰ï¼›</p><p>4ã€é…ç½®ç»‡å…¥ï¼ˆåˆ‡ç‚¹è¢«å“ªäº›é€šçŸ¥æ–¹æ³•å¢å¼ºï¼Œæ˜¯å‰ç½®å¢å¼ºè¿˜æ˜¯åç½®å¢å¼ºï¼‰ã€‚</p><div class="tabs" id="18de34b1-8a24-42ce-9eda-2e237858faad"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#18de34b1-8a24-42ce-9eda-2e237858faad-1"><i class="fas fa-seedling"></i>1</button></li><li class="tab"><button type="button" data-href="#18de34b1-8a24-42ce-9eda-2e237858faad-2"><i class="fas fa-leaf"></i>2</button></li><li class="tab"><button type="button" data-href="#18de34b1-8a24-42ce-9eda-2e237858faad-3"><i class="fab fa-apple"></i>3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="18de34b1-8a24-42ce-9eda-2e237858faad-1"><p>1ã€å¯¼å…¥AOPç›¸å…³åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Spring-contextåæ ‡ä¸‹å·²ç»åŒ…å«spring-aopçš„åŒ…äº†ï¼Œæ‰€ä»¥å°±ä¸ç”¨é¢å¤–å¯¼å…¥äº†</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425232107831.png" alt="image-20230425232107831"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="18de34b1-8a24-42ce-9eda-2e237858faad-2"><p>2ã€å‡†å¤‡ç›®æ ‡ç±»ã€å‡†å¤‡å¢å¼ºç±»ï¼Œå¹¶é…ç½®ç»™Springç®¡ç†</p><div class="tabs" id="d7ca60e6-5710-474b-bdcd-465e32637d66"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#d7ca60e6-5710-474b-bdcd-465e32637d66-1"><i class="fas fa-cat"></i>userService</button></li><li class="tab"><button type="button" data-href="#d7ca60e6-5710-474b-bdcd-465e32637d66-2"><i class="fas fa-horse"></i>UserServiceImpl</button></li><li class="tab"><button type="button" data-href="#d7ca60e6-5710-474b-bdcd-465e32637d66-3"><i class="fas fa-dove"></i>å¢å¼ºç±»</button></li><li class="tab"><button type="button" data-href="#d7ca60e6-5710-474b-bdcd-465e32637d66-4"><i class="fas fa-dragon"></i>é…ç½®ç»™Springç®¡ç†</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="d7ca60e6-5710-474b-bdcd-465e32637d66-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show1</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show2</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d7ca60e6-5710-474b-bdcd-465e32637d66-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show1....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show2....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d7ca60e6-5710-474b-bdcd-465e32637d66-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;beforeAdvice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterAdvice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d7ca60e6-5710-474b-bdcd-465e32637d66-4"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®ç›®æ ‡ç±»,å†…éƒ¨çš„æ–¹æ³•æ˜¯è¿æ¥ç‚¹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®é€šçŸ¥ç±»,å†…éƒ¨çš„æ–¹æ³•æ˜¯å¢å¼ºæ–¹æ³•--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">â€œmyAdvice</span>&quot; <span class="attr">class</span>=<span class="string">&quot;com.itheima.advice.MyAdvice&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="18de34b1-8a24-42ce-9eda-2e237858faad-3"><p>3ã€é…ç½®åˆ‡ç‚¹è¡¨è¾¾å¼ï¼ˆå“ªäº›æ–¹æ³•è¢«å¢å¼ºï¼‰</p><p>4ã€é…ç½®ç»‡å…¥ï¼ˆåˆ‡ç‚¹è¢«å“ªäº›é€šçŸ¥æ–¹æ³•å¢å¼ºï¼Œæ˜¯å‰ç½®å¢å¼ºè¿˜æ˜¯åç½®å¢å¼ºï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®åˆ‡ç‚¹è¡¨è¾¾å¼,å¯¹å“ªäº›æ–¹æ³•è¿›è¡Œå¢å¼º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(void com.itheima.service.impl.UserServiceImpl.show1())&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åˆ‡é¢=åˆ‡ç‚¹+é€šçŸ¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æŒ‡å®šå‰ç½®é€šçŸ¥æ–¹æ³•æ˜¯beforeAdvice--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforeAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æŒ‡å®šåç½®é€šçŸ¥æ–¹æ³•æ˜¯afterAdvice--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="2-xmlæ–¹å¼AOPé…ç½®è¯¦è§£">2. xmlæ–¹å¼AOPé…ç½®è¯¦è§£</h2><p>xmlé…ç½®AOPçš„æ–¹å¼è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹AOPè¯¦ç»†é…ç½®çš„ç»†èŠ‚ï¼š</p><ul><li>åˆ‡ç‚¹è¡¨è¾¾å¼çš„é…ç½®æ–¹å¼</li><li>åˆ‡ç‚¹è¡¨è¾¾å¼çš„é…ç½®è¯­æ³•</li><li>é€šçŸ¥çš„ç±»å‹</li><li>AOPçš„é…ç½®çš„ä¸¤ç§æ–¹å¼</li></ul><mark class="hl-label blue">åˆ‡ç‚¹è¡¨è¾¾å¼çš„é…ç½®æ–¹å¼</mark> <p>åˆ‡ç‚¹è¡¨è¾¾å¼çš„é…ç½®æ–¹å¼æœ‰ä¸¤ç§ï¼Œç›´æ¥å°†åˆ‡ç‚¹è¡¨è¾¾å¼é…ç½®åœ¨é€šçŸ¥ä¸Šï¼Œä¹Ÿå¯ä»¥å°†åˆ‡ç‚¹è¡¨è¾¾å¼æŠ½å–åˆ°å¤–é¢ï¼Œåœ¨é€šçŸ¥ä¸Šè¿›è¡Œå¼•ç”¨</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426082456137.png" alt="image-20230426082456137" style="zoom:67%;" /><mark class="hl-label green">åˆ‡ç‚¹è¡¨è¾¾å¼çš„é…ç½®è¯­æ³•</mark> <p>åˆ‡ç‚¹è¡¨è¾¾å¼æ˜¯é…ç½®è¦å¯¹å“ªäº›è¿æ¥ç‚¹ï¼ˆå“ªäº›ç±»çš„å“ªäº›æ–¹æ³•ï¼‰è¿›è¡Œé€šçŸ¥çš„å¢å¼ºï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><p><code>execution([è®¿é—®ä¿®é¥°ç¬¦]è¿”å›å€¼ç±»å‹ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°))</code></p><p>å…¶ä¸­ï¼Œ</p><ul><li><p>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥çœç•¥ä¸å†™ï¼›</p></li><li><p>è¿”å›å€¼ç±»å‹ã€æŸä¸€çº§åŒ…åã€ç±»åã€æ–¹æ³•åå¯ä»¥ä½¿ç”¨<code>*</code>è¡¨ç¤ºä»»æ„ï¼›</p></li><li><p>åŒ…åä¸ç±»åä¹‹é—´ä½¿ç”¨å•ç‚¹<code>.</code>è¡¨ç¤ºè¯¥åŒ…ä¸‹çš„ç±»ï¼Œä½¿ç”¨åŒç‚¹<code>..</code>è¡¨ç¤ºè¯¥åŒ…åŠå…¶å­åŒ…ä¸‹çš„ç±»ï¼›</p></li><li><p>å‚æ•°åˆ—è¡¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç‚¹<code>..</code>è¡¨ç¤ºä»»æ„å‚æ•°ã€‚</p></li></ul><p>åˆ‡ç‚¹è¡¨è¾¾å¼ä¸¾å‡ ä¸ªä¾‹å­æ–¹ä¾¿ç†è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¡¨ç¤ºè®¿é—®ä¿®é¥°ç¬¦ä¸ºpublicã€æ— è¿”å›å€¼ã€åœ¨com.itheima.aopåŒ…ä¸‹çš„TargetImplç±»çš„æ— å‚æ–¹æ³•show</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.itheima.aop.TargetImpl.show())</span><br><span class="line"><span class="comment">//è¡¨è¿°com.itheima.aopåŒ…ä¸‹çš„TargetImplç±»çš„ä»»æ„æ–¹æ³•</span></span><br><span class="line">execution(* com.itheima.aop.TargetImpl.*(..))</span><br><span class="line"><span class="comment">//è¡¨ç¤ºcom.itheima.aopåŒ…ä¸‹çš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•</span></span><br><span class="line">execution(* com.itheima.aop.*.*(..))</span><br><span class="line"><span class="comment">//è¡¨ç¤ºcom.itheima.aopåŒ…åŠå…¶å­åŒ…ä¸‹çš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•</span></span><br><span class="line">execution(* com.itheima.aop..*.*(..))</span><br><span class="line"><span class="comment">//è¡¨ç¤ºä»»æ„åŒ…ä¸­çš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•</span></span><br><span class="line">execution(* *..*.*(..))</span><br></pre></td></tr></table></figure><mark class="hl-label blue">é€šçŸ¥çš„ç±»å‹</mark> <p>AspectJçš„é€šçŸ¥ç”±ä»¥ä¸‹äº”ç§ç±»å‹</p><table><thead><tr><th>é€šçŸ¥åç§°</th><th>é…ç½®æ–¹å¼</th><th>æ‰§è¡Œæ—¶æœº</th></tr></thead><tbody><tr><td>å‰ç½®é€šçŸ¥</td><td>&lt; aop:before &gt;</td><td>ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ</td></tr><tr><td>åç½®é€šçŸ¥</td><td>&lt; aop:after-returning&gt;</td><td>ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œï¼Œç›®æ ‡æ–¹æ³•å¼‚å¸¸æ—¶ï¼Œä¸åœ¨æ‰§è¡Œ</td></tr><tr><td>ç¯ç»•é€šçŸ¥</td><td>&lt; aop:around &gt;</td><td>ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œï¼Œç›®æ ‡æ–¹æ³•å¼‚å¸¸æ—¶ï¼Œç¯ç»•åæ–¹æ³•ä¸åœ¨æ‰§è¡Œ</td></tr><tr><td>å¼‚å¸¸é€šçŸ¥</td><td>&lt; aop:after-throwing &gt;</td><td>ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶æ‰§è¡Œï¼Œå¼‚å¸¸é€šçŸ¥æ–¹æ³•æ‰§è¡Œï¼Œä¸”åç½®é€šçŸ¥å’Œç¯ç»•åé€šçŸ¥ä¸åœ¨æ‰§è¡Œ</td></tr><tr><td>æœ€ç»ˆé€šçŸ¥</td><td>&lt; aop:after &gt;</td><td>ä¸ç®¡ç›®æ ‡æ–¹æ³•æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œ</td></tr></tbody></table><div class="tabs" id="c73ab74c-7728-4125-864d-68ba4ba92ce2"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#c73ab74c-7728-4125-864d-68ba4ba92ce2-1"><i class="fas fa-bug"></i>ç¯ç»•é€šçŸ¥</button></li><li class="tab"><button type="button" data-href="#c73ab74c-7728-4125-864d-68ba4ba92ce2-2"><i class="fas fa-cannabis"></i>å¼‚å¸¸é€šçŸ¥</button></li><li class="tab"><button type="button" data-href="#c73ab74c-7728-4125-864d-68ba4ba92ce2-3"><i class="fas fa-candy-cane"></i>æœ€ç»ˆé€šçŸ¥</button></li><li class="tab"><button type="button" data-href="#c73ab74c-7728-4125-864d-68ba4ba92ce2-4"><i class="fas fa-child"></i>å‚æ•°</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="c73ab74c-7728-4125-864d-68ba4ba92ce2-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">//ç¯ç»•å‰</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç¯ç»•å‰é€šçŸ¥&quot;</span>); </span><br><span class="line">    <span class="comment">//ç›®æ ‡æ–¹æ³•</span></span><br><span class="line">    joinPoint.proceed();</span><br><span class="line">    <span class="comment">//ç¯ç»•å</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç¯ç»•åé€šçŸ¥&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;aop:around method=&quot;around&quot; pointcut-ref=&quot;myPointcut&quot;/&gt;</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="c73ab74c-7728-4125-864d-68ba4ba92ce2-2"><p>å½“ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸é€šçŸ¥æ–¹æ³•æ‰§è¡Œï¼Œä¸”åç½®é€šçŸ¥å’Œç¯ç»•åé€šçŸ¥ä¸åœ¨æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸äº†ï¼Œåç½®é€šçŸ¥å’Œç¯ç»•åé€šçŸ¥ä¸åœ¨æ‰§è¡Œ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;aop:after-throwing method=&quot;afterThrowing&quot; pointcut-ref=&quot;myPointcut&quot;/&gt;</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="c73ab74c-7728-4125-864d-68ba4ba92ce2-3"><p>ç±»ä¼¼å¼‚å¸¸æ•è·ä¸­çš„finallyï¼Œä¸ç®¡ç›®æ ‡æ–¹æ³•æœ‰æ²¡æœ‰å¼‚å¸¸ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œçš„é€šçŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸ç®¡ç›®æ ‡æ–¹æ³•æœ‰æ— å¼‚å¸¸ï¼Œæˆ‘éƒ½ä¼šæ‰§è¡Œ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;aop:after method=&quot;after&quot; pointcut-ref=&quot;myPointcut&quot;/&gt;</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="c73ab74c-7728-4125-864d-68ba4ba92ce2-4"><p>é€šçŸ¥æ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶ï¼ŒSpringå¯ä»¥ä¸ºå…¶ä¼ é€’ä¸€äº›å¿…è¦çš„å‚æ•°</p><table><thead><tr><th>å‚æ•°ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>JoinPoint</td><td>è¿æ¥ç‚¹å¯¹è±¡ï¼Œä»»ä½•é€šçŸ¥éƒ½å¯ä½¿ç”¨ï¼Œå¯ä»¥è·å¾—å½“å‰ç›®æ ‡å¯¹è±¡ã€ç›®æ ‡æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯</td></tr><tr><td>ProceedingJoinPoint</td><td>JoinPointå­ç±»å¯¹è±¡ï¼Œä¸»è¦æ˜¯åœ¨ç¯ç»•é€šçŸ¥ä¸­æ‰§è¡Œproceed()ï¼Œè¿›è€Œæ‰§è¡Œç›®æ ‡æ–¹æ³•</td></tr><tr><td>Throwable</td><td>å¼‚å¸¸å¯¹è±¡ï¼Œä½¿ç”¨åœ¨å¼‚å¸¸é€šçŸ¥ä¸­ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å‡ºå¼‚å¸¸å¯¹è±¡åç§°</td></tr></tbody></table><div class="tabs" id="1b1e2623-a6b7-47c1-838e-59af11c2de32"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1b1e2623-a6b7-47c1-838e-59af11c2de32-1"><i class="fas fa-atom"></i>JoinPoint</button></li><li class="tab"><button type="button" data-href="#1b1e2623-a6b7-47c1-838e-59af11c2de32-2"><i class="far fa-sun"></i>ProceedingJoinPoint</button></li><li class="tab"><button type="button" data-href="#1b1e2623-a6b7-47c1-838e-59af11c2de32-3"><i class="fas fa-wind"></i>Throwable</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1b1e2623-a6b7-47c1-838e-59af11c2de32-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> é€šçŸ¥æ–¹æ³•åç§°(JoinPoint joinPoint)&#123;</span><br><span class="line">    <span class="comment">//è·å¾—ç›®æ ‡æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line">    System.out.println(joinPoint.getArgs());</span><br><span class="line">    <span class="comment">//è·å¾—ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    System.out.println(joinPoint.getTarget());</span><br><span class="line">    <span class="comment">//è·å¾—ç²¾ç¡®çš„åˆ‡ç‚¹è¡¨è¾¾å¼ä¿¡æ¯</span></span><br><span class="line">    System.out.println(joinPoint.getStaticPart());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1b1e2623-a6b7-47c1-838e-59af11c2de32-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    System.out.println(joinPoint.getArgs());<span class="comment">//è·å¾—ç›®æ ‡æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line">    System.out.println(joinPoint.getTarget());<span class="comment">//è·å¾—ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    System.out.println(joinPoint.getStaticPart());<span class="comment">//è·å¾—ç²¾ç¡®çš„åˆ‡ç‚¹è¡¨è¾¾å¼ä¿¡æ¯Object result = joinPoint.proceed();//æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> result;<span class="comment">//è¿”å›ç›®æ ‡æ–¹æ³•è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1b1e2623-a6b7-47c1-838e-59af11c2de32-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable th)</span>&#123;</span><br><span class="line">    <span class="comment">//è·å¾—å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">    System.out.println(<span class="string">&quot;å¼‚å¸¸å¯¹è±¡æ˜¯ï¼š&quot;</span>+th+<span class="string">&quot;å¼‚å¸¸ä¿¡æ¯æ˜¯ï¼š&quot;</span>+th.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;aop:after-throwing method=&quot;afterThrowing&quot; pointcut-ref=&quot;myPointcut&quot; throwing=&quot;th&quot;/&gt;</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><mark class="hl-label green">æ³¨è§£æ–¹å¼AOPé…ç½®</mark> <p>AOPçš„å¦ä¸€ç§é…ç½®æ–¹å¼ï¼Œè¯¥æ–¹å¼éœ€è¦é€šçŸ¥ç±»å®ç°Adviceçš„å­åŠŸèƒ½æ¥å£</p><p><code>public interface Advice &#123; &#125;</code></p><p>Adviceçš„å­åŠŸèƒ½æ¥å£</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426083824964.png" alt="image-20230426083824964" style="zoom:67%;" /><p>ä¾‹å¦‚ï¼šé€šçŸ¥ç±»å®ç°äº†å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Advices</span> <span class="keyword">implements</span> <span class="title class_">MethodBeforeAdvice</span>, AfterReturningAdvice &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method method, Object[] objects, Object o)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is before Advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object o, Method method, Object[] objects, Object o1)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is afterReturn Advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡é¢ä½¿ç”¨advisoræ ‡ç­¾é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å°†é€šçŸ¥å’Œåˆ‡ç‚¹è¿›è¡Œç»“åˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;advices&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(void com.itheima.aop.TargetImpl.show())&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆä¾‹å¦‚ï¼šé€šçŸ¥ç±»å®ç°äº†æ–¹æ³•æ‹¦æˆªå™¨æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMethodInterceptor</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation methodInvocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®é€»è¾‘åŠŸèƒ½...&quot;</span>);</span><br><span class="line">        <span class="comment">//æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span></span><br><span class="line">                methodInvocation.getMethod().invoke(methodInvocation.getThis(),methodInvocation.getArguments());</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®é€»è¾‘åŠŸèƒ½...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> invoke;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡é¢ä½¿ç”¨advisoræ ‡ç­¾é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å°†é€šçŸ¥å’Œåˆ‡ç‚¹è¿›è¡Œç»“åˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">â€œmyMethodInterceptor</span>&quot; <span class="attr">pointcut</span>=<span class="string">&quot;execution(void com.itheima.aop.TargetImpl.show())&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨aspectå’Œadvisoré…ç½®åŒºåˆ«å¦‚ä¸‹ï¼š</p></blockquote><div class="tabs" id="9ba70f6a-2861-4c17-8034-c845a9333ab3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#9ba70f6a-2861-4c17-8034-c845a9333ab3-1"><i class="fas fa-award"></i>1é…ç½®è¯­æ³•ä¸åŒ</button></li><li class="tab"><button type="button" data-href="#9ba70f6a-2861-4c17-8034-c845a9333ab3-2"><i class="fas fa-baseball-ball"></i>2é€šçŸ¥ç±»çš„å®šä¹‰è¦æ±‚ä¸åŒ</button></li><li class="tab"><button type="button" data-href="#9ba70f6a-2861-4c17-8034-c845a9333ab3-3"><i class="fas fa-bone"></i>3å¯é…ç½®çš„åˆ‡é¢æ•°é‡ä¸åŒ</button></li><li class="tab"><button type="button" data-href="#9ba70f6a-2861-4c17-8034-c845a9333ab3-4"><i class="fas fa-anchor"></i>4ä½¿ç”¨åœºæ™¯ä¸åŒ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="9ba70f6a-2861-4c17-8034-c845a9333ab3-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨advisoré…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- advice-ref:é€šçŸ¥Beançš„id --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;advices&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(void com.itheima.aop.TargetImpl.show())&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨aspecté…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ref:é€šçŸ¥Beançš„id --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;advices&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(void com.itheima.aop.TargetImpl.show())&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9ba70f6a-2861-4c17-8034-c845a9333ab3-2"><p>advisor éœ€è¦çš„é€šçŸ¥ç±»éœ€è¦å®ç°Adviceçš„å­åŠŸèƒ½æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Advices</span> <span class="keyword">implements</span> <span class="title class_">MethodBeforeAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method method, Object[] objects, Object o)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is before Advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object o, Method method, Object[] objects, Object o1)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is afterReturn Advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aspect ä¸éœ€è¦é€šçŸ¥ç±»å®ç°ä»»ä½•æ¥å£ï¼Œåœ¨é…ç½®çš„æ—¶å€™æŒ‡å®šå“ªäº›æ–¹æ³•å±äºå“ªç§é€šçŸ¥ç±»å‹å³å¯ï¼Œæ›´åŠ çµæ´»æ–¹ä¾¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Advices</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is before Advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is afterReturn Advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9ba70f6a-2861-4c17-8034-c845a9333ab3-3"><ul><li>ä¸€ä¸ª<code>advisor</code>åªèƒ½é…ç½®ä¸€ä¸ªå›ºå®šé€šçŸ¥å’Œä¸€ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ï¼›</li><li>ä¸€ä¸ª<code>aspect</code>å¯ä»¥é…ç½®å¤šä¸ªé€šçŸ¥å’Œå¤šä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ä»»æ„ç»„åˆï¼Œç²’åº¦æ›´ç»†ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9ba70f6a-2861-4c17-8034-c845a9333ab3-4"><ul><li>å¦‚æœé€šçŸ¥ç±»å‹å¤šã€å…è®¸éšæ„æ­é…æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨aspectè¿›è¡Œé…ç½®ï¼›</li><li>å¦‚æœé€šçŸ¥ç±»å‹å•ä¸€ã€ä¸”é€šçŸ¥ç±»ä¸­é€šçŸ¥æ–¹æ³•ä¸€æ¬¡æ€§éƒ½ä¼šä½¿ç”¨åˆ°çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨advisorè¿›è¡Œé…ç½®ï¼›</li><li>åœ¨é€šçŸ¥ç±»å‹å·²ç»å›ºå®šï¼Œä¸ç”¨äººä¸ºæŒ‡å®šé€šçŸ¥ç±»å‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨advisorè¿›è¡Œé…ç½®ï¼Œä¾‹å¦‚åé¢è¦å­¦ä¹ çš„Springäº‹åŠ¡æ§åˆ¶çš„é…ç½®ï¼›</li></ul><p>ç”±äºå®é™…å¼€å‘ä¸­ï¼Œè‡ªå®šä¹‰aopåŠŸèƒ½çš„é…ç½®å¤§å¤šä½¿ç”¨aspectçš„é…ç½®æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åé¢ä¸»è¦è®²è§£aspectçš„é…ç½®ï¼Œ advisoræ˜¯ä¸ºäº†åé¢Springå£°æ˜å¼äº‹åŠ¡æ§åˆ¶åšé“ºå«ï¼Œæ­¤å¤„å¤§å®¶äº†è§£å³å¯ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h2 id="3-xmlæ–¹å¼AOPåŸç†å‰–æ">3. xmlæ–¹å¼AOPåŸç†å‰–æ</h2><p>é€šè¿‡xmlæ–¹å¼é…ç½®AOPæ—¶ï¼Œæˆ‘ä»¬å¼•å…¥äº†AOPçš„å‘½åç©ºé—´ï¼Œæ ¹æ®è®²è§£çš„ï¼Œè¦å»æ‰¾spring-aopåŒ…ä¸‹çš„META-INFï¼Œåœ¨å»æ‰¾spring.handlersæ–‡ä»¶</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426085403463.png" alt="image-20230426085403463"></p><p><code>http\://www.springframework.org/schema/aop=org.springframework.aop.config.AopNamespaceHandler</code></p><p>æœ€ç»ˆåŠ è½½çš„æ˜¯ AopNamespaceHandlerï¼Œè¯¥Handlerçš„initæ–¹æ³•ä¸­æ³¨å†Œäº†configæ ‡ç­¾å¯¹åº”çš„è§£æå™¨</p><p><code>this.registerBeanDefinitionParser(&quot;config&quot;, new ConfigBeanDefinitionParser());</code></p><p>ä»¥<code>ConfigBeanDefinitionParser</code>ä½œä¸ºå…¥å£è¿›è¡Œæºç å‰–æï¼Œæœ€ç»ˆä¼šæ³¨å†Œä¸€ä¸ª<code>AspectJAwareAdvisorAutoProxyCreator</code>è¿›å…¥åˆ°Springå®¹å™¨ä¸­ï¼Œé‚£è¯¥ç±»ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿçœ‹ä¸€ä¸‹é›†æˆä½“ç³»å›¾</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426193205755.png" alt="image-20230426193205755"></p><p><code>AspectJAwareAdvisorAutoProxyCreator</code>çš„ä¸Šä¸Šçº§çˆ¶ç±»<code>AbstractAutoProxyCreator</code>ä¸­çš„<code>postProcessAfterInitialization</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°beanï¼šä¸ºç›®æ ‡å¯¹è±¡</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(<span class="meta">@Nullable</span> Object bean, String beanName)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (bean != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">cacheKey</span> <span class="operator">=</span> <span class="built_in">this</span>.getCacheKey(bean.getClass(), beanName);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.earlyProxyReferences.remove(cacheKey) != bean) &#123;</span><br><span class="line">            /å¦‚æœéœ€è¦è¢«å¢å¼ºï¼Œåˆ™wrapIfNecessaryæ–¹æ³•æœ€ç»ˆè¿”å›çš„å°±æ˜¯ä¸€ä¸ªProxyå¯¹è±¡</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.wrapIfNecessary(bean, beanName, cacheKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ–­ç‚¹æ–¹å¼è§‚å¯Ÿï¼Œå½“beanæ˜¯åŒ¹é…åˆ‡ç‚¹è¡¨è¾¾å¼æ—¶ï¼Œ<code>this.wrapIfNecessary(bean, beanName, cacheKey)</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>JDKDynamicAopProxy</code></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426094655874.png" alt="image-20230426094655874"></p><p>å¯ä»¥åœ¨æ·±å…¥ä¸€ç‚¹ï¼Œå¯¹wrapIfNecessaryåœ¨å‰–æä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„é€šè¿‡JDKçš„<code>Proxy.newProxyInstance(ClassLoaderloader, Class&lt;?&gt;[] interfaces,InvocationHandlerh) </code>çš„æ–¹å¼åˆ›å»ºçš„ä»£ç†å¯¹è±¡å‘¢ï¼Ÿç»è¿‡å¦‚ä¸‹ä¸€ç³»åˆ—æºç è·Ÿè¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">==&gt; <span class="built_in">this</span>.wrapIfNecessary(bean, beanName, cacheKey)</span><br><span class="line">==&gt; <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="built_in">this</span>.createProxy(å‚æ•°çœç•¥)</span><br><span class="line">==&gt; proxyFactory.getProxy(classLoader)</span><br><span class="line">==&gt; <span class="built_in">this</span>.createAopProxy().getProxy(classLoader)</span><br><span class="line">==&gt; getProxy()æ˜¯ä¸€ä¸ªæ¥å£æ–¹æ³•ï¼Œå®ç°ç±»æœ‰ä¸¤ä¸ªï¼Œå¦‚ä¸‹æˆªå›¾</span><br><span class="line">==&gt; Proxy.newProxyInstance(classLoader, <span class="built_in">this</span>.proxiedInterfaces, <span class="built_in">this</span>)</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426094759365.png" alt="image-20230426094759365"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426094809490.png" alt="image-20230426094809490"   /><p>åŠ¨æ€ä»£ç†çš„å®ç°çš„é€‰æ‹©ï¼Œåœ¨è°ƒç”¨getProxy() æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¯é€‰ç”¨çš„ AopProxyæ¥å£æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼Œå¦‚ä¸Šå›¾ï¼Œè¿™ä¸¤ç§éƒ½æ˜¯åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡çš„æ–¹å¼ï¼Œä¸€ç§å°±æ˜¯åŸºäºJDKçš„ï¼Œä¸€ç§æ˜¯åŸºäºCglibçš„</p><table><thead><tr><th>ä»£ç†æŠ€æœ¯</th><th>ä½¿ç”¨æ¡ä»¶</th><th>é…ç½®æ–¹å¼</th></tr></thead><tbody><tr><td>JDK åŠ¨æ€ä»£ç†æŠ€æœ¯</td><td>ç›®æ ‡ç±»æœ‰æ¥å£ï¼Œæ˜¯åŸºäºæ¥å£åŠ¨æ€ç”Ÿæˆå®ç°ç±»çš„ä»£ç†å¯¹è±¡</td><td>ç›®æ ‡ç±»æœ‰æ¥å£çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æ–¹å¼</td></tr><tr><td>CglibåŠ¨æ€ä»£ç†æŠ€æœ¯</td><td>ç›®æ ‡ç±»æ— æ¥å£ä¸”ä¸èƒ½ä½¿ç”¨finalä¿®é¥°ï¼Œæ˜¯åŸºäºè¢«ä»£ç†å¯¹è±¡åŠ¨æ€ç”Ÿæˆå­å¯¹è±¡ä¸ºä»£ç†å¯¹è±¡</td><td>ç›®æ ‡ç±»æ— æ¥å£æ—¶ï¼Œé»˜è®¤ä½¿ç”¨è¯¥æ–¹å¼ï¼›ç›®æ ‡ç±»æœ‰æ¥å£æ—¶ï¼Œæ‰‹åŠ¨é…ç½®<code>&lt;aop:configproxy-target-class=â€œtrueâ€&gt;</code>å¼ºåˆ¶ä½¿ç”¨Cglibæ–¹å¼</td></tr></tbody></table><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426094935078.png" alt="image-20230426094935078" style="zoom:67%;" /><p>JDKçš„åŠ¨æ€ä»£ç†ä»£ç ï¼Œä¹‹å‰å·²ç»å†™è¿‡äº†ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹CglibåŸºäºè¶…ç±»çš„åŠ¨æ€ä»£ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Target</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Target</span>();<span class="comment">//ç›®æ ‡å¯¹è±¡</span></span><br><span class="line"><span class="type">Advices</span> <span class="variable">advices</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Advices</span>();<span class="comment">//é€šçŸ¥å¯¹è±¡</span></span><br><span class="line"><span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();<span class="comment">//å¢å¼ºå™¨å¯¹è±¡</span></span><br><span class="line">enhancer.setSuperclass(Target.class);<span class="comment">//å¢å¼ºå™¨è®¾ç½®çˆ¶ç±»</span></span><br><span class="line"><span class="comment">//å¢å¼ºå™¨è®¾ç½®å›è°ƒ</span></span><br><span class="line">enhancer.setCallback((MethodInterceptor )(o, method, objects, methodProxy) -&gt; &#123;</span><br><span class="line">    advices.before();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, objects); advices.afterReturning();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="type">Target</span> <span class="variable">targetProxy</span> <span class="operator">=</span> (Target) enhancer.create();</span><br><span class="line"><span class="comment">//æµ‹è¯•</span></span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> targetProxy.show(<span class="string">&quot;haohao&quot;</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">xmlæ–¹å¼AOPé…ç½®</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Spring" scheme="https://wuwawawa.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>AOPç®€ä»‹</title>
    <link href="https://wuwawawa.github.io/posts/637d34d.html"/>
    <id>https://wuwawawa.github.io/posts/637d34d.html</id>
    <published>2023-04-26T13:32:28.000Z</published>
    <updated>2023-04-25T15:08:46.182Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-AOPçš„æ¦‚å¿µ">1. AOPçš„æ¦‚å¿µ</h2><p>AOPï¼ŒAspect Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯å¯¹é¢å‘å¯¹è±¡ç¼–ç¨‹OOPçš„å‡åã€‚OOPæ˜¯çºµå‘å¯¹ä¸€ä¸ªäº‹ç‰©çš„æŠ½è±¡ï¼Œä¸€ä¸ªå¯¹è±¡åŒ…æ‹¬é™æ€çš„å±æ€§ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŠ¨æ€çš„æ–¹æ³•ä¿¡æ¯ç­‰ã€‚è€ŒAOPæ˜¯æ¨ªå‘çš„å¯¹ä¸åŒäº‹ç‰©çš„æŠ½è±¡ï¼Œå±æ€§ä¸å±æ€§ã€æ–¹æ³•ä¸æ–¹æ³•ã€å¯¹è±¡ä¸å¯¹è±¡éƒ½å¯ä»¥ç»„æˆä¸€ä¸ªåˆ‡é¢ï¼Œè€Œç”¨è¿™ç§æ€ç»´å»è®¾è®¡ç¼–ç¨‹çš„æ–¹å¼å«åšé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425225226776.png" alt="image-20230425225226776" style="zoom:67%;" /><hr><h2 id="2-AOPæ€æƒ³çš„å®ç°æ–¹æ¡ˆ">2. AOPæ€æƒ³çš„å®ç°æ–¹æ¡ˆ</h2><p><code>åŠ¨æ€ä»£ç†æŠ€æœ¯</code>ï¼Œåœ¨è¿è¡ŒæœŸé—´ï¼Œå¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œä»£ç†å¯¹è±¡åŒåæ–¹æ³•å†…å¯ä»¥æ‰§è¡ŒåŸæœ‰é€»è¾‘çš„åŒæ—¶åµŒå…¥æ‰§è¡Œå…¶ä»–å¢å¼ºé€»è¾‘æˆ–å…¶ä»–å¯¹è±¡çš„æ–¹æ³•ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425225336104.png" alt="image-20230425225336104"  /><hr><h2 id="3-æ¨¡æ‹ŸAOPçš„åŸºç¡€ä»£ç ">3. æ¨¡æ‹ŸAOPçš„åŸºç¡€ä»£ç </h2><p>åœ¨ä¹‹å‰å­¦ä¹ <code>BeanPostProcessor</code>æ—¶ï¼Œåœ¨<code>BeanPostProcessor</code>çš„<code>after</code>æ–¹æ³•ä¸­ä½¿ç”¨åŠ¨æ€ä»£ç†å¯¹Beanè¿›è¡Œäº†å¢å¼ºï¼Œå®é™…å­˜å‚¨åˆ°å•ä¾‹æ± <code>singleObjects</code>ä¸­çš„ä¸æ˜¯å½“å‰ç›®æ ‡å¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯å½“å‰ç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡Proxyï¼Œè¿™æ ·åœ¨è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•æ—¶ï¼Œ<span class='p red'>å®é™…è°ƒç”¨çš„æ˜¯ä»£ç†å¯¹è±¡Proxyçš„åŒåæ–¹æ³•</span>ï¼Œèµ·åˆ°äº†ç›®æ ‡æ–¹æ³•å‰åéƒ½è¿›è¡Œå¢å¼ºçš„åŠŸèƒ½ï¼Œå¯¹è¯¥æ–¹å¼è¿›è¡Œä¸€ä¸‹ä¼˜åŒ–ï¼Œå°†å¢å¼ºçš„æ–¹æ³•æå–å‡ºå»åˆ°ä¸€ä¸ªå¢å¼ºç±»ä¸­ï¼Œä¸”åªå¯¹<code>com.itheima.service.impl</code>åŒ…ä¸‹çš„ä»»ä½•ç±»çš„ä»»ä½•æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰å¢å¼ºç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;beforeAdvice ...&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterAdvice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MockAopBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, ApplicationContextAware &#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;<span class="comment">//æ³¨å…¥Springå®¹å™¨å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="type">MyAdvice</span> <span class="variable">myAdvice</span> <span class="operator">=</span> applicationContext.getBean(MyAdvice.class);<span class="comment">//è·å¾—Adviceå¯¹è±¡String packageName = bean.getClass().getPackage().getName();</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com.itheima.service.impl&quot;</span>.equals(packageName))&#123;</span><br><span class="line">            <span class="comment">//å¯¹Beanè¿›è¡ŒåŠ¨æ€ä»£ç†ï¼Œè¿”å›çš„æ˜¯Proxyä»£ç†å¯¹è±¡</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">proxyBean</span> <span class="operator">=</span> Proxy.newProxyInstance(</span><br><span class="line">                    bean.getClass().getClassLoader(),</span><br><span class="line">                    bean.getClass().getInterfaces(),</span><br><span class="line">                    (Object proxy, Method method, Object[] args) -&gt; &#123;</span><br><span class="line">                        myAdvice.beforeAdvice();<span class="comment">//æ‰§è¡ŒAdviceçš„beforeæ–¹æ³•</span></span><br><span class="line">                        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(bean, args);<span class="comment">//æ‰§è¡Œç›®æ ‡</span></span><br><span class="line">                        myAdvice.afterAdvice();<span class="comment">//æ‰§è¡ŒAdviceçš„afteræ–¹æ³•</span></span><br><span class="line">                        <span class="keyword">return</span> result;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="comment">//è¿”å›ä»£ç†å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">return</span> proxyBean;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="4-AOPç›¸å…³æ¦‚å¿µ">4. AOPç›¸å…³æ¦‚å¿µ</h2><table><thead><tr><th style="text-align:left">æ¦‚å¿µ</th><th style="text-align:left">å•è¯</th><th style="text-align:left">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">ç›®æ ‡å¯¹è±¡</td><td style="text-align:left">Target</td><td style="text-align:left">è¢«å¢å¼ºçš„æ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡</td></tr><tr><td style="text-align:left">ä»£ç†å¯¹è±¡</td><td style="text-align:left">Proxy</td><td style="text-align:left">å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œå¢å¼ºåçš„å¯¹è±¡ï¼Œå®¢æˆ·ç«¯å®é™…è°ƒç”¨çš„å¯¹è±¡</td></tr><tr><td style="text-align:left">è¿æ¥ç‚¹</td><td style="text-align:left">Joinpoint</td><td style="text-align:left">ç›®æ ‡å¯¹è±¡ä¸­å¯ä»¥è¢«å¢å¼ºçš„æ–¹æ³•</td></tr><tr><td style="text-align:left">åˆ‡å…¥ç‚¹</td><td style="text-align:left">Pointcut</td><td style="text-align:left">ç›®æ ‡å¯¹è±¡ä¸­å®é™…è¢«å¢å¼ºçš„æ–¹æ³•</td></tr><tr><td style="text-align:left">é€šçŸ¥\å¢å¼º</td><td style="text-align:left">Advice</td><td style="text-align:left">å¢å¼ºéƒ¨åˆ†çš„ä»£ç é€»è¾‘</td></tr><tr><td style="text-align:left">åˆ‡é¢</td><td style="text-align:left">Aspect</td><td style="text-align:left">å¢å¼ºå’Œåˆ‡å…¥ç‚¹çš„ç»„åˆ</td></tr><tr><td style="text-align:left">ç»‡å…¥</td><td style="text-align:left">Weaving</td><td style="text-align:left">å°†é€šçŸ¥å’Œåˆ‡å…¥ç‚¹ç»„åˆåŠ¨æ€ç»„åˆçš„è¿‡ç¨‹</td></tr></tbody></table><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425230804795.png" alt="image-20230425230804795"></p>]]></content>
    
    
    <summary type="html">AOPæ¦‚å¿µã€å®ç°æ–¹æ¡ˆã€åŸºç¡€ä»£ç </summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Spring" scheme="https://wuwawawa.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºæ³¨è§£çš„Springåº”ç”¨</title>
    <link href="https://wuwawawa.github.io/posts/93be85ee.html"/>
    <id>https://wuwawawa.github.io/posts/93be85ee.html</id>
    <published>2023-04-25T09:06:46.000Z</published>
    <updated>2023-04-26T08:38:30.269Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-BeanåŸºæœ¬æ³¨è§£å¼€å‘">1. BeanåŸºæœ¬æ³¨è§£å¼€å‘</h2><p>Springé™¤äº†xmlé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡Œé…ç½®ï¼Œæ³¨è§£æ–¹å¼æ…¢æ…¢æˆä¸ºxmlé…ç½®çš„æ›¿ä»£æ–¹æ¡ˆã€‚æˆ‘ä»¬æœ‰äº†xmlå¼€å‘çš„ç»éªŒï¼Œå­¦ä¹ æ³¨è§£å¼€å‘å°±æ–¹ä¾¿äº†è®¸å¤šï¼Œæ³¨è§£å¼€å‘æ›´åŠ å¿«æ·æ–¹ä¾¿ã€‚Springæä¾›çš„æ³¨è§£æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼š</p><ul><li>2.0æ—¶ä»£ï¼ŒSpringå¼€å§‹å‡ºç°æ³¨è§£</li><li>2.5æ—¶ä»£ï¼ŒSpringçš„Beané…ç½®å¯ä»¥ä½¿ç”¨æ³¨è§£å®Œæˆ</li><li>3.0æ—¶ä»£ï¼ŒSpringå…¶ä»–é…ç½®ä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£å®Œæˆï¼Œæˆ‘ä»¬è¿›å…¥å…¨æ³¨è§£æ—¶ä»£</li></ul><p>åŸºæœ¬Beanæ³¨è§£ï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ›¿ä»£åŸæœ‰xmlçš„<code>&lt;bean&gt;</code>æ ‡ç­¾åŠå…¶æ ‡ç­¾å±æ€§çš„é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">abstract</span>=<span class="string">&quot;&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>@Component</code>æ³¨è§£æ›¿ä»£<code>&lt;bean&gt;</code>æ ‡ç­¾</p><table><thead><tr><th>xmlé…ç½®</th><th>æ³¨è§£</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>&lt;bean id=&quot;&quot; class=&quot;&quot;&gt; </code></td><td>@Component</td><td>è¢«è¯¥æ³¨è§£æ ‡è¯†çš„ç±»ï¼Œä¼šåœ¨æŒ‡å®šæ‰«æèŒƒå›´å†…è¢«SpringåŠ è½½å¹¶å®ä¾‹åŒ–</td></tr></tbody></table><p>å¯ä»¥é€šè¿‡@Componentæ³¨è§£çš„valueå±æ€§æŒ‡å®šå½“å‰Beanå®ä¾‹çš„beanNameï¼Œä¹Ÿå¯ä»¥çœç•¥ä¸å†™ï¼Œä¸å†™çš„æƒ…å†µä¸‹ä¸ºå½“å‰ç±»åé¦–å­—æ¯å°å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–æ–¹å¼ï¼šapplicationContext.getBean(&quot;userDao&quot;);</span></span><br><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–æ–¹å¼ï¼šapplicationContext.getBean(&quot;userDaoImpl&quot;);</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ³¨è§£å¯¹éœ€è¦è¢«Springå®ä¾‹åŒ–çš„Beanè¿›è¡Œæ ‡æ³¨ï¼Œä½†æ˜¯éœ€è¦å‘Šè¯‰Springå»å“ªæ‰¾è¿™äº›Beanï¼Œè¦é…ç½®ç»„ä»¶æ‰«æè·¯å¾„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/xmlSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å‘ŠçŸ¥Springæ¡†æ¶å»itheimaåŒ…åŠå…¶å­åŒ…ä¸‹å»æ‰«æä½¿ç”¨äº†æ³¨è§£çš„ç±»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>@Componentå°±å•çº¯ä¸€ä¸ªvalueå±æ€§ï¼Œé‚£ä¹ˆxmlé…ç½®<code>&lt;bean&gt;</code>æ—¶é‚£äº›å±æ€§æ€ä¹ˆè¿›è¡Œé…ç½®å‘¢ï¼ŸSpring æ˜¯é€šè¿‡æ³¨è§£æ–¹å¼å»é…ç½®çš„ä¹‹å‰<code>&lt;bean&gt;</code>æ ‡ç­¾ä¸­çš„é‚£äº›å±æ€§ï¼Œä¾‹å¦‚ï¼š@Scope</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">abstract</span>=<span class="string">&quot;&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨@Component æ³¨è§£æ›¿ä»£<code>&lt;bean&gt;</code>æ ‡ç­¾</p><table><thead><tr><th>xmlé…ç½®</th><th>æ³¨è§£</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>&lt;bean scope=&quot;&quot;&gt;</code></td><td>@Scope</td><td>åœ¨ç±»ä¸Šæˆ–ä½¿ç”¨äº†@Beanæ ‡æ³¨çš„æ–¹æ³•ä¸Šï¼Œæ ‡æ³¨Beançš„ä½œç”¨èŒƒå›´ï¼Œå–å€¼ä¸ºsingletonæˆ–prototype</td></tr><tr><td><code>&lt;bean lazy-init=&quot;&quot;&gt;</code></td><td>@Lazy</td><td>åœ¨ç±»ä¸Šæˆ–ä½¿ç”¨äº†@Beanæ ‡æ³¨çš„æ–¹æ³•ä¸Šï¼Œæ ‡æ³¨Beanæ˜¯å¦å»¶è¿ŸåŠ è½½ï¼Œå–å€¼ä¸ºtrueå’Œfalse</td></tr><tr><td><code>&lt;bean init-method=&quot;&quot;&gt;</code></td><td>@PostConstruct</td><td>åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ï¼Œæ ‡æ³¨Beançš„å®ä¾‹åŒ–åæ‰§è¡Œçš„æ–¹æ³•</td></tr><tr><td><code>&lt;bean destroy-method=&quot;&quot;&gt;</code></td><td>@PreDestroy</td><td>åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ï¼Œæ ‡æ³¨Beançš„é”€æ¯å‰æ‰§è¡Œæ–¹æ³•</td></tr></tbody></table><p>ä½¿ç”¨ä¸Šè¿°æ³¨è§£å®ŒæˆUserDaoImplçš„åŸºæœ¬é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;singleton&quot;)</span></span><br><span class="line"><span class="meta">@Lazy(true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºJavaEEå¼€å‘æ˜¯åˆ†å±‚çš„ï¼Œä¸ºäº†æ¯å±‚Beanæ ‡è¯†çš„æ³¨è§£è¯­ä¹‰åŒ–æ›´åŠ æ˜ç¡®ï¼Œ@Componentåˆè¡ç”Ÿå‡ºå¦‚ä¸‹ä¸‰ä¸ªæ³¨è§£ï¼š</p><table><thead><tr><th style="text-align:left">@Componentè¡ç”Ÿæ³¨è§£</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">@Repository</td><td style="text-align:left">åœ¨Daoå±‚ç±»ä¸Šä½¿ç”¨</td></tr><tr><td style="text-align:left">@Service</td><td style="text-align:left">åœ¨Serviceå±‚ç±»ä¸Šä½¿ç”¨</td></tr><tr><td style="text-align:left">@Controller</td><td style="text-align:left">åœ¨Webå±‚ç±»ä¸Šä½¿ç”¨</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Controller(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="2-Beanä¾èµ–æ³¨å…¥æ³¨è§£å¼€å‘">2. Beanä¾èµ–æ³¨å…¥æ³¨è§£å¼€å‘</h2><p>Beanä¾èµ–æ³¨å…¥çš„æ³¨è§£ï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ›¿ä»£xmlçš„<code>&lt;property&gt;</code>æ ‡ç­¾å®Œæˆå±æ€§çš„æ³¨å…¥æ“ä½œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Springä¸»è¦æä¾›å¦‚ä¸‹æ³¨è§£ï¼Œç”¨äºåœ¨Beanå†…éƒ¨è¿›è¡Œå±æ€§æ³¨å…¥çš„ï¼š</p><table><thead><tr><th style="text-align:left">å±æ€§æ³¨å…¥æ³¨è§£</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">@Value</td><td style="text-align:left">ä½¿ç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œç”¨äºæ³¨å…¥æ™®é€šæ•°æ®</td></tr><tr><td style="text-align:left">@Autowired</td><td style="text-align:left">ä½¿ç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œç”¨äºæ ¹æ®ç±»å‹(byType)æ³¨å…¥å¼•ç”¨æ•°æ®</td></tr><tr><td style="text-align:left">@Qualifier</td><td style="text-align:left">ä½¿ç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œç»“åˆ@Autowiredï¼Œæ ¹æ®åç§°æ³¨å…¥</td></tr><tr><td style="text-align:left">@Resource</td><td style="text-align:left">ä½¿ç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œæ ¹æ®ç±»å‹æˆ–åç§°è¿›è¡Œæ³¨å…¥</td></tr></tbody></table><hr><h3 id="2-1-Valueæ³¨è§£">2.1 @Valueæ³¨è§£</h3><p>é€šè¿‡@Value ç›´æ¥æ³¨å…¥æ™®é€šå±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;haohao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ–è€…é€šè¿‡setæ–¹æ³•æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;haohao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span>&#123;</span><br><span class="line">    System.out.println(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡@Value æ³¨å…¥propertiesæ–‡ä»¶ä¸­çš„å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span>&#123;</span><br><span class="line">    System.out.println(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ è½½propertiesæ–‡ä»¶</p><p><code>&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</code></p><hr><h3 id="2-2-Autowiredæ³¨è§£">2.2 @Autowiredæ³¨è§£</h3><p>@Autowiredæ³¨è§£ï¼Œç”¨äºæ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨åœ¨å±æ€§ä¸Šç›´æ¥æ³¨å…¥</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="comment">//ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šç›´æ¥æ³¨å…¥</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span>&#123;</span><br><span class="line">    System.out.println(userDao);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å®¹å™¨ä¸­åŒä¸€ç±»å‹çš„Beanå®ä¾‹æœ‰å¤šä¸ªæ—¶ï¼Œä¼šå°è¯•è‡ªåŠ¨æ ¹æ®åå­—è¿›è¡ŒäºŒæ¬¡åŒ¹é…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒ¹é…å½“å‰Bean</span></span><br><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Repository(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å½“å®¹å™¨ä¸­åŒä¸€ç±»å‹çš„Beanå®ä¾‹æœ‰å¤šä¸ªæ—¶ï¼Œä¸”åå­—ä¸è¢«æ³¨å…¥Beanåç§°ä¸åŒ¹é…æ—¶ä¼šæŠ¥é”™</p><p><code>@Autowired</code>å’Œ<code>@Qualifier</code>é…åˆä½¿ç”¨ï¼Œç›´æ¥åŒ¹é…åå­—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure><hr><h3 id="2-3-Resourceæ³¨è§£">2.3 @Resourceæ³¨è§£</h3><p>@Resourceæ³¨è§£æ—¢å¯ä»¥æ ¹æ®ç±»å‹æ³¨å…¥ï¼Œä¹Ÿå¯ä»¥æ ¹æ®åç§°æ³¨å…¥ï¼Œæ— å‚å°±æ˜¯æ ¹æ®ç±»å‹æ³¨å…¥ï¼Œæœ‰å‚æ•°å°±æ˜¯æ ¹æ®åç§°æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="meta">@Resource(name = &quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span>&#123;</span><br><span class="line">    System.out.println(userDao);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PSï¼š@Resourceæ³¨è§£å­˜åœ¨ä¸ javax.annotation åŒ…ä¸­ï¼ŒSpringå¯¹å…¶è¿›è¡Œäº†è§£æ</p><hr><h2 id="3-éè‡ªå®šä¹‰Beanæ³¨è§£å¼€å‘">3. éè‡ªå®šä¹‰Beanæ³¨è§£å¼€å‘</h2><p>éè‡ªå®šä¹‰Beanä¸èƒ½åƒè‡ªå®šä¹‰Beanä¸€æ ·ä½¿ç”¨@Componentè¿›è¡Œç®¡ç†ï¼Œéè‡ªå®šä¹‰Beanè¦é€šè¿‡å·¥å‚çš„æ–¹å¼è¿›è¡Œå®ä¾‹åŒ–ï¼Œä½¿ç”¨@Beanæ ‡æ³¨æ–¹æ³•å³å¯ï¼Œ@Beançš„å±æ€§ä¸ºbeanNameï¼Œå¦‚ä¸æŒ‡å®šä¸ºå½“å‰å·¥å‚æ–¹æ³•åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†æ–¹æ³•è¿”å›å€¼Beanå®ä¾‹ä»¥@Beanæ³¨è§£æŒ‡å®šçš„åç§°å­˜å‚¨åˆ°Springå®¹å™¨ä¸­</span></span><br><span class="line"><span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>(); </span><br><span class="line">    dataSource.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>); </span><br><span class="line">    dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>); dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    dataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span class='p red'>PSï¼šå·¥å‚æ–¹æ³•æ‰€åœ¨ç±»å¿…é¡»è¦è¢«Springç®¡ç†</span><p>å¦‚æœ@Beanå·¥å‚æ–¹æ³•éœ€è¦å‚æ•°çš„è¯ï¼Œåˆ™æœ‰å¦‚ä¸‹å‡ ç§æ³¨å…¥æ–¹å¼ï¼š</p><ul><li>ä½¿ç”¨@Autowired æ ¹æ®ç±»å‹è‡ªåŠ¨è¿›è¡ŒBeançš„åŒ¹é…ï¼Œ@Autowiredå¯ä»¥çœç•¥ ï¼›</li><li>ä½¿ç”¨@Qualifier æ ¹æ®åç§°è¿›è¡ŒBeançš„åŒ¹é…ï¼›</li><li>ä½¿ç”¨@Value æ ¹æ®åç§°è¿›è¡Œæ™®é€šæ•°æ®ç±»å‹åŒ¹é…ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//æ ¹æ®ç±»å‹åŒ¹é…å‚æ•°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">objectDemo01</span><span class="params">(UserDao userDao)</span>&#123;</span><br><span class="line">    System.out.println(userDao);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">objectDemo02</span><span class="params">(<span class="meta">@Qualifier(&quot;userDao&quot;)</span> UserDao userDao, <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span> String username)</span>&#123;</span><br><span class="line">    System.out.println(userDao);</span><br><span class="line">    System.out.println(username);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="4-Beané…ç½®ç±»çš„æ³¨è§£å¼€å‘">4. Beané…ç½®ç±»çš„æ³¨è§£å¼€å‘</h2><p><code>@Component</code>ç­‰æ³¨è§£æ›¿ä»£äº†<code>&lt;bean&gt;</code>æ ‡ç­¾ï¼Œä½†æ˜¯åƒ<code>&lt;import&gt;</code>ã€<code>&lt;context:componentScan&gt;</code> ç­‰é<code>&lt;bean&gt;</code>æ ‡ç­¾æ€æ ·å»ä½¿ç”¨æ³¨è§£æ›¿ä»£å‘¢ï¼Ÿ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åŠ è½½propertiesæ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ç»„ä»¶æ‰«æ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼•å…¥å…¶ä»–xmlæ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:beans.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªé…ç½®ç±»æ›¿ä»£åŸæœ‰çš„xmlé…ç½®æ–‡ä»¶ï¼Œ<code>&lt;bean&gt;</code>æ ‡ç­¾ä»¥å¤–çš„æ ‡ç­¾ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨æ³¨è§£å®Œæˆçš„</p><mark class="hl-label blue">@Configuration</mark> <p>æ³¨è§£æ ‡è¯†çš„ç±»ä¸ºé…ç½®ç±»ï¼Œæ›¿ä»£åŸæœ‰xmlé…ç½®æ–‡ä»¶ï¼Œè¯¥æ³¨è§£ç¬¬ä¸€ä¸ªä½œç”¨æ˜¯æ ‡è¯†è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç¬¬äºŒä¸ªä½œç”¨æ˜¯å…·å¤‡@Componentä½œç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><mark class="hl-label green">@ComponentScan</mark> <p>ç»„ä»¶æ‰«æé…ç½®ï¼Œæ›¿ä»£åŸæœ‰xmlæ–‡ä»¶ä¸­çš„<code>&lt;context:component-scan base-package=&quot;&quot;/&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>base-packageçš„é…ç½®æ–¹å¼ï¼š</p><ul><li>æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåŒ…åï¼šæ‰«ææŒ‡å®šåŒ…åŠå…¶å­åŒ…ä¸‹ä½¿ç”¨æ³¨è§£çš„ç±»</li><li>ä¸é…ç½®åŒ…åï¼šæ‰«æå½“å‰@componentScanæ³¨è§£é…ç½®ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„ç±»</li></ul><mark class="hl-label blue">@PropertySource</mark> <p>æ³¨è§£ç”¨äºåŠ è½½å¤–éƒ¨propertiesèµ„æºé…ç½®ï¼Œæ›¿ä»£åŸæœ‰xmlä¸­çš„<code>&lt;context:property-placeholder location=â€œâ€/&gt; </code>é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@PropertySource(&#123;&quot;classpath:jdbc.properties&quot;,&quot;classpath:xxx.properties&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><mark class="hl-label green">@Import</mark> <p>ç”¨äºåŠ è½½å…¶ä»–é…ç½®ç±»ï¼Œæ›¿ä»£åŸæœ‰xmlä¸­çš„<code>&lt;import resource=&quot;classpath:beans.xml&quot;/&gt;</code>é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span> </span><br><span class="line"><span class="meta">@Import(OtherConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p><a href="#jump">ç‚¹å‡»è·³è½¬â†“â†“â†“</a></p><hr><h2 id="5-Spring-é…ç½®å…¶ä»–æ³¨è§£">5. Spring é…ç½®å…¶ä»–æ³¨è§£</h2><mark class="hl-label blue">@Primary</mark> <p>æ³¨è§£ç”¨äºæ ‡æ³¨ç›¸åŒç±»å‹çš„Beanä¼˜å…ˆè¢«ä½¿ç”¨æƒï¼Œ@Primary æ˜¯Spring3.0å¼•å…¥çš„ï¼Œä¸@Componentå’Œ@Beanä¸€èµ·ä½¿ç”¨ï¼Œæ ‡æ³¨è¯¥Beançš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œåˆ™åœ¨é€šè¿‡ç±»å‹è·å–Beanæˆ–é€šè¿‡@Autowiredæ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥æ—¶ï¼Œä¼šé€‰ç”¨ä¼˜å…ˆçº§æ›´é«˜çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Repository(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UserDao <span class="title function_">userDao01</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> UserDao <span class="title function_">userDao02</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl2</span>();&#125;</span><br></pre></td></tr></table></figure><mark class="hl-label green">@Profile</mark> <p>æ³¨è§£çš„ä½œç”¨åŒäºxmlé…ç½®æ—¶å­¦ä¹ profileå±æ€§ï¼Œæ˜¯è¿›è¡Œç¯å¢ƒåˆ‡æ¢ä½¿ç”¨çš„</p><p><code>&lt;beans profile=&quot;test&quot;&gt;</code></p><p>æ³¨è§£ @Profile æ ‡æ³¨åœ¨ç±»æˆ–æ–¹æ³•ä¸Šï¼Œæ ‡æ³¨å½“å‰äº§ç”Ÿçš„Beanä»å±äºå“ªä¸ªç¯å¢ƒï¼Œåªæœ‰æ¿€æ´»äº†å½“å‰ç¯å¢ƒï¼Œè¢«æ ‡æ³¨çš„Beanæ‰èƒ½è¢«æ³¨å†Œåˆ°Springå®¹å™¨é‡Œï¼Œä¸æŒ‡å®šç¯å¢ƒçš„Beanï¼Œä»»ä½•ç¯å¢ƒä¸‹éƒ½èƒ½æ³¨å†Œåˆ°Springå®¹å™¨é‡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Repository(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼æŒ‡å®šè¢«æ¿€æ´»çš„ç¯å¢ƒï¼š</p><ul><li>ä½¿ç”¨å‘½ä»¤è¡ŒåŠ¨æ€å‚æ•°ï¼Œè™šæ‹Ÿæœºå‚æ•°ä½ç½®åŠ è½½<code> -Dspring.profiles.active=test</code></li><li>ä½¿ç”¨ä»£ç çš„æ–¹å¼è®¾ç½®ç¯å¢ƒå˜é‡ <code>System.setProperty(&quot;spring.profiles.active&quot;,&quot;test&quot;);</code></li></ul><hr><h2 id="6-Springæ³¨è§£çš„è§£æåŸç†">6. Springæ³¨è§£çš„è§£æåŸç†</h2><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425190233499.png" alt="image-20230425190233499" style="zoom:80%;" /><p>ç»“è®ºï¼šåªè¦å°†Beanå¯¹åº”çš„BeanDefinitionæ³¨å†Œåˆ°beanDefinitionMapä¸­ï¼Œå°±å¯ä»¥ç»å†æ•´ä¸ªSpringBeançš„ç”Ÿå‘½å‘¨æœŸï¼Œæœ€ç»ˆå®ä¾‹åŒ–è¿›å…¥å•ä¾‹æ± ä¸­</p><p>ä½¿ç”¨@Componentç­‰æ³¨è§£é…ç½®å®Œæ¯•åï¼Œè¦é…ç½®ç»„ä»¶æ‰«ææ‰èƒ½ä½¿æ³¨è§£ç”Ÿæ•ˆ</p><ul><li><p>xmlé…ç½®ç»„ä»¶æ‰«æï¼š</p><p><code>&lt;context:component-scan base-package=&quot;com.itheima&quot;/&gt;</code></p></li><li><p>é…ç½®ç±»é…ç½®ç»„ä»¶æ‰«æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>ä½¿ç”¨xmlæ–¹å¼é…ç½®ç»„ä»¶æ‰«æï¼Œè€Œcomponent-scanæ˜¯ä¸€ä¸ªcontextå‘½åç©ºé—´ä¸‹çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œæ‰€ä»¥è¦æ‰¾åˆ°å¯¹åº”çš„å‘½åç©ºé—´å¤„ç†å™¨NamespaceHandler å’Œ è§£æå™¨ï¼ŒæŸ¥çœ‹spring-contextåŒ…ä¸‹çš„spring.handlersæ–‡ä»¶</p><p><code>http://www.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler</code></p><p>æŸ¥çœ‹ ContextNamespaceHandler ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;component-scan&quot;</span>, <span class="keyword">new</span> <span class="title class_">ComponentScanBeanDefinitionParser</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†ComponentScanBeanDefinitionParserè¿›è¡Œäº†æ³¨å†Œï¼Œå¯¹å…¶æºç è¿›è¡Œè·Ÿè¸ªï¼Œæœ€ç»ˆå°†æ ‡æ³¨çš„@Componentçš„ç±»ï¼Œç”Ÿæˆå¯¹åº”çš„BeanDefiitionè¿›è¡Œäº†æ³¨å†Œã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­æ²¡æœ‰ç”¨åˆ°beanå·¥å‚åå¤„ç†å™¨ï¼Œè€Œæ˜¯ç”¨åˆ°è§£æå™¨è¿›è¡Œæ‰«æã€‚</p><p>ä½¿ç”¨é…ç½®ç±»é…ç½®ç»„ä»¶æ‰«æï¼Œä½¿ç”¨AnnotationConfigApplicationContextå®¹å™¨åœ¨è¿›è¡Œåˆ›å»ºæ—¶ï¼Œå†…éƒ¨è°ƒç”¨äº†å¦‚ä¸‹ä»£ç ï¼Œè¯¥å·¥å…·æ³¨å†Œäº†å‡ ä¸ªBeanåå¤„ç†å™¨ï¼š</p><p><code>AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(AppConfig.class);</code></p><p><code>AnnotationConfigUtils.registerAnnotationConfigProcessors(this.registry);</code></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230426150923790.png" alt="image-20230426150923790" style="zoom:67%;" /><p>å…¶ä¸­ï¼ŒConfigurationClassPostProcessor æ˜¯ä¸€ä¸ª BeanDefinitionRegistryPostProcessor ï¼Œç»è¿‡ä¸€ç³»åˆ—æºç è°ƒç”¨ï¼Œæœ€ç»ˆä¹Ÿåˆ«æŒ‡å®šåˆ°äº†ClassPathBeanDefinitionScanner çš„doScan æ–¹æ³•ï¼ˆä¸xmlæ–¹å¼æœ€ç»ˆç»ˆç‚¹ä¸€è‡´ï¼‰</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425195826452.png" alt="image-20230425195826452" style="zoom:67%;" /><hr><h2 id="7-Springæ³¨è§£æ–¹å¼æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶">7. Springæ³¨è§£æ–¹å¼æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶</h2><p>ç¬¬ä¸‰æ–¹æ¡†æ¶æ•´åˆï¼Œä¾ç„¶ä½¿ç”¨MyBatisä½œä¸ºæ•´åˆå¯¹è±¡ï¼Œä¹‹å‰æˆ‘ä»¬å·²ç»ä½¿ç”¨xmlæ–¹å¼æ•´åˆäº†MyBatisï¼Œç°åœ¨ä½¿ç”¨æ³¨è§£æ–¹å¼æ— éå°±æ˜¯å°†xmlæ ‡ç­¾æ›¿æ¢ä¸ºæ³¨è§£ï¼Œå°†xmlé…ç½®æ–‡ä»¶æ›¿æ¢ä¸ºé…ç½®ç±»è€Œå·²ï¼ŒåŸæœ‰xmlæ–¹å¼æ•´åˆé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®æ•°æ®æº--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®SqlSessionFactoryBean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®MapperåŒ…æ‰«æ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.itheima.dao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨@Beanå°†DataSourceå’ŒSqlSessionFactoryBeanå­˜å‚¨åˆ°Springå®¹å™¨ä¸­ï¼Œè€ŒMapperScannerConfigurerä½¿ç”¨æ³¨è§£@MapperScanè¿›è¡ŒæŒ‡æ˜éœ€è¦æ‰«æçš„Mapperåœ¨å“ªä¸ªåŒ…ä¸‹ï¼Œä½¿ç”¨æ³¨è§£æ•´åˆMyBatisé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//æ ‡æ³¨å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼ˆæ›¿ä»£é…ç½®æ–‡ä»¶ï¼‰</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.itheima.mapper&quot;)</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span> String driver,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span> String url,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span> String username,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span> String password</span></span><br><span class="line"><span class="params">    )</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setDriverClassName(driver);</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><span id="jump"></span></p><p>æ³¨è§£æ–¹å¼ï¼ŒSpringæ•´åˆMyBatisçš„åŸç†ï¼Œå…³é”®åœ¨äº@MapperScanï¼Œ@MapperScanä¸æ˜¯Springæä¾›çš„æ³¨è§£ï¼Œæ˜¯MyBatisä¸ºäº†æ•´åˆSpringï¼Œåœ¨æ•´åˆåŒ…org.mybatis.spring.annotationä¸­æä¾›çš„æ³¨è§£ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(&#123;MapperScannerRegistrar.class&#125;)</span></span><br><span class="line"><span class="meta">@Repeatable(MapperScans.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MapperScan &#123;</span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;?&gt;[] basePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationClass() <span class="keyword">default</span> Annotation.class; </span><br><span class="line">    <span class="comment">// ... ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨ä¸€ä¸‹@Import({MapperScannerRegistrar.class})ï¼Œå½“@MapperScanè¢«æ‰«æåŠ è½½æ—¶ï¼Œä¼šè§£æ@Importæ³¨è§£ï¼Œä»è€ŒåŠ è½½æŒ‡å®šçš„ç±»ï¼Œæ­¤å¤„å°±æ˜¯åŠ è½½äº†MapperScannerRegistrar</p><p>MapperScannerRegistrarå®ç°äº†ImportBeanDefinitionRegistraræ¥å£ï¼ŒSpringä¼šè‡ªåŠ¨è°ƒç”¨registerBeanDefinitionsæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­åˆæ³¨å†ŒMapperScannerConfigurerç±»ï¼Œè€ŒMapperScannerConfigurerç±»ä½œç”¨æ˜¯æ‰«æMapperï¼Œå‘å®¹å™¨ä¸­æ³¨å†ŒMapperå¯¹åº”çš„MapperFactoryBeanï¼Œå‰é¢è®²è¿‡ï¼Œæ­¤å¤„ä¸åœ¨èµ˜è¿°äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperScannerRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span>, ResourceLoaderAware &#123;</span><br><span class="line">    <span class="comment">//é»˜è®¤æ‰§è¡ŒregisterBeanDefinitionsæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata annoMeta, AnnotationAttributes annoAttrs, BeanDefinitionRegistry registry, String beanName)</span> &#123;</span><br><span class="line">        <span class="type">BeanDefinitionBuilder</span> <span class="variable">builder</span> <span class="operator">=</span></span><br><span class="line">                BeanDefinitionBuilder.genericBeanDefinition(MapperScannerConfigurer.class);</span><br><span class="line">        <span class="comment">//... çœç•¥å…¶ä»–ä»£ç  ...</span></span><br><span class="line">        <span class="comment">//æ³¨å†ŒBeanDefinition</span></span><br><span class="line">        registry.registerBeanDefinition(beanName, builder.getBeanDefinition());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springä¸MyBatisæ³¨è§£æ–¹å¼æ•´åˆæœ‰ä¸ªé‡è¦çš„æŠ€æœ¯ç‚¹å°±æ˜¯<code>@Import</code>ã€‚</p><p>ç¬¬ä¸‰æ–¹æ¡†æ¶ä¸Springæ•´åˆxmlæ–¹å¼å¾ˆå¤šæ˜¯å‡­å€Ÿè‡ªå®šä¹‰æ ‡ç­¾å®Œæˆçš„ï¼Œè€Œç¬¬ä¸‰æ–¹æ¡†æ¶ä¸Springæ•´åˆæ³¨è§£æ–¹å¼å¾ˆå¤šæ˜¯é @Importæ³¨è§£å®Œæˆçš„ã€‚</p><p>@Importå¯ä»¥å¯¼å…¥å¦‚ä¸‹ä¸‰ç§ç±»ï¼š</p><ul><li>æ™®é€šçš„é…ç½®ç±»</li><li>å®ç°ImportSelectoræ¥å£çš„ç±»</li><li>å®ç°ImportBeanDefinitionRegistraræ¥å£çš„ç±»</li></ul><p>@Importå¯¼å…¥å®ç°äº†ImportSelectoræ¥å£çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;MyImportSelector.class&#125;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="comment">//è¿”å›è¦è¿›è¡Œæ³¨å†Œçš„Beançš„å…¨é™å®šåæ•°ç»„</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;User2.class.getName()&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ImportSelectoræ¥å£selectImportsæ–¹æ³•çš„å‚æ•°AnnotationMetadataä»£è¡¨æ³¨è§£çš„åª’ä½“æ•°æ®ï¼Œå¯ä»¥è·å¾—å½“å‰æ³¨è§£ä¿®é¥°çš„ç±»çš„å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šè·å¾—ç»„ä»¶æ‰«æçš„åŒ…å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="comment">//è·å¾—æŒ‡å®šç±»å‹æ³¨è§£çš„å…¨éƒ¨ä¿¡æ¯</span></span><br><span class="line">        Map&lt;String, Object&gt; annotationAttributes =</span><br><span class="line">                annotationMetadata.getAnnotationAttributes(ComponentScan.class.getName());</span><br><span class="line">        <span class="comment">//è·å¾—å…¨éƒ¨ä¿¡æ¯ä¸­basePackagesä¿¡æ¯</span></span><br><span class="line">        String[] basePackages = (String[]) annotationAttributes.get(<span class="string">&quot;basePackages&quot;</span>);</span><br><span class="line">        <span class="comment">//æ‰“å°ç»“æœæ˜¯com.itheima</span></span><br><span class="line">        System.out.println(basePackages[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;User2.class.getName()&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Importå¯¼å…¥å®ç°ImportBeanDefinitionRegistraræ¥å£çš„ç±»ï¼Œå®ç°äº†è¯¥æ¥å£çš„ç±»çš„registerBeanDefinitionsæ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œåœ¨è¯¥æ–¹æ³•å†…å¯ä»¥æ³¨å†ŒBeanDefinition</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata,</span></span><br><span class="line"><span class="params">                                        BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨ç»™å®šçš„BeanDefinitionRegistryå‚æ•°ï¼Œæ‰‹åŠ¨æ³¨å†ŒBeanDefinition</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">        beanDefinition.setBeanClassName(<span class="string">&quot;com.itheima.pojo.User2&quot;</span>);</span><br><span class="line">        registry.registerBeanDefinition(<span class="string">&quot;user2&quot;</span>,beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">BeanåŸºæœ¬æ³¨è§£å¼€å‘ã€Springæ³¨è§£çš„è§£æåŸç†ã€Springæ³¨è§£æ–¹å¼æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Spring" scheme="https://wuwawawa.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºxmlçš„Springåº”ç”¨</title>
    <link href="https://wuwawawa.github.io/posts/42f6a7bf.html"/>
    <id>https://wuwawawa.github.io/posts/42f6a7bf.html</id>
    <published>2023-04-24T09:05:49.000Z</published>
    <updated>2023-04-26T08:38:27.519Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-SpringBeançš„é…ç½®è¯¦è§£">1. SpringBeançš„é…ç½®è¯¦è§£</h2><p>Springå¼€å‘ä¸­ä¸»è¦æ˜¯å¯¹Beançš„é…ç½®ï¼ŒBeançš„å¸¸ç”¨é…ç½®ä¸€è§ˆå¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left">Xmlé…ç½®æ–¹å¼</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>&lt;bean id=&quot;&quot; class=&quot;&quot;&gt;</code></td><td>Beançš„idå’Œå…¨é™å®šåé…ç½®</td></tr><tr><td style="text-align:left"><code>&lt;bean name=&quot;&quot;&gt;</code></td><td>é€šè¿‡nameè®¾ç½®Beançš„åˆ«åï¼Œé€šè¿‡åˆ«åä¹Ÿèƒ½ç›´æ¥è·å–åˆ°Beanå®ä¾‹</td></tr><tr><td style="text-align:left"><code>&lt;bean scope=&quot;&quot;&gt;</code></td><td>Beançš„ä½œç”¨èŒƒå›´ï¼ŒBeanFactoryä½œä¸ºå®¹å™¨æ—¶å–å€¼singletonå’Œprototype</td></tr><tr><td style="text-align:left"><code>&lt;bean lazy-init=&quot;&quot;&gt;</code></td><td>Beançš„å®ä¾‹åŒ–æ—¶æœºï¼Œæ˜¯å¦å»¶è¿ŸåŠ è½½ã€‚BeanFactoryä½œä¸ºå®¹å™¨æ—¶æ— æ•ˆ</td></tr><tr><td style="text-align:left"><code>&lt;bean init-method=&quot;&quot;&gt;</code></td><td>Beanå®ä¾‹åŒ–åè‡ªåŠ¨æ‰§è¡Œçš„åˆå§‹åŒ–æ–¹æ³•ï¼ŒmethodæŒ‡å®šæ–¹æ³•å</td></tr><tr><td style="text-align:left"><code>&lt;bean destroy-method=&quot;&quot;&gt;</code></td><td>Beanå®ä¾‹é”€æ¯å‰çš„æ–¹æ³•ï¼ŒmethodæŒ‡å®šæ–¹æ³•å</td></tr><tr><td style="text-align:left"><code>&lt;bean autowire=&quot;&quot;&gt;</code></td><td>è®¾ç½®è‡ªåŠ¨æ³¨å…¥æ¨¡å¼ï¼Œå¸¸ç”¨çš„æœ‰æŒ‰ç…§ç±»å‹byTypeï¼ŒæŒ‰ç…§åå­—byName</td></tr><tr><td style="text-align:left"><code>&lt;bean factory-bean=&quot;&quot; factory-method=&quot;&quot;/&gt;</code></td><td>æŒ‡å®šå“ªä¸ªå·¥å‚Beançš„å“ªä¸ªæ–¹æ³•å®ŒæˆBeançš„åˆ›å»º</td></tr></tbody></table><hr><h3 id="1-1-Beançš„åŸºç¡€é…ç½®">1.1 Beançš„åŸºç¡€é…ç½®</h3><p>ä¾‹å¦‚ï¼šé…ç½®UserDaoImplç”±Springå®¹å™¨è´Ÿè´£ç®¡ç†</p><p><code>&lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot;/&gt;</code></p><p>æ­¤æ—¶å­˜å‚¨åˆ°Springå®¹å™¨ï¼ˆsingleObjectså•ä¾‹æ± ï¼‰ä¸­çš„Beançš„<code>beanName</code>æ˜¯userDaoï¼Œå€¼æ˜¯UserDaoImplå¯¹è±¡ï¼Œå¯ä»¥æ ¹æ®beanNameè·å–Beanå®ä¾‹</p><p><code>applicationContext.getBean(&quot;userDao&quot;);</code></p><p>å¦‚æœä¸é…ç½®idï¼Œåˆ™Springä¼šæŠŠå½“å‰Beanå®ä¾‹çš„å…¨é™å®šåä½œä¸º<code>beanName</code></p><p><code>applicationContext.getBean(&quot;com.itheima.dao.impl.UserDaoImpl&quot;);</code></p><hr><h3 id="1-2-Beançš„åˆ«åé…ç½®">1.2 Beançš„åˆ«åé…ç½®</h3><p>å¯ä»¥ä¸ºå½“å‰BeanæŒ‡å®šå¤šä¸ªåˆ«åï¼Œæ ¹æ®åˆ«åä¹Ÿå¯ä»¥è·å¾—Beanå¯¹è±¡</p><p><code>&lt;bean id=&quot;userDao&quot; name=&quot;aaa,bbb,ccc&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot;/&gt;</code></p><p>æ­¤æ—¶å¤šä¸ªåç§°éƒ½å¯ä»¥è·å¾—UserDaoImplå®ä¾‹å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">applicationContext.getBean(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">applicationContext.getBean(<span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">applicationContext.getBean(<span class="string">&quot;ccc&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424163859339.png" alt="image-20230424163859339"></p><hr><h3 id="1-3-Beançš„èŒƒå›´é…ç½®">1.3 Beançš„èŒƒå›´é…ç½®</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå•çº¯çš„Springç¯å¢ƒBeançš„ä½œç”¨èŒƒå›´æœ‰ä¸¤ä¸ªï¼š<code>Singleton</code>å’Œ<code>Prototype</code></p><ul><li><p><code>singleton</code>ï¼šå•ä¾‹ï¼Œé»˜è®¤å€¼ï¼ŒSpringå®¹å™¨åˆ›å»ºçš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡ŒBeançš„å®ä¾‹åŒ–ï¼Œå¹¶å­˜å‚¨åˆ°å®¹å™¨å†…éƒ¨çš„å•ä¾‹æ± ä¸­ï¼Œæ¯æ¬¡getBeanæ—¶éƒ½æ˜¯ä»å•ä¾‹æ± ä¸­è·å–ç›¸åŒçš„Beanå®ä¾‹ï¼›</p></li><li><p><code>prototype</code>ï¼šåŸå‹ï¼ŒSpringå®¹å™¨åˆå§‹åŒ–æ—¶ä¸ä¼šåˆ›å»ºBeanå®ä¾‹ï¼Œå½“è°ƒç”¨getBeanæ—¶æ‰ä¼šå®ä¾‹åŒ–Beanï¼Œæ¯æ¬¡getBeanéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanå®ä¾‹ã€‚</p></li></ul><div class="tabs" id="25d155c3-6343-4664-920b-58f09aaf9a33"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#25d155c3-6343-4664-920b-58f09aaf9a33-1"><i class="fas fa-atom"></i>è®¾ç½®ä¸ºsingletonæ—¶</button></li><li class="tab"><button type="button" data-href="#25d155c3-6343-4664-920b-58f09aaf9a33-2"><i class="far fa-sun"></i>è®¾ç½®ä¸ºprototypeæ—¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="25d155c3-6343-4664-920b-58f09aaf9a33-1"><p>å½“scopeè®¾ç½®ä¸ºsingletonæ—¶ï¼Œè·å¾—ä¸¤æ¬¡å¯¹è±¡æ‰“å°ç»“æœæ˜¯ä¸€æ ·çš„</p><p><code>&lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot; scope=&quot;singleton&quot;/&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">userDao</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">userDao2</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">System.out.println(userDao);  <span class="comment">//com.itheima.dao.impl.UserDaoImpl@631330c</span></span><br><span class="line">System.out.println(userDao2); <span class="comment">//com.itheima.dao.impl.UserDaoImpl@631330c</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡æ–­ç‚¹è°ƒè¯•ï¼Œè§‚å¯Ÿå¯ä»¥å‘ç°å•ä¾‹æ± ä¸­å­˜åœ¨userDaoå®ä¾‹</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423173834190.png" alt="image-20230423173834190" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="25d155c3-6343-4664-920b-58f09aaf9a33-2"><p>å½“scopeè®¾ç½®ä¸ºprototypeæ—¶ï¼Œè·å¾—ä¸¤æ¬¡å¯¹è±¡æ‰“å°ç»“æœæ˜¯ä¸ä¸€æ ·çš„</p><p><code>&lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot; scope=&quot;prototype&quot;/&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">userDao</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">userDao2</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">System.out.println(userDao);  <span class="comment">//com.itheima.dao.impl.UserDaoImpl@4d50efb8</span></span><br><span class="line">System.out.println(userDao2); <span class="comment">//com.itheima.dao.impl.UserDaoImpl@7e2d773b</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡æ–­ç‚¹è°ƒè¯•ï¼Œè§‚å¯Ÿå¯ä»¥å‘ç°å•ä¾‹æ± ä¸­ä¸å­˜åœ¨userDaoå®ä¾‹ï¼Œä½†æ˜¯userDaoçš„ä¿¡æ¯å·²ç»è¢«å­˜å‚¨åˆ°beanDefinitionMapä¸­äº†</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423173945599.png" alt="image-20230423173945599" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="1-4-Beançš„å»¶è¿ŸåŠ è½½">1.4 Beançš„å»¶è¿ŸåŠ è½½</h3><p>å½“lazy-initè®¾ç½®ä¸ºtrueæ—¶ä¸ºå»¶è¿ŸåŠ è½½ï¼Œä¹Ÿå°±æ˜¯å½“Springå®¹å™¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¸ä¼šç«‹å³åˆ›å»ºBeanå®ä¾‹ï¼Œç­‰å¾…ç”¨åˆ°æ—¶åœ¨åˆ›å»ºBeanå®ä¾‹å¹¶å­˜å‚¨åˆ°å•ä¾‹æ± ä¸­å»ï¼Œåç»­åœ¨ä½¿ç”¨è¯¥Beanç›´æ¥ä»å•ä¾‹æ± è·å–å³å¯ï¼Œæœ¬è´¨ä¸Šè¯¥Beanè¿˜æ˜¯å•ä¾‹çš„</p><p><code>&lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot; lazy-init=&quot;true&quot;/&gt;</code></p><hr><h3 id="1-5-Beançš„åˆå§‹åŒ–é”€æ¯æ–¹æ³•é…ç½®">1.5 Beançš„åˆå§‹åŒ–é”€æ¯æ–¹æ³•é…ç½®</h3><p>Beanåœ¨è¢«å®ä¾‹åŒ–åï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•å®Œæˆä¸€äº›åˆå§‹åŒ–çš„æ“ä½œï¼ŒBeanåœ¨é”€æ¯ä¹‹å‰ä¹Ÿå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„é”€æ¯æ–¹æ³•å®Œæˆä¸€äº›æ“ä½œï¼Œåˆå§‹åŒ–æ–¹æ³•åç§°å’Œé”€æ¯æ–¹æ³•åç§°é€šè¿‡</p><p><code>&lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot; init-method=&quot;init&quot; destroy-method=&quot;destroy&quot;/&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoImplåˆ›å»ºäº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆå§‹åŒ–æ–¹æ³•...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é”€æ¯æ–¹æ³•...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰©å±•ï¼šé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å®ç°InitializingBeanæ¥å£ï¼Œå®Œæˆä¸€äº›Beançš„åˆå§‹åŒ–æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>,InitializingBean &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoImpl åˆ›å»ºäº†&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆå§‹åŒ–æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é”€æ¯æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ‰§è¡Œæ—¶æœºæ—©äº init method é…ç½®çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span> <span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot; InitializingBean...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="1-6-Beançš„å®ä¾‹åŒ–é…ç½®">1.6 Beançš„å®ä¾‹åŒ–é…ç½®</h3><p>Springçš„å®ä¾‹åŒ–æ–¹å¼ä¸»è¦å¦‚ä¸‹ä¸¤ç§ï¼š</p><ul><li><p>æ„é€ æ–¹å¼å®ä¾‹åŒ–ï¼šåº•å±‚é€šè¿‡æ„é€ æ–¹æ³•å¯¹Beanè¿›è¡Œå®ä¾‹åŒ–</p></li><li><p>å·¥å‚æ–¹å¼å®ä¾‹åŒ–ï¼šåº•å±‚é€šè¿‡è°ƒç”¨è‡ªå®šä¹‰çš„å·¥å‚æ–¹æ³•å¯¹Beanè¿›è¡Œå®ä¾‹åŒ–</p></li></ul><p>æ„é€ æ–¹å¼å®ä¾‹åŒ–Beanåˆåˆ†ä¸ºæ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–å’Œæœ‰å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–ï¼ŒSpringä¸­é…ç½®çš„<code>&lt;bean&gt;</code>å‡ ä¹éƒ½æ˜¯æ— å‚æ„é€ è¯¥æ–¹å¼ï¼Œæ­¤å¤„ä¸åœ¨èµ˜è¿°ã€‚ä¸‹é¢è®²è§£æœ‰å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ‰å‚æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">(String name)</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰å‚æ„é€ åœ¨å®ä¾‹åŒ–Beanæ—¶ï¼Œéœ€è¦å‚æ•°çš„æ³¨å…¥ï¼Œé€šè¿‡<code>&lt;constructor-arg&gt;</code>æ ‡ç­¾ï¼ŒåµŒå…¥åœ¨<code>&lt;bean&gt;</code>æ ‡ç­¾å†…éƒ¨æä¾›æ„é€ å‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;haohao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å·¥å‚æ–¹å¼å®ä¾‹åŒ–Beanï¼Œåˆåˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§ï¼š</p><ul><li><p>é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean</p></li><li><p>å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean</p></li><li><p>å®ç°FactoryBeanè§„èŒƒå»¶è¿Ÿå®ä¾‹åŒ–Bean</p></li></ul><div class="tabs" id="e67eb33f-cfdb-49fc-959f-2d57a6a55639"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#e67eb33f-cfdb-49fc-959f-2d57a6a55639-1"><i class="fas fa-cat"></i>é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean</button></li><li class="tab"><button type="button" data-href="#e67eb33f-cfdb-49fc-959f-2d57a6a55639-2"><i class="fas fa-horse"></i>å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean</button></li><li class="tab"><button type="button" data-href="#e67eb33f-cfdb-49fc-959f-2d57a6a55639-3"><i class="fas fa-dove"></i>å®ç°FactoryBeanè§„èŒƒå»¶è¿Ÿå®ä¾‹åŒ–Bean</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="e67eb33f-cfdb-49fc-959f-2d57a6a55639-1"><p>é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Beanï¼Œå…¶å®å°±æ˜¯å®šä¹‰ä¸€ä¸ªå·¥å‚ç±»ï¼Œæä¾›ä¸€ä¸ªé™æ€æ–¹æ³•ç”¨äºç”Ÿäº§Beanå®ä¾‹ï¼Œåœ¨å°†è¯¥å·¥å‚ç±»åŠå…¶é™æ€æ–¹æ³•é…ç½®ç»™Springå³å¯</p><p><mark class="hl-label blue">é€šè¿‡å·¥å‚åˆ›å»ºbeanä¹‹å‰å¯ä»¥è¿›è¡Œä¸€äº›å…¶ä»–ä¸šåŠ¡é€»è¾‘æ“ä½œï¼Œæ¯”è¾ƒçµæ´»ï¼Œä¾‹å¦‚è·å–ç¬¬ä¸‰æ–¹jaråŒ…çš„bean</mark></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å·¥å‚ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoFactoryBean</span> &#123;</span><br><span class="line">    <span class="comment">//éé™æ€å·¥å‚æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserDao <span class="title function_">getUserDao</span><span class="params">(String name)</span>&#123;</span><br><span class="line">    <span class="comment">//å¯ä»¥åœ¨æ­¤ç¼–å†™ä¸€äº›å…¶ä»–é€»è¾‘ä»£ç </span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Beanï¼Œå…¶å®å°±æ˜¯å®šä¹‰ä¸€ä¸ªå·¥å‚ç±»ï¼Œæä¾›ä¸€ä¸ªé™æ€æ–¹æ³•ç”¨äºç”Ÿäº§Beanå®ä¾‹ï¼Œåœ¨å°†è¯¥å·¥å‚ç±»åŠå…¶é™æ€æ–¹æ³•é…ç½®ç»™Springå³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.factory.UserDaoFactoryBean&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getUserDao&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;haohao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>PSï¼š<code>&lt;constructor-arg&gt;</code>æ ‡ç­¾ä¸ä»…ä»…æ˜¯ä¸ºæ„é€ æ–¹æ³•ä¼ é€’å‚æ•°ï¼Œåªè¦æ˜¯ä¸ºäº†å®ä¾‹åŒ–å¯¹è±¡è€Œä¼ é€’çš„å‚æ•°éƒ½å¯ä»¥é€šè¿‡<code>&lt;constructor-arg&gt;</code>æ ‡ç­¾å®Œæˆï¼Œä¾‹å¦‚ä¸Šé¢é€šè¿‡é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Beanæ‰€ä¼ é€’çš„å‚æ•°ä¹Ÿæ˜¯è¦é€šè¿‡<code>&lt;constructor-arg&gt;</code>è¿›è¡Œä¼ é€’çš„</p><p>æµ‹è¯•ä»£ç ï¼Œç›´æ¥é€šè¿‡ApplicationContextè·å¾—userDaoå³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">ClassPathxmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">userDao</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">System.out.println(userDao);</span><br></pre></td></tr></table></figure><p>æ–­ç‚¹è°ƒè¯•ï¼ŒUserDaoImplå®ä¾‹å¯¹è±¡ä¼šå­˜åœ¨äºå•ä¾‹æ± ä¸­</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423193549373.png" alt="image-20230423193549373" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e67eb33f-cfdb-49fc-959f-2d57a6a55639-2"><p>å®ä¾‹å·¥å‚æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯éé™æ€å·¥å‚æ–¹æ³•äº§ç”ŸBeanå®ä¾‹ï¼Œä¸é™æ€å·¥å‚æ–¹å¼æ¯”è¾ƒï¼Œè¯¥æ–¹å¼éœ€è¦å…ˆæœ‰å·¥å‚å¯¹è±¡ï¼Œåœ¨ç”¨å·¥å‚å¯¹è±¡å»è°ƒç”¨éé™æ€æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œé…ç½®æ—¶ï¼Œè¦å…ˆé…ç½®å·¥å‚Beanï¼Œåœ¨é…ç½®ç›®æ ‡Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å·¥å‚ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoFactoryBean2</span>&#123;</span><br><span class="line">    <span class="comment">//éé™æ€å·¥å‚æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> UserDao <span class="title function_">getUserDao</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="comment">//å¯ä»¥åœ¨æ­¤ç¼–å†™ä¸€äº›å…¶ä»–é€»è¾‘ä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä¾‹å·¥å‚æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯éé™æ€å·¥å‚æ–¹æ³•äº§ç”ŸBeanå®ä¾‹ï¼Œä¸é™æ€å·¥å‚æ–¹å¼æ¯”è¾ƒï¼Œè¯¥æ–¹å¼éœ€è¦å…ˆæœ‰å·¥å‚å¯¹è±¡ï¼Œåœ¨ç”¨å·¥å‚å¯¹è±¡å»è°ƒç”¨éé™æ€æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œé…ç½®æ—¶ï¼Œè¦å…ˆé…ç½®å·¥å‚Beanï¼Œåœ¨é…ç½®ç›®æ ‡Bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®å®ä¾‹å·¥å‚Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoFactoryBean2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.factory.UserDaoFactoryBean2&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®å®ä¾‹å·¥å‚Beançš„å“ªä¸ªæ–¹æ³•ä½œä¸ºå·¥å‚æ–¹æ³•--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;userDaoFactoryBean2&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getUserDao&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;haohao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç åŒä¸Šï¼Œç›´æ¥é€šè¿‡ApplicationContextè·å¾—userDaoå³å¯ï¼Œä¸åœ¨èµ˜è¿°</p><p>é€šè¿‡æ–­ç‚¹è§‚å¯Ÿå•ä¾‹æ± singletonObjectsï¼Œå‘ç°å•ä¾‹æ± ä¸­æ—¢æœ‰å·¥å‚Beanå®ä¾‹ï¼Œä¹Ÿæœ‰ç›®æ ‡Beanå®ä¾‹ï¼Œä¸”éƒ½æ˜¯åœ¨Springå®¹å™¨åˆ›å»ºæ—¶ï¼Œå°±å®Œæˆäº†Beançš„å®ä¾‹åŒ–</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423194001835.png" alt="image-20230423194001835" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e67eb33f-cfdb-49fc-959f-2d57a6a55639-3"><p>ä¸Šé¢ä¸ç®¡æ˜¯é™æ€å·¥å‚æ–¹å¼è¿˜æ˜¯éé™æ€å·¥å‚æ–¹å¼ï¼Œéƒ½æ˜¯è‡ªå®šä¹‰çš„å·¥å‚æ–¹æ³•ï¼ŒSpringæä¾›äº†FactoryBeançš„æ¥å£è§„èŒƒï¼ŒFactoryBeanæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">OBJECT_TYPE_ATTRIBUTE</span> <span class="operator">=</span> <span class="string">&quot;factoryBeanObjectType&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—å®ä¾‹å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—å®ä¾‹å¯¹è±¡ç±»å‹æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Class&lt;?&gt; getObjectType();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰å·¥å‚å®ç°FactoryBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoFactoryBean3</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;UserDao&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> UserDao <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType () &#123;</span><br><span class="line">            <span class="keyword">return</span> UserDao.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®FactoryBeanäº¤ç”±Springç®¡ç†å³å¯</p><p><code>&lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.factory.UserDaoFactoryBean3&quot;/&gt;</code></p><p>é€šè¿‡Springå®¹å™¨æ ¹æ®beanNameå¯ä»¥æ­£å¸¸è·å¾—UserDaoImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">ClassPathxmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">userDao</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">System.out.println(userDao);</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ–­ç‚¹è§‚å¯Ÿå‘ç°Springå®¹å™¨åˆ›å»ºæ—¶ï¼ŒFactoryBeanè¢«å®ä¾‹åŒ–äº†ï¼Œå¹¶å­˜å‚¨åˆ°äº†å•ä¾‹æ± singletonObjectsä¸­ï¼Œä½†æ˜¯getObject() æ–¹æ³•å°šæœªè¢«æ‰§è¡Œï¼ŒUserDaoImplä¹Ÿæ²¡è¢«å®ä¾‹åŒ–ï¼Œå½“é¦–æ¬¡ç”¨åˆ°UserDaoImplæ—¶ï¼Œæ‰è°ƒç”¨getObject() ï¼Œæ­¤å·¥å‚æ–¹å¼äº§ç”Ÿçš„Beanå®ä¾‹ä¸ä¼šå­˜å‚¨åˆ°å•ä¾‹æ± singletonObjectsä¸­ï¼Œä¼šå­˜å‚¨åˆ°factoryBeanObjectCacheç¼“å­˜æ± ä¸­ï¼Œå¹¶ä¸”åæœŸæ¯æ¬¡ä½¿ç”¨åˆ°userDaoéƒ½ä»è¯¥ç¼“å­˜æ± ä¸­è¿”å›çš„æ˜¯åŒä¸€ä¸ªuserDaoå®ä¾‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423194742761.png" alt="image-20230423194742761" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="1-7-Beançš„ä¾èµ–æ³¨å…¥é…ç½®">1.7 Beançš„ä¾èµ–æ³¨å…¥é…ç½®</h3><p>Beançš„ä¾èµ–æ³¨å…¥æœ‰ä¸¤ç§æ–¹å¼:</p><table><thead><tr><th>æ³¨å…¥æ–¹å¼</th><th>é…ç½®æ–¹å¼</th></tr></thead><tbody><tr><td>é€šè¿‡Beançš„setæ–¹æ³•æ³¨å…¥</td><td><code>&lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;/&gt;</code> <br/><code>&lt;property name=&quot;userDao&quot; value=&quot;haohao&quot;/&gt;</code></td></tr><tr><td>é€šè¿‡æ„é€ Beançš„æ–¹æ³•è¿›è¡Œæ³¨å…¥</td><td><code>&lt;constructor-argname=&quot;name&quot; ref=&quot;userDao&quot;/&gt; </code><br/><code>&lt;constructor-argname=&quot;name&quot; value=&quot;haohao&quot;/&gt;</code></td></tr></tbody></table><p>å…¶ä¸­ï¼Œref æ˜¯reference çš„ç¼©å†™å½¢å¼ï¼Œç¿»è¯‘ä¸ºï¼šæ¶‰åŠï¼Œå‚è€ƒçš„æ„æ€ï¼Œç”¨äºå¼•ç”¨å…¶ä»–Beançš„idã€‚value ç”¨äºæ³¨å…¥æ™®é€šå±æ€§å€¼ã€‚</p><p>ä¾èµ–æ³¨å…¥çš„æ•°æ®ç±»å‹æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</p><p>æ™®é€šæ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼šStringã€intã€booleanç­‰ï¼Œé€šè¿‡valueå±æ€§æŒ‡å®šã€‚</p><p>å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼šUserDaoImplã€DataSourceç­‰ï¼Œé€šè¿‡refå±æ€§æŒ‡å®šã€‚</p><p>é›†åˆæ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼šListã€Mapã€Propertiesç­‰ã€‚</p><div class="tabs" id="a553bb0c-fed5-43e5-b67f-081ec5172601"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#a553bb0c-fed5-43e5-b67f-081ec5172601-1"><i class="fas fa-cat"></i>æ³¨å…¥List<T>é›†åˆæ™®é€šæ•°æ®</button></li><li class="tab"><button type="button" data-href="#a553bb0c-fed5-43e5-b67f-081ec5172601-2"><i class="fas fa-horse"></i>æ³¨å…¥List<T>é›†åˆå¼•ç”¨æ•°æ®</button></li><li class="tab"><button type="button" data-href="#a553bb0c-fed5-43e5-b67f-081ec5172601-3"><i class="fas fa-dove"></i>æ³¨å…¥Set<T>é›†åˆ</button></li><li class="tab"><button type="button" data-href="#a553bb0c-fed5-43e5-b67f-081ec5172601-4"><i class="fas fa-dragon"></i>æ³¨å…¥Map<K,V>é›†åˆ</button></li><li class="tab"><button type="button" data-href="#a553bb0c-fed5-43e5-b67f-081ec5172601-5"><i class="fas fa-heartbeat"></i>æ³¨å…¥Propertiesé”®å€¼å¯¹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="a553bb0c-fed5-43e5-b67f-081ec5172601-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">setStrList</span> <span class="params">(List&lt;String&gt; strList)</span> &#123;</span><br><span class="line">    strList.forEach(str-&gt;&#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;strList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>haohao<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>niaoniao<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a553bb0c-fed5-43e5-b67f-081ec5172601-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setobiList</span><span class="params">(List&lt;UserDao&gt; objList)</span> &#123;</span><br><span class="line">    objList.forEach(obj -&gt; &#123;</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImp1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImp1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç›´æ¥å¼•ç”¨å®¹å™¨ä¸­å­˜åœ¨çš„Bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½® UserDao --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½® UserService--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;userDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;userDao2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;userDao3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a553bb0c-fed5-43e5-b67f-081ec5172601-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å…¥æ³›å‹ä¸ºå­—ç¬¦ä¸²çš„ Set é›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValueSet</span><span class="params">(Set&lt;String&gt; valueSet)</span> &#123;</span><br><span class="line">    valueSet.forEach(str -&gt; &#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ³¨å…¥æ³›å‹ä¸ºå¯¹è±¡çš„ Set é›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setObjSet</span><span class="params">(Set&lt;UserDao&gt; objSet)</span> &#123;</span><br><span class="line">    objSet.forEach(obj -&gt; &#123;</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ³¨å…¥æ³›å‹ä¸ºå­—ç¬¦ä¸²çš„Seté›†åˆ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;valueSet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>muzi<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>muran<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ³¨å…¥æ³›å‹ä¸ºå¯¹è±¡çš„Seté›†åˆ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objSet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;userDao&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;userDao2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;userDao3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a553bb0c-fed5-43e5-b67f-081ec5172601-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å…¥å€¼ä¸ºå­—ç¬¦ä¸²çš„ Map é›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValueMap</span><span class="params">(Map&lt;String, String&gt; valueMap)</span> &#123;</span><br><span class="line">    valueMap.forEach((k, v) -&gt; &#123;</span><br><span class="line">        System.out.println(k + <span class="string">&quot;==&quot;</span> + v);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å…¥å€¼ä¸ºå¯¹è±¡çš„ Map é›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setObjMap</span><span class="params">(Map&lt;String, UserDao&gt; objMap)</span> &#123;</span><br><span class="line">    objMap.forEach((k, v) -&gt; &#123;</span><br><span class="line">        System.out.println(k + <span class="string">&quot;==&quot;</span> + v);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!- æ³¨å…¥å€¼ä¸ºå­—ç¬¦ä¸²çš„Mapé›†åˆ --&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;valueMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;aaa&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;AAA&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;bbb&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BBB&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ccc&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ccc&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!- æ³¨å…¥å€¼ä¸ºå¯¹è±¡çš„Mapé›†åˆ --&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ud&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;userDao&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ud2&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;userDao2&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ud3&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;userDao3&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="a553bb0c-fed5-43e5-b67f-081ec5172601-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å…¥ Properties</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span>&#123;</span><br><span class="line">    properties.forEach((k,v)-&gt;&#123;</span><br><span class="line">    System.out.println( k+<span class="string">&quot;===&quot;</span>+v);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;xxx&quot;</span> &lt;/<span class="attr">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;yyy&quot;</span> &lt;/<span class="attr">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>æ‰©å±•ï¼šè‡ªåŠ¨è£…é…æ–¹å¼</p><p>å¦‚æœè¢«æ³¨å…¥çš„å±æ€§ç±»å‹æ˜¯Beanå¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨<code>&lt;bean&gt;</code>æ ‡ç­¾ä¸­ä½¿ç”¨autowireå±æ€§å»é…ç½®è‡ªåŠ¨æ³¨å…¥æ–¹å¼ï¼Œå±æ€§å€¼æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>byNameï¼šé€šè¿‡å±æ€§åè‡ªåŠ¨è£…é…ï¼Œå³å»åŒ¹é…setXxxä¸id=â€œxxxâ€ï¼ˆname=â€œxxxâ€ï¼‰æ˜¯å¦ä¸€è‡´ï¼›</p></li><li><p>byTypeï¼šé€šè¿‡Beançš„ç±»å‹ä»å®¹å™¨ä¸­åŒ¹é…ï¼ŒåŒ¹é…å‡ºå¤šä¸ªç›¸åŒBeanç±»å‹æ—¶ï¼ŒæŠ¥é”™ã€‚</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="1-8-Springçš„å…¶ä»–é…ç½®æ ‡ç­¾">1.8 Springçš„å…¶ä»–é…ç½®æ ‡ç­¾</h3><p>Spring çš„xmlæ ‡ç­¾å¤§ä½“ä¸Šåˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç§æ˜¯é»˜è®¤æ ‡ç­¾ï¼Œä¸€ç§æ˜¯è‡ªå®šä¹‰æ ‡ç­¾</p><p>é»˜è®¤æ ‡ç­¾ï¼šå°±æ˜¯ä¸ç”¨é¢å¤–å¯¼å…¥å…¶ä»–å‘½åç©ºé—´çº¦æŸçš„æ ‡ç­¾ï¼Œä¾‹å¦‚<code>&lt;bean&gt;</code>æ ‡ç­¾</p><p>è‡ªå®šä¹‰æ ‡ç­¾ï¼šå°±æ˜¯éœ€è¦é¢å¤–å¼•å…¥å…¶ä»–å‘½åç©ºé—´çº¦æŸï¼Œå¹¶é€šè¿‡å‰ç¼€å¼•ç”¨çš„æ ‡ç­¾ï¼Œä¾‹å¦‚<code>&lt;context:property-placeholder/&gt;</code> æ ‡ç­¾</p><p>Springçš„é»˜è®¤æ ‡ç­¾ç”¨åˆ°çš„æ˜¯Springçš„é»˜è®¤å‘½åç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¯¥å‘½åç©ºé—´çº¦æŸä¸‹çš„é»˜è®¤æ ‡ç­¾å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ ‡ç­¾</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>&lt;beans&gt;</code></td><td>ä¸€èˆ¬ä½œä¸ºxml é…ç½®æ ¹æ ‡ç­¾ï¼Œå…¶ä»–æ ‡ç­¾éƒ½æ˜¯è¯¥æ ‡ç­¾çš„å­æ ‡ç­¾</td></tr><tr><td><code>&lt;bean&gt;</code></td><td>Beançš„é…ç½®æ ‡ç­¾ï¼Œä¸Šé¢å·²ç»è¯¦è§£äº†ï¼Œæ­¤å¤„ä¸å†é˜è¿°</td></tr><tr><td><code>&lt;import&gt;</code></td><td>å¤–éƒ¨èµ„æºå¯¼å…¥æ ‡ç­¾</td></tr><tr><td><code>&lt;alias&gt;</code></td><td>æŒ‡å®šBeançš„åˆ«åæ ‡ç­¾ï¼Œä½¿ç”¨è¾ƒå°‘</td></tr></tbody></table><div class="tabs" id="98818658-50eb-4d2a-80b7-7de4192d3ffb"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#98818658-50eb-4d2a-80b7-7de4192d3ffb-1"><i class="fas fa-atom"></i>beansæ ‡ç­¾</button></li><li class="tab"><button type="button" data-href="#98818658-50eb-4d2a-80b7-7de4192d3ffb-2"><i class="far fa-sun"></i>importæ ‡ç­¾</button></li><li class="tab"><button type="button" data-href="#98818658-50eb-4d2a-80b7-7de4192d3ffb-3"><i class="fas fa-wind"></i>aliasæ ‡ç­¾</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="98818658-50eb-4d2a-80b7-7de4192d3ffb-1"><p>é™¤äº†ç»å¸¸ç”¨çš„åšä¸ºæ ¹æ ‡ç­¾å¤–ï¼Œè¿˜å¯ä»¥åµŒå¥—åœ¨æ ¹æ ‡ç­¾å†…ï¼Œä½¿ç”¨profileå±æ€§åˆ‡æ¢å¼€å‘ç¯å¢ƒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®æµ‹è¯•ç¯å¢ƒä¸‹ï¼Œéœ€è¦åŠ è½½çš„Beanå®ä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">                           </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--é…ç½®å¼€å‘ç¯å¢ƒä¸‹ï¼Œéœ€è¦åŠ è½½çš„ Bean å®ä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">       </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼æŒ‡å®šè¢«æ¿€æ´»çš„ç¯å¢ƒï¼š</p><ul><li><p>ä½¿ç”¨å‘½ä»¤è¡ŒåŠ¨æ€å‚æ•°ï¼Œè™šæ‹Ÿæœºå‚æ•°ä½ç½®åŠ è½½<code>-Dspring.profiles.active=test</code></p></li><li><p>ä½¿ç”¨ä»£ç çš„æ–¹å¼è®¾ç½®ç¯å¢ƒå˜é‡<code>System.setProperty(&quot;spring.profiles.active&quot;,&quot;test&quot;)</code></p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="98818658-50eb-4d2a-80b7-7de4192d3ffb-2"><p>ç”¨äºå¯¼å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œé¡¹ç›®å˜å¤§åï¼Œå°±ä¼šå¯¼è‡´ä¸€ä¸ªé…ç½®æ–‡ä»¶å†…å®¹è¿‡å¤šï¼Œå¯ä»¥å°†ä¸€ä¸ªé…ç½®æ–‡ä»¶æ ¹æ®ä¸šåŠ¡æŸå—è¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†åï¼Œæœ€ç»ˆé€šè¿‡<import>æ ‡ç­¾å¯¼å…¥åˆ°ä¸€ä¸ªä¸»é…ç½®æ–‡ä»¶ä¸­ï¼Œé¡¹ç›®åŠ è½½ä¸»é…ç½®æ–‡ä»¶å°±è¿åŒ<code>&lt;import&gt;</code>å¯¼å…¥çš„æ–‡ä»¶ä¸€å¹¶åŠ è½½äº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¯¼å…¥ç”¨æˆ·æ¨¡å—é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:UserModuleApplicationContext.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å¯¼å…¥å•†å“æ¨¡å—é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:ProductModuleApplicationContext.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="98818658-50eb-4d2a-80b7-7de4192d3ffb-3"><p>ä¸ºæŸä¸ªBeanæ·»åŠ åˆ«åï¼Œä¸åœ¨<code>&lt;bean&gt;</code>æ ‡ç­¾ä¸Šä½¿ç”¨nameå±æ€§æ·»åŠ åˆ«åçš„æ–¹å¼ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸ºUserServiceImplæŒ‡å®šå››ä¸ªåˆ«åï¼šaaaã€bbbã€xxxã€yyy</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½® UserService --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">name</span>=<span class="string">&quot;aaa,bbb&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æŒ‡å®šåˆ«å --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;xxx&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;yyy&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>æ–­ç‚¹è°ƒè¯•ï¼Œåœ¨beanFactoryä¸­ç»´æŠ¤ç€ä¸€ä¸ªåä¸ºaliasMapçš„Map&lt;String,String&gt;é›†åˆï¼Œå­˜å‚¨åˆ«åå’ŒbeanNameä¹‹é—´çš„æ˜ å°„å…³ç³»</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423214921470.png" alt="image-20230423214921470" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>Springçš„è‡ªå®šä¹‰æ ‡ç­¾éœ€è¦å¼•å…¥å¤–éƒ¨çš„å‘½åç©ºé—´ï¼Œå¹¶ä¸ºå¤–éƒ¨çš„å‘½åç©ºé—´æŒ‡å®šå‰ç¼€ï¼Œä½¿ç”¨&lt;å‰ç¼€:æ ‡ç­¾&gt; å½¢å¼çš„æ ‡ç­¾ï¼Œç§°ä¹‹ä¸ºè‡ªå®šä¹‰æ ‡ç­¾ï¼Œè‡ªå®šä¹‰æ ‡ç­¾çš„è§£ææµç¨‹ä¹Ÿæ˜¯Spring xmlæ‰©å±•ç‚¹æ–¹å¼ä¹‹ä¸€ï¼Œåœ¨ã€ŠSpringæ•´åˆå…¶ä»–æ¡†æ¶ã€‹ç« èŠ‚è¿›è¡Œè¯¦ç»†ä»‹ç»</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é»˜è®¤æ ‡ç­¾ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--è‡ªå®šä¹‰æ ‡ç­¾ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context</span> <span class="attr">:property</span> <span class="attr">placeholder</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc</span> <span class="attr">:annotation</span> <span class="attr">driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo</span> <span class="attr">:application</span> <span class="attr">name</span>=<span class="string">&quot;application&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="2-Springçš„getæ–¹æ³•">2. Springçš„getæ–¹æ³•</h2><table><thead><tr><th>æ–¹æ³•å®šä¹‰</th><th>è¿”å›å€¼å’Œå‚æ•°</th></tr></thead><tbody><tr><td><code>Object getBean(String beanName)</code></td><td>æ ¹æ®beanNameä»å®¹å™¨ä¸­è·å–Beanå®ä¾‹ï¼Œè¦æ±‚å®¹å™¨ä¸­Beanå”¯ä¸€ï¼Œè¿”å›å€¼ä¸ºObjectï¼Œéœ€è¦å¼ºè½¬</td></tr><tr><td><code>T getBean (Class type)</code></td><td>æ ¹æ®Classç±»å‹ä»å®¹å™¨ä¸­è·å–Beanå®ä¾‹ï¼Œè¦æ±‚å®¹å™¨ä¸­Beanç±»å‹å”¯ä¸€ï¼Œè¿”å›å€¼ä¸ºClassç±»å‹å®ä¾‹ï¼Œæ— éœ€å¼ºè½¬</td></tr><tr><td><code>T getBean (String beanNameï¼ŒClass type)</code></td><td>æ ¹æ®beanNameä»å®¹å™¨ä¸­è·å¾—Beanå®ä¾‹ï¼Œè¿”å›å€¼ä¸ºClassç±»å‹å®ä¾‹ï¼Œæ— éœ€å¼ºè½¬</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¹æ® beanName è·å–å®¹å™¨ä¸­çš„ Bean å®ä¾‹ï¼Œéœ€è¦æ‰‹åŠ¨å¼ºè½¬</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) applicationContext.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line"><span class="comment">//æ ¹æ® Bean ç±»å‹å»å®¹å™¨ä¸­åŒ¹é…å¯¹åº”çš„ Bean å®ä¾‹ï¼Œå¦‚å­˜åœ¨å¤šä¸ªåŒ¹é… Bean åˆ™æŠ¥é”™</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService2</span> <span class="operator">=</span> applicationContext.getBean( UserService.class);</span><br><span class="line"><span class="comment">//æ ¹æ® beanName è·å–å®¹å™¨ä¸­çš„ Bean å®ä¾‹ï¼ŒæŒ‡å®š Bean çš„ Type ç±»å‹</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService3</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userService&quot;</span>,UserService.class);</span><br></pre></td></tr></table></figure><hr><h2 id="3-Spring-é…ç½®éè‡ªå®šä¹‰Bean">3. Spring é…ç½®éè‡ªå®šä¹‰Bean</h2><p>ä»¥ä¸Šåœ¨xml ä¸­é…ç½®çš„Beanéƒ½æ˜¯è‡ªå·±å®šä¹‰çš„ï¼Œä¾‹å¦‚ï¼šUserDaoImplï¼ŒUserServiceImplã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…å¼€å‘ä¸­æœ‰äº›åŠŸèƒ½ç±»å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ï¼Œè€Œæ˜¯ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹jaråŒ…ä¸­çš„ï¼Œé‚£ä¹ˆï¼Œè¿™äº›Beanè¦æƒ³è®©Springè¿›è¡Œç®¡ç†ï¼Œä¹Ÿéœ€è¦å¯¹å…¶è¿›è¡Œé…ç½®</p><p>é…ç½®éè‡ªå®šä¹‰çš„Beanéœ€è¦è€ƒè™‘å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li><span class='p green'>è¢«é…ç½®çš„Beançš„å®ä¾‹åŒ–æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿæ— å‚æ„é€ ã€æœ‰å‚æ„é€ ã€é™æ€å·¥å‚æ–¹å¼è¿˜æ˜¯å®ä¾‹å·¥å‚æ–¹å¼ï¼›</span></li><li><span class='p green'>è¢«é…ç½®çš„Beanæ˜¯å¦éœ€è¦æ³¨å…¥å¿…è¦å±æ€§ã€‚</span></li></ul><div class="tabs" id="55b8c86c-f110-454d-be11-14d2cb2cbed3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#55b8c86c-f110-454d-be11-14d2cb2cbed3-1"><i class="fas fa-cat"></i>1</button></li><li class="tab"><button type="button" data-href="#55b8c86c-f110-454d-be11-14d2cb2cbed3-2"><i class="fas fa-horse"></i>2</button></li><li class="tab"><button type="button" data-href="#55b8c86c-f110-454d-be11-14d2cb2cbed3-3"><i class="fas fa-dove"></i>3</button></li><li class="tab"><button type="button" data-href="#55b8c86c-f110-454d-be11-14d2cb2cbed3-4"><i class="fas fa-dragon"></i>4</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="55b8c86c-f110-454d-be11-14d2cb2cbed3-1"><p>1)é…ç½® Druid æ•°æ®æºäº¤ç”±Springç®¡ç†</p><p><mark class="hl-label green">å¯¼å…¥Druidåæ ‡</mark></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mysqlé©±åŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- druidæ•°æ®æº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><mark class="hl-label blue">ä¼ ç»Ÿé…ç½®æ–¹å¼</mark></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">druidDataSource.setDriverClassName();</span><br><span class="line">druidDataSource.setUrl();</span><br><span class="line">druidDataSource.setUsername();</span><br><span class="line">druidDataSource.setPassword();</span><br></pre></td></tr></table></figure><p><mark class="hl-label green">é…ç½®DruidDataSourceäº¤ç”±Springç®¡ç†</mark></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½® DruidDataSourceæ•°æ®æº--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®å¿…è¦å±æ€§--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc://localhost:3306/mybatis&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="55b8c86c-f110-454d-be11-14d2cb2cbed3-2"><p>ä¼ ç»Ÿä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">DriverManager.getConnection(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;user&quot;</span>,<span class="string">&quot;password&quot;</span>);</span><br></pre></td></tr></table></figure><p>2)é…ç½®Connectionäº¤ç”±Springç®¡ç†</p><p>Connection çš„äº§ç”Ÿæ˜¯é€šè¿‡DriverManagerçš„é™æ€æ–¹æ³•getConnectionè·å–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨é™æ€å·¥å‚æ–¹å¼é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.Class&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;forName&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;className&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;connection&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.sql.DriverManager&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getConnection&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///mybatis&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="55b8c86c-f110-454d-be11-14d2cb2cbed3-3"><p>3)é…ç½®æ—¥æœŸå¯¹è±¡äº¤ç”±Springç®¡ç†</p><p>äº§ç”Ÿä¸€ä¸ªæŒ‡å®šæ—¥æœŸæ ¼å¼çš„å¯¹è±¡ï¼ŒåŸå§‹ä»£ç æŒ‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">currentTimeStr</span> <span class="operator">=</span> <span class="string">&quot;2023-08-27 07:20:00&quot;</span>;</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>); </span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> simpleDateFormat.parse(currentTimeStr);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹æˆæ˜¯å®ä¾‹å·¥å‚æ–¹å¼ï¼Œä½¿ç”¨Springé…ç½®æ–¹å¼äº§ç”ŸDateå®ä¾‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;simpleDateFormat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.text.SimpleDateFormat&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;date&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;simpleDateFormat&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;parse&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2023-08-27 07:20:00&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="55b8c86c-f110-454d-be11-14d2cb2cbed3-4"><p>4)é…ç½®MyBatisçš„SqlSessionFactoryäº¤ç”±Springç®¡ç†</p><p><mark class="hl-label green">å¯¼å…¥MyBatisçš„ç›¸å…³åæ ‡</mark></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatisæ¡†æ¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mysqlé©±åŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><mark class="hl-label green">MyBatisåŸå§‹è·å¾—SqlSessionFactoryçš„æ–¹å¼</mark></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨Springé™æ€å·¥å‚æ–¹å¼</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Resources.getResourceAsStream(â€œmybatis-conifg.xmlâ€); </span><br><span class="line"><span class="comment">//åˆ›å»ºSqlSessionFactoryBuilderå¯¹è±¡ï¼Œä½¿ç”¨Springæ— å‚æ„é€ æ–¹å¼</span></span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="comment">//è°ƒç”¨SqlSessionFactoryBuilderçš„buildæ–¹æ³•ï¼Œä½¿ç”¨Springå®ä¾‹å·¥å‚æ–¹å¼</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> builder.build(in);</span><br></pre></td></tr></table></figure><p><mark class="hl-label green">SqlSessionFactoryäº¤ç”±Springç®¡ç†é…ç½®å¦‚ä¸‹</mark></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é™æ€å·¥å‚æ–¹å¼äº§ç”ŸBeanå®ä¾‹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">â€œinputStreamâ€</span> <span class="attr">class</span>=<span class="string">â€œorg.apache.ibatis.io.Resourcesâ€</span> <span class="attr">factory-method</span>=<span class="string">â€œgetResourceAsStreamâ€</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">â€œresourceâ€</span> <span class="attr">value</span>=<span class="string">â€œmybatis-config.xml/</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ— å‚æ„é€ æ–¹å¼äº§ç”ŸBeanå®ä¾‹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactoryBuilder&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.ibatis.session.SqlSessionFactoryBuilder&quot;</span>/&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--å®ä¾‹å·¥å‚æ–¹å¼äº§ç”ŸBeanå®ä¾‹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;sqlSessionFactoryBuilder&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;build&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;inputStream&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;inputStream&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="4-Bean-å®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹">4. Bean å®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹</h2><p>Springå®¹å™¨åœ¨è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œä¼šå°†xmlé…ç½®çš„<code>&lt;bean&gt;</code>çš„ä¿¡æ¯å°è£…æˆä¸€ä¸ª<code>BeanDefinition</code>å¯¹è±¡ï¼Œæ‰€æœ‰çš„<code>BeanDefinition</code>å­˜å‚¨åˆ°ä¸€ä¸ªåä¸º<code>beanDefinitionMap</code>çš„Mapé›†åˆä¸­å»ï¼ŒSpringæ¡†æ¶åœ¨å¯¹è¯¥Mapè¿›è¡Œéå†ï¼Œä½¿ç”¨åå°„åˆ›å»ºBeanå®ä¾‹å¯¹è±¡ï¼Œåˆ›å»ºå¥½çš„Beanå¯¹è±¡å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>singletonObjects</code>çš„Mapé›†åˆä¸­ï¼Œå½“è°ƒç”¨getBeanæ–¹æ³•æ—¶åˆ™æœ€ç»ˆä»è¯¥Mapé›†åˆä¸­å–å‡ºBeanå®ä¾‹å¯¹è±¡è¿”å›ã€‚</p><blockquote><p>Beanä¿¡æ¯å®šä¹‰å¯¹è±¡-BeanDefinition</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;&quot;</span> <span class="attr">depends-on</span>=<span class="string">&quot;&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;&quot;</span>/&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¿¡æ¯å°è£…=&gt;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanDefinition</span> <span class="keyword">extends</span> <span class="title class_">AttributeAccessor</span>, BeanMetadataElement &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">SCOPE_SINGLETON</span> <span class="operator">=</span> <span class="string">&quot;singleton&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">SCOPE_PROTOTYPE</span> <span class="operator">=</span> <span class="string">&quot;prototype&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ROLE_APPLICATION</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ROLE_SUPPORT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ROLE_INFRASTRUCTURE</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setParentName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getParentName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBeanClassName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getBeanClassName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setScope</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getScope</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setLazyInit</span><span class="params">(<span class="type">boolean</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isLazyInit</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setDependsOn</span><span class="params">(<span class="meta">@Nullable</span> String... var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String[] getDependsOn();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setAutowireCandidate</span><span class="params">(<span class="type">boolean</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAutowireCandidate</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPrimary</span><span class="params">(<span class="type">boolean</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isPrimary</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setFactoryBeanName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getFactoryBeanName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setFactoryMethodName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getFactoryMethodName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    ConstructorArgumentValues <span class="title function_">getConstructorArgumentValues</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">hasConstructorArgumentValues</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="built_in">this</span>.getConstructorArgumentValues().isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MutablePropertyValues <span class="title function_">getPropertyValues</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">hasPropertyValues</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="built_in">this</span>.getPropertyValues().isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setInitMethodName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getInitMethodName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setDestroyMethodName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getDestroyMethodName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setRole</span><span class="params">(<span class="type">int</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getRole</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    ResolvableType <span class="title function_">getResolvableType</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isPrototype</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAbstract</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getResourceDescription</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    BeanDefinition <span class="title function_">getOriginatingBeanDefinition</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>DefaultListableBeanFactoryå¯¹è±¡å†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªMapç”¨äºå­˜å‚¨å°è£…å¥½çš„BeanDefinitionMap</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSingletonBeanRegistry</span> extends ... implements ... &#123;</span><br><span class="line">    <span class="comment">//å­˜å‚¨Beanå®ä¾‹çš„å•ä¾‹æ± </span></span><br><span class="line">    <span class="comment">//key:æ˜¯Beançš„beanNameï¼Œvalue:æ˜¯Beançš„å®ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">256</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springæ¡†æ¶ä¼šå–å‡ºbeanDefinitionMapä¸­çš„æ¯ä¸ªBeanDefinitionä¿¡æ¯ï¼Œåå°„æ„é€ æ–¹æ³•æˆ–è°ƒç”¨æŒ‡å®šçš„å·¥å‚æ–¹æ³•ç”ŸæˆBeanå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥<span class='p red'>åªè¦å°†BeanDefinitionæ³¨å†Œåˆ°beanDefinitionMapè¿™ä¸ªMapä¸­ï¼ŒSpringå°±ä¼šè¿›è¡Œå¯¹åº”çš„Beançš„å®ä¾‹åŒ–æ“ä½œ</span></p><p>Beanå®ä¾‹åŠå•ä¾‹æ± singletonObjectsï¼Œ beanDefinitionMapä¸­çš„BeanDefinitionä¼šè¢«è½¬åŒ–æˆå¯¹åº”çš„Beanå®ä¾‹å¯¹è±¡ ï¼Œå­˜å‚¨åˆ°å•ä¾‹æ± singletonObjectsä¸­å»ï¼Œåœ¨DefaultListableBeanFactoryçš„ä¸Šå››çº§çˆ¶ç±»DefaultSingletonBeanRegistryä¸­ï¼Œç»´æŠ¤ç€singletonObjectsï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSingletonBeanRegistry</span> extends ... implements ... &#123;</span><br><span class="line">  <span class="comment">//å­˜å‚¨Beanå®ä¾‹çš„å•ä¾‹æ± </span></span><br><span class="line"><span class="comment">////key:æ˜¯Beançš„beanNameï¼Œvalue:æ˜¯Beançš„å®ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">256</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŠ è½½xmlé…ç½®æ–‡ä»¶ï¼Œè§£æè·å–é…ç½®ä¸­çš„æ¯ä¸ª<code>&lt;bean&gt;</code>çš„ä¿¡æ¯ï¼Œå°è£…æˆä¸€ä¸ªä¸ªçš„BeanDefinitionå¯¹è±¡;</li><li>å°†BeanDefinitionå­˜å‚¨åœ¨ä¸€ä¸ªåä¸ºbeanDefinitionMapçš„Map&lt;String,BeanDefinition&gt;ä¸­;</li><li>ApplicationContextåº•å±‚éå†beanDefinitionMapï¼Œåå°„åˆ›å»ºBeanå®ä¾‹å¯¹è±¡;</li><li>åˆ›å»ºå¥½çš„Beanå®ä¾‹å¯¹è±¡ï¼Œè¢«å­˜å‚¨åˆ°ä¸€ä¸ªåä¸ºsingletonObjectsçš„Map&lt;String,Object&gt;ä¸­;</li><li>å½“æ‰§è¡ŒapplicationContext.getBean(beanName)æ—¶ï¼Œä»singletonObjectså»åŒ¹é…Beanå®ä¾‹è¿”å›ã€‚</li></ul><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423222703341.png" alt="image-20230423222703341" style="zoom:67%;" /><hr><h2 id="5-Springçš„åå¤„ç†å™¨">5. Springçš„åå¤„ç†å™¨</h2><p>Springçš„åå¤„ç†å™¨æ˜¯Springå¯¹å¤–å¼€å‘çš„é‡è¦æ‰©å±•ç‚¹ï¼Œå…è®¸æˆ‘ä»¬ä»‹å…¥åˆ°Beançš„æ•´ä¸ªå®ä¾‹åŒ–æµç¨‹ä¸­æ¥ï¼Œä»¥è¾¾åˆ°åŠ¨æ€æ³¨å†ŒBeanDefinitionï¼ŒåŠ¨æ€ä¿®æ”¹BeanDefinitionï¼Œä»¥åŠåŠ¨æ€ä¿®æ”¹Beançš„ä½œç”¨ã€‚Springä¸»è¦æœ‰ä¸¤ç§åå¤„ç†å™¨ï¼š</p><ul><li>BeanFactoryPostProcessorï¼šBeanå·¥å‚åå¤„ç†å™¨ï¼Œåœ¨BeanDefinitionMapå¡«å……å®Œæ¯•ï¼ŒBeanå®ä¾‹åŒ–ä¹‹å‰æ‰§è¡Œï¼›</li><li>BeanPostProcessorï¼šBeanåå¤„ç†å™¨ï¼Œä¸€èˆ¬åœ¨Beanå®ä¾‹åŒ–ä¹‹åï¼Œå¡«å……åˆ°å•ä¾‹æ± singletonObjectsä¹‹å‰æ‰§è¡Œã€‚</li></ul><hr><h3 id="5-1-BeanFactoryPostProcessor">5.1 BeanFactoryPostProcessor</h3><p>BeanFactoryPostProcessoræ˜¯ä¸€ä¸ªæ¥å£è§„èŒƒï¼Œå®ç°äº†è¯¥æ¥å£çš„ç±»åªè¦äº¤ç”±Springå®¹å™¨ç®¡ç†çš„è¯ï¼Œé‚£ä¹ˆSpringå°±ä¼šå›è°ƒè¯¥æ¥å£çš„æ–¹æ³•ã€‚ç”¨äºå¯¹BeanDefinitionæ³¨å†Œå’Œä¿®æ”¹çš„åŠŸèƒ½ã€‚BeanFactoryPostProcessor å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>å®¹å™¨ä¼šæ£€æŸ¥æ¯ä¸ªbeanå®šä¹‰ï¼Œä»¥ç¡®å®šæ˜¯å¦æœ‰å®ç°<code>BeanFactoryPostProcessor</code>æ¥å£çš„ç±»ã€‚å¯¹äºå®ç°äº†<code>BeanFactoryPostProcessor</code>æ¥å£çš„beanï¼Œå®¹å™¨å°†å®ä¾‹åŒ–å®ƒä»¬å­˜å‚¨åˆ°å•ä¾‹æ± ä¸­å¹¶è°ƒç”¨å…¶<code>postProcessBeanFactory()</code>æ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>BeanFactoryPostProcessor</code>çš„å®ä¾‹åŒ–å’Œæ‰§è¡Œä¼šåœ¨å…¶ä»–æ™®é€šbeanå®ä¾‹åŒ–ä¹‹å‰å®Œæˆã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><mark class="hl-label blue">ç¼–å†™BeanFactoryPostProcessor</mark> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyBeanFactoryPostProcessoræ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><mark class="hl-label blue">é…ç½®BeanFactoryPostProcessor</mark> <p><code>&lt;bean class=&quot;com.itheima.processor.MyBeanFactoryPostProcessor&quot;/&gt;</code></p><p>postProcessBeanFactoryå‚æ•°æœ¬è´¨å°±æ˜¯DefaultListableBeanFactoryï¼Œæ‹¿åˆ°BeanFactoryçš„å¼•ç”¨ï¼Œè‡ªç„¶å°±å¯ä»¥å¯¹beanDefinitionMapä¸­çš„BeanDefinitionè¿›è¡Œæ“ä½œäº†ï¼Œä¾‹å¦‚å¯¹UserDaoImplçš„BeanDefinitionè¿›è¡Œä¿®æ”¹æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">userDaoBD</span> <span class="operator">=</span> beanFactory.getBeanDefinition(â€œuserDaoâ€);<span class="comment">//è·å¾—UserDaoå®šä¹‰å¯¹è±¡</span></span><br><span class="line">        userDaoBD.setBeanClassName(<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl2&quot;</span>); <span class="comment">//ä¿®æ”¹class</span></span><br><span class="line">        <span class="comment">//userDaoBD.setInitMethodName(methodName); //ä¿®æ”¹åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">        <span class="comment">//userDaoBD.setLazyInit(true); //ä¿®æ”¹æ˜¯å¦æ‡’åŠ è½½</span></span><br><span class="line">        <span class="comment">//... çœç•¥å…¶ä»–çš„è®¾ç½®æ–¹å¼ ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å·²ç»å¯¹æŒ‡å®šçš„BeanDefinitionè¿›è¡Œäº†ä¿®æ”¹æ“ä½œï¼Œä¸‹é¢å¯¹BeanDefiitionè¿›è¡Œæ³¨å†Œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">//å¼ºè½¬æˆå­ç±»DefaultListableBeanFactory</span></span><br><span class="line">        <span class="keyword">if</span> (configurableListableBeanFactory <span class="keyword">instanceof</span> DefaultListableBeanFactory) &#123;</span><br><span class="line">            <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> (DefaultListableBeanFactory) configurableListableBeanFactory;</span><br><span class="line">            <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">            beanDefinition.setBeanClassName(<span class="string">&quot;com.itheima.dao.UserDaoImpl2&quot;</span>);</span><br><span class="line">            <span class="comment">//è¿›è¡Œæ³¨å†Œæ“ä½œ</span></span><br><span class="line">            beanFactory.registerBeanDefinition(<span class="string">&quot;userDao2&quot;</span>, beanDefinition);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring æä¾›äº†ä¸€ä¸ªBeanFactoryPostProcessorçš„å­æ¥å£BeanDefinitionRegistryPostProcessorä¸“é—¨ç”¨äºæ³¨å†ŒBeanDefinitionæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor2</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry beanDefinitionRegistry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">        beanDefinition.setBeanClassName(<span class="string">&quot;com.itheima.dao.UserDaoImpl2&quot;</span>);</span><br><span class="line">        beanDefinitionRegistry.registerBeanDefinition(<span class="string">&quot;userDao2&quot;</span>,beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424215830258.png" alt="image-20230424215830258" style="zoom:67%;" /><p>BeanFactoryPostProcessoråœ¨SpringBeançš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­çš„ä½“ç°</p><blockquote><p>æ¡ˆä¾‹ï¼šä½¿ç”¨Springçš„BeanFactoryPostProcessoræ‰©å±•ç‚¹å®Œæˆè‡ªå®šä¹‰æ³¨è§£æ‰«æ</p></blockquote><div class="tabs" id="7dacba6b-844c-4cf2-9dca-00983f8d5747"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7dacba6b-844c-4cf2-9dca-00983f8d5747-1"><i class="fas fa-cat"></i>è¦æ±‚</button></li><li class="tab"><button type="button" data-href="#7dacba6b-844c-4cf2-9dca-00983f8d5747-2"><i class="fas fa-horse"></i>BaseClassScanUtils</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7dacba6b-844c-4cf2-9dca-00983f8d5747-1"><p>è¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li>è‡ªå®šä¹‰@MyComponentæ³¨è§£ï¼Œä½¿ç”¨åœ¨ç±»ä¸Šï¼›</li><li>ä½¿ç”¨èµ„æ–™ä¸­æä¾›å¥½çš„æ‰«æå™¨å·¥å…·BaseClassScanUtils å®ŒæˆæŒ‡å®šåŒ…çš„ç±»æ‰«æï¼›</li><li>è‡ªå®šä¹‰BeanFactoryPostProcessorå®Œæˆæ³¨è§£@MyComponentçš„è§£æï¼Œè§£æåæœ€ç»ˆè¢«Springç®¡ç†ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7dacba6b-844c-4cf2-9dca-00983f8d5747-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.classreading.CachingMetadataReaderFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.classreading.MetadataReader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.classreading.MetadataReaderFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ClassUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseClassScanUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®èµ„æºè§„åˆ™</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RESOURCE_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;//.class&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Class&gt; <span class="title function_">scanMyComponentAnnotation</span><span class="params">(String basePackage)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºå®¹å™¨å­˜å‚¨ä½¿ç”¨äº†æŒ‡å®šæ³¨è§£çš„Beanå­—èŠ‚ç å¯¹è±¡</span></span><br><span class="line">        Map&lt;String, Class&gt; annotationClassMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Class&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//springå·¥å…·ç±»ï¼Œå¯ä»¥è·å–æŒ‡å®šè·¯å¾„ä¸‹çš„å…¨éƒ¨ç±»</span></span><br><span class="line">        <span class="type">ResourcePatternResolver</span> <span class="variable">resourcePatternResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">pattern</span> <span class="operator">=</span> ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +</span><br><span class="line">                    ClassUtils.convertClassNameToResourcePath(basePackage) + RESOURCE_PATTERN;</span><br><span class="line">            Resource[] resources = resourcePatternResolver.getResources(pattern);</span><br><span class="line">            <span class="comment">//MetadataReader çš„å·¥å‚ç±»</span></span><br><span class="line">            <span class="type">MetadataReaderFactory</span> <span class="variable">refractory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CachingMetadataReaderFactory</span>(resourcePatternResolver);</span><br><span class="line">            <span class="keyword">for</span> (Resource resource : resources) &#123;</span><br><span class="line">                <span class="comment">//ç”¨äºè¯»å–ç±»ä¿¡æ¯</span></span><br><span class="line">                <span class="type">MetadataReader</span> <span class="variable">reader</span> <span class="operator">=</span> refractory.getMetadataReader(resource);</span><br><span class="line">                <span class="comment">//æ‰«æåˆ°çš„class</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">classname</span> <span class="operator">=</span> reader.getClassMetadata().getClassName();</span><br><span class="line">                Class&lt;?&gt; clazz = Class.forName(classname);</span><br><span class="line">                <span class="comment">//åˆ¤æ–­æ˜¯å¦å±äºæŒ‡å®šçš„æ³¨è§£ç±»å‹</span></span><br><span class="line">                <span class="keyword">if</span>(clazz.isAnnotationPresent(MyComponent.class))&#123;</span><br><span class="line">                    <span class="comment">//è·å¾—æ³¨è§£å¯¹è±¡</span></span><br><span class="line">                    <span class="type">MyComponent</span> <span class="variable">annotation</span> <span class="operator">=</span> clazz.getAnnotation(MyComponent.class);</span><br><span class="line">                    <span class="comment">//è·å¾—å±valueå±æ€§å€¼</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> annotation.value();</span><br><span class="line">                    <span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸º&quot;&quot;</span></span><br><span class="line">                    <span class="keyword">if</span>(beanName!=<span class="literal">null</span>&amp;&amp;!beanName.equals(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">                        <span class="comment">//å­˜å‚¨åˆ°Mapä¸­å»</span></span><br><span class="line">                        annotationClassMap.put(beanName,clazz);</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//å¦‚æœæ²¡æœ‰ä¸º&quot;&quot;,é‚£å°±æŠŠå½“å‰ç±»çš„ç±»åä½œä¸ºbeanName</span></span><br><span class="line">                    annotationClassMap.put(clazz.getSimpleName(),clazz);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> annotationClassMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Class&gt; stringClassMap = scanMyComponentAnnotation(<span class="string">&quot;com.itheima&quot;</span>);</span><br><span class="line">        System.out.println(stringClassMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>è‡ªå®šä¹‰@MyComponentæ³¨è§£ï¼Œä½¿ç”¨åœ¨ç±»ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyComponent &#123;</span><br><span class="line">  <span class="comment">//æ˜¾ç¤ºçš„æŒ‡å®šBeançš„beanName</span></span><br><span class="line">String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç±»ä¸Šä½¿ç”¨@MyComponent</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyComponent(&quot;otherBean&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtherBean</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰BeanFactoryPostProcessorå®Œæˆæ³¨è§£è§£æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    <span class="comment">//æŒ‡å®šè¦æ‰«æçš„åŒ…</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">basePackage</span> <span class="operator">=</span> <span class="string">&quot;com.itheima&quot;</span>;</span><br><span class="line">    <span class="comment">//è°ƒç”¨æ‰«æå·¥å…·æ‰«ææŒ‡å®šåŒ…åŠå…¶å­åŒ…ä¸‹çš„@MyComponent</span></span><br><span class="line">    Map&lt;String, Class&gt; myComponentClassMap = BaseClassScanUtils.scanMyComponentAnnotation(basePackage);</span><br><span class="line">    <span class="comment">//éå†Mapé›†åˆï¼Œåˆ›å»ºBeanDefinitionå¯¹è±¡è¿›è¡Œæ³¨å†Œ</span></span><br><span class="line">    myComponentClassMap.forEach((beanName,clazz)-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">            beanDefinition.setBeanClassName(clazz.getName());</span><br><span class="line">            registry.registerBeanDefinition(beanName,beanDefinition);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="5-2-BeanPostProcessor">5.2 BeanPostProcessor</h3><p>Beanè¢«å®ä¾‹åŒ–åï¼Œåˆ°æœ€ç»ˆç¼“å­˜åˆ°åä¸ºsingletonObjectså•ä¾‹æ± ä¹‹å‰ï¼Œä¸­é—´ä¼šç»è¿‡Beançš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼šå±æ€§çš„å¡«å……ã€åˆå§‹æ–¹æ³•initçš„æ‰§è¡Œç­‰ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¯¹å¤–è¿›è¡Œæ‰©å±•çš„ç‚¹BeanPostProcessorï¼Œæˆ‘ä»¬ç§°ä¸º<code>Beanåå¤„ç†å™¨</code>ã€‚è·Ÿä¸Šé¢çš„<code>Beanå·¥å‚åå¤„ç†å™¨</code>ç›¸ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ç°äº†è¯¥æ¥å£å¹¶è¢«å®¹å™¨ç®¡ç†çš„BeanPostProcessorï¼Œä¼šåœ¨æµç¨‹èŠ‚ç‚¹ä¸Šè¢«Springè‡ªåŠ¨è°ƒç”¨ã€‚</p><p>BeanPostProcessorçš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="comment">//åœ¨å±æ€§æ³¨å…¥å®Œæ¯•ï¼Œinitåˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œä¹‹å‰è¢«å›è°ƒ</span></span><br><span class="line">    <span class="keyword">default</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="comment">//åœ¨åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œè¢«æ·»åŠ åˆ°å•ä¾‹æ± singletonObjectsä¹‹å‰è¢«å›è°ƒ</span></span><br><span class="line">    <span class="keyword">default</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tabs" id="58f502e6-72ed-483a-970c-d5e3ccc5138f"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#58f502e6-72ed-483a-970c-d5e3ccc5138f-1"><i class="fas fa-bug"></i>è‡ªå®šä¹‰MyBeanPostProcessor</button></li><li class="tab"><button type="button" data-href="#58f502e6-72ed-483a-970c-d5e3ccc5138f-2"><i class="fas fa-cannabis"></i>bean</button></li><li class="tab"><button type="button" data-href="#58f502e6-72ed-483a-970c-d5e3ccc5138f-3"><i class="fas fa-candy-cane"></i>é…ç½®MyBeanPostProcessorå’Œbean</button></li><li class="tab"><button type="button" data-href="#58f502e6-72ed-483a-970c-d5e3ccc5138f-4"><i class="fas fa-child"></i>è¾“å‡º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="58f502e6-72ed-483a-970c-d5e3ccc5138f-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="comment">//å‚æ•°ï¼š beanæ˜¯å½“å‰è¢«å®ä¾‹åŒ–çš„Beanï¼ŒbeanNameæ˜¯å½“å‰Beanå®ä¾‹åœ¨å®¹å™¨ä¸­çš„åç§°è¿”å›å€¼ï¼šå½“å‰Beanå®ä¾‹å¯¹è±¡ </span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanPostProcessorçš„beforeæ–¹æ³•...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‚æ•°ï¼š beanæ˜¯å½“å‰è¢«å®ä¾‹åŒ–çš„Beanï¼ŒbeanNameæ˜¯å½“å‰Beanå®ä¾‹åœ¨å®¹å™¨ä¸­çš„åç§°è¿”å›å€¼ï¼šå½“å‰Beanå®ä¾‹å¯¹è±¡ </span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanPostProcessorçš„afteræ–¹æ³•...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="58f502e6-72ed-483a-970c-d5e3ccc5138f-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>, InitializingBean &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;userDaoåˆ›å»º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;initåˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å±æ€§è®¾ç½®ä¹‹åæ‰§è¡Œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="58f502e6-72ed-483a-970c-d5e3ccc5138f-3"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.processor.MyBeanPostProcessor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="58f502e6-72ed-483a-970c-d5e3ccc5138f-4"><p>æµ‹è¯•æ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UserDaoImplåˆ›å»ºäº†... </span><br><span class="line">BeanPostProcessorçš„beforeæ–¹æ³•... </span><br><span class="line">UserDaoImplå±æ€§å¡«å……...</span><br><span class="line">UserDaoImplåˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œ...</span><br><span class="line">BeanPostProcessorçš„afteræ–¹æ³•...</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>æ¡ˆä¾‹ï¼šå¯¹Beanæ–¹æ³•è¿›è¡Œæ‰§è¡Œæ—¶é—´æ—¥å¿—å¢å¼º</p></blockquote><div class="tabs" id="614a8299-edfc-4f4b-84ad-56c9e3409235"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#614a8299-edfc-4f4b-84ad-56c9e3409235-1"><i class="fas fa-cat"></i>è¦æ±‚</button></li><li class="tab"><button type="button" data-href="#614a8299-edfc-4f4b-84ad-56c9e3409235-2"><i class="fas fa-horse"></i>åˆ†æ</button></li><li class="tab"><button type="button" data-href="#614a8299-edfc-4f4b-84ad-56c9e3409235-3"><i class="fas fa-dove"></i>å®ç°</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="614a8299-edfc-4f4b-84ad-56c9e3409235-1"><p>è¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li>Beançš„æ–¹æ³•æ‰§è¡Œä¹‹å‰æ§åˆ¶å°æ‰“å°å½“å‰æ—¶é—´ï¼›</li><li>Beançš„æ–¹æ³•æ‰§è¡Œä¹‹åæ§åˆ¶å°æ‰“å°å½“å‰æ—¶é—´ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="614a8299-edfc-4f4b-84ad-56c9e3409235-2"><p>åˆ†æï¼š</p><ul><li>å¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºä¸»è¦å°±æ˜¯ä»£ç†è®¾è®¡æ¨¡å¼å’ŒåŒ…è£…è®¾è®¡æ¨¡å¼ï¼›</li><li>ç”±äºBeanæ–¹æ³•ä¸ç¡®å®šï¼Œæ‰€ä»¥ä½¿ç”¨åŠ¨æ€ä»£ç†åœ¨è¿è¡ŒæœŸé—´æ‰§è¡Œå¢å¼ºæ“ä½œï¼›</li><li>åœ¨Beanå®ä¾‹åˆ›å»ºå®Œæ¯•åï¼Œè¿›å…¥åˆ°å•ä¾‹æ± ä¹‹å‰ï¼Œä½¿ç”¨Proxyä»£æ›¿çœŸæ˜¯çš„ç›®æ ‡Bean</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="614a8299-edfc-4f4b-84ad-56c9e3409235-3"><p>ç¼–å†™BeanPostProcessorï¼Œå¢å¼ºé€»è¾‘ç¼–å†™åœ¨afteræ–¹æ³•ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeLogBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨åŠ¨æ€ä»£ç†å¯¹ç›®æ ‡Beanè¿›è¡Œå¢å¼ºï¼Œè¿”å›proxyå¯¹è±¡ï¼Œè¿›è€Œå­˜å‚¨åˆ°å•ä¾‹æ± singletonObjectsä¸­</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">beanProxy</span> <span class="operator">=</span> Proxy.newProxyInstance(</span><br><span class="line">                bean.getClass().getClassLoader(),</span><br><span class="line">                bean.getClass().getInterfaces(),</span><br><span class="line">                (proxy, method, args) -&gt; &#123;</span><br><span class="line">                    <span class="comment">//1ã€è¾“å‡ºå¼€å§‹æ—¶é—´</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–¹æ³•ï¼š&quot;</span> + method.getName() + <span class="string">&quot;-å¼€å§‹æ—¶é—´ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                    <span class="comment">//2ã€æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(bean, args);</span><br><span class="line">                    <span class="comment">//3ã€è¾“å‡ºç»“æŸæ—¶é—´</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–¹æ³•ï¼š&quot;</span> + method.getName() + <span class="string">&quot;-ç»“æŸæ—¶é—´ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> beanProxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®åˆ°spring</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.processor.TimeLogBeanPostProcessor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425091408067.png" alt="image-20230425091408067" style="zoom:67%;" /><p>BeanPostProcessor åœ¨ SpringBeançš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­çš„ä½“ç°</p><hr><h2 id="6-Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ">6. Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</h2><p>Spring Beançš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä» Bean å®ä¾‹åŒ–ä¹‹åï¼Œå³é€šè¿‡åå°„åˆ›å»ºå‡ºå¯¹è±¡ä¹‹åï¼Œåˆ°Beanæˆä¸ºä¸€ä¸ªå®Œæ•´å¯¹è±¡ï¼Œæœ€ç»ˆå­˜å‚¨åˆ°å•ä¾‹æ± ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºSpring Beançš„ç”Ÿå‘½å‘¨æœŸã€‚Spring Beançš„ç”Ÿå‘½å‘¨æœŸå¤§ä½“ä¸Šåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>Beançš„å®ä¾‹åŒ–é˜¶æ®µï¼šSpringæ¡†æ¶ä¼šå–å‡ºBeanDefinitionçš„ä¿¡æ¯è¿›è¡Œåˆ¤æ–­å½“å‰Beançš„èŒƒå›´æ˜¯å¦æ˜¯singletonçš„ï¼Œæ˜¯å¦ä¸æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œæ˜¯å¦ä¸æ˜¯FactoryBeanç­‰ï¼Œæœ€ç»ˆå°†ä¸€ä¸ªæ™®é€šçš„singletonçš„Beané€šè¿‡åå°„è¿›è¡Œå®ä¾‹åŒ–ï¼›</li><li>Beançš„åˆå§‹åŒ–é˜¶æ®µï¼šBeanåˆ›å»ºä¹‹åè¿˜ä»…ä»…æ˜¯ä¸ª&quot;åŠæˆå“&quot;ï¼Œè¿˜éœ€è¦å¯¹Beanå®ä¾‹çš„å±æ€§è¿›è¡Œå¡«å……ã€æ‰§è¡Œä¸€äº›Awareæ¥å£æ–¹æ³•ã€æ‰§è¡ŒBeanPostProcessoræ–¹æ³•ã€æ‰§è¡ŒInitializingBeanæ¥å£çš„åˆå§‹åŒ–æ–¹æ³•ã€æ‰§è¡Œè‡ªå®šä¹‰åˆå§‹åŒ–initæ–¹æ³•ç­‰ã€‚è¯¥é˜¶æ®µæ˜¯Springæœ€å…·æŠ€æœ¯å«é‡å’Œå¤æ‚åº¦çš„é˜¶æ®µï¼ŒAopå¢å¼ºåŠŸèƒ½ï¼Œåé¢è¦å­¦ä¹ çš„Springçš„æ³¨è§£åŠŸèƒ½ç­‰ã€ springé«˜é¢‘é¢è¯•é¢˜Beançš„å¾ªç¯å¼•ç”¨é—®é¢˜éƒ½æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µä½“ç°çš„ï¼›</li><li>Beançš„å®Œæˆé˜¶æ®µï¼šç»è¿‡åˆå§‹åŒ–é˜¶æ®µï¼ŒBeanå°±æˆä¸ºäº†ä¸€ä¸ªå®Œæ•´çš„Spring Beanï¼Œè¢«å­˜å‚¨åˆ°å•ä¾‹æ± singletonObjectsä¸­å»äº†ï¼Œå³å®Œæˆäº†Spring Beançš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</li></ul><p>ç”±äºBeançš„åˆå§‹åŒ–é˜¶æ®µçš„æ­¥éª¤æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥ç€é‡ç ”ç©¶Beançš„åˆå§‹åŒ–é˜¶æ®µSpring Beançš„åˆå§‹åŒ–è¿‡ç¨‹æ¶‰åŠå¦‚ä¸‹å‡ ä¸ªè¿‡ç¨‹ï¼š</p><ul><li>Beanå®ä¾‹çš„å±æ€§å¡«å……</li><li>Awareæ¥å£å±æ€§æ³¨å…¥</li><li>BeanPostProcessorçš„before()æ–¹æ³•å›è°ƒ</li><li>InitializingBeanæ¥å£çš„åˆå§‹åŒ–æ–¹æ³•å›è°ƒ</li><li>è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•initå›è°ƒ</li><li>BeanPostProcessorçš„after()æ–¹æ³•å›è°ƒ</li></ul><p>BeanDefinition ä¸­æœ‰å¯¹å½“å‰Beanå®ä½“çš„æ³¨å…¥ä¿¡æ¯é€šè¿‡å±æ€§propertyValuesè¿›è¡Œäº†å­˜å‚¨ï¼Œä¾‹å¦‚UserServiceçš„å±æ€§ä¿¡æ¯å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423231423474.png" alt="image-20230423231423474" style="zoom:67%;" /><p>Springåœ¨è¿›è¡Œå±æ€§æ³¨å…¥æ—¶ï¼Œä¼šåˆ†ä¸ºå¦‚ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>æ³¨å…¥æ™®é€šå±æ€§ï¼ŒStringã€intæˆ–å­˜å‚¨åŸºæœ¬ç±»å‹çš„é›†åˆæ—¶ï¼Œç›´æ¥é€šè¿‡setæ–¹æ³•çš„åå°„è®¾ç½®è¿›å»ï¼›</li><li>æ³¨å…¥å•å‘å¯¹è±¡å¼•ç”¨å±æ€§æ—¶ï¼Œä»å®¹å™¨ä¸­getBeanè·å–åé€šè¿‡setæ–¹æ³•åå°„è®¾ç½®è¿›å»ï¼Œå¦‚æœå®¹å™¨ä¸­æ²¡æœ‰ï¼Œåˆ™å…ˆåˆ›å»ºè¢«æ³¨å…¥å¯¹è±¡Beanå®ä¾‹ï¼ˆå®Œæˆæ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼‰åï¼Œåœ¨è¿›è¡Œæ³¨å…¥æ“ä½œï¼›</li><li>æ³¨å…¥åŒå‘å¯¹è±¡å¼•ç”¨å±æ€§æ—¶ï¼Œå°±æ¯”è¾ƒå¤æ‚äº†ï¼Œæ¶‰åŠäº†å¾ªç¯å¼•ç”¨ï¼ˆå¾ªç¯ä¾èµ–ï¼‰é—®é¢˜ï¼Œä¸‹é¢ä¼šè¯¦ç»†é˜è¿°è§£å†³æ–¹æ¡ˆã€‚</li></ul><p>å¤šä¸ªå®ä½“ä¹‹é—´ç›¸äº’ä¾èµ–å¹¶å½¢æˆé—­ç¯çš„æƒ…å†µå°±å«åš&quot;å¾ªç¯ä¾èµ–&quot;ï¼Œä¹Ÿå«åš&quot;å¾ªç¯å¼•ç”¨&quot;</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424094314831.png" alt="image-20230424094314831" style="zoom: 50%" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(UserService userService)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;userService&quot;</span> ref=<span class="string">&quot;userService&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>ä»£ç éªŒè¯åï¼Œåˆ†æå‡ºUserServiceä¸UserDaoå®ä¾‹åŒ–ä¸åˆå§‹åŒ–çš„é¡ºåºå¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425094829935.png" alt="image-20230425094829935" style="zoom: 50%;" /><p>Springæä¾›äº†<span class='p red'>ä¸‰çº§ç¼“å­˜</span>å­˜å‚¨<code>å®Œæ•´Beanå®ä¾‹</code>å’Œ<code>åŠæˆå“Beanå®ä¾‹</code> ï¼Œç”¨äºè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜<br>åœ¨DefaultListableBeanFactoryçš„ä¸Šå››çº§çˆ¶ç±»DefaultSingletonBeanRegistryä¸­æä¾›å¦‚ä¸‹ä¸‰ä¸ªMapï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSingletonBeanRegistry</span> ... &#123;</span><br><span class="line">        <span class="comment">//1ã€æœ€ç»ˆå­˜å‚¨å•ä¾‹Beanæˆå“çš„å®¹å™¨ï¼Œå³å®ä¾‹åŒ–å’Œåˆå§‹åŒ–éƒ½å®Œæˆçš„Beanï¼Œç§°ä¹‹ä¸º&quot;ä¸€çº§ç¼“å­˜&quot;</span></span><br><span class="line">        Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">256</span>);</span><br><span class="line">        <span class="comment">//2ã€æ—©æœŸBeanå•ä¾‹æ± ï¼Œç¼“å­˜åŠæˆå“å¯¹è±¡ï¼Œä¸”å½“å‰å¯¹è±¡å·²ç»è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨äº†ï¼Œç§°ä¹‹ä¸º&quot;äºŒçº§ç¼“å­˜&quot;</span></span><br><span class="line">        Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="comment">//3ã€å•ä¾‹Beançš„å·¥å‚æ± ï¼Œç¼“å­˜åŠæˆå“å¯¹è±¡ï¼Œå¯¹è±¡æœªè¢«å¼•ç”¨ï¼Œä½¿ç”¨æ—¶åœ¨é€šè¿‡å·¥å‚åˆ›å»ºBeanï¼Œç§°ä¹‹ä¸º&quot;ä¸‰çº§ç¼“å­˜&quot;</span></span><br><span class="line">        Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceå’ŒUserDaoå¾ªç¯ä¾èµ–çš„è¿‡ç¨‹ç»“åˆä¸Šè¿°ä¸‰çº§ç¼“å­˜æè¿°ä¸€ä¸‹:</p><ul><li>UserService å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†å°šæœªåˆå§‹åŒ–ï¼Œå°†UserServiceå­˜å‚¨åˆ°ä¸‰çº§ç¼“å­˜ï¼›</li><li>UserService å±æ€§æ³¨å…¥ï¼Œéœ€è¦UserDaoï¼Œä»ç¼“å­˜ä¸­è·å–ï¼Œæ²¡æœ‰UserDaoï¼›</li><li>UserDaoå®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†å°šæœªåˆå§‹åŒ–ï¼Œå°†UserDaoå­˜å‚¨åˆ°åˆ°ä¸‰çº§ç¼“å­˜ï¼›</li><li>UserDaoå±æ€§æ³¨å…¥ï¼Œéœ€è¦UserServiceï¼Œä»ä¸‰çº§ç¼“å­˜è·å–UserServiceï¼ŒUserServiceä»ä¸‰çº§ç¼“å­˜ç§»å…¥äºŒçº§ç¼“å­˜ï¼›</li><li>UserDaoæ‰§è¡Œå…¶ä»–ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ï¼Œæœ€ç»ˆæˆä¸ºä¸€ä¸ªå®ŒæˆBeanï¼Œå­˜å‚¨åˆ°ä¸€çº§ç¼“å­˜ï¼Œåˆ é™¤äºŒä¸‰çº§ç¼“å­˜ï¼›</li><li>UserService æ³¨å…¥UserDaoï¼›</li><li>UserServiceæ‰§è¡Œå…¶ä»–ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ï¼Œæœ€ç»ˆæˆä¸ºä¸€ä¸ªå®ŒæˆBeanï¼Œå­˜å‚¨åˆ°ä¸€çº§ç¼“å­˜ï¼Œåˆ é™¤äºŒä¸‰çº§ç¼“å­˜</li></ul><mark class="hl-label blue">å¾ªç¯å¼•ç”¨æ‰§è¡Œæµç¨‹</mark> <div class="tabs" id="dbb1608a-78e1-4a08-8a89-ba25d12d8d9b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-1"><i class="fas fa-atom"></i>1</button></li><li class="tab"><button type="button" data-href="#dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-2"><i class="far fa-sun"></i>2</button></li><li class="tab"><button type="button" data-href="#dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-3"><i class="fas fa-wind"></i>3</button></li><li class="tab"><button type="button" data-href="#dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-4"><i class="fas fa-fire-alt"></i>4</button></li><li class="tab"><button type="button" data-href="#dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-5"><i class="fas fa-cookie-bite"></i>æºç æµç¨‹å›¾</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-1"><p>â‘  é¦–å…ˆåˆ›å»ºuserServiceï¼Œåˆ›å»ºå®Œæ¯•åå­˜å…¥åˆ°ä¸‰çº§ç¼“å­˜ä¸­â‘¡éœ€è¦userDaoï¼Œä»ä¸‰çº§ç¼“å­˜ä¸­å¯»æ‰¾ï¼Œæ²¡æœ‰ï¼Œæ‰§è¡ŒDaoçš„åˆ›å»º</p><p>â‘¢åˆ›å»ºuserDaoï¼Œåˆ›å»ºå®Œæ¯•åå­˜å…¥åˆ°ä¸‰çº§ç¼“å­˜ä¸­</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425095416327.png" alt="image-20230425095416327" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-2"><p>â‘£userdDaoåˆå§‹åŒ–ï¼Œéœ€è¦æ³¨å…¥userServiceã€‚â‘¤ä»ä¸€çº§äºŒçº§ä¸‰çº§ç¼“å­˜ä¸­è·å–userServiceï¼Œå¹¶è®¾ç½®ç»™userDaoã€‚</p><p>â‘¥å°†userServiceä»ä¸‰çº§ç¼“å­˜ä¸­åˆ é™¤ï¼Œå­˜å‚¨åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425095909615.png" alt="image-20230425095909615" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-3"><p>â‘¦æ‰§è¡ŒuserDaoçš„å…¶ä»–åˆå§‹åŒ–æµç¨‹ã€‚â‘§æ‰§è¡Œå®Œæ¯•ï¼Œå°†userDaoä»ä¸‰çº§ç¼“å­˜ä¸­åˆ é™¤ï¼Œå­˜å‚¨åˆ°ä¸€çº§ç¼“å­˜ä¸­</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425100228892.png" alt="image-20230425100228892" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-4"><p>â‘¨å›æº¯åˆ°åˆ›å»ºuserServiceåˆ›å»ºè¿‡ç¨‹ã€‚</p><p>â‘©å°†userDaoè®¾ç½®ç»™userServiceï¼Œå…¶ä»–åˆå§‹åŒ–æµç¨‹ç»“æŸåï¼Œå°†userServiceä»äºŒçº§ç¼“å­˜ä¸­åˆ é™¤ï¼Œå­˜å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425100607480.png" alt="image-20230425100607480" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dbb1608a-78e1-4a08-8a89-ba25d12d8d9b-5"><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230425101012174.png" alt="image-20230425101012174"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>å¸¸ç”¨çš„Awareæ¥å£</p><p>Awareæ¥å£æ˜¯ä¸€ç§æ¡†æ¶è¾…åŠ©å±æ€§æ³¨å…¥çš„ä¸€ç§æ€æƒ³ï¼Œå…¶ä»–æ¡†æ¶ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„æ¥å£ã€‚æ¡†æ¶å…·å¤‡é«˜åº¦å°è£…æ€§ï¼Œæˆ‘ä»¬æ¥è§¦åˆ°çš„ä¸€èˆ¬éƒ½æ˜¯ä¸šåŠ¡ä»£ç ï¼Œä¸€ä¸ªåº•å±‚åŠŸèƒ½APIä¸èƒ½è½»æ˜“çš„è·å–åˆ°ï¼Œä½†æ˜¯è¿™ä¸æ„å‘³ç€æ°¸è¿œç”¨ä¸åˆ°è¿™äº›å¯¹è±¡ï¼Œå¦‚æœç”¨åˆ°äº†ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¡†æ¶æä¾›çš„ç±»ä¼¼Awareçš„æ¥å£ï¼Œè®©æ¡†æ¶ç»™æˆ‘ä»¬æ³¨å…¥è¯¥å¯¹è±¡ã€‚</p><table><thead><tr><th>Awareæ¥å£</th><th>å›è°ƒæ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>ServletContextAware</td><td>setServletContext(ServletContext context)</td><td>Springæ¡†æ¶å›è°ƒæ–¹æ³•æ³¨å…¥ServletContextå¯¹è±¡ï¼Œ webç¯å¢ƒä¸‹æ‰ç”Ÿæ•ˆ</td></tr><tr><td>BeanFactoryAware</td><td>setBeanFactory(BeanFactory factory)</td><td>Springæ¡†æ¶å›è°ƒæ–¹æ³•æ³¨å…¥beanFactoryå¯¹è±¡</td></tr><tr><td>BeanNameAware</td><td>setBeanName(String beanName)</td><td>Springæ¡†æ¶å›è°ƒæ–¹æ³•æ³¨å…¥beanFactoryå¯¹è±¡</td></tr><tr><td>ApplicationContextAware</td><td>setApplicationContext(ApplicationContext applicationContext)</td><td>Springæ¡†æ¶å›è°ƒæ–¹æ³•æ³¨å…¥applicationContext å¯¹è±¡</td></tr></tbody></table><hr><h2 id="7-Spring-IoCæ•´ä½“æµç¨‹æ€»ç»“">7. Spring IoCæ•´ä½“æµç¨‹æ€»ç»“</h2><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424095821127.png" alt="image-20230424095821127" style="zoom:67%;" /><hr><h2 id="8-Spring-xmlæ–¹å¼æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶">8. Spring xmlæ–¹å¼æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶</h2><p>xmlæ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶æœ‰ä¸¤ç§æ•´åˆæ–¹æ¡ˆï¼š</p><ul><li><p>ä¸éœ€è¦è‡ªå®šä¹‰åç©ºé—´ï¼Œä¸éœ€è¦ä½¿ç”¨Springçš„é…ç½®æ–‡ä»¶é…ç½®ç¬¬ä¸‰æ–¹æ¡†æ¶æœ¬èº«å†…å®¹ï¼Œä¾‹å¦‚ï¼šMyBatisï¼›</p></li><li><p>éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹æ¡†æ¶å‘½åç©ºé—´ï¼Œéœ€è¦ä½¿ç”¨Springçš„é…ç½®æ–‡ä»¶é…ç½®ç¬¬ä¸‰æ–¹æ¡†æ¶æœ¬èº«å†…å®¹ï¼Œä¾‹å¦‚ï¼šDubboã€‚</p></li></ul><hr><h3 id="8-1-Springæ•´åˆMyBatis">8.1 Springæ•´åˆMyBatis</h3><mark class="hl-label blue">åŸå§‹æ“ä½œä»£ç </mark> <p>å¯¼åŒ…ï¼šmysql-connector-javaå’Œmybatis</p><div class="tabs" id="bc92cbb3-b048-4ec6-9f44-184d564f7310"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#bc92cbb3-b048-4ec6-9f44-184d564f7310-1"><i class="fas fa-seedling"></i>åˆ›å»ºUserå’ŒuserMapper</button></li><li class="tab"><button type="button" data-href="#bc92cbb3-b048-4ec6-9f44-184d564f7310-2"><i class="fas fa-leaf"></i>åˆ›å»ºUserMapper.xmlå’Œé…ç½®æ–‡ä»¶</button></li><li class="tab"><button type="button" data-href="#bc92cbb3-b048-4ec6-9f44-184d564f7310-3"><i class="fab fa-apple"></i>æµ‹è¯•</button></li><li class="tab"><button type="button" data-href="#bc92cbb3-b048-4ec6-9f44-184d564f7310-4"><i class="fas fa-cookie-bite"></i>springéœ€è¦æ•´åˆçš„åœ°æ–¹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="bc92cbb3-b048-4ec6-9f44-184d564f7310-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bc92cbb3-b048-4ec6-9f44-184d564f7310-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from tb_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>mybatis-config.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itheima.mapper&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bc92cbb3-b048-4ec6-9f44-184d564f7310-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> builder.build(in);</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        List&lt;User&gt; all = mapper.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : all) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bc92cbb3-b048-4ec6-9f44-184d564f7310-4"><p>spingæ•´åˆmybatiså°±æ˜¯æŠŠè¿™äº›ä»£ç å’Œé…ç½®æ–‡ä»¶æ¶ˆé™¤æ‰ï¼Œå¸®ä½ åˆ›å»ºmapper</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> MyBatisTest &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">public</span> static <span class="type">void</span> main(String[] args) throws <span class="keyword">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">      -  InputStream <span class="keyword">in</span> = Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;);</span><br><span class="line">      -  SqlSessionFactoryBuilder builder = <span class="built_in">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">      -  SqlSessionFactory sqlSessionFactory = builder.build(<span class="keyword">in</span>);</span><br><span class="line">      -  SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">      -  UserMapper mapper = sqlSession.getMapper(UserMapper.<span class="keyword">class</span>);</span><br><span class="line">        List&lt;<span class="keyword">User</span>&gt; <span class="keyword">all</span> = mapper.findAll();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">User</span> <span class="keyword">user</span> : <span class="keyword">all</span>) &#123;</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">user</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>ä¹‹å‰å·²ç»åœ¨Springä¸­ç®€å•çš„é…ç½®äº†SqlSessionFactoryï¼Œä½†æ˜¯è¿™ä¸æ˜¯æ­£è§„çš„æ•´åˆæ–¹å¼ï¼ŒMyBatisæä¾›äº†mybatis-spring.jarä¸“é—¨ç”¨äºä¸¤å¤§æ¡†æ¶çš„æ•´åˆã€‚</p><mark class="hl-label green">Springæ•´åˆMyBatis</mark> <ul><li>å¯¼å…¥MyBatisæ•´åˆSpringçš„ç›¸å…³åæ ‡ï¼›mybatis-springå’Œspring-jdbc</li><li>ç¼–å†™Mapperå’ŒMapper.xmlï¼›</li><li>é…ç½®SqlSessionFactoryBeanå’ŒMapperScannerConfigurerï¼›</li><li>ç¼–å†™æµ‹è¯•ä»£ç </li></ul><div class="tabs" id="aafffedc-d448-489f-847a-e8728eac2260"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#aafffedc-d448-489f-847a-e8728eac2260-1"><i class="fas fa-horse"></i>ç¼–å†™Mapperå’ŒMapper.xml</button></li><li class="tab"><button type="button" data-href="#aafffedc-d448-489f-847a-e8728eac2260-2"><i class="fas fa-cat"></i>é…ç½®SqlSessionFactoryBeanå’ŒMapperScannerConfigurer</button></li><li class="tab"><button type="button" data-href="#aafffedc-d448-489f-847a-e8728eac2260-3"><i class="fas fa-dove"></i>ç¼–å†™æµ‹è¯•ä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="aafffedc-d448-489f-847a-e8728eac2260-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from tb_user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aafffedc-d448-489f-847a-e8728eac2260-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®æ•°æ®æº--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®SqlSessionFactoryBeanï¼Œä½œç”¨å°†SqlSessionFactoryå­˜å‚¨åˆ°springå®¹å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®MapperScannerConfigurerï¼Œä½œç”¨æ‰«ææŒ‡å®šçš„åŒ…ï¼Œäº§ç”ŸMapperå¯¹è±¡å­˜å‚¨åˆ°springå®¹å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.itheima.dao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SqlSessionFactoryBeanå®ç°FactoryBeanæ¥å£:å‘springå®¹å™¨æä¾›SqlSessionFactory</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.spring;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;SqlSessionFactory&gt;, InitializingBean, ApplicationListener&lt;ApplicationEvent&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ç°FactoryBeanæ¥å£</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.sqlSessionFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.afterPropertiesSet();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MapperScannerConfigurerå®ç°BeanDefinitionRegistryPostProcessoræ¥å£:å¯¹mapperï¼ˆä¾‹å¦‚userMapperï¼‰è¿›è¡Œæ‰«æï¼Œå¹¶å­˜å‚¨åˆ°Springå®¹å™¨ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.mybatis.spring.mapper;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperScannerConfigurer</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span>, InitializingBean, ApplicationContextAware, BeanNameAware &#123;</span><br><span class="line">    <span class="comment">//å®ç°BeanDefinitionRegistryPostProcessoræ¥å£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.processPropertyPlaceHolders) &#123;</span><br><span class="line">            <span class="built_in">this</span>.processPropertyPlaceHolders();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">        scanner.setAddToConfig(<span class="built_in">this</span>.addToConfig);</span><br><span class="line">        scanner.setAnnotationClass(<span class="built_in">this</span>.annotationClass);</span><br><span class="line">        scanner.setMarkerInterface(<span class="built_in">this</span>.markerInterface);</span><br><span class="line">        scanner.setSqlSessionFactory(<span class="built_in">this</span>.sqlSessionFactory);</span><br><span class="line">        scanner.setSqlSessionTemplate(<span class="built_in">this</span>.sqlSessionTemplate);</span><br><span class="line">        scanner.setSqlSessionFactoryBeanName(<span class="built_in">this</span>.sqlSessionFactoryBeanName);</span><br><span class="line">        scanner.setSqlSessionTemplateBeanName(<span class="built_in">this</span>.sqlSessionTemplateBeanName);</span><br><span class="line">        scanner.setResourceLoader(<span class="built_in">this</span>.applicationContext);</span><br><span class="line">        scanner.setBeanNameGenerator(<span class="built_in">this</span>.nameGenerator);</span><br><span class="line">        scanner.setMapperFactoryBeanClass(<span class="built_in">this</span>.mapperFactoryBeanClass);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.lazyInitialization)) &#123;</span><br><span class="line">            scanner.setLazyInitialization(Boolean.valueOf(<span class="built_in">this</span>.lazyInitialization));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        scanner.registerFilters();</span><br><span class="line">        scanner.scan(StringUtils.tokenizeToStringArray(<span class="built_in">this</span>.basePackage, <span class="string">&quot;,; \t\n&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aafffedc-d448-489f-847a-e8728eac2260-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassPathxmlApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ClassPathxmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>); </span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> applicationContext.getBean(UserMapper.class); </span><br><span class="line">List&lt;User&gt; all = userMapper.findAll();</span><br><span class="line">System.out.println(all);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><mark class="hl-label blue">Springæ•´åˆMyBatisçš„åŸç†å‰–æ</mark> <p>æ•´åˆåŒ…é‡Œæä¾›äº†ä¸€ä¸ªSqlSessionFactoryBeanå’Œä¸€ä¸ªæ‰«æMapperçš„é…ç½®å¯¹è±¡ï¼ŒSqlSessionFactoryBeanä¸€æ—¦è¢«å®ä¾‹åŒ–ï¼Œå°±å¼€å§‹æ‰«æMapperå¹¶é€šè¿‡åŠ¨æ€ä»£ç†äº§ç”ŸMapperçš„å®ç°ç±»å­˜å‚¨åˆ°Springå®¹å™¨ä¸­ã€‚ç›¸å…³çš„æœ‰å¦‚ä¸‹å››ä¸ªç±»ï¼š</p><ul><li>SqlSessionFactoryBeanï¼šéœ€è¦è¿›è¡Œé…ç½®ï¼Œç”¨äºæä¾›SqlSessionFactoryï¼›</li><li>MapperScannerConfigurerï¼šéœ€è¦è¿›è¡Œé…ç½®ï¼Œç”¨äºæ‰«ææŒ‡å®šmapperæ³¨å†ŒBeanDefinitionï¼›</li><li>MapperFactoryBeanï¼šMapperçš„FactoryBeanï¼Œè·å¾—æŒ‡å®šMapperæ—¶è°ƒç”¨getObjectæ–¹æ³•ï¼›</li><li>ClassPathMapperScannerï¼šdefinition.setAutowireMode(2)  ä¿®æ”¹äº†è‡ªåŠ¨æ³¨å…¥çŠ¶æ€ï¼Œæ‰€ä»¥MapperFactoryBeanä¸­çš„setSqlSessionFactoryä¼šè‡ªåŠ¨æ³¨å…¥è¿›å»ã€‚</li></ul><p>é…ç½®SqlSessionFactoryBeanä½œç”¨æ˜¯å‘å®¹å™¨ä¸­æä¾›SqlSessionFactoryï¼ŒSqlSessionFactoryBeanå®ç°äº†FactoryBeanå’ŒInitializingBeanä¸¤ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨æ‰§è¡ŒgetObject() å’ŒafterPropertiesSet()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactoryBean <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;SqlSessionFactory&gt;, InitializingBean&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºSqlSessionFactoryå¯¹è±¡</span></span><br><span class="line">        <span class="built_in">this</span>.sqlSessionFactory = <span class="built_in">this</span>.buildSqlSessionFactory();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®MapperScannerConfigurerä½œç”¨æ˜¯æ‰«æMapperï¼Œå‘å®¹å™¨ä¸­æ³¨å†ŒMapperå¯¹åº”çš„MapperFactoryBeanï¼Œ MapperScannerConfigurerå®ç°äº†BeanDefinitionRegistryPostProcessorå’ŒInitializingBeanä¸¤ä¸ªæ¥å£ï¼Œä¼šåœ¨postProcessBeanDefinitionRegistryæ–¹æ³•ä¸­å‘å®¹å™¨ä¸­æ³¨å†ŒMapperFactoryBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MapperScannerConfigurer</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span>, InitializingBean&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">        scanner.scan(StringUtils.tokenizeToStringArray(<span class="built_in">this</span>.basePackage, <span class="string">&quot;,; \t\n&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassPathMapperScanner</span> <span class="keyword">extends</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="built_in">super</span>.doScan(basePackages);</span><br><span class="line">        <span class="keyword">if</span> (beanDefinitions.isEmpty()) &#123;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.processBeanDefinitions(beanDefinitions);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processBeanDefinitions</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; beanDefinitions)</span> &#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®Mapperçš„beanClassæ˜¯org.mybatis.spring.mapper.MapperFactoryBean</span></span><br><span class="line">        definition.setBeanClass(<span class="built_in">this</span>.mapperFactoryBeanClass);</span><br><span class="line">        definition.setAutowireMode(<span class="number">2</span>); <span class="comment">//è®¾ç½®MapperBeanFactory è¿›è¡Œè‡ªåŠ¨æ³¨å…¥</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">scan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.doScan(basePackages);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        <span class="comment">//å°†æ‰«æåˆ°çš„ç±»æ³¨å†Œåˆ°beanDefinitionMapä¸­ï¼Œæ­¤æ—¶beanClassæ˜¯å½“å‰ç±»å…¨é™å®šå</span></span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinition(definitionHolder, <span class="built_in">this</span>.registry);</span><br><span class="line">        <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> applicationContext.getBean(UserMapper.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperFactoryBean</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MapperFactoryBean</span><span class="params">(Class&lt;T&gt; mapperInterface)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mapperInterface = mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSqlSessionFactory</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sqlSessionTemplate = <span class="built_in">this</span>.createSqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getSqlSession().getMapper(<span class="built_in">this</span>.mapperInterface);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="8-2-Springæ•´åˆDubbo">8.2 Springæ•´åˆDubbo</h3><p>Spring æ•´åˆå…¶ä»–ç»„ä»¶æ—¶å°±ä¸åƒMyBatisè¿™ä¹ˆç®€å•äº†ï¼Œä¾‹å¦‚Dubboæ¡†æ¶åœ¨äºSpringè¿›è¡Œæ•´åˆæ—¶ï¼Œè¦ä½¿ç”¨Dubboæä¾›çš„å‘½åç©ºé—´çš„æ‰©å±•æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€äº›Dubboçš„æ ‡ç­¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:dubbo=<span class="string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--é…ç½®åº”ç”¨åç§°--&gt;</span><br><span class="line">    &lt;dubbo:application name=<span class="string">&quot;dubbo1-consumer&quot;</span>/&gt;</span><br><span class="line">    &lt;!--é…ç½®æ³¨å†Œä¸­å¿ƒåœ°å€--&gt;</span><br><span class="line">    &lt;dubbo:registry address=<span class="string">&quot;zookeeper://localhost:2181&quot;</span>/&gt;</span><br><span class="line">    &lt;!--æ‰«ædubboçš„æ³¨è§£--&gt;</span><br><span class="line">    &lt;dubbo:annotation <span class="keyword">package</span>=<span class="string">&quot;com.itheima.controller&quot;</span>/&gt;</span><br><span class="line">    &lt;!--æ¶ˆè´¹è€…é…ç½®--&gt;</span><br><span class="line">    &lt;dubbo:consumer check=<span class="string">&quot;false&quot;</span> timeout=<span class="string">&quot;1000&quot;</span> retries=<span class="string">&quot;0&quot;</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é™ä½æˆ‘ä»¬æ­¤å¤„çš„å­¦ä¹ æˆæœ¬ï¼Œä¸åœ¨å¼•å…¥Dubboç¬¬ä¸‰æ–¹æ¡†æ¶äº†ï¼Œä»¥Springçš„ context å‘½åç©ºé—´å»è¿›è¡Œè®²è§£ï¼Œè¯¥æ–¹å¼ä¹Ÿæ˜¯å‘½åç©ºé—´æ‰©å±•æ–¹å¼ã€‚éœ€æ±‚ï¼šåŠ è½½å¤–éƒ¨propertiesæ–‡ä»¶ï¼Œå°†é”®å€¼å¯¹å­˜å‚¨åœ¨Springå®¹å™¨ä¸­</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis </span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure><p>å¼•å…¥contextå‘½åç©ºé—´ï¼Œåœ¨ä½¿ç”¨contextå‘½åç©ºé—´çš„æ ‡ç­¾ï¼Œä½¿ç”¨SpELè¡¨è¾¾å¼åœ¨xmlæˆ–æ³¨è§£ä¸­æ ¹æ®keyè·å¾—value</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;context:property-placeholder location=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;dataSource&quot;</span> class=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>å…¶å®ï¼ŒåŠ è½½çš„propertiesæ–‡ä»¶ä¸­çš„å±æ€§æœ€ç»ˆé€šè¿‡Springè§£æåä¼šè¢«å­˜å‚¨åˆ°äº†Springå®¹å™¨çš„environmentä¸­å»ï¼Œä¸ä»…è‡ªå·±å®šä¹‰çš„å±æ€§ä¼šè¿›è¡Œå­˜å‚¨ï¼ŒSpringä¹Ÿä¼šæŠŠç¯å¢ƒç›¸å…³çš„ä¸€äº›å±æ€§è¿›è¡Œå­˜å‚¨</p><div class="fj-gallery"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424103808426.png" alt="image-20230424103808426"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424103835267.png" alt="image-20230424103835267"  />          </div><p>åŸç†å‰–æè§£æè¿‡ç¨‹ï¼Œåªèƒ½ä»æºå¤´ClassPathXmlApplicationContextå…¥æ‰‹ï¼Œç»å†å¤æ‚çš„æºç è¿½è¸ªï¼Œæ‰¾åˆ°å¦‚ä¸‹ä¸¤ä¸ªç‚¹ï¼š</p><p>1ï¼‰åœ¨åˆ›å»ºDefaultNamespaceHandlerResolveræ—¶ï¼Œä¸ºå¤„ç†å™¨æ˜ å°„åœ°å€handlerMappingsLocationå±æ€§èµ‹å€¼ï¼Œå¹¶åŠ è½½å‘½åç©ºé—´å¤„ç†å™¨åˆ°Map&lt;String, Object&gt; handlerMappings ä¸­å»</p><p><code>this.handlerMappingsLocation = &quot;META-INF/spring.handlers&quot;;</code></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424104152200.png" alt="image-20230424104152200"></p><div class="fj-gallery"><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424104205461.png" alt="image-20230424104205461"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424104216181.png" alt="image-20230424104216181"></p>          </div><p>ç¬¬ä¸€ç‚¹å®Œæˆåï¼ŒMapé›†åˆhandlerMappingså°±è¢«å¡«å……äº†å¾ˆå¤šXxxNamespaceHandlerï¼Œç»§ç»­å¾€ä¸‹è¿½ä»£ç </p><p>2ï¼‰åœ¨DefaultBeanDefinitionDocumentReaderçš„parseBeanDefinitionsæ–¹æ³•ä¸­ï¼Œå‘ç°å¦‚ä¸‹é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœæ˜¯é»˜è®¤å‘½åç©ºé—´</span></span><br><span class="line"><span class="keyword">if</span> (delegate.isDefaultNamespace(ele))&#123;</span><br><span class="line">    <span class="built_in">this</span>.parseDefaultElement(ele, delegate);</span><br><span class="line">    <span class="comment">//å¦åˆ™æ˜¯è‡ªå®šä¹‰å‘½åç©ºé—´</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    delegate.parseCustomElement(ele);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é»˜è®¤å‘½åç©ºé—´ï¼Œåˆ™æ‰§è¡ŒparseDefaultElementæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseDefaultElement</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;import&quot;</span>)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.importBeanDefinitionResource(ele);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;alias&quot;</span>)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.processAliasRegistration(ele);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;bean&quot;</span>)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.processBeanDefinition(ele, delegate);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;beans&quot;</span>)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.doRegisterBeanDefinitions(ele);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯è‡ªå®šä¹‰å‘½åç©ºé—´ï¼Œåˆ™æ‰§è¡ŒparseCustomElementæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> BeanDefinition <span class="title function_">parseCustomElement</span><span class="params">(Element ele, <span class="meta">@Nullable</span> BeanDefinition containingBd)</span> &#123;</span><br><span class="line">    <span class="comment">//è§£æå‘½åç©ºé—´</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">namespaceUri</span> <span class="operator">=</span> <span class="built_in">this</span>.getNamespaceURI(ele);</span><br><span class="line">    <span class="comment">//è·å¾—å‘½åç©ºé—´è§£æå™¨</span></span><br><span class="line">    <span class="type">NamespaceHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="built_in">this</span>.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);</span><br><span class="line">    <span class="comment">//è§£ææ‰§è¡Œçš„æ ‡ç­¾</span></span><br><span class="line">    <span class="keyword">return</span> handler.parse(ele, <span class="keyword">new</span> <span class="title class_">ParserContext</span>(<span class="built_in">this</span>.readerContext, <span class="built_in">this</span>, containingBd));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œresovleæ–¹æ³•æ—¶ï¼Œå°±æ˜¯ä»Map&lt;String, Object&gt; handlerMappingsä¸­æ ¹æ®å‘½åç©ºé—´åç§°è·å¾—å¯¹åº”çš„å¤„ç†å™¨å¯¹è±¡ï¼Œæ­¤å¤„æ˜¯ContextNamespaceHandlerï¼Œæœ€ç»ˆæ‰§è¡ŒNamespaceHandlerçš„parseæ–¹æ³•</p><p>ContextNamespaceHandleræºç å¦‚ä¸‹ï¼Œé—´æ¥å®ç°äº†NamespaceHandleræ¥å£ï¼Œåˆå§‹åŒ–æ–¹æ³•initä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ç”±äºcontextå‘½åç©ºé—´ä¸‹æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œæ‰€ä»¥æ¯ä¸ªæ ‡ç­¾åˆå•ç‹¬æ³¨å†Œäº†å¯¹åº”çš„è§£æå™¨ï¼Œæ³¨å†Œåˆ°äº†å…¶çˆ¶ç±»NamespaceHandlerSupportçš„Map&lt;String, BeanDefinitionParser&gt; parsersä¸­å»äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextNamespaceHandler</span> <span class="keyword">extends</span> <span class="title class_">NamespaceHandlerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ContextNamespaceHandler</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;property-placeholder&quot;</span>, <span class="keyword">new</span> <span class="title class_">PropertyPlaceholderBeanDefinitionParser</span>());</span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;property-override&quot;</span>, <span class="keyword">new</span> <span class="title class_">PropertyOverrideBeanDefinitionParser</span>());</span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;annotation-config&quot;</span>, <span class="keyword">new</span> <span class="title class_">AnnotationConfigBeanDefinitionParser</span>());</span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;component-scan&quot;</span>, <span class="keyword">new</span> <span class="title class_">ComponentScanBeanDefinitionParser</span>()); <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;load-time-weaver&quot;</span>, <span class="keyword">new</span> <span class="title class_">LoadTimeWeaverBeanDefinitionParser</span>()); <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;spring-configured&quot;</span>, <span class="keyword">new</span> <span class="title class_">SpringConfiguredBeanDefinitionParser</span>()); <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;mbean-export&quot;</span>, <span class="keyword">new</span> <span class="title class_">MBeanExportBeanDefinitionParser</span>());</span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;mbean-server&quot;</span>, <span class="keyword">new</span> <span class="title class_">MBeanServerBeanDefinitionParser</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬æ¸…æ¥šçš„äº†è§£äº†å¤–éƒ¨å‘½åç©ºé—´æ ‡ç­¾çš„æ‰§è¡Œæµç¨‹ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>å°†è‡ªå®šä¹‰æ ‡ç­¾çš„çº¦æŸ ä¸ ç‰©ç†çº¦æŸæ–‡ä»¶ä¸ç½‘ç»œçº¦æŸåç§°çš„çº¦æŸ ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨åˆ°ä¸€ä¸ªspring.schemasæ–‡ä»¶é‡Œ ï¼Œè¯¥æ–‡ä»¶å­˜å‚¨åœ¨ç±»åŠ è½½è·¯å¾„çš„ META-INFé‡Œï¼ŒSpringä¼šè‡ªåŠ¨åŠ è½½åˆ°;</li><li>å°†è‡ªå®šä¹‰å‘½åç©ºé—´çš„åç§° ä¸ è‡ªå®šä¹‰å‘½åç©ºé—´çš„å¤„ç†å™¨æ˜ å°„å…³ç³» ä»¥é”®å€¼å¯¹å½¢å¼å­˜åœ¨åˆ°ä¸€ä¸ªå«spring.handlersæ–‡ä»¶é‡Œï¼Œè¯¥æ–‡ä»¶å­˜å‚¨åœ¨ç±»åŠ è½½è·¯å¾„çš„ META-INFé‡Œï¼ŒSpringä¼šè‡ªåŠ¨åŠ è½½åˆ°;</li><li>å‡†å¤‡å¥½NamespaceHandlerï¼Œå¦‚æœå‘½åç©ºé—´åªæœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆç›´æ¥åœ¨parseæ–¹æ³•ä¸­è¿›è¡Œè§£æå³å¯ï¼Œä¸€èˆ¬è§£æç»“æœå°±æ˜¯æ³¨å†Œè¯¥æ ‡ç­¾å¯¹åº”çš„BeanDefinitionã€‚å¦‚æœå‘½åç©ºé—´é‡Œæœ‰å¤šä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨initæ–¹æ³•ä¸­ä¸ºæ¯ä¸ªæ ‡ç­¾éƒ½æ³¨å†Œä¸€ä¸ªBeanDefinitionParserï¼Œåœ¨æ‰§è¡ŒNamespaceHandlerçš„parseæ–¹æ³•æ—¶åœ¨åˆ†æµç»™ä¸åŒçš„BeanDefinitionParserè¿›è¡Œè§£æ(é‡å†™doParseæ–¹æ³•å³å¯)ã€‚</li></ul><blockquote><p>æ¡ˆä¾‹ï¼šè®¾æƒ³è‡ªå·±æ˜¯ä¸€åæ¶æ„å¸ˆï¼Œè¿›è¡ŒæŸä¸€ä¸ªæ¡†æ¶ä¸Springçš„é›†æˆå¼€å‘ï¼Œæ•ˆæœæ˜¯é€šè¿‡ä¸€ä¸ªæŒ‡ç¤ºæ ‡ç­¾ï¼Œå‘Springå®¹å™¨ä¸­è‡ªåŠ¨æ³¨å…¥ä¸€ä¸ªBeanPostProcessor</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/xmlSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:haohao</span>=<span class="string">&quot;http://www.itheima.com/haohao&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.itheima.com/haohao</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.itheima.com/haohao/haohao-annotation.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">haohao:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¥éª¤åˆ†æï¼š</p><ol><li>ç¡®å®šå‘½åç©ºé—´åç§°ã€schemaè™šæ‹Ÿè·¯å¾„ã€æ ‡ç­¾åç§°ï¼›</li><li>ç¼–å†™schemaçº¦æŸæ–‡ä»¶haohao-annotation.xsd</li><li>åœ¨ç±»åŠ è½½è·¯å¾„ä¸‹åˆ›å»ºMETAç›®å½•ï¼Œç¼–å†™çº¦æŸæ˜ å°„æ–‡ä»¶spring.schemaså’Œå¤„ç†å™¨æ˜ å°„æ–‡ä»¶spring.handlers</li><li>ç¼–å†™å‘½åç©ºé—´å¤„ç†å™¨ HaohaoNamespaceHandlerï¼Œåœ¨initæ–¹æ³•ä¸­æ³¨å†ŒHaohaoBeanDefinitionParser</li><li>ç¼–å†™æ ‡ç­¾çš„è§£æå™¨ HaohaoBeanDefinitionParserï¼Œåœ¨parseæ–¹æ³•ä¸­æ³¨å†ŒHaohaoBeanPostProcessor</li><li>ç¼–å†™HaohaoBeanPostProcessor</li></ol><p>=======ä»¥ä¸Šäº”æ­¥æ˜¯æ¡†æ¶å¼€å‘è€…å†™çš„ï¼Œä»¥ä¸‹æ˜¯æ¡†æ¶ä½¿ç”¨è€…å†™çš„===========</p><ol><li>åœ¨applicationContext.xmlé…ç½®æ–‡ä»¶ä¸­å¼•å…¥å‘½åç©ºé—´</li><li>åœ¨applicationContext.xmlé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„æ ‡ç­¾</li></ol><p>ç¼–å†™schemaçº¦æŸæ–‡ä»¶haohao-annotation.xsd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.itheima.com/haohao&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.itheima.com/haohao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">&quot;annotation-driven&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ç±»åŠ è½½è·¯å¾„ä¸‹åˆ›å»ºMETAç›®å½•ï¼Œç¼–å†™çº¦æŸæ˜ å°„æ–‡ä»¶spring.schemaså’Œå¤„ç†å™¨æ˜ å°„æ–‡ä»¶spring.handlers</p><div class="fj-gallery"><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424110332628.png" alt="image-20230424110332628"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230424110402498.png" alt="image-20230424110402498"></p>          </div><p>ç¼–å†™å‘½åç©ºé—´å¤„ç†å™¨HaohaoNamespaceHandlerï¼Œåœ¨initæ–¹æ³•ä¸­æ³¨å†ŒHaohaoBeanDefinitionParser</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HaohaoNamespaceHandler</span> <span class="keyword">extends</span> <span class="title class_">NamespaceHandlerSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Overridepublic</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;annotation-driven&quot;</span>,<span class="keyword">new</span> <span class="title class_">HaohaoBeanDefinitionParser</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™æ ‡ç­¾çš„è§£æå™¨HaohaoBeanDefinitionParserï¼Œåœ¨parseæ–¹æ³•ä¸­æ³¨å†ŒHaohaoBeanPostProcessor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HaohaoBeanDefinitionParser</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionParser</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> BeanDefinition <span class="title function_">parse</span><span class="params">(Element element, ParserContext parserContext)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºHaohaoBeanPostProcessorçš„BeanDefinitionRootBeanDefinition </span></span><br><span class="line">        beanDefinition = <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">        beanDefinition.setBeanClass(HaohaoBeanPostProcessor.class);</span><br><span class="line">        <span class="comment">//æ³¨å†ŒHaohaoBeanPostProcessor</span></span><br><span class="line">        parserContext.getRegistry().registerBeanDefinition(<span class="string">&quot;haohaoBeanPostProcessor&quot;</span>,beanDefinition);</span><br><span class="line">        <span class="keyword">return</span> beanDefinition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™HaohaoBeanPostProcessor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HaohaoBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è‡ªåŠ¨æ³¨å…¥HaohaoBeanPostProcessoræˆåŠŸ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">SpringBeançš„é…ç½®è¯¦è§£ã€Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹ã€Beançš„ç”Ÿå‘½å‘¨æœŸã€Spring IoCæ•´ä½“æµç¨‹æ€»ç»“</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Spring" scheme="https://wuwawawa.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Springæ¡†æ¶çš„è¯ç”Ÿ</title>
    <link href="https://wuwawawa.github.io/posts/ed620e7e.html"/>
    <id>https://wuwawawa.github.io/posts/ed620e7e.html</id>
    <published>2023-04-23T08:04:42.000Z</published>
    <updated>2023-04-24T07:21:41.797Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Springæ¡†æ¶æ¦‚è¿°">1. Springæ¡†æ¶æ¦‚è¿°</h2><p>springæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§Javaå¼€å‘åº”ç”¨æ¡†æ¶ï¼Œå¯ä»¥ç®€åŒ–ä¼ä¸šçº§åº”ç”¨å¼€å‘ã€‚Springè§£å†³äº†å¼€å‘è€…åœ¨JavaEEå¼€å‘ä¸­é‡åˆ°çš„è®¸å¤šå¸¸è§çš„é—®é¢˜ï¼Œæä¾›äº†åŠŸèƒ½å¼ºå¤§IOCã€AOPåŠWeb MVCç­‰åŠŸèƒ½ã€‚æ˜¯å½“å‰ä¼ä¸šä¸­Javaå¼€å‘å‡ ä¹ä¸èƒ½ç¼ºå°‘çš„æ¡†æ¶ä¹‹ä¸€ã€‚Springçš„ç”Ÿæ€åŠå…¶å®Œå–„ï¼Œä¸ç®¡æ˜¯Springå“ªä¸ªé¢†åŸŸçš„è§£å†³æ–¹æ¡ˆéƒ½æ˜¯ä¾é™„äºåœ¨Spring FrameworkåŸºç¡€æ¡†æ¶çš„ã€‚</p><blockquote><p>Spring æ¡†æ¶çš„å†å²</p></blockquote><ul><li><p>Jspé»˜é»˜æ‰›ä¸‹æ‰€æœ‰ï¼›</p></li><li><p>MVC+ä¸‰å±‚æ¶æ„åˆ†å·¥æ˜ç¡®ï¼Œä½†å¼€å‘æˆæœ¬åŠå…¶é«˜ï¼›</p></li><li><p>EJB é‡é‡çº§æ¡†æ¶å‡ºç°ï¼Œèµ°å‡ºä¸€ä¸ªå›°å¢ƒï¼Œæœ‰è¿›å…¥å¦ä¸€ä¸ªå›°å¢ƒï¼›</p></li><li><p>Spring æ˜¥å¤©æ¥åˆ°ï¼Œéšä¹‹ï¼ŒSSHé£ç”Ÿæ°´èµ·ã€ç§°éœ¸æ­¦æ—ï¼›</p></li><li><p>Spring ç¨³ä½æ±Ÿæ¹–å¤§å“¥ä½ç½®ï¼ŒSSMå¼€å§‹ä¸Šä½ï¼›</p></li><li><p>Spring æœ¬ç€â€œæ‹¿æ¥ä¸»ä¹‰â€çš„æ€ç»´å¿«é€Ÿå‘å±•ï¼Œç”Ÿæ€ä¸æ–­å¥å…¨ï¼›</p></li><li><p>SpringBootåˆä¸€é‡Œç¨‹ç¢‘å´›èµ·ï¼ŒæŠŠâ€œçº¦å®šå¤§äºé…ç½®â€œæ€æƒ³ç©å„¿çš„ç‚‰ç«çº¯é’ï¼›</p></li><li><p>SpringCloudæ‰“åŒ…äº†å¾®æœåŠ¡ä¼—å¤šè§£å†³æ–¹æ¡ˆï¼Œåº”å¯¹äº’è”ç½‘é¡¹ç›®æ›´åŠ easyï¼</p></li></ul><blockquote><p>Spring FrameworkæŠ€æœ¯æ ˆå›¾ç¤º</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423161638018.png" alt="image-20230423161638018" style="zoom:67%;" /><hr><h2 id="2-BeanFactoryå¿«é€Ÿå…¥é—¨">2. BeanFactoryå¿«é€Ÿå…¥é—¨</h2><p>æ ¹æ®ä¸‹å›¾ï¼Œåˆ†æä¸€ä¸‹Springçš„BeanFactoryçš„å¼€å‘æ­¥éª¤ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423161748796.png" alt="image-20230423161748796" style="zoom:67%;" /><p>1ï¼‰å¯¼å…¥Springçš„jaråŒ…æˆ–Mavenåæ ‡ï¼›</p><p>2ï¼‰å®šä¹‰UserServiceæ¥å£åŠå…¶UserServiceImplå®ç°ç±»ï¼›</p><p>3ï¼‰åˆ›å»ºbeans.xmlé…ç½®æ–‡ä»¶ï¼Œå°†UserServiceImplçš„ä¿¡æ¯é…ç½®åˆ°è¯¥xmlä¸­ï¼›</p><p>4ï¼‰ç¼–å†™æµ‹è¯•ä»£ç ï¼Œåˆ›å»ºBeanFactoryï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè·å–UserServiceå®ä¾‹å¯¹è±¡ã€‚</p><div class="tabs" id="8bb75834-8a57-41f0-8bb5-ffd577f454e4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#8bb75834-8a57-41f0-8bb5-ffd577f454e4-1"><i class="fas fa-award"></i>1</button></li><li class="tab"><button type="button" data-href="#8bb75834-8a57-41f0-8bb5-ffd577f454e4-2"><i class="fas fa-baseball-ball"></i>2</button></li><li class="tab"><button type="button" data-href="#8bb75834-8a57-41f0-8bb5-ffd577f454e4-3"><i class="fas fa-bone"></i>3</button></li><li class="tab"><button type="button" data-href="#8bb75834-8a57-41f0-8bb5-ffd577f454e4-4"><i class="fas fa-anchor"></i>4</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="8bb75834-8a57-41f0-8bb5-ffd577f454e4-1"><p>1ï¼‰å¯¼å…¥Springçš„jaråŒ…æˆ–Mavenåæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Springæ ¸å¿ƒ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8bb75834-8a57-41f0-8bb5-ffd577f454e4-2"><p>2ï¼‰å®šä¹‰UserServiceæ¥å£åŠå…¶UserServiceImplå®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8bb75834-8a57-41f0-8bb5-ffd577f454e4-3"><p>3ï¼‰åˆ›å»ºbeans.xmlé…ç½®æ–‡ä»¶ï¼Œå°†UserServiceImplçš„ä¿¡æ¯é…ç½®åˆ°è¯¥xmlä¸­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8bb75834-8a57-41f0-8bb5-ffd577f454e4-4"><p>4ï¼‰ç¼–å†™æµ‹è¯•ä»£ç ï¼Œåˆ›å»ºBeanFactoryï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè·å–UserServiceå®ä¾‹å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»º BeanFactory</span></span><br><span class="line"><span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line"><span class="comment">//åˆ›å»ºè¯»å–å™¨</span></span><br><span class="line"><span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line"><span class="comment">//åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line">reader.loadBeanDefinitions(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"><span class="comment">//è·å– Bean å®ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) beanFactory.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">System.out.println(userService);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>ä¸Šé¢ä½¿ç”¨BeanFactoryå®Œæˆäº†IOCæ€æƒ³çš„å®ç°ï¼Œä¸‹é¢å»å®ç°ä»¥ä¸‹DIä¾èµ–æ³¨å…¥ï¼š</p><p>1ï¼‰å®šä¹‰UserDaoæ¥å£åŠå…¶UserDaoImplå®ç°ç±»ï¼›</p><p>2ï¼‰ä¿®æ”¹UserServiceImplä»£ç ï¼Œæ·»åŠ ä¸€ä¸ªsetUserDao(UserDaouserDao)ç”¨äºæ¥æ”¶æ³¨å…¥çš„å¯¹è±¡ï¼›</p><p>3ï¼‰ä¿®æ”¹beans.xmlé…ç½®æ–‡ä»¶ï¼Œåœ¨UserDaoImplçš„<code>&lt;bean&gt;</code>ä¸­åµŒå…¥<code>&lt;property&gt;</code>é…ç½®æ³¨å…¥ï¼›</p><p>4ï¼‰ä¿®æ”¹æµ‹è¯•ä»£ç ï¼Œè·å¾—UserServiceæ—¶ï¼ŒsetUserServiceæ–¹æ³•æ‰§è¡Œäº†æ³¨å…¥æ“ä½œã€‚</p><div class="tabs" id="9d9f568f-b81b-4495-9067-137af7cc9140"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#9d9f568f-b81b-4495-9067-137af7cc9140-1"><i class="fas fa-atom"></i>1</button></li><li class="tab"><button type="button" data-href="#9d9f568f-b81b-4495-9067-137af7cc9140-2"><i class="far fa-sun"></i>2</button></li><li class="tab"><button type="button" data-href="#9d9f568f-b81b-4495-9067-137af7cc9140-3"><i class="fas fa-wind"></i>3</button></li><li class="tab"><button type="button" data-href="#9d9f568f-b81b-4495-9067-137af7cc9140-4"><i class="fas fa-fire-alt"></i>4</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="9d9f568f-b81b-4495-9067-137af7cc9140-1"><p>1ï¼‰å®šä¹‰UserDaoæ¥å£åŠå…¶UserDaoImplå®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9d9f568f-b81b-4495-9067-137af7cc9140-2"><p>2ï¼‰ä¿®æ”¹UserServiceImplä»£ç ï¼Œæ·»åŠ ä¸€ä¸ªsetUserDao(UserDaouserDao)ç”¨äºæ¥æ”¶æ³¨å…¥çš„å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Beanractoryå»è°ƒç”¨è¯¥æ–¹æ³•ä»å®¹å™¨ä¸­è·å¾—userDaoè®¾ç½®åˆ°æ­¤å¤„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    UserDao userDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanFactoryå»è°ƒç”¨è¯¥æ–¹æ³•è·å¾—userDaoè®¾ç½®åˆ°æ­¤å¤„&quot;</span>+userDao);</span><br><span class="line">        <span class="built_in">this</span>.userDao=userDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9d9f568f-b81b-4495-9067-137af7cc9140-3"><p>3ï¼‰ä¿®æ”¹beans.xmlé…ç½®æ–‡ä»¶ï¼Œåœ¨UserDaoImplçš„<code>&lt;bean&gt;</code>ä¸­åµŒå…¥<code>&lt;property&gt;</code>é…ç½®æ³¨å…¥ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>propertyé‡Œnameå€¼setUserDao setåé¢</p><p>refä¸ºä¸‹é¢çš„bean</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9d9f568f-b81b-4495-9067-137af7cc9140-4"><p>4ï¼‰ç¼–å†™æµ‹è¯•ä»£ç ï¼Œåˆ›å»ºBeanFactoryï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè·å–UserServiceå®ä¾‹å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»º BeanFactory</span></span><br><span class="line"><span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line"><span class="comment">//åˆ›å»ºè¯»å–å™¨</span></span><br><span class="line"><span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line"><span class="comment">//åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line">reader.loadBeanDefinitions(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"><span class="comment">//è·å– Bean å®ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) beanFactory.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">System.out.println(userService);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BeanFactoryå»è°ƒç”¨è¯¥æ–¹æ³•è·å¾—userDaoè®¾ç½®åˆ°æ­¤å¤„com.itheima.dao.impl.UserDaoImpl@3b81a1bc</span><br><span class="line">com.itheima.service.impl.UserServiceImpl@64616ca2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h2 id="3-ApplicationContextå¿«é€Ÿå…¥é—¨">3. ApplicationContextå¿«é€Ÿå…¥é—¨</h2><p>ApplicationContextç§°ä¸º<code>Springå®¹å™¨</code>ï¼Œå†…éƒ¨å°è£…äº†BeanFactoryï¼Œæ¯”BeanFactoryåŠŸèƒ½æ›´ä¸°å¯Œæ›´å¼ºå¤§ï¼Œä½¿ç”¨ApplicationContextè¿›è¡Œå¼€å‘æ—¶ ï¼Œxmlé…ç½®æ–‡ä»¶çš„åç§°ä¹ æƒ¯å†™æˆ<code>applicationContext.xml</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»º ApplicationContext, åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå®ä¾‹åŒ–å®¹å™¨</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="comment">//æ ¹æ® beanName è·å¾—å®¹å™¨ä¸­çš„ Bean å®ä¾‹</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) applicationContext.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">System.out.println(userService);</span><br></pre></td></tr></table></figure><hr><h2 id="4-äºŒè€…å…³ç³»">4. äºŒè€…å…³ç³»</h2><p>1ï¼‰BeanFactoryæ˜¯Springçš„æ—©æœŸæ¥å£ï¼Œç§°ä¸ºSpringçš„Beanå·¥å‚ï¼ŒApplicationContextæ˜¯åæœŸæ›´é«˜çº§æ¥å£ï¼Œç§°ä¹‹ä¸ºSpring å®¹å™¨ï¼›</p><p>2ï¼‰ApplicationContextåœ¨BeanFactoryåŸºç¡€ä¸Šå¯¹åŠŸèƒ½è¿›è¡Œäº†æ‰©å±•ï¼Œä¾‹å¦‚ï¼šç›‘å¬åŠŸèƒ½ã€å›½é™…åŒ–åŠŸèƒ½ç­‰ã€‚BeanFactoryçš„APIæ›´åå‘åº•å±‚ï¼ŒApplicationContextçš„APIå¤§å¤šæ•°æ˜¯å¯¹è¿™äº›åº•å±‚APIçš„å°è£…ï¼›</p><p>3ï¼‰Beanåˆ›å»ºçš„ä¸»è¦é€»è¾‘å’ŒåŠŸèƒ½éƒ½è¢«å°è£…åœ¨BeanFactoryä¸­ï¼ŒApplicationContextä¸ä»…ç»§æ‰¿äº†BeanFactoryï¼Œè€Œä¸”ApplicationContextå†…éƒ¨è¿˜ç»´æŠ¤ç€BeanFactoryçš„å¼•ç”¨ï¼Œæ‰€ä»¥ï¼ŒApplicationContextä¸BeanFactoryæ—¢æœ‰ç»§æ‰¿å…³ç³»ï¼Œåˆæœ‰èåˆå…³ç³»ã€‚</p><p>4ï¼‰Beançš„åˆå§‹åŒ–æ—¶æœºä¸åŒï¼ŒåŸå§‹BeanFactoryæ˜¯åœ¨é¦–æ¬¡è°ƒç”¨getBeanæ—¶æ‰è¿›è¡ŒBeançš„åˆ›å»ºï¼Œè€ŒApplicationContextåˆ™æ˜¯é…ç½®æ–‡ä»¶åŠ è½½ï¼Œå®¹å™¨ä¸€åˆ›å»ºå°±å°†Beanéƒ½å®ä¾‹åŒ–å¹¶åˆå§‹åŒ–å¥½ã€‚</p><p>ApplicationContexté™¤äº†ç»§æ‰¿äº†BeanFactoryå¤–ï¼Œè¿˜ç»§æ‰¿äº†ApplicationEventPublisherï¼ˆäº‹ä»¶å‘å¸ƒå™¨ï¼‰ã€ResouresPatternResolverï¼ˆèµ„æºè§£æå™¨ï¼‰ã€MessageSourceï¼ˆæ¶ˆæ¯èµ„æºï¼‰ç­‰ã€‚ä½†æ˜¯ApplicationContextçš„æ ¸å¿ƒåŠŸèƒ½è¿˜æ˜¯BeanFactoryã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423165150023.png" alt="image-20230423165150023" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423165208430.png" alt="image-20230423165208430" style="zoom:67%;" /><p>applicationContextå†…éƒ¨ç»´æŠ¤ç€beanFactoryçš„å¼•ç”¨ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¼šæŸ¥çœ‹beanFactoryå†…éƒ¨ç»´æŠ¤çš„å±æ€§ï¼Œæ–­ç‚¹æŸ¥çœ‹å¦‚ä¸‹å›¾ç¤ºå†…å®¹çš„</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423165303864.png" alt="image-20230423165303864" style="zoom:67%;" /><p>éªŒè¯BeanFactoryå’ŒApplicationContextå¯¹Beançš„åˆå§‹åŒ–æ—¶æœºï¼Œåœ¨UserDaoImplçš„æ— å‚æ„é€ å†…æ‰“å°ä¸€å¥è¯ï¼ŒéªŒè¯æ„é€ æ–¹æ³•çš„æ‰§è¡Œæ—¶æœº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoImplåˆ›å»ºäº†&quot;</span>);            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–­ç‚¹è§‚å¯Ÿï¼ŒBeanFactoryæ–¹å¼æ—¶ï¼Œå½“è°ƒç”¨getBeanæ–¹æ³•æ—¶æ‰ä¼šæŠŠéœ€è¦çš„Beanå®ä¾‹åˆ›å»ºï¼Œå³å»¶è¿ŸåŠ è½½ï¼›è€ŒApplicationContextæ˜¯åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå®¹å™¨åˆ›å»ºæ—¶å°±å°†æ‰€æœ‰çš„Beanå®ä¾‹éƒ½åˆ›å»ºå¥½äº†ï¼Œå­˜å‚¨åˆ°ä¸€ä¸ªå•ä¾‹æ± ä¸­ï¼Œå½“è°ƒç”¨getBeanæ—¶ç›´æ¥ä»å•ä¾‹æ± ä¸­è·å–Beanå®ä¾‹è¿”å›</p><hr><h2 id="5-BeanFactoryçš„ç»§æ‰¿ä½“ç³»">5. BeanFactoryçš„ç»§æ‰¿ä½“ç³»</h2><p>BeanFactoryæ˜¯æ ¸å¿ƒæ¥å£ï¼Œé¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­è‚¯å®šæœ‰å…·ä½“å®ç°å‚ä¸ï¼Œè¿™ä¸ªå…·ä½“å®ç°å°±æ˜¯DefaultListableBeanFactoryï¼Œè€ŒApplicationContextå†…éƒ¨ç»´æŠ¤çš„Beanfactoryçš„å®ç°ç±»ä¹Ÿæ˜¯å®ƒ</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423165709449.png" alt="image-20230423165709449" style="zoom:67%;" /><hr><h2 id="6-ApplicationContextçš„ç»§æ‰¿ä½“ç³»">6. ApplicationContextçš„ç»§æ‰¿ä½“ç³»</h2><p>åªåœ¨SpringåŸºç¡€ç¯å¢ƒä¸‹ï¼Œå³åªå¯¼å…¥spring-contextåæ ‡æ—¶ï¼Œæ­¤æ—¶ApplicationContextçš„ç»§æ‰¿ä½“ç³»</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423165759705.png" alt="image-20230423165759705" style="zoom:67%;" /><p>åªåœ¨SpringåŸºç¡€ç¯å¢ƒä¸‹ï¼Œå¸¸ç”¨çš„ä¸‰ä¸ªApplicationContextä½œç”¨å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left">å®ç°ç±»</th><th style="text-align:left">åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">ClassPathXmlApplicationContext</td><td style="text-align:left">åŠ è½½ç±»è·¯å¾„ä¸‹çš„xmlé…ç½®çš„ApplicationContext</td></tr><tr><td style="text-align:left">FileSystemXmlApplicationContext</td><td style="text-align:left">åŠ è½½ç£ç›˜è·¯å¾„ä¸‹çš„xmlé…ç½®çš„ApplicationContext</td></tr><tr><td style="text-align:left">AnnotationConfigApplicationContext</td><td style="text-align:left">åŠ è½½æ³¨è§£é…ç½®ç±»çš„ApplicationContext</td></tr></tbody></table><p>å¦‚æœSpringåŸºç¡€ç¯å¢ƒä¸­åŠ å…¥äº†å…¶ä»–ç»„ä»¶è§£å†³æ–¹æ¡ˆï¼Œå¦‚webå±‚è§£å†³æ–¹æ¡ˆï¼Œå³å¯¼å…¥spring-webåæ ‡ï¼Œæ­¤æ—¶ApplicationContextçš„ç»§æ‰¿ä½“ç³»</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web&lt;/artifactId</span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423170256684.png" alt="image-20230423170256684" style="zoom:67%;" /><p>åœ¨Springçš„webç¯å¢ƒä¸‹ï¼Œå¸¸ç”¨çš„ä¸¤ä¸ªApplicationContextä½œç”¨å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left">å®ç°ç±»</th><th style="text-align:left">åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">XmlWebApplicationContext</td><td style="text-align:left">webç¯å¢ƒä¸‹ï¼ŒåŠ è½½ç±»è·¯å¾„ä¸‹çš„xmlé…ç½®çš„ApplicationContext</td></tr><tr><td style="text-align:left">AnnotationConfigWebApplicationContext</td><td style="text-align:left">webç¯å¢ƒä¸‹ï¼ŒåŠ è½½ç£ç›˜è·¯å¾„ä¸‹çš„xmlé…ç½®çš„ApplicationContext</td></tr></tbody></table><p>PSï¼šwebç¯å¢ƒä¸‹çš„è¿™ä¸¤ä¸ªApplicationContextï¼Œåœ¨å­¦ä¹ Springé›†æˆwebæ—¶åœ¨è¿›è¡Œè®²è§£</p>]]></content>
    
    
    <summary type="html">Springæ¡†æ¶æ¦‚è¿°ã€BeanFactoryå’ŒApplicationContext</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Spring" scheme="https://wuwawawa.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Springåˆæ¢:IoCã€DIã€AOP</title>
    <link href="https://wuwawawa.github.io/posts/d063f224.html"/>
    <id>https://wuwawawa.github.io/posts/d063f224.html</id>
    <published>2023-04-22T13:44:50.000Z</published>
    <updated>2023-04-26T04:57:29.209Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä¼ ç»ŸJavaWebå¼€å‘çš„å›°æƒ‘">1. ä¼ ç»ŸJavaWebå¼€å‘çš„å›°æƒ‘</h2><mark class="hl-label blue">ä¼ ç»ŸJavawebå¼€å‘ä»£ç åˆ†æ-ç”¨æˆ·æ¨¡å—</mark> <div class="tabs" id="3fae8efb-4c0d-4648-8df8-5c8e424a061a"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#3fae8efb-4c0d-4648-8df8-5c8e424a061a-1"><i class="fas fa-seedling"></i>ç”¨æˆ·ç™»å½•ä¸šåŠ¡æ–¹æ³•</button></li><li class="tab"><button type="button" data-href="#3fae8efb-4c0d-4648-8df8-5c8e424a061a-2"><i class="fas fa-leaf"></i>ç”¨æˆ·æ³¨å†Œä¸šåŠ¡æ–¹æ³•</button></li><li class="tab"><button type="button" data-href="#3fae8efb-4c0d-4648-8df8-5c8e424a061a-3"><i class="fab fa-apple"></i>å›°æƒ‘ä¸€</button></li><li class="tab"><button type="button" data-href="#3fae8efb-4c0d-4648-8df8-5c8e424a061a-4"><i class="fas fa-tree"></i>å›°æƒ‘äºŒ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="3fae8efb-4c0d-4648-8df8-5c8e424a061a-1"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423122315518.png" alt="image-20230423122315518" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3fae8efb-4c0d-4648-8df8-5c8e424a061a-2"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423122343089.png" alt="image-20230423122343089" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3fae8efb-4c0d-4648-8df8-5c8e424a061a-3"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423125441852.png" alt="image-20230423125441852" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3fae8efb-4c0d-4648-8df8-5c8e424a061a-4"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423125512612.png" alt="image-20230423125512612" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><mark class="hl-label green">è§£å†³æ–¹æ¡ˆ</mark> <div class="tabs" id="1d8f70ba-8c37-4943-8c5a-e8b45231eaa3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1d8f70ba-8c37-4943-8c5a-e8b45231eaa3-1"><i class="fas fa-heartbeat"></i>1</button></li><li class="tab"><button type="button" data-href="#1d8f70ba-8c37-4943-8c5a-e8b45231eaa3-2"><i class="fas fa-cookie-bite"></i>2</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1d8f70ba-8c37-4943-8c5a-e8b45231eaa3-1"><p>å›°æƒ‘ä¸€ï¼šå±‚ä¸å±‚ä¹‹é—´ç´§å¯†è€¦åˆåœ¨äº†ä¸€èµ·ï¼Œæ¥å£ä¸å…·ä½“å®ç°ç´§å¯†è€¦åˆåœ¨äº†ä¸€èµ·</p><p>è§£å†³æ€è·¯ï¼šç¨‹åºä»£ç ä¸­ä¸è¦æ‰‹åŠ¨newå¯¹è±¡ï¼Œç¬¬ä¸‰æ–¹æ ¹æ®è¦æ±‚ä¸ºç¨‹åºæä¾›éœ€è¦çš„Beanå¯¹è±¡</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423125825700.png" alt="image-20230423125825700" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1d8f70ba-8c37-4943-8c5a-e8b45231eaa3-2"><p>å›°æƒ‘äºŒï¼šé€šç”¨çš„äº‹åŠ¡åŠŸèƒ½è€¦åˆåœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œé€šç”¨çš„æ—¥å¿—åŠŸèƒ½è€¦åˆåœ¨ä¸šåŠ¡ä»£ç ä¸­</p><p>è§£å†³æ€è·¯ï¼šç¨‹åºä»£ç ä¸­ä¸è¦æ‰‹åŠ¨newå¯¹è±¡ï¼Œç¬¬ä¸‰æ–¹æ ¹æ®è¦æ±‚ä¸ºç¨‹åºæä¾›éœ€è¦çš„Beanå¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å†…éƒ¨åŠ¨æ€ç»“åˆä¸šåŠ¡å’Œé€šç”¨åŠŸèƒ½</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423125854402.png" alt="image-20230423125854402" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="2-IoCæ§åˆ¶åè½¬æ€æƒ³çš„æå‡º">2. IoCæ§åˆ¶åè½¬æ€æƒ³çš„æå‡º</h2><p>å®é™…å¼€å‘ä¸­ï¼Œå¯¹è±¡ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œå°±ç±»ä¼¼æ‰‹è¡¨å†…éƒ¨çš„é½¿è½®ï¼Œæ¯ä¸ªé½¿è½®éƒ½ç´§å¯†å•®åˆåœ¨ä¸€èµ·ï¼Œä¸€æ—¦æŸä¸ªé½¿è½®å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿä¹Ÿæ„å‘³ç€å´©æºƒã€‚å°½å¯èƒ½è®©å¯¹è±¡ä¹‹é—´çš„å…³ç³»ä¿æŒæ¾è€¦åˆçŠ¶æ€æ˜¯æˆ‘ä»¬æœŸæœ›çš„ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423130540687.png" alt="image-20230423130540687" style="zoom:67%;" /><p>IoCæ€æƒ³ï¼š<code>Inversion of Control</code>ï¼Œç¿»è¯‘ä¸ºâ€œæ§åˆ¶åè½¬â€æˆ–â€œåè½¬æ§åˆ¶â€ï¼Œå¼ºè°ƒçš„æ˜¯åŸæ¥åœ¨ç¨‹åºä¸­åˆ›å»ºBeançš„æƒåˆ©åè½¬ç»™ç¬¬ä¸‰æ–¹ã€‚</p><p>ä¾‹å¦‚ï¼šåŸæ¥åœ¨ç¨‹åºä¸­æ‰‹åŠ¨çš„å»new UserServiceImpl()ï¼Œæ‰‹åŠ¨çš„å»new UserDaoImpl()ï¼Œè€Œæ ¹æ®IoCæ€æƒ³çš„æŒ‡å¯¼ï¼Œå¯»æ±‚ä¸€ä¸ªç¬¬ä¸‰æ–¹å»åˆ›å»ºUserServiceImplå¯¹è±¡å’ŒUserDaoImplå¯¹è±¡ã€‚è¿™æ ·ç¨‹åºä¸å…·ä½“å¯¹è±¡å°±å¤±å»çš„ç›´æ¥è”ç³»ã€‚</p><blockquote><p>è°å»å……å½“ç¬¬ä¸‰æ–¹è§’è‰²å‘¢ï¼Ÿ</p></blockquote><p>å·¥å‚è®¾è®¡æ¨¡å¼ï¼ŒBeanFactoryæ¥å……å½“ç¬¬ä¸‰æ–¹çš„è§’è‰²ï¼Œæ¥äº§ç”ŸBeanå®ä¾‹</p><blockquote><p>BeanFactoryæ€ä¹ˆçŸ¥é“äº§ç”Ÿå“ªäº›Beanå®ä¾‹å‘¢ï¼Ÿ</p></blockquote><p>å¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®Beançš„åŸºæœ¬ä¿¡æ¯ï¼ŒBeanFactoryæ ¹æ®é…ç½®æ–‡ä»¶æ¥ç”Ÿäº§Beanå®ä¾‹</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423153610877.png" alt="image-20230423153610877" style="zoom:67%;" />ä¾‹å¦‚ï¼Œç”¨IoCæ€æƒ³å»åè½¬UserServiceImplçš„åˆ›å»ºæƒï¼Œç”±åŸæ¥ç¨‹åºä¸­åˆ›å»ºåè½¬ç»™é€šè¿‡BeanFactoryå»åˆ›å»º</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423153658959.png" alt="image-20230423153658959" style="zoom:67%;" /><hr><h2 id="3-DIä¾èµ–æ³¨å…¥æ€æƒ³çš„æå‡º">3. DIä¾èµ–æ³¨å…¥æ€æƒ³çš„æå‡º</h2><p>ä¸Šé¢ä½¿ç”¨<code>BeanFactory</code>çš„æ–¹å¼å·²ç»å®ç°çš„&quot;æ§åˆ¶åè½¬&quot;ï¼Œå°†<code>Bean</code>çš„åˆ›å»ºæƒäº¤ç»™äº†<code>BeanFactory</code>ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†<code>UserDao</code>çš„åˆ›å»ºæƒä¹Ÿåè½¬ç»™<code>BeanFactory</code>ï¼Œä¸æ­¤åŒæ—¶<code>UserService</code>å†…éƒ¨è¿˜éœ€è¦ç”¨åˆ°<code>UserDao</code>å®ä¾‹å¯¹è±¡ï¼Œé‚£åº”è¯¥æ€æ ·æ“ä½œå‘¢ï¼Ÿ</p><div class="tabs" id="729b726d-36b9-4c2c-a60c-bd3ffb9ac2cb"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#729b726d-36b9-4c2c-a60c-bd3ffb9ac2cb-1"><i class="fas fa-bug"></i>1</button></li><li class="tab"><button type="button" data-href="#729b726d-36b9-4c2c-a60c-bd3ffb9ac2cb-2"><i class="fas fa-cannabis"></i>2</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="729b726d-36b9-4c2c-a60c-bd3ffb9ac2cb-1"><p>1ï¼‰åœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡<code>BeanFactory</code>è·å¾—<code>UserService</code></p><p>2ï¼‰åœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡<code>BeanFactory</code>è·å¾—<code>UserDao</code></p><p>3ï¼‰åœ¨ç¨‹åºä¸­ï¼Œå°†<code>UserDao</code>è®¾ç½®ç»™<code>UserService</code></p><p><mark class="hl-label blue">è¯¥æ–¹å¼æ˜¯å¦å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Ÿ</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423153956265.png" alt="image-20230423153956265" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="729b726d-36b9-4c2c-a60c-bd3ffb9ac2cb-2"><p>UserServiceå­˜åœ¨äºBeanFactoryä¸­ï¼ŒUserDaoä¹Ÿå­˜åœ¨äºBeanFactoryä¸­ï¼Œå¯ä»¥åœ¨BeanFactoryå†…éƒ¨è¿›è¡Œç»“åˆ</p><p>å°†UserDaoåœ¨BeanFactoryå†…éƒ¨è®¾ç½®ç»™UserServiceçš„è¿‡ç¨‹å«åš<span class='p red'>â€œæ³¨å…¥â€</span>ï¼Œè€ŒUserServiceéœ€è¦ä¾èµ–UserDaoçš„æ³¨å…¥æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš<span class='p red'>â€œä¾èµ–æ³¨å…¥â€</span></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423154346151.png" alt="image-20230423154346151" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>é¢è¯•é¢˜ï¼šIoC å’ŒDI çš„å…³ç³»ï¼Ÿ</p></blockquote><p>é¦–å…ˆï¼Œå…ˆå›ç­”IoCå’ŒDIçš„æ˜¯ä»€ä¹ˆï¼š</p><p>IoCï¼šInversion of Controlï¼Œæ§åˆ¶åè½¬ï¼Œå°†Beançš„åˆ›å»ºæƒç”±åŸæ¥ç¨‹åºåè½¬ç»™ç¬¬ä¸‰æ–¹</p><p>DIï¼šDependency Injectionï¼Œä¾èµ–æ³¨å…¥ï¼ŒæŸä¸ªBeançš„å®Œæ•´åˆ›å»ºä¾èµ–äºå…¶ä»–Beanï¼ˆæˆ–æ™®é€šå‚æ•°ï¼‰çš„æ³¨å…¥</p><p>å…¶æ¬¡ï¼Œåœ¨å›ç­”IoCå’ŒDIçš„å…³ç³»ï¼š</p><p>ç¬¬ä¸€ç§è§‚ç‚¹ï¼šIoCå¼ºè°ƒçš„æ˜¯Beanåˆ›å»ºæƒçš„åè½¬ï¼Œè€ŒDIå¼ºè°ƒçš„æ˜¯Beançš„ä¾èµ–å…³ç³»ï¼Œè®¤ä¸ºä¸æ˜¯ä¸€å›äº‹</p><p>ç¬¬äºŒç§è§‚ç‚¹ï¼šIoCå¼ºè°ƒçš„æ˜¯Beanåˆ›å»ºæƒçš„åè½¬ï¼Œè€ŒDIå¼ºè°ƒçš„æ˜¯é€šè¿‡æ³¨å…¥çš„æ–¹å¼åè½¬Beançš„åˆ›å»ºæƒï¼Œè®¤ä¸ºDIæ˜¯IoCçš„å…¶ä¸­ä¸€ç§å®ç°æ–¹å¼</p><hr><h2 id="4-AOPé¢å‘åˆ‡é¢æ€æƒ³çš„æå‡º">4. AOPé¢å‘åˆ‡é¢æ€æƒ³çš„æå‡º</h2><p>IoCå’ŒDIæ€æƒ³ä¸»è¦æ˜¯è§£å†³å‰é¢æˆ‘ä»¬çš„å›°æƒ‘ä¸€ï¼Œå›°æƒ‘äºŒè¿˜æ²¡æœ‰è§£å†³</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423154737954.png" alt="image-20230423154737954" style="zoom: 50%;" /><p>å›°æƒ‘äºŒçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå€ŸåŠ©äºIoCæ€æƒ³ï¼Œå°†Beançš„åˆ›å»ºæƒåè½¬ç»™BeanFactoryï¼Œè€ŒBeanFactoryç”Ÿäº§çš„Beanæ˜¯ç›®æ ‡Beançš„ä»£ç†å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä»£ç†å¯¹è±¡ä¸­å¯¹ç›®æ ‡å¯¹è±¡æ–¹æ³•è¿›è¡Œç›¸åº”çš„å¢å¼ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423155019793.png" alt="image-20230423155019793" style="zoom:67%;" /><p>AOPï¼Œ<code>Aspect Oriented Programming</code>ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯å¯¹é¢å‘å¯¹è±¡ç¼–ç¨‹OOPçš„å‡åã€‚OOPæ˜¯çºµå‘å¯¹ä¸€ä¸ªäº‹ç‰©çš„æŠ½è±¡ï¼Œä¸€ä¸ªå¯¹è±¡åŒ…æ‹¬é™æ€çš„å±æ€§ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŠ¨æ€çš„æ–¹æ³•ä¿¡æ¯ç­‰ã€‚è€ŒAOPæ˜¯æ¨ªå‘çš„å¯¹ä¸åŒäº‹ç‰©çš„æŠ½è±¡ï¼Œ<code>å±æ€§ä¸å±æ€§</code>ã€<code>æ–¹æ³•ä¸æ–¹æ³•</code>ã€<code>å¯¹è±¡ä¸å¯¹è±¡</code>éƒ½å¯ä»¥ç»„æˆä¸€ä¸ª<code>åˆ‡é¢</code>ï¼Œè€Œç”¨è¿™ç§æ€ç»´å»è®¾è®¡ç¼–ç¨‹çš„æ–¹å¼å«åšé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423155253872.png" alt="image-20230423155253872" style="zoom:67%;" /><blockquote><p>ä¸‰ç§æ€æƒ³æ€»ç»“</p></blockquote><p>1ï¼‰IoCæ§åˆ¶åè½¬ï¼Œæ˜¯å°†ç¨‹åºåˆ›å»ºBeançš„æƒåˆ©åè½¬ç»™ç¬¬ä¸‰æ–¹ï¼›</p><p>2ï¼‰DIä¾èµ–æ³¨å…¥ï¼ŒæŸä¸ªå®Œæ•´Beanéœ€è¦ä¾èµ–äºå…¶ä»–Beanï¼ˆæˆ–å±æ€§ï¼‰çš„æ³¨å…¥ï¼›</p><p>3ï¼‰AOPé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç”¨æ¨ªå‘æŠ½å–æ–¹æ³•ï¼ˆå±æ€§ã€å¯¹è±¡ç­‰ï¼‰æ€æƒ³ï¼Œç»„è£…æˆä¸€ä¸ªåŠŸèƒ½æ€§åˆ‡é¢ã€‚</p><hr><h2 id="5-æ¡†æ¶æ¦‚å¿µçš„å‡ºç°">5. æ¡†æ¶æ¦‚å¿µçš„å‡ºç°</h2><p>ä¸Šé¢æå‡ºäº†ä¸€äº›æ€æƒ³æ¥è§£å†³é‡åˆ°çš„é—®é¢˜ï¼Œè€Œè¿™äº›æ€æƒ³çš„å®ç°å°±éœ€è¦é€šè¿‡ç¼–ç å»è½åœ°ï¼Œå¾€å¾€æˆ‘ä»¬æŠŠå…·å¤‡ä¸€å®šä¸šåŠ¡é¢†åŸŸè§£å†³æ–¹æ¡ˆçš„&quot;å·¥å…·&quot;ç§°ä¸ºæ¡†æ¶ã€‚</p><p>æ¡†æ¶çš„åŸºæœ¬ç‰¹ç‚¹ï¼š</p><ul><li>æ¡†æ¶ï¼ˆFrameworkï¼‰ï¼Œæ˜¯åŸºäºåŸºç¡€æŠ€æœ¯ä¹‹ä¸Šï¼Œä»ä¼—å¤šä¸šåŠ¡ä¸­æŠ½å–å‡ºçš„é€šç”¨è§£å†³æ–¹æ¡ˆï¼›</li><li>æ¡†æ¶æ˜¯ä¸€ä¸ªåŠæˆå“ï¼Œä½¿ç”¨æ¡†æ¶è§„å®šçš„è¯­æ³•å¼€å‘å¯ä»¥æé«˜å¼€å‘æ•ˆç‡ï¼Œå¯ä»¥ç”¨ç®€å•çš„ä»£ç å°±èƒ½å®Œæˆå¤æ‚çš„åŸºç¡€ä¸šåŠ¡ï¼›</li><li>æ¡†æ¶å†…éƒ¨ä½¿ç”¨å¤§é‡çš„è®¾è®¡æ¨¡å¼ã€ç®—æ³•ã€åº•å±‚ä»£ç æ“ä½œæŠ€æœ¯ï¼Œå¦‚åå°„ã€å†…çœã€xmlè§£æã€æ³¨è§£è§£æç­‰ï¼›</li><li>æ¡†æ¶ä¸€èˆ¬éƒ½å…·å¤‡æ‰©å±•æ€§ï¼›</li><li>æœ‰äº†æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç²¾åŠ›å°½å¯èƒ½çš„æŠ•å…¥åœ¨çº¯ä¸šåŠ¡å¼€å‘ä¸Šè€Œä¸ç”¨å»è´¹å¿ƒæŠ€æœ¯å®ç°ä»¥åŠä¸€äº›è¾…åŠ©ä¸šåŠ¡ã€‚</li></ul><p>Javaä¸­å¸¸ç”¨çš„æ¡†æ¶ï¼š</p><p>ä¸åŒè¯­è¨€ï¼Œä¸åŒé¢†åŸŸéƒ½æœ‰å±äºè‡ªå·±çš„æ¡†æ¶ï¼Œä½¿ç”¨æ¡†æ¶å¼€å‘æ˜¯ä½œä¸ºç¨‹åºå‘˜çš„æœ€åŸºç¡€çš„åº•çº¿ã€‚Javaè¯­è¨€ä¸­çš„æ¡†æ¶ï¼Œå¯ä»¥åˆ†ä¸ºåŸºç¡€æ¡†æ¶å’ŒæœåŠ¡æ¡†æ¶ï¼š</p><ul><li><p>åŸºç¡€æ¡†æ¶ï¼šå®ŒæˆåŸºæœ¬ä¸šåŠ¡æ“ä½œçš„æ¡†æ¶ï¼Œå¦‚MyBatisã€Springã€SpringMVCã€Struts2ã€Hibernateç­‰</p></li><li><p>æœåŠ¡æ¡†æ¶ï¼šç‰¹å®šé¢†åŸŸçš„æ¡†æ¶ï¼Œä¸€èˆ¬è¿˜å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡æ¡†æ¶ï¼Œå¦‚MQã€ESã€Nacosç­‰</p></li></ul><hr><h2 id="6-æ€æƒ³ã€æ¡†æ¶å’Œç¼–ç å…³ç³»">6. æ€æƒ³ã€æ¡†æ¶å’Œç¼–ç å…³ç³»</h2><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230423155505826.png" alt="image-20230423155505826" style="zoom:67%;" /><ul><li><p>æ¶æ„å¸ˆï¼ˆé«˜çº§ç¨‹åºå‘˜ï¼‰ï¼šæŠŠæ€æƒ³è½åœ°å˜ä¸ºå®ç°çš„äººï¼Œä¾‹å¦‚ä¸Šé¢çš„è®¾è®¡å’ŒBeanFactoryçš„ç¼–å†™ï¼Œå³æ¡†æ¶çš„è®¾è®¡å’Œå®ç°è€…ã€‚</p></li><li><p>ç¨‹åºå‘˜ï¼šä½¿ç”¨æ¡†æ¶å®Œæˆä¸šåŠ¡çš„äººï¼Œå…¶ä¸­UserServiceImplã€beans.xmlã€æµ‹è¯•ç±»éƒ½æ˜¯æˆ‘ä»¬ç¼–å†™çš„ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">ä¼ ç»ŸJavaweb å¼€å‘çš„å›°æƒ‘å’ŒIoCã€DIå’ŒAOPæ€æƒ³æå‡º</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="Spring" scheme="https://wuwawawa.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®å¤‡ä»½ä¸æ¢å¤</title>
    <link href="https://wuwawawa.github.io/posts/73985825.html"/>
    <id>https://wuwawawa.github.io/posts/73985825.html</id>
    <published>2023-04-21T06:33:21.000Z</published>
    <updated>2023-04-18T07:12:30.420Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä»»ä½•æ•°æ®åº“ç¯å¢ƒä¸­ï¼Œæ€»ä¼šæœ‰<code>ä¸ç¡®å®šçš„æ„å¤–</code>æƒ…å†µå‘ç”Ÿï¼Œæ¯”å¦‚ä¾‹å¤–çš„åœç”µã€è®¡ç®—æœºç³»ç»Ÿä¸­çš„å„ç§è½¯ç¡¬ä»¶æ•…éšœã€äººä¸ºç ´åã€ç®¡ç†å‘˜è¯¯æ“ä½œç­‰æ˜¯ä¸å¯é¿å…çš„ï¼Œè¿™äº›æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´<code>æ•°æ®çš„ä¸¢å¤±</code>ã€<code>æœåŠ¡å™¨ç˜«ç—ª</code>ç­‰ä¸¥é‡çš„åæœã€‚å­˜åœ¨å¤šä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šå‡ºç°ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥é—®é¢˜ã€‚</p><p>ä¸ºäº†æœ‰æ•ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå¹¶å°†æŸå¤±é™åˆ°æœ€ä½ï¼Œåº”å®šæœŸå¯¹MySQLæ•°æ®åº“æœåŠ¡å™¨åšå¤‡ä»½ã€‚å¦‚æœæ•°æ®åº“ä¸­çš„æ•°æ®ä¸¢å¤±æˆ–è€…å‡ºç°é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨å¤‡ä»½çš„æ•°æ®è¿›è¡Œæ¢å¤ã€‚ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥é—®é¢˜å¯ä»¥é€šè¿‡å¤åˆ¶åŠŸèƒ½å®ç°ã€‚</p><h2 id="1-ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½">1. ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½</h2><p>**ç‰©ç†å¤‡ä»½ï¼š**å¤‡ä»½æ•°æ®æ–‡ä»¶ï¼Œè½¬å‚¨æ•°æ®åº“ç‰©ç†æ–‡ä»¶åˆ°æŸä¸€ç›®å½•ã€‚ç‰©ç†å¤‡ä»½æ¢å¤é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼ŒMySQLä¸­å¯ä»¥ç”¨ <code>xtrabackup</code> å·¥å…·æ¥è¿›è¡Œç‰©ç†å¤‡ä»½ã€‚</p><p>**é€»è¾‘å¤‡ä»½ï¼š**å¯¹æ•°æ®åº“å¯¹è±¡åˆ©ç”¨å·¥å…·è¿›è¡Œå¯¼å‡ºå·¥ä½œï¼Œæ±‡æ€»å…¥å¤‡ä»½æ–‡ä»¶å†…ã€‚é€»è¾‘å¤‡ä»½æ¢å¤é€Ÿåº¦æ…¢ï¼Œä½†å ç”¨ç©ºé—´å°ï¼Œæ›´çµæ´»ã€‚MySQL ä¸­å¸¸ç”¨çš„é€»è¾‘å¤‡ä»½å·¥å…·ä¸º <code>mysqldump</code> ã€‚é€»è¾‘å¤‡ä»½å°±æ˜¯ <code>å¤‡ä»½sqlè¯­å¥</code> ï¼Œåœ¨æ¢å¤çš„æ—¶å€™æ‰§è¡Œå¤‡ä»½çš„sqlè¯­å¥å®ç°æ•°æ®åº“æ•°æ®çš„é‡ç°ã€‚</p><hr><h2 id="2-mysqldumpå®ç°é€»è¾‘å¤‡ä»½">2. mysqldumpå®ç°é€»è¾‘å¤‡ä»½</h2><p>mysqldumpæ˜¯MySQLæä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ•°æ®åº“å¤‡ä»½å·¥å…·ã€‚</p><h3 id="2-1-å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“">2.1 å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“</h3><p>mysqldumpå‘½ä»¤æ‰§è¡Œæ—¶ï¼Œå¯ä»¥å°†æ•°æ®åº“å¤‡ä»½æˆä¸€ä¸ª<code>æ–‡æœ¬æ–‡ä»¶</code>ï¼Œè¯¥æ–‡ä»¶ä¸­å®é™…ä¸ŠåŒ…å«å¤šä¸ª<code>CREATE</code>å’Œ<code>INSERT</code>è¯­å¥ï¼Œä½¿ç”¨è¿™äº›è¯­å¥å¯ä»¥é‡æ–°åˆ›å»ºè¡¨å’Œæ’å…¥æ•°æ®ã€‚</p><ul><li>æŸ¥å‡ºéœ€è¦å¤‡ä»½çš„è¡¨çš„ç»“æ„ï¼Œåœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ªCREATEè¯­å¥</li><li>å°†è¡¨ä¸­çš„æ‰€æœ‰è®°å½•è½¬æ¢ä¸ºä¸€æ¡INSERTè¯­å¥ã€‚</li></ul><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump â€“u ç”¨æˆ·åç§° â€“h ä¸»æœºåç§° â€“på¯†ç  å¾…å¤‡ä»½çš„æ•°æ®åº“åç§°[tbname, [tbname...]]<span class="operator">&gt;</span> å¤‡ä»½æ–‡ä»¶åç§°.<span class="keyword">sql</span></span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š å¤‡ä»½çš„æ–‡ä»¶å¹¶éä¸€å®šè¦æ±‚åç¼€åä¸º.sqlï¼Œä¾‹å¦‚åç¼€åä¸º.txtçš„æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p></blockquote><p>ä¸¾ä¾‹ï¼šä½¿ç”¨rootç”¨æˆ·å¤‡ä»½atguiguæ•°æ®åº“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu<span class="operator">&gt;</span>atguigu.sql #å¤‡ä»½æ–‡ä»¶å­˜å‚¨åœ¨å½“å‰ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigudb1 <span class="operator">&gt;</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu.sql</span><br></pre></td></tr></table></figure><p>å¤‡ä»½æ–‡ä»¶å‰–æï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL dump 10.13 Distrib 8.0.26, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: localhost Database: atguigu</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version 8.0.26</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET NAMES utf8mb4 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;NO_AUTO_VALUE_ON_ZERO&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Current Database: `atguigu`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE <span class="comment">/*!32312 IF NOT EXISTS*/</span> `atguigu` <span class="comment">/*!40100 DEFAULT CHARACTER SET</span></span><br><span class="line"><span class="comment">utf8mb4 COLLATE utf8mb4_0900_ai_ci */</span> <span class="comment">/*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */</span>;</span><br><span class="line"></span><br><span class="line">USE `atguigu`;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `student`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `student`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET character_set_client = utf8mb4 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">`studentno` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`class` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`studentno`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;å¼ ä¸‰_back&#x27;</span>,<span class="string">&#x27;ä¸€ç­&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;æå››&#x27;</span>,<span class="string">&#x27;ä¸€ç­&#x27;</span>),(<span class="number">8</span>,<span class="string">&#x27;ç‹äº”&#x27;</span>,<span class="string">&#x27;äºŒç­&#x27;</span>),</span><br><span class="line">(<span class="number">15</span>,<span class="string">&#x27;èµµå…­&#x27;</span>,<span class="string">&#x27;äºŒç­&#x27;</span>),(<span class="number">20</span>,<span class="string">&#x27;é’±ä¸ƒ&#x27;</span>,<span class="string">&#x27;&gt;ä¸‰ç­&#x27;</span>),(<span class="number">22</span>,<span class="string">&#x27;zhang3_update&#x27;</span>,<span class="string">&#x27;1ban&#x27;</span>),(<span class="number">24</span>,<span class="string">&#x27;wang5&#x27;</span>,<span class="string">&#x27;2ban&#x27;</span>);</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `student` ENABLE KEYS */</span>;</span><br><span class="line">UNLOCK TABLES;</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;</span><br><span class="line"><span class="comment">-- Dump completed on 2022-01-07 9:58:23</span></span><br></pre></td></tr></table></figure><h3 id="2-2-å¤‡ä»½å…¨éƒ¨æ•°æ®åº“">2.2 å¤‡ä»½å…¨éƒ¨æ•°æ®åº“</h3><p>è‹¥æƒ³ç”¨mysqldumpå¤‡ä»½æ•´ä¸ªå®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ --all-databases æˆ– -A å‚æ•°ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>pxxxxxx <span class="comment">--all-databases &gt; all_database.sql</span></span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>pxxxxxx <span class="operator">-</span>A <span class="operator">&gt;</span> all_database.sql</span><br></pre></td></tr></table></figure><h3 id="2-3-å¤‡ä»½éƒ¨åˆ†æ•°æ®åº“">2.3 å¤‡ä»½éƒ¨åˆ†æ•°æ®åº“</h3><p>ä½¿ç”¨ <code>--databases</code> æˆ– <code>-B</code> å‚æ•°äº†ï¼Œè¯¥å‚æ•°åé¢è·Ÿæ•°æ®åº“åç§°ï¼Œå¤šä¸ªæ•°æ®åº“é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚å¦‚æœæŒ‡å®š databaseså‚æ•°ï¼Œå¤‡ä»½æ–‡ä»¶ä¸­ä¼šå­˜åœ¨åˆ›å»ºæ•°æ®åº“çš„è¯­å¥ï¼Œå¦‚æœä¸æŒ‡å®šå‚æ•°ï¼Œåˆ™ä¸å­˜åœ¨ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump â€“u <span class="keyword">user</span> â€“h host â€“p <span class="comment">--databases [æ•°æ®åº“çš„åç§°1 [æ•°æ®åº“çš„åç§°2...]] &gt; å¤‡ä»½æ–‡ä»¶åç§°.sql</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--databases atguigu atguigu12 &gt;two_database.sql</span></span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>B atguigu atguigu12 <span class="operator">&gt;</span> two_database.sql</span><br></pre></td></tr></table></figure><h3 id="2-4-å¤‡ä»½éƒ¨åˆ†è¡¨">2.4 å¤‡ä»½éƒ¨åˆ†è¡¨</h3><p>æ¯”å¦‚ï¼Œåœ¨è¡¨å˜æ›´å‰åšä¸ªå¤‡ä»½ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump â€“u <span class="keyword">user</span> â€“h host â€“p æ•°æ®åº“çš„åç§° [è¡¨å<span class="number">1</span> [è¡¨å<span class="number">2.</span>..]] <span class="operator">&gt;</span> å¤‡ä»½æ–‡ä»¶åç§°.<span class="keyword">sql</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šå¤‡ä»½atguiguæ•°æ®åº“ä¸‹çš„bookè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu book<span class="operator">&gt;</span> book.sql</span><br></pre></td></tr></table></figure><p>book.sqlæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu book<span class="operator">&gt;</span> book.sql<span class="operator">^</span>C</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# ls</span><br><span class="line">kk kubekey kubekey<span class="operator">-</span>v1<span class="number">.1</span><span class="number">.1</span><span class="operator">-</span>linux<span class="operator">-</span>amd64.tar.gz README.md test1.sql two_database.sql</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu book<span class="operator">&gt;</span> book.sql</span><br><span class="line">Enter password:</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# ls</span><br><span class="line">book.sql kk kubekey kubekey<span class="operator">-</span>v1<span class="number">.1</span><span class="number">.1</span><span class="operator">-</span>linux<span class="operator">-</span>amd64.tar.gz README.md test1.sql</span><br><span class="line">two_database.sql</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# vi book.sql</span><br><span class="line"><span class="comment">-- MySQL dump 10.13 Distrib 8.0.26, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: localhost Database: atguigu</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version 8.0.26</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET NAMES utf8mb4 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;NO_AUTO_VALUE_ON_ZERO&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `book`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `book`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET character_set_client = utf8mb4 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `book` (</span><br><span class="line">`bookid` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`card` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`test` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`bookid`),</span><br><span class="line">KEY `Y` (`card`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">101</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Dumping data for table `book`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line">LOCK TABLES `book` WRITE;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `book` DISABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `book` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">9</span>,<span class="keyword">NULL</span>),(<span class="number">2</span>,<span class="number">10</span>,<span class="keyword">NULL</span>),(<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">4</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">5</span>,<span class="number">7</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="number">10</span>,<span class="keyword">NULL</span>),(<span class="number">7</span>,<span class="number">11</span>,<span class="keyword">NULL</span>),(<span class="number">8</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">9</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">10</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),(<span class="number">11</span>,<span class="number">19</span>,<span class="keyword">NULL</span>),(<span class="number">12</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">13</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">14</span>,<span class="number">14</span>,<span class="keyword">NULL</span>),(<span class="number">15</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">16</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">17</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">18</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">19</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">20</span>,<span class="number">11</span>,<span class="keyword">NULL</span>),(<span class="number">21</span>,<span class="number">9</span>,<span class="keyword">NULL</span>),(<span class="number">22</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">23</span>,<span class="number">13</span>,<span class="keyword">NULL</span>),(<span class="number">24</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">25</span>,<span class="number">18</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">26</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">27</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">28</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">29</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">30</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">31</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">32</span>,<span class="number">11</span>,<span class="keyword">NULL</span>),(<span class="number">33</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">34</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">35</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">36</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">37</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">38</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">39</span>,<span class="number">16</span>,<span class="keyword">NULL</span>),(<span class="number">40</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">41</span>,<span class="number">18</span>,<span class="keyword">NULL</span>),(<span class="number">42</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">43</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">44</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">45</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">46</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">47</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">48</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),(<span class="number">49</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">50</span>,<span class="number">16</span>,<span class="keyword">NULL</span>),(<span class="number">51</span>,<span class="number">13</span>,<span class="keyword">NULL</span>),(<span class="number">52</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),(<span class="number">53</span>,<span class="number">7</span>,<span class="keyword">NULL</span>),(<span class="number">54</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">55</span>,<span class="number">9</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">56</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">57</span>,<span class="number">14</span>,<span class="keyword">NULL</span>),(<span class="number">58</span>,<span class="number">7</span>,<span class="keyword">NULL</span>),(<span class="number">59</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">60</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">61</span>,<span class="number">13</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">62</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">63</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">64</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">65</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">66</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">67</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">68</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">69</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">70</span>,<span class="number">10</span>,<span class="keyword">NULL</span>),(<span class="number">71</span>,<span class="number">16</span>,<span class="keyword">NULL</span>),(<span class="number">72</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">73</span>,<span class="number">14</span>,<span class="keyword">NULL</span>),(<span class="number">74</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">75</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">76</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">77</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">78</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">79</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">80</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">81</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">82</span>,<span class="number">14</span>,<span class="keyword">NULL</span>),(<span class="number">83</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">84</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">85</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">86</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">87</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">88</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">89</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">90</span>,<span class="number">18</span>,<span class="keyword">NULL</span>),(<span class="number">91</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">92</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">93</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">94</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">95</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">96</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),(<span class="number">97</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">98</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">99</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">100</span>,<span class="number">15</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `book` ENABLE KEYS */</span>;</span><br><span class="line">UNLOCK TABLES;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œbookæ–‡ä»¶å’Œå¤‡ä»½çš„åº“æ–‡ä»¶ç±»ä¼¼ã€‚ä¸åŒçš„æ˜¯ï¼Œbookæ–‡ä»¶åªåŒ…å«bookè¡¨çš„DROPã€CREATEå’Œ INSERTè¯­å¥ã€‚</p><p>å¤‡ä»½å¤šå¼ è¡¨ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œæ¯”å¦‚å¤‡ä»½bookå’Œaccountè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#å¤‡ä»½å¤šå¼ è¡¨</span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu book account <span class="operator">&gt;</span> <span class="number">2</span>_tables_bak.sql</span><br></pre></td></tr></table></figure><h3 id="2-5-å¤‡ä»½å•è¡¨çš„éƒ¨åˆ†æ•°æ®">2.5 å¤‡ä»½å•è¡¨çš„éƒ¨åˆ†æ•°æ®</h3><p>æœ‰äº›æ—¶å€™ä¸€å¼ è¡¨çš„æ•°æ®é‡å¾ˆå¤§ï¼Œæˆ‘ä»¬åªéœ€è¦éƒ¨åˆ†æ•°æ®ã€‚è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ --where é€‰é¡¹äº†ã€‚whereåé¢é™„å¸¦éœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p><p>ä¸¾ä¾‹ï¼šå¤‡ä»½studentè¡¨ä¸­idå°äº10çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu student <span class="comment">--where=&quot;id &lt; 10 &quot; &gt; student_part_id10_low_bak.sql</span></span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼Œinsertè¯­å¥åªæœ‰idå°äº10çš„éƒ¨åˆ†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LOCK TABLES `student` WRITE;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `student` DISABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">100002</span>,<span class="string">&#x27;JugxTY&#x27;</span>,<span class="number">157</span>,<span class="number">280</span>),(<span class="number">2</span>,<span class="number">100003</span>,<span class="string">&#x27;QyUcCJ&#x27;</span>,<span class="number">251</span>,<span class="number">277</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="number">100004</span>,<span class="string">&#x27;lATUPp&#x27;</span>,<span class="number">80</span>,<span class="number">404</span>),(<span class="number">4</span>,<span class="number">100005</span>,<span class="string">&#x27;BmFsXI&#x27;</span>,<span class="number">240</span>,<span class="number">171</span>),(<span class="number">5</span>,<span class="number">100006</span>,<span class="string">&#x27;mkpSwJ&#x27;</span>,<span class="number">388</span>,<span class="number">476</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="number">100007</span>,<span class="string">&#x27;ujMgwN&#x27;</span>,<span class="number">259</span>,<span class="number">124</span>),(<span class="number">7</span>,<span class="number">100008</span>,<span class="string">&#x27;HBJTqX&#x27;</span>,<span class="number">429</span>,<span class="number">168</span>),(<span class="number">8</span>,<span class="number">100009</span>,<span class="string">&#x27;dvQSQA&#x27;</span>,<span class="number">61</span>,<span class="number">504</span>),</span><br><span class="line">(<span class="number">9</span>,<span class="number">100010</span>,<span class="string">&#x27;HljpVJ&#x27;</span>,<span class="number">234</span>,<span class="number">185</span>);</span><br></pre></td></tr></table></figure><h3 id="2-6-æ’é™¤æŸäº›è¡¨çš„å¤‡ä»½">2.6 æ’é™¤æŸäº›è¡¨çš„å¤‡ä»½</h3><p>å¦‚æœæˆ‘ä»¬æƒ³å¤‡ä»½æŸä¸ªåº“ï¼Œä½†æ˜¯æŸäº›è¡¨æ•°æ®é‡å¾ˆå¤§æˆ–è€…ä¸ä¸šåŠ¡å…³è”ä¸å¤§ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘æ’é™¤æ‰è¿™äº›è¡¨ï¼ŒåŒæ ·çš„ï¼Œé€‰é¡¹ <code>--ignore-table</code> å¯ä»¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu <span class="comment">--ignore-table=atguigu.student &gt; no_stu_bak.sql</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡å¦‚ä¸‹æŒ‡å®šåˆ¤å®šæ–‡ä»¶ä¸­æ²¡æœ‰studentè¡¨ç»“æ„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;student&quot; no_stu_bak.sql</span><br></pre></td></tr></table></figure><h3 id="2-7-åªå¤‡ä»½ç»“æ„æˆ–åªå¤‡ä»½æ•°æ®">2.7 åªå¤‡ä»½ç»“æ„æˆ–åªå¤‡ä»½æ•°æ®</h3><p>åªå¤‡ä»½ç»“æ„çš„è¯å¯ä»¥ä½¿ç”¨ <code>--no-data</code> ç®€å†™ä¸º <code>-d</code> é€‰é¡¹ï¼›åªå¤‡ä»½æ•°æ®å¯ä»¥ä½¿ç”¨ <code>--no-create-info</code> ç®€å†™ä¸º <code>-t</code>é€‰é¡¹ã€‚</p><ul><li><p>åªå¤‡ä»½ç»“æ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu <span class="comment">--no-data &gt; atguigu_no_data_bak.sql</span></span><br><span class="line">#ä½¿ç”¨grepå‘½ä»¤ï¼Œæ²¡æœ‰æ‰¾åˆ°<span class="keyword">insert</span>ç›¸å…³è¯­å¥ï¼Œè¡¨ç¤ºæ²¡æœ‰æ•°æ®å¤‡ä»½ã€‚</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# grep &quot;INSERT&quot; atguigu_no_data_bak.sql</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]#</span><br></pre></td></tr></table></figure></li><li><p>åªå¤‡ä»½æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu <span class="comment">--no-create-info &gt; atguigu_no_create_info_bak.sql</span></span><br><span class="line">#ä½¿ç”¨grepå‘½ä»¤ï¼Œæ²¡æœ‰æ‰¾åˆ°<span class="keyword">create</span>ç›¸å…³è¯­å¥ï¼Œè¡¨ç¤ºæ²¡æœ‰æ•°æ®ç»“æ„ã€‚</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# grep &quot;CREATE&quot; atguigu_no_create_info_bak.sql</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]#</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-8-å¤‡ä»½ä¸­åŒ…å«å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶">2.8 å¤‡ä»½ä¸­åŒ…å«å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶</h3><p>mysqldumpå¤‡ä»½é»˜è®¤æ˜¯ä¸åŒ…å«å­˜å‚¨è¿‡ç¨‹ï¼Œè‡ªå®šä¹‰å‡½æ•°åŠäº‹ä»¶çš„ã€‚å¯ä»¥ä½¿ç”¨ <code>--routines</code> æˆ– <code>-R</code> é€‰é¡¹æ¥å¤‡ä»½å­˜å‚¨è¿‡ç¨‹åŠå‡½æ•°ï¼Œä½¿ç”¨ <code>--events</code> æˆ– <code>-E</code> å‚æ•°æ¥å¤‡ä»½äº‹ä»¶ã€‚</p><p>ä¸¾ä¾‹ï¼šå¤‡ä»½æ•´ä¸ªatguiguåº“ï¼ŒåŒ…å«å­˜å‚¨è¿‡ç¨‹åŠäº‹ä»¶ï¼š</p><ul><li>ä½¿ç”¨ä¸‹é¢çš„SQLå¯ä»¥æŸ¥çœ‹å½“å‰åº“æœ‰å“ªäº›å­˜å‚¨è¿‡ç¨‹æˆ–è€…å‡½æ•°</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SPECIFIC_NAME,ROUTINE_TYPE ,ROUTINE_SCHEMA <span class="keyword">FROM</span></span><br><span class="line">information_schema.Routines <span class="keyword">WHERE</span> ROUTINE_SCHEMA<span class="operator">=</span>&quot;atguigu&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> SPECIFIC_NAME <span class="operator">|</span> ROUTINE_TYPE <span class="operator">|</span> ROUTINE_SCHEMA <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> rand_num      <span class="operator">|</span> <span class="keyword">FUNCTION</span>     <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> rand_string   <span class="operator">|</span> <span class="keyword">FUNCTION</span>     <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BatchInsert   <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> insert_class  <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> insert_order  <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> insert_stu    <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> insert_user   <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ts_insert     <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------------+----------------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¤‡ä»½atguiguåº“çš„æ•°æ®ï¼Œå‡½æ•°ä»¥åŠå­˜å‚¨è¿‡ç¨‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>R <span class="operator">-</span>E <span class="comment">--databases atguigu &gt; fun_atguigu_bak.sql</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å¤‡ä»½æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®åŒ…å«äº†å‡½æ•°ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="operator">-</span>C <span class="number">5</span> &quot;rand_num&quot; fun_atguigu_bak.sql</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Dumping routines for database &#x27;atguigu&#x27;</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">/*!50003 DROP FUNCTION IF EXISTS `rand_num` */</span>;</span><br><span class="line"><span class="comment">/*!50003 SET @saved_cs_client = @@character_set_client */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET @saved_cs_results = @@character_set_results */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET @saved_col_connection = @@collation_connection */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET character_set_client = utf8mb3 */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET character_set_results = utf8mb3 */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET collation_connection = utf8_general_ci */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET @saved_sql_mode = @@sql_mode */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET sql_mode =</span></span><br><span class="line"><span class="comment">&#x27;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISIO</span></span><br><span class="line"><span class="comment">N_BY_ZERO,NO_ENGINE_SUBSTITUTION&#x27; */</span> ;</span><br><span class="line">DELIMITER ;;</span><br><span class="line"><span class="keyword">CREATE</span> DEFINER<span class="operator">=</span>`root`@`<span class="operator">%</span>` <span class="keyword">FUNCTION</span> `rand_num`(from_num <span class="type">BIGINT</span> ,to_num <span class="type">BIGINT</span>) <span class="keyword">RETURNS</span></span><br><span class="line"><span class="type">bigint</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> <span class="built_in">FLOOR</span>(from_num <span class="operator">+</span>RAND()<span class="operator">*</span>(to_num <span class="operator">-</span> from_num<span class="operator">+</span><span class="number">1</span>)) ;</span><br><span class="line"><span class="keyword">RETURN</span> i;</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    REPEAT</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> class ( classname,address,monitor ) <span class="keyword">VALUES</span></span><br><span class="line">    (rand_string(<span class="number">8</span>),rand_string(<span class="number">10</span>),rand_num());</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">    REPEAT #å¾ªç¯</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; #èµ‹å€¼</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_test (order_id, trans_id ) <span class="keyword">VALUES</span></span><br><span class="line">    (rand_num(<span class="number">1</span>,<span class="number">7000000</span>),rand_num(<span class="number">100000000000000000</span>,<span class="number">700000000000000000</span>));</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>; #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">    REPEAT #å¾ªç¯</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; #èµ‹å€¼</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> student (stuno, name ,age ,classId ) <span class="keyword">VALUES</span></span><br><span class="line">    ((<span class="keyword">START</span><span class="operator">+</span>i),rand_string(<span class="number">6</span>),rand_num(),rand_num());</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>; #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    REPEAT</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` ( name,age,sex ) <span class="keyword">VALUES</span> (&quot;atguigu&quot;,rand_num(<span class="number">1</span>,<span class="number">20</span>),&quot;male&quot;);</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h3 id="2-9-mysqldumpå¸¸ç”¨é€‰é¡¹">2.9 mysqldumpå¸¸ç”¨é€‰é¡¹</h3><p>mysqldumpå…¶ä»–å¸¸ç”¨é€‰é¡¹å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--add-drop-databaseï¼šåœ¨æ¯ä¸ªCREATE DATABASEè¯­å¥å‰æ·»åŠ DROP DATABASEè¯­å¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--add-drop-tablesï¼šåœ¨æ¯ä¸ªCREATE TABLEè¯­å¥å‰æ·»åŠ DROP TABLEè¯­å¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--add-lockingï¼šç”¨LOCK TABLESå’ŒUNLOCK TABLESè¯­å¥å¼•ç”¨æ¯ä¸ªè¡¨è½¬å‚¨ã€‚é‡è½½è½¬å‚¨æ–‡ä»¶æ—¶æ’å…¥å¾—æ›´å¿«ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--all-database, -Aï¼šè½¬å‚¨æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ã€‚ä¸ä½¿ç”¨--databaseé€‰é¡¹ç›¸åŒï¼Œåœ¨å‘½ä»¤è¡Œä¸­å‘½åæ‰€æœ‰æ•°æ®åº“ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--comment[=0|1]ï¼šå¦‚æœè®¾ç½®ä¸º0ï¼Œç¦æ­¢è½¬å‚¨æ–‡ä»¶ä¸­çš„å…¶ä»–ä¿¡æ¯ï¼Œä¾‹å¦‚ç¨‹åºç‰ˆæœ¬ã€æœåŠ¡å™¨ç‰ˆæœ¬å’Œä¸»æœºã€‚--skipcommentsä¸--comments=0çš„ç»“æœç›¸åŒã€‚é»˜è®¤å€¼ä¸º1ï¼Œå³åŒ…æ‹¬é¢å¤–ä¿¡æ¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--compactï¼šäº§ç”Ÿå°‘é‡è¾“å‡ºã€‚è¯¥é€‰é¡¹ç¦ç”¨æ³¨é‡Šå¹¶å¯ç”¨--skip-add-drop-tablesã€--no-set-namesã€--skipdisable-keyså’Œ--skip-add-lockingé€‰é¡¹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--compatible=nameï¼šäº§ç”Ÿä¸å…¶ä»–æ•°æ®åº“ç³»ç»Ÿæˆ–æ—§çš„MySQLæœåŠ¡å™¨æ›´å…¼å®¹çš„è¾“å‡ºï¼Œå€¼å¯ä»¥ä¸ºansiã€MySQL323ã€MySQL40ã€postgresqlã€oracleã€mssqlã€db2ã€maxdbã€no_key_optionsã€no_table_optionsæˆ–è€…no_field_optionsã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--complete_insert, -cï¼šä½¿ç”¨åŒ…æ‹¬åˆ—åçš„å®Œæ•´çš„INSERTè¯­å¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--debug[=debug_options], -#[debug_options]ï¼šå†™è°ƒè¯•æ—¥å¿—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--deleteï¼Œ-Dï¼šå¯¼å…¥æ–‡æœ¬æ–‡ä»¶å‰æ¸…ç©ºè¡¨ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--default-character-set=charsetï¼šä½¿ç”¨charsetsé»˜è®¤å­—ç¬¦é›†ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå°±ä½¿ç”¨utf8ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--delete--master-logsï¼šåœ¨ä¸»å¤åˆ¶æœåŠ¡å™¨ä¸Šï¼Œå®Œæˆè½¬å‚¨æ“ä½œååˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å¯ç”¨-masterdataã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--extended-insertï¼Œ-eï¼šä½¿ç”¨åŒ…æ‹¬å‡ ä¸ªVALUESåˆ—è¡¨çš„å¤šè¡ŒINSERTè¯­æ³•ã€‚è¿™æ ·ä½¿å¾—è½¬å‚¨æ–‡ä»¶æ›´å°ï¼Œé‡è½½æ–‡ä»¶æ—¶å¯ä»¥åŠ é€Ÿæ’å…¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--flush-logsï¼Œ-Fï¼šå¼€å§‹è½¬å‚¨å‰åˆ·æ–°MySQLæœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶ã€‚è¯¥é€‰é¡¹è¦æ±‚RELOADæƒé™ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--forceï¼Œ-fï¼šåœ¨è¡¨è½¬å‚¨è¿‡ç¨‹ä¸­ï¼Œå³ä½¿å‡ºç°SQLé”™è¯¯ä¹Ÿç»§ç»­ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--lock-all-tablesï¼Œ-xï¼šå¯¹æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨åŠ é”ã€‚åœ¨æ•´ä½“è½¬å‚¨è¿‡ç¨‹ä¸­é€šè¿‡å…¨å±€é”å®šæ¥å®ç°ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­--single-transactionå’Œ--lock-tablesã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--lock-tablesï¼Œ-lï¼šå¼€å§‹è½¬å‚¨å‰é”å®šæ‰€æœ‰è¡¨ã€‚ç”¨READ LOCALé”å®šè¡¨ä»¥å…è®¸å¹¶è¡Œæ’å…¥MyISAMè¡¨ã€‚å¯¹äºäº‹åŠ¡è¡¨ï¼ˆä¾‹å¦‚InnoDBå’ŒBDBï¼‰ï¼Œ--single-transactionæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰é¡¹ï¼Œå› ä¸ºå®ƒæ ¹æœ¬ä¸éœ€è¦é”å®šè¡¨ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--no-create-dbï¼Œ-nï¼šè¯¥é€‰é¡¹ç¦ç”¨CREATE DATABASE /*!32312 IF NOT EXIST*/db_nameè¯­å¥ï¼Œå¦‚æœç»™å‡º--databaseæˆ–--all-databaseé€‰é¡¹ï¼Œå°±åŒ…å«åˆ°è¾“å‡ºä¸­ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--no-create-infoï¼Œ-tï¼šåªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE TABLEè¯­å¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--no-dataï¼Œ-dï¼šä¸å†™è¡¨çš„ä»»ä½•è¡Œä¿¡æ¯ï¼Œåªè½¬å‚¨è¡¨çš„ç»“æ„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--optï¼šè¯¥é€‰é¡¹æ˜¯é€Ÿè®°ï¼Œå®ƒå¯ä»¥å¿«é€Ÿè¿›è¡Œè½¬å‚¨æ“ä½œå¹¶äº§ç”Ÿä¸€ä¸ªèƒ½å¾ˆå¿«è£…å…¥MySQLæœåŠ¡å™¨çš„è½¬å‚¨æ–‡ä»¶ã€‚è¯¥é€‰é¡¹é»˜è®¤å¼€å¯ï¼Œä½†å¯ä»¥ç”¨--skip-optç¦ç”¨ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--password[=password]ï¼Œ-p[password]ï¼šå½“è¿æ¥æœåŠ¡å™¨æ—¶ä½¿ç”¨çš„å¯†ç ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="operator">-</span>port<span class="operator">=</span>port_numï¼Œ<span class="operator">-</span>P port_numï¼šç”¨äºè¿æ¥çš„TCP<span class="operator">/</span>IPç«¯å£å·ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">--protocol=&#123;TCP|SOCKET|PIPE|MEMORY&#125;ï¼šä½¿ç”¨çš„è¿æ¥åè®®ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--replaceï¼Œ-r â€“replaceå’Œ--ignoreï¼šæ§åˆ¶æ›¿æ¢æˆ–å¤åˆ¶å”¯ä¸€é”®å€¼å·²æœ‰è®°å½•çš„è¾“å…¥è®°å½•çš„å¤„ç†ã€‚å¦‚æœæŒ‡å®š--replaceï¼Œæ–°è¡Œæ›¿æ¢æœ‰ç›¸åŒçš„å”¯ä¸€é”®å€¼çš„å·²æœ‰è¡Œï¼›å¦‚æœæŒ‡å®š--ignoreï¼Œå¤åˆ¶å·²æœ‰çš„å”¯ä¸€é”®å€¼çš„è¾“å…¥è¡Œè¢«è·³è¿‡ã€‚å¦‚æœä¸æŒ‡å®šè¿™ä¸¤ä¸ªé€‰é¡¹ï¼Œå½“å‘ç°ä¸€ä¸ªå¤åˆ¶é”®å€¼æ—¶ä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä¸”å¿½è§†æ–‡æœ¬æ–‡ä»¶çš„å‰©ä½™éƒ¨åˆ†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--silentï¼Œ-sï¼šæ²‰é»˜æ¨¡å¼ã€‚åªæœ‰å‡ºç°é”™è¯¯æ—¶æ‰è¾“å‡ºã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--socket=pathï¼Œ-S pathï¼šå½“è¿æ¥localhostæ—¶ä½¿ç”¨çš„å¥—æ¥å­—æ–‡ä»¶ï¼ˆä¸ºé»˜è®¤ä¸»æœºï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--user=user_nameï¼Œ-u user_nameï¼šå½“è¿æ¥æœåŠ¡å™¨æ—¶MySQLä½¿ç”¨çš„ç”¨æˆ·åã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--verboseï¼Œ-vï¼šå†—é•¿æ¨¡å¼ï¼Œæ‰“å°å‡ºç¨‹åºæ“ä½œçš„è¯¦ç»†ä¿¡æ¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--xmlï¼Œ-Xï¼šäº§ç”ŸXMLè¾“å‡ºã€‚</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œå¸®åŠ©å‘½ä»¤ <code>mysqldump --help</code> ï¼Œå¯ä»¥è·å¾—ç‰¹å®šç‰ˆæœ¬çš„å®Œæ•´é€‰é¡¹åˆ—è¡¨ã€‚</p><blockquote><p>æç¤º å¦‚æœè¿è¡Œmysqldumpæ²¡æœ‰â€“quickæˆ–â€“opté€‰é¡¹ï¼Œmysqldumpåœ¨è½¬å‚¨ç»“æœå‰å°†æ•´ä¸ªç»“æœé›†è£…å…¥å†… å­˜ã€‚å¦‚æœè½¬å‚¨å¤§æ•°æ®åº“å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œè¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œä½†å¯ä»¥ç”¨â€“skip-optç¦ç”¨ã€‚å¦‚æœä½¿ç”¨æœ€ æ–°ç‰ˆæœ¬çš„mysqldumpç¨‹åºå¤‡ä»½æ•°æ®ï¼Œå¹¶ç”¨äºæ¢å¤åˆ°æ¯”è¾ƒæ—§ç‰ˆæœ¬çš„MySQLæœåŠ¡å™¨ä¸­ï¼Œåˆ™ä¸è¦ä½¿ç”¨â€“opt æˆ–-eé€‰é¡¹ã€‚</p></blockquote><hr><h2 id="3-mysqlå‘½ä»¤æ¢å¤æ•°æ®">3. mysqlå‘½ä»¤æ¢å¤æ•°æ®</h2><p>ä½¿ç”¨mysqldumpå‘½ä»¤å°†æ•°æ®åº“ä¸­çš„æ•°æ®å¤‡ä»½æˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚éœ€è¦æ¢å¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>mysqlå‘½ä»¤</code>æ¥æ¢å¤å¤‡ä»½çš„æ•°æ®ã€‚</p><p>mysqlå‘½ä»¤å¯ä»¥æ‰§è¡Œå¤‡ä»½æ–‡ä»¶ä¸­çš„<code>CREATEè¯­å¥</code>å’Œ<code>INSERTè¯­å¥</code>ã€‚é€šè¿‡CREATEè¯­å¥æ¥åˆ›å»ºæ•°æ®åº“å’Œè¡¨ã€‚é€šè¿‡INSERTè¯­å¥æ¥æ’å…¥å¤‡ä»½çš„æ•°æ®ã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql â€“u root â€“p [dbname] <span class="operator">&lt;</span> backup.sql</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œdbnameå‚æ•°è¡¨ç¤ºæ•°æ®åº“åç§°ã€‚è¯¥å‚æ•°æ˜¯å¯é€‰å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šæ•°æ®åº“åï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šã€‚æŒ‡å®šæ•°æ®åº“åæ—¶ï¼Œè¡¨ç¤ºè¿˜åŸè¯¥æ•°æ®åº“ä¸‹çš„è¡¨ã€‚æ­¤æ—¶éœ€è¦ç¡®ä¿MySQLæœåŠ¡å™¨ä¸­å·²ç»åˆ›å»ºäº†è¯¥åçš„æ•°æ®åº“ã€‚ä¸æŒ‡å®šæ•°æ®åº“åï¼Œè¡¨ç¤ºè¿˜åŸæ–‡ä»¶ä¸­æ‰€æœ‰çš„æ•°æ®åº“ã€‚æ­¤æ—¶sqlæ–‡ä»¶ä¸­åŒ…å«æœ‰CREATE DATABASEè¯­å¥ï¼Œä¸éœ€è¦MySQLæœåŠ¡å™¨ä¸­å·²å­˜åœ¨çš„è¿™äº›æ•°æ®åº“ã€‚</p><h3 id="3-1-å•åº“å¤‡ä»½ä¸­æ¢å¤å•åº“">3.1 å•åº“å¤‡ä»½ä¸­æ¢å¤å•åº“</h3><p>ä½¿ç”¨rootç”¨æˆ·ï¼Œå°†ä¹‹å‰ç»ƒä¹ ä¸­å¤‡ä»½çš„atguigu.sqlæ–‡ä»¶ä¸­çš„å¤‡ä»½å¯¼å…¥æ•°æ®åº“ä¸­ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><p>å¦‚æœå¤‡ä»½æ–‡ä»¶ä¸­åŒ…å«äº†åˆ›å»ºæ•°æ®åº“çš„è¯­å¥ï¼Œåˆ™æ¢å¤çš„æ—¶å€™ä¸éœ€è¦æŒ‡å®šæ•°æ®åº“åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">&lt;</span> atguigu.sql</span><br></pre></td></tr></table></figure><p>å¦åˆ™éœ€è¦æŒ‡å®šæ•°æ®åº“åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu4<span class="operator">&lt;</span> atguigu.sql</span><br></pre></td></tr></table></figure><h3 id="3-2-å…¨é‡å¤‡ä»½æ¢å¤">3.2 å…¨é‡å¤‡ä»½æ¢å¤</h3><p>å¦‚æœæˆ‘ä»¬ç°åœ¨æœ‰æ˜¨å¤©çš„å…¨é‡å¤‡ä»½ï¼Œç°åœ¨æƒ³æ•´ä¸ªæ¢å¤ï¼Œåˆ™å¯ä»¥è¿™æ ·æ“ä½œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql â€“u root â€“p <span class="operator">&lt;</span> all.sql</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>pxxxxxx <span class="operator">&lt;</span> all.sql</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œåï¼ŒMySQLæ•°æ®åº“ä¸­å°±å·²ç»æ¢å¤äº†all.sqlæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®åº“ã€‚</p><h3 id="3-3-å…¨é‡å¤‡ä»½æ¢å¤">3.3 å…¨é‡å¤‡ä»½æ¢å¤</h3><p>å¯èƒ½æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬åªæƒ³æ¢å¤æŸä¸€ä¸ªåº“ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰çš„æ˜¯æ•´ä¸ªå®ä¾‹çš„å¤‡ä»½ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä»å…¨é‡å¤‡ä»½ä¸­åˆ†ç¦»å‡ºå•ä¸ªåº“çš„å¤‡ä»½ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="operator">-</span>n <span class="string">&#x27;/^-- Current Database: `atguigu`/,/^-- Current Database: `/p&#x27;</span> all_database.sql <span class="operator">&gt;</span> atguigu.sql</span><br><span class="line">#åˆ†ç¦»å®Œæˆåæˆ‘ä»¬å†å¯¼å…¥atguigu.sqlå³å¯æ¢å¤å•ä¸ªåº“</span><br></pre></td></tr></table></figure><h3 id="3-4-ä»å•åº“å¤‡ä»½ä¸­æ¢å¤å•è¡¨">3.4 ä»å•åº“å¤‡ä»½ä¸­æ¢å¤å•è¡¨</h3><p>è¿™ä¸ªéœ€æ±‚è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬çŸ¥é“å“ªä¸ªè¡¨è¯¯æ“ä½œäº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨å•è¡¨æ¢å¤çš„æ–¹å¼æ¥æ¢å¤ã€‚</p><p>ä¸¾ä¾‹ï¼šæˆ‘ä»¬æœ‰atguiguæ•´åº“çš„å¤‡ä»½ï¼Œä½†æ˜¯ç”±äºclassè¡¨è¯¯æ“ä½œï¼Œéœ€è¦å•ç‹¬æ¢å¤å‡ºè¿™å¼ è¡¨ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat atguigu.sql <span class="operator">|</span> sed <span class="operator">-</span>e <span class="string">&#x27;/./&#123;H;$!d;&#125;&#x27;</span> <span class="operator">-</span>e <span class="string">&#x27;x;/CREATE TABLE `class`/!d;q&#x27;</span> <span class="operator">&gt;</span> class_structure.sql</span><br><span class="line">cat atguigu.sql <span class="operator">|</span> grep <span class="comment">--ignore-case &#x27;insert into `class`&#x27; &gt; class_data.sql</span></span><br><span class="line">#ç”¨shellè¯­æ³•åˆ†ç¦»å‡ºåˆ›å»ºè¡¨çš„è¯­å¥åŠæ’å…¥æ•°æ®çš„è¯­å¥å å†ä¾æ¬¡å¯¼å‡ºå³å¯å®Œæˆæ¢å¤</span><br><span class="line"></span><br><span class="line">use atguigu;</span><br><span class="line">mysql<span class="operator">&gt;</span> source class_structure.sql;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> source class_data.sql;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><hr><h2 id="4-ç‰©ç†å¤‡ä»½ï¼šç›´æ¥å¤åˆ¶æ•´ä¸ªæ•°æ®åº“">4. ç‰©ç†å¤‡ä»½ï¼šç›´æ¥å¤åˆ¶æ•´ä¸ªæ•°æ®åº“</h2><p>ç›´æ¥å°†MySQLä¸­çš„æ•°æ®åº“æ–‡ä»¶å¤åˆ¶å‡ºæ¥ã€‚è¿™ç§æ–¹æ³•æœ€ç®€å•ï¼Œé€Ÿåº¦ä¹Ÿæœ€å¿«ã€‚MySQLçš„æ•°æ®åº“ç›®å½•ä½ç½®ä¸ä¸€ å®šç›¸åŒï¼š</p><ul><li>åœ¨Windowså¹³å°ä¸‹ï¼ŒMySQL 8.0å­˜æ”¾æ•°æ®åº“çš„ç›®å½•é€šå¸¸é»˜è®¤ä¸º â€œ C:\ProgramData\MySQL\MySQL Server 8.0\Data â€æˆ–è€…å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰ç›®å½•ï¼›</li><li>åœ¨Linuxå¹³å°ä¸‹ï¼Œæ•°æ®åº“ç›®å½•ä½ç½®é€šå¸¸ä¸º/var/lib/mysql/ï¼›</li><li>åœ¨MAC OSXå¹³å°ä¸‹ï¼Œæ•°æ®åº“ç›®å½•ä½ç½®é€šå¸¸ä¸ºâ€œ/usr/local/mysql/dataâ€</li></ul><p>ä½†ä¸ºäº†ä¿è¯å¤‡ä»½çš„ä¸€è‡´æ€§ã€‚éœ€è¦ä¿è¯ï¼š</p><ul><li>æ–¹å¼1ï¼šå¤‡ä»½å‰ï¼Œå°†æœåŠ¡å™¨åœæ­¢ã€‚</li><li>æ–¹å¼2ï¼šå¤‡ä»½å‰ï¼Œå¯¹ç›¸å…³è¡¨æ‰§è¡Œ FLUSH TABLES WITH READ LOCK æ“ä½œã€‚è¿™æ ·å½“å¤åˆ¶æ•°æ®åº“ç›®å½•ä¸­ çš„æ–‡ä»¶æ—¶ï¼Œå…è®¸å…¶ä»–å®¢æˆ·ç»§ç»­æŸ¥è¯¢è¡¨ã€‚åŒæ—¶ï¼ŒFLUSH TABLESè¯­å¥æ¥ç¡®ä¿å¼€å§‹å¤‡ä»½å‰å°†æ‰€æœ‰æ¿€æ´»çš„ç´¢ å¼•é¡µå†™å…¥ç¡¬ç›˜ã€‚</li></ul><p>è¿™ç§æ–¹å¼æ–¹ä¾¿ã€å¿«é€Ÿï¼Œä½†ä¸æ˜¯æœ€å¥½çš„å¤‡ä»½æ–¹æ³•ï¼Œå› ä¸ºå®é™…æƒ…å†µå¯èƒ½ <code>ä¸å…è®¸åœæ­¢MySQLæœåŠ¡å™¨</code> æˆ–è€… <code>é”ä½è¡¨</code> ï¼Œè€Œä¸”è¿™ç§æ–¹æ³• å¯¹InnoDBå­˜å‚¨å¼•æ“ çš„è¡¨ä¸é€‚ç”¨ã€‚å¯¹äºMyISAMå­˜å‚¨å¼•æ“çš„è¡¨ï¼Œè¿™æ ·å¤‡ä»½å’Œè¿˜åŸå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯è¿˜åŸæ—¶æœ€å¥½æ˜¯ç›¸åŒç‰ˆæœ¬çš„MySQLæ•°æ®åº“ï¼Œå¦åˆ™å¯èƒ½ä¼šå­˜åœ¨æ–‡ä»¶ç±»å‹ä¸åŒçš„æƒ…å†µã€‚</p><p>æ³¨æ„ï¼Œç‰©ç†å¤‡ä»½å®Œæ¯•åï¼Œæ‰§è¡Œ UNLOCK TABLES æ¥ç»“ç®—å…¶ä»–å®¢æˆ·å¯¹è¡¨çš„ä¿®æ”¹è¡Œä¸ºã€‚</p><blockquote><p>è¯´æ˜ï¼š åœ¨MySQLç‰ˆæœ¬å·ä¸­ï¼Œç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¸»ç‰ˆæœ¬å·ï¼Œä¸»ç‰ˆæœ¬å·ç›¸åŒçš„MySQLæ•°æ®åº“æ–‡ä»¶æ ¼å¼ç›¸åŒã€‚</p></blockquote><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥è€ƒè™‘ä½¿ç”¨ç›¸å…³å·¥å…·å®ç°å¤‡ä»½ã€‚æ¯”å¦‚ï¼Œ <code>MySQLhotcopy</code> å·¥å…·ã€‚MySQLhotcopyæ˜¯ä¸€ä¸ªPerlè„šæœ¬ï¼Œå®ƒä½¿ç”¨LOCK TABLESã€FLUSH TABLESå’Œcpæˆ–scpæ¥å¿«é€Ÿå¤‡ä»½æ•°æ®åº“ã€‚å®ƒæ˜¯å¤‡ä»½æ•°æ®åº“æˆ–å•ä¸ªè¡¨æœ€å¿«çš„é€”å¾„ï¼Œä½†å®ƒåªèƒ½è¿è¡Œåœ¨æ•°æ®åº“ç›®å½•æ‰€åœ¨çš„æœºå™¨ä¸Šï¼Œå¹¶ä¸”åªèƒ½å¤‡ä»½MyISAMç±»å‹çš„è¡¨ã€‚å¤šç”¨äºmysql5.5ä¹‹å‰ã€‚</p><h2 id="5-ç‰©ç†æ¢å¤ï¼šç›´æ¥å¤åˆ¶åˆ°æ•°æ®åº“ç›®å½•">5. ç‰©ç†æ¢å¤ï¼šç›´æ¥å¤åˆ¶åˆ°æ•°æ®åº“ç›®å½•</h2><p><strong>æ­¥éª¤ï¼š</strong></p><p>1ï¼‰æ¼”ç¤ºåˆ é™¤å¤‡ä»½çš„æ•°æ®åº“ä¸­æŒ‡å®šè¡¨çš„æ•°æ®</p><p>2ï¼‰å°†å¤‡ä»½çš„æ•°æ®åº“æ•°æ®æ‹·è´åˆ°æ•°æ®ç›®å½•ä¸‹ï¼Œå¹¶é‡å¯MySQLæœåŠ¡å™¨</p><p>3ï¼‰æŸ¥è¯¢ç›¸å…³è¡¨çš„æ•°æ®æ˜¯å¦æ¢å¤ã€‚éœ€è¦ä½¿ç”¨ä¸‹é¢çš„<code> chown</code> æ“ä½œã€‚</p><p><strong>è¦æ±‚ï¼š</strong></p><ul><li>å¿…é¡»ç¡®ä¿å¤‡ä»½æ•°æ®çš„æ•°æ®åº“å’Œå¾…æ¢å¤çš„æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»ç‰ˆæœ¬å·ç›¸åŒã€‚<ul><li>å› ä¸ºåªæœ‰MySQLæ•°æ®åº“ä¸»ç‰ˆæœ¬å·ç›¸åŒæ—¶ï¼Œæ‰èƒ½ä¿è¯è¿™ä¸¤ä¸ªMySQLæ•°æ®åº“æ–‡ä»¶ç±»å‹æ˜¯ç›¸åŒçš„ã€‚</li></ul></li><li>è¿™ç§æ–¹å¼å¯¹ <code>MyISAMç±»å‹çš„è¡¨æ¯”è¾ƒæœ‰æ•ˆ</code> ï¼Œå¯¹äºInnoDBç±»å‹çš„è¡¨åˆ™ä¸å¯ç”¨ã€‚<ul><li>å› ä¸ºInnoDBè¡¨çš„è¡¨ç©ºé—´ä¸èƒ½ç›´æ¥å¤åˆ¶ã€‚</li></ul></li><li>åœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹ï¼Œå¤åˆ¶åˆ°æ•°æ®åº“ç›®å½•åï¼Œä¸€å®šè¦å°†æ•°æ®åº“çš„ç”¨æˆ·å’Œç»„å˜æˆmysqlï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown <span class="operator">-</span>R mysql.mysql <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>dbname</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œä¸¤ä¸ªmysqlåˆ†åˆ«è¡¨ç¤ºç»„å’Œç”¨æˆ·ï¼›â€œ-Râ€å‚æ•°å¯ä»¥æ”¹å˜æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶çš„ç”¨æˆ·å’Œç»„ï¼›â€œdbnameâ€å‚æ•°è¡¨ç¤ºæ•°æ®åº“ç›®å½•ã€‚</p><blockquote><p>æç¤º Linuxæ“ä½œç³»ç»Ÿä¸‹çš„æƒé™è®¾ç½®éå¸¸ä¸¥æ ¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒMySQLæ•°æ®åº“åªæœ‰rootç”¨æˆ·å’Œmysqlç”¨æˆ· ç»„ä¸‹çš„mysqlç”¨æˆ·æ‰å¯ä»¥è®¿é—®ï¼Œå› æ­¤å°†æ•°æ®åº“ç›®å½•å¤åˆ¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹åï¼Œä¸€å®šè¦ä½¿ç”¨chownå‘½ä»¤å°† æ–‡ä»¶å¤¹çš„ç”¨æˆ·ç»„å˜ä¸ºmysqlï¼Œå°†ç”¨æˆ·å˜ä¸ºmysqlã€‚</p></blockquote><hr><h2 id="6-è¡¨çš„å¯¼å‡ºä¸å¯¼å…¥">6. è¡¨çš„å¯¼å‡ºä¸å¯¼å…¥</h2><h3 id="6-1-è¡¨çš„å¯¼å‡º">6.1 è¡¨çš„å¯¼å‡º</h3><div class="tabs" id="e07d7d47-d1c0-4a68-b584-44dd00f1d25b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#e07d7d47-d1c0-4a68-b584-44dd00f1d25b-1"><i class="fas fa-award"></i>SELECTâ€¦INTO OUTFILEå¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</button></li><li class="tab"><button type="button" data-href="#e07d7d47-d1c0-4a68-b584-44dd00f1d25b-2"><i class="fas fa-baseball-ball"></i>mysqldumpå‘½ä»¤å¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</button></li><li class="tab"><button type="button" data-href="#e07d7d47-d1c0-4a68-b584-44dd00f1d25b-3"><i class="fas fa-bone"></i>mysqlå‘½ä»¤å¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="e07d7d47-d1c0-4a68-b584-44dd00f1d25b-1"><p>åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨SELECTâ€¦INTO OUTFILEè¯­å¥å°†è¡¨çš„å†…å®¹å¯¼å‡ºæˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚</p><p>**ä¸¾ä¾‹ï¼š**ä½¿ç”¨SELECTâ€¦INTO OUTFILEå°†atguiguæ•°æ®åº“ä¸­accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ã€‚</p><p>ï¼ˆ1ï¼‰é€‰æ‹©æ•°æ®åº“atguiguï¼Œå¹¶æŸ¥è¯¢accountè¡¨ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use atguigu;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰ <span class="operator">|</span> <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> æå›› <span class="operator">|</span> <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span> ç‹äº” <span class="operator">|</span> <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰mysqlé»˜è®¤å¯¹å¯¼å‡ºçš„ç›®å½•æœ‰æƒé™é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œå¯¼å‡ºçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šç›®å½•è¿›è¡Œæ“ä½œã€‚</p><p>æŸ¥è¯¢secure_file_privå€¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%secure%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name            <span class="operator">|</span> <span class="keyword">Value</span>                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> require_secure_transport <span class="operator">|</span> OFF                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> secure_file_priv         <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">-</span>files<span class="operator">/</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p>å‚æ•°secure_file_privçš„å¯é€‰å€¼å’Œä½œç”¨åˆ†åˆ«æ˜¯ï¼š</p><ul><li><p>å¦‚æœè®¾ç½®ä¸ºemptyï¼Œè¡¨ç¤ºä¸é™åˆ¶æ–‡ä»¶ç”Ÿæˆçš„ä½ç½®ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„è®¾ç½®ï¼›</p></li><li><p>å¦‚æœè®¾è²·ä¸ºâ€”ä¸ªè¡¨ç¤ºè·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œå°±è¦æ±‚ç”Ÿæˆçš„æ–‡ä»¶åªèƒ½æ”¾åœ¨è¿™ä¸ªæŒ‡å®šçš„ç›®å½•ï¼Œæˆ–è€…å®ƒçš„å­ç›®å½•ï¼›</p></li><li><p>å¦‚æœè®¾ç½®ä¸ºNULLï¼Œå°±è¡¨ç¤ºç¦æ­¢åœ¨è¿™ä¸ªMySQLå®ä¾‹ä¸Šæ‰§è¡Œselectâ€¦ into outfile æ“ä½œã€‚</p></li></ul><p>ï¼ˆ3ï¼‰ä¸Šé¢ç»“æœä¸­æ˜¾ç¤ºï¼Œsecure_file_privå˜é‡çš„å€¼ä¸º/var/lib/mysql-files/ï¼Œå¯¼å‡ºç›®å½•è®¾ç½®ä¸ºè¯¥ç›®å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> account <span class="keyword">INTO</span> OUTFILE &quot;/var/lib/mysql-files/account.txt&quot;;</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æŸ¥çœ‹ /var/lib/mysql-files/account.txt`æ–‡ä»¶ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> å¼ ä¸‰ <span class="number">90</span></span><br><span class="line"><span class="number">2</span> æå›› <span class="number">100</span></span><br><span class="line"><span class="number">3</span> ç‹äº” <span class="number">0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e07d7d47-d1c0-4a68-b584-44dd00f1d25b-2"><p>**ä¸¾ä¾‹1ï¼š**ä½¿ç”¨mysqldumpå‘½ä»¤å°†å°†atguiguæ•°æ®åº“ä¸­accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>T &quot;/var/lib/mysql-files/&quot; atguigu account</span><br></pre></td></tr></table></figure><p>mysqldumpå‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œåœ¨æŒ‡å®šçš„ç›®å½•/var/lib/mysql-files/ä¸‹ç”Ÿæˆäº†account.sqlå’Œaccount.txtæ–‡ä»¶ã€‚</p><p>æ‰“å¼€account.sqlæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„CREATEè¯­å¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.sql</span><br><span class="line"><span class="comment">-- MySQL dump 10.13 Distrib 8.0.26, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: localhost Database: atguigu</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version 8.0.26</span></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET NAMES utf8mb4 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `account`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `account`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET character_set_client = utf8mb4 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account` (</span><br><span class="line">`id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`balance` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Dump completed on 2022-01-07 23:19:27</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€account.txtæ–‡ä»¶ï¼Œå…¶å†…å®¹åªåŒ…å«accountè¡¨ä¸­çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.txt</span><br><span class="line"><span class="number">1</span> å¼ ä¸‰ <span class="number">90</span></span><br><span class="line"><span class="number">2</span> æå›› <span class="number">100</span></span><br><span class="line"><span class="number">3</span> ç‹äº” <span class="number">0</span></span><br></pre></td></tr></table></figure><p>**ä¸¾ä¾‹2ï¼š**ä½¿ç”¨mysqldumpå°†atguiguæ•°æ®åº“ä¸­çš„accountè¡¨å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨FIELDSé€‰é¡¹ï¼Œè¦æ±‚å­—æ®µä¹‹ é—´ä½¿ç”¨é€—å·â€œï¼Œâ€é—´éš”ï¼Œæ‰€æœ‰å­—ç¬¦ç±»å‹å­—æ®µå€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>T &quot;/var/lib/mysql-files/&quot; atguigu account <span class="comment">--fields-terminatedby=&#x27;,&#x27; --fields-optionally-enclosed-by=&#x27;\&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¯­å¥mysqldumpè¯­å¥æ‰§è¡ŒæˆåŠŸä¹‹åï¼ŒæŒ‡å®šç›®å½•ä¸‹ä¼šå‡ºç°ä¸¤ä¸ªæ–‡ä»¶account.sqlå’Œaccount.txtã€‚</p><p>æ‰“å¼€account.sqlæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„CREATEè¯­å¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.sql</span><br><span class="line"><span class="comment">-- MySQL dump 10.13 Distrib 8.0.26, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: localhost Database: atguigu</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version 8.0.26</span></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET NAMES utf8mb4 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `account`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `account`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET character_set_client = utf8mb4 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account` (</span><br><span class="line">`id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`balance` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;</span><br><span class="line"><span class="comment">-- Dump completed on 2022-01-07 23:36:39</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€account.txtæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„æ•°æ®ã€‚ä»æ–‡ä»¶ä¸­å¯ä»¥çœ‹å‡ºï¼Œå­—æ®µä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œå­— ç¬¦ç±»å‹çš„å€¼è¢«åŒå¼•å·æ‹¬èµ·æ¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.txt</span><br><span class="line"><span class="number">1</span>,&quot;å¼ ä¸‰&quot;,<span class="number">90</span></span><br><span class="line"><span class="number">2</span>,&quot;æå››&quot;,<span class="number">100</span></span><br><span class="line"><span class="number">3</span>,&quot;ç‹äº”&quot;,<span class="number">0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e07d7d47-d1c0-4a68-b584-44dd00f1d25b-3"><p>**ä¸¾ä¾‹1ï¼š**ä½¿ç”¨mysqlè¯­å¥å¯¼å‡ºatguiguæ•°æ®ä¸­accountè¡¨ä¸­çš„è®°å½•åˆ°æ–‡æœ¬æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--execute=&quot;SELECT * FROM account;&quot; atguigu&gt; &quot;/var/lib/mysql-files/account.txt&quot;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€account.txtæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.txt</span><br><span class="line">id name balance</span><br><span class="line"><span class="number">1</span> å¼ ä¸‰ <span class="number">90</span></span><br><span class="line"><span class="number">2</span> æå›› <span class="number">100</span></span><br><span class="line"><span class="number">3</span> ç‹äº” <span class="number">0</span></span><br></pre></td></tr></table></figure><p>**ä¸¾ä¾‹2ï¼š**å°†atguiguæ•°æ®åº“accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨â€“veritcalå‚æ•°å°†è¯¥æ¡ä»¶è®°å½•åˆ†ä¸ºå¤šè¡Œæ˜¾ç¤ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--vertical --execute=&quot;SELECT * FROM account;&quot; atguigu &gt; &quot;/var/lib/mysql-files/account_1.txt&quot;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€account_1.txtæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account_1.txt</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">id: <span class="number">1</span></span><br><span class="line">name: å¼ ä¸‰</span><br><span class="line">balance: <span class="number">90</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">2.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">id: <span class="number">2</span></span><br><span class="line">name: æå››</span><br><span class="line">balance: <span class="number">100</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">3.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">id: <span class="number">3</span></span><br><span class="line">name: ç‹äº”</span><br><span class="line">balance: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>**ä¸¾ä¾‹3ï¼š**å°†atguiguæ•°æ®åº“accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°xmlæ–‡ä»¶ï¼Œä½¿ç”¨â€“xmlå‚æ•°ï¼Œå…·ä½“è¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--xml --execute=&quot;SELECT * FROM account;&quot; atguigu&gt;&quot;/var/lib/mysqlfiles/account_3.xml&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account_3.xml</span><br><span class="line"><span class="operator">&lt;</span>?xml version<span class="operator">=</span>&quot;1.0&quot;?<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>resultset statement<span class="operator">=</span>&quot;SELECT * FROM account&quot;</span><br><span class="line">xmlns:xsi<span class="operator">=</span>&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;id&quot;<span class="operator">&gt;</span><span class="number">1</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;name&quot;<span class="operator">&gt;</span>å¼ ä¸‰<span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;balance&quot;<span class="operator">&gt;</span><span class="number">90</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;id&quot;<span class="operator">&gt;</span><span class="number">2</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;name&quot;<span class="operator">&gt;</span>æå››<span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;balance&quot;<span class="operator">&gt;</span><span class="number">100</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;id&quot;<span class="operator">&gt;</span><span class="number">3</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;name&quot;<span class="operator">&gt;</span>ç‹äº”<span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;balance&quot;<span class="operator">&gt;</span><span class="number">0</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span>resultset<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå¦‚æœè¦å°†è¡¨æ•°æ®å¯¼å‡ºåˆ°htmlæ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>--html</code> é€‰é¡¹ã€‚ç„¶åå¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="6-2-è¡¨çš„å¯¼å…¥">6.2 è¡¨çš„å¯¼å…¥</h3><div class="tabs" id="2ca277d6-de61-4154-9f69-1b38e2f5ecd3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2ca277d6-de61-4154-9f69-1b38e2f5ecd3-1"><i class="fas fa-seedling"></i>LOAD DATA INFILEæ–¹å¼å¯¼å…¥æ–‡æœ¬æ–‡ä»¶</button></li><li class="tab"><button type="button" data-href="#2ca277d6-de61-4154-9f69-1b38e2f5ecd3-2"><i class="fas fa-leaf"></i>mysqlimportæ–¹å¼å¯¼å…¥æ–‡æœ¬æ–‡ä»¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2ca277d6-de61-4154-9f69-1b38e2f5ecd3-1"><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p>ä½¿ç”¨SELECTâ€¦INTO OUTFILEå°†atguiguæ•°æ®åº“ä¸­accountè¡¨çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigu.account <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/lib/mysql-files/account_0.txt&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åˆ é™¤accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> atguigu.account;</span><br></pre></td></tr></table></figure><p>ä»æ–‡æœ¬æ–‡ä»¶account.txtä¸­æ¢å¤æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">&#x27;/var/lib/mysql-files/account_0.txt&#x27;</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> atguigu.account;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰     <span class="operator">|</span> <span class="number">90</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> æå››     <span class="operator">|</span> <span class="number">100</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span> ç‹äº”     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong> é€‰æ‹©æ•°æ®åº“atguiguï¼Œä½¿ç”¨SELECTâ€¦INTO OUTFILEå°†atguiguæ•°æ®åº“accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨FIELDSé€‰é¡¹å’ŒLINESé€‰é¡¹ï¼Œè¦æ±‚å­—æ®µä¹‹é—´ä½¿ç”¨é€—å·&quot;ï¼Œ&quot;é—´éš”ï¼Œæ‰€æœ‰å­—æ®µå€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigu.account <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/lib/mysql-files/account_1.txt&#x27;</span> FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;\&quot;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åˆ é™¤accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> atguigu.account;</span><br></pre></td></tr></table></figure><p>ä»/var/lib/mysql-files/account.txtä¸­å¯¼å…¥æ•°æ®åˆ°accountè¡¨ä¸­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">&#x27;/var/lib/mysql-files/account_1.txt&#x27;</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> atguigu.account FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;\&quot;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢accountè¡¨ä¸­çš„æ•°æ®ï¼Œå…·ä½“SQLå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰     <span class="operator">|</span> <span class="number">90</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> æå››     <span class="operator">|</span> <span class="number">100</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span> ç‹äº”     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2ca277d6-de61-4154-9f69-1b38e2f5ecd3-2"><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>å¯¼å‡ºæ–‡ä»¶account.txtï¼Œå­—æ®µä¹‹é—´ä½¿ç”¨é€—å·&quot;ï¼Œ&quot;é—´éš”ï¼Œå­—æ®µå€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigu.account <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/lib/mysql-files/account.txt&#x27;</span> FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;\&quot;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åˆ é™¤accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> atguigu.account;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨mysqlimportå‘½ä»¤å°†account.txtæ–‡ä»¶å†…å®¹å¯¼å…¥åˆ°æ•°æ®åº“atguiguçš„accountè¡¨ä¸­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu <span class="string">&#x27;/var/lib/mysql-files/account.txt&#x27;</span> <span class="comment">--fields-terminated-by=&#x27;,&#x27; --fields-optionally-enclosed-by=&#x27;\&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰     <span class="operator">|</span> <span class="number">90</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> æå››     <span class="operator">|</span> <span class="number">100</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span> ç‹äº”     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="7-æ•°æ®åº“è¿ç§»">7. æ•°æ®åº“è¿ç§»</h2><h3 id="7-1-æ¦‚è¿°">7.1 æ¦‚è¿°</h3><p>æ•°æ®è¿ç§»ï¼ˆdata migrationï¼‰æ˜¯æŒ‡é€‰æ‹©ã€å‡†å¤‡ã€æå–å’Œè½¬æ¢æ•°æ®ï¼Œå¹¶<strong>å°†æ•°æ®ä»ä¸€ä¸ªè®¡ç®—æœºå­˜å‚¨ç³»ç»Ÿæ°¸ä¹…åœ°ä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºå­˜å‚¨ç³»ç»Ÿçš„è¿‡ç¨‹</strong>ã€‚æ­¤å¤–ï¼Œ<code> éªŒè¯è¿ç§»æ•°æ®çš„å®Œæ•´æ€§</code> å’Œ <code>é€€å½¹åŸæ¥æ—§çš„æ•°æ®å­˜å‚¨</code> ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯æ•´ä¸ªæ•°æ®è¿ç§»è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p><p>æ•°æ®åº“è¿ç§»çš„åŸå› æ˜¯å¤šæ ·çš„ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨æˆ–å­˜å‚¨è®¾å¤‡æ›´æ¢ã€ç»´æŠ¤æˆ–å‡çº§ï¼Œåº”ç”¨ç¨‹åºè¿ç§»ï¼Œç½‘ç«™é›†æˆï¼Œç¾éš¾æ¢å¤å’Œæ•°æ®ä¸­å¿ƒè¿ç§»ã€‚</p><p>æ ¹æ®ä¸åŒçš„éœ€æ±‚å¯èƒ½è¦é‡‡å–ä¸åŒçš„è¿ç§»æ–¹æ¡ˆï¼Œä½†æ€»ä½“æ¥è®²ï¼ŒMySQL æ•°æ®è¿ç§»æ–¹æ¡ˆå¤§è‡´å¯ä»¥åˆ†ä¸º<code>ç‰©ç†è¿ç§»</code>å’Œ <code>é€»è¾‘è¿ç§»</code> ä¸¤ç±»ã€‚é€šå¸¸ä»¥å°½å¯èƒ½ <code>è‡ªåŠ¨åŒ–</code> çš„æ–¹å¼æ‰§è¡Œï¼Œä»è€Œå°†äººåŠ›èµ„æºä»ç¹ççš„ä»»åŠ¡ä¸­è§£æ”¾å‡ºæ¥ã€‚</p><h3 id="7-2-è¿ç§»æ–¹æ¡ˆ">7.2 è¿ç§»æ–¹æ¡ˆ</h3><ul><li>ç‰©ç†è¿ç§»</li></ul><p>ç‰©ç†è¿ç§»é€‚ç”¨äºå¤§æ•°æ®é‡ä¸‹çš„æ•´ä½“è¿ç§»ã€‚ä½¿ç”¨ç‰©ç†è¿ç§»æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒå¿«é€Ÿï¼Œä½†éœ€è¦åœæœºè¿ç§»å¹¶ä¸”è¦ æ±‚ MySQL ç‰ˆæœ¬åŠé…ç½®å¿…é¡»å’ŒåŸæœåŠ¡å™¨ç›¸åŒï¼Œä¹Ÿå¯èƒ½å¼•èµ·æœªçŸ¥é—®é¢˜ã€‚</p><p>ç‰©ç†è¿ç§»åŒ…æ‹¬æ‹·è´æ•°æ®æ–‡ä»¶å’Œä½¿ç”¨ XtraBackup å¤‡ä»½å·¥å…·ä¸¤ç§ã€‚</p><p>ä¸åŒæœåŠ¡å™¨ä¹‹é—´å¯ä»¥é‡‡ç”¨ç‰©ç†è¿ç§»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–°çš„æœåŠ¡å™¨ä¸Šå®‰è£…å¥½åŒç‰ˆæœ¬çš„æ•°æ®åº“è½¯ä»¶ï¼Œåˆ›å»ºå¥½ç›¸åŒç›®å½•ï¼Œå»ºè®®é…ç½®æ–‡ä»¶ä¹Ÿè¦å’ŒåŸæ•°æ®åº“ç›¸åŒï¼Œç„¶åä»åŸæ•°æ®åº“æ–¹æ‹·è´æ¥æ•°æ®æ–‡ä»¶åŠæ—¥å¿—æ–‡ä»¶ï¼Œé…ç½®å¥½æ–‡ä»¶ç»„æƒé™ï¼Œä¹‹ååœ¨æ–°æœåŠ¡å™¨è¿™è¾¹ä½¿ç”¨ mysqld å‘½ä»¤å¯åŠ¨æ•°æ®åº“ã€‚</p><ul><li>é€»è¾‘è¿ç§»</li></ul><p>é€»è¾‘è¿ç§»é€‚ç”¨èŒƒå›´æ›´å¹¿ï¼Œæ— è®ºæ˜¯ <code>éƒ¨åˆ†è¿ç§»</code> è¿˜æ˜¯ <code>å…¨é‡è¿ç§»</code> ï¼Œéƒ½å¯ä»¥ä½¿ç”¨é€»è¾‘è¿ç§»ã€‚é€»è¾‘è¿ç§»ä¸­ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯é€šè¿‡ mysqldump ç­‰å¤‡ä»½å·¥å…·ã€‚</p><h3 id="7-3-è¿ç§»æ³¨æ„ç‚¹">7.3 è¿ç§»æ³¨æ„ç‚¹</h3><p><strong>1. ç›¸åŒç‰ˆæœ¬çš„æ•°æ®åº“ä¹‹é—´è¿ç§»æ³¨æ„ç‚¹</strong></p><p>æŒ‡çš„æ˜¯åœ¨ä¸»ç‰ˆæœ¬å·ç›¸åŒçš„MySQLæ•°æ®åº“ä¹‹é—´è¿›è¡Œæ•°æ®åº“ç§»åŠ¨ã€‚</p><p><code>æ–¹å¼1</code>ï¼š å› ä¸ºè¿ç§»å‰åMySQLæ•°æ®åº“çš„ <code>ä¸»ç‰ˆæœ¬å·ç›¸åŒ</code> ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å¤åˆ¶æ•°æ®åº“ç›®å½•æ¥å®ç°æ•°æ®åº“è¿ç§»ï¼Œä½†æ˜¯ç‰©ç†è¿ç§»æ–¹å¼åªé€‚ç”¨äºMyISAMå¼•æ“çš„è¡¨ã€‚å¯¹äºInnoDBè¡¨ï¼Œä¸èƒ½ç”¨ç›´æ¥å¤åˆ¶æ–‡ä»¶çš„æ–¹å¼å¤‡ä»½æ•°æ®åº“ã€‚</p><p><code>æ–¹å¼2</code>ï¼š æœ€å¸¸è§å’Œæœ€å®‰å…¨çš„æ–¹å¼æ˜¯ä½¿ç”¨ <code>mysqldumpå‘½ä»¤</code> å¯¼å‡ºæ•°æ®ï¼Œç„¶ååœ¨ç›®æ ‡æ•°æ®åº“æœåŠ¡å™¨ä¸­ä½¿ç”¨ MySQLå‘½ä»¤å¯¼å…¥ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#host1çš„æœºå™¨ä¸­å¤‡ä»½æ‰€æœ‰æ•°æ®åº“,å¹¶å°†æ•°æ®åº“è¿ç§»åˆ°åä¸ºhost2çš„æœºå™¨ä¸Š</span><br><span class="line">mysqldump â€“h host1 â€“uroot â€“p â€“<span class="operator">-</span><span class="keyword">all</span><span class="operator">-</span>databases<span class="operator">|</span></span><br><span class="line">mysql â€“h host2 â€“uroot â€“p</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°è¯­å¥ä¸­ï¼Œâ€œ|â€ç¬¦å·è¡¨ç¤ºç®¡é“ï¼Œå…¶ä½œç”¨æ˜¯å°†mysqldumpå¤‡ä»½çš„æ–‡ä»¶ç»™mysqlå‘½ä»¤ï¼›â€œâ€“all-databasesâ€è¡¨ç¤ºè¦è¿ç§»æ‰€æœ‰çš„æ•°æ®åº“ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥ç›´æ¥å®ç°è¿ç§»ã€‚</p><p><strong>2. ä¸åŒç‰ˆæœ¬çš„æ•°æ®åº“ä¹‹é—´è¿ç§»æ³¨æ„ç‚¹</strong></p><p>ä¾‹å¦‚ï¼ŒåŸæ¥å¾ˆå¤šæœåŠ¡å™¨ä½¿ç”¨5.7ç‰ˆæœ¬çš„MySQLæ•°æ®åº“ï¼Œåœ¨8.0ç‰ˆæœ¬æ¨å‡ºæ¥ä»¥åï¼Œæ”¹è¿›äº†5.7ç‰ˆæœ¬çš„å¾ˆå¤šç¼ºé™·ï¼Œ å› æ­¤éœ€è¦æŠŠæ•°æ®åº“å‡çº§åˆ°8.0ç‰ˆæœ¬</p><p>æ—§ç‰ˆæœ¬ä¸æ–°ç‰ˆæœ¬çš„MySQLå¯èƒ½ä½¿ç”¨ä¸åŒçš„é»˜è®¤å­—ç¬¦é›†ï¼Œä¾‹å¦‚æœ‰çš„æ—§ç‰ˆæœ¬ä¸­ä½¿ç”¨latin1ä½œä¸ºé»˜è®¤å­—ç¬¦é›†ï¼Œè€Œæœ€æ–°ç‰ˆæœ¬çš„MySQLé»˜è®¤å­—ç¬¦é›†ä¸ºutf8mb4ã€‚å¦‚æœæ•°æ®åº“ä¸­æœ‰ä¸­æ–‡æ•°æ®ï¼Œé‚£ä¹ˆè¿ç§»è¿‡ç¨‹ä¸­éœ€è¦å¯¹ <code>é»˜è®¤å­—ç¬¦é›†</code> è¿›è¡Œä¿®æ”¹ ï¼Œä¸ç„¶å¯èƒ½æ— æ³•æ­£å¸¸æ˜¾ç¤ºæ•°æ®ã€‚</p><p>é«˜ç‰ˆæœ¬çš„MySQLæ•°æ®åº“é€šå¸¸éƒ½ä¼š <code>å…¼å®¹ä½ç‰ˆæœ¬</code> ï¼Œå› æ­¤å¯ä»¥ä»ä½ç‰ˆæœ¬çš„MySQLæ•°æ®åº“è¿ç§»åˆ°é«˜ç‰ˆæœ¬çš„MySQL æ•°æ®åº“ã€‚</p><p><strong>3. ä¸åŒæ•°æ®åº“ä¹‹é—´è¿ç§»æ³¨æ„ç‚¹</strong></p><p>ä¸åŒæ•°æ®åº“ä¹‹é—´è¿ç§»æ˜¯æŒ‡ä»å…¶ä»–ç±»å‹çš„æ•°æ®åº“è¿ç§»åˆ°MySQLæ•°æ®åº“ï¼Œæˆ–è€…ä»MySQLæ•°æ®åº“è¿ç§»åˆ°å…¶ä»–ç±» å‹çš„æ•°æ®åº“ã€‚è¿™ç§è¿ç§»æ²¡æœ‰æ™®é€‚çš„è§£å†³æ–¹æ³•ã€‚</p><p>è¿ç§»ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä¸åŒæ•°æ®åº“çš„æ¶æ„ï¼Œ <code>æ¯”è¾ƒå®ƒä»¬ä¹‹é—´çš„å·®å¼‚</code> ã€‚ä¸åŒæ•°æ®åº“ä¸­å®šä¹‰ç›¸åŒç±»å‹çš„æ•°æ®çš„ <code>å…³é”®å­—å¯èƒ½ä¼šä¸åŒ</code> ã€‚ä¾‹å¦‚ï¼ŒMySQLä¸­æ—¥æœŸå­—æ®µåˆ†ä¸ºDATEå’ŒTIMEä¸¤ç§ï¼Œè€ŒORACLEæ—¥æœŸå­—æ®µåªæœ‰DATEï¼›SQL Serveræ•°æ®åº“ä¸­æœ‰ntextã€Imageç­‰æ•°æ®ç±»å‹ï¼ŒMySQLæ•°æ®åº“æ²¡æœ‰è¿™äº›æ•°æ®ç±»å‹ï¼›MySQLæ”¯æŒçš„ENUMå’ŒSET ç±»å‹ï¼Œè¿™äº›SQL Serveræ•°æ®åº“ä¸æ”¯æŒã€‚</p><p>å¦å¤–ï¼Œæ•°æ®åº“å‚å•†å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§SQLæ ‡å‡†æ¥è®¾è®¡æ•°æ®åº“ç³»ç»Ÿï¼Œå¯¼è‡´ä¸åŒçš„æ•°æ®åº“ç³»ç»Ÿçš„ <code>SQLè¯­å¥</code> æœ‰å·®åˆ«ã€‚ä¾‹å¦‚ï¼Œå¾®è½¯çš„SQL Serverè½¯ä»¶ä½¿ç”¨çš„æ˜¯T-SQLè¯­å¥ï¼ŒT-SQLä¸­åŒ…å«äº†éæ ‡å‡†çš„SQLè¯­å¥ï¼Œä¸èƒ½å’ŒMySQLçš„SQLè¯­å¥å…¼å®¹ã€‚</p><p>ä¸åŒç±»å‹æ•°æ®åº“ä¹‹é—´çš„å·®å¼‚é€ æˆäº†äº’ç›¸ <code>è¿ç§»çš„å›°éš¾</code> ï¼Œè¿™äº›å·®å¼‚å…¶å®æ˜¯å•†ä¸šå…¬å¸æ•…æ„é€ æˆçš„æŠ€æœ¯å£å’ã€‚ä½† æ˜¯ä¸åŒç±»å‹çš„æ•°æ®åº“ä¹‹é—´çš„è¿ç§»å¹¶ <code>ä¸æ˜¯å®Œå…¨ä¸å¯èƒ½</code> ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨<code> MyODBC</code> å®ç°MySQLå’ŒSQL Serverä¹‹ é—´çš„è¿ç§»ã€‚MySQLå®˜æ–¹æä¾›çš„å·¥å…· <code>MySQL Migration Toolkit</code> ä¹Ÿå¯ä»¥åœ¨ä¸åŒæ•°æ®ä¹‹é—´è¿›è¡Œæ•°æ®è¿ç§»ã€‚ MySQLè¿ç§»åˆ°Oracleæ—¶ï¼Œéœ€è¦ä½¿ç”¨mysqldumpå‘½ä»¤å¯¼å‡ºsqlæ–‡ä»¶ï¼Œç„¶åï¼Œ <code>æ‰‹åŠ¨æ›´æ”¹</code> sqlæ–‡ä»¶ä¸­çš„CREATEè¯­å¥ã€‚</p><h3 id="7-4-è¿ç§»å°ç»“">7.4 è¿ç§»å°ç»“</h3><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718165515965.png" alt="image-20220718165515965" style="zoom:67%;" /><hr><h2 id="8-åˆ åº“äº†ä¸æ•¢è·‘ï¼Œèƒ½å¹²ç‚¹å•¥ï¼Ÿ">8. åˆ åº“äº†ä¸æ•¢è·‘ï¼Œèƒ½å¹²ç‚¹å•¥ï¼Ÿ</h2><p>ä¼ ç»Ÿçš„é«˜å¯ç”¨æ¶æ„æ˜¯ä¸èƒ½é¢„é˜²è¯¯åˆ æ•°æ®çš„ï¼Œå› ä¸ºä¸»åº“çš„ä¸€ä¸ª<code>drop table</code>å‘½ä»¤ï¼Œä¼šé€šè¿‡binlogä¼ ç»™æ‰€æœ‰ä»åº“å’Œçº§è”ä»åº“ï¼Œè¿›è€Œå¯¼è‡´æ•´ä¸ªé›†ç¾¤çš„å®ä¾‹éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚</p><p>ä¸ºäº†æ‰¾åˆ°è§£å†³è¯¯åˆ æ•°æ®çš„æ›´é«˜æ•ˆçš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹å’ŒMySQLç›¸å…³çš„è¯¯åˆ æ•°æ®ï¼Œåšä¸‹åˆ†ç±»ï¼š</p><ol><li>ä½¿ç”¨deleteè¯­å¥è¯¯åˆ æ•°æ®è¡Œ;</li><li>ä½¿ç”¨drop tableæˆ–è€…truncate tableè¯­å¥è¯¯åˆ æ•°æ®è¡¨ï¼›</li><li>ä½¿ç”¨drop databaseè¯­å¥è¯¯åˆ æ•°æ®åº“ï¼›</li><li>ä½¿ç”¨rmå‘½ä»¤è¯¯åˆ æ•´ä¸ªMySQLå®ä¾‹ã€‚</li></ol><h3 id="8-1-deleteï¼šè¯¯åˆ è¡Œ">8.1 deleteï¼šè¯¯åˆ è¡Œ</h3><mark class="hl-label green">å¤„ç†æªæ–½1ï¼šæ•°æ®æ¢å¤</mark> <p>ä½¿ç”¨<code>Flashback</code>å·¥å…·æ¢å¤æ•°æ®ã€‚</p><p>åŸç†ï¼šä¿®æ”¹binlog å†…å®¹ï¼Œæ‹¿å›åŸåº“é‡æ”¾ã€‚å¦‚æœè¯¯åˆ æ•°æ®æ¶‰åŠåˆ°äº†å¤šä¸ªäº‹åŠ¡çš„è¯ï¼Œéœ€è¦å°†äº‹åŠ¡çš„é¡ºå­—è°ƒè¿‡æ¥å†æ‰§è¡Œã€‚</p><p>ä½¿ç”¨å‰æï¼šbinlog_format=row å’Œ binlog_row_image=FULLã€‚</p><mark class="hl-label green">å¤„ç†æªæ–½2ï¼šé¢„é˜²</mark> <ul><li><p>ä»£ç ä¸Šçº¿å‰ï¼Œå¿…é¡»SQLå®¡æŸ¥ã€å®¡è®¡ã€‚</p></li><li><p>å»ºè®®å¯ä»¥æ‰“å¼€å®‰å…¨æ¨¡å¼ï¼ŒæŠŠ<code>sql_safe_updates</code>å‚æ•°è®¾ç½®ä¸º onã€‚å¼ºåˆ¶è¦æ±‚åŠ  where æ¡ä»¶ä¸”whereåéœ€è¦æ˜¯ç´¢å¼•å­—æ®µï¼Œå¦åˆ™å¿…é¡»ä½¿ç”¨limitã€‚å¦åˆ™å°±ä¼šæŠ¥é”™ã€‚</p></li></ul><h3 id="8-2-truncate-drop-ï¼šè¯¯åˆ åº“-è¡¨">8.2 truncate/drop ï¼šè¯¯åˆ åº“/è¡¨</h3><p>èƒŒæ™¯ï¼š</p><p>deleteå…¨è¡¨æ˜¯å¾ˆæ…¢çš„ï¼Œéœ€è¦ç”Ÿæˆå›æ»šæ—¥å¿—ã€å†™redoã€å†™binlogã€‚æ‰€ä»¥ï¼Œä»æ€§èƒ½è§’åº¦è€ƒè™‘ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨truncate tableæˆ–è€…drop tableå‘½ä»¤ã€‚</p><p>ä½¿ç”¨deleteå‘½ä»¤åˆ é™¤çš„æ•°æ®ï¼Œä½ è¿˜å¯ä»¥ç”¨Flashbackæ¥æ¢å¤ã€‚è€Œä½¿ç”¨truncate /drop tableå’Œdrop databaseå‘½ä»¤åˆ é™¤çš„æ•°æ®ï¼Œå°±æ²¡åŠæ³•é€šè¿‡Flashbackæ¥æ¢å¤äº†ã€‚å› ä¸ºï¼Œå³ä½¿æˆ‘ä»¬é…ç½®äº† binlog_format=rowï¼Œæ‰§è¡Œè¿™ä¸‰ä¸ªå‘½ä»¤æ—¶ï¼Œè®°å½•çš„ binlogè¿˜æ˜¯statementæ ¼å¼ã€‚binlogé‡Œé¢å°±åªæœ‰ä¸€ä¸ªtruncate/drop è¯­å¥ï¼Œè¿™äº›ä¿¡æ¯æ˜¯æ¢å¤ä¸å‡ºæ•°æ®çš„ã€‚</p><p>æ–¹æ¡ˆï¼š</p><p>è¿™ç§æƒ…å†µä¸‹æ¢å¤æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨<code>å…¨é‡å¤‡ä»½</code>ä¸<code>å¢é‡æ—¥å¿—</code>ç»“åˆçš„æ–¹å¼ã€‚</p><p>æ–¹æ¡ˆçš„å‰æï¼šæœ‰å®šæœŸçš„å…¨é‡å¤‡ä»½ï¼Œå¹¶ä¸”å®æ—¶å¤‡ä»½binlogã€‚</p><p>ä¸¾ä¾‹ï¼šæœ‰äººè¯¯åˆ äº†ä¸€ä¸ªåº“ï¼Œæ—¶é—´ä¸ºä¸‹åˆ3ç‚¹ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>å–æœ€è¿‘ä¸€æ¬¡<code>å…¨é‡å¤‡ä»½</code>ã€‚å‡è®¾è®¾ç½®æ•°æ®åº“åº“æ˜¯ä¸€å¤©ä¸€å¤‡ï¼Œæœ€è¿‘å¤‡ä»½æ•°æ®æ˜¯å½“å¤©å‡Œæ™¨2ç‚¹ï¼›</p></li><li><p>ç”¨å¤‡ä»½æ¢å¤å‡ºä¸€ä¸ªä¸´æ—¶åº“ï¼›ï¼ˆæ³¨æ„ï¼šè¿™é‡Œé€‰æ‹©ä¸´æ—¶åº“ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œä¸»åº“)</p></li><li><p>å–å‡ºå‡Œæ™¨2ç‚¹ä¹‹åçš„binlogæ—¥å¿—ï¼›</p></li><li><p>å‰”é™¤è¯¯åˆ é™¤æ•°æ®çš„è¯­å¥å¤–ï¼Œå…¶å®ƒè¯­å¥å…¨éƒ¨åº”ç”¨åˆ°ä¸´æ—¶åº“ã€‚ï¼ˆå‰é¢è®²è¿‡binlogçš„æ¢å¤ï¼‰</p></li><li><p>æœ€åæ¢å¤åˆ°ä¸»åº“</p></li></ol><h3 id="8-3-é¢„é˜²ä½¿ç”¨truncate-dropè¯¯åˆ åº“-è¡¨">8.3 é¢„é˜²ä½¿ç”¨truncate/dropè¯¯åˆ åº“/è¡¨</h3><p>ä¸Šé¢æˆ‘ä»¬è¯´äº†ä½¿ç”¨truncate /dropè¯­å¥è¯¯åˆ åº“/è¡¨çš„æ¢å¤æ–¹æ¡ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥é€šè¿‡ä¸‹é¢å»ºè®®çš„æ–¹æ¡ˆæ¥å°½é‡çš„é¿å…ç±»ä¼¼çš„è¯¯æ“ä½œã€‚</p><p>ï¼ˆ1) æƒé™åˆ†ç¦»</p><ul><li><p>é™åˆ¶å¸æˆ·æƒé™ï¼Œæ ¸å¿ƒçš„æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½ä¸èƒ½éšä¾¿åˆ†é…å†™æƒé™ï¼Œæƒ³è¦è·å–å†™æƒé™éœ€è¦å®¡æ‰¹ã€‚æ¯”å¦‚åªç»™ä¸šåŠ¡å¼€å‘äººå‘˜DMLæƒé™ï¼Œä¸ç»™truncate/dropæƒé™ã€‚å³ä½¿æ˜¯DBAå›¢é˜Ÿæˆå‘˜ï¼Œæ—¥å¸¸ä¹Ÿéƒ½è§„å®šåªä½¿ç”¨åªè¯»è´¦å·ï¼Œå¿…è¦çš„æ—¶å€™æ‰ä½¿ç”¨æœ‰æ›´æ–°æƒé™çš„è´¦å·ã€‚</p></li><li><p>ä¸åŒçš„è´¦å·ï¼Œä¸åŒçš„æ•°æ®ä¹‹é—´è¦è¿›è¡Œæƒé™åˆ†ç¦»ï¼Œé¿å…ä¸€ä¸ªè´¦å·å¯ä»¥åˆ é™¤æ‰€æœ‰åº“ã€‚</p></li></ul><p>ï¼ˆ2)åˆ¶å®šæ“ä½œè§„èŒƒ</p><p>æ¯”å¦‚åœ¨åˆ é™¤æ•°æ®è¡¨ä¹‹å‰ï¼Œå¿…é¡»å…ˆå¯¹è¡¨åšæ”¹åæ“ä½œï¼ˆæ¯”å¦‚åŠ  _to_be_deleted)ã€‚ç„¶åï¼Œè§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œç¡®ä¿å¯¹ä¸šåŠ¡æ— å½±å“ä»¥åå†åˆ é™¤è¿™å¼ è¡¨ã€‚</p><p>(3) è®¾ç½®å»¶è¿Ÿå¤åˆ¶å¤‡åº“</p><p>ç®€å•çš„è¯´å»¶è¿Ÿå¤åˆ¶å°±æ˜¯è®¾ç½®ä¸€ä¸ªå›ºå®šçš„å»¶è¿Ÿæ—¶é—´ï¼Œæ¯”å¦‚1ä¸ªå°æ—¶ï¼Œè®©ä»åº“è½åä¸»åº“ä¸€ä¸ªå°æ—¶ã€‚å‡ºç°è¯¯åˆ é™¤æ“ä½œ1å°æ—¶å†…ï¼Œåˆ°è¿™ä¸ªå¤‡åº“ä¸Šæ‰§è¡Œstop slaveï¼Œå†é€šè¿‡ä¹‹å‰ä»‹ç»çš„æ–¹æ³•ï¼Œè·³è¿‡è¯¯æ“ä½œå‘½ä»¤ï¼Œå°±å¯ä»¥æ¢å¤å‡ºéœ€è¦çš„æ•°æ®ã€‚</p><p>è¿™é‡Œé€šè¿‡ CHANGE MASTER TO MASTER_DELAY=Nå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šè¿™ä¸ªå¤‡åº“æŒç»­ä¿æŒè·Ÿä¸»åº“æœ‰Nç§’çš„å»¶è¿Ÿã€‚æ¯”å¦‚æŠŠNè®¾ç½®ä¸º3600ï¼Œå³ä»£è¡¨1ä¸ªå°æ—¶ã€‚</p><p>æ­¤å¤–ï¼Œå»¶è¿Ÿå¤åˆ¶è¿˜å¯ä»¥ç”¨æ¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p><p>â‘  ç”¨æ¥åšå»¶è¿Ÿæ¸¬è¯•ï¼Œæ¯”å¦‚åšå¥½çš„æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼ŒæŠŠä»åº“ä½œä¸ºè¯»åº“ï¼Œé‚£ä¹ˆæƒ³çŸ¥é“å½“æ•°æ®äº§ç”Ÿå»¶è¿Ÿçš„æ—¶å€™åˆ°åº•ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ¨¡æ‹Ÿå»¶è¿Ÿã€‚</p><p>â‘¡ç”¨äºè€æ•°æ®çš„æŸ¥è¯¢ç­‰éœ€æ±‚ï¼Œæ¯”å¦‚ä½ ç»å¸¸éœ€è¦æŸ¥çœ‹æŸå¤©å‰ä¸€ä¸ªè¡¨æˆ–è€…å­—æ®µçš„æ•°å€¼ï¼Œä½ å¯èƒ½éœ€è¦æŠŠå¤‡ä»½æ¢å¤åè¿›è¡ŒæŸ¥çœ‹ï¼Œå¦‚æœæœ‰å»¶è¿Ÿä»åº“ï¼Œæ¯”å¦‚å»¶è¿Ÿä¸€å‘¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥è§£å†³è¿™æ ·ç±»ä¼¼çš„éœ€æ±‚ã€‚</p><h3 id="8-4-rmï¼šè¯¯åˆ MySQLå®ä¾‹">8.4 rmï¼šè¯¯åˆ MySQLå®ä¾‹</h3><p>å¯¹äºä¸€ä¸ªæœ‰é«˜å¯ç”¨æœºåˆ¶çš„MySQLé›†ç¾¤æ¥è¯´ï¼Œä¸ç”¨æ‹…å¿ƒrmåˆ é™¤æ•°æ®äº†ã€‚åªæ˜¯åˆ æ‰äº†å…¶ä¸­æŸä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®çš„è¯ï¼ŒHAç³»ç»Ÿå°±ä¼šå¼€å§‹å·¥ä½œï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„ä¸»åº“ï¼Œä»è€Œä¿è¯æ•´ä¸ªé›†ç¾¤çš„æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠæŠŠæ•°æ®æ¢å¤å›æ¥ï¼Œå†æ¥å…¥æ•´ä¸ªé›†ç¾¤ã€‚</p><p>ä½†å¦‚æœæ˜¯æ¶æ„åœ°æŠŠæ•´ä¸ªé›†ç¾¤åˆ é™¤ï¼Œé‚£å°±éœ€è¦è€ƒè™‘è·¨æœºæˆ¿å¤‡ä»½ï¼Œè·¨åŸå¸‚å¤‡ä»½ã€‚</p>]]></content>
    
    
    <summary type="html">ç‰©ç†å¤‡ä»½ã€é€»è¾‘å¤‡ä»½ã€æ•°æ®åº“è¿ç§»</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>ä¸»ä»å¤åˆ¶</title>
    <link href="https://wuwawawa.github.io/posts/351b5179.html"/>
    <id>https://wuwawawa.github.io/posts/351b5179.html</id>
    <published>2023-04-20T05:40:41.000Z</published>
    <updated>2023-04-19T03:55:14.937Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä¸»ä»å¤åˆ¶æ¦‚è¿°">1. ä¸»ä»å¤åˆ¶æ¦‚è¿°</h2><h3 id="1-1-å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›">1.1 å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›</h3><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å°†<code>Redis</code>ä½œä¸ºç¼“å­˜ä¸<code>MySQL</code>é…åˆæ¥ä½¿ç”¨ï¼Œå½“æœ‰è¯·æ±‚çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šä»ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥å–å‡ºã€‚å¦‚æœä¸å­˜åœ¨å†è®¿é—®æ•°æ®åº“ï¼Œè¿™æ ·å°±<code>æå‡äº†è¯»å–çš„æ•ˆç‡</code>ï¼Œä¹Ÿå‡å°‘äº†å¯¹åç«¯æ•°æ®åº“çš„<code>è®¿é—®å‹åŠ›</code>ã€‚Redisçš„ç¼“å­˜æ¶æ„æ˜¯<code>é«˜å¹¶å‘æ¶æ„</code>ä¸­éå¸¸é‡è¦çš„ä¸€ç¯ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715202237535.png" alt="image-20220715202237535" style="zoom: 67%;" /><p>æ­¤å¤–ï¼Œä¸€èˆ¬åº”ç”¨å¯¹æ•°æ®åº“è€Œè¨€éƒ½æ˜¯â€œ<code>è¯»å¤šå†™å°‘</code>â€ï¼Œä¹Ÿå°±è¯´å¯¹æ•°æ®åº“è¯»å–æ•°æ®çš„å‹åŠ›æ¯”è¾ƒå¤§ï¼Œæœ‰ä¸€ä¸ªæ€è·¯å°±æ˜¯é‡‡ç”¨æ•°æ®åº“é›†ç¾¤çš„æ–¹æ¡ˆï¼Œåš<code>ä¸»ä»æ¶æ„</code>ã€è¿›è¡Œ<code>è¯»å†™åˆ†ç¦»</code>ï¼Œè¿™æ ·åŒæ ·å¯ä»¥æå‡æ•°æ®åº“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œä¸»ä»æ¶æ„çš„è®¾ç½®ï¼Œæ¯•ç«Ÿè®¾ç½®æ¶æ„æœ¬èº«æ˜¯æœ‰æˆæœ¬çš„ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„ç›®çš„åœ¨äºæå‡æ•°æ®åº“é«˜å¹¶å‘è®¿é—®çš„æ•ˆç‡ï¼Œé‚£ä¹ˆé¦–å…ˆè€ƒè™‘çš„æ˜¯å¦‚ä½•<code>ä¼˜åŒ–SQLå’Œç´¢å¼•</code>ï¼Œè¿™ç§æ–¹å¼ ç®€å•æœ‰æ•ˆï¼›å…¶æ¬¡æ‰æ˜¯é‡‡ç”¨<code>ç¼“å­˜çš„ç­–ç•¥</code>ï¼Œæ¯”å¦‚ä½¿ç”¨ Rediså°†çƒ­ç‚¹æ•°æ®ä¿å­˜åœ¨å†…å­˜æ•°æ®åº“ä¸­ï¼Œæå‡è¯»å–çš„æ•ˆç‡ï¼›æœ€åæ‰æ˜¯å¯¹æ•°æ®åº“é‡‡ç”¨<code>ä¸»ä»æ¶æ„</code>ï¼Œè¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚</p><p>æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨å’Œç»´æŠ¤çš„æˆæœ¬æ˜¯ç”±ä½åˆ°é«˜çš„ã€‚</p><h3 id="1-2-ä¸»ä»å¤åˆ¶çš„ä½œç”¨">1.2 ä¸»ä»å¤åˆ¶çš„ä½œç”¨</h3><p>ä¸»ä»åŒæ­¥è®¾è®¡ä¸ä»…å¯ä»¥æé«˜æ•°æ®åº“çš„ååé‡ï¼Œè¿˜æœ‰ä»¥ä¸‹ 3 ä¸ªæ–¹é¢çš„ä½œç”¨ã€‚</p><span class='p green'>ç¬¬1ä¸ªä½œç”¨ï¼šè¯»å†™åˆ†ç¦»ã€‚</span>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸»ä»å¤åˆ¶çš„æ–¹å¼æ¥`åŒæ­¥æ•°æ®`ï¼Œç„¶åé€šè¿‡è¯»å†™åˆ†ç¦»æé«˜æ•°æ®åº“å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚<img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715212521601.png" alt="image-20220715212521601" style="zoom:50%;" /><p>å…¶ä¸­ä¸€ä¸ªæ˜¯Masterä¸»åº“ï¼Œè´Ÿè´£å†™å…¥æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šå†™åº“ã€‚</p><p>å…¶ä»–éƒ½æ˜¯Slaveä»åº“ï¼Œè´Ÿè´£è¯»å–æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šè¯»åº“ã€‚</p><p>å½“ä¸»åº“è¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°†æ•°æ®å¤åˆ¶åˆ°ä»åº“ä¸­ï¼Œè€Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¼šä»ä»åº“è¿›è¡Œè¯»å–ã€‚</p><p>é¢å¯¹â€œè¯»å¤šå†™å°‘â€çš„éœ€æ±‚ï¼Œé‡‡ç”¨è¯»å†™åˆ†ç¦»çš„æ–¹å¼ï¼Œå¯ä»¥å®ç°<code>æ›´é«˜çš„å¹¶å‘è®¿é—®</code>ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜èƒ½å¯¹ä»æœåŠ¡å™¨è¿›è¡Œ<code>è´Ÿè½½å‡è¡¡</code>ï¼Œè®©ä¸åŒçš„è¯»è¯·æ±‚æŒ‰ç…§ç­–ç•¥å‡åŒ€åœ°åˆ†å‘åˆ°ä¸åŒçš„ä»æœåŠ¡å™¨ä¸Šï¼Œè®©<code>è¯»å–æ›´åŠ é¡ºç•…</code>ã€‚è¯»å–é¡ºç•…çš„å¦ä¸€ä¸ªåŸå› ï¼Œå°±æ˜¯<code>å‡å°‘äº†é”è¡¨</code>çš„å½±å“ï¼Œæ¯”å¦‚æˆ‘ä»¬è®©ä¸»åº“è´Ÿè´£å†™ï¼Œå½“ä¸»åº“å‡ºç°å†™é”çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“åˆ°ä»åº“è¿›è¡ŒSELECTçš„è¯»å–ã€‚</p><span class='p green'>ç¬¬2ä¸ªä½œç”¨å°±æ˜¯æ•°æ®å¤‡ä»½ã€‚</span>æˆ‘ä»¬é€šè¿‡ä¸»ä»å¤åˆ¶å°†ä¸»åº“ä¸Šçš„æ•°æ®å¤åˆ¶åˆ°ä»åº“ä¸Šï¼Œç›¸å½“äºä¸€ç§`çƒ­å¤‡ä»½æœºåˆ¶`ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸»åº“æ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹è¿›è¡Œçš„å¤‡ä»½ï¼Œä¸ä¼šå½±å“åˆ°æœåŠ¡ã€‚<br/><span class='p green'>ç¬¬3ä¸ªä½œç”¨æ˜¯å…·æœ‰é«˜å¯ç”¨æ€§ã€‚</span>æ•°æ®å¤‡ä»½å®é™…ä¸Šæ˜¯ä¸€ç§å†—ä½™çš„æœºåˆ¶ï¼Œé€šè¿‡è¿™ç§å†—ä½™çš„æ–¹å¼å¯ä»¥æ¢å–æ•°æ®åº“çš„é«˜å¯ç”¨æ€§ï¼Œä¹Ÿå°±æ˜¯å½“æœåŠ¡å™¨å‡ºç°æ•…éšœæˆ–å®•æœºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ä»æœåŠ¡å™¨ä¸Šï¼Œä¿è¯æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚<p>å…³äºé«˜å¯ç”¨æ€§çš„ç¨‹åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæŒ‡æ ‡è¡¡é‡ï¼Œå³æ­£å¸¸å¯ç”¨æ—¶é—´/å…¨å¹´æ—¶é—´ã€‚æ¯”å¦‚è¦è¾¾åˆ°å…¨å¹´99.999%çš„æ—¶é—´éƒ½å¯ç”¨ï¼Œå°±æ„å‘³ç€ç³»ç»Ÿåœ¨ä¸€å¹´ä¸­çš„ä¸å¯ç”¨æ—¶é—´ä¸å¾—è¶…è¿‡ 3652460(1-99.999%ï¼‰=5.256 åˆ†é’Ÿï¼ˆå«ç³»ç»Ÿå´©æºƒçš„æ—¶é—´ã€æ—¥å¸¸ç»´æŠ¤æ“ä½œå¯¼è‡´çš„åœæœºæ—¶é—´ç­‰ï¼‰ï¼Œå…¶ä»–æ—¶é—´éƒ½éœ€è¦ä¿æŒå¯ç”¨çš„çŠ¶æ€ã€‚</p><p>å®é™…ä¸Šï¼Œæ›´é«˜çš„é«˜å¯ç”¨æ€§ï¼Œæ„å‘³ç€éœ€è¦ä»˜å‡ºæ›´é«˜çš„æˆæœ¬ä»£ä»·ã€‚åœ¨ç°å®ä¸­æˆ‘ä»¬éœ€è¦ç»“åˆä¸šåŠ¡éœ€æ±‚å’Œæˆæœ¬æ¥è¿›è¡Œé€‰æ‹©ã€‚</p><hr><h2 id="2-ä¸»ä»å¤åˆ¶çš„åŸç†">2. ä¸»ä»å¤åˆ¶çš„åŸç†</h2><p><code>Slave</code>ä¼šä»<code>Master</code>è¯»å–<code>binlog</code>æ¥è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p><h3 id="2-1-åŸç†å‰–æ">2.1 åŸç†å‰–æ</h3><mark class="hl-label blue">ä¸‰ä¸ªçº¿ç¨‹</mark> <p>å®é™…ä¸Šä¸»ä»åŒæ­¥çš„åŸç†å°±æ˜¯åŸºäº binlog è¿›è¡Œæ•°æ®åŒæ­¥çš„ã€‚åœ¨ä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¼šåŸºäº<code>3ä¸ªçº¿ç¨‹</code>æ¥æ“ä½œï¼Œä¸€ä¸ªä¸»åº“çº¿ç¨‹ï¼Œä¸¤ä¸ªä»åº“çº¿ç¨‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715215944767.png" alt="image-20220715215944767" style="zoom:67%;" /><p><code>äºŒè¿›åˆ¶æ—¥å¿—è½¬å‚¨çº¿ç¨‹</code>ï¼ˆBinlog dump threadï¼‰æ˜¯ä¸€ä¸ªä¸»åº“çº¿ç¨‹ã€‚å½“ä»åº“çº¿ç¨‹è¿æ¥çš„æ—¶å€™ï¼Œ ä¸»åº“å¯ä»¥å°†äºŒè¿› åˆ¶æ—¥å¿—å‘é€ç»™ä»åº“ï¼Œå½“ä¸»åº“è¯»å–äº‹ä»¶ï¼ˆEventï¼‰çš„æ—¶å€™ï¼Œä¼šåœ¨ Binlog ä¸Š<code>åŠ é”</code>ï¼Œè¯»å–å®Œæˆä¹‹åï¼Œå†å°†é”é‡Šæ”¾æ‰ã€‚</p><p><code>ä»åº“I/Oçº¿ç¨‹</code>ä¼šè¿æ¥åˆ°ä¸»åº“ï¼Œå‘ä¸»åº“å‘é€è¯·æ±‚æ›´æ–° Binlogã€‚è¿™æ—¶ä»åº“çš„ I/O çº¿ç¨‹å°±å¯ä»¥è¯»å–åˆ°ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—è½¬å‚¨çº¿ç¨‹å‘é€çš„ Binlog æ›´æ–°éƒ¨åˆ†ï¼Œå¹¶ä¸”æ‹·è´åˆ°æœ¬åœ°çš„ä¸­ç»§æ—¥å¿— ï¼ˆRelay logï¼‰ã€‚</p><p><code>ä»åº“SQLçº¿ç¨‹</code>ä¼šè¯»å–ä»åº“ä¸­çš„ä¸­ç»§æ—¥å¿—ï¼Œå¹¶ä¸”æ‰§è¡Œæ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†ä»åº“ä¸­çš„æ•°æ®ä¸ä¸»åº“ä¿æŒåŒæ­¥ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715220037213.png" alt="image-20220715220037213" style="zoom:67%;" /><blockquote><p>æ³¨æ„ï¼š</p><p>ä¸æ˜¯æ‰€æœ‰ç‰ˆæœ¬çš„MySQLéƒ½é»˜è®¤å¼€å¯æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚åœ¨è¿›è¡Œä¸»ä»åŒæ­¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²ç»å¼€å¯äº†äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p><p>é™¤éç‰¹æ®ŠæŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ä»æœåŠ¡å™¨ä¼šæ‰§è¡Œæ‰€æœ‰ä¸»æœåŠ¡å™¨ä¸­ä¿å­˜çš„äº‹ä»¶ã€‚ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ï¼Œä½¿ä»æœåŠ¡å™¨æ‰§è¡Œç‰¹å®šçš„äº‹ä»¶ã€‚</p></blockquote><mark class="hl-label green">å¤åˆ¶ä¸‰æ­¥éª¤</mark> <p>æ­¥éª¤1ï¼š<code>Master</code>å°†å†™æ“ä½œè®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆ<code>binlog</code>ï¼‰ã€‚</p><p>æ­¥éª¤2ï¼š<code>Slave</code>å°†<code>Master</code>çš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—ï¼ˆ<code>relay log</code>ï¼‰ï¼›</p><p>æ­¥éª¤3ï¼š<code>Slave</code>é‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­ã€‚ MySQLå¤åˆ¶æ˜¯å¼‚æ­¥çš„ä¸”ä¸²è¡ŒåŒ–çš„ï¼Œè€Œä¸”é‡å¯åä»<code>æ¥å…¥ç‚¹</code>å¼€å§‹å¤åˆ¶ã€‚</p><mark class="hl-label red">å¤åˆ¶çš„é—®é¢˜</mark> <p>å¤åˆ¶çš„æœ€å¤§é—®é¢˜ï¼š<code>å»¶æ—¶</code></p><hr><h3 id="2-2-å¤åˆ¶çš„åŸºæœ¬åŸåˆ™">2.2 å¤åˆ¶çš„åŸºæœ¬åŸåˆ™</h3><ul><li>æ¯ä¸ª<code>Slave</code>åªæœ‰ä¸€ä¸ª<code>Master</code></li><li>æ¯ä¸ª<code>Slave</code>åªèƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ID</li><li>æ¯ä¸ª<code>Master</code>å¯ä»¥æœ‰å¤šä¸ª<code>Slave</code></li></ul><h2 id="3-ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º">3. ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º</h2><p>ä¸€å°<code>ä¸»æœº</code>ç”¨äºå¤„ç†æ‰€æœ‰<code>å†™è¯·æ±‚</code>ï¼Œä¸€å°<code>ä»æœº</code>è´Ÿè´£æ‰€æœ‰<code>è¯»è¯·æ±‚</code>ï¼Œæ¶æ„å›¾å¦‚ä¸‹:</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715220852836.png" alt="image-20220715220852836" style="zoom:67%;" /><h3 id="3-1-å‡†å¤‡å·¥ä½œ">3.1 å‡†å¤‡å·¥ä½œ</h3><p>1ã€å‡†å¤‡ 2å° CentOS è™šæ‹Ÿæœº</p><p>2ã€æ¯å°è™šæ‹Ÿæœºä¸Šéœ€è¦å®‰è£…å¥½MySQL (å¯ä»¥æ˜¯MySQL8.0 )</p><p>è¯´æ˜ï¼šå‰é¢æˆ‘ä»¬è®²è¿‡å¦‚ä½•å…‹éš†ä¸€å°CentOSã€‚å¤§å®¶å¯ä»¥åœ¨ä¸€å°CentOSä¸Šå®‰è£…å¥½MySQLï¼Œè¿›è€Œé€šè¿‡å…‹éš†çš„æ–¹å¼å¤åˆ¶å‡º1å°åŒ…å«MySQLçš„è™šæ‹Ÿæœºã€‚</p><p>æ³¨æ„ï¼šå…‹éš†çš„æ–¹å¼éœ€è¦ä¿®æ”¹æ–°å…‹éš†å‡ºæ¥ä¸»æœºçš„ï¼šâ‘ <code>MACåœ°å€</code>â‘¡<code>hostname</code>â‘¢<code>IP åœ°å€</code>â‘£<code>UUID</code>ã€‚</p><p>æ­¤å¤–ï¼Œå…‹éš†çš„æ–¹å¼ç”Ÿæˆçš„è™šæ‹Ÿæœºï¼ˆåŒ…å«MySQL Serverï¼‰ï¼Œåˆ™å…‹éš†çš„è™šæ‹ŸæœºMySQL Serverçš„UUIDç›¸åŒï¼Œå¿…é¡»ä¿®æ”¹ï¼Œå¦åˆ™åœ¨æœ‰äº›åœºæ™¯ä¼šæŠ¥é”™ã€‚æ¯”å¦‚ï¼š<code>show slave status\G</code>ï¼ŒæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Last_IO_Error: Fatal error: The slave I<span class="operator">/</span>O thread stops because master <span class="keyword">and</span> slave have</span><br><span class="line">equal MySQL server UUIDs; these UUIDs must be different <span class="keyword">for</span> replication <span class="keyword">to</span> work.</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹MySQL Server çš„UUIDæ–¹å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>auto.cnf</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h3 id="3-2-ä¸»æœºé…ç½®æ–‡ä»¶">3.2 ä¸»æœºé…ç½®æ–‡ä»¶</h3><p>å»ºè®®mysqlç‰ˆæœ¬ä¸€è‡´ä¸”åå°ä»¥æœåŠ¡è¿è¡Œï¼Œä¸»ä»æ‰€æœ‰é…ç½®é¡¹éƒ½é…ç½®åœ¨<code>[mysqld]</code>èŠ‚ç‚¹ä¸‹ï¼Œä¸”éƒ½æ˜¯å°å†™å­—æ¯ã€‚</p><p>å…·ä½“å‚æ•°é…ç½®å¦‚ä¸‹ï¼š</p><ul><li>å¿…é€‰</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[å¿…é¡»]ä¸»æœåŠ¡å™¨å”¯ä¸€ID</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—,æŒ‡åè·¯å¾„ã€‚æ¯”å¦‚ï¼šè‡ªå·±æœ¬åœ°çš„è·¯å¾„/log/mysqlbin</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">atguigu-bin</span></span><br></pre></td></tr></table></figure><ul><li>å¯é€‰</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[å¯é€‰] 0ï¼ˆé»˜è®¤ï¼‰è¡¨ç¤ºè¯»å†™ï¼ˆä¸»æœºï¼‰ï¼Œ1è¡¨ç¤ºåªè¯»ï¼ˆä»æœºï¼‰</span></span><br><span class="line"><span class="attr">read-only</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#è®¾ç½®æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æ—¶é•¿ï¼Œå•ä½æ˜¯ç§’</span></span><br><span class="line"><span class="attr">binlog_expire_logs_seconds</span>=<span class="string">6000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#æ§åˆ¶å•ä¸ªäºŒè¿›åˆ¶æ—¥å¿—å¤§å°ã€‚æ­¤å‚æ•°çš„æœ€å¤§å’Œé»˜è®¤å€¼æ˜¯1GB</span></span><br><span class="line"><span class="attr">max_binlog_size</span>=<span class="string">200M</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“</span></span><br><span class="line"><span class="attr">binlog-ignore-db</span>=<span class="string">test</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“,é»˜è®¤å…¨éƒ¨è®°å½•ã€‚æ¯”å¦‚ï¼šbinlog-do-db=atguigu_master_slave</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=<span class="string">éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®binlogæ ¼å¼</span></span><br><span class="line"><span class="attr">binlog_format</span>=<span class="string">STATEMENT</span></span><br></pre></td></tr></table></figure><p>é‡å¯åå°mysqlæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</p><blockquote><p>æ³¨æ„ï¼š</p><p>å…ˆæ­å»ºå®Œä¸»ä»å¤åˆ¶ï¼Œå†åˆ›å»ºæ•°æ®åº“ã€‚</p><p>MySQLä¸»ä»å¤åˆ¶èµ·å§‹æ—¶ï¼Œä»æœºä¸ç»§æ‰¿ä¸»æœºæ•°æ®ã€‚</p></blockquote><p><strong>â‘  binlogæ ¼å¼è®¾ç½®ï¼š</strong></p><p>æ ¼å¼1ï¼š<code>STATEMENTæ¨¡å¼</code>ï¼ˆåŸºäºSQLè¯­å¥çš„å¤åˆ¶(statement-based replication, SBR)ï¼‰</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=<span class="string">STATEMENT</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqlè¯­å¥ä¼šè®°å½•åˆ°binlogä¸­ã€‚è¿™æ˜¯é»˜è®¤çš„binlogæ ¼å¼ã€‚</p><ul><li>SBR çš„ä¼˜ç‚¹ï¼š<ul><li>å†å²æ‚ ä¹…ï¼ŒæŠ€æœ¯æˆç†Ÿ</li><li>ä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼Œæ–‡ä»¶è¾ƒå°</li><li>binlogä¸­åŒ…å«äº†æ‰€æœ‰æ•°æ®åº“æ›´æ”¹ä¿¡æ¯ï¼Œå¯ä»¥æ®æ­¤æ¥å®¡æ ¸æ•°æ®åº“çš„å®‰å…¨ç­‰æƒ…å†µ</li><li>binlogå¯ä»¥ç”¨äºå®æ—¶çš„è¿˜åŸï¼Œè€Œä¸ä»…ä»…ç”¨äºå¤åˆ¶</li><li>ä¸»ä»ç‰ˆæœ¬å¯ä»¥ä¸ä¸€æ ·ï¼Œä»æœåŠ¡å™¨ç‰ˆæœ¬å¯ä»¥æ¯”ä¸»æœåŠ¡å™¨ç‰ˆæœ¬é«˜</li></ul></li><li>SBR çš„ç¼ºç‚¹ï¼š<ul><li>ä¸æ˜¯æ‰€æœ‰çš„UPDATEè¯­å¥éƒ½èƒ½è¢«å¤åˆ¶ï¼Œå°¤å…¶æ˜¯åŒ…å«ä¸ç¡®å®šæ“ä½œçš„æ—¶å€™</li></ul></li><li>ä½¿ç”¨ä»¥ä¸‹å‡½æ•°çš„è¯­å¥ä¹Ÿæ— æ³•è¢«å¤åˆ¶ï¼šLOAD_FILE()ã€UUID()ã€USER()ã€FOUND_ROWS()ã€SYSDATE() (é™¤éå¯åŠ¨æ—¶å¯ç”¨äº† --sysdate-is-now é€‰é¡¹)<ul><li>INSERT â€¦ SELECT ä¼šäº§ç”Ÿæ¯” RBR æ›´å¤šçš„è¡Œçº§é”</li><li>å¤åˆ¶éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æ(WHERE è¯­å¥ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•)çš„ UPDATE æ—¶ï¼Œéœ€è¦æ¯” RBR è¯·æ±‚æ›´å¤šçš„è¡Œçº§é”</li><li>å¯¹äºæœ‰ AUTO_INCREMENT å­—æ®µçš„ InnoDBè¡¨è€Œè¨€ï¼ŒINSERT è¯­å¥ä¼šé˜»å¡å…¶ä»– INSERT è¯­å¥</li><li>å¯¹äºä¸€äº›å¤æ‚çš„è¯­å¥ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸Šçš„è€—èµ„æºæƒ…å†µä¼šæ›´ä¸¥é‡ï¼Œè€Œ RBR æ¨¡å¼ä¸‹ï¼Œåªä¼šå¯¹é‚£ä¸ªå‘ ç”Ÿå˜åŒ–çš„è®°å½•äº§ç”Ÿå½±å“</li><li>æ‰§è¡Œå¤æ‚è¯­å¥å¦‚æœå‡ºé”™çš„è¯ï¼Œä¼šæ¶ˆè€—æ›´å¤šèµ„æº</li><li>æ•°æ®è¡¨å¿…é¡»å‡ ä¹å’Œä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´æ‰è¡Œï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å¤åˆ¶å‡ºé”™</li></ul></li></ul><p><strong>â‘¡ ROWæ¨¡å¼ï¼ˆåŸºäºè¡Œçš„å¤åˆ¶(row-based replication, RBR)ï¼‰</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=<span class="string">ROW</span></span><br></pre></td></tr></table></figure><p>5.1.5ç‰ˆæœ¬çš„MySQLæ‰å¼€å§‹æ”¯æŒï¼Œä¸è®°å½•æ¯æ¡sqlè¯­å¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»…è®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œä¿®æ”¹æˆä»€ä¹ˆæ ·äº†ã€‚</p><ul><li>RBR çš„ä¼˜ç‚¹ï¼š<ul><li>ä»»ä½•æƒ…å†µéƒ½å¯ä»¥è¢«å¤åˆ¶ï¼Œè¿™å¯¹å¤åˆ¶æ¥è¯´æ˜¯æœ€<code>å®‰å…¨å¯é </code>çš„ã€‚ï¼ˆæ¯”å¦‚ï¼šä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹ çš„å­˜å‚¨è¿‡ç¨‹ã€functionã€triggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ï¼‰</li><li>å¤šæ•°æƒ…å†µä¸‹ï¼Œä»æœåŠ¡å™¨ä¸Šçš„è¡¨å¦‚æœæœ‰ä¸»é”®çš„è¯ï¼Œå¤åˆ¶å°±ä¼šå¿«äº†å¾ˆå¤š</li><li>å¤åˆ¶ä»¥ä¸‹å‡ ç§è¯­å¥æ—¶çš„è¡Œé”æ›´å°‘ï¼šINSERT â€¦ SELECTã€åŒ…å« AUTO_INCREMENT å­—æ®µçš„ INSERTã€ æ²¡æœ‰é™„å¸¦æ¡ä»¶æˆ–è€…å¹¶æ²¡æœ‰ä¿®æ”¹å¾ˆå¤šè®°å½•çš„ UPDATE æˆ– DELETE è¯­å¥</li><li>æ‰§è¡Œ INSERTï¼ŒUPDATEï¼ŒDELETE è¯­å¥æ—¶é”æ›´å°‘</li><li>ä»æœåŠ¡å™¨ä¸Šé‡‡ç”¨ å¤šçº¿ç¨‹ æ¥æ‰§è¡Œå¤åˆ¶æˆä¸ºå¯èƒ½</li></ul></li><li>RBR çš„ç¼ºç‚¹ï¼š<ul><li>binlog å¤§äº†å¾ˆå¤š</li><li>å¤æ‚çš„å›æ»šæ—¶ binlog ä¸­ä¼šåŒ…å«å¤§é‡çš„æ•°æ®</li><li>ä¸»æœåŠ¡å™¨ä¸Šæ‰§è¡Œ UPDATE è¯­å¥æ—¶ï¼Œæ‰€æœ‰å‘ç”Ÿå˜åŒ–çš„è®°å½•éƒ½ä¼šå†™åˆ° binlog ä¸­ï¼Œè€Œ SBR åªä¼šå†™ä¸€æ¬¡ï¼Œè¿™ä¼šå¯¼è‡´é¢‘ç¹å‘ç”Ÿ binlog çš„å¹¶å‘å†™é—®é¢˜</li><li>æ— æ³•ä» binlog ä¸­çœ‹åˆ°éƒ½å¤åˆ¶äº†äº›ä»€ä¹ˆè¯­å¥</li></ul></li></ul><p><strong>â‘¢ MIXEDæ¨¡å¼ï¼ˆæ··åˆæ¨¡å¼å¤åˆ¶(mixed-based replication, MBR)ï¼‰</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=<span class="string">MIXED</span></span><br></pre></td></tr></table></figure><p>ä»5.1.8ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLæä¾›äº†Mixedæ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯Statementä¸Rowçš„ç»“åˆã€‚</p><p>åœ¨Mixedæ¨¡å¼ä¸‹ï¼Œä¸€èˆ¬çš„è¯­å¥ä¿®æ”¹ä½¿ç”¨statmentæ ¼å¼ä¿å­˜binlogã€‚å¦‚ä¸€äº›å‡½æ•°ï¼Œstatementæ— æ³•å®Œæˆä¸»ä»å¤åˆ¶çš„æ“ä½œï¼Œåˆ™é‡‡ç”¨rowæ ¼å¼ä¿å­˜binlogã€‚</p><p>MySQLä¼šæ ¹æ®æ‰§è¡Œçš„æ¯ä¸€æ¡å…·ä½“çš„sqlè¯­å¥æ¥åŒºåˆ†å¯¹å¾…è®°å½•çš„æ—¥å¿—å½¢å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨Statementå’ŒRowä¹‹é—´é€‰æ‹©ä¸€ç§ã€‚</p><h3 id="3-3-ä»æœºé…ç½®æ–‡ä»¶">3.3 ä»æœºé…ç½®æ–‡ä»¶</h3><p>è¦æ±‚ä¸»ä»æ‰€æœ‰é…ç½®é¡¹éƒ½é…ç½®åœ¨<code>my.cnf</code>çš„<code>[mysqld]</code>æ ä½ä¸‹ï¼Œä¸”éƒ½æ˜¯å°å†™å­—æ¯ã€‚</p><ul><li>å¿…é€‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#[å¿…é¡»]ä»æœåŠ¡å™¨å”¯ä¸€ID</span><br><span class="line">server<span class="operator">-</span>id<span class="operator">=</span><span class="number">2</span></span><br></pre></td></tr></table></figure><ul><li>å¯é€‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#[å¯é€‰]å¯ç”¨ä¸­ç»§æ—¥å¿—</span><br><span class="line">relay<span class="operator">-</span>log<span class="operator">=</span>mysql<span class="operator">-</span>relay</span><br></pre></td></tr></table></figure><p>é‡å¯åå°mysqlæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</p><blockquote><p>æ³¨æ„ï¼šä¸»ä»æœºéƒ½å…³é—­é˜²ç«å¢™<br>service iptables stop #CentOS 6<br>systemctl stop firewalld.service #CentOS 7</p></blockquote><h3 id="3-4-ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ">3.4 ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#åœ¨ä¸»æœºMySQLé‡Œæ‰§è¡Œæˆæƒä¸»ä»å¤åˆ¶çš„å‘½ä»¤</span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;slave1&#x27;</span>@<span class="string">&#x27;ä»æœºå™¨æ•°æ®åº“IP&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;abc123&#x27;</span>; #<span class="number">5.5</span>,<span class="number">5.7</span></span><br></pre></td></tr></table></figure><span class='p red'>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨çš„æ˜¯MySQL8ï¼Œéœ€è¦å¦‚ä¸‹çš„æ–¹å¼å»ºç«‹è´¦æˆ·ï¼Œå¹¶æˆæƒslave:</span><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;slave1&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;slave1&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#æ­¤è¯­å¥å¿…é¡»æ‰§è¡Œã€‚å¦åˆ™è§ä¸‹é¢ã€‚</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;slave1&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šåœ¨ä»æœºæ‰§è¡Œshow slave status\Gæ—¶æŠ¥é”™ï¼š</p><p>Last_IO_Error: error connecting to master â€˜slave1@192.168.1.150:3306â€™ - retry-time: 60 retries: 1 message:</p><p>Authentication plugin â€˜caching_sha2_passwordâ€™ reported error: Authentication requires secure connection.</p></blockquote><p>æŸ¥è¯¢Masterçš„çŠ¶æ€ï¼Œå¹¶è®°å½•ä¸‹Fileå’ŒPositionçš„å€¼ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718140722740.png" alt="image-20220718140722740"></p><ul><li>è®°å½•ä¸‹Fileå’ŒPositionçš„å€¼</li></ul><blockquote><p>æ³¨æ„ï¼šæ‰§è¡Œå®Œæ­¤æ­¥éª¤å<span class='p red'>ä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MySQL</span>ï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–ã€‚</p></blockquote><h3 id="3-5-ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº">3.5 ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº</h3><p>æ­¥éª¤1ï¼šä»æœºä¸Šå¤åˆ¶ä¸»æœºçš„å‘½ä»¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST<span class="operator">=</span><span class="string">&#x27;ä¸»æœºçš„IPåœ°å€&#x27;</span>,</span><br><span class="line">MASTER_USER<span class="operator">=</span><span class="string">&#x27;ä¸»æœºç”¨æˆ·å&#x27;</span>,</span><br><span class="line">MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;ä¸»æœºç”¨æˆ·åçš„å¯†ç &#x27;</span>,</span><br><span class="line">MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;mysql-bin.å…·ä½“æ•°å­—&#x27;</span>,</span><br><span class="line">MASTER_LOG_POS<span class="operator">=</span>å…·ä½“å€¼;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST<span class="operator">=</span><span class="string">&#x27;192.168.1.150&#x27;</span>,MASTER_USER<span class="operator">=</span><span class="string">&#x27;slave1&#x27;</span>,MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>,MASTER_LOG_F</span><br><span class="line">ILE<span class="operator">=</span><span class="string">&#x27;atguigu-bin.000007&#x27;</span>,MASTER_LOG_POS<span class="operator">=</span><span class="number">154</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718140946747.png" alt="image-20220718140946747"></p><p><strong>æ­¥éª¤2ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#å¯åŠ¨slaveåŒæ­¥</span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718141825228.png" alt="image-20220718141825228"></p><p>å¦‚æœæŠ¥é”™ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718141841862.png" alt="image-20220718141841862"></p><p>å¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼Œåˆ é™¤ä¹‹å‰çš„relay_logä¿¡æ¯ã€‚ç„¶åé‡æ–°æ‰§è¡Œ CHANGE MASTER TO â€¦è¯­å¥å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> reset slave; #åˆ é™¤SLAVEæ•°æ®åº“çš„relaylogæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯ç”¨æ–°çš„relaylogæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼ŒæŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718141951374.png" alt="image-20220718141951374"></p><blockquote><p>ä¸Šé¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸï¼</p></blockquote><p>æ˜¾å¼å¦‚ä¸‹çš„æƒ…å†µï¼Œå°±æ˜¯ä¸æ­£ç¡®çš„ã€‚å¯èƒ½é”™è¯¯çš„åŸå› æœ‰ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> ç½‘ç»œä¸é€š</span><br><span class="line"><span class="bullet">2.</span> è´¦æˆ·å¯†ç é”™è¯¯</span><br><span class="line"><span class="bullet">3.</span> é˜²ç«å¢™</span><br><span class="line"><span class="bullet">4.</span> mysqlé…ç½®æ–‡ä»¶é—®é¢˜</span><br><span class="line"><span class="bullet">5.</span> è¿æ¥æœåŠ¡å™¨æ—¶è¯­æ³•</span><br><span class="line"><span class="bullet">6.</span> ä¸»æœåŠ¡å™¨mysqlæƒé™</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718142045114.png" alt="image-20220718142045114" style="zoom:80%;" /><h3 id="3-6-æµ‹è¯•">3.6 æµ‹è¯•</h3><p>ä¸»æœºæ–°å»ºåº“ã€æ–°å»ºè¡¨ã€insertè®°å½•ï¼Œä»æœºå¤åˆ¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE atguigu_master_slave;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytbl(id <span class="type">INT</span>,NAME <span class="type">VARCHAR</span>(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytbl <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;zhang3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytbl <span class="keyword">VALUES</span>(<span class="number">2</span>,@<span class="variable">@hostname</span>);</span><br></pre></td></tr></table></figure><h3 id="3-7-åœæ­¢ä¸»ä»åŒæ­¥">3.7 åœæ­¢ä¸»ä»åŒæ­¥</h3><ul><li>åœæ­¢ä¸»ä»åŒæ­¥å‘½ä»¤ï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br></pre></td></tr></table></figure><ul><li><p>å¦‚ä½•é‡æ–°é…ç½®ä¸»ä»</p><p>å¦‚æœåœæ­¢ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½ï¼Œå†ä½¿ç”¨éœ€è¦é‡æ–°é…ç½®ä¸»ä»ã€‚å¦åˆ™ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718142549168.png" alt="image-20220718142549168"></p></li></ul><p>é‡æ–°é…ç½®ä¸»ä»ï¼Œéœ€è¦åœ¨ä»æœºä¸Šæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br><span class="line"></span><br><span class="line">reset master; #åˆ é™¤Masterä¸­æ‰€æœ‰çš„binglogæ–‡ä»¶ï¼Œå¹¶å°†æ—¥å¿—ç´¢å¼•æ–‡ä»¶æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹æ‰€æœ‰æ–°çš„æ—¥å¿—æ–‡ä»¶(æ…ç”¨)</span><br></pre></td></tr></table></figure><h3 id="3-8-æ­å»ºä¸»ä»å¤åˆ¶ï¼šåŒä¸»åŒä»">3.8 æ­å»ºä¸»ä»å¤åˆ¶ï¼šåŒä¸»åŒä»</h3><p>ä¸€ä¸ªä¸»æœºm1ç”¨äºå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œå®ƒçš„ä»æœºs1å’Œå¦ä¸€å°ä¸»æœºm2è¿˜æœ‰å®ƒçš„ä»æœºs2è´Ÿè´£æ‰€æœ‰è¯»è¯·æ±‚ã€‚å½“m1ä¸»æœºå®•æœºåï¼Œm2ä¸»æœºè´Ÿè´£å†™è¯·æ±‚ï¼Œm1ã€m2äº’ä¸ºå¤‡æœºã€‚ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718143705843.png" alt="image-20220718143705843" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718143716620.png" alt="image-20220718143716620" style="zoom:67%;" /><hr><h2 id="4-åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜">4. åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h2><p><strong>ä¸»ä»åŒæ­¥çš„è¦æ±‚ï¼š</strong></p><ul><li>è¯»åº“å’Œå†™åº“çš„æ•°æ®ä¸€è‡´(æœ€ç»ˆä¸€è‡´)ï¼›</li><li>å†™æ•°æ®å¿…é¡»å†™åˆ°å†™åº“ï¼›</li><li>è¯»æ•°æ®å¿…é¡»åˆ°è¯»åº“(ä¸ä¸€å®š)ï¼›</li></ul><h3 id="4-1-ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜">4.1 ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜</h3><p>è¿›è¡Œä¸»ä»åŒæ­¥çš„å†…å®¹æ˜¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿›è¡Œ<code>ç½‘ç»œä¼ è¾“</code>çš„è¿‡ç¨‹ä¸­å°±ä¸€å®šä¼š<code>å­˜åœ¨ä¸»ä»å»¶è¿Ÿ</code>ï¼ˆæ¯”å¦‚ 500msï¼‰ï¼Œè¿™æ ·å°±å¯èƒ½é€ æˆç”¨æˆ·åœ¨ä»åº“ä¸Šè¯»å–çš„æ•°æ®ä¸æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸»ä»åŒæ­¥ä¸­çš„<code>æ•°æ®ä¸ä¸€è‡´æ€§</code>é—®é¢˜ã€‚</p><p>ä¸¾ä¾‹ï¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿçš„æ—¶é—´ç‚¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªï¼š</p><ol><li>ä¸»åº“Aæ‰§è¡Œå®Œæˆä¸€ä¸ªäº‹åŠ¡ï¼Œå†™å…¥binlogï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸ºT1ï¼›</li><li>ä¹‹åä¼ ç»™ä»åº“Bï¼Œæˆ‘ä»¬æŠŠä»åº“Bæ¥æ”¶å®Œè¿™ä¸ªbinlogçš„æ—¶åˆ»è®°ä¸ºT2;</li><li>ä»åº“Bæ‰§è¡Œå®Œæˆè¿™ä¸ªäº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸ºT3ã€‚</li></ol><hr><h3 id="4-2-ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› ">4.2 ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› </h3><p>åœ¨ç½‘ç»œæ­£å¸¸çš„æ—¶å€™ï¼Œæ—¥å¿—ä»ä¸»åº“ä¼ ç»™ä»åº“æ‰€éœ€çš„æ—¶é—´æ˜¯å¾ˆçŸ­çš„ï¼Œå³T2-T1çš„å€¼æ˜¯éå¸¸å°çš„ã€‚å³ï¼Œç½‘ç»œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»å¤‡å»¶è¿Ÿçš„ä¸»è¦æ¥æºæ˜¯å¤‡åº“æ¥æ”¶å®Œbinlogå’Œæ‰§è¡Œå®Œè¿™ä¸ªäº‹åŠ¡ä¹‹é—´çš„æ—¶é—´å·®ã€‚</p><span class='p red'>ä¸»å¤‡å»¶è¿Ÿæœ€ç›´æ¥çš„è¡¨ç°æ˜¯ï¼Œä»åº“æ¶ˆè´¹ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰çš„é€Ÿåº¦ï¼Œæ¯”ä¸»åº“ç”Ÿäº§binlogçš„é€Ÿåº¦è¦æ…¢ã€‚</span>é€ æˆåŸå› ï¼š<p>1ã€ä»åº“çš„æœºå™¨æ€§èƒ½æ¯”ä¸»åº“è¦å·®</p><p>2ã€ä»åº“çš„å‹åŠ›å¤§</p><p>3ã€å¤§äº‹åŠ¡çš„æ‰§è¡Œ</p><p>ä¸¾ä¾‹1ï¼šä¸€æ¬¡æ€§ç”¨deleteè¯­å¥åˆ é™¤å¤ªå¤šæ•°æ®</p><p>ç»“è®ºï¼šåç»­å†åˆ é™¤æ•°æ®çš„æ—¶å€™ï¼Œè¦æ§åˆ¶æ¯ä¸ªäº‹åŠ¡åˆ é™¤çš„æ•°æ®é‡ï¼Œåˆ†æˆå¤šæ¬¡åˆ é™¤ã€‚</p><p>ä¸¾ä¾‹2ï¼šä¸€æ¬¡æ€§ç”¨insertâ€¦selectæ’å…¥å¤ªå¤šæ•°æ®</p><p>ä¸¾ä¾‹3ï¼šå¤§è¡¨DDL</p><p>æ¯”å¦‚åœ¨ä¸»åº“å¯¹ä¸€å¼ 500Wçš„è¡¨æ·»åŠ ä¸€ä¸ªå­—æ®µè€—è´¹äº†10åˆ†é’Ÿï¼Œé‚£ä¹ˆä»èŠ‚ç‚¹ä¸Šä¹Ÿä¼šè€—è´¹10åˆ†é’Ÿã€‚</p><hr><h3 id="4-3-å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ">4.3 å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ</h3><p>è‹¥æƒ³è¦å‡å°‘ä¸»ä»å»¶è¿Ÿçš„æ—¶é—´ï¼Œå¯ä»¥é‡‡å–ä¸‹é¢çš„åŠæ³•ï¼š</p><ol><li>é™ä½å¤šçº¿ç¨‹å¤§äº‹åŠ¡å¹¶å‘çš„æ¦‚ç‡ï¼Œä¼˜åŒ–ä¸šåŠ¡é€»è¾‘</li><li>ä¼˜åŒ–SQLï¼Œé¿å…æ…¢SQLï¼Œ<code>å‡å°‘æ‰¹é‡æ“ä½œ</code>ï¼Œå»ºè®®å†™è„šæœ¬ä»¥update-sleepè¿™æ ·çš„å½¢å¼å®Œæˆã€‚</li><li><code>æé«˜ä»åº“æœºå™¨çš„é…ç½®</code>ï¼Œå‡å°‘ä¸»åº“å†™binlogå’Œä»åº“è¯»binlogçš„æ•ˆç‡å·®ã€‚</li><li>å°½é‡é‡‡ç”¨<code>çŸ­çš„é“¾è·¯</code>ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“å’Œä»åº“æœåŠ¡å™¨çš„è·ç¦»å°½é‡è¦çŸ­ï¼Œæå‡ç«¯å£å¸¦å®½ï¼Œå‡å°‘binlogä¼ è¾“çš„ç½‘ç»œå»¶æ—¶ã€‚</li><li>å®æ—¶æ€§è¦æ±‚çš„ä¸šåŠ¡è¯»å¼ºåˆ¶èµ°ä¸»åº“ï¼Œä»åº“åªåšç¾å¤‡ï¼Œå¤‡ä»½ã€‚</li></ol><hr><h3 id="4-4-å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜">4.4 å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜</h3><p>å¦‚æœæ“ä½œçš„æ•°æ®å­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆå¯¹æ•°æ®è¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹è®°å½•åŠ å†™é”ï¼Œè¿™æ ·åœ¨è¯»å–çš„æ—¶å€™å°±ä¸ä¼šå‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä½†è¿™æ—¶ä»åº“çš„ä½œç”¨å°±æ˜¯<code>å¤‡ä»½</code>ï¼Œå¹¶æ²¡æœ‰èµ·åˆ°<code>è¯»å†™åˆ†ç¦»</code>ï¼Œåˆ†æ‹…ä¸»åº“<code>è¯»å‹åŠ›</code>çš„ä½œç”¨ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718144341584.png" alt="image-20220718144341584" style="zoom: 67%;" /><p>è¯»å†™åˆ†ç¦»æƒ…å†µä¸‹ï¼Œè§£å†³ä¸»ä»åŒæ­¥ä¸­æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œ å°±æ˜¯è§£å†³ä¸»ä»ä¹‹é—´<code>æ•°æ®å¤åˆ¶æ–¹å¼</code>çš„é—®é¢˜ï¼Œå¦‚æœæŒ‰ç…§æ•°æ®ä¸€è‡´æ€§<code>ä»å¼±åˆ°å¼º</code>æ¥è¿›è¡Œåˆ’åˆ†ï¼Œæœ‰ä»¥ä¸‹ 3 ç§å¤åˆ¶æ–¹å¼ã€‚</p><hr><div class="tabs" id="2ca9db54-a14a-42f7-8fa9-449c9b638852"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2ca9db54-a14a-42f7-8fa9-449c9b638852-1"><i class="fas fa-cat"></i>æ–¹æ³• 1ï¼šå¼‚æ­¥å¤åˆ¶</button></li><li class="tab"><button type="button" data-href="#2ca9db54-a14a-42f7-8fa9-449c9b638852-2"><i class="fas fa-horse"></i>æ–¹æ³• 2ï¼šåŠåŒæ­¥å¤åˆ¶</button></li><li class="tab"><button type="button" data-href="#2ca9db54-a14a-42f7-8fa9-449c9b638852-3"><i class="fas fa-dove"></i>æ–¹æ³• 3ï¼šç»„å¤åˆ¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2ca9db54-a14a-42f7-8fa9-449c9b638852-1"><p>å¼‚æ­¥æ¨¡å¼å°±æ˜¯å®¢æˆ·ç«¯æäº¤ COMMIT ä¹‹åä¸éœ€è¦ç­‰ä»åº“è¿”å›ä»»ä½•ç»“æœï¼Œè€Œæ˜¯ç›´æ¥å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸ä¼šå½±å“ä¸»åº“å†™çš„æ•ˆç‡ï¼Œä½†å¯èƒ½ä¼šå­˜åœ¨ä¸»åº“å®•æœºï¼Œè€ŒBinlogè¿˜æ²¡æœ‰åŒæ­¥åˆ°ä»åº“çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶çš„ä¸»åº“å’Œä»åº“æ•°æ®ä¸ä¸€è‡´ã€‚è¿™æ—¶å€™ä»ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°ä¸»ï¼Œé‚£ä¹ˆæ–°ä¸»åˆ™å¯èƒ½ç¼ºå°‘åŸæ¥ä¸»æœåŠ¡å™¨ä¸­å·²æäº¤çš„äº‹åŠ¡ã€‚æ‰€ä»¥ï¼Œè¿™ç§å¤åˆ¶æ¨¡å¼ä¸‹çš„æ•°æ®ä¸€è‡´æ€§æ˜¯æœ€å¼±çš„ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718144410731.png" alt="image-20220718144410731" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2ca9db54-a14a-42f7-8fa9-449c9b638852-2"><p>MysQL5.5ç‰ˆæœ¬ä¹‹åå¼€å§‹æ”¯æŒåŠåŒæ­¥å¤åˆ¶çš„æ–¹å¼ã€‚åŸç†æ˜¯åœ¨å®¢æˆ·ç«¯æäº¤ COMMIT ä¹‹åä¸ç›´æ¥å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œ è€Œæ˜¯ç­‰å¾…è‡³å°‘æœ‰ä¸€ä¸ªä»åº“æ¥æ”¶åˆ°äº† Binlogï¼Œå¹¶ä¸”å†™å…¥åˆ°ä¸­ç»§æ—¥å¿—ä¸­ï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æé«˜äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå½“ç„¶ç›¸æ¯”äºå¼‚æ­¥å¤åˆ¶æ¥è¯´ï¼Œè‡³å°‘å¤šå¢åŠ äº†ä¸€ä¸ªç½‘ç»œè¿æ¥çš„å»¶è¿Ÿï¼Œé™ä½äº†ä¸»åº“å†™çš„æ•ˆç‡ã€‚</p><p>åœ¨MysQL5.7ç‰ˆæœ¬ä¸­è¿˜å¢åŠ äº†ä¸€ä¸ª<code>rpl_semi_sync_master_wait_for_slave_count</code>å‚æ•°ï¼Œå¯ä»¥å¯¹åº”ç­”çš„ä»åº“æ•°é‡è¿›è¡Œè®¾ç½®ï¼Œé»˜è®¤ä¸º1ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æœ‰1ä¸ªä»åº“è¿›è¡Œäº†å“åº”ï¼Œå°±å¯ä»¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœå°†è¿™ä¸ªå‚æ•°è°ƒå¤§ï¼Œ å¯ä»¥æå‡æ•°æ®ä¸€è‡´æ€§çš„å¼ºåº¦ï¼Œä½†ä¹Ÿä¼šå¢åŠ ä¸»åº“ç­‰å¾…ä»åº“å“åº”çš„æ—¶é—´ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718144958357.png" alt="image-20220718144958357" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2ca9db54-a14a-42f7-8fa9-449c9b638852-3"><p>å¼‚æ­¥å¤åˆ¶å’ŒåŠåŒæ­¥å¤åˆ¶éƒ½æ— æ³•æœ€ç»ˆä¿è¯æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ï¼ŒåŠåŒæ­¥å¤åˆ¶æ˜¯é€šè¿‡åˆ¤æ–­ä»åº“å“åº”çš„ä¸ªæ•°æ¥å†³å®šæ˜¯å¦è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè™½ç„¶æ•°æ®ä¸€è‡´æ€§ç›¸æ¯”äºå¼‚æ­¥å¤åˆ¶æœ‰æå‡ï¼Œä½†ä»ç„¶æ— æ³•æ»¡è¶³å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚é‡‘èé¢†åŸŸã€‚MGR å¾ˆå¥½åœ°å¼¥è¡¥äº†è¿™ä¸¤ç§å¤åˆ¶æ¨¡å¼çš„ä¸è¶³ã€‚</p><p>ç»„å¤åˆ¶æŠ€æœ¯ï¼Œç®€ç§° MGRï¼ˆMySQL Group Replicationï¼‰ã€‚æ˜¯ MySQL åœ¨ 5.7.17 ç‰ˆæœ¬ä¸­æ¨å‡ºçš„ä¸€ç§æ–°çš„æ•°æ®å¤åˆ¶æŠ€æœ¯ï¼Œè¿™ç§å¤åˆ¶æŠ€æœ¯æ˜¯åŸºäºPaxosåè®®çš„çŠ¶æ€æœºå¤åˆ¶ã€‚</p><p><mark class="hl-label green">MGRæ˜¯å¦‚ä½•å·¥ä½œçš„</mark></p><p>é¦–å…ˆæˆ‘ä»¬å°†å¤šä¸ªèŠ‚ç‚¹å…±åŒç»„æˆä¸€ä¸ªå¤åˆ¶ç»„ï¼Œåœ¨<code>æ‰§è¡Œè¯»å†™ï¼ˆRWï¼‰äº‹åŠ¡</code>çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ä¸€è‡´æ€§åè®®å±‚ ï¼ˆConsensus å±‚ï¼‰çš„åŒæ„ï¼Œä¹Ÿå°±æ˜¯è¯»å†™äº‹åŠ¡æƒ³è¦è¿›è¡Œæäº¤ï¼Œå¿…é¡»è¦ç»è¿‡ç»„é‡Œâ€œå¤§å¤šæ•°äººâ€ï¼ˆå¯¹åº” Node èŠ‚ç‚¹ï¼‰çš„åŒæ„ï¼Œå¤§å¤šæ•°æŒ‡çš„æ˜¯åŒæ„çš„èŠ‚ç‚¹æ•°é‡éœ€è¦å¤§äº ï¼ˆN/2+1ï¼‰ï¼Œè¿™æ ·æ‰å¯ä»¥è¿›è¡Œæäº¤ï¼Œè€Œä¸æ˜¯åŸå‘èµ·æ–¹ä¸€ä¸ªè¯´äº†ç®—ã€‚è€Œé’ˆå¯¹<code>åªè¯»ï¼ˆROï¼‰äº‹åŠ¡</code>åˆ™ä¸éœ€è¦ç»è¿‡ç»„å†…åŒæ„ï¼Œç›´æ¥ COMMIT å³å¯ã€‚</p><p>åœ¨ä¸€ä¸ªå¤åˆ¶ç»„å†…æœ‰å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå®ƒä»¬å„è‡ªç»´æŠ¤äº†è‡ªå·±çš„æ•°æ®å‰¯æœ¬ï¼Œå¹¶ä¸”åœ¨ä¸€è‡´æ€§åè®®å±‚å®ç°äº†åŸå­æ¶ˆ æ¯å’Œå…¨å±€æœ‰åºæ¶ˆæ¯ï¼Œä»è€Œä¿è¯ç»„å†…æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145235499.png" alt="image-20220718145235499" style="zoom:67%;" /><p>MGR å°† MySQL å¸¦å…¥äº†æ•°æ®å¼ºä¸€è‡´æ€§çš„æ—¶ä»£ï¼Œæ˜¯ä¸€ä¸ªåˆ’æ—¶ä»£çš„åˆ›æ–°ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„åŸå› å°±æ˜¯MGR æ˜¯åŸº äº Paxos åè®®çš„ã€‚Paxos ç®—æ³•æ˜¯ç”± 2013 å¹´çš„å›¾çµå¥–è·å¾—è€… Leslie Lamport äº 1990 å¹´æå‡ºçš„ï¼Œæœ‰å…³è¿™ä¸ªç®—æ³•çš„å†³ç­–æœºåˆ¶å¯ä»¥æœä¸€ä¸‹ã€‚äº‹å®ä¸Šï¼ŒPaxos ç®—æ³•æå‡ºæ¥ä¹‹åå°±ä½œä¸º<code>åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•</code>è¢«å¹¿æ³›åº”ç”¨ï¼Œæ¯”å¦‚ Apache çš„ ZooKeeper ä¹Ÿæ˜¯åŸºäº Paxos å®ç°çš„ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="5-çŸ¥è¯†å»¶ä¼¸">5. çŸ¥è¯†å»¶ä¼¸</h2><p>åœ¨ä¸»ä»æ¶æ„çš„é…ç½®ä¸­ï¼Œå¦‚æœæƒ³è¦é‡‡å–è¯»å†™åˆ†ç¦»çš„ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥<code>è‡ªå·±ç¼–å†™ç¨‹åº</code>ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶</code>æ¥å®ç°ã€‚</p><ul><li>è‡ªå·±ç¼–å†™ç¨‹åºçš„å¥½å¤„å°±åœ¨äºæ¯”è¾ƒè‡ªä¸»ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ¤æ–­å“ªäº›æŸ¥è¯¢åœ¨ä»åº“ä¸Šæ¥æ‰§è¡Œï¼Œé’ˆå¯¹å®æ—¶æ€§è¦ æ±‚é«˜çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘å“ªäº›æŸ¥è¯¢å¯ä»¥åœ¨ä¸»åº“ä¸Šæ‰§è¡Œã€‚åŒæ—¶ï¼Œç¨‹åºç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œå‡å°‘äº†ä¸­é—´ä»¶å±‚ï¼Œç›¸å½“äºå‡å°‘äº†æ€§èƒ½æŸè€—ã€‚</li><li>é‡‡ç”¨ä¸­é—´ä»¶çš„æ–¹æ³•æœ‰å¾ˆæ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œ<code>åŠŸèƒ½å¼ºå¤§</code>ï¼Œ<code>ä½¿ç”¨ç®€å•</code>ã€‚ä½†å› ä¸ºåœ¨å®¢æˆ·ç«¯å’Œæ•°æ®åº“ä¹‹é—´å¢åŠ äº† ä¸­é—´ä»¶å±‚ä¼šæœ‰ä¸€äº›<code>æ€§èƒ½æŸè€—</code>ï¼ŒåŒæ—¶å•†ä¸šä¸­é—´ä»¶ä¹Ÿæ˜¯æœ‰ä½¿ç”¨æˆæœ¬çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘é‡‡å–ä¸€äº›ä¼˜ç§€çš„å¼€æºå·¥å…·ã€‚</li></ul><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145428456.png" alt="image-20220718145428456" style="zoom:67%;" /><p>â‘ <code>Cobar</code>å±äºé˜¿é‡ŒB2Bäº‹ä¸šç¾¤ï¼Œå§‹äº2008å¹´ï¼Œåœ¨é˜¿é‡Œæœå½¹3å¹´å¤šï¼Œæ¥ç®¡3000+ä¸ªMySQLæ•°æ®åº“çš„ schema,é›†ç¾¤æ—¥å¤„ç†åœ¨çº¿SQLè¯·æ±‚50äº¿æ¬¡ä»¥ä¸Šã€‚ç”±äºCobarå‘èµ·äººçš„ç¦»èŒï¼ŒCobaråœæ­¢ç»´æŠ¤ã€‚</p><p>â‘¡<code>Mycat</code>æ˜¯å¼€æºç¤¾åŒºåœ¨é˜¿é‡ŒcobaråŸºç¡€ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œè§£å†³äº†cobarå­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶ä¸”åŠ å…¥äº†è®¸å¤šæ–°çš„åŠŸèƒ½åœ¨å…¶ä¸­ã€‚é’å‡ºäºè“è€Œèƒœäºè“ã€‚</p><p>â‘¢<code>OneProxy</code>åŸºäºMySQLå®˜æ–¹çš„proxyæ€æƒ³åˆ©ç”¨cè¯­è¨€è¿›è¡Œå¼€å‘çš„ï¼ŒOneProxyæ˜¯ä¸€æ¬¾å•†ä¸š æ”¶è´¹ çš„ä¸­é—´ä»¶ã€‚èˆå¼ƒäº†ä¸€äº›åŠŸèƒ½ï¼Œä¸“æ³¨åœ¨ æ€§èƒ½å’Œç¨³å®šæ€§ä¸Š ã€‚</p><p>â‘£<code>kingshard</code>ç”±å°å›¢é˜Ÿç”¨goè¯­è¨€å¼€å‘ï¼Œè¿˜éœ€è¦å‘å±•ï¼Œéœ€è¦ä¸æ–­å®Œå–„ã€‚</p><p>â‘¤<code>Vitess</code>æ˜¯Youtubeç”Ÿäº§åœ¨ä½¿ç”¨ï¼Œæ¶æ„å¾ˆå¤æ‚ã€‚ä¸æ”¯æŒMySQLåŸç”Ÿåè®®ï¼Œä½¿ç”¨ éœ€è¦å¤§é‡æ”¹é€ æˆ æœ¬ ã€‚</p><p>â‘¥<code>Atlas</code>æ˜¯360å›¢é˜ŸåŸºäºmysql proxyæ”¹å†™ï¼ŒåŠŸèƒ½è¿˜éœ€å®Œå–„ï¼Œé«˜å¹¶å‘ä¸‹ä¸ç¨³å®šã€‚</p><p>â‘¦<code>MaxScale</code>æ˜¯mariadbï¼ˆMySQLåŸä½œè€…ç»´æŠ¤çš„ä¸€ä¸ªç‰ˆæœ¬ï¼‰ ç ”å‘çš„ä¸­é—´ä»¶</p><p>â‘§<code>MySQLRoute</code>æ˜¯MySQLå®˜æ–¹Oracleå…¬å¸å‘å¸ƒçš„ä¸­é—´ä»¶</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145523643.png" alt="image-20220718145523643" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145534856.png" alt="image-20220718145534856" style="zoom:67%;" /><p>ä¸»å¤‡åˆ‡æ¢ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145548526.png" alt="image-20220718145548526" style="zoom:67%;" /><ul><li>ä¸»åŠ¨åˆ‡æ¢</li><li>è¢«åŠ¨åˆ‡æ¢</li><li>å¦‚ä½•åˆ¤æ–­ä¸»åº“å‡ºé—®é¢˜äº†ï¼Ÿå¦‚ä½•è§£å†³è¿‡ç¨‹ä¸­çš„æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ ?</li></ul>]]></content>
    
    
    <summary type="html">ä¸»ä»å¤åˆ¶åŸç†ã€ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»ºã€åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>å…¶ä»–æ•°æ®åº“æ—¥å¿—</title>
    <link href="https://wuwawawa.github.io/posts/a42250fc.html"/>
    <id>https://wuwawawa.github.io/posts/a42250fc.html</id>
    <published>2023-04-19T03:05:41.000Z</published>
    <updated>2023-04-18T08:32:23.779Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨è®²è§£æ•°æ®åº“äº‹åŠ¡æ—¶ï¼Œè®²è¿‡ä¸¤ç§æ—¥å¿—ï¼šé‡åšæ—¥å¿—ã€å›æ»šæ—¥å¿—ã€‚</p><p>å¯¹äºçº¿ä¸Šæ•°æ®åº“åº”ç”¨ç³»ç»Ÿï¼Œçªç„¶é­é‡<code>æ•°æ®åº“å®•æœº</code>æ€ä¹ˆåŠï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>å®šä½å®•æœºçš„åŸå› </code>å°±éå¸¸å…³é”®ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æ•°æ®åº“çš„<code>é”™è¯¯æ—¥å¿—</code>ã€‚å› ä¸ºæ—¥å¿—ä¸­è®°å½•äº†æ•°æ®åº“è¿è¡Œä¸­çš„è¯Šæ–­ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†é”™è¯¯ã€è­¦å‘Šå’Œæ³¨é‡Šç­‰ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š</p><p>ä»æ—¥å¿—ä¸­å‘ç°æŸä¸ªè¿æ¥ä¸­çš„ SQL æ“ä½œå‘ç”Ÿäº†æ­»å¾ªç¯ï¼Œå¯¼è‡´å†…å­˜ä¸è¶³ï¼Œè¢«ç³»ç»Ÿå¼ºè¡Œç»ˆæ­¢äº†ã€‚æ˜ç¡®äº†åŸå› ï¼Œå¤„ç†èµ·æ¥ä¹Ÿå°±è½»æ¾äº†ï¼Œç³»ç»Ÿå¾ˆå¿«å°±æ¢å¤äº†è¿è¡Œã€‚</p><p>é™¤äº†å‘ç°é”™è¯¯ï¼Œæ—¥å¿—åœ¨æ•°æ®å¤åˆ¶ã€æ•°æ®æ¢å¤ã€æ“ä½œå®¡è®¡ï¼Œä»¥åŠç¡®ä¿æ•°æ®çš„æ°¸ä¹…æ€§å’Œä¸€è‡´æ€§ç­‰æ–¹é¢ï¼Œéƒ½æœ‰ç€ä¸å¯æ›¿ä»£çš„ä½œç”¨ã€‚</p><p><strong>åƒä¸‡ä¸è¦å°çœ‹æ—¥å¿—</strong>ã€‚å¾ˆå¤šçœ‹ä¼¼å¥‡æ€ªçš„é—®é¢˜ï¼Œç­”æ¡ˆå¾€å¾€å°±è—åœ¨æ—¥å¿—é‡Œã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œåªæœ‰é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ‰ èƒ½å‘ç°é—®é¢˜çš„åŸå› ï¼ŒçœŸæ­£è§£å†³é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦å­¦ä¼šæŸ¥çœ‹æ—¥å¿—ï¼Œå…»æˆæ£€æŸ¥æ—¥å¿—çš„ä¹ æƒ¯ï¼Œå¯¹æå‡ä½ çš„æ•° æ®åº“åº”ç”¨å¼€å‘èƒ½åŠ›è‡³å…³é‡è¦ã€‚</p><p>MySQL8.0 å®˜ç½‘æ—¥å¿—åœ°å€ï¼š <a href="https://dev.mysql.com/doc/refman/8.0/en/server-logs.html">https://dev.mysql.com/doc/refman/8.0/en/server-logs.html</a></p><hr><h2 id="1-MySQLæ”¯æŒçš„æ—¥å¿—">1. MySQLæ”¯æŒçš„æ—¥å¿—</h2><h3 id="1-1-æ—¥å¿—ç±»å‹">1.1 æ—¥å¿—ç±»å‹</h3><p>MySQLæœ‰ä¸åŒç±»å‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œç”¨æ¥å­˜å‚¨ä¸åŒç±»å‹çš„æ—¥å¿—ï¼Œåˆ†ä¸º<code>äºŒè¿›åˆ¶æ—¥å¿—</code>ã€<code>é”™è¯¯æ—¥å¿—</code>ã€<code>é€šç”¨æŸ¥è¯¢æ—¥å¿—</code>å’Œ<code>æ…¢æŸ¥è¯¢æ—¥å¿—</code>ï¼Œè¿™ä¹Ÿæ˜¯å¸¸ç”¨çš„4ç§ã€‚MySQL 8åˆæ–°å¢ä¸¤ç§æ”¯æŒçš„æ—¥å¿—ï¼š ä¸­ç»§æ—¥å¿— å’Œ æ•°æ®å®šä¹‰è¯­å¥æ—¥å¿— ã€‚ä½¿ç”¨è¿™äº›æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹MySQLå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚</p><p>è¿™6ç±»æ—¥å¿—åˆ†åˆ«ä¸ºï¼š</p><ul><li><strong>æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_timeçš„æ‰€æœ‰æŸ¥è¯¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚</li><li><strong>é€šç”¨æŸ¥è¯¢æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰è¿æ¥çš„èµ·å§‹æ—¶é—´å’Œç»ˆæ­¢æ—¶é—´ï¼Œä»¥åŠè¿æ¥å‘é€ç»™æ•°æ®åº“æœåŠ¡å™¨çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œ å¯¹æˆ‘ä»¬å¤åŸæ“ä½œçš„å®é™…åœºæ™¯ã€å‘ç°é—®é¢˜ï¼Œç”šè‡³æ˜¯å¯¹æ•°æ®åº“æ“ä½œçš„å®¡è®¡éƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</li><li><strong>é”™è¯¯æ—¥å¿—</strong>ï¼šè®°å½•MySQLæœåŠ¡çš„å¯åŠ¨ã€è¿è¡Œæˆ–åœæ­¢MySQLæœåŠ¡æ—¶å‡ºç°çš„é—®é¢˜ï¼Œæ–¹ä¾¿æˆ‘ä»¬äº†è§£æœåŠ¡å™¨çš„ çŠ¶æ€ï¼Œä»è€Œå¯¹æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ã€‚</li><li><strong>äºŒè¿›åˆ¶æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰æ›´æ”¹æ•°æ®çš„è¯­å¥ï¼Œå¯ä»¥ç”¨äºä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Œä»¥åŠæœåŠ¡å™¨é‡åˆ°æ•… éšœæ—¶æ•°æ®çš„æ— æŸå¤±æ¢å¤ã€‚</li><li><strong>ä¸­ç»§æ—¥å¿—</strong>ï¼šç”¨äºä¸»ä»æœåŠ¡å™¨æ¶æ„ä¸­ï¼Œä»æœåŠ¡å™¨ç”¨æ¥å­˜æ”¾ä¸»æœåŠ¡å™¨äºŒè¿›åˆ¶æ—¥å¿—å†…å®¹çš„ä¸€ä¸ªä¸­é—´æ–‡ä»¶ã€‚ ä»æœåŠ¡å™¨é€šè¿‡è¯»å–ä¸­ç»§æ—¥å¿—çš„å†…å®¹ï¼Œæ¥åŒæ­¥ä¸»æœåŠ¡å™¨ä¸Šçš„æ“ä½œã€‚</li><li><strong>æ•°æ®å®šä¹‰è¯­å¥æ—¥å¿—</strong>ï¼šè®°å½•æ•°æ®å®šä¹‰è¯­å¥æ‰§è¡Œçš„å…ƒæ•°æ®æ“ä½œã€‚</li></ul><p>é™¤äºŒè¿›åˆ¶æ—¥å¿—å¤–ï¼Œå…¶ä»–æ—¥å¿—éƒ½æ˜¯<code>æ–‡æœ¬æ–‡ä»¶</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ—¥å¿—åˆ›å»ºäº<code>MySQLæ•°æ®ç›®å½•</code>ä¸­ã€‚</p><h3 id="1-2-æ—¥å¿—çš„å¼Šç«¯">1.2 æ—¥å¿—çš„å¼Šç«¯</h3><ul><li>æ—¥å¿—åŠŸèƒ½ä¼š<code>é™ä½MySQLæ•°æ®åº“çš„æ€§èƒ½</code>ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸ¥è¯¢éå¸¸é¢‘ç¹çš„MySQLæ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¦‚æœå¼€å¯äº†é€šç”¨æŸ¥è¯¢æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒMySQLæ•°æ®åº“ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´è®°å½•æ—¥å¿—ã€‚</li><li>æ—¥å¿—ä¼š<code>å ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´</code>ã€‚å¯¹äºç”¨æˆ·é‡éå¸¸å¤§ï¼Œæ“ä½œéå¸¸é¢‘ç¹çš„æ•°æ®åº“ï¼Œæ—¥å¿—æ–‡ä»¶éœ€è¦çš„å­˜å‚¨ç©ºé—´è®¾ç½®æ¯”æ•°æ®åº“æ–‡ä»¶éœ€è¦çš„å­˜å‚¨ç©ºé—´è¿˜è¦å¤§ã€‚</li></ul><hr><h2 id="2-æ…¢æŸ¥è¯¢æ—¥å¿—-slow-query-log">2. æ…¢æŸ¥è¯¢æ—¥å¿—(slow query log)</h2><p>å‰é¢ç« èŠ‚ã€Šæ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨ã€‹å·²ç»è¯¦ç»†è®²è¿°ã€‚</p><div class="tag link"><a class="link-card" title="æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨" href="/posts/2678f2d3.html#4-å®šä½æ‰§è¡Œæ…¢çš„SQL-æ…¢æŸ¥è¯¢æ—¥å¿—"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/favicon.png"/></div><div class="right"><p class="text">æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</p><p class="url">/posts/2678f2d3.html#4-å®šä½æ‰§è¡Œæ…¢çš„SQL-æ…¢æŸ¥è¯¢æ—¥å¿—</p></div></a></div><hr><h2 id="3-é€šç”¨æŸ¥è¯¢æ—¥å¿—-general-query-log">3. é€šç”¨æŸ¥è¯¢æ—¥å¿—(general query log)</h2><p>é€šç”¨æŸ¥è¯¢æ—¥å¿—ç”¨æ¥<code>è®°å½•ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ</code>ï¼ŒåŒ…æ‹¬å¯åŠ¨å’Œå…³é—­MySQLæœåŠ¡ã€æ‰€æœ‰ç”¨æˆ·çš„è¿æ¥å¼€å§‹æ—¶é—´å’Œæˆªæ­¢ æ—¶é—´ã€å‘ç»™ MySQLæ•°æ®åº“æœåŠ¡å™¨çš„æ‰€æœ‰ SQLæŒ‡ä»¤ç­‰ã€‚å½“æˆ‘ä»¬çš„æ•°æ®å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ<span class='p green'>æŸ¥çœ‹é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œ è¿˜åŸæ“ä½œæ—¶çš„å…·ä½“åœºæ™¯</span>ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡†ç¡®å®šä½é—®é¢˜ã€‚</p><h3 id="3-1-é—®é¢˜åœºæ™¯">3.1 é—®é¢˜åœºæ™¯</h3><p>åœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œè´­ä¹°å•†å“å¹¶ä¸”ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜å®Œæˆä»¥åï¼Œå´å‘ç°æ”¯ä»˜ä¸­å¿ƒçš„è®°å½•å¹¶æ²¡æœ‰æ–°å¢ï¼Œæ­¤æ—¶ç”¨æˆ·å†æ¬¡ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ï¼Œå°±ä¼šå‡ºç°é‡å¤æ”¯ä»˜çš„é—®é¢˜ã€‚ä½†æ˜¯å½“å»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œä¼šå‘ç°åªæœ‰ä¸€æ¡è®°å½•å­˜åœ¨ã€‚é‚£ä¹ˆæ­¤æ—¶ç»™åˆ°çš„ç°è±¡å°±æ˜¯åªæœ‰ä¸€æ¡æ”¯ä»˜è®°å½•ï¼Œä½†æ˜¯ç”¨æˆ·å´æ”¯ä»˜äº†ä¸¤æ¬¡ã€‚</p><p>æˆ‘ä»¬å¯¹ç³»ç»Ÿè¿›è¡Œäº†ä»”ç»†æ£€æŸ¥ï¼Œæ²¡æœ‰å‘ç°æ•°æ®é—®é¢˜ï¼Œå› ä¸ºç”¨æˆ·ç¼–å·å’Œè®¢å•ç¼–å·ä»¥åŠç¬¬ä¸‰æ–¹æµæ°´å·éƒ½æ˜¯å¯¹çš„ã€‚å¯æ˜¯ç”¨æˆ·ç¡®å®æ”¯ä»˜äº†ä¸¤æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†æ£€æŸ¥é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œçœ‹çœ‹å½“å¤©åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>æŸ¥çœ‹ä¹‹åï¼Œå‘ç°ï¼š1æœˆ1æ—¥ä¸‹åˆ2ç‚¹ï¼Œç”¨æˆ·ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜å®Œä»¥åï¼Œä½†æ˜¯ç”±äºç½‘ç»œæ•…éšœï¼Œæ”¯ä»˜ä¸­å¿ƒæ²¡æœ‰åŠæ—¶æ”¶åˆ°å¾®ä¿¡æ”¯ä»˜çš„å›è°ƒé€šçŸ¥ï¼Œå¯¼è‡´å½“æ—¶æ²¡æœ‰å†™å…¥æ•°æ®ã€‚1æœˆ1æ—¥ä¸‹åˆ2ç‚¹30ï¼Œç”¨æˆ·åˆä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ï¼Œæ­¤æ—¶è®°å½•æ›´æ–°åˆ°æ”¯ä»˜ä¸­å¿ƒã€‚1æœˆ1æ—¥æ™šä¸Š9ç‚¹ï¼Œå¾®ä¿¡çš„å›è°ƒé€šçŸ¥è¿‡æ¥äº†ï¼Œä½†æ˜¯æ”¯ä»˜ä¸­å¿ƒå·²ç»å­˜åœ¨äº†æ”¯ä»˜å®çš„è®°å½•ï¼Œæ‰€ä»¥åªèƒ½è¦†ç›–è®°å½•äº†ã€‚</p><p>ç”±äºç½‘ç»œçš„åŸå› å¯¼è‡´äº†é‡å¤æ”¯ä»˜ã€‚è‡³äºè§£å†³é—®é¢˜çš„æ–¹æ¡ˆå°±å¾ˆå¤šäº†ï¼Œè¿™é‡Œçœç•¥ã€‚</p><p>å¯ä»¥çœ‹åˆ°é€šç”¨æŸ¥è¯¢æ—¥å¿—å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£æ“ä½œå‘ç”Ÿçš„å…·ä½“æ—¶é—´å’Œæ“ä½œçš„ç»†èŠ‚ï¼Œå¯¹æ‰¾å‡ºå¼‚å¸¸å‘ç”Ÿçš„åŸå› æå…¶å…³é”®ã€‚</p><hr><h3 id="2-æŸ¥çœ‹å½“å‰çŠ¶æ€">2 æŸ¥çœ‹å½“å‰çŠ¶æ€</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%general%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span>                        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="operator">|</span> general_log      <span class="operator">|</span> OFF                          <span class="operator">|</span> #é€šç”¨æŸ¥è¯¢æ—¥å¿—å¤„äºå…³é—­çŠ¶æ€</span><br><span class="line"><span class="operator">|</span> general_log_file <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>fortune01.log <span class="operator">|</span> #é€šç”¨æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„åç§° ä¸»æœºå</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure><p>è¯´æ˜1ï¼šç³»ç»Ÿå˜é‡ genera_log çš„å€¼æ˜¯OFFï¼Œå³é€šç”¨æŸ¥è¯¢æ—¥å¿—å¤„äºå…³é—­çŠ¶æ€ã€‚åœ¨MySQLä¸­ï¼Œè¿™ä¸ªå‚æ•°çš„<code>é»˜è®¤å€¼æ˜¯å…³é—­çš„</code>ã€‚å› ä¸ºä¸€æ—¦å¼€å¯è®°å½•é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼ŒMySQLä¼šè®°å½•æ‰€æœ‰çš„è¿æ¥èµ·æ­¢å’Œç›¸å…³çš„SQLæ“ä½œï¼Œè¿™æ ·ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºå¹¶ä¸”å ç”¨ç£ç›˜ç©ºé—´ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹å˜é‡çš„å€¼ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å¼€å¯æ—¥å¿—ã€‚</p><p>è¯´æ˜2ï¼šé€šç”¨æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„åç§°æ˜¯fortune01.logã€‚å­˜å‚¨è·¯å¾„æ˜¯/var/ib/mysqlï¼Œé»˜è®¤ä¹Ÿæ˜¯æ•°æ®è·¯å¾„ã€‚è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“åœ¨å“ªé‡Œå¯ä»¥æŸ¥çœ‹é€šç”¨æŸ¥è¯¢æ—¥å¿—çš„å†…å®¹äº†ã€‚</p><hr><h3 id="3-3-å¯åŠ¨æ—¥å¿—">3.3 å¯åŠ¨æ—¥å¿—</h3><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><p>ä¿®æ”¹my.cnfæˆ–è€…my.inié…ç½®æ–‡ä»¶æ¥è®¾ç½®ã€‚åœ¨[mysqld]ç»„ä¸‹åŠ å…¥logé€‰é¡¹ï¼Œå¹¶é‡å¯MySQLæœåŠ¡ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">general_log</span>=<span class="string">ON</span></span><br><span class="line"><span class="attr">general_log_file</span>=<span class="string">[path[filename]] #æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•è·¯å¾„ï¼Œfilenameä¸ºæ—¥å¿—æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æŒ‡å®šç›®å½•å’Œæ–‡ä»¶åï¼Œé€šç”¨æŸ¥è¯¢æ—¥å¿—å°†é»˜è®¤å­˜å‚¨åœ¨MySQLæ•°æ®ç›®å½•ä¸­çš„hostname.logæ–‡ä»¶ä¸­ï¼Œ hostnameè¡¨ç¤ºä¸»æœºåã€‚</p><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log<span class="operator">=</span><span class="keyword">on</span>; # å¼€å¯é€šç”¨æŸ¥è¯¢æ—¥å¿—</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log_file<span class="operator">=</span>â€™path<span class="operator">/</span>filenameâ€™; # è®¾ç½®æ—¥å¿—æ–‡ä»¶ä¿å­˜ä½ç½®</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ï¼Œå…³é—­æ“ä½œSQLå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log<span class="operator">=</span>off; # å…³é—­é€šç”¨æŸ¥è¯¢æ—¥å¿—</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è®¾ç½®åæƒ…å†µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;general_log%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="3-4-æŸ¥çœ‹æ—¥å¿—">3.4 æŸ¥çœ‹æ—¥å¿—</h3><p>é€šç”¨æŸ¥è¯¢æ—¥å¿—æ˜¯ä»¥<code>æ–‡æœ¬æ–‡ä»¶</code>çš„å½¢å¼å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ï¼Œå¯ä»¥ä½¿ç”¨<code>æ–‡æœ¬ç¼–è¾‘å™¨</code>ç›´æ¥æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚æ¯å° MySQLæœåŠ¡å™¨çš„é€šç”¨æŸ¥è¯¢æ—¥å¿—å†…å®¹æ˜¯ä¸åŒçš„ã€‚</p><ul><li>åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œä½¿ç”¨æ–‡æœ¬æ–‡ä»¶æŸ¥çœ‹å™¨ï¼›</li><li>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨viå·¥å…·æˆ–è€…geditå·¥å…·æŸ¥çœ‹ï¼›</li><li>åœ¨Mac OSXç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬æ–‡ä»¶æŸ¥çœ‹å™¨æˆ–è€…viç­‰å·¥å…·æŸ¥çœ‹ã€‚</li></ul><p>ä»<code>SHOW VARIABLES LIKE 'general_log%'</code>; ç»“æœä¸­å¯ä»¥çœ‹åˆ°é€šç”¨æŸ¥è¯¢æ—¥å¿—çš„ä½ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>usr<span class="operator">/</span>sbin<span class="operator">/</span>mysqld, Version: <span class="number">8.0</span><span class="number">.26</span> (MySQL Community Server <span class="operator">-</span> GPL). started <span class="keyword">with</span>:</span><br><span class="line">Tcp port: <span class="number">3306</span> Unix socket: <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>mysql.sock</span><br><span class="line"><span class="type">Time</span> Id Command Argument</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">44</span>:<span class="number">58.052890</span>Z <span class="number">10</span> Query <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%general%&#x27;</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">45</span>:<span class="number">15.666672</span>Z <span class="number">10</span> Query <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;general_log%&#x27;</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">45</span>:<span class="number">28.970765</span>Z <span class="number">10</span> Query <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">47</span>:<span class="number">38.706804</span>Z <span class="number">11</span> <span class="keyword">Connect</span> root<span class="variable">@localhost</span> <span class="keyword">on</span> <span class="keyword">using</span> Socket</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">47</span>:<span class="number">38.707435</span>Z <span class="number">11</span> Query <span class="keyword">select</span> @<span class="variable">@version</span>_comment limit <span class="number">1</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">21.384886</span>Z <span class="number">12</span> <span class="keyword">Connect</span> root<span class="variable">@172</span><span class="number">.16</span><span class="number">.210</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">using</span> TCP<span class="operator">/</span>IP</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">21.385253</span>Z <span class="number">12</span> Query <span class="keyword">SET</span> NAMES utf8</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">21.385640</span>Z <span class="number">12</span> Query USE`atguigu12`</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">21.386179</span>Z <span class="number">12</span> Query <span class="keyword">SHOW</span> <span class="keyword">FULL</span> TABLES <span class="keyword">WHERE</span> Table_Type <span class="operator">!=</span></span><br><span class="line"><span class="string">&#x27;VIEW&#x27;</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">23.901778</span>Z <span class="number">13</span> <span class="keyword">Connect</span> root<span class="variable">@172</span><span class="number">.16</span><span class="number">.210</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">using</span> TCP<span class="operator">/</span>IP</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">23.902128</span>Z <span class="number">13</span> Query <span class="keyword">SET</span> NAMES utf8</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">23.905179</span>Z <span class="number">13</span> Query USE`atguigu`</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">23.905825</span>Z <span class="number">13</span> Query <span class="keyword">SHOW</span> <span class="keyword">FULL</span> TABLES <span class="keyword">WHERE</span> Table_Type <span class="operator">!=</span></span><br><span class="line"><span class="string">&#x27;VIEW&#x27;</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">32.163833</span>Z <span class="number">14</span> <span class="keyword">Connect</span> root<span class="variable">@172</span><span class="number">.16</span><span class="number">.210</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">using</span> TCP<span class="operator">/</span>IP</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">32.164451</span>Z <span class="number">14</span> Query <span class="keyword">SET</span> NAMES utf8</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">32.164840</span>Z <span class="number">14</span> Query USE`atguigu`</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">40.006687</span>Z <span class="number">14</span> Query <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account</span><br></pre></td></tr></table></figure><p>åœ¨é€šç”¨æŸ¥è¯¢æ—¥å¿—é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œä»€ä¹ˆæ—¶å€™å¼€å¯äº†æ–°çš„å®¢æˆ·ç«¯ç™»é™†æ•°æ®åº“ï¼Œç™»å½•ä¹‹ååšäº†ä»€ä¹ˆ SQL æ“ä½œï¼Œé’ˆå¯¹çš„æ˜¯å“ªä¸ªæ•°æ®è¡¨ç­‰ä¿¡æ¯ã€‚</p><h3 id="3-5-åœæ­¢æ—¥å¿—">3.5 åœæ­¢æ—¥å¿—</h3><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><p>ä¿®æ”¹<code>my.cnf</code>æˆ–è€…<code>my.ini</code>æ–‡ä»¶ï¼ŒæŠŠ[mysqld]ç»„ä¸‹çš„<code>general_log</code>å€¼è®¾ç½®ä¸º<code>OFF</code>æˆ–è€…æŠŠgeneral_logä¸€é¡¹ æ³¨é‡Šæ‰ã€‚ä¿®æ”¹ä¿å­˜åï¼Œå†<code>é‡å¯MySQLæœåŠ¡</code>ï¼Œå³å¯ç”Ÿæ•ˆã€‚</p><p>ä¸¾ä¾‹1ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">general_log</span>=<span class="string">OFF</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹2ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#general_log=ON</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><p>ä½¿ç”¨SETè¯­å¥åœæ­¢MySQLé€šç”¨æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log<span class="operator">=</span>off;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢é€šç”¨æ—¥å¿—åŠŸèƒ½ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;general_log%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="3-6-åˆ é™¤-åˆ·æ–°æ—¥å¿—">3.6 åˆ é™¤\åˆ·æ–°æ—¥å¿—</h3><p>å¦‚æœæ•°æ®çš„ä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œé‚£ä¹ˆé€šç”¨æŸ¥è¯¢æ—¥å¿—ä¼šå ç”¨æœåŠ¡å™¨éå¸¸å¤§çš„ç£ç›˜ç©ºé—´ã€‚æ•°æ®ç®¡ç†å‘˜å¯ä»¥åˆ é™¤å¾ˆé•¿æ—¶é—´ä¹‹å‰çš„æŸ¥è¯¢æ—¥å¿—ï¼Œä»¥ä¿è¯MySQLæœåŠ¡å™¨ä¸Šçš„ç¡¬ç›˜ç©ºé—´ã€‚</p><p><strong>æ‰‹åŠ¨åˆ é™¤æ–‡ä»¶</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;general_log%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œé€šç”¨æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•é»˜è®¤ä¸ºMySQLæ•°æ®ç›®å½•ã€‚åœ¨è¯¥ç›®å½•ä¸‹æ‰‹åŠ¨åˆ é™¤é€šç”¨æŸ¥è¯¢æ—¥å¿— atguigu01.log</p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”ŸæˆæŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ã€‚åˆ·æ–°MySQLæ•°æ®ç›®å½•ï¼Œå‘ç°åˆ›å»ºäº†æ–°çš„æ—¥å¿—æ–‡ ä»¶ã€‚å‰æä¸€å®šè¦å¼€å¯é€šç”¨æ—¥å¿—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin <span class="operator">-</span>uroot <span class="operator">-</span>p flush<span class="operator">-</span>logs</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›å¤‡ä»½æ—§çš„é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œå°±å¿…é¡»å…ˆå°†æ—§çš„æ—¥å¿—æ–‡ä»¶å¤åˆ¶å‡ºæ¥æˆ–è€…æ”¹åï¼Œç„¶åæ‰§è¡Œä¸Šé¢çš„mysqladminå‘½ä»¤ã€‚æ­£ç¡®æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd mysql-data-directory # è¾“å…¥è‡ªå·±çš„é€šç”¨æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br><span class="line">mv mysql.general.log mysql.general.log.old # æŒ‡å®šæ—§çš„æ–‡ä»¶å ä»¥åŠ æ–°çš„æ–‡ä»¶å</span><br><span class="line">mysqladmin -uroot -p flush-logs</span><br></pre></td></tr></table></figure><h2 id="4-é”™è¯¯æ—¥å¿—-error-log">4. é”™è¯¯æ—¥å¿—(error log)</h2><p>é”™è¯¯æ—¥å¿—è®°å½•äº† MySQLæœåŠ¡å™¨å¯åŠ¨ã€åœæ­¢è¿è¡Œçš„æ—¶é—´ï¼Œä»¥åŠç³»ç»Ÿå¯åŠ¨ã€è¿è¡Œå’Œåœæ­¢è¿‡ç¨‹ä¸­çš„è¯Šæ–­ä¿¡æ¯ï¼ŒåŒ…æ‹¬<code>é”™è¯¯</code>ã€<code>è­¦å‘Š</code>å’Œ<code>æç¤º</code>ç­‰ã€‚</p><p>é€šè¿‡é”™è¯¯æ—¥å¿—å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼Œä¾¿äºå³æ—¶å‘ç°æ•…éšœã€ä¿®å¤æ•…éšœã€‚å¦‚æœMySQLæœåŠ¡<code>å‡ºç°å¼‚å¸¸</code>ï¼Œé”™è¯¯æ—¥å¿—æ˜¯å‘ç°é—®é¢˜ã€è§£å†³æ•…éšœçš„<code>é¦–é€‰</code>ã€‚</p><h3 id="4-1-å¯åŠ¨æ—¥å¿—">4.1 å¯åŠ¨æ—¥å¿—</h3><p>åœ¨MySQLæ•°æ®åº“ä¸­ï¼Œé”™è¯¯æ—¥å¿—åŠŸèƒ½æ˜¯<code>é»˜è®¤å¼€å¯</code>çš„ã€‚è€Œä¸”ï¼Œé”™è¯¯æ—¥å¿—<code>æ— æ³•è¢«ç¦æ­¢</code>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—å­˜å‚¨åœ¨MySQLæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å¤¹ä¸‹ï¼Œåç§°é»˜è®¤ä¸º<code>mysqld.log</code>ï¼ˆLinuxç³»ç»Ÿï¼‰æˆ–<code>hostname.err</code>ï¼ˆmacç³»ç»Ÿï¼‰ã€‚å¦‚æœéœ€è¦åˆ¶å®šæ–‡ä»¶åï¼Œåˆ™éœ€è¦åœ¨my.cnfæˆ–è€…my.iniä¸­åšå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">log-error</span>=<span class="string">[path/[filename]] #pathä¸ºæ—¥å¿—æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è·¯å¾„ï¼Œfilenameä¸ºæ—¥å¿—æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®é¡¹åï¼Œéœ€è¦é‡å¯MySQLæœåŠ¡ä»¥ç”Ÿæ•ˆã€‚</p><h3 id="4-2-æŸ¥çœ‹æ—¥å¿—">4.2 æŸ¥çœ‹æ—¥å¿—</h3><p>MySQLé”™è¯¯æ—¥å¿—æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶å½¢å¼å­˜å‚¨çš„ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç›´æ¥æŸ¥çœ‹ã€‚</p><p>æŸ¥è¯¢é”™è¯¯æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;log_err%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+----------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name              <span class="operator">|</span> <span class="keyword">Value</span>                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+----------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_error                  <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log                    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_error_services         <span class="operator">|</span> log_filter_internal; log_sink_internal <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_error_suppression_list <span class="operator">|</span>                                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_error_verbosity        <span class="operator">|</span> <span class="number">2</span>                                      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+----------------------------------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœä¸­å¯ä»¥çœ‹åˆ°é”™è¯¯æ—¥å¿—æ–‡ä»¶æ˜¯mysqld.logï¼Œä½äºMySQLé»˜è®¤çš„æ•°æ®ç›®å½•ä¸‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715160657093.png" alt="image-20220715160657093"  /><h3 id="4-3-åˆ é™¤-åˆ·æ–°æ—¥å¿—">4.3 åˆ é™¤\åˆ·æ–°æ—¥å¿—</h3><p>å¯¹äºå¾ˆä¹…ä»¥å‰çš„é”™è¯¯æ—¥å¿—ï¼Œæ•°æ®åº“ç®¡ç†å‘˜æŸ¥çœ‹è¿™äº›é”™è¯¯æ—¥å¿—çš„å¯èƒ½æ€§ä¸å¤§ï¼Œå¯ä»¥å°†è¿™äº›é”™è¯¯æ—¥å¿—åˆ é™¤ï¼Œ ä»¥ä¿è¯MySQLæœåŠ¡å™¨ä¸Šçš„<code>ç¡¬ç›˜ç©ºé—´</code>ã€‚MySQLçš„é”™è¯¯æ—¥å¿—æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ï¼Œå¯ä»¥<code>ç›´æ¥åˆ é™¤</code>ã€‚</p><ul><li>ç¬¬ä¸€æ­¥ï¼ˆæ–¹å¼1ï¼‰ï¼šåˆ é™¤æ“ä½œ</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm <span class="operator">-</span>f <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>mysqld.log</span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡ŒçŠ¶æ€ä¸‹åˆ é™¤é”™è¯¯æ—¥å¿—æ–‡ä»¶åï¼ŒMySQLå¹¶ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ã€‚</p><ul><li>ç¬¬ä¸€æ­¥ï¼ˆæ–¹å¼2ï¼‰ï¼šé‡å‘½åæ–‡ä»¶</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log.old</span><br></pre></td></tr></table></figure><ul><li>ç¬¬äºŒæ­¥ï¼šé‡å»ºæ—¥å¿—</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin <span class="operator">-</span>uroot <span class="operator">-</span>p flush<span class="operator">-</span>logs</span><br></pre></td></tr></table></figure><p>å¯èƒ½ä¼šæŠ¥é”™</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@atguigu01</span> log]# mysqladmin <span class="operator">-</span>uroot <span class="operator">-</span>p flush<span class="operator">-</span>logs</span><br><span class="line">Enter password:</span><br><span class="line">mysqladmin: refresh failed; error: <span class="string">&#x27;Could not open file &#x27;</span><span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log<span class="string">&#x27; for</span></span><br><span class="line"><span class="string">error logging.&#x27;</span></span><br></pre></td></tr></table></figure><p>å®˜ç½‘æç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715161132368.png" alt="image-20220715161132368"></p><p>è¡¥å……æ“ä½œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install <span class="operator">-</span>omysql <span class="operator">-</span>gmysql <span class="operator">-</span>m0644 <span class="operator">/</span>dev<span class="operator">/</span><span class="keyword">null</span> <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log</span><br></pre></td></tr></table></figure><p><code>flush-logs</code>æŒ‡ä»¤æ“ä½œï¼š</p><ul><li><p>MysQL 5.5.7ä»¥å‰çš„ç‰ˆæœ¬ï¼Œflush-logså°†é”™è¯¯æ—¥å¿—æ–‡ä»¶é‡å‘½åä¸ºflename.err_oldï¼Œå¹¶åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚</p></li><li><p>ä»MySQL5.5.7å¼€å§‹ï¼Œflush-ogsåªæ˜¯é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸åšæ—¥å¿—å¤‡ä»½å’Œåˆ›å»ºçš„æ“ä½œã€‚</p></li><li><p>å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒMySQLå¯åŠ¨æˆ–è€…æ‰§è¡Œflush-logsæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚é‡æ–°åˆ›å»ºé”™è¯¯æ—¥å¿—ï¼Œå¤§å°ä¸º0å­—èŠ‚ã€‚</p></li></ul><h3 id="4-4-MySQL-8-0-æ–°ç‰¹æ€§">4.4 MySQL 8.0 æ–°ç‰¹æ€§</h3><p>MySQL8.0é‡Œå¯¹é”™è¯¯æ—¥å¿—çš„æ”¹è¿›ã€‚MySQL8.0çš„é”™è¯¯æ—¥å¿—å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå…¨æ–°çš„æ—¥å¿—ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬é‡Œï¼Œæ¥å—äº†æ¥è‡ªç¤¾åŒºçš„å¹¿æ³›æ‰¹è¯„æ„è§ï¼Œåœ¨è¿™äº›æ„è§å’Œå»ºè®®çš„åŸºç¡€ä¸Šç”Ÿæˆäº†æ–°çš„æ—¥å¿—ï¼Œ ä¸‹é¢è¿™äº›æ˜¯æ¥è‡ªç¤¾åŒºçš„æ„è§ï¼š</p><ul><li><p>é»˜è®¤æƒ…å†µä¸‹å†…å®¹è¿‡äºå†—é•¿</p></li><li><p>é—æ¼äº†æœ‰ç”¨çš„ä¿¡æ¯</p></li><li><p>éš¾ä»¥è¿‡æ»¤æŸäº›ä¿¡æ¯</p></li><li><p>æ²¡æœ‰æ ‡è¯†é”™è¯¯ä¿¡æ¯çš„å­ç³»ç»Ÿæº</p></li><li><p>æ²¡æœ‰é”™è¯¯ä»£ç ï¼Œè§£ææ¶ˆæ¯éœ€è¦è¯†åˆ«é”™è¯¯</p></li><li><p>å¼•å¯¼æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±</p></li><li><p>å›ºå®šæ ¼å¼</p></li></ul><p>é’ˆå¯¹è¿™äº›æ„è§ï¼ŒMySQLåšäº†å¦‚ä¸‹æ”¹å˜ï¼š</p><ul><li><p>é‡‡ç”¨ç»„ä»¶æ¶æ„ï¼Œé€šè¿‡ä¸åŒçš„ç»„ä»¶æ‰§è¡Œæ—¥å¿—çš„å†™å…¥å’Œè¿‡æ»¤åŠŸèƒ½</p></li><li><p>å†™å…¥é”™è¯¯æ—¥å¿—çš„å…¨éƒ¨ä¿¡æ¯éƒ½å…·æœ‰å”¯ä¸€çš„é”™è¯¯ä»£ç ä»10000å¼€å§‹</p></li><li><p>å¢åŠ äº†ä¸€ä¸ªæ–°çš„æ¶ˆæ¯åˆ†ç±»ã€Šsystemã€‹ç”¨äºåœ¨é”™è¯¯æ—¥å¿—ä¸­å§‹ç»ˆå¯è§çš„éé”™è¯¯ä½†æœåŠ¡å™¨çŠ¶æ€æ›´æ”¹äº‹ä»¶çš„æ¶ˆæ¯å¢åŠ äº†é¢å¤–çš„é™„åŠ ä¿¡æ¯ï¼Œä¾‹å¦‚å…³æœºæ—¶çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè°å‘èµ·çš„å…³æœºç­‰ç­‰</p></li><li><p>ä¸¤ç§è¿‡æ»¤æ–¹å¼ï¼ŒInternalå’ŒDragnet</p></li><li><p>ä¸‰ç§å†™å…¥å½¢å¼ï¼Œç»å…¸ã€JSONå’Œsyseventlog</p></li></ul><blockquote><p>å°ç»“ï¼š</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç®¡ç†å‘˜ä¸éœ€è¦æŸ¥çœ‹é”™è¯¯æ—¥å¿—ã€‚ä½†æ˜¯ï¼ŒMySQLæœåŠ¡å™¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œç®¡ç†å‘˜å¯ä»¥ä»é”™è¯¯æ—¥å¿—ä¸­æ‰¾åˆ°å‘ç”Ÿå¼‚å¸¸çš„æ—¶é—´ã€åŸå› ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯æ¥è§£å†³å¼‚å¸¸ã€‚</p></blockquote><hr><h2 id="5-äºŒè¿›åˆ¶æ—¥å¿—-bin-log">5. äºŒè¿›åˆ¶æ—¥å¿—(bin log)</h2><p>binlogå¯ä»¥è¯´æ˜¯MySQLä¸­æ¯”è¾ƒ<code>é‡è¦</code>çš„æ—¥å¿—äº†ï¼Œåœ¨æ—¥å¸¸å¼€å‘åŠè¿ç»´è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°ã€‚</p><p>binlogå³binary logï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œä¹Ÿå«ä½œå˜æ›´æ—¥å¿—ï¼ˆupdate logï¼‰ã€‚å®ƒè®°å½•äº†æ•°æ®åº“æ‰€æœ‰æ‰§è¡Œçš„<code>DDL</code>å’Œ<code>DML</code>ç­‰æ•°æ®åº“æ›´æ–°äº‹ä»¶çš„è¯­å¥ï¼Œä½†æ˜¯ä¸åŒ…å«æ²¡æœ‰ä¿®æ”¹ä»»ä½•æ•°æ®çš„è¯­å¥ï¼ˆå¦‚æ•°æ®æŸ¥è¯¢è¯­å¥selectã€ showç­‰ï¼‰ã€‚</p><p>å®ƒä»¥<code>äº‹ä»¶å½¢å¼</code>è®°å½•å¹¶ä¿å­˜åœ¨<code>äºŒè¿›åˆ¶æ–‡ä»¶</code>ä¸­ã€‚é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å†ç°æ•°æ®æ›´æ–°æ“ä½œçš„å…¨è¿‡ç¨‹ã€‚</p><blockquote><p>å¦‚æœæƒ³è¦è®°å½•æ‰€æœ‰è¯­å¥ï¼ˆä¾‹å¦‚ï¼Œä¸ºäº†è¯†åˆ«æœ‰é—®é¢˜çš„æŸ¥è¯¢ï¼‰ï¼Œéœ€è¦ä½¿ç”¨é€šç”¨æŸ¥è¯¢æ—¥å¿—ã€‚</p></blockquote><p>binlogä¸»è¦åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p>ä¸€æ˜¯ç”¨äº<code>æ•°æ®æ¢å¤</code>ï¼Œå¦‚æœMysQLæ•°æ®åº“æ„å¤–åœæ­¢ï¼Œå¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ¥æŸ¥çœ‹ç”¨æˆ·æ‰§è¡Œäº†å“ªäº›æ“ä½œï¼Œå¯¹æ•°æ®åº“æœåŠ¡å™¨æ–‡ä»¶åšäº†å“ªäº›ä¿®æ”¹ï¼Œç„¶åæ ¹æ®äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¸­çš„è®°å½•æ¥æ¢å¤æ•°æ®åº“æœåŠ¡å™¨ã€‚</p></li><li><p>äºŒæ˜¯ç”¨äº<code>æ•°æ®å¤åˆ¶</code>ï¼Œç”±äºæ—¥å¿—çš„å»¶ç»­æ€§å’Œæ—¶æ•ˆæ€§ï¼ŒmasteræŠŠå®ƒçš„äºŒè¿›åˆ¶æ—¥å¿—ä¼ é€’ç»™slavesæ¥è¾¾åˆ°master-slaveæ•°æ®ä¸€è‡´çš„ç›®çš„ã€‚</p></li></ul><p>å¯ä»¥è¯´MysQLæ•°æ®åº“çš„<span class='p red'>æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»</span>éƒ½ç¦»ä¸å¼€binlogï¼Œéœ€è¦ä¾é binlogæ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715161842703.png" alt="image-20220715161842703"></p><h3 id="5-1-æŸ¥çœ‹é»˜è®¤æƒ…å†µ">5.1 æŸ¥çœ‹é»˜è®¤æƒ…å†µ</h3><p>æŸ¥çœ‹è®°å½•äºŒè¿›åˆ¶æ—¥å¿—æ˜¯å¦å¼€å¯ï¼šåœ¨MySQL8ä¸­é»˜è®¤æƒ…å†µä¸‹ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¼€å¯çš„ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>                            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_bin                         <span class="operator">|</span> <span class="keyword">ON</span>                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_basename                <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>binlog            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_index                   <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>binlog.index      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_trust_function_creators <span class="operator">|</span> OFF                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_use_v1_row_events       <span class="operator">|</span> OFF                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sql_log_bin                     <span class="operator">|</span> <span class="keyword">ON</span>                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><code>log_bin_basename</code>ï¼šæ˜¯binlogæ—¥å¿—çš„åŸºæœ¬æ–‡ä»¶åï¼Œåé¢ä¼šè¿½åŠ æ ‡è¯†æ¥è¡¨ç¤ºæ¯ä¸€ä¸ªæ–‡ä»¶</p><p><code>log_bin_ index</code>ï¼šæ˜¯binlogæ–‡ä»¶çš„ç´¢å¼•æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç®¡ç†äº†æ‰€æœ‰çš„binlogæ–‡ä»¶çš„ç›®å½•</p><p><code>log_bin_trust_function_creators</code>ï¼šé™åˆ¶å­˜å‚¨è¿‡ç¨‹ï¼Œå‰é¢æˆ‘ä»¬å·±ç»è®²è¿‡äº†ï¼Œè¿™æ˜¯å› ä¸ºäºŒè¿›åˆ¶æ—¥å¿—çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯ç”¨äºä¸»ä»å¤åˆ¶ï¼Œè€Œå­˜å‚¨å‡½æ•°æœ‰å¯èƒ½å¯¼è‡´ä¸»ä»çš„æ•°æ®ä¸ä¸€è‡´ã€‚æ‰€ä»¥å½“å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åï¼Œéœ€è¦é™åˆ¶å­˜å‚¨å‡½æ•°çš„åˆ›å»ºã€ä¿®æ”¹ã€è°ƒç”¨</p><p><code>log_bin_use_v1_row_events</code>æ­¤åªè¯»ç³»ç»Ÿå˜é‡å·²å¼ƒç”¨ã€‚ONè¡¨ç¤ºä½¿ç”¨ç‰ˆæœ¬1äºŒè¿›åˆ¶æ—¥å¿—è¡Œï¼ŒOFFè¡¨ç¤ºä½¿ç”¨ç‰ˆæœ¬2 äºŒè¿›åˆ¶æ—¥å¿—è¡Œ(MySQL 5.6 çš„é»˜è®¤å€¼ä¸º2ï¼‰</p><hr><h3 id="5-2-æ—¥å¿—å‚æ•°è®¾ç½®">5.2 æ—¥å¿—å‚æ•°è®¾ç½®</h3><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><p>ä¿®æ”¹MySQLçš„<code>my.cnf</code>æˆ–<code>my.ini</code>æ–‡ä»¶å¯ä»¥è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„ç›¸å…³å‚æ•°ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">atguigu-bin</span></span><br><span class="line"><span class="attr">binlog_expire_logs_seconds</span>=<span class="string">600</span></span><br><span class="line"><span class="attr">max_binlog_size</span>=<span class="string">100M</span></span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼š</p><ol><li>log-bin=mysql-bin #æ‰“å¼€æ—¥å¿—(ä¸»æœºéœ€è¦æ‰“å¼€)ï¼Œè¿™ä¸ªmysql-binä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥åŠ ä¸Šè·¯å¾„ï¼Œ å¦‚ï¼š/home/www/mysql_bin_log/mysql-bin</li><li>binlog_expire_logs_secondsï¼šæ­¤å‚æ•°æ§åˆ¶äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æ—¶é•¿ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤2592000 30å¤© --14400 4å°æ—¶ï¼›86400 1å¤©ï¼›259200 3å¤©ï¼›</li><li>max_binlog_sizeï¼šæ§åˆ¶å•ä¸ªäºŒè¿›åˆ¶æ—¥å¿—å¤§å°ï¼Œå½“å‰æ—¥å¿—æ–‡ä»¶å¤§å°è¶…è¿‡æ­¤å˜é‡æ—¶ï¼Œæ‰§è¡Œåˆ‡æ¢åŠ¨ä½œã€‚æ­¤å‚æ•°çš„<code>æœ€å¤§å’Œé»˜è®¤å€¼æ˜¯1GB</code>ï¼Œè¯¥è®¾ç½®å¹¶<code>ä¸èƒ½ä¸¥æ ¼æ§åˆ¶Binlogçš„å¤§å°</code>ï¼Œå°¤å…¶æ˜¯Binlogæ¯”æ¯”è¾ƒé è¿‘æœ€å¤§å€¼è€Œåˆé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§äº‹åŠ¡æ—¶ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§ï¼Œå¯èƒ½ä¸åšåˆ‡æ¢æ—¥å¿—çš„åŠ¨ä½œï¼Œåªèƒ½å°†è¯¥äº‹åŠ¡çš„æ‰€æœ‰SQLéƒ½è®°å½•è¿›å½“å‰æ—¥å¿—ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸã€‚ä¸€èˆ¬æƒ…å†µä¸‹å¯é‡‡å–é»˜è®¤å€¼ã€‚</li></ol></blockquote><p>é‡æ–°å¯åŠ¨MySQLæœåŠ¡ï¼ŒæŸ¥è¯¢äºŒè¿›åˆ¶æ—¥å¿—çš„ä¿¡æ¯ï¼Œæ‰§è¡Œç»“æœï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>                            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_bin                         <span class="operator">|</span> <span class="keyword">ON</span>                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_basename                <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu<span class="operator">-</span>bin       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_index                   <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu<span class="operator">-</span>bin.index <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_trust_function_creators <span class="operator">|</span> OFF                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_use_v1_row_events       <span class="operator">|</span> OFF                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sql_log_bin                     <span class="operator">|</span> <span class="keyword">ON</span>                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><strong>è®¾ç½®å¸¦æ–‡ä»¶å¤¹çš„bin-logæ—¥å¿—å­˜æ”¾ç›®å½•</strong></p><p>å¦‚æœæƒ³æ”¹å˜æ—¥å¿—æ–‡ä»¶çš„ç›®å½•å’Œåç§°ï¼Œå¯ä»¥å¯¹my.cnfæˆ–my.iniä¸­çš„log_binå‚æ•°ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">&quot;/var/lib/mysql/binlog/atguigu-bin&quot;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæ–°å»ºçš„æ–‡ä»¶å¤¹éœ€è¦ä½¿ç”¨mysqlç”¨æˆ·ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown <span class="operator">-</span>R <span class="operator">-</span>v mysql:mysql binlog</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715164107352.png" alt="image-20220715164107352" /><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><p>å¦‚æœä¸å¸Œæœ›é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯çš„æ–¹å¼è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„è¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ åœ¨mysql8ä¸­åªæœ‰<code>ä¼šè¯çº§åˆ«</code>çš„è®¾ç½®ï¼Œæ²¡æœ‰äº†globalçº§åˆ«çš„è®¾ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">global</span> çº§åˆ«</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> sql_log_bin<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">ERROR <span class="number">1228</span> (HY000): Variable <span class="string">&#x27;sql_log_bin&#x27;</span> <span class="keyword">is</span> a SESSION variable <span class="keyword">and</span> can`t be used</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">SET</span> <span class="keyword">GLOBAL</span></span><br><span class="line"></span><br><span class="line"># sessionçº§åˆ«</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SET</span> sql_log_bin<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> ç§’)</span><br></pre></td></tr></table></figure><h3 id="5-3-æŸ¥çœ‹æ—¥å¿—">5.3 æŸ¥çœ‹æ—¥å¿—</h3><p>å½“MySQLåˆ›å»ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªä»¥â€œfilenameâ€ä¸ºåç§°ã€ä»¥â€œ.indexâ€ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œå†åˆ›å»ºä¸€ ä¸ªä»¥â€œfilenameâ€ä¸ºåç§°ã€ä»¥â€œ.000001â€ä¸ºåç¼€çš„æ–‡ä»¶ã€‚</p><p>MySQLæœåŠ¡<code>é‡æ–°å¯åŠ¨ä¸€æ¬¡</code>ï¼Œä»¥â€œ.000001â€ä¸ºåç¼€çš„æ–‡ä»¶å°±ä¼šå¢åŠ ä¸€ä¸ªï¼Œå¹¶ä¸”åç¼€åæŒ‰1é€’å¢ã€‚å³æ—¥å¿—æ–‡ä»¶çš„ ä¸ªæ•°ä¸MySQLæœåŠ¡å¯åŠ¨çš„æ¬¡æ•°ç›¸åŒï¼›å¦‚æœæ—¥å¿—é•¿åº¦è¶…è¿‡äº†<code>max_binlog_size</code>çš„ä¸Šé™ï¼ˆé»˜è®¤æ˜¯1GBï¼‰ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚</p><p>æŸ¥çœ‹å½“å‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åˆ—è¡¨åŠå¤§å°ã€‚æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="type">BINARY</span> LOGS;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Log_name           <span class="operator">|</span> File_size <span class="operator">|</span> Encrypted <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----------+-----------+</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">156</span>       <span class="operator">|</span> <span class="keyword">No</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----------+-----------+</span></span><br><span class="line"><span class="number">1</span> è¡Œäºæ•°æ®é›† (<span class="number">0.02</span> ç§’)</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å¯¹æ•°æ®åº“çš„ä¿®æ”¹éƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚ä½†binlogæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹ï¼Œæƒ³è¦æ›´ç›´è§‚çš„è§‚æµ‹å®ƒå°±è¦å€ŸåŠ©<code>mysqlbinlog</code>å‘½ä»¤å·¥å…·äº†ã€‚æŒ‡ä»¤å¦‚ä¸‹ï¼šåœ¨æŸ¥çœ‹æ‰§è¡Œï¼Œå…ˆæ‰§è¡Œä¸€æ¡SQLè¯­å¥ï¼Œå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> student <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰_back&#x27;</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>å¼€å§‹æŸ¥çœ‹binlog</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715164718970.png" alt="image-20220715164718970"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715164743351.png" alt="image-20220715164743351" /><p>æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ—¥å¿—ä¸­è®°å½•äº†ç”¨æˆ·çš„ä¸€äº›æ“ä½œï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å‡ºç°å…·ä½“çš„SQLè¯­å¥ï¼Œè¿™æ˜¯å› ä¸ºbinlogå…³é”®å­—åé¢çš„å†…å®¹æ˜¯ç»è¿‡ç¼–ç åçš„<code>äºŒè¿›åˆ¶æ—¥å¿—</code>ã€‚</p><p>è¿™é‡Œä¸€ä¸ªupdateè¯­å¥åŒ…å«å¦‚ä¸‹äº‹ä»¶</p><ul><li><p>Query äº‹ä»¶è´Ÿè´£å¼€å§‹ä¸€ä¸ªäº‹åŠ¡(BEGIN)</p></li><li><p>Table_mapäº‹ä»¶è´Ÿè´£æ˜ å°„éœ€è¦çš„è¡¨</p></li><li><p>Update_rowsäº‹ä»¶è´Ÿè´£å†™å…¥æ•°æ®</p></li><li><p>Xidäº‹ä»¶è´Ÿè´£ç»“æŸäº‹åŠ¡</p></li></ul><p>ä¸‹é¢å‘½ä»¤å°†è¡Œäº‹ä»¶ä»¥<code>ä¼ªSQLçš„å½¢å¼</code>è¡¨ç°å‡ºæ¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog <span class="operator">-</span>v &quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;</span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">324</span> CRC32 <span class="number">0x6b31978b</span> Query thread_id<span class="operator">=</span><span class="number">10</span></span><br><span class="line">exec_time<span class="operator">=</span><span class="number">0</span> error_code<span class="operator">=</span><span class="number">0</span></span><br><span class="line"><span class="keyword">SET</span> <span class="type">TIMESTAMP</span><span class="operator">=</span><span class="number">1641345397</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.pseudo_thread_id<span class="operator">=</span><span class="number">10</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.foreign_key_checks<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.sql_auto_is_null<span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">@<span class="variable">@session</span>.unique_checks<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.autocommit<span class="operator">=</span><span class="number">1</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.sql_mode<span class="operator">=</span><span class="number">1168113696</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.auto_increment_increment<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.auto_increment_offset<span class="operator">=</span><span class="number">1</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="comment">/*!\C utf8mb3 */</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">@<span class="variable">@session</span>.character_set_client<span class="operator">=</span><span class="number">33</span>,@<span class="variable">@session</span>.collation_connection<span class="operator">=</span><span class="number">33</span>,@<span class="variable">@session</span>.collatio</span><br><span class="line">n_server<span class="operator">=</span><span class="number">255</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.lc_time_names<span class="operator">=</span><span class="number">0</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.collation_database<span class="operator">=</span><span class="keyword">DEFAULT</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="comment">/*!80011 SET @@session.default_collation_for_utf8mb4=255*/</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">/*!*/</span>;</span><br><span class="line"># <span class="keyword">at</span> <span class="number">324</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">391</span> CRC32 <span class="number">0x74f89890</span> Table_map:</span><br><span class="line">`atguigu14`.`student`mapped <span class="keyword">to</span> number <span class="number">85</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">391</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">470</span> CRC32 <span class="number">0xc9920491</span> Update_rows: <span class="keyword">table</span> id</span><br><span class="line"><span class="number">85</span> flags: STMT_END_F</span><br><span class="line"></span><br><span class="line">BINLOG <span class="string">&#x27;</span></span><br><span class="line"><span class="string">dfHUYRMBAAAAQwAAAIcBAAAAAFUAAAAAAAEACWF0Z3VpZ3UxNAAHc3R1ZGVudAADAw8PBDwAHgAG</span></span><br><span class="line"><span class="string">AQEAAgEhkJj4dA==</span></span><br><span class="line"><span class="string">dfHUYR8BAAAATwAAANYBAAAAAFUAAAAAAAEAAgAD//8AAQAAAAblvKDkuIkG5LiA54+tAAEAAAAL</span></span><br><span class="line"><span class="string">5byg5LiJX2JhY2sG5LiA54+tkQSSyQ==</span></span><br><span class="line"><span class="string">&#x27;</span><span class="comment">/*!*/</span>;</span><br><span class="line">### <span class="keyword">UPDATE</span>`atguigu`.`student`</span><br><span class="line">### <span class="keyword">WHERE</span></span><br><span class="line">### <span class="variable">@1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">### <span class="variable">@2</span><span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line">### <span class="variable">@3</span><span class="operator">=</span><span class="string">&#x27;ä¸€ç­&#x27;</span></span><br><span class="line">### <span class="keyword">SET</span></span><br><span class="line">### <span class="variable">@1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">### <span class="variable">@2</span><span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰_back&#x27;</span></span><br><span class="line">### <span class="variable">@3</span><span class="operator">=</span><span class="string">&#x27;ä¸€ç­&#x27;</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">470</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">501</span> CRC32 <span class="number">0xca01d30f</span> Xid <span class="operator">=</span> <span class="number">15</span></span><br><span class="line"><span class="keyword">COMMIT</span><span class="comment">/*!*/</span>;</span><br></pre></td></tr></table></figure><p>å‰é¢çš„å‘½ä»¤åŒæ—¶æ˜¾ç¤ºbinlogæ ¼å¼çš„è¯­å¥ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸æ˜¾ç¤ºå®ƒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog <span class="operator">-</span>v <span class="comment">--base64-output=DECODE-ROWS &quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">324</span> CRC32 <span class="number">0x6b31978b</span> Query thread_id<span class="operator">=</span><span class="number">10</span></span><br><span class="line">exec_time<span class="operator">=</span><span class="number">0</span> error_code<span class="operator">=</span><span class="number">0</span></span><br><span class="line"><span class="keyword">SET</span> <span class="type">TIMESTAMP</span><span class="operator">=</span><span class="number">1641345397</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.pseudo_thread_id<span class="operator">=</span><span class="number">10</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.foreign_key_checks<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.sql_auto_is_null<span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">@<span class="variable">@session</span>.unique_checks<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.autocommit<span class="operator">=</span><span class="number">1</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.sql_mode<span class="operator">=</span><span class="number">1168113696</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.auto_increment_increment<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.auto_increment_offset<span class="operator">=</span><span class="number">1</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="comment">/*!\C utf8mb3 */</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">@<span class="variable">@session</span>.character_set_client<span class="operator">=</span><span class="number">33</span>,@<span class="variable">@session</span>.collation_connection<span class="operator">=</span><span class="number">33</span>,@<span class="variable">@session</span>.collatio</span><br><span class="line">n_server<span class="operator">=</span><span class="number">255</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.lc_time_names<span class="operator">=</span><span class="number">0</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.collation_database<span class="operator">=</span><span class="keyword">DEFAULT</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="comment">/*!80011 SET @@session.default_collation_for_utf8mb4=255*/</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">/*!*/</span>;</span><br><span class="line"># <span class="keyword">at</span> <span class="number">324</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">391</span> CRC32 <span class="number">0x74f89890</span> Table_map:</span><br><span class="line">`atguigu14`.`student`mapped <span class="keyword">to</span> number <span class="number">85</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">391</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">470</span> CRC32 <span class="number">0xc9920491</span> Update_rows: <span class="keyword">table</span> id</span><br><span class="line"><span class="number">85</span> flags: STMT_END_F</span><br><span class="line">### <span class="keyword">UPDATE</span>`atguigu14`.`student`</span><br><span class="line">### <span class="keyword">WHERE</span></span><br><span class="line">### <span class="variable">@1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">### <span class="variable">@2</span><span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line">### <span class="variable">@3</span><span class="operator">=</span><span class="string">&#x27;ä¸€ç­&#x27;</span></span><br><span class="line">### <span class="keyword">SET</span></span><br><span class="line">### <span class="variable">@1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">### <span class="variable">@2</span><span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰_back&#x27;</span></span><br><span class="line">### <span class="variable">@3</span><span class="operator">=</span><span class="string">&#x27;ä¸€ç­&#x27;</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">470</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">501</span> CRC32 <span class="number">0xca01d30f</span> Xid <span class="operator">=</span> <span class="number">15</span></span><br></pre></td></tr></table></figure><p>å…³äºmysqlbinlogå·¥å…·çš„ä½¿ç”¨æŠ€å·§è¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚åªè§£æå¯¹æŸä¸ªåº“çš„æ“ä½œæˆ–è€…æŸä¸ªæ—¶é—´æ®µå†…çš„æ“ä½œç­‰ã€‚ç®€å•åˆ†äº«å‡ ä¸ªå¸¸ç”¨çš„è¯­å¥ï¼Œæ›´å¤šæ“ä½œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å¯æŸ¥çœ‹å‚æ•°å¸®åŠ©</span><br><span class="line">mysqlbinlog <span class="comment">--no-defaults --help</span></span><br><span class="line"># æŸ¥çœ‹æœ€å<span class="number">100</span>è¡Œ</span><br><span class="line">mysqlbinlog <span class="comment">--no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |tail</span></span><br><span class="line"><span class="number">-100</span></span><br><span class="line"># æ ¹æ®positionæŸ¥æ‰¾</span><br><span class="line">mysqlbinlog <span class="comment">--no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |grep -A</span></span><br><span class="line"><span class="number">20</span> <span class="string">&#x27;4939002&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ç§åŠæ³•è¯»å–å‡ºbinlogæ—¥å¿—çš„å…¨æ–‡å†…å®¹æ¯”è¾ƒå¤šï¼Œä¸å®¹æ˜“åˆ†è¾¨æŸ¥çœ‹åˆ°posç‚¹ä¿¡æ¯ï¼Œä¸‹é¢ä»‹ç»ä¸€ç§æ›´ä¸ºæ–¹ä¾¿çš„æŸ¥è¯¢å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events [<span class="keyword">IN</span> <span class="string">&#x27;log_name&#x27;</span>] [<span class="keyword">FROM</span> pos] [LIMIT [<span class="keyword">offset</span>,] row_count];</span><br></pre></td></tr></table></figure><p>*<code>IN 'log_name'</code>ï¼šæŒ‡å®šè¦æŸ¥è¯¢çš„binlogæ–‡ä»¶åï¼ˆä¸æŒ‡å®šå°±æ˜¯ç¬¬ä¸€ä¸ªbinlogæ–‡ä»¶ï¼‰ã€€<br>*<code>FROM pos</code>ï¼šæŒ‡å®šä»å“ªä¸ªposèµ·å§‹ç‚¹å¼€å§‹æŸ¥èµ·ï¼ˆä¸æŒ‡å®šå°±æ˜¯ä»æ•´ä¸ªæ–‡ä»¶é¦–ä¸ªposç‚¹å¼€å§‹ç®—ï¼‰<br>*<code>LIMIT [offset]</code>ï¼šåç§»é‡(ä¸æŒ‡å®šå°±æ˜¯0)<br>*<code>row_count</code>:æŸ¥è¯¢æ€»æ¡æ•°ï¼ˆä¸æŒ‡å®šå°±æ˜¯æ‰€æœ‰è¡Œï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;atguigu-bin.000002&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Log_name           <span class="operator">|</span> Pos <span class="operator">|</span> Event_type     <span class="operator">|</span> Server_id <span class="operator">|</span> End_log_pos <span class="operator">|</span> Info                                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">4</span>   <span class="operator">|</span> Format_desc    <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">125</span>         <span class="operator">|</span> Server ver: <span class="number">8.0</span><span class="number">.26</span>, Binlog ver: <span class="number">4</span>                      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">125</span> <span class="operator">|</span> Previous_gtids <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">156</span>         <span class="operator">|</span>                                                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">156</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">235</span>         <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">235</span> <span class="operator">|</span> Query          <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">324</span>         <span class="operator">|</span> <span class="keyword">BEGIN</span>                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">324</span> <span class="operator">|</span> Table_map      <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">391</span>         <span class="operator">|</span> table_id: <span class="number">85</span>(atguigu14.student)                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">391</span> <span class="operator">|</span> Update_rows    <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">470</span>         <span class="operator">|</span> table_id: <span class="number">85</span>flags: STMT_END_F                          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">470</span> <span class="operator">|</span> Xid            <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">501</span>         <span class="operator">|</span> <span class="keyword">COMMIT</span> <span class="comment">/*xid=15 */</span>                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">501</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">578</span>         <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">578</span> <span class="operator">|</span> Query     <span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> <span class="number">721</span> <span class="operator">|</span> use`atguigu14`; <span class="keyword">create</span> <span class="keyword">table</span> test(id <span class="type">int</span>, title <span class="type">varchar</span>(<span class="number">100</span>)) <span class="comment">/* xid=19 */</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">721</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">800</span>         <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">800</span> <span class="operator">|</span> Query          <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">880</span>         <span class="operator">|</span> <span class="keyword">BEGIN</span>                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">880</span> <span class="operator">|</span> Table_map      <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">943</span>         <span class="operator">|</span> table_id: <span class="number">89</span>(atguigu14.test)                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">943</span> <span class="operator">|</span> Write_rows     <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">992</span>         <span class="operator">|</span> table_id: <span class="number">89</span> flags: STMT_END_F                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">992</span> <span class="operator">|</span> Xid            <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">1023</span>        <span class="operator">|</span> <span class="keyword">COMMIT</span> <span class="comment">/*xid=21 */</span>                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+</span></span><br><span class="line"><span class="number">14</span> è¡Œäºæ•°æ®é›† (<span class="number">0.02</span> ç§’)</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715165603879.png" alt="image-20220715165603879"  /><p>ä¸Šé¢æˆ‘ä»¬è®²äº†è¿™ä¹ˆå¤šéƒ½æ˜¯åŸºäºbinlogçš„é»˜è®¤æ ¼å¼ï¼Œbinlogæ ¼å¼æŸ¥çœ‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> binlog_format <span class="operator">|</span> <span class="type">ROW</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> è¡Œäºæ•°æ®é›† (<span class="number">0.02</span> ç§’)</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œbinlogè¿˜æœ‰2ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯<code>Statement</code>å’Œ<code>Mixed</code></p><ul><li><p>Statement</p><p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚</p><p>ä¼˜ç‚¹ï¼šä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†IOï¼Œæé«˜æ€§èƒ½ã€‚</p></li><li><p>Row</p><p>5.1.5ç‰ˆæœ¬çš„MySQLæ‰å¼€å§‹æ”¯æŒrow level çš„å¤åˆ¶ï¼Œå®ƒä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œä»…ä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹ã€‚</p><p>ä¼˜ç‚¹ï¼šrow level çš„æ—¥å¿—å†…å®¹ä¼šéå¸¸æ¸…æ¥šçš„è®°å½•ä¸‹æ¯ä¸€è¡Œæ•°æ®ä¿®æ”¹çš„ç»†èŠ‚ã€‚è€Œä¸”ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹ çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæˆ–functionï¼Œä»¥åŠtriggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚</p></li><li><p>Mixed</p><p>ä»5.1.8ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLæä¾›äº†Mixedæ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯Statementä¸Rowçš„ç»“åˆã€‚</p><p>è¯¦ç»†æƒ…å†µï¼Œä¸‹ç« è®²è§£ã€‚</p></li></ul><h3 id="5-4-ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®">5.4 ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®</h3><p>å¦‚æœMySQLæœåŠ¡å™¨å¯ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåœ¨æ•°æ®åº“å‡ºç°æ„å¤–ä¸¢å¤±æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨MySQLbinlogå·¥å…·ä»æŒ‡å®šçš„æ—¶é—´ç‚¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœ€åä¸€æ¬¡å¤‡ä»½ï¼‰ç›´åˆ°ç°åœ¨æˆ–å¦ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´ç‚¹çš„æ—¥å¿—ä¸­å›å¤æ•°æ®ã€‚</p><p>mysqlbinlogæ¢å¤æ•°æ®çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [option] filename<span class="operator">|</span>mysql â€“uuser <span class="operator">-</span>ppass;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥è¿™æ ·ç†è§£ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤æ¥è¯»å–filenameä¸­çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨mysqlå‘½ä»¤å°†è¿™äº›å†…å®¹æ¢å¤åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>*<code>filename</code>ï¼šæ˜¯æ—¥å¿—æ–‡ä»¶åã€‚</p><p>*<code>option</code>ï¼šå¯é€‰é¡¹ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸¤å¯¹optionå‚æ•°æ˜¯â€“start-dateã€â€“stop-date å’Œ --start-positionã€-- stop-positionã€‚<br>*<code>--start-date</code>å’Œ<code>--stop-date</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®åº“çš„èµ·å§‹æ—¶é—´ç‚¹å’Œç»“æŸæ—¶é—´ç‚¹ã€‚<br>*<code>--start-position</code>å’Œ<code>--stop-position</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</p><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤è¿›è¡Œæ¢å¤æ“ä½œæ—¶ï¼Œå¿…é¡»æ˜¯ç¼–å·å°çš„å…ˆæ¢å¤ï¼Œä¾‹å¦‚atguigu-bin.000001å¿…é¡»åœ¨atguigu-bin.000002ä¹‹å‰æ¢å¤ã€‚</p></blockquote><p>è¯¦è§p189ï¼Œç”±äºç¿»é¡µè¿‡å¿«ï¼Œè¿™éƒ¨åˆ†æ²¡åŠæ³•è®°å½•ã€‚</p><h3 id="5-5-åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—">5.5 åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—</h3><p>MySQLçš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥é…ç½®è‡ªåŠ¨åˆ é™¤ï¼ŒåŒæ—¶MySQLä¹Ÿæä¾›äº†å®‰å…¨çš„æ‰‹åŠ¨åˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚<code>PURGE MASTER LOGS</code>åªåˆ é™¤æŒ‡å®šéƒ¨åˆ†çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œ<code>RESET MASTER</code>åˆ é™¤æ‰€æœ‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ ä»¶ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p><strong>1. PURGE MASTER LOGSï¼šåˆ é™¤æŒ‡å®šæ—¥å¿—æ–‡ä»¶</strong></p><p>PURGE MASTER LOGSè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PURGE &#123;MASTER <span class="operator">|</span> <span class="type">BINARY</span>&#125; LOGS <span class="keyword">TO</span> â€˜æŒ‡å®šæ—¥å¿—æ–‡ä»¶åâ€™</span><br><span class="line">PURGE &#123;MASTER <span class="operator">|</span> <span class="type">BINARY</span>&#125; LOGS BEFORE â€˜æŒ‡å®šæ—¥æœŸâ€™</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715165603879.png" alt="image-20220715165603879"  /><p>ä¸Šé¢æˆ‘ä»¬è®²äº†è¿™ä¹ˆå¤šéƒ½æ˜¯åŸºäºbinlogçš„é»˜è®¤æ ¼å¼ï¼Œbinlogæ ¼å¼æŸ¥çœ‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> binlog_format <span class="operator">|</span> <span class="type">ROW</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> è¡Œäºæ•°æ®é›† (<span class="number">0.02</span> ç§’)</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œbinlogè¿˜æœ‰2ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯<code>Statement</code>å’Œ<code>Mixed</code></p><ul><li><p>Statement</p><p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚</p><p>ä¼˜ç‚¹ï¼šä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†IOï¼Œæé«˜æ€§èƒ½ã€‚</p></li><li><p>Row</p><p>5.1.5ç‰ˆæœ¬çš„MySQLæ‰å¼€å§‹æ”¯æŒrow level çš„å¤åˆ¶ï¼Œå®ƒä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œä»…ä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹ã€‚</p><p>ä¼˜ç‚¹ï¼šrow level çš„æ—¥å¿—å†…å®¹ä¼šéå¸¸æ¸…æ¥šçš„è®°å½•ä¸‹æ¯ä¸€è¡Œæ•°æ®ä¿®æ”¹çš„ç»†èŠ‚ã€‚è€Œä¸”ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹ çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæˆ–functionï¼Œä»¥åŠtriggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚</p></li><li><p>Mixed</p><p>ä»5.1.8ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLæä¾›äº†Mixedæ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯Statementä¸Rowçš„ç»“åˆã€‚</p><p>è¯¦ç»†æƒ…å†µï¼Œä¸‹ç« è®²è§£ã€‚</p></li></ul><h3 id="5-4-ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®-2">5.4 ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®</h3><p>å¦‚æœMySQLæœåŠ¡å™¨å¯ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåœ¨æ•°æ®åº“å‡ºç°æ„å¤–ä¸¢å¤±æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨MySQLbinlogå·¥å…·ä»æŒ‡å®šçš„æ—¶é—´ç‚¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœ€åä¸€æ¬¡å¤‡ä»½ï¼‰ç›´åˆ°ç°åœ¨æˆ–å¦ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´ç‚¹çš„æ—¥å¿—ä¸­å›å¤æ•°æ®ã€‚</p><p>mysqlbinlogæ¢å¤æ•°æ®çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [option] filename<span class="operator">|</span>mysql â€“uuser <span class="operator">-</span>ppass;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥è¿™æ ·ç†è§£ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤æ¥è¯»å–filenameä¸­çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨mysqlå‘½ä»¤å°†è¿™äº›å†…å®¹æ¢å¤åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>*<code>filename</code>ï¼šæ˜¯æ—¥å¿—æ–‡ä»¶åã€‚</p><p>*<code>option</code>ï¼šå¯é€‰é¡¹ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸¤å¯¹optionå‚æ•°æ˜¯â€“start-dateã€â€“stop-date å’Œ --start-positionã€-- stop-positionã€‚<br>*<code>--start-date</code>å’Œ<code>--stop-date</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®åº“çš„èµ·å§‹æ—¶é—´ç‚¹å’Œç»“æŸæ—¶é—´ç‚¹ã€‚<br>*<code>--start-position</code>å’Œ<code>--stop-position</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</p><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤è¿›è¡Œæ¢å¤æ“ä½œæ—¶ï¼Œå¿…é¡»æ˜¯ç¼–å·å°çš„å…ˆæ¢å¤ï¼Œä¾‹å¦‚atguigu-bin.000001å¿…é¡»åœ¨atguigu-bin.000002ä¹‹å‰æ¢å¤ã€‚</p></blockquote><h3 id="5-5-åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—-2">5.5 åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—</h3><p>MySQLçš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥é…ç½®è‡ªåŠ¨åˆ é™¤ï¼ŒåŒæ—¶MySQLä¹Ÿæä¾›äº†å®‰å…¨çš„æ‰‹åŠ¨åˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚<code>PURGE MASTER LOGS</code>åªåˆ é™¤æŒ‡å®šéƒ¨åˆ†çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œ<code>RESET MASTER</code>åˆ é™¤æ‰€æœ‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ ä»¶ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p><strong>1. PURGE MASTER LOGSï¼šåˆ é™¤æŒ‡å®šæ—¥å¿—æ–‡ä»¶</strong></p><p>PURGE MASTER LOGSè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PURGE &#123;MASTER <span class="operator">|</span> <span class="type">BINARY</span>&#125; LOGS <span class="keyword">TO</span> â€˜æŒ‡å®šæ—¥å¿—æ–‡ä»¶åâ€™</span><br><span class="line">PURGE &#123;MASTER <span class="operator">|</span> <span class="type">BINARY</span>&#125; LOGS BEFORE â€˜æŒ‡å®šæ—¥æœŸâ€™</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715171712026.png" alt="image-20220715171712026"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715172015185.png" alt="image-20220715172015185"  /><p><strong>2. RESET MASTER: åˆ é™¤æ‰€æœ‰äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715172104967.png" alt="image-20220715172104967"  /><h3 id="5-6-å…¶å®ƒåœºæ™¯">5.6 å…¶å®ƒåœºæ™¯</h3><p>äºŒè¿›åˆ¶æ—¥å¿—å¯ä»¥é€šè¿‡æ•°æ®åº“çš„<code>å…¨é‡å¤‡ä»½</code>å’ŒäºŒè¿›åˆ¶æ—¥å¿—ä¸­ä¿å­˜çš„<code>å¢é‡ä¿¡æ¯</code>ï¼Œå®Œæˆæ•°æ®åº“çš„<code>æ— æŸå¤±æ¢å¤</code>ã€‚ ä½†æ˜¯ï¼Œå¦‚æœé‡åˆ°æ•°æ®é‡å¤§ã€æ•°æ®åº“å’Œæ•°æ®è¡¨å¾ˆå¤šï¼ˆæ¯”å¦‚åˆ†åº“åˆ†è¡¨çš„åº”ç”¨ï¼‰çš„åœºæ™¯ï¼Œç”¨äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡Œæ•°æ®æ¢å¤ï¼Œæ˜¯å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„ï¼Œå› ä¸ºèµ·æ­¢ä½ç½®ä¸å®¹æ˜“ç®¡ç†ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„è§£å†³åŠæ³•æ˜¯<code>é…ç½®ä¸»ä»æ•°æ®åº“æœåŠ¡å™¨</code>ï¼Œç”šè‡³æ˜¯<code>ä¸€ä¸»å¤šä»</code>çš„æ¶æ„ï¼ŒæŠŠäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„å†…å®¹é€šè¿‡ä¸­ç»§æ—¥å¿—ï¼ŒåŒæ­¥åˆ°ä»æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆé¿å…æ•°æ®åº“æ•…éšœå¯¼è‡´çš„æ•°æ®å¼‚å¸¸ç­‰é—®é¢˜ã€‚</p><hr><h2 id="6-å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—-binlog">6. å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—(binlog)</h2><h3 id="6-1-å†™å…¥æœºåˆ¶">6.1 å†™å…¥æœºåˆ¶</h3><p>binlogçš„å†™å…¥æ—¶æœºä¹Ÿéå¸¸ç®€å•ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°<code>binlog cache</code>ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠbinlog cacheå†™åˆ°binlogæ–‡ä»¶ä¸­ã€‚å› ä¸ºä¸€ä¸ªäº‹åŠ¡çš„binlogä¸èƒ½è¢«æ‹†å¼€ï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå—å†…å­˜ä½œä¸ºbinlog cacheã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>binlog_cache_size</code>å‚æ•°æ§åˆ¶å•ä¸ªçº¿ç¨‹ binlog cache å¤§å°ï¼Œå¦‚æœå­˜å‚¨å†…å®¹è¶…è¿‡äº†è¿™ä¸ªå‚æ•°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ï¼ˆSwapï¼‰ã€‚binlogæ—¥å¿—åˆ·ç›˜æµç¨‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715172958729.png" alt="image-20220715172958729" style="zoom: 50%;" /><blockquote><ul><li>ä¸Šå›¾çš„writeï¼Œæ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«</li><li>ä¸Šå›¾çš„fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œ</li></ul></blockquote><p>writeå’Œfsyncçš„æ—¶æœºï¼Œå¯ä»¥ç”±å‚æ•°<code>sync_binlog</code>æ§åˆ¶ï¼Œé»˜è®¤æ˜¯<code>0</code>ã€‚ä¸º0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª writeï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œfsyncã€‚è™½ç„¶æ€§èƒ½å¾—åˆ°æå‡ï¼Œä½†æ˜¯æœºå™¨å®•æœºï¼Œpage cacheé‡Œé¢çš„ binglog ä¼šä¸¢å¤±ã€‚å¦‚ä¸‹å›¾ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715193749462.png" alt="image-20220715193749462" style="zoom:50%;" /><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥è®¾ç½®ä¸º<code>1</code>ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œfsyncï¼Œå°±å¦‚åŒ<strong>redo log åˆ·ç›˜æµç¨‹</strong>ä¸€æ ·ã€‚ æœ€åè¿˜æœ‰ä¸€ç§æŠ˜ä¸­æ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ä¸ºN(N&gt;1)ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½writeï¼Œä½†ç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsyncã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715194624080.png" alt="image-20220715194624080" style="zoom:50%;" /><p>åœ¨å‡ºç°IOç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†sync_binlogè®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åŒæ ·çš„ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘Nä¸ªäº‹åŠ¡çš„binlogæ—¥å¿—ã€‚</p><h3 id="6-2-binlogä¸redologå¯¹æ¯”">6.2 binlogä¸redologå¯¹æ¯”</h3><ul><li>redo log å®ƒæ˜¯<code>ç‰©ç†æ—¥å¿—</code>ï¼Œè®°å½•å†…å®¹æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äº InnoDB å­˜å‚¨å¼•æ“å±‚äº§ç”Ÿçš„ã€‚</li><li>è€Œ binlog æ˜¯<code>é€»è¾‘æ—¥å¿—</code>ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œç±»ä¼¼äºâ€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1â€ï¼Œå±äº MySQL Server å±‚ã€‚</li><li>è™½ç„¶å®ƒä»¬éƒ½å±äºæŒä¹…åŒ–çš„ä¿è¯ï¼Œä½†æ˜¯ä¾§é‡ç‚¹ä¸åŒã€‚<ul><li>redo logè®©InnoDBå­˜å‚¨å¼•æ“æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</li><li>binlogä¿è¯äº†MySQLé›†ç¾¤æ¶æ„çš„æ•°æ®ä¸€è‡´æ€§ã€‚</li></ul></li></ul><h3 id="6-3-ä¸¤é˜¶æ®µæäº¤">6.3 ä¸¤é˜¶æ®µæäº¤</h3><p>åœ¨æ‰§è¡Œæ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½•redo logä¸binlogä¸¤å—æ—¥å¿—ï¼Œä»¥åŸºæœ¬çš„äº‹åŠ¡ä¸ºå•ä½ï¼Œredo logåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å†™å…¥ï¼Œè€Œbinlogåªæœ‰åœ¨æäº¤äº‹åŠ¡æ—¶æ‰å†™å…¥ï¼Œæ‰€ä»¥redo logä¸binlogçš„<code>å†™å…¥æ—¶æœº</code>ä¸ä¸€æ ·ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715194959405.png" alt="image-20220715194959405" style="zoom:67%;" /><p><strong>redo logä¸binlogä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€è‡´ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><p>ä»¥updateè¯­å¥ä¸ºä¾‹ï¼Œå‡è®¾<code>id=2</code>çš„è®°å½•ï¼Œå­—æ®µ<code>c</code>å€¼æ˜¯<code>0</code>ï¼ŒæŠŠå­—æ®µcå€¼æ›´æ–°ä¸º<code>1</code>ï¼ŒSQLè¯­å¥ä¸ºupdate T set c = 1 where id = 2ã€‚</p><p>å‡è®¾æ‰§è¡Œè¿‡ç¨‹ä¸­å†™å®Œredo logæ—¥å¿—åï¼Œbinlogæ—¥å¿—å†™æœŸé—´å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715195016492.png" alt="image-20220715195016492" style="zoom:67%;" /><p>ç”±äºbinlogæ²¡å†™å®Œå°±å¼‚å¸¸ï¼Œè¿™æ—¶å€™binlogé‡Œé¢æ²¡æœ‰å¯¹åº”çš„ä¿®æ”¹è®°å½•ã€‚å› æ­¤ï¼Œä¹‹åç”¨binlogæ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±ä¼šå°‘è¿™ä¸€æ¬¡æ›´æ–°ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œcå€¼ä¸º0ï¼Œè€ŒåŸåº“å› ä¸ºredo logæ—¥å¿—æ¢å¤ï¼Œè¿™ä¸€è¡Œcçš„å€¼æ˜¯1ï¼Œæœ€ç»ˆæ•°æ®ä¸ä¸€è‡´ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715195521986.png" alt="image-20220715195521986" style="zoom:67%;" /><p>ä¸ºäº†è§£å†³ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´é—®é¢˜ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>æ–¹æ¡ˆã€‚åŸç†å¾ˆç®€å•ï¼Œå°†redo logçš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤prepareå’Œcommitï¼Œè¿™å°±æ˜¯<strong>ä¸¤é˜¶æ®µæäº¤</strong>ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715195635196.png" alt="image-20220715195635196" style="zoom:67%;" /><p>ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åï¼Œå†™å…¥binlogæ—¶å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸ºMySQLæ ¹æ®redo logæ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå‘ç°redo logè¿˜å¤„äºprepareé˜¶æ®µï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åº”binlogæ—¥å¿—ï¼Œå°±ä¼šå›æ»šè¯¥äº‹åŠ¡ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715200248193.png" alt="image-20220715200248193" style="zoom:67%;" /><p>å¦ä¸€ä¸ªåœºæ™¯ï¼Œredo logè®¾ç½®commité˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¼šä¸ä¼šå›æ»šäº‹åŠ¡å‘¢ï¼Ÿ</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715200321717.png" alt="image-20220715200321717" style="zoom:67%;" /><p>å¹¶ä¸ä¼šå›æ»šäº‹åŠ¡ï¼Œå®ƒä¼šæ‰§è¡Œä¸Šå›¾æ¡†ä½çš„é€»è¾‘ï¼Œè™½ç„¶redo logæ˜¯å¤„äºprepareé˜¶æ®µï¼Œä½†æ˜¯èƒ½é€šè¿‡äº‹åŠ¡idæ‰¾åˆ°å¯¹åº”çš„binlogæ—¥å¿—ï¼Œæ‰€ä»¥MySQLè®¤ä¸ºæ˜¯å®Œæ•´çš„ï¼Œå°±ä¼šæäº¤äº‹åŠ¡æ¢å¤æ•°æ®ã€‚</p><hr><h2 id="7-ä¸­ç»§æ—¥å¿—-relay-log">7. ä¸­ç»§æ—¥å¿—(relay log)</h2><h3 id="7-1-ä»‹ç»">7.1 ä»‹ç»</h3><p><strong>ä¸­ç»§æ—¥å¿—åªåœ¨ä¸»ä»æœåŠ¡å™¨æ¶æ„çš„ä»æœåŠ¡å™¨ä¸Šå­˜åœ¨</strong>ã€‚ä»æœåŠ¡å™¨ä¸ºäº†ä¸ä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼Œè¦ä»ä¸»æœåŠ¡å™¨è¯»å–äºŒè¿›åˆ¶æ—¥å¿—çš„å†…å®¹ï¼Œå¹¶ä¸”æŠŠè¯»å–åˆ°çš„ä¿¡æ¯å†™å…¥<code>æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶</code>ä¸­ï¼Œè¿™ä¸ªä»æœåŠ¡å™¨æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶å°±å«<code>ä¸­ç»§æ—¥å¿—</code>ã€‚ç„¶åï¼Œä»æœåŠ¡å™¨è¯»å–ä¸­ç»§æ—¥å¿—ï¼Œå¹¶æ ¹æ®ä¸­ç»§æ—¥å¿—çš„å†…å®¹å¯¹ä»æœåŠ¡å™¨çš„æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œå®Œæˆä¸» ä»æœåŠ¡å™¨çš„ æ•°æ®åŒæ­¥ ã€‚</p><p>æ­å»ºå¥½ä¸»ä»æœåŠ¡å™¨ä¹‹åï¼Œä¸­ç»§æ—¥å¿—é»˜è®¤ä¼šä¿å­˜åœ¨ä»æœåŠ¡å™¨çš„æ•°æ®ç›®å½•ä¸‹ã€‚</p><p>æ–‡ä»¶åçš„æ ¼å¼æ˜¯ï¼š<code>ä»æœåŠ¡å™¨å-relay-bin.åºå·</code>ã€‚ä¸­ç»§æ—¥å¿—è¿˜æœ‰ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼š<code>ä»æœåŠ¡å™¨å-relaybin.index</code>ï¼Œç”¨æ¥å®šä½å½“å‰æ­£åœ¨ä½¿ç”¨çš„ä¸­ç»§æ—¥å¿—ã€‚</p><h3 id="7-2-æŸ¥çœ‹ä¸­ç»§æ—¥å¿—">7.2 æŸ¥çœ‹ä¸­ç»§æ—¥å¿—</h3><p>ä¸­ç»§æ—¥å¿—ä¸äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ç›¸åŒï¼Œå¯ä»¥ç”¨<code>mysqlbinlog</code>å·¥å…·è¿›è¡ŒæŸ¥çœ‹ã€‚ä¸‹é¢æ˜¯ä¸­ç»§æ—¥å¿—çš„ä¸€ä¸ªç‰‡æ®µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="type">TIMESTAMP</span><span class="operator">=</span><span class="number">1618558728</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">/*!*/</span>;</span><br><span class="line"># <span class="keyword">at</span> <span class="number">950</span></span><br><span class="line">#<span class="number">210416</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">48</span> server id <span class="number">1</span> end_log_pos <span class="number">832</span> CRC32 <span class="number">0xcc16d651</span> Table_map:</span><br><span class="line">`atguigu`.`test`mapped <span class="keyword">to</span> number <span class="number">91</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">1000</span></span><br><span class="line">#<span class="number">210416</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">48</span> server id <span class="number">1</span> end_log_pos <span class="number">872</span> CRC32 <span class="number">0x07e4047c</span> Delete_rows: <span class="keyword">table</span> id</span><br><span class="line"><span class="number">91</span> flags: STMT_END_F <span class="comment">-- server id 1 æ˜¯ä¸»æœåŠ¡å™¨ï¼Œæ„æ€æ˜¯ä¸»æœåŠ¡å™¨åˆ äº†ä¸€è¡Œæ•°æ®</span></span><br><span class="line">BINLOG <span class="string">&#x27;</span></span><br><span class="line"><span class="string">CD95YBMBAAAAMgAAAEADAAAAAFsAAAAAAAEABGRlbW8ABHRlc3QAAQMAAQEBAFHWFsw=</span></span><br><span class="line"><span class="string">CD95YCABAAAAKAAAAGgDAAAAAFsAAAAAAAEAAgAB/wABAAAAfATkBw==</span></span><br><span class="line"><span class="string">&#x27;</span><span class="comment">/*!*/</span>;</span><br><span class="line"># <span class="keyword">at</span> <span class="number">1040</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µçš„æ„æ€æ˜¯ï¼Œä¸»æœåŠ¡å™¨ï¼ˆâ€œserver id 1â€ï¼‰å¯¹è¡¨ atguigu.test è¿›è¡Œäº† 2 æ­¥æ“ä½œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å®šä½åˆ°è¡¨ atguigu.test ç¼–å·æ˜¯ <span class="number">91</span> çš„è®°å½•ï¼Œæ—¥å¿—ä½ç½®æ˜¯ <span class="number">832</span>ï¼›</span><br><span class="line">åˆ é™¤ç¼–å·æ˜¯ <span class="number">91</span> çš„è®°å½•ï¼Œæ—¥å¿—ä½ç½®æ˜¯ <span class="number">872</span></span><br></pre></td></tr></table></figure><h3 id="7-3-æ¢å¤çš„å…¸å‹é”™è¯¯">7.3 æ¢å¤çš„å…¸å‹é”™è¯¯</h3><p>å¦‚æœä»æœåŠ¡å™¨å®•æœºï¼Œæœ‰çš„æ—¶å€™ä¸ºäº†ç³»ç»Ÿæ¢å¤ï¼Œè¦é‡è£…æ“ä½œç³»ç»Ÿï¼Œè¿™æ ·å°±å¯èƒ½ä¼šå¯¼è‡´ä½ çš„<code>æœåŠ¡å™¨åç§°</code>ä¸ä¹‹å‰<code>ä¸åŒ</code>ã€‚è€Œä¸­ç»§æ—¥å¿—é‡Œæ˜¯<code>åŒ…å«ä»æœåŠ¡å™¨å</code>çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯èƒ½å¯¼è‡´ä½ æ¢å¤ä»æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæ— æ³• ä»å®•æœºå‰çš„ä¸­ç»§æ—¥å¿—é‡Œè¯»å–æ•°æ®ï¼Œä»¥ä¸ºæ˜¯æ—¥å¿—æ–‡ä»¶æŸåäº†ï¼Œå…¶å®æ˜¯åç§°ä¸å¯¹äº†ã€‚</p><p>è§£å†³çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠä»æœåŠ¡å™¨çš„åç§°æ”¹å›ä¹‹å‰çš„åç§°ã€‚</p>]]></content>
    
    
    <summary type="html">æ…¢æŸ¥è¯¢æ—¥å¿—ã€bin logã€é”™è¯¯æ—¥å¿—ã€é€šç”¨æŸ¥è¯¢æ—¥å¿—</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQLå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</title>
    <link href="https://wuwawawa.github.io/posts/1f4b46b6.html"/>
    <id>https://wuwawawa.github.io/posts/1f4b46b6.html</id>
    <published>2023-04-18T06:43:04.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<p>MVCC ï¼ˆMultiversion Concurrency Controlï¼‰ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚é¡¾åæ€ä¹‰ï¼ŒMVCC æ˜¯é€šè¿‡æ•°æ®è¡Œçš„å¤šä¸ªç‰ˆæœ¬ç®¡ç†æ¥å®ç°æ•°æ®åº“çš„<code>å¹¶å‘æ§åˆ¶</code>ã€‚è¿™é¡¹æŠ€æœ¯ä½¿å¾—åœ¨InnoDBçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œ<code>ä¸€è‡´æ€§è¯»</code>æ“ä½œæœ‰äº†ä¿è¯ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯ä¸ºäº†æŸ¥è¯¢ä¸€äº›æ­£åœ¨è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„è¡Œï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°å®ƒä»¬è¢«æ›´æ–°ä¹‹å‰çš„å€¼ï¼Œè¿™æ · åœ¨åšæŸ¥è¯¢çš„æ—¶å€™å°±ä¸ç”¨ç­‰å¾…å¦ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾é”ã€‚</p><p>MVCCæ²¡æœ‰æ­£å¼çš„æ ‡å‡†ï¼Œåœ¨ä¸åŒçš„DBMSä¸­MVCCçš„å®ç°æ–¹å¼å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œä¹Ÿä¸æ˜¯æ™®éä½¿ç”¨çš„ï¼ˆå¤§å®¶å¯ä»¥å‚è€ƒç›¸å…³çš„DBMSæ–‡æ¡£ï¼‰ã€‚è¿™é‡Œè®²è§£InnoDBä¸­MVCCçš„å®ç°æœºåˆ¶ï¼ˆMySQLå…¶ä»–çš„å­˜å‚¨å¼•æ“å¹¶ä¸æ”¯æŒå®ƒï¼‰</p><hr><h2 id="1-å¿«ç…§è¯»ä¸å½“å‰è¯»">1. å¿«ç…§è¯»ä¸å½“å‰è¯»</h2><p>MVCCåœ¨MySQL InnoDBä¸­çš„å®ç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½ï¼Œç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†<code>è¯»-å†™å†²çª</code>ï¼Œåšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶ï¼Œä¹Ÿèƒ½åšåˆ°<code>ä¸åŠ é”</code>ï¼Œ<code>éé˜»å¡å¹¶å‘è¯»</code>ï¼Œè€Œè¿™ä¸ªè¯»æŒ‡çš„å°±æ˜¯<code>å¿«ç…§è¯»</code>, è€Œé<code>å½“å‰è¯»</code>ã€‚å½“å‰ è¯»å®é™…ä¸Šæ˜¯ä¸€ç§åŠ é”çš„æ“ä½œï¼Œæ˜¯æ‚²è§‚é”çš„å®ç°ã€‚è€ŒMVCCæœ¬è´¨æ˜¯é‡‡ç”¨ä¹è§‚é”æ€æƒ³çš„ä¸€ç§æ–¹å¼ã€‚</p><div class="tabs" id="3c12d972-9050-44fe-9000-e79d518eb69e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#3c12d972-9050-44fe-9000-e79d518eb69e-1"><i class="fas fa-cat"></i>å¿«ç…§è¯»</button></li><li class="tab"><button type="button" data-href="#3c12d972-9050-44fe-9000-e79d518eb69e-2"><i class="fas fa-horse"></i>å½“å‰è¯»</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="3c12d972-9050-44fe-9000-e79d518eb69e-1"><p>å¿«ç…§è¯»åˆå«ä¸€è‡´æ€§è¯»ï¼Œè¯»å–çš„æ˜¯å¿«ç…§æ•°æ®ã€‚<span class='p green'>ä¸åŠ é”çš„ç®€å•çš„ SELECT éƒ½å±äºå¿«ç…§è¯»</span>ï¼Œå³ä¸åŠ é”çš„éé˜»å¡è¯»ï¼›æ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> player <span class="keyword">WHERE</span> ...</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥å‡ºç°å¿«ç…§è¯»çš„æƒ…å†µï¼Œæ˜¯åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œå¿«ç…§è¯»çš„å®ç°æ˜¯åŸºäºMVCCï¼Œå®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œ é¿å…äº†åŠ é”æ“ä½œï¼Œé™ä½äº†å¼€é”€ã€‚</p><p>æ—¢ç„¶æ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰çš„å†å²ç‰ˆæœ¬ã€‚</p><p>å¿«ç…§è¯»çš„å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«ï¼Œä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–æˆå½“å‰è¯»ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3c12d972-9050-44fe-9000-e79d518eb69e-2"><p>å½“å‰è¯»è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆæœ€æ–°æ•°æ®ï¼Œè€Œä¸æ˜¯å†å²ç‰ˆæœ¬çš„æ•°æ®ï¼‰ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚åŠ é”çš„ SELECTï¼Œæˆ–è€…å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹éƒ½ä¼šè¿›è¡Œå½“å‰è¯»ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student LOCK <span class="keyword">IN</span> SHARE MODE; # å…±äº«é”</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>; # æ’ä»–é”</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">values</span> ... # æ’ä»–é”</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> ... # æ’ä»–é”</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> ... # æ’ä»–é”</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="2-å†è°ˆéš”ç¦»çº§åˆ«">2. å†è°ˆéš”ç¦»çº§åˆ«</h2><p>æˆ‘ä»¬çŸ¥é“äº‹åŠ¡æœ‰ 4 ä¸ªéš”ç¦»çº§åˆ«ï¼Œå¯èƒ½å­˜åœ¨ä¸‰ç§å¹¶å‘é—®é¢˜ï¼š</p><p>åœ¨MySQLä¸­ï¼Œé»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼Œå¯ä»¥è§£å†³è„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå¦‚æœä»…ä»å®šä¹‰çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå¹¶ä¸èƒ½è§£å†³å¹»è¯»é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è§£å†³å¹»è¯»é—®é¢˜ï¼Œå°±éœ€è¦é‡‡ç”¨ä¸²è¡ŒåŒ–çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å°†éš”ç¦»çº§åˆ«æå‡åˆ°æœ€é«˜ï¼Œä½†è¿™æ ·ä¸€æ¥å°±ä¼šå¤§å¹…é™ä½æ•°æ®åº“çš„äº‹åŠ¡å¹¶å‘èƒ½åŠ›ã€‚</p><p>MVCCå¯ä»¥ä¸é‡‡ç”¨é”æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡ä¹è§‚é”çš„æ–¹å¼æ¥è§£å†³ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ï¼å®ƒå¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ›¿ä»£è¡Œçº§é”ï¼Œé™ä½ç³»ç»Ÿçš„å¼€é”€ã€‚</p><h2 id="3-éšè—å­—æ®µã€Undo-Logç‰ˆæœ¬é“¾">3. éšè—å­—æ®µã€Undo Logç‰ˆæœ¬é“¾</h2><p>å›é¡¾ä¸€ä¸‹undoæ—¥å¿—çš„ç‰ˆæœ¬é“¾ï¼Œå¯¹äºä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œå®ƒçš„èšç°‡ç´¢å¼•è®°å½•ä¸­éƒ½åŒ…å«ä¸¤ä¸ªå¿…è¦çš„éšè—åˆ—ã€‚</p><p>*<code>trx_id</code>ï¼šæ¯æ¬¡ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠè¯¥äº‹åŠ¡çš„<code>äº‹åŠ¡id</code>èµ‹å€¼ç»™<code>trx_id</code>éšè—åˆ—ã€‚<br>*<code>roll_pointer</code>ï¼šæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§çš„ç‰ˆæœ¬å†™å…¥åˆ°<code>undoæ—¥å¿—</code>ä¸­ï¼Œç„¶ åè¿™ä¸ªéšè—åˆ—å°±ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯ã€‚</p><p>ä¸¾ä¾‹ï¼šstudentè¡¨æ•°æ®å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name <span class="operator">|</span> class<span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span>   <span class="operator">|</span> å¼ ä¸‰  <span class="operator">|</span> ä¸€ç­ <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.07</span> sec)</span><br></pre></td></tr></table></figure><p>å‡è®¾æ’å…¥è¯¥è®°å½•çš„<code>äº‹åŠ¡id</code>ä¸º<code>8</code>ï¼Œé‚£ä¹ˆæ­¤åˆ»è¯¥æ¡è®°å½•çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714140801595.png" alt="image-20220714140801595"></p><blockquote><p>insert undoåªåœ¨äº‹åŠ¡å›æ»šæ—¶èµ·ä½œç”¨ï¼Œå½“äº‹åŠ¡æäº¤åï¼Œè¯¥ç±»å‹çš„undoæ—¥å¿—å°±æ²¡ç”¨äº†ï¼Œå®ƒå ç”¨çš„Undo Log Segmentä¹Ÿä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼ˆä¹Ÿå°±æ˜¯è¯¥undoæ—¥å¿—å ç”¨çš„Undoé¡µé¢é“¾è¡¨è¦ä¹ˆè¢«é‡ç”¨ï¼Œè¦ä¹ˆè¢«é‡Šæ”¾ï¼‰ã€‚</p></blockquote><p>å‡è®¾ä¹‹åä¸¤ä¸ªäº‹åŠ¡idåˆ†åˆ«ä¸º<code>10</code>ã€<code>20</code>çš„äº‹åŠ¡å¯¹è¿™æ¡è®°å½•è¿›è¡Œ<code>UPDATE</code>æ“ä½œï¼Œæ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714140846658.png" alt="image-20220714140846658"></p><p>æ¯æ¬¡å¯¹è®°å½•è¿›è¡Œæ”¹åŠ¨ï¼Œéƒ½ä¼šè®°å½•ä¸€æ¡undoæ—¥å¿—ï¼Œæ¯æ¡undoæ—¥å¿—ä¹Ÿéƒ½æœ‰ä¸€ä¸ª<code>roll_pointer</code>å±æ€§ ï¼ˆ<code>INSERT</code>æ“ä½œå¯¹åº”çš„undoæ—¥å¿—æ²¡æœ‰è¯¥å±æ€§ï¼Œå› ä¸ºè¯¥è®°å½•å¹¶æ²¡æœ‰æ›´æ—©çš„ç‰ˆæœ¬ï¼‰ï¼Œå¯ä»¥å°†è¿™äº›<code>undoæ—¥å¿—</code>éƒ½è¿èµ·æ¥ï¼Œä¸²æˆä¸€ä¸ªé“¾è¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714141012874.png" alt="image-20220714141012874"></p><p>å¯¹è¯¥è®°å½•æ¯æ¬¡æ›´æ–°åï¼Œéƒ½ä¼šå°†æ—§å€¼æ”¾åˆ°ä¸€æ¡<code>undoæ—¥å¿—</code>ä¸­ï¼Œå°±ç®—æ˜¯è¯¥è®°å½•çš„ä¸€ä¸ªæ—§ç‰ˆæœ¬ï¼Œéšç€æ›´æ–°æ¬¡æ•° çš„å¢å¤šï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬éƒ½ä¼šè¢«<code>roll_pointer</code>å±æ€§è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé“¾è¡¨ç§°ä¹‹ä¸º<code>ç‰ˆæœ¬é“¾</code>ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰è®°å½•æœ€æ–°çš„å€¼ã€‚</p><p>æ¯ä¸ªç‰ˆæœ¬ä¸­è¿˜åŒ…å«ç”Ÿæˆè¯¥ç‰ˆæœ¬æ—¶å¯¹åº”çš„<code>äº‹åŠ¡id</code>ã€‚</p><hr><h2 id="4-MVCCå®ç°åŸç†ä¹‹ReadView">4. MVCCå®ç°åŸç†ä¹‹ReadView</h2><p>MVCC çš„å®ç°ä¾èµ–äºï¼š<code>éšè—å­—æ®µ</code>ã€<code>Undo Log</code>ã€<code>Read View</code>ã€‚</p><h3 id="4-1-ä»€ä¹ˆæ˜¯ReadView">4.1 ä»€ä¹ˆæ˜¯ReadView</h3><p>åœ¨MVCCæœºåˆ¶ä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªè¡Œè®°å½•è¿›è¡Œæ›´æ–°ä¼šäº§ç”Ÿå¤šä¸ªå†å²å¿«ç…§ï¼Œè¿™äº›å†å²å¿«ç…§ä¿å­˜åœ¨ Undo Logé‡Œã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡æƒ³è¦æŸ¥è¯¢è¿™ä¸ªè¡Œè®°å½•ï¼Œéœ€è¦è¯»å–å“ªä¸ªç‰ˆæœ¬çš„è¡Œè®°å½•å‘¢ï¼Ÿè¿™æ—¶å°±éœ€è¦ç”¨åˆ° Readviewäº†ï¼Œå®ƒå¸®æˆ‘ä»¬è§£å†³äº†è¡Œçš„å¯è§æ€§é—®é¢˜ã€‚</p><p>Readviewå°±æ˜¯äº‹åŠ¡åœ¨ä½¿ç”¨MVCCæœºåˆ¶è¿›è¡Œå¿«ç…§è¯»æ“ä½œæ—¶äº§ç”Ÿçš„è¯»è§†å›¾ã€‚å½“äº‹åŠ¡å¯åŠ¨æ—¶ï¼Œä¼šç”Ÿæˆæ•°æ®åº“ç³»ç»Ÿå½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼ŒInnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥è®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰<code>æ´»è·ƒäº‹åŠ¡</code>çš„Dï¼ˆâ€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ï¼‰</p><h3 id="4-2-è®¾è®¡æ€è·¯">4.2 è®¾è®¡æ€è·¯</h3><p>ä½¿ç”¨<code>READ UNCOMMITTED</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œç”±äºå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬å°±å¥½äº†ã€‚</p><p>ä½¿ç”¨<code>SERIALIZABLE</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼ŒInnoDBè§„å®šä½¿ç”¨åŠ é”çš„æ–¹å¼æ¥è®¿é—®è®°å½•ã€‚</p><p>ä½¿ç”¨<code>READ COMMITTED</code>å’Œ<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œéƒ½å¿…é¡»ä¿è¯è¯»åˆ°<code>å·²ç»æäº¤äº†çš„</code>äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ã€‚å‡å¦‚å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»ä¿®æ”¹äº†è®°å½•ä½†æ˜¯å°šæœªæäº¤ï¼Œæ˜¯ä¸èƒ½ç›´æ¥è¯»å–æœ€æ–°ç‰ˆæœ¬çš„è®°å½•çš„ï¼Œæ ¸å¿ƒé—®é¢˜å°±æ˜¯éœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬é“¾ä¸­çš„å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰äº‹åŠ¡å¯è§çš„ï¼Œè¿™æ˜¯ReadViewè¦è§£å†³çš„ä¸»è¦é—®é¢˜ã€‚</p><p>è¿™ä¸ªReadViewä¸­ä¸»è¦åŒ…å«4ä¸ªæ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><p>1.<code>creator_trx_id</code>ï¼Œåˆ›å»ºè¿™ä¸ªRead Viewçš„äº‹åŠ¡IDã€‚</p><blockquote><p>è¯´æ˜ï¼šåªæœ‰åœ¨å¯¹è¡¨ä¸­çš„è®°å½•åšæ”¹åŠ¨æ—¶ï¼ˆæ‰§è¡ŒINSERTã€DELETEã€UPDATEè¿™äº›è¯­å¥æ—¶ï¼‰æ‰ä¼šä¸º äº‹åŠ¡åˆ†é…äº‹åŠ¡idï¼Œå¦åˆ™åœ¨ä¸€ä¸ªåªè¯»äº‹åŠ¡ä¸­çš„äº‹åŠ¡idå€¼éƒ½é»˜è®¤ä¸º0ã€‚</p></blockquote><p>2.<code>trx_ids</code>ï¼Œè¡¨ç¤ºåœ¨ç”ŸæˆReadViewæ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„è¯»å†™äº‹åŠ¡çš„<code>äº‹åŠ¡idåˆ—è¡¨</code>ã€‚</p><p>3.<code>up_limit_id</code>ï¼Œæ´»è·ƒçš„äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡ IDã€‚</p><p>4.<code>low_limit_id</code>ï¼Œè¡¨ç¤ºç”ŸæˆReadViewæ—¶ç³»ç»Ÿä¸­åº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ id å€¼ã€‚low_limit_id æ˜¯ç³» ç»Ÿæœ€å¤§çš„äº‹åŠ¡idå€¼ï¼Œè¿™é‡Œè¦æ³¨æ„æ˜¯ç³»ç»Ÿä¸­çš„äº‹åŠ¡idï¼Œéœ€è¦åŒºåˆ«äºæ­£åœ¨æ´»è·ƒçš„äº‹åŠ¡IDã€‚</p><blockquote><p>æ³¨æ„ï¼šlow_limit_idå¹¶ä¸æ˜¯trx_idsä¸­çš„æœ€å¤§å€¼ï¼Œäº‹åŠ¡idæ˜¯é€’å¢åˆ†é…çš„ã€‚æ¯”å¦‚ï¼Œç°åœ¨æœ‰idä¸º1ï¼Œ 2ï¼Œ3è¿™ä¸‰ä¸ªäº‹åŠ¡ï¼Œä¹‹åidä¸º3çš„äº‹åŠ¡æäº¤äº†ã€‚é‚£ä¹ˆä¸€ä¸ªæ–°çš„è¯»äº‹åŠ¡åœ¨ç”ŸæˆReadViewæ—¶ï¼Œ trx_idså°±åŒ…æ‹¬1å’Œ2ï¼Œup_limit_idçš„å€¼å°±æ˜¯1ï¼Œlow_limit_idçš„å€¼å°±æ˜¯4ã€‚</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714142254768.png" alt="image-20220714142254768"  /><hr><h3 id="4-3-ReadViewçš„è§„åˆ™">4.3 ReadViewçš„è§„åˆ™</h3><p>æœ‰äº†è¿™ä¸ªReadViewï¼Œè¿™æ ·åœ¨è®¿é—®æŸæ¡è®°å½•æ—¶ï¼Œåªéœ€è¦æŒ‰ç…§ä¸‹è¾¹çš„æ­¥éª¤åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§ã€‚</p><ul><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼ä¸ReadViewä¸­çš„ creator_trx_id å€¼ç›¸åŒï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®å®ƒè‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å°äºReadViewä¸­çš„ up_limit_id å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewå‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å¤§äºæˆ–ç­‰äºReadViewä¸­çš„ low_limit_id å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewåæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼åœ¨ReadViewçš„ up_limit_id å’Œ low_limit_id ä¹‹é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹trx_idå±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨ trx_ids åˆ—è¡¨ä¸­ã€‚<ul><li>å¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ã€‚</li><li>å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—®ã€‚</li></ul></li></ul><hr><h3 id="4-4-MVCCæ•´ä½“æ“ä½œæµç¨‹">4.4 MVCCæ•´ä½“æ“ä½œæµç¨‹</h3><p>äº†è§£äº†è¿™äº›æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å½“æŸ¥è¯¢ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œç³»ç»Ÿå¦‚ä½•é€šè¿‡MVCCæ‰¾åˆ°å®ƒï¼š</p><ol><li>é¦–å…ˆè·å–äº‹åŠ¡è‡ªå·±çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ IDï¼›</li><li>è·å– ReadViewï¼›</li><li>æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®ï¼Œç„¶åä¸ ReadView ä¸­çš„äº‹åŠ¡ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒï¼›</li><li>å¦‚æœä¸ç¬¦åˆ ReadView è§„åˆ™ï¼Œå°±éœ€è¦ä» Undo Log ä¸­è·å–å†å²å¿«ç…§ï¼›</li><li>æœ€åè¿”å›ç¬¦åˆè§„åˆ™çš„æ•°æ®ã€‚</li></ol><p>å¦‚æœæŸä¸ªç‰ˆæœ¬çš„æ•°æ®å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§çš„è¯ï¼Œé‚£å°±é¡ºç€ç‰ˆæœ¬é“¾æ‰¾åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œç»§ç»­æŒ‰ç…§ä¸Šè¾¹çš„æ­¥éª¤åˆ¤æ–­å¯è§æ€§ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç‰ˆæœ¬é“¾ä¸­çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚å¦‚æœæœ€åä¸€ä¸ªç‰ˆæœ¬ä¹Ÿä¸å¯è§çš„è¯ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€è¯¥æ¡è®°å½•å¯¹è¯¥äº‹åŠ¡å®Œå…¨ä¸å¯è§ï¼ŒæŸ¥è¯¢ç»“æœå°±ä¸åŒ…å«è¯¥è®°å½•ã€‚</p><blockquote><p>InnoDB ä¸­ï¼ŒMVCCæ˜¯é€šè¿‡ Undo Log + Read View è¿›è¡Œæ•°æ®è¯»å–ï¼ŒUndo Log ä¿å­˜äº†å†å²å¿«ç…§ï¼Œè€Œ Read View è§„åˆ™å¸®æˆ‘ä»¬åˆ¤æ–­å½“å‰ç‰ˆæœ¬çš„æ•°æ®æ˜¯å¦å¯è§ã€‚</p></blockquote><p>åœ¨éš”ç¦»çº§åˆ«ä¸ºè¯»å·²æäº¤ï¼ˆRead Committedï¼‰æ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ¯ä¸€æ¬¡ SELECT æŸ¥è¯¢éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡ Read Viewã€‚</p><p>å¦‚è¡¨æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715130843147.png" alt="image-20220715130843147" style="zoom:67%;" /><blockquote><p>æ³¨æ„ï¼Œæ­¤æ—¶åŒæ ·çš„æŸ¥è¯¢è¯­å¥éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡ Read Viewï¼Œè¿™æ—¶å¦‚æœ Read View ä¸åŒï¼Œå°±å¯èƒ½äº§ç”Ÿä¸å¯é‡å¤è¯»æˆ–è€…å¹»è¯»çš„æƒ…å†µã€‚</p></blockquote><p>å½“éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»çš„æ—¶å€™ï¼Œå°±é¿å…äº†ä¸å¯é‡å¤è¯»ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªäº‹åŠ¡åªåœ¨ç¬¬ä¸€æ¬¡ SELECT çš„æ—¶å€™ä¼šè·å–ä¸€æ¬¡ Read Viewï¼Œè€Œåé¢æ‰€æœ‰çš„ SELECT éƒ½ä¼šå¤ç”¨è¿™ä¸ª Read Viewï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715130916437.png" alt="image-20220715130916437" style="zoom:67%;" /><hr><h2 id="5-ä¸¾ä¾‹è¯´æ˜">5. ä¸¾ä¾‹è¯´æ˜</h2><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715131200077.png" alt="image-20220715131200077"  /><h3 id="5-1-READ-COMMITTEDçº§åˆ«">5.1 READ COMMITTEDçº§åˆ«</h3><p><strong>READ COMMITTED ï¼šæ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ªReadViewã€‚</strong></p><p>ç°åœ¨æœ‰ä¸¤ä¸ª<code>äº‹åŠ¡id</code>åˆ†åˆ«ä¸º<code>10</code>ã€<code>20</code>çš„äº‹åŠ¡åœ¨æ‰§è¡Œ:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">10</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;æå››&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;ç‹äº”&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># Transaction <span class="number">20</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line">...</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡çœŸæ­£ä¿®æ”¹è®°å½•æ—¶ï¼ˆæ¯”å¦‚ä½¿ç”¨INSERTã€DELETEã€UPDATEè¯­å¥ï¼‰ï¼Œæ‰ä¼šè¢«åˆ†é…ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡idï¼Œè¿™ä¸ªäº‹åŠ¡idæ˜¯é€’å¢çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ‰åœ¨äº‹åŠ¡2ä¸­æ›´æ–°ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•ï¼Œç›®çš„æ˜¯è®©å®ƒåˆ†é…äº‹åŠ¡idã€‚</p></blockquote><p>æ­¤åˆ»ï¼Œè¡¨student ä¸­ id ä¸º 1 çš„è®°å½•å¾—åˆ°çš„ç‰ˆæœ¬é“¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715133640655.png" alt="image-20220715133640655"></p><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½¿ç”¨<code>READ COMMITTED</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"># SELECT1ï¼šTransaction <span class="number">10</span>ã€<span class="number">20</span>æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715134540737.png" alt="image-20220715134540737"  /><p>ä¹‹åï¼Œæˆ‘ä»¬æŠŠ<code>äº‹åŠ¡id</code>ä¸º<code>10</code>çš„äº‹åŠ¡æäº¤ä¸€ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">10</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;æå››&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;ç‹äº”&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åå†åˆ°<code>äº‹åŠ¡id</code>ä¸º<code>20</code>çš„äº‹åŠ¡ä¸­æ›´æ–°ä¸€ä¸‹è¡¨<code>student</code>ä¸­<code>id</code>ä¸º<code>1</code>çš„è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">20</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line">...</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;é’±ä¸ƒ&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;å®‹å…«&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>æ­¤åˆ»ï¼Œè¡¨studentä¸­<code>id</code>ä¸º<code>1</code>çš„è®°å½•çš„ç‰ˆæœ¬é“¾å°±é•¿è¿™æ ·ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715134839081.png" alt="image-20220715134839081"></p><p>ç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨<code>READ COMMITTED</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ª id ä¸º 1 çš„è®°å½•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"># SELECT1ï¼šTransaction <span class="number">10</span>ã€<span class="number">20</span>å‡æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line"></span><br><span class="line"># SELECT2ï¼šTransaction <span class="number">10</span>æäº¤ï¼ŒTransaction <span class="number">20</span>æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;ç‹äº”&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715135017000.png" alt="image-20220715135017000"  /><blockquote><p>å¼ºè°ƒï¼šä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ¯æ¬¡æŸ¥è¯¢å¼€å§‹æ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ReadViewã€‚</p></blockquote><hr><h3 id="5-2-REPEATABLE-READçº§åˆ«">5.2 REPEATABLE READçº§åˆ«</h3><p>ä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œåªä¼šåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ª<code>ReadView</code>ï¼Œä¹‹åçš„æŸ¥è¯¢å°±ä¸ä¼šé‡å¤ç”Ÿæˆäº†ã€‚</p><p>æ¯”å¦‚ï¼Œç³»ç»Ÿé‡Œæœ‰ä¸¤ä¸ª<code>äº‹åŠ¡id</code>åˆ†åˆ«ä¸º<code>10</code>ã€<code>20</code>çš„äº‹åŠ¡åœ¨æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">10</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;æå››&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;ç‹äº”&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># Transaction <span class="number">20</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ­¤åˆ»ï¼Œè¡¨student ä¸­ id ä¸º 1 çš„è®°å½•å¾—åˆ°çš„ç‰ˆæœ¬é“¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140006061.png" alt="image-20220715140006061"></p><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"># SELECT1ï¼šTransaction <span class="number">10</span>ã€<span class="number">20</span>æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140155744.png" alt="image-20220715140155744"  /><p>ä¹‹åï¼Œæˆ‘ä»¬æŠŠ<code>äº‹åŠ¡id</code>ä¸º<code>10</code>çš„äº‹åŠ¡æäº¤ä¸€ä¸‹ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">10</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;æå››&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;ç‹äº”&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åå†åˆ°<code>äº‹åŠ¡id</code>ä¸º<code>20</code>çš„äº‹åŠ¡ä¸­æ›´æ–°ä¸€ä¸‹è¡¨<code>student</code>ä¸­<code>id</code>ä¸º<code>1</code>çš„è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">20</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line">...</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;é’±ä¸ƒ&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;å®‹å…«&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>æ­¤åˆ»ï¼Œè¡¨student ä¸­<code>id</code>ä¸º<code>1</code>çš„è®°å½•çš„ç‰ˆæœ¬é“¾é•¿è¿™æ ·ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140354217.png" alt="image-20220715140354217"></p><p>ç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ª<code>id</code>ä¸º<code>1</code>çš„è®°å½•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># SELECT1ï¼šTransaction <span class="number">10</span>ã€<span class="number">20</span>å‡æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line"># SELECT2ï¼šTransaction <span class="number">10</span>æäº¤ï¼ŒTransaction <span class="number">20</span>æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä»ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140555172.png" alt="image-20220715140555172"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140620328.png" alt="image-20220715140620328"  /><p>è¿™æ¬¡<code>SELECT</code>æŸ¥è¯¢å¾—åˆ°çš„ç»“æœæ˜¯é‡å¤çš„ï¼Œè®°å½•çš„åˆ—<code>c</code>å€¼éƒ½æ˜¯<code>å¼ ä¸‰</code>ï¼Œè¿™å°±æ˜¯<code>å¯é‡å¤è¯»</code>çš„å«ä¹‰ã€‚å¦‚æœæˆ‘ä»¬ä¹‹åå†æŠŠ<code>äº‹åŠ¡id</code>ä¸º<code>20</code>çš„è®°å½•æäº¤äº†ï¼Œç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ª<code>id</code>ä¸º<code>1</code>çš„è®°å½•ï¼Œå¾—åˆ°çš„ç»“æœè¿˜æ˜¯<code>å¼ ä¸‰</code>ï¼Œå…·ä½“æ‰§è¡Œè¿‡ç¨‹å¤§å®¶å¯ä»¥è‡ªå·±åˆ†æä¸€ä¸‹ã€‚</p><hr><h3 id="5-3-å¦‚ä½•è§£å†³å¹»è¯»">5.3 å¦‚ä½•è§£å†³å¹»è¯»</h3><p>æ¥ä¸‹æ¥è¯´æ˜InnoDB æ˜¯å¦‚ä½•è§£å†³å¹»è¯»çš„ã€‚</p><p>å‡è®¾ç°åœ¨è¡¨ student ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œæ•°æ®å†…å®¹ä¸­ï¼Œä¸»é”® id=1ï¼Œéšè—çš„ trx_id=10ï¼Œå®ƒçš„ undo log å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715141002035.png" alt="image-20220715141002035" style="zoom:80%;" /><p>å‡è®¾ç°åœ¨æœ‰äº‹åŠ¡ A å’Œäº‹åŠ¡ B å¹¶å‘æ‰§è¡Œï¼Œ<code>äº‹åŠ¡ A</code>çš„äº‹åŠ¡ id ä¸º<code>20</code>ï¼Œ<code>äº‹åŠ¡ B</code>çš„äº‹åŠ¡ id ä¸º<code>30</code>ã€‚</p><p>æ­¥éª¤1ï¼šäº‹åŠ¡ A å¼€å§‹ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ•°æ®ï¼ŒæŸ¥è¯¢çš„ SQL è¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&gt;=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>åœ¨å¼€å§‹æŸ¥è¯¢ä¹‹å‰ï¼ŒMySQL ä¼šä¸ºäº‹åŠ¡ A äº§ç”Ÿä¸€ä¸ª ReadViewï¼Œæ­¤æ—¶ ReadView çš„å†…å®¹å¦‚ä¸‹ï¼š<code>trx_ids= [20,30] ï¼Œ up_limit_id=20 ï¼Œ low_limit_id=31 ï¼Œ creator_trx_id=20</code>ã€‚</p><p>ç”±äºæ­¤æ—¶è¡¨ student ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œä¸”ç¬¦åˆ where id&gt;=1 æ¡ä»¶ï¼Œå› æ­¤ä¼šæŸ¥è¯¢å‡ºæ¥ã€‚ç„¶åæ ¹æ® ReadView æœºåˆ¶ï¼Œå‘ç°è¯¥è¡Œæ•°æ®çš„trx_id=10ï¼Œå°äºäº‹åŠ¡ A çš„ ReadView é‡Œ up_limit_idï¼Œè¿™è¡¨ç¤ºè¿™æ¡æ•°æ®æ˜¯äº‹åŠ¡ A å¼€å¯ä¹‹å‰ï¼Œå…¶ä»–äº‹åŠ¡å°±å·²ç»æäº¤äº†çš„æ•°æ®ï¼Œå› æ­¤äº‹åŠ¡ A å¯ä»¥è¯»å–åˆ°ã€‚</p><p>ç»“è®ºï¼šäº‹åŠ¡ A çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œèƒ½è¯»å–åˆ°ä¸€æ¡æ•°æ®ï¼Œid=1ã€‚</p><p>æ­¥éª¤2ï¼šæ¥ç€äº‹åŠ¡ B(trx_id=30)ï¼Œå¾€è¡¨ student ä¸­æ–°æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œå¹¶æäº¤äº‹åŠ¡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student(id,name) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;æå››&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student(id,name) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;ç‹äº”&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è¡¨student ä¸­å°±æœ‰ä¸‰æ¡æ•°æ®äº†ï¼Œå¯¹åº”çš„ undo å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715141208667.png" alt="image-20220715141208667"></p><p>æ­¥éª¤3ï¼šæ¥ç€äº‹åŠ¡ A å¼€å¯ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œæ ¹æ®å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„è§„åˆ™ï¼Œæ­¤æ—¶äº‹åŠ¡ A å¹¶ä¸ä¼šå†é‡æ–°ç”Ÿæˆ ReadViewã€‚æ­¤æ—¶è¡¨ student ä¸­çš„ 3 æ¡æ•°æ®éƒ½æ»¡è¶³ where id&gt;=1 çš„æ¡ä»¶ï¼Œå› æ­¤ä¼šå…ˆæŸ¥å‡ºæ¥ã€‚ç„¶åæ ¹æ® ReadView æœºåˆ¶ï¼Œåˆ¤æ–­æ¯æ¡æ•°æ®æ˜¯ä¸æ˜¯éƒ½å¯ä»¥è¢«äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>1ï¼‰é¦–å…ˆ id=1 çš„è¿™æ¡æ•°æ®ï¼Œå‰é¢å·²ç»è¯´è¿‡äº†ï¼Œå¯ä»¥è¢«äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>2ï¼‰ç„¶åæ˜¯ id=2 çš„æ•°æ®ï¼Œå®ƒçš„ trx_id=30ï¼Œæ­¤æ—¶äº‹åŠ¡ A å‘ç°ï¼Œè¿™ä¸ªå€¼å¤„äº up_limit_id å’Œ low_limit_id ä¹‹ é—´ï¼Œå› æ­¤è¿˜éœ€è¦å†åˆ¤æ–­ 30 æ˜¯å¦å¤„äº trx_ids æ•°ç»„å†…ã€‚ç”±äºäº‹åŠ¡ A çš„ trx_ids=[20,30]ï¼Œå› æ­¤åœ¨æ•°ç»„å†…ï¼Œè¿™è¡¨ ç¤º id=2 çš„è¿™æ¡æ•°æ®æ˜¯ä¸äº‹åŠ¡ A åœ¨åŒä¸€æ—¶åˆ»å¯åŠ¨çš„å…¶ä»–äº‹åŠ¡æäº¤çš„ï¼Œæ‰€ä»¥è¿™æ¡æ•°æ®ä¸èƒ½è®©äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>3ï¼‰åŒç†ï¼Œid=3 çš„è¿™æ¡æ•°æ®ï¼Œtrx_id ä¹Ÿä¸º 30ï¼Œå› æ­¤ä¹Ÿä¸èƒ½è¢«äº‹åŠ¡ A çœ‹è§ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715141243993.png" alt="image-20220715141243993"></p><p>ç»“è®ºï¼šæœ€ç»ˆäº‹åŠ¡ A çš„ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œåªèƒ½æŸ¥è¯¢å‡º id=1 çš„è¿™æ¡æ•°æ®ã€‚è¿™å’Œäº‹åŠ¡ A çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€æ · çš„ï¼Œå› æ­¤æ²¡æœ‰å‡ºç°å¹»è¯»ç°è±¡ï¼Œæ‰€ä»¥è¯´åœ¨ MySQL çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸å­˜åœ¨å¹»è¯»é—®é¢˜ã€‚</p><h2 id="6-æ€»ç»“">6. æ€»ç»“</h2><p>è¿™é‡Œä»‹ç»äº† MVCC åœ¨<code>READ COMMITTD</code>ã€<code>REPEATABLE READ</code>è¿™ä¸¤ç§éš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ‰§è¡Œå¿«ç…§è¯»æ“ä½œæ—¶ è®¿é—®è®°å½•çš„ç‰ˆæœ¬é“¾çš„è¿‡ç¨‹ã€‚è¿™æ ·ä½¿ä¸åŒäº‹åŠ¡çš„<code>è¯»-å†™</code>ã€<code>å†™-è¯»</code>æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><p>æ ¸å¿ƒç‚¹åœ¨äº ReadView çš„åŸç†ï¼Œ<code>READ COMMITTD</code>ã€<code>REPEATABLE READ</code>è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«çš„ä¸€ä¸ªå¾ˆå¤§ä¸åŒ å°±æ˜¯ç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼š</p><p>*<code>READ COMMITTD</code>åœ¨æ¯ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadView<br>*<code>REPEATABLE READ</code>åªåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„æŸ¥è¯¢æ“ä½œéƒ½é‡å¤ ä½¿ç”¨è¿™ä¸ªReadViewå°±å¥½äº†ã€‚</p><blockquote><p>è¯´æ˜ï¼šæˆ‘ä»¬ä¹‹å‰è¯´æ‰§è¡ŒDELETEè¯­å¥æˆ–è€…æ›´æ–°ä¸»é”®çš„UPDATEè¯­å¥å¹¶ä¸ä¼šç«‹å³æŠŠå¯¹åº”çš„è®°å½•å®Œå…¨ä»é¡µé¢ä¸­åˆ é™¤ï¼Œ è€Œæ˜¯æ‰§è¡Œä¸€ä¸ªæ‰€è°“çš„deletemarkæ“ä½œï¼Œç›¸å½“äºåªæ˜¯å¯¹è®°å½•æ‰“ä¸Šäº†ä¸€ä¸ªåˆ é™¤æ ‡å¿—ä½ï¼Œè¿™ä¸»è¦å°±æ˜¯ä¸ºMVCCæœåŠ¡çš„ã€‚</p></blockquote><p>é€šè¿‡MVCCæˆ‘ä»¬å¯ä»¥è§£å†³ï¼š</p><ol><li><p>è¯»å†™ä¹‹é—´é˜»å¯¨çš„é—®é¢˜ã€‚é€šè¿‡MVCCå¯ä»¥è®©è¯»å†™äº’ç›¸ä¸é˜³å¡ï¼Œå³è¯»ä¸é˜»å¡å†™ï¼Œå†™ä¸é˜»å¡è¯»ï¼Œè¿™æ ·å°±å¯ä»¥æå‡äº‹åŠ¡å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p></li><li><p>é™ä½äº†æ­»é”çš„æ¦‚ç‡ã€‚è¿™æ˜¯å› ä¸ºMVCCé‡‡ç”¨äº†ä¹è§‚é”çš„æ–¹å¼ï¼Œè¯»å–æ•°æ®æ—¶å¹¶ä¸éœ€è¦åŠ é”ï¼Œå¯¹äºå†™æ“ä½œï¼Œä¹Ÿåªé”å®šå¿…è¦çš„è¡Œã€‚</p></li><li><p>è§£å†³å¿«ç…§è¯»çš„é—®é¢˜ã€‚å½“æˆ‘ä»¬æŸ¥è¯¢æ•°æ®åº“åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ—¶ï¼Œåªèƒ½çœ‹åˆ°è¿™ä¸ªæ—¶é—´ç‚¹ä¹‹å‰äº‹åŠ¡æäº¤æ›´æ–°çš„ç»“æœï¼Œè€Œä¸èƒ½çœ‹åˆ°è¿™ä¸ªæ—¶é—´ç‚¹ä¹‹åäº‹åŠ¡æäº¤çš„æ›´æ–°ç»“æœã€‚</p></li></ol>]]></content>
    
    
    <summary type="html">ä»€ä¹ˆæ˜¯MVCCã€MVCCå®ç°åŸç†ä¹‹ReadView</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQLé”</title>
    <link href="https://wuwawawa.github.io/posts/d940f18d.html"/>
    <id>https://wuwawawa.github.io/posts/d940f18d.html</id>
    <published>2023-04-17T09:39:07.000Z</published>
    <updated>2023-04-18T06:31:27.167Z</updated>
    
    <content type="html"><![CDATA[<p><code>é”</code>æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹<code>å¹¶å‘è®¿é—®æŸä¸€èµ„æº</code>çš„æœºåˆ¶ã€‚åœ¨ç¨‹åºå¼€å‘ä¸­ä¼šå­˜åœ¨å¤šçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ä¸€äº›æ•æ„Ÿçš„æ•°æ®ï¼ˆæ¯”å¦‚è®¢å•ã€é‡‘é¢ç­‰ï¼‰ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¿è¯è¿™ä¸ªæ•°æ®åœ¨ä»»ä½•æ—¶åˆ»<code>æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹</code>åœ¨è®¿é—®ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­åŠ é”æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¿™ä¸ªæ€æƒ³åœ¨æ•°æ®åº“é¢†åŸŸä¸­åŒæ ·å¾ˆé‡è¦ã€‚</p><p>åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€RAMã€I/Oç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„ èµ„æºã€‚ä¸ºä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦å¯¹<code>å¹¶å‘æ“ä½œè¿›è¡Œæ§åˆ¶</code>ï¼Œå› æ­¤äº§ç”Ÿäº†<code>é”</code>ã€‚åŒæ—¶<code>é”æœºåˆ¶</code>ä¹Ÿä¸ºå®ç°MySQL çš„å„ä¸ªéš”ç¦»çº§åˆ«æä¾›äº†ä¿è¯ã€‚<code>é”å†²çª</code>ä¹Ÿæ˜¯å½±å“æ•°æ®åº“<code>å¹¶å‘è®¿é—®æ€§èƒ½</code>çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚æ‰€ä»¥é”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p><hr><h2 id="1-MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•">1. MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•</h2><p>å¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•çš„æƒ…å†µå¤§è‡´å¯ä»¥åˆ’åˆ†ä¸º3ç§ï¼š</p><h3 id="1-1-è¯»-è¯»æƒ…å†µ">1.1 è¯»-è¯»æƒ…å†µ</h3><p><code>è¯»-è¯»</code>æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§<code>è¯»å–ç›¸åŒçš„è®°å½•</code>ã€‚è¯»å–æ“ä½œæœ¬èº«ä¸ä¼šå¯¹è®°å½•æœ‰ä»»ä½•å½±å“ï¼Œå¹¶ä¸ä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥å…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚</p><h3 id="1-2-å†™-å†™æƒ…å†µ">1.2 å†™-å†™æƒ…å†µ</h3><p><code>å†™-å†™</code>æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§å¯¹ç›¸åŒçš„è®°å½•åšå‡ºæ”¹åŠ¨ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿ<code>è„å†™</code>çš„é—®é¢˜ï¼Œä»»ä½•ä¸€ç§éš”ç¦»çº§åˆ«éƒ½ä¸å…è®¸è¿™ç§é—®é¢˜çš„å‘ç”Ÿã€‚æ‰€ä»¥åœ¨å¤šä¸ªæœªæäº¤äº‹åŠ¡ç›¸ç»§å¯¹ä¸€æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œéœ€è¦è®©å®ƒä»¬<code>æ’é˜Ÿæ‰§è¡Œ</code>ï¼Œè¿™ä¸ªæ’é˜Ÿçš„è¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡<code>é”</code>æ¥å®ç°çš„ã€‚è¿™ä¸ªæ‰€è°“çš„é”å…¶å®æ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„ç»“æ„ ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œå‰æœ¬æ¥æ˜¯æ²¡æœ‰é”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹æ˜¯æ²¡æœ‰<code>é”ç»“æ„</code>å’Œ<code>è®°å½•</code>è¿›è¡Œå…³è”çš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711181120639.png" alt="image-20220711181120639"></p><p>å½“ä¸€ä¸ªäº‹åŠ¡æƒ³å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šçœ‹çœ‹å†…å­˜ä¸­æœ‰æ²¡æœ‰ä¸è¿™æ¡è®°å½•å…³è”çš„<code>é”ç»“æ„</code>ï¼Œå½“æ²¡æœ‰çš„æ—¶å€™ å°±ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ª<code>é”ç»“æ„</code>ä¸ä¹‹å…³è”ã€‚æ¯”å¦‚ï¼Œäº‹åŠ¡<code>T1</code>è¦å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨ï¼Œå°±éœ€è¦ç”Ÿæˆä¸€ä¸ª<code>é”ç»“æ„</code>ä¸ä¹‹å…³è”ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711192633239.png" alt="image-20220711192633239" style="zoom:67%;" /><p>åœ¨<code>é”ç»“æ„</code>é‡Œæœ‰å¾ˆå¤šä¿¡æ¯ï¼Œä¸ºäº†ç®€åŒ–ç†è§£ï¼ŒåªæŠŠä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„å±æ€§æ‹¿äº†å‡ºæ¥ï¼š</p><p>*<code>trxä¿¡æ¯</code>ï¼šä»£è¡¨è¿™ä¸ªé”ç»“æ„æ˜¯å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ã€‚<br>*<code>is_waiting</code>ï¼šä»£è¡¨å½“å‰äº‹åŠ¡æ˜¯å¦åœ¨ç­‰å¾…ã€‚</p><p>åœ¨äº‹åŠ¡<code>T1</code>æ”¹åŠ¨äº†è¿™æ¡è®°å½•åï¼Œå°±ç”Ÿæˆäº†ä¸€ä¸ª<code>é”ç»“æ„</code>ä¸è¯¥è®°å½•å…³è”ï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡ä¸ºè¿™æ¡è®°å½•åŠ é”ï¼Œæ‰€ä»¥<code>is_waiting</code>å±æ€§å°±æ˜¯<code>false</code>ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å°±ç§°å€¼ä¸º<code>è·å–é”æˆåŠŸ</code>ï¼Œæˆ–è€…<code>åŠ é”æˆåŠŸ</code>ï¼Œç„¶åå°±å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œäº†ã€‚</p><p>åœ¨äº‹åŠ¡<code>T1</code>æäº¤ä¹‹å‰ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡<code>T2</code>ä¹Ÿæƒ³å¯¹è¯¥è®°å½•åšæ”¹åŠ¨ï¼Œé‚£ä¹ˆå…ˆçœ‹çœ‹æœ‰æ²¡æœ‰<code>é”ç»“æ„</code>ä¸è¿™æ¡è®°å½•å…³è”ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>é”ç»“æ„</code>ä¸ä¹‹å…³è”åï¼Œç„¶åä¹Ÿç”Ÿæˆäº†ä¸€ä¸ªé”ç»“æ„ä¸è¿™æ¡è®°å½•å…³è”ï¼Œä¸è¿‡é”ç»“æ„çš„<code>is_waiting</code>å±æ€§å€¼ä¸º<code>true</code>ï¼Œè¡¨ç¤ºå½“å‰äº‹åŠ¡éœ€è¦ç­‰å¾…ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å°±ç§°ä¹‹ä¸º<code>è·å–é”å¤±è´¥</code>ï¼Œæˆ–è€…<code>åŠ é”å¤±è´¥</code>ï¼Œå›¾ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711193732567.png" alt="image-20220711193732567" style="zoom:50%;" /><p>åœ¨äº‹åŠ¡T1æäº¤ä¹‹åï¼Œå°±ä¼šæŠŠè¯¥äº‹åŠ¡ç”Ÿæˆçš„<code>é”ç»“æ„é‡Šæ”¾</code>æ‰ï¼Œç„¶åçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡åœ¨ç­‰å¾…è·å–é”ï¼Œå‘ç°äº†äº‹åŠ¡T2è¿˜åœ¨ç­‰å¾…è·å–é”ï¼Œæ‰€ä»¥æŠŠäº‹åŠ¡T2å¯¹åº”çš„é”ç»“æ„çš„<code>is_waiting</code>å±æ€§è®¾ç½®ä¸º<code>false</code>ï¼Œç„¶åæŠŠè¯¥äº‹åŠ¡å¯¹åº”çš„çº¿ç¨‹å”¤é†’ï¼Œè®©å®ƒç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶äº‹åŠ¡T2å°±ç®—è·å–åˆ°é”äº†ã€‚æ•ˆæœå°±æ˜¯è¿™æ ·ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711194904328.png" alt="image-20220711194904328" style="zoom:50%;" /><p>å°ç»“å‡ ç§è¯´æ³•ï¼š</p><ul><li><p>ä¸åŠ é”</p><p>æ„æ€å°±æ˜¯ä¸éœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆå¯¹åº”çš„<code>é”ç»“æ„</code>ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œæ“ä½œã€‚</p></li><li><p>è·å–é”æˆåŠŸï¼Œæˆ–è€…åŠ é”æˆåŠŸ</p><p>æ„æ€å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†å¯¹åº”çš„<code>é”ç»“æ„</code>ï¼Œè€Œä¸”é”ç»“æ„çš„<code>is_waiting</code>å±æ€§ä¸º<code>false</code>ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚</p></li><li><p>è·å–é”å¤±è´¥ï¼Œæˆ–è€…åŠ é”å¤±è´¥ï¼Œæˆ–è€…æ²¡æœ‰è·å–åˆ°é”</p><p>æ„æ€å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†å¯¹åº”çš„<code>é”ç»“æ„</code>ï¼Œä¸è¿‡é”ç»“æ„çš„<code>is_waiting</code>å±æ€§ä¸º<code>true</code>ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ éœ€è¦ç­‰å¾…ï¼Œä¸å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚</p></li></ul><h3 id="1-3-è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ">1.3 è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ</h3><p><code>è¯»-å†™</code>æˆ–<code>å†™-è¯»</code>ï¼Œå³ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªè¿›è¡Œæ”¹åŠ¨æ“ä½œã€‚è¿™ç§æƒ…å†µä¸‹å¯èƒ½å‘ç”Ÿ<code>è„è¯» ã€ä¸å¯é‡å¤è¯» ã€å¹»è¯»</code>çš„é—®é¢˜ã€‚</p><p>å„ä¸ªæ•°æ®åº“å‚å•†å¯¹<code>SQLæ ‡å‡†</code>çš„æ”¯æŒéƒ½å¯èƒ½ä¸ä¸€æ ·ã€‚æ¯”å¦‚MySQLåœ¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«ä¸Šå°±å·²ç»è§£å†³äº†<code>å¹»è¯»</code>é—®é¢˜ã€‚</p><h3 id="1-4-å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ">1.4 å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</h3><p>æ€ä¹ˆè§£å†³<code>è„è¯» ã€ä¸å¯é‡å¤è¯» ã€å¹»è¯»</code>è¿™äº›é—®é¢˜å‘¢ï¼Ÿå…¶å®æœ‰ä¸¤ç§å¯é€‰çš„è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>æ–¹æ¡ˆä¸€ï¼šè¯»æ“ä½œåˆ©ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ<code>MVCC</code>ï¼Œä¸‹ç« è®²è§£ï¼‰ï¼Œå†™æ“ä½œè¿›è¡Œ<code>åŠ é”</code>ã€‚</p><p>æ‰€è°“çš„<code>MVCC</code>ï¼Œå°±æ˜¯ç”Ÿæˆä¸€ä¸ª<code>ReadView</code>ï¼Œé€šè¿‡Readviewæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•ç‰ˆæœ¬ï¼ˆå†å²ç‰ˆæœ¬ç”±<code>undoæ—¥å¿—</code>æ„å»ºï¼‰ã€‚æŸ¥è¯¢è¯­å¥åªèƒ½<code>è¯»</code>åˆ°åœ¨ç”ŸæˆReadViewä¹‹å‰<code>å·±æäº¤äº‹åŠ¡æ‰€åšçš„æ›´æ”¹</code>ï¼Œåœ¨ç”ŸæˆReadViewä¹‹å‰æœªæäº¤çš„äº‹åŠ¡æˆ–è€…ä¹‹åæ‰å¼€å¯çš„äº‹åŠ¡æ‰€åšçš„æ›´æ”¹æ˜¯çœ‹ä¸åˆ°çš„ã€‚è€Œ<code>å†™æ“ä½œ</code>è‚¯å®šé’ˆå¯¹çš„æ˜¯<code>æœ€æ–°ç‰ˆæœ¬çš„è®°å½•</code>ï¼Œè¯»è®°å½•çš„å†å²ç‰ˆæœ¬å’Œæ”¹åŠ¨è®°å½•çš„æœ€æ–°ç‰ˆæœ¬æœ¬èº«å¹¶ä¸å†²çªï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨MVCCæ—¶ï¼Œ<code>è¯»-å†™</code>æ“ä½œå¹¶ä¸å†²çªã€‚</p></li></ul><blockquote><p>æ™®é€šçš„SELECTè¯­å¥åœ¨READ COMMITTEDå’ŒREPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ä¼šä½¿ç”¨åˆ°MVCCè¯»å–è®°å½•ã€‚</p><ul><li>åœ¨<code>READ COMMITTED</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯æ¬¡æ‰§è¡ŒSELECTæ“ä½œæ—¶éƒ½ä¼šç”Ÿæˆä¸€ ä¸ªReadViewï¼ŒReadViewçš„å­˜åœ¨æœ¬èº«å°±ä¿è¯äº†<code>äº‹åŠ¡ä¸å¯ä»¥è¯»å–åˆ°æœªæäº¤çš„äº‹åŠ¡æ‰€åšçš„æ›´æ”¹</code>ï¼Œä¹Ÿå°±æ˜¯é¿å…äº†è„è¯»ç°è±¡ï¼›</li><li>åœ¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åªæœ‰<code>ç¬¬ä¸€æ¬¡æ‰§è¡ŒSELECTæ“ä½œ</code>æ‰ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„SELECTæ“ä½œéƒ½<code>å¤ç”¨</code>è¿™ä¸ªReadViewï¼Œè¿™æ ·ä¹Ÿå°±é¿å…äº†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜ã€‚</li></ul></blockquote><ul><li><p>æ–¹æ¡ˆäºŒï¼šè¯»ã€å†™æ“ä½œéƒ½é‡‡ç”¨<code>åŠ é”</code>çš„æ–¹å¼ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸å…è®¸è¯»å–è®°å½•çš„æ—§ç‰ˆæœ¬ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½å¿…é¡»å»<code>è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬</code>ã€‚æ¯”å¦‚ï¼Œåœ¨é“¶è¡Œå­˜æ¬¾çš„äº‹åŠ¡ä¸­ï¼Œä½ éœ€è¦å…ˆæŠŠè´¦æˆ·çš„ä½™é¢è¯»å‡ºæ¥ï¼Œç„¶åå°†å…¶åŠ ä¸Šæœ¬æ¬¡å­˜æ¬¾çš„æ•°é¢ï¼Œæœ€åå†å†™åˆ°æ•°æ®åº“ä¸­ã€‚åœ¨å°†è´¦æˆ·ä½™é¢è¯»å–å‡ºæ¥åï¼Œå°±ä¸æƒ³è®©åˆ«çš„äº‹åŠ¡å†è®¿é—®è¯¥ä½™é¢ï¼Œç›´åˆ°æœ¬æ¬¡å­˜æ¬¾äº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œå…¶ä»–äº‹åŠ¡æ‰å¯ä»¥è®¿é—®è´¦æˆ·çš„ä½™é¢ã€‚è¿™æ ·åœ¨è¯»å–è®°å½•çš„æ—¶å€™å°±éœ€è¦å¯¹å…¶è¿›è¡Œ<code>åŠ é”</code>æ“ä½œï¼Œè¿™æ ·ä¹Ÿå°±æ„å‘³ç€<code>è¯»æ“ä½œ</code>å’Œ<code>å†™æ“ä½œ</code>ä¹Ÿåƒå†™-å†™æ“ä½œé‚£æ ·æ’é˜Ÿæ‰§è¡Œã€‚</p></li></ul><p><code>è„è¯»</code>çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡å†™çš„ä¸€æ¡è®°å½•ï¼Œå¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡åœ¨å†™è®°å½•çš„æ—¶å€™å°±ç»™è¿™æ¡è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡å°±æ— æ³•ç»§ç»­è¯»å–è¯¥è®°å½•äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šæœ‰è„è¯»é—®é¢˜çš„äº§ç”Ÿäº†ã€‚</p><p><code>ä¸å¯é‡å¤è¯»</code>çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡å…ˆè¯»å–ä¸€æ¡è®°å½•ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯¹è¯¥è®°å½•åšäº†æ”¹åŠ¨ä¹‹åå¹¶æäº¤ä¹‹åï¼Œå½“å‰äº‹åŠ¡å†æ¬¡è¯»å–æ—¶ä¼šè·å¾—ä¸åŒçš„å€¼ï¼Œå¦‚æœåœ¨å½“å‰äº‹åŠ¡è¯»å–è®°å½•æ—¶å°±ç»™è¯¥è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡å°±æ— æ³•ä¿®æ”¹è¯¥è®°å½•ï¼Œ è‡ªç„¶ä¹Ÿä¸ä¼šå‘ç”Ÿä¸å¯é‡å¤è¯»äº†ã€‚</p><p><code>å¹»è¯»</code>é—®é¢˜çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡è¯»å–äº†ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œç„¶åå¦å¤–çš„äº‹åŠ¡å‘è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°è®°å½•ï¼Œå½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è¯¥èŒƒå›´çš„è®°å½•æ—¶å‘ç°äº†æ–°æ’å…¥çš„æ–°è®°å½•ã€‚é‡‡ç”¨åŠ é”çš„æ–¹å¼è§£å†³å¹»è¯»é—®é¢˜å°±æœ‰ä¸€äº›éº»çƒ¦ï¼Œå› ä¸ºå½“å‰äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡è¯»å–è®°å½•æ—¶å¹»å½±è®°å½•å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¯»å–çš„æ—¶å€™åŠ é”å°±æœ‰ç‚¹å°´å°¬ï¼ˆå› ä¸ºä½ å¹¶ä¸çŸ¥é“ç»™è°åŠ é”ï¼‰</p><ul><li><p>å°ç»“å¯¹æ¯”å‘ç°ï¼š</p><ul><li>é‡‡ç”¨<code>MVCC</code>æ–¹å¼çš„è¯ï¼Œ è¯»-å†™æ“ä½œå½¼æ­¤å¹¶ä¸å†²çªï¼Œ æ€§èƒ½æ›´é«˜ ã€‚</li><li>é‡‡ç”¨<code>åŠ é”</code>æ–¹å¼çš„è¯ï¼Œ è¯»-å†™æ“ä½œå½¼æ­¤éœ€è¦<code>æ’é˜Ÿæ‰§è¡Œ</code>ï¼Œå½±å“æ€§èƒ½ã€‚</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å½“ç„¶æ„¿æ„é‡‡ç”¨<code>MVCC</code>æ¥è§£å†³<code>è¯»-å†™</code>æ“ä½œå¹¶å‘æ‰§è¡Œçš„é—®é¢˜ï¼Œä½†æ˜¯ä¸šåŠ¡åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¦æ±‚å¿…é¡»é‡‡ç”¨<code>åŠ é”</code>çš„æ–¹å¼æ‰§è¡Œã€‚ä¸‹é¢å°±è®²è§£ä¸‹MySQLä¸­ä¸åŒç±»åˆ«çš„é”ã€‚</p></li></ul><hr><h2 id="2-é”çš„ä¸åŒè§’åº¦åˆ†ç±»">2. é”çš„ä¸åŒè§’åº¦åˆ†ç±»</h2><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711203519162.png" alt="image-20220711203519162" style="zoom: 67%;" /><hr><h2 id="3-è¯»é”-å†™é”">3. è¯»é”/å†™é”</h2><blockquote><mark class="hl-label green">ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†ï¼šè¯»é”ã€å†™é”</mark> </blockquote><p>å¯¹äºæ•°æ®åº“ä¸­å¹¶å‘äº‹åŠ¡çš„<code>è¯»-è¯»</code>æƒ…å†µå¹¶ä¸ä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜ã€‚å¯¹äº<code>å†™-å†™</code>ã€<code>è¯»-å†™</code>æˆ–<code>å†™-è¯»</code>è¿™äº›æƒ…å†µå¯èƒ½ä¼šå¼•èµ·ä¸€äº›é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨<code>MVCC</code>æˆ–è€…<code>åŠ é”</code>çš„æ–¹å¼æ¥è§£å†³å®ƒä»¬ã€‚åœ¨ä½¿ç”¨<code>åŠ é”</code>çš„æ–¹å¼è§£å†³é—®é¢˜æ—¶ï¼Œç”±äºæ—¢è¦å…è®¸<code>è¯»-è¯»</code>æƒ…å†µä¸å—å½±å“ï¼Œåˆè¦ä½¿<code>å†™-å†™</code>ã€<code>è¯»-å†™</code>æˆ–<code>å†™-è¯»</code>æƒ…å†µä¸­çš„æ“ä½œç›¸äº’é˜»å¡ï¼Œæ‰€ä»¥MySQLå®ç°ä¸€ä¸ªç”±ä¸¤ç§ç±»å‹çš„é”ç»„æˆçš„é”ç³»ç»Ÿæ¥è§£å†³ã€‚è¿™ä¸¤ç§ç±»å‹çš„é”é€šå¸¸è¢«ç§°ä¸º<span class='p red'>å…±äº«é” Shared Lock</span>å’Œ<span class='p green'>æ’ä»–é” Exclusive Lock</span>ä¹Ÿå«<span class='p red'>è¯»é” readlock</span>å’Œ<span class='p green'>å†™é” write lock</span></p><p>*<code>è¯»é”</code>ï¼šä¹Ÿç§°ä¸º<code>å…±äº«é”</code>ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚<br>*<code>å†™é”</code>ï¼šä¹Ÿç§°ä¸º<code>æ’ä»–é”</code>ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ · å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚</p><span class='p blue'>éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºInnoDBå¼•æ“æ¥è¯´ï¼Œè¯»é”å’Œå†™é”å¯ä»¥åŠ åœ¨è¡¨ä¸Šï¼Œä¹Ÿå¯ä»¥åŠ åœ¨è¡Œä¸Šã€‚</span><br/><p>ä¸¾ä¾‹è¡Œçº§è¯»å†™é” ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡T1å·²ç»è·å¾—äº†æŸä¸ªè¡Œrçš„è¯»é”ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦å¤–çš„ä¸€ä¸ªäº‹åŠ¡ T2 æ˜¯å¯ä»¥å»è·å¾—è¿™ä¸ªè¡Œrçš„è¯»é”çš„ï¼Œå› ä¸ºè¯»å–æ“ä½œå¹¶æ²¡æœ‰æ”¹å˜è¡Œrçš„æ•°æ®ï¼›ä½†æ˜¯ï¼Œå¦‚æœæŸä¸ªäº‹åŠ¡ T3 æƒ³è·å¾—è¡Œrçš„å†™é”ï¼Œåˆ™å®ƒå¿…é¡»ç­‰å¾…äº‹åŠ¡ T1ã€T2é‡Šæ”¾æ‰è¡Œrä¸Šçš„è¯»é”æ‰è¡Œã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">å†™é”</th><th style="text-align:center">è¯»é”</th></tr></thead><tbody><tr><td style="text-align:center">å†™</td><td style="text-align:center">ä¸å…¼å®¹</td><td style="text-align:center">ä¸å…¼å®¹</td></tr><tr><td style="text-align:center">è¯»é”</td><td style="text-align:center">ä¸å…¼å®¹</td><td style="text-align:center">å…¼å®¹</td></tr></tbody></table><p>æ€»ç»“ï¼šè¿™é‡Œçš„å…¼å®¹æ˜¯æŒ‡å¯¹åŒä¸€å¼ è¡¨æˆ–è®°å½•çš„é”çš„å…¼å®¹æ€§æƒ…å†µã€‚</p><hr><mark class="hl-label pink">é”å®šè¯»</mark> <p>åœ¨é‡‡ç”¨<code>åŠ é”</code>æ–¹å¼è§£å†³<code>è„è¯»</code>ã€<code>ä¸å¯é‡å¤è¯»</code>ã€<code>å¹»è¯»</code>è¿™äº›é—®é¢˜æ—¶ï¼Œè¯»å–ä¸€æ¡è®°å½•æ—¶éœ€è¦è·å–è¯¥è®°å½•çš„<code>Sé”</code>ï¼Œå…¶å®æ˜¯ä¸ä¸¥è°¨çš„ï¼Œæœ‰æ—¶å€™éœ€è¦åœ¨è¯»å–è®°å½•æ—¶å°±è·å–è®°å½•çš„<code>Xé”</code>ï¼Œæ¥ç¦æ­¢åˆ«çš„äº‹åŠ¡è¯»å†™è¯¥è®°å½•ï¼Œä¸ºæ­¤MySQLæå‡ºäº†ä¸¤ç§æ¯”è¾ƒç‰¹æ®Šçš„<code>SELECT</code>è¯­å¥æ ¼å¼ï¼š</p><ul><li>å¯¹è¯»å–çš„è®°å½•åŠ <code>Sé”</code>ï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line">#æˆ–</span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> SHARE; #(<span class="number">8.0</span>æ–°å¢è¯­æ³•)</span><br></pre></td></tr></table></figure><p>åœ¨æ™®é€šçš„<code>SELECT</code>è¯­å¥åè¾¹åŠ <code>LOCK IN SHARE MODE</code>ï¼Œå¦‚æœå½“å‰äº‹åŠ¡æ‰§è¡Œäº†è¯¥è¯­å¥ï¼Œé‚£ä¹ˆå®ƒä¼šä¸ºè¯»å–åˆ°çš„è®°å½•åŠ <code>Sé”</code>ï¼Œè¿™æ ·å…è®¸åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¿™äº›è®°å½•çš„<code>Sé”</code>ï¼ˆæ¯”æ–¹è¯´åˆ«çš„äº‹åŠ¡ä¹Ÿä½¿ç”¨ SELECT â€¦ LOCK IN SHARE MODE è¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼‰ï¼Œä½†æ˜¯ä¸èƒ½è·å–è¿™äº›è®°å½•çš„<code>Xé”</code>ï¼ˆæ¯”å¦‚ä½¿ç”¨<code>SELECT .... FOR UPDATE</code>è¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹è¿™äº›è®°å½•ï¼‰ã€‚å¦‚æœåˆ«çš„äº‹åŠ¡æƒ³è¦è·å–è¿™äº›è®°å½•çš„<code>Xé”</code>ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰äº‹åŠ¡æäº¤ä¹‹åå°†è¿™äº›è®°å½•ä¸Šçš„<code>Sé”</code>é‡Šæ”¾æ‰ã€‚</p><ul><li>å¯¹è¯»å–çš„è®°å½•åŠ <code>Xé”</code>ï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>åœ¨æ™®é€šçš„<code>SELECT</code>è¯­å¥åè¾¹åŠ <code>FOR UPDATE</code>ï¼Œå¦‚æœå½“å‰äº‹åŠ¡æ‰§è¡Œäº†è¯¥è¯­å¥ï¼Œé‚£ä¹ˆå®ƒä¼šä¸ºè¯»å–åˆ°çš„è®°å½•åŠ <code>Xé”</code>ï¼Œ è¿™æ ·æ—¢ä¸å…è®¸åˆ«çš„äº‹åŠ¡è·å–è¿™äº›è®°å½•çš„<code>Sé”</code>ï¼ˆæ¯”æ–¹è¯´åˆ«çš„äº‹åŠ¡ä½¿ç”¨<code>SELECT .... LOCK IN SHARE MODE</code>è¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼‰ï¼Œä¹Ÿä¸å…è®¸è·å–è¿™äº›è®°å½•çš„<code>Xé”</code>ï¼ˆæ¯”å¦‚ä½¿ç”¨<code>SELECT ... FOR UPDATE</code>è¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹è¿™äº›è®°å½•ï¼‰ã€‚å¦‚æœåˆ«çš„äº‹åŠ¡æƒ³è¦è·å–è¿™äº›è®°å½•çš„<code>Sé”</code>æˆ–è€…<code>Xé”</code>ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰äº‹åŠ¡æäº¤ä¹‹åå°†è¿™äº›è®°å½•ä¸Šçš„<code>Xé”</code>é‡Šæ”¾æ‰ã€‚</p><span class='p red'>MySQL8.0æ–°ç‰¹æ€§</span><p>åœ¨5.7åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œ<code>SELECT ...FOR UPDATE</code>ï¼Œå¦‚æœè·å–ä¸åˆ°é”ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°<code>innodb_ lock_wait_timeout</code>è¶…æ—¶ã€‚åœ¨8.0ç‰ˆæœ¬ä¸­ï¼Œ<code>SELECT ... FOR UPDATE</code>,<code>SELECT ... FOR SHARE</code>æ·»åŠ <code>NOWAIT</code>ã€<code>SKIP LOCKED</code>è¯­æ³•ï¼Œè·³è¿‡é”ç­‰å¾…ï¼Œæˆ–è€…è·³è¿‡é”å®šã€‚</p><ul><li>é€šè¿‡æ·»åŠ NOWAITã€SKIP LOCKEDè¯­æ³•ï¼Œèƒ½å¤Ÿç«‹å³è¿”å›ã€‚å¦‚æœæŸ¥è¯¢çš„è¡Œå·²ç»åŠ é”ï¼š<ul><li>é‚£ä¹ˆNOWAITä¼šç«‹å³æŠ¥é”™è¿”å›</li><li>è€ŒSKIP LOCKEDä¹Ÿä¼šç«‹å³è¿”å›ï¼Œåªæ˜¯è¿”å›çš„ç»“æœä¸­ä¸åŒ…å«è¢«é”å®šçš„è¡Œã€‚</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># session1:</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">mysgl<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> c1 <span class="operator">=</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="operator">|</span>  c1  <span class="operator">|</span>  c2  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span>   <span class="operator">|</span> <span class="number">60530</span><span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span>   <span class="operator">|</span> <span class="number">24678</span><span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># session2:</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> c1 <span class="operator">=</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span> nowaitï¼›</span><br><span class="line">ERROR <span class="number">3572</span> (HY000): Statement aborted because lock(s) could <span class="keyword">not</span> be acquired immediately <span class="keyword">and</span> NOWAIT <span class="keyword">is</span> set.</span><br><span class="line">mysgl<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> c1 <span class="operator">=</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span> <span class="keyword">skip</span> locked;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><hr><blockquote><mark class="hl-label pink">å†™æ“ä½œ</mark> </blockquote><p>å¹³å¸¸æ‰€ç”¨åˆ°çš„å†™æ“ä½œæ— éæ˜¯<code>DELETE</code>ã€<code>UPDATE</code>ã€<code>INSERT</code>è¿™ä¸‰ç§ï¼š</p><p>-<code>DELETE</code></p><p>å¯¹ä¸€æ¡è®°å½•åšDELETEæ“ä½œçš„è¿‡ç¨‹å…¶å®æ˜¯å…ˆåœ¨<code>B+æ ‘</code>ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–è¿™æ¡è®°å½•çš„<code>Xé”</code>ï¼Œå†æ‰§è¡Œ<code>delete mark</code>æ“ä½œã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå®šä½å¾…åˆ é™¤è®°å½•åœ¨B+æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ªè·å–<code>Xé”</code>çš„<code>é”å®šè¯»</code>ã€‚</p><p>-<code>UPDATE</code>ï¼š åœ¨å¯¹ä¸€æ¡è®°å½•åšUPDATEæ“ä½œæ—¶åˆ†ä¸ºä¸‰ç§æƒ…å†µ</p><ul><li>æƒ…å†µ1ï¼šæœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œå¹¶ä¸”è¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨ä¿®æ”¹å‰åæœªå‘ç”Ÿå˜åŒ–ã€‚åˆ™å…ˆåœ¨<code>B+æ ‘</code>ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åå†è·å–ä¸€ä¸‹è®°å½•çš„<code>Xé”</code>ï¼Œæœ€ååœ¨åŸè®°å½•çš„ä½ç½®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå®šä½å¾…ä¿®æ”¹è®°å½•åœ¨B+ æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ªè·å–<code>Xé”</code>çš„<code>é”å®šè¯»</code>ã€‚</li><li>æƒ…å†µ2ï¼šæœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªè¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨ä¿®æ”¹å‰åå‘ç”Ÿå˜åŒ–ã€‚åˆ™å…ˆåœ¨<code>B+æ ‘</code>ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–ä¸€ä¸‹è®°å½•çš„<code>Xé”</code>ï¼Œå°†è¯¥è®°å½•å½»åº•åˆ é™¤æ‰ï¼ˆå°±æ˜¯æŠŠè®°å½•å½»åº•ç§»å…¥åƒåœ¾é“¾è¡¨ï¼‰ï¼Œæœ€åå†æ’å…¥ä¸€æ¡æ–°è®°å½•ã€‚è¿™ä¸ªå®šä½å¾…ä¿®æ”¹è®°å½•åœ¨B+ æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ªè·å–ã€‰ é”çš„é”å®šè¯»ï¼Œæ–°æ’å…¥çš„è®°å½•ç”±<code>INSERT</code>æ“ä½œæä¾›çš„<code>éšå¼é”</code>è¿›è¡Œä¿æŠ¤ã€‚</li><li>æƒ…å†µ3ï¼šä¿®æ”¹äº†è¯¥è®°å½•çš„å¥å€¼ï¼Œåˆ™ç›¸å½“äºåœ¨åŸè®°å½•ä¸Šåš<code>DELETE</code>æ“ä½œä¹‹åå†æ¥ä¸€æ¬¡<code>INSERT</code>æ“ä½œï¼ŒåŠ é”æ“ä½œå°±éœ€è¦æŒ‰ç…§<code>DELETE</code>å’Œ<code>INSERT</code>çš„è§„åˆ™è¿›è¡Œäº†ã€‚</li></ul><p>-<code>INSERT</code></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–°æ’å…¥ä¸€æ¡è®°å½•çš„æ“ä½œå¹¶ä¸åŠ é”ï¼Œé€šè¿‡ä¸€ç§ç§°ä¹‹ä¸ºéšå¼é”çš„ç»“æ„æ¥ä¿æŠ¤è¿™æ¡æ–°æ’å…¥çš„è®°å½•åœ¨æœ¬äº‹åŠ¡æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—®ã€‚</p><hr><h2 id="4-è¡¨çº§é”-é¡µçº§é”-è¡Œé”">4. è¡¨çº§é”/é¡µçº§é”/è¡Œé”</h2><blockquote><mark class="hl-label green">ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†ï¼šè¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”</mark> </blockquote><p>ä¸ºäº†å°½å¯èƒ½æé«˜æ•°æ®åº“çš„å¹¶å‘åº¦ï¼Œæ¯æ¬¡é”å®šçš„æ•°æ®èŒƒå›´è¶Šå°è¶Šå¥½ï¼Œç†è®ºä¸Šæ¯æ¬¡åªé”å®šå½“å‰æ“ä½œçš„æ•°æ®çš„æ–¹æ¡ˆä¼šå¾—åˆ°æœ€å¤§çš„å¹¶å‘åº¦ï¼Œä½†æ˜¯ç®¡ç†é”æ˜¯å¾ˆ<code>è€—èµ„æº</code>çš„äº‹æƒ…ï¼ˆæ¶‰åŠè·å–ã€æ£€æŸ¥ã€é‡Šæ”¾é”ç­‰åŠ¨ä½œï¼‰ã€‚å› æ­¤æ•°æ®åº“ç³»ç»Ÿéœ€è¦åœ¨<code>é«˜å¹¶å‘å“åº”</code>å’Œ<code>ç³»ç»Ÿæ€§èƒ½</code>ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†ï¼š<code>é”ç²’åº¦(Lock granularity)</code>çš„æ¦‚å¿µã€‚</p><p>å¯¹ä¸€æ¡è®°å½•åŠ é”å½±å“çš„ä¹Ÿåªæ˜¯è¿™æ¡è®°å½•è€Œå·²ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªé”çš„ç²’åº¦æ¯”è¾ƒç»†ï¼›å…¶å®ä¸€ä¸ªäº‹åŠ¡ä¹Ÿå¯ä»¥åœ¨<code>è¡¨çº§åˆ«</code>è¿›è¡ŒåŠ é”ï¼Œè‡ªç„¶å°±è¢«ç§°ä¹‹ä¸º<code>è¡¨çº§é”</code>æˆ–è€…<code>è¡¨é”</code>ï¼Œå¯¹ä¸€ä¸ªè¡¨åŠ é”å½±å“æ•´ä¸ªè¡¨ä¸­çš„è®°å½•ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªé”çš„ç²’åº¦æ¯”è¾ƒç²—ã€‚é”çš„ç²’åº¦ä¸»è¦åˆ†ä¸ºè¡¨çº§é”ã€é¡µçº§é”å’Œè¡Œé”ã€‚</p><hr><h3 id="4-1-è¡¨é”ï¼ˆTable-Lockï¼‰">4.1 è¡¨é”ï¼ˆTable Lockï¼‰</h3><p>è¯¥é”ä¼šé”å®šæ•´å¼ è¡¨ï¼Œå®ƒæ˜¯ MySQL ä¸­æœ€åŸºæœ¬çš„é”ç­–ç•¥ï¼Œ<code>å¹¶ä¸ä¾èµ–äºå­˜å‚¨å¼•æ“</code>ï¼ˆä¸ç®¡ä½ æ˜¯ MySQL çš„ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œ å¯¹äºè¡¨é”çš„ç­–ç•¥éƒ½æ˜¯ä¸€æ ·çš„ï¼‰ï¼Œå¹¶ä¸”è¡¨é”æ˜¯<code>å¼€é”€æœ€å°</code>çš„ç­–ç•¥ï¼ˆå› ä¸ºç²’åº¦æ¯”è¾ƒå¤§ï¼‰ã€‚ç”±äºè¡¨çº§é”ä¸€æ¬¡ä¼šå°†æ•´ä¸ªè¡¨é”å®šï¼Œæ‰€ä»¥å¯ä»¥å¾ˆå¥½çš„<code>é¿å…æ­»é”</code>é—®é¢˜ã€‚å½“ç„¶ï¼Œé”çš„ç²’åº¦å¤§æ‰€å¸¦æ¥æœ€å¤§çš„è´Ÿé¢å½±å“å°±æ˜¯å‡ºç°é”èµ„æºäº‰ç”¨çš„æ¦‚ç‡ä¹Ÿä¼šæœ€é«˜ï¼Œå¯¼è‡´<code>å¹¶å‘ç‡å¤§æ‰“æŠ˜æ‰£</code>ã€‚</p><hr><h4 id="4-1-1-è¡¨çº§åˆ«çš„Sé”ã€Xé”">4.1.1 è¡¨çº§åˆ«çš„Sé”ã€Xé”</h4><p>åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„<code>Sé”</code>æˆ–è€…<code>Xé”</code>çš„ã€‚åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡Œä¸€äº›è¯¸å¦‚<code>ALTER TABLE ã€ DROP TABLE</code>è¿™ç±»çš„ DDL è¯­å¥æ—¶ï¼Œå…¶ ä»–äº‹åŠ¡å¯¹è¿™ä¸ªè¡¨å¹¶å‘æ‰§è¡Œè¯¸å¦‚SELECTã€INSERTã€DELETEã€UPDATEçš„è¯­å¥ä¼šå‘ç”Ÿé˜»å¡ã€‚åŒç†ï¼ŒæŸä¸ªäº‹åŠ¡ä¸­å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼Œåœ¨å…¶ä»–ä¼šè¯ä¸­å¯¹è¿™ä¸ªè¡¨æ‰§è¡Œ<code>DDL</code>è¯­å¥ä¹Ÿä¼š å‘ç”Ÿé˜»å¡ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡åœ¨ serverå±‚ä½¿ç”¨ä¸€ç§ç§°ä¹‹ä¸º<code>å…ƒæ•°æ®é”</code>ï¼ˆè‹±æ–‡åï¼š Metadata Locks ï¼Œ ç®€ç§° MDL ï¼‰ç»“æ„æ¥å®ç°çš„ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨çº§åˆ«çš„<code>Sé”</code>å’Œ<code>Xé”</code>ã€‚åªä¼šåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”æ–¹è¯´<code>å´©æºƒæ¢å¤</code>è¿‡ç¨‹ä¸­ç”¨åˆ°ã€‚æ¯”å¦‚ï¼Œåœ¨ç³»ç»Ÿå˜é‡<code>autocommit=0ï¼Œinnodb_table_locks = 1</code>æ—¶ï¼Œ æ‰‹åŠ¨ è·å– InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨t çš„<code>Sé”</code>æˆ–è€…<code>Xé”</code>å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><p>*<code>LOCK TABLES t READ</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„<code>Sé”</code>ã€‚</p><p>*<code>LOCK TABLES t WRITE</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„<code>Xé”</code>ã€‚</p><p>ä¸è¿‡å°½é‡é¿å…åœ¨ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨ä¸Šä½¿ç”¨<code>LOCK TABLES</code>è¿™æ ·çš„æ‰‹åŠ¨é”è¡¨è¯­å¥ï¼Œå®ƒä»¬å¹¶ä¸ä¼šæä¾›ä»€ä¹ˆé¢å¤–çš„ä¿æŠ¤ï¼Œåªæ˜¯ä¼šé™ä½å¹¶å‘èƒ½åŠ›è€Œå·²ã€‚InnoDBçš„å‰å®³ä¹‹å¤„è¿˜æ˜¯å®ç°äº†æ›´ç»†ç²’åº¦çš„<code>è¡Œé”</code>ï¼Œå…³äº InnoDBè¡¨çº§åˆ«çš„<code>Sé”</code>å’Œ<code>Xé”</code>å¤§å®¶äº†è§£ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><mark class="hl-label blue">ä¸¾ä¾‹ï¼šä¸‹é¢æˆ‘ä»¬è®²è§£MyISAMå¼•æ“ä¸‹çš„è¡¨é”</mark>  <div class="tabs" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-1"><i class="fas fa-atom"></i>åˆ›å»ºè¡¨å¹¶æ·»åŠ æ•°æ®</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-2"><i class="far fa-sun"></i>æŸ¥çœ‹è¡¨ä¸ŠåŠ è¿‡çš„é”</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-3"><i class="fas fa-wind"></i>æ‰‹åŠ¨å¢åŠ è¡¨é”å‘½ä»¤</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-4"><i class="fas fa-fire-alt"></i>é‡Šæ”¾è¡¨é”</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-5"><i class="fas fa-heartbeat"></i>åŠ è¯»é”</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-6"><i class="fas fa-cookie-bite"></i>åŠ å†™é”</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-1"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mylock(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY auto_increment,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">)ENGINE MYISAM;</span><br><span class="line"></span><br><span class="line"># æ’å…¥ä¸€æ¡æ•°æ®</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mylock(NAME) <span class="keyword">VALUES</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰æ•°æ®</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mylock;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> Name <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> a    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-2"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">OPEN</span> TABLES; # ä¸»è¦å…³æ³¨In_useå­—æ®µçš„å€¼</span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">OPEN</span> TABLES <span class="keyword">where</span> In_use <span class="operator">&gt;</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220342251.png" alt="image-20220711220342251" style="zoom: 50%;" /><p>æˆ–è€…</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220418859.png" alt="image-20220711220418859"  /><p>ä¸Šé¢çš„ç»“æœè¡¨æ˜ï¼Œå½“å‰æ•°æ®åº“ä¸­æ²¡æœ‰è¢«é”å®šçš„è¡¨</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-3"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOCK TABLES t READ; # å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨tåŠ è¡¨çº§åˆ«çš„å…±äº«é”ã€‚å…±äº«é”ä¹Ÿå«è¯»é”æˆ–Sé”ï¼ˆShareçš„ç¼©å†™ï¼‰</span><br><span class="line">LOCK TABLES t WRITE; # å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨tåŠ è¡¨çº§åˆ«çš„æ’ä»–é”ã€‚æ’ä»–é”ä¹Ÿå«ç‹¬å é”ã€å†™é”æˆ–Xé”ï¼ˆexclusiveçš„ç¼©å†™ï¼‰</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220442269.png" alt="image-20220711220442269"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-4"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNLOCK TABLES; # ä½¿ç”¨æ­¤å‘½ä»¤è§£é”å½“å‰åŠ é”çš„è¡¨</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220502141.png" alt="image-20220711220502141"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-5"><p>æˆ‘ä»¬ä¸ºmylockè¡¨åŠ readé”ï¼ˆè¯»é˜»å¡å†™ï¼‰ï¼Œè§‚å¯Ÿé˜»å¡çš„æƒ…å†µï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220553225.png" alt="image-20220711220553225" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220616537.png" alt="image-20220711220616537" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-6"><p>ä¸ºmylockè¡¨åŠ writeé”ï¼Œè§‚å¯Ÿé˜»å¡çš„æƒ…å†µï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220711630.png" alt="image-20220711220711630" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220730112.png" alt="image-20220711220730112" style="zoom: 67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <mark class="hl-label blue">æ€»ç»“</mark> <p>MyISAMåœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼ˆSELECTï¼‰å‰ï¼Œä¼šç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æ“ä½œå‰ï¼Œä¼šç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ã€‚InnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„è¯»é”å’Œå†™é”çš„ã€‚</p><p>MySQLçš„è¡¨çº§é”æœ‰ä¸¤ç§æ¨¡å¼ï¼šï¼ˆä»¥MyISAMè¡¨è¿›è¡Œæ“ä½œçš„æ¼”ç¤ºï¼‰</p><ul><li><p>è¡¨å…±äº«è¯»é”ï¼ˆTable Read Lockï¼‰</p></li><li><p>è¡¨ç‹¬å å†™é”ï¼ˆTable Write Lockï¼‰</p><table><thead><tr><th style="text-align:center">é”ç±»å‹</th><th style="text-align:center">è‡ªå·±å¯è¯»</th><th style="text-align:center">è‡ªå·±å¯å†™</th><th style="text-align:center">è‡ªå·±å¯æ“ä½œå…¶ä»–è¡¨</th><th style="text-align:center">ä»–äººå¯è¯»</th><th style="text-align:center">ä»–äººå¯å†™</th></tr></thead><tbody><tr><td style="text-align:center">è¯»é”</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">å¦</td><td style="text-align:center">å¦</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">å¦ï¼Œç­‰</td></tr><tr><td style="text-align:center">å†™é”</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">å¦</td><td style="text-align:center">å¦ï¼Œç­‰</td><td style="text-align:center">å¦ï¼Œç­‰</td></tr></tbody></table></li></ul><hr><h4 id="4-1-2-æ„å‘é”-intention-lock">4.1.2 æ„å‘é”(intention lock)</h4><p>InnoDB æ”¯æŒ<code>å¤šç²’åº¦é”ï¼ˆmultiple granularity lockingï¼‰</code>ï¼Œå®ƒå…è®¸<code>è¡Œçº§é”</code>ä¸<code>è¡¨çº§é”</code>å…±å­˜ï¼Œè€Œ<code>æ„å‘é”</code>å°±æ˜¯å…¶ä¸­çš„ä¸€ç§<code>è¡¨é”</code>ã€‚</p><ol><li>æ„å‘é”çš„å­˜åœ¨æ˜¯ä¸ºäº†åè°ƒè¡Œé”å’Œè¡¨é”çš„å…³ç³»ï¼Œæ”¯æŒå¤šç²’åº¦ï¼ˆè¡¨é”å’Œè¡Œé”ï¼‰çš„é”å¹¶å­˜ã€‚</li><li>æ„å‘é”æ˜¯ä¸€ç§<code>ä¸ä¸è¡Œçº§é”å†²çªè¡¨çº§é”</code>ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</li><li>è¡¨æ˜â€œæŸä¸ªäº‹åŠ¡æ­£åœ¨æŸäº›è¡ŒæŒæœ‰äº†é”æˆ–è¯¥äº‹åŠ¡å‡†å¤‡å»æŒæœ‰é”â€</li></ol><p>æ„å‘é”åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>æ„å‘å…±äº«é”ï¼ˆintention shared lock, ISï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ å…±äº«é”ï¼ˆSé”ï¼‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span> <span class="keyword">FROM</span> <span class="keyword">table</span> ... LOCK <span class="keyword">IN</span> SHARE MODE;</span><br></pre></td></tr></table></figure><ul><li>æ„å‘æ’ä»–é”ï¼ˆintention exclusive lock, IXï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ æ’ä»–é”ï¼ˆXé”ï¼‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span> <span class="keyword">FROM</span> <span class="keyword">table</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>å³ï¼šæ„å‘é”æ˜¯ç”±å­˜å‚¨å¼•æ“<code>è‡ªå·±ç»´æŠ¤çš„</code>ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº« / æ’ä»–é”ä¹‹å‰ï¼Œ InooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œ<code>æ‰€åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”</code>ã€‚</p><mark class="hl-label green">æ„å‘é”è¦è§£å†³çš„é—®é¢˜</mark> <p>ç°åœ¨æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œåˆ†åˆ«æ˜¯T1å’ŒT2ï¼Œå…¶ä¸­T2è¯•å›¾åœ¨è¯¥è¡¨çº§åˆ«ä¸Šåº”ç”¨å…±äº«æˆ–æ’å®ƒé”ï¼Œå¦‚æœæ²¡æœ‰æ„å‘é”å­˜åœ¨ï¼Œé‚£ä¹ˆT2å°±éœ€è¦å»æ£€æŸ¥å„ä¸ªé¡µæˆ–è¡Œæ˜¯å¦å­˜åœ¨é”ï¼›å¦‚æœå­˜åœ¨æ„å‘é”ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå—åˆ°ç”±T1æ§åˆ¶çš„<code>è¡¨çº§åˆ«æ„å‘é”çš„é˜»å¡</code>ã€‚T2åœ¨é”å®šè¯¥è¡¨å‰ä¸å¿…æ£€æŸ¥å„ä¸ªé¡µæˆ–è¡Œé”ï¼Œè€Œåªéœ€æ£€æŸ¥è¡¨ä¸Šçš„æ„å‘é”ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç»™æ›´å¤§ä¸€çº§åˆ«çš„ç©ºé—´ç¤ºæ„é‡Œé¢æ˜¯å¦å·²ç»ä¸Šè¿‡é”ã€‚</p><p>åœ¨æ•°æ®è¡¨çš„åœºæ™¯ä¸­ï¼Œ<span class='p red'>å¦‚æœæˆ‘ä»¬ç»™æŸä¸€è¡Œæ•°æ®åŠ ä¸Šäº†æ’å®ƒé”ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ç»™æ›´å¤§ä¸€çº§çš„ç©ºé—´ï¼Œæ¯”å¦‚æ•°æ®é¡µæˆ–æ•°æ®è¡¨åŠ ä¸Šæ„å‘é”ï¼Œå‘Šè¯‰å…¶ä»–äººè¿™ä¸ªæ•°æ®é¡µæˆ–æ•°æ®è¡¨å·±ç»æœ‰äººä¸Šè¿‡æ’å®ƒé”äº†</span>ï¼Œè¿™æ ·å½“å…¶ä»–äººæƒ³è¦è·å–æ•°æ®è¡¨æ’å®ƒé”çš„æ—¶å€™ï¼Œåªéœ€è¦äº†è§£æ˜¯å¦æœ‰äººå·²ç»è·å–äº†è¿™ä¸ªæ•°æ®è¡¨çš„æ„å‘æ’ä»–é”å³å¯ã€‚</p><ul><li><p>å¦‚æœäº‹åŠ¡æƒ³è¦è·å¾—æ•°æ®è¡¨ä¸­æŸäº›è®°å½•çš„å…±äº«é”ï¼Œå°±éœ€è¦åœ¨æ•°æ®è¡¨ä¸Šæ·»åŠ æ„å‘å…±äº«é”ã€‚</p></li><li><p>å¦‚æœäº‹åŠ¡æƒ³è¦è·å¾—æ•°æ®è¡¨ä¸­æŸäº›è®°å½•çš„æ’ä»–é”ï¼Œå°±éœ€è¦åœ¨æ•°æ®è¡¨ä¸Šæ·»åŠ æ„å‘æ’ä»–é”ã€‚</p></li></ul><p>è¿™æ—¶ï¼Œæ„å‘é”ä¼šå‘Šè¯‰å…¶ä»–äº‹åŠ¡å·²ç»æœ‰äººé”å®šäº†è¡¨ä¸­çš„æŸäº›è®°å½•ã€‚</p><blockquote><p>ä¸¾ä¾‹</p></blockquote><div class="tabs" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-1"><i class="fas fa-seedling"></i>1</button></li><li class="tab"><button type="button" data-href="#bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-2"><i class="fas fa-leaf"></i>2</button></li><li class="tab"><button type="button" data-href="#bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-3"><i class="fab fa-apple"></i>3</button></li><li class="tab"><button type="button" data-href="#bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-4"><i class="fas fa-tree"></i>4</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-1"><p>åˆ›å»ºè¡¨teacher,æ’å…¥6æ¡æ•°æ®ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«é»˜è®¤ä¸º<code>Repeatable-Read</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`teacher`(</span><br><span class="line">`id`<span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name`<span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`teacher`<span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;lisi&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;wangwu&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;zhaoliu&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;songhongkang&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;leifengyang&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> @<span class="variable">@transaction</span>_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@transaction</span>_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-2"><p>å‡è®¾äº‹åŠ¡Aè·å–äº†æŸä¸€è¡Œçš„æ’ä»–é”ï¼Œå¹¶æœªæäº¤ï¼Œè¯­å¥å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">6</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨çš„è¡¨è¯»é”ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">LOCK TABLES teacher READ;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-3"><p>å› ä¸ºå…±äº«é”ä¸æ’ä»–é”äº’æ–¥ï¼Œæ‰€ä»¥äº‹åŠ¡B åœ¨è¯•å›¾å¯¹ teacher è¡¨åŠ å…±äº«é”çš„æ—¶å€™ï¼Œå¿…é¡»ä¿è¯ä¸¤ä¸ªæ¡ä»¶ã€‚</p><p>(1) å½“å‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡æŒæœ‰ teacher è¡¨çš„æ’ä»–é”</p><p>(2) å½“å‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡æŒæœ‰ teacher è¡¨ä¸­ä»»æ„ä¸€è¡Œçš„æ’ä»–é”ã€‚</p><p>ä¸ºäº†æ£€æµ‹æ˜¯å¦æ»¡è¶³ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œäº‹åŠ¡Bå¿…é¡»åœ¨ç¡®ä¿ teacher è¡¨ä¸å­˜åœ¨ä»»ä½•æ’ä»–é”çš„å‰æä¸‹ï¼Œå»æ£€æµ‹è¡¨ä¸­çš„æ¯ä¸€è¡Œæ˜¯å¦å­˜åœ¨æ’ä»–é”ã€‚å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸€ä¸ªæ•ˆç‡å¾ˆå·®çš„åšæ³•ï¼Œä½†æ˜¯æœ‰äº†æ„å‘é”ä¹‹åï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-4"><p>æ„å‘é”æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ„å‘é”ä¹‹é—´çš„å…¼å®¹äº’æ–¥æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220712124209006.png" alt="image-20220712124209006"  /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">6</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶teacherè¡¨å­˜åœ¨ä¸¤æŠŠé”ï¼šteacherè¡¨ä¸Šçš„æ„å‘æ’ä»–é”ä¸idæœª6çš„æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚äº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨çš„å…±äº«é”ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">LOCK TABLES teacher READ;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶äº‹åŠ¡Bæ£€æµ‹äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ï¼Œå°±å¯ä»¥å¾—çŸ¥äº‹åŠ¡Aå¿…é¡»æŒæœ‰è¯¥è¡¨ä¸­æŸäº›æ•°æ®è¡Œçš„æ’ä»–é”ï¼Œé‚£ä¹ˆäº‹åŠ¡Bå¯¹teacherè¡¨çš„åŠ é”è¯·æ±‚å°±ä¼šè¢«æ’æ–¥ï¼ˆé˜»å¡ï¼‰ï¼Œè€Œæ— éœ€å»æ£€æµ‹è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®æ˜¯å¦å­˜åœ¨æ’ä»–é”ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><mark class="hl-label green">æ„å‘é”çš„å¹¶å‘æ€§</mark> <p>æ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº« / æ’ä»–é”äº’æ–¥ï¼æ­£å› ä¸ºå¦‚æ­¤ï¼Œæ„å‘é”å¹¶ä¸ä¼šå½±å“åˆ°å¤šä¸ªäº‹åŠ¡å¯¹ä¸åŒæ•°æ®è¡ŒåŠ æ’ä»–é”æ—¶çš„å¹¶å‘æ€§ã€‚ï¼ˆä¸ç„¶æˆ‘ä»¬ç›´æ¥ç”¨æ™®é€šçš„è¡¨é”å°±è¡Œäº†ï¼‰</p><p>æˆ‘ä»¬æ‰©å±•ä¸€ä¸‹ä¸Šé¢ teacherè¡¨çš„ä¾‹å­æ¥æ¦‚æ‹¬ä¸€ä¸‹æ„å‘é”çš„ä½œç”¨ï¼ˆä¸€æ¡æ•°æ®ä»è¢«é”å®šåˆ°è¢«é‡Šæ”¾çš„è¿‡ç¨‹ä¸­ï¼Œå¯ èƒ½å­˜åœ¨å¤šç§ä¸åŒé”ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬åªç€é‡è¡¨ç°æ„å‘é”ï¼‰ã€‚</p><p>äº‹åŠ¡Aå…ˆè·å¾—äº†æŸä¸€è¡Œçš„æ’ä»–é”ï¼Œå¹¶æœªæäº¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">6</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡Aè·å–äº†teacherè¡¨ä¸Šçš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Aè·å–äº†idä¸º6çš„æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚ä¹‹åäº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨ä¸Šçš„å…±äº«é”ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">LOCK TABLES teacher READ;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡Bæ£€æµ‹åˆ°äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Bå¯¹teacherè¡¨çš„åŠ é”è¯·æ±‚è¢«é˜»å¡ï¼ˆæ’æ–¥ï¼‰ã€‚æœ€åäº‹åŠ¡Cä¹Ÿæƒ³è·å–teacherè¡¨ä¸­æŸä¸€è¡Œçš„æ’ä»–é”ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">5</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡Cç”³è¯·teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Cæ£€æµ‹åˆ°äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚å› ä¸ºæ„å‘é”ä¹‹é—´å¹¶ä¸äº’æ–¥ï¼Œæ‰€ä»¥äº‹åŠ¡Cè·å–åˆ°äº†teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚å› ä¸ºidä¸º5çš„æ•°æ®è¡Œä¸Šä¸å­˜åœ¨ä»»ä½•æ’ä»–é”ï¼Œæœ€ç»ˆäº‹åŠ¡CæˆåŠŸè·å–åˆ°äº†è¯¥æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚</p><p>ä»ä¸Šé¢çš„æ¡ˆä¾‹å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“è®ºï¼š</p><ol><li>InnoDB æ”¯æŒ<code>å¤šç²’åº¦é”</code>ï¼Œç‰¹å®šåœºæ™¯ä¸‹ï¼Œè¡Œçº§é”å¯ä»¥ä¸è¡¨çº§é”å…±å­˜ã€‚</li><li>æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ<code>æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥</code>ã€‚</li><li>IXï¼ŒISæ˜¯è¡¨çº§é”ï¼Œä¸ä¼šå’Œè¡Œçº§çš„Xï¼ŒSé”å‘ç”Ÿå†²çªã€‚åªä¼šå’Œè¡¨çº§çš„Xï¼ŒSå‘ç”Ÿå†²çªã€‚</li><li>æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº†<code>è¡Œé”å’Œè¡¨é”å…±å­˜</code>ä¸”<code>æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§</code>çš„è¦æ±‚ã€‚</li></ol><hr><h4 id="4-1-3-è‡ªå¢é”-AUTO-INCé”">4.1.3 è‡ªå¢é”(AUTO-INCé”)</h4><p>åœ¨ä½¿ç”¨MySQLè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¡¨çš„æŸä¸ªåˆ—æ·»åŠ <code>AUTO_INCREMENT</code>å±æ€§ã€‚ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`teacher`(</span><br><span class="line">`id`<span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name`<span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure><p>ç”±äºè¿™ä¸ªè¡¨çš„idå­—æ®µå£°æ˜äº†AUTO_INCREMENTï¼Œæ„å‘³ç€åœ¨ä¹¦å†™æ’å…¥è¯­å¥æ—¶ä¸éœ€è¦ä¸ºå…¶èµ‹å€¼ï¼ŒSQLè¯­å¥ä¿®æ”¹ å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`teacher`(name) <span class="keyword">VALUES</span> (<span class="string">&#x27;zhangsan&#x27;</span>), (<span class="string">&#x27;lisi&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šè¾¹çš„æ’å…¥è¯­å¥å¹¶æ²¡æœ‰ä¸ºidåˆ—æ˜¾å¼èµ‹å€¼ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå®ƒèµ‹ä¸Šé€’å¢çš„å€¼ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> zhangsan <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> lisi     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬çœ‹åˆ°çš„ä¸Šé¢æ’å…¥æ•°æ®åªæ˜¯ä¸€ç§ç®€å•çš„æ’å…¥æ¨¡å¼ï¼Œæ‰€æœ‰æ’å…¥æ•°æ®çš„æ–¹å¼æ€»å…±åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ â€œ<code>Simple inserts</code>â€ï¼Œâ€œ<code>Bulk inserts</code>â€å’Œâ€œ<code>Mixed-mode inserts</code>â€ã€‚</p><div class="tabs" id="4434cedb-9dd6-40ab-a889-79476e2dbea7"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#4434cedb-9dd6-40ab-a889-79476e2dbea7-1"><i class="fas fa-atom"></i>1.Simple inserts(ç®€å•æ’å…¥)</button></li><li class="tab"><button type="button" data-href="#4434cedb-9dd6-40ab-a889-79476e2dbea7-2"><i class="far fa-sun"></i>2.Bulk inserts(æ‰¹é‡æ’å…¥)</button></li><li class="tab"><button type="button" data-href="#4434cedb-9dd6-40ab-a889-79476e2dbea7-3"><i class="fas fa-wind"></i>3.Mixed-mode inserts(æ··åˆæ¨¡å¼æ’å…¥)</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="4434cedb-9dd6-40ab-a889-79476e2dbea7-1"><p>å¯ä»¥<code>é¢„å…ˆç¡®å®šè¦æ’å…¥çš„è¡Œæ•°</code>ï¼ˆå½“è¯­å¥è¢«åˆå§‹å¤„ç†æ—¶ï¼‰çš„è¯­å¥ã€‚åŒ…æ‹¬æ²¡æœ‰åµŒå¥—å­æŸ¥è¯¢çš„å•è¡Œå’Œå¤šè¡Œ<code>INSERT...VALUES()</code>å’Œ<code>REPLACE</code>è¯­å¥ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­å°±å±äºè¯¥ç±»æ’å…¥ï¼Œå·²ç»ç¡®å®šè¦æ’å…¥çš„è¡Œ æ•°ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4434cedb-9dd6-40ab-a889-79476e2dbea7-2"><p><code>äº‹å…ˆä¸çŸ¥é“è¦æ’å…¥çš„è¡Œæ•°</code>ï¼ˆå’Œæ‰€éœ€è‡ªåŠ¨é€’å¢å€¼çš„æ•°é‡ï¼‰çš„è¯­å¥ã€‚æ¯”å¦‚<code>INSERT ... SELECT</code>ï¼Œ<code>REPLACE ... SELECT</code>å’Œ<code>LOAD DATA</code>è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬çº¯INSERTã€‚ InnoDBåœ¨æ¯å¤„ç†ä¸€è¡Œï¼Œä¸ºAUTO_INCREMENTåˆ—</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4434cedb-9dd6-40ab-a889-79476e2dbea7-3"><p>è¿™äº›æ˜¯â€œSimple insertsâ€è¯­å¥ä½†æ˜¯æŒ‡å®šéƒ¨åˆ†æ–°è¡Œçš„è‡ªåŠ¨é€’å¢å€¼ã€‚ä¾‹å¦‚<code>INSERT INTO teacher (id,name) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');</code>åªæ˜¯æŒ‡å®šäº†éƒ¨åˆ†idçš„å€¼ã€‚å¦ä¸€ç§ç±»å‹çš„â€œæ··åˆæ¨¡å¼æ’å…¥â€æ˜¯<code>INSERT ... ON DUPLICATE KEY UPDATE</code>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>å¯¹äºä¸Šé¢æ•°æ®æ’å…¥çš„æ¡ˆä¾‹ï¼ŒMysQLä¸­é‡‡ç”¨äº†<code>è‡ªå¢é”</code>çš„æ–¹å¼æ¥å®ç°ï¼Œ<span class='p red'>AUTO-INCé”æ˜¯å½“å‘ä½¿ç”¨å«æœ‰AUTO_INCREMENT åˆ—çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶éœ€è¦è·å–çš„ä¸€ç§ç‰¹æ®Šçš„è¡¨çº§é”</span>ï¼Œåœ¨æ‰§è¡Œæ’å…¥è¯­å¥æ—¶å°±åœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªAUTO-INCé”ï¼Œç„¶åä¸ºæ¯æ¡å¾…æ’å…¥è®°å½•çš„AUTO_INCREMENTä¿®é¥°çš„åˆ—åˆ†é…é€’å¢çš„å€¼ï¼Œåœ¨è¯¥è¯­å¥æ‰§è¡Œç»“æŸåï¼Œå†æŠŠAUTO-INCé”é‡Šæ”¾æ‰ã€‚<span class='p red'>ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰AUTO-INCé”çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„æ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡</span>ï¼Œå¯ä»¥ä¿è¯ä¸€ä¸ªè¯­å¥ä¸­åˆ†é…çš„é€’å¢å€¼æ˜¯è¿ç»­çš„ã€‚ä¹Ÿæ­£å› ä¸ºæ­¤ï¼Œå…¶å¹¶å‘æ€§æ˜¾ç„¶å¹¶ä¸é«˜ï¼Œå½“æˆ‘ä»¬å‘ä¸€ä¸ªæœ‰AUTO_INCREMENTå…³é”®å­—çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦å¯¹è¿™ä¸ªè¡¨é”è¿›è¡Œç«äº‰ï¼Œè¿™æ ·çš„å¹¶å‘æ½œåŠ›å…¶å®æ˜¯å¾ˆä½ä¸‹çš„ï¼Œæ‰€ä»¥innodbé€šè¿‡<code>innodb_autoinc-lock-mode</code>çš„ä¸åŒå–å€¼æ¥æä¾›ä¸åŒçš„é”å®šæœºåˆ¶ï¼Œæ¥æ˜¾è‘—æé«˜SQLè¯­å¥çš„å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ã€‚</p><p>innodb_autoinc_lock_modeæœ‰ä¸‰ç§å–å€¼ï¼Œåˆ†åˆ«å¯¹åº”ä¸ä¸åŒé”å®šæ¨¡å¼ï¼š</p><div class="tabs" id="651b2759-d9b3-4f0d-a0dd-ea3da71236e5"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#651b2759-d9b3-4f0d-a0dd-ea3da71236e5-1"><i class="fas fa-award"></i>0(â€œä¼ ç»Ÿâ€é”å®šæ¨¡å¼)</button></li><li class="tab"><button type="button" data-href="#651b2759-d9b3-4f0d-a0dd-ea3da71236e5-2"><i class="fas fa-baseball-ball"></i>1(â€œè¿ç»­â€é”å®šæ¨¡å¼)</button></li><li class="tab"><button type="button" data-href="#651b2759-d9b3-4f0d-a0dd-ea3da71236e5-3"><i class="fas fa-bone"></i>2(â€œäº¤é”™â€é”å®šæ¨¡å¼)</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="651b2759-d9b3-4f0d-a0dd-ea3da71236e5-1"><p>åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç±»å‹çš„insertè¯­å¥éƒ½ä¼šè·å¾—ä¸€ä¸ªç‰¹æ®Šçš„è¡¨çº§AUTO-INCé”ï¼Œç”¨äºæ’å…¥å…·æœ‰ AUTO_INCREMENTåˆ—çš„è¡¨ã€‚è¿™ç§æ¨¡å¼å…¶å®å°±å¦‚æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ï¼Œå³æ¯å½“æ‰§è¡Œinsertçš„æ—¶å€™ï¼Œéƒ½ä¼šå¾—åˆ°ä¸€ä¸ª è¡¨çº§é”(AUTO-INCé”)ï¼Œä½¿å¾—è¯­å¥ä¸­ç”Ÿæˆçš„auto_incrementä¸ºé¡ºåºï¼Œä¸”åœ¨binlogä¸­é‡æ”¾çš„æ—¶å€™ï¼Œå¯ä»¥ä¿è¯ masterä¸slaveä¸­æ•°æ®çš„auto_incrementæ˜¯ç›¸åŒçš„ã€‚å› ä¸ºæ˜¯è¡¨çº§é”ï¼Œå½“åœ¨åŒä¸€æ—¶é—´å¤šä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œinsertçš„ æ—¶å€™ï¼Œå¯¹äºAUTO-INCé”çš„äº‰å¤ºä¼š<code>é™åˆ¶å¹¶å‘</code>èƒ½åŠ›ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="651b2759-d9b3-4f0d-a0dd-ea3da71236e5-2"><p>åœ¨ MySQL 8.0 ä¹‹å‰ï¼Œè¿ç»­é”å®šæ¨¡å¼æ˜¯<code>é»˜è®¤</code>çš„ã€‚</p><p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œâ€œbulk insertsâ€ä»ç„¶ä½¿ç”¨AUTO-INCè¡¨çº§é”ï¼Œå¹¶ä¿æŒåˆ°è¯­å¥ç»“æŸã€‚è¿™é€‚ç”¨äºæ‰€æœ‰INSERT â€¦ SELECTï¼ŒREPLACE â€¦ SELECTå’ŒLOAD DATAè¯­å¥ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¯­å¥å¯ä»¥æŒæœ‰AUTO-INCé”ã€‚</p><p>å¯¹äºâ€œSimple insertsâ€ï¼ˆè¦æ’å…¥çš„è¡Œæ•°äº‹å…ˆå·²çŸ¥ï¼‰ï¼Œåˆ™é€šè¿‡åœ¨<code>mutexï¼ˆè½»é‡é”ï¼‰</code>çš„æ§åˆ¶ä¸‹è·å¾—æ‰€éœ€æ•°é‡çš„è‡ªåŠ¨é€’å¢å€¼æ¥é¿å…è¡¨çº§AUTO-INCé”ï¼Œ å®ƒåªåœ¨åˆ†é…è¿‡ç¨‹çš„æŒç»­æ—¶é—´å†…ä¿æŒï¼Œè€Œä¸æ˜¯ç›´åˆ°è¯­å¥å®Œæˆã€‚ä¸ä½¿ç”¨è¡¨çº§AUTO-INCé”ï¼Œé™¤éAUTO-INCé”ç”±å¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒã€‚å¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒAUTO-INCé”ï¼Œåˆ™â€œSimple insertsâ€ç­‰å¾…AUTO-INCé”ï¼Œå¦‚åŒå®ƒæ˜¯ä¸€ä¸ªâ€œbulk insertsâ€ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="651b2759-d9b3-4f0d-a0dd-ea3da71236e5-3"><p>ä» MySQL 8.0 å¼€å§‹ï¼Œäº¤é”™é”æ¨¡å¼æ˜¯<code>é»˜è®¤</code>è®¾ç½®ã€‚</p><p>åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œè‡ªåŠ¨é€’å¢å€¼<code>ä¿è¯</code>åœ¨æ‰€æœ‰å¹¶å‘æ‰§è¡Œçš„æ‰€æœ‰ç±»å‹çš„insertè¯­å¥ä¸­æ˜¯<code>å”¯ä¸€</code>ä¸”<code>å•è°ƒé€’å¢</code>çš„ã€‚ä½†æ˜¯ï¼Œç”±äºå¤šä¸ªè¯­å¥å¯ä»¥åŒæ—¶ç”Ÿæˆæ•°å­—ï¼ˆå³ï¼Œè·¨è¯­å¥äº¤å‰ç¼–å·ï¼‰ï¼Œä¸ºä»»ä½•ç»™å®šè¯­å¥æ’å…¥çš„è¡Œç”Ÿæˆçš„å€¼å¯èƒ½ä¸æ˜¯è¿ç»­çš„ã€‚</p><p>å¦‚æœæ‰§è¡Œçš„è¯­å¥æ˜¯â€œsimple inserts&quot;ï¼Œå…¶ä¸­è¦æ’å…¥çš„è¡Œæ•°å·²æå‰çŸ¥é“ï¼Œé™¤äº†&quot;Mixed-mode inserts&quot;ä¹‹å¤–ï¼Œä¸ºå•ä¸ªè¯­å¥ç”Ÿæˆçš„æ•°å­—ä¸ä¼šæœ‰é—´éš™ã€‚ç„¶åï¼Œå½“æ‰§è¡Œ&quot;bulk inserts&quot;æ—¶ï¼Œåœ¨ç”±ä»»ä½•ç»™å®šè¯­å¥åˆ†é…çš„è‡ªåŠ¨é€’å¢å€¼ä¸­å¯èƒ½å­˜åœ¨é—´éš™ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h4 id="4-1-4-å…ƒæ•°æ®é”-MDLé”">4.1.4 å…ƒæ•°æ®é”(MDLé”)</h4><p>MySQL5.5å¼•å…¥äº†meta data lockï¼Œç®€ç§°MDLé”ï¼Œå±äºè¡¨é”èŒƒç•´ã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ª<code>è¡¨ç»“æ„åšå˜æ›´</code>ï¼Œå¢åŠ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p><p>å› æ­¤ï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é”ã€‚</p><p>è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æŸ¥æ”¹ã€‚è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´éƒ½æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ï¼Œè§£å†³äº†DMLå’ŒDDLæ“ä½œä¹‹é—´çš„ä¸€è‡´æ€§é—®é¢˜ã€‚<code>ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨</code>ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚</p><p>ä¸¾ä¾‹ï¼šå…ƒæ•°æ®é”çš„ä½¿ç”¨åœºæ™¯æ¨¡æ‹Ÿ</p><p>ä¼šè¯Aï¼šä»è¡¨ä¸­æŸ¥è¯¢æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">BEGIN</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> teacher;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="type">int</span> <span class="keyword">set</span> (<span class="number">7.46</span> sec)</span><br></pre></td></tr></table></figure><p>ä¼šè¯Bï¼šä¿®æ”¹è¡¨ç»“æ„ï¼Œå¢åŠ æ–°åˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">BEGIN</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">add</span> age <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p>ä¼šè¯Cï¼šæŸ¥çœ‹å½“å‰MySQLçš„è¿›ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> processlist;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713142808924.png" alt="image-20220713142808924"></p><p>é€šè¿‡ä¼šè¯Cå¯ä»¥çœ‹å‡ºä¼šè¯Bè¢«é˜»å¡ï¼Œè¿™æ˜¯ç”±äºä¼šè¯Aæ‹¿åˆ°äº†teacherè¡¨çš„å…ƒæ•°æ®è¯»é”ï¼Œä¼šè¯Bæƒ³ç”³è¯·teacherè¡¨çš„å…ƒæ•°æ®å†™é”ï¼Œç”±äºè¯»å†™é”äº’æ–¥ï¼Œä¼šè¯Béœ€è¦ç­‰å¾…ä¼šè¯Aé‡Šæ”¾å…ƒæ•°æ®é”æ‰èƒ½æ‰§è¡Œã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713143156759.png" alt="image-20220713143156759" /><hr><h3 id="4-2-è¡Œé”ï¼ˆRow-Lockï¼‰">4.2 è¡Œé”ï¼ˆRow Lockï¼‰</h3><p>è¡Œé”ï¼ˆRow Lockï¼‰ä¹Ÿç§°ä¸ºè®°å½•é”ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é”ä½æŸä¸€è¡Œï¼ˆæŸæ¡è®°å½• rowï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQLæœåŠ¡å™¨å±‚å¹¶æ²¡æœ‰å®ç°è¡Œé”æœºåˆ¶ï¼Œ<span class='p green'>è¡Œçº§é”åªåœ¨å­˜å‚¨å¼•æ“å±‚å®ç°</span>ã€‚</p><p>ä¼˜ç‚¹ï¼šé”å®šåŠ›åº¦å°ï¼Œå‘ç”Ÿ<code>é”å†²çªæ¦‚ç‡ä½</code>ï¼Œå¯ä»¥å®ç°çš„<code>å¹¶å‘åº¦é«˜</code>ã€‚</p><p>ç¼ºç‚¹ï¼šå¯¹äº<code>é”çš„å¼€é”€æ¯”è¾ƒå¤§</code>ï¼ŒåŠ é”ä¼šæ¯”è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°<code>æ­»é”</code>æƒ…å†µã€‚</p><p>InnoDBä¸MyISAMçš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼ˆTRANSACTIONï¼‰ï¼›äºŒæ˜¯é‡‡ç”¨äº†è¡Œçº§é”ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºè¡¨å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (</span><br><span class="line">  id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    class <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) Engine<span class="operator">=</span>InnoDB CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>å‘è¿™ä¸ªè¡¨é‡Œæ’å…¥å‡ æ¡è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="string">&#x27;ä¸€ç­&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;æå››&#x27;</span>, <span class="string">&#x27;ä¸€ç­&#x27;</span>),</span><br><span class="line">(<span class="number">8</span>, <span class="string">&#x27;ç‹äº”&#x27;</span>, <span class="string">&#x27;äºŒç­&#x27;</span>),</span><br><span class="line">(<span class="number">15</span>, <span class="string">&#x27;èµµå…­&#x27;</span>, <span class="string">&#x27;äºŒç­&#x27;</span>),</span><br><span class="line">(<span class="number">20</span>, <span class="string">&#x27;é’±ä¸ƒ&#x27;</span>, <span class="string">&#x27;ä¸‰ç­&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713161549241.png" alt="image-20220713161549241"  /><p>studentè¡¨ä¸­çš„èšç°‡ç´¢å¼•çš„ç®€å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713163353648.png" alt="image-20220713163353648"></p><p>è¿™é‡ŒæŠŠB+æ ‘çš„ç´¢å¼•ç»“æ„åšäº†è¶…çº§ç®€åŒ–ï¼ŒåªæŠŠç´¢å¼•ä¸­çš„è®°å½•ç»™æ‹¿äº†å‡ºæ¥ï¼Œä¸‹é¢çœ‹çœ‹éƒ½æœ‰å“ªäº›å¸¸ç”¨çš„è¡Œé”ç±»å‹ã€‚</p><hr><h4 id="4-2-1-è®°å½•é”">4.2.1 è®°å½•é”</h4><p>è®°å½•é”ä¹Ÿå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_REC_NOT_GAP</code>ã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªè®°å½•é”çš„ç¤ºæ„å›¾å¦‚æœæ‰€ç¤ºã€‚ä»…ä»…æ˜¯é”ä½äº†idå€¼ä¸º8çš„è®°å½•ï¼Œå¯¹å‘¨å›´çš„æ•°æ®æ²¡æœ‰å½±å“ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713164811567.png" alt="image-20220713164811567" style="zoom:50%;" /><p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713164948405.png" alt="image-20220713164948405" style="zoom: 50%;" /><p>è®°å½•é”æ˜¯æœ‰Sé”å’ŒXé”ä¹‹åˆ†çš„ï¼Œç§°ä¹‹ä¸º<code>Så‹è®°å½•é”</code>å’Œ<code>Xå‹è®°å½•é”</code>ã€‚</p><ul><li>å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Så‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä½†ä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ï¼›</li><li>å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Xå‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸å¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä¹Ÿä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ã€‚</li></ul><hr><h4 id="4-2-2-é—´éš™é”">4.2.2 é—´éš™é”</h4><p><code>MySQL</code>åœ¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜çš„ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œå¯ä»¥ä½¿ç”¨<code>MVCC</code>æ–¹ æ¡ˆè§£å†³ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨<code>åŠ é”</code>æ–¹æ¡ˆè§£å†³ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨åŠ é”æ–¹æ¡ˆè§£å†³æ—¶æœ‰ä¸ªå¤§é—®é¢˜ï¼Œå°±æ˜¯äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œé‚£äº›å¹»å½±è®°å½•å°šä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ— æ³•ç»™è¿™äº›<code>å¹»å½±è®°å½•</code>åŠ ä¸Š<code>è®°å½•é”</code>ã€‚InnoDBæå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º<code>Gap Locks</code>çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_GAP</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç®€ç§°ä¸º<code>gapé”</code>ã€‚æ¯”å¦‚ï¼ŒæŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªgapé”çš„ç¤ºæ„å›¾å¦‚ä¸‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713171650888.png" alt="image-20220713171650888" style="zoom:50%;" /><p>å›¾ä¸­idå€¼ä¸º8çš„è®°å½•åŠ äº†gapé”ï¼Œæ„å‘³ç€<code>ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨idå€¼ä¸º8çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½•</code>ï¼Œå…¶å®å°±æ˜¯idåˆ—çš„å€¼(3, 8)è¿™ä¸ªåŒºé—´çš„æ–°è®°å½•æ˜¯ä¸å…è®¸ç«‹å³æ’å…¥çš„ã€‚æ¯”å¦‚ï¼Œæœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡å†æƒ³æ’å…¥ä¸€æ¡idå€¼ä¸º4çš„æ–°è®°å½•ï¼Œ<span class='p green'>å®ƒå®šä½åˆ°è¯¥æ¡æ–°è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•çš„idå€¼ä¸º8ï¼Œè€Œè¿™æ¡è®°å½•ä¸Šåˆæœ‰ä¸€ä¸ªgapé”ï¼Œæ‰€ä»¥å°±ä¼šé˜»å¡æ’å…¥æ“ä½œ</span> ï¼Œç›´åˆ°æ‹¥æœ‰è¿™ä¸ªgapé”çš„äº‹åŠ¡æäº¤äº†ä¹‹åï¼Œidåˆ—çš„å€¼åœ¨åŒºé—´(3, 8)ä¸­çš„æ–°è®°å½•æ‰å¯ä»¥è¢«æ’å…¥ã€‚<span class='p red'>gapé”çš„æå‡ºä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„ã€‚</span>è™½ç„¶å…±äº«gapé”å’Œç‹¬å gapé”è¿™æ ·çš„è¯´æ³•ï¼Œä½†æ˜¯å®ƒä»¬èµ·åˆ°çš„ä½œç”¨æ˜¯ç›¸åŒçš„ã€‚è€Œä¸”å¦‚æœå¯¹ä¸€æ¡è®°å½•åŠ äº†gapé”ï¼ˆä¸è®ºæ˜¯å…±äº«gapé”è¿˜æ˜¯ç‹¬å gapé”ï¼‰ï¼Œå¹¶ä¸ä¼šé™åˆ¶å…¶ä»–äº‹åŠ¡å¯¹è¿™æ¡è®°å½•åŠ è®°å½•é”æˆ–è€…ç»§ç»­åŠ gapé”ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><table><thead><tr><th style="text-align:left">Session1</th><th>Session2</th></tr></thead><tbody><tr><td style="text-align:left">select * from student where id=5 lock in share mode;</td><td></td></tr><tr><td style="text-align:left"></td><td>select * from student where id=5 for update;</td></tr></tbody></table><p>è¿™é‡Œsession2å¹¶ä¸ä¼šè¢«å µä½ã€‚å› ä¸ºè¡¨é‡Œå¹¶æ²¡æœ‰id=5è¿™æ¡è®°å½•ï¼Œå› æ­¤session1åŠ çš„æ˜¯é—´éš™é”(3,8)ã€‚è€Œsession2ä¹Ÿæ˜¯åœ¨è¿™ä¸ªé—´éš™åŠ çš„é—´éš™é”ã€‚å®ƒä»¬æœ‰å…±åŒçš„ç›®æ ‡ï¼Œå³ï¼šä¿æŠ¤è¿™ä¸ªé—´éš™é”ï¼Œä¸å…è®¸æ’å…¥å€¼ã€‚ä½†ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä¸å†²çªçš„ã€‚<span class='p red'>(PS:è‹¥Session1å’ŒSession2éƒ½æƒ³åœ¨è¿™ä¸ªé—´éš™æ’å…¥æ•°æ®ï¼Œé‚£å°±ä¼šå‘ç”Ÿæ­»é”ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹çš„é—´éš™é”é‡Šæ”¾)</span></p><p>æ³¨æ„ï¼Œç»™ä¸€æ¡è®°å½•åŠ äº†<code>gapé”</code>åªæ˜¯<code>ä¸å…è®¸</code>å…¶ä»–äº‹åŠ¡å¾€è¿™æ¡è®°å½•å‰è¾¹çš„é—´éš™<code>æ’å…¥æ–°è®°å½•</code>ï¼Œé‚£å¯¹äºæœ€åä¸€æ¡è®°å½•ä¹‹åçš„é—´éš™ï¼Œä¹Ÿå°±æ˜¯student è¡¨ä¸­idå€¼ä¸º<code>20</code>çš„è®°å½•ä¹‹åçš„é—´éš™è¯¥å’‹åŠå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ç»™å“ªæ¡è®°å½•åŠ <code>gapé”</code>æ‰èƒ½é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥<code>id</code>å€¼åœ¨<code>(20ï¼Œ+âˆï¼‰</code>è¿™ä¸ªåŒºé—´çš„æ–°è®°å½•å‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘ä»¬åœ¨è®²æ•°æ®é¡µæ—¶ä»‹ç»çš„ä¸¤æ¡ä¼ªè®°å½•æ´¾ä¸Šç”¨åœºäº†ï¼š</p><p>*<code>Infimum</code>è®°å½•ï¼Œè¡¨ç¤ºè¯¥é¡µé¢ä¸­æœ€å°çš„è®°å½•ã€‚<br>*<code>Supremun</code>è®°å½•ï¼Œè¡¨ç¤ºè¯¥é¡µé¢ä¸­æœ€å¤§çš„è®°å½•ã€‚</p><p>ä¸ºäº†å®ç°é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥idå€¼å†(20,æ­£æ— ç©·)è¿™ä¸ªåŒºé—´çš„æ–°çºªå½•ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç´¢å¼•ä¸­çš„æœ€åä¸€æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯idå€¼ä¸º20çš„é‚£æ¡è®°å½•æ‰€åœ¨é¡µé¢çš„Supremunè®°å½•åŠ  ä¸Šä¸€ä¸ªgapé”ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713174108634.png" alt="image-20220713174108634" style="zoom:50%;" /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">20</span> lock <span class="keyword">in</span> share mode;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>æ£€æµ‹ï¼š</p><div class="fj-gallery"><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414220905714.png" alt="image-20230414220905714"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414220939203.png" alt="image-20230414220939203"></p>          </div><p>è¿™æ ·å°±å¯ä»¥é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥idå€¼åœ¨(20ï¼Œ+âˆ)è¿™ä¸ªåŒºé—´çš„æ–°è®°å½•ã€‚</p><p>é—´éš™é”çš„å¼•å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œè¿™å…¶å®æ˜¯å½±å“äº†å¹¶å‘åº¦çš„ã€‚ä¸‹é¢çš„ä¾‹å­ä¼šäº§ç”Ÿ<code>æ­»é”</code></p><table><thead><tr><th>Session1</th><th>Session2</th></tr></thead><tbody><tr><td>begin;<br/>select * from student where id = 5 for update;</td><td>begin;<br/>select * from student where id 5 for update;</td></tr><tr><td></td><td>INSERT INTO student VALUES (5, â€˜å®‹çº¢åº·â€™ï¼Œ'â€˜äºŒç­â€™);é˜»å¡</td></tr><tr><td>INSERT INTO student VALUES (5,â€˜å®‹çº¢åº·â€™ï¼Œâ€˜äºŒç­â€™ï¼‰; <br/> (ERROR 1213 (40001): Deadlock found when trying to get lock;try restarting transaction)</td><td></td></tr></tbody></table><p>(1) session 1æ‰§è¡Œ selectâ€¦ for update è¯­å¥ï¼Œç”±äºid=5è¿™ä¸€è¡Œå¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤ä¼šåŠ ä¸Šé—´éš™é”(3, 8)ï¼›</p><p>(2) session 2 æ‰§è¡Œ selectâ€¦ for update è¯­å¥ï¼ŒåŒæ ·ä¼šåŠ ä¸Šé—´éš™é”ï¼ˆ3ï¼Œ8)ï¼Œé—´éš™é”ä¹‹é—´ä¸ä¼šå†²çªï¼Œå› æ­¤è¿™ä¸ªè¯­å¥å¯ä»¥æ‰§è¡ŒæˆåŠŸ</p><p>(3) session 2 è¯•å›¾æ’å…¥ä¸€è¡Œ(5,â€˜å®‹çº¢åº·â€™ï¼Œâ€˜äºŒç­â€™ï¼‰ï¼Œè¢« session 1 çš„é—´éš™é”æŒ¡ä½äº†ï¼Œåªå¥½è¿›å…¥ç­‰å¾…ï¼›</p><p>(4) session 1 è¯•å›¾æ’å…¥ä¸€è¡Œ(5,â€˜å®‹çº¢åº·â€™ï¼Œâ€˜äºŒç­â€™ï¼‰ï¼Œè¢« session 2 çš„é—´éš™é”æŒ¡ä½äº†ã€‚è‡³æ­¤ï¼Œä¸¤ä¸ª session è¿›å…¥äº’ç›¸ç­‰å¾…çŠ¶æ€ï¼Œå½¢æˆæ­»é”ã€‚å½“ç„¶ï¼ŒInnoDB çš„æ­»é”æ£€æµ‹é©¬ä¸Šå°±å‘ç°äº†è¿™å¯¹æ­»é”å…³ç³»ï¼Œè®© session 1 çš„ insert è¯­å¥æŠ¥é”™è¿”å›ã€‚</p><hr><h4 id="4-2-3-ä¸´é”®é”">4.2.3 ä¸´é”®é”</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬æ—¢æƒ³<code>é”ä½æŸæ¡è®°å½•</code>ï¼Œåˆæƒ³é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ï¼Œæ‰€ä»¥InnoDBå°±æå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º Next-Key Locks çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š LOCK_ORDINARY ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€ç§°ä¸º next-keyé” ã€‚Next-Key Locksæ˜¯åœ¨å­˜å‚¨å¼•æ“ innodb ã€äº‹åŠ¡çº§åˆ«åœ¨ å¯é‡å¤è¯» çš„æƒ…å†µä¸‹ä½¿ç”¨çš„æ•°æ®åº“é”ï¼Œ <span class='p green'>innodbé»˜è®¤çš„é”å°±æ˜¯Next-Key locksã€‚</span>æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªnext-keyé”çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713192549340.png" alt="image-20220713192549340" style="zoom:50%;" /><p><code>next-keyé”</code>çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª<code>è®°å½•é”</code>å’Œä¸€ä¸ª<code>gapé”</code>çš„åˆä½“ï¼Œå®ƒæ—¢èƒ½ä¿æŠ¤è¯¥æ¡è®°å½•ï¼Œåˆèƒ½é˜»æ­¢åˆ«çš„äº‹åŠ¡å°†æ–°è®°å½•æ’å…¥è¢«ä¿æŠ¤è®°å½•å‰è¾¹çš„<code>é—´éš™</code>ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&lt;=</span><span class="number">8</span> <span class="keyword">and</span> id <span class="operator">&gt;</span> <span class="number">3</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure><hr><h4 id="4-2-4-æ’å…¥æ„å‘é”">4.2.4 æ’å…¥æ„å‘é”</h4><p>æˆ‘ä»¬è¯´ä¸€ä¸ªäº‹åŠ¡åœ¨<code>æ’å…¥</code>ä¸€æ¡è®°å½•æ—¶éœ€è¦åˆ¤æ–­ä¸€ä¸‹æ’å…¥ä½ç½®æ˜¯ä¸æ˜¯è¢«åˆ«çš„äº‹åŠ¡åŠ äº†<code>gapé”</code>(<code>next-keyé”</code>ä¹ŸåŒ…å«<code>gapé”</code>ï¼‰ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œæ’å…¥æ“ä½œéœ€è¦ç­‰å¾…ï¼Œç›´åˆ°æ‹¥æœ‰ gapé”çš„é‚£ä¸ªäº‹åŠ¡æäº¤ã€‚ä½†æ˜¯<span class='p red'>InnoDBè§„å®šäº‹åŠ¡åœ¨ç­‰å¾…çš„æ—¶å€™ä¹Ÿéœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªé”ç»“æ„</span>ï¼Œè¡¨æ˜æœ‰äº‹åŠ¡æƒ³åœ¨æŸä¸ª<code>é—´éš™</code>ä¸­<code>æ’å…¥</code>æ–°è®°å½•ï¼Œä½†æ˜¯ç°åœ¨åœ¨ç­‰å¾…ã€‚InnoDBå°±æŠŠè¿™ç§ç±»å‹çš„é”å‘½åä¸º<code>Insert Intention Locks</code>ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_INSERT_INTENTION</code>ï¼Œæˆ‘ä»¬ç§°ä¸º<code>æ’å…¥æ„å‘é”</code>ã€‚æ’å…¥æ„å‘é”æ˜¯ä¸€ç§<code>Gapé”</code>ï¼Œä¸æ˜¯æ„å‘é”ï¼Œåœ¨insertæ“ä½œæ—¶äº§ç”Ÿã€‚</p><p>æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”±<code>INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”</code>ã€‚è¯¥é”ç”¨ä»¥è¡¨ç¤ºæ’å…¥æ„å‘ï¼Œå½“å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€åŒºé—´ï¼ˆgap)æ’å…¥ä½ç½®ä¸åŒçš„å¤šæ¡æ•°æ®æ—¶ï¼Œäº‹åŠ¡ä¹‹é—´ä¸éœ€è¦äº’ç›¸ç­‰å¾…ã€‚å‡è®¾å­˜åœ¨ä¸¤æ¡å€¼åˆ†åˆ«ä¸º4å’Œ7çš„è®°å½•ï¼Œä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡åˆ†åˆ«è¯•å›¾æ’å…¥å€¼ä¸º5å’Œ6çš„ä¸¤æ¡è®°å½•ï¼Œæ¯ä¸ªäº‹åŠ¡åœ¨è·å–æ’å…¥è¡Œä¸Šç‹¬å çš„ï¼ˆæ’ä»–ï¼‰é”å‰ï¼Œéƒ½ä¼šè·å–ï¼ˆ4ï¼Œ7ï¼‰ä¹‹é—´çš„é—´éš™é”ï¼Œä½†æ˜¯å› ä¸ºæ•°æ®è¡Œä¹‹é—´å¹¶<code>ä¸å†²çª</code>ï¼Œæ‰€ä»¥ä¸¤ä¸ªäº‹åŠ¡ä¹‹é—´å¹¶ä¸ä¼šäº§ç”Ÿå†²çªï¼ˆé˜»å¡ç­‰å¾…ï¼‰ï¼Œ æ€»ç»“æ¥è¯´ï¼Œæ’å…¥æ„å‘é”çš„ç‰¹æ€§å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†ï¼š</p><p>(1ï¼‰æ’å…¥æ„å‘é”æ˜¯ä¸€ç§<code>ç‰¹æ®Šçš„é—´éš™é”</code>â€”é—´éš™é”å¯ä»¥é”å®šå¼€åŒºé—´å†…çš„éƒ¨åˆ†è®°å½•ã€‚</p><p>(2) æ’å…¥æ„å‘é”ä¹‹é—´<code>äº’ä¸æ’æ–¥</code>ï¼Œæ‰€ä»¥å³ä½¿å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€åŒºé—´æ’å…¥å¤šæ¡è®°å½•ï¼Œåªè¦è®°å½•æœ¬èº«ï¼ˆä¸»é”®ã€å”¯ä¸€ç´¢å¼•ï¼‰ä¸å†²çªï¼Œé‚£ä¹ˆäº‹åŠ¡ä¹‹é—®å°±ä¸ä¼šå‡ºç°å†²çªç­‰å¾…ã€‚</p><p>æ³¨æ„ï¼Œè™½ç„¶æ’å…¥æ„å‘é”ä¸­å«æœ‰æ„å‘é”ä¸‰ä¸ªå­—ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å±äºæ„å‘é”è€Œå±äºé—´éš™é”ï¼Œå› ä¸ºæ„å‘é”æ˜¯è¡¨é”è€Œæ’å…¥æ„å‘é”æ˜¯<code>è¡Œé”</code>ã€‚</p><div class="fj-gallery"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713203532124.png" alt="image-20220713203532124"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713203619704.png" alt="image-20220713203619704" />          </div><hr><h3 id="4-3-é¡µé”ï¼ˆPage-Lockï¼‰">4.3 é¡µé”ï¼ˆPage Lockï¼‰</h3><p>é¡µé”å°±æ˜¯åœ¨<code>é¡µçš„ç²’åº¦</code>ä¸Šè¿›è¡Œé”å®šï¼Œé”å®šçš„æ•°æ®èµ„æºæ¯”è¡Œé”è¦å¤šï¼Œå› ä¸ºä¸€ä¸ªé¡µä¸­å¯ä»¥æœ‰å¤šä¸ªè¡Œè®°å½•ã€‚å½“æˆ‘ ä»¬ä½¿ç”¨é¡µé”çš„æ—¶å€™ï¼Œä¼šå‡ºç°æ•°æ®æµªè´¹çš„ç°è±¡ï¼Œä½†è¿™æ ·çš„æµªè´¹æœ€å¤šä¹Ÿå°±æ˜¯ä¸€ä¸ªé¡µä¸Šçš„æ•°æ®è¡Œã€‚<span class='p green'>é¡µé”çš„å¼€é”€ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œä¼šå‡ºç°æ­»é”ã€‚é”å®šç²’åº¦ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚</span></p><p>æ¯ä¸ªå±‚çº§çš„é”æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œå› ä¸ºé”ä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œ<code>é”ç©ºé—´çš„å¤§å°æ˜¯æœ‰é™çš„</code>ã€‚å½“æŸä¸ªå±‚çº§çš„é”æ•°é‡ è¶…è¿‡äº†è¿™ä¸ªå±‚çº§çš„é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ<code>é”å‡çº§</code>ã€‚é”å‡çº§å°±æ˜¯ç”¨æ›´å¤§ç²’åº¦çš„é”æ›¿ä»£å¤šä¸ªæ›´å°ç²’åº¦çš„é”ï¼Œæ¯”å¦‚ InnoDB ä¸­è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å ç”¨çš„é”ç©ºé—´é™ä½äº†ï¼Œä½†åŒæ—¶æ•°æ®çš„å¹¶å‘åº¦ä¹Ÿä¸‹é™äº†ã€‚</p><hr><h2 id="5-ä¹è§‚é”-æ‚²è§‚é”">5. ä¹è§‚é”/æ‚²è§‚é”</h2><mark class="hl-label green">ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†:ä¹è§‚é”ã€æ‚²è§‚é”</mark> <p>ä»å¯¹å¾…é”çš„æ€åº¦æ¥çœ‹é”çš„è¯ï¼Œå¯ä»¥å°†é”åˆ†æˆä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œä»åå­—ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸¤ç§é”æ˜¯ä¸¤ç§çœ‹å¾…<code>æ•°æ®å¹¶å‘çš„æ€ç»´æ–¹å¼</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”å’Œæ‚²è§‚é”å¹¶ä¸æ˜¯é”ï¼Œè€Œæ˜¯é”çš„<code>è®¾è®¡æ€æƒ³</code>ã€‚</p><h3 id="5-1-æ‚²è§‚é”-Pessimistic-Locking">5.1 æ‚²è§‚é”(Pessimistic Locking)</h3><p>æ‚²è§‚é”æ˜¯ä¸€ç§æ€æƒ³ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œå¯¹æ•°æ®è¢«å…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹æŒä¿å®ˆæ€åº¦ï¼Œä¼šé€šè¿‡æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶æ¥å®ç°ï¼Œä»è€Œä¿è¯æ•°æ®æ“ä½œçš„æ’å®ƒæ€§ã€‚</p><p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š<code>é˜»å¡</code>ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œ ç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚æ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ï¼Œå½“å…¶ä»–çº¿ç¨‹æƒ³è¦è®¿é—®æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦é˜»å¡æŒ‚èµ·ã€‚Javaä¸­<code>synchronized</code>å’Œ<code>ReentrantLock</code>ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p><p><strong>ç§’æ€æ¡ˆä¾‹1ï¼š</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713204544767.png" alt="image-20220713204544767"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713205010502.png" alt="image-20220713205010502"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713205135694.png" alt="image-20220713205135694"  /><hr><h3 id="5-2-ä¹è§‚é”-Optimistic-Locking">5.2 ä¹è§‚é”(Optimistic Locking)</h3><p>ä¹è§‚é”è®¤ä¸ºå¯¹åŒä¸€æ•°æ®çš„å¹¶å‘æ“ä½œä¸ä¼šæ€»å‘ç”Ÿï¼Œå±äºå°æ¦‚ç‡äº‹ä»¶ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œä¹Ÿå°±æ˜¯<span class='p green'>ä¸é‡‡ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶</span>ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºæ¥å®ç°ã€‚åœ¨ç¨‹åºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>ç‰ˆæœ¬å·æœºåˆ¶</code>æˆ–è€…<code>CASæœºåˆ¶</code>å®ç°ã€‚<span class='p green'>ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡</span>ã€‚åœ¨Javaä¸­<code>java.util.concurrent.atomic</code>åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼šCASå®ç°çš„ã€‚</p><mark class="hl-label pink">1.ä¹è§‚é”çš„ç‰ˆæœ¬å·æœºåˆ¶</mark> <p>åœ¨è¡¨ä¸­è®¾è®¡ä¸€ä¸ª<code>ç‰ˆæœ¬å­—æ®µ version</code>ï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™ï¼Œä¼šè·å– version å­—æ®µçš„å–å€¼ã€‚ç„¶åå¯¹æ•°æ®è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ï¼Œä¼šæ‰§è¡Œ<code>UPDATE ... SET version=version+1 WHERE version=version</code>ã€‚æ­¤æ—¶ å¦‚æœå·²ç»æœ‰äº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œäº†æ›´æ”¹ï¼Œä¿®æ”¹å°±ä¸ä¼šæˆåŠŸã€‚</p><p>è¿™ç§æ–¹å¼ç±»ä¼¼æˆ‘ä»¬ç†Ÿæ‚‰çš„SVNã€CVSç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†ä»£ç è¿›è¡Œæäº¤æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥å½“å‰ç‰ˆæœ¬å·ä¸æœåŠ¡å™¨ä¸Šçš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´å°±å¯ä»¥ç›´æ¥æäº¤ï¼Œå¦‚æœä¸ä¸€è‡´å°±éœ€è¦æ›´æ–°æœåŠ¡å™¨ä¸Šçš„æœ€æ–°ä»£ç ï¼Œç„¶åå†è¿›è¡Œæäº¤ã€‚</p><mark class="hl-label pink">2.ä¹è§‚é”çš„æ—¶é—´æˆ³æœºåˆ¶</mark> <p>æ—¶é—´æˆ³å’Œç‰ˆæœ¬å·æœºåˆ¶ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™ï¼Œå°†å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å’Œæ›´æ–°ä¹‹å‰å–å¾—çš„æ—¶é—´æˆ³è¿›è¡Œ æ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ä¸€è‡´åˆ™æ›´æ–°æˆåŠŸï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚</p><p>ä½ èƒ½çœ‹åˆ°ä¹è§‚é”å°±æ˜¯ç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•°æ®å¹¶å‘æ“ä½œçš„æƒé™ï¼ŒåŸºæœ¬æ˜¯é€šè¿‡ç»™æ•°æ®è¡Œå¢åŠ ä¸€ä¸ªæˆ³ï¼ˆç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ï¼‰ï¼Œä»è€Œè¯æ˜å½“å‰æ‹¿åˆ°çš„æ•°æ®æ˜¯å¦æœ€æ–°ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713210951100.png" alt="image-20220713210951100"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713211139670.png" alt="image-20220713211139670"  /><hr><h3 id="5-3-ä¸¤ç§é”çš„é€‚ç”¨åœºæ™¯">5.3 ä¸¤ç§é”çš„é€‚ç”¨åœºæ™¯</h3><p>ä»è¿™ä¸¤ç§é”çš„è®¾è®¡æ€æƒ³ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”çš„é€‚ç”¨åœºæ™¯ï¼š</p><p>1.<code>ä¹è§‚é”</code>é€‚åˆ<code>è¯»æ“ä½œå¤š</code>çš„åœºæ™¯ï¼Œç›¸å¯¹æ¥è¯´å†™çš„æ“ä½œæ¯”è¾ƒå°‘ã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äº<code>ç¨‹åºå®ç°</code>ï¼Œ<code>ä¸å­˜åœ¨æ­»é”</code>é—®é¢˜ï¼Œä¸è¿‡é€‚ç”¨åœºæ™¯ä¹Ÿä¼šç›¸å¯¹ä¹è§‚ï¼Œå› ä¸ºå®ƒé˜»æ­¢ä¸äº†é™¤äº†ç¨‹åºä»¥å¤–çš„æ•°æ®åº“æ“ä½œã€‚<br>2.<code>æ‚²è§‚é”</code>é€‚åˆ<code>å†™æ“ä½œå¤š</code>çš„åœºæ™¯ï¼Œå› ä¸ºå†™çš„æ“ä½œå…·æœ‰<code>æ’å®ƒæ€§</code>ã€‚é‡‡ç”¨æ‚²è§‚é”çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨æ•°æ®åº“å±‚ é¢é˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥æ•°æ®çš„æ“ä½œæƒé™ï¼Œé˜²æ­¢<code>è¯» - å†™</code>å’Œ<code>å†™ - å†™</code>çš„å†²çªã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713211417909.png" alt="image-20220713211417909" /><hr><h2 id="6-æ˜¾å¼é”-éšå¼é”">6. æ˜¾å¼é”/éšå¼é”</h2><mark class="hl-label green">æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†ï¼šæ˜¾å¼é”ã€éšå¼é”</mark> <h3 id="6-1-éšå¼é”">6.1 éšå¼é”</h3><p>ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œ<code>INSERT</code>æ“ä½œæ—¶ï¼Œå¦‚æœå³å°†æ’å…¥çš„<code>é—´éš™</code>å·²ç»è¢«å…¶ä»–äº‹åŠ¡åŠ äº†<code>gapé”</code>ï¼Œé‚£ä¹ˆæœ¬æ¬¡<code>INSERT</code>æ“ä½œä¼šé˜»å¡ï¼Œå¹¶ä¸”å½“å‰äº‹åŠ¡ä¼šåœ¨è¯¥é—´éš™ä¸ŠåŠ ä¸€ä¸ª<code>æ’å…¥æ„å‘é”</code>ï¼Œå¦åˆ™ä¸€èˆ¬æƒ…å†µä¸‹<code>INSERT</code>æ“ä½œæ˜¯ä¸åŠ é”çš„ã€‚é‚£å¦‚æœä¸€ä¸ªäº‹åŠ¡é¦–å…ˆæ’å…¥äº†ä¸€æ¡è®°å½•ï¼ˆæ­¤æ—¶å¹¶æ²¡æœ‰åœ¨å†…å­˜ç”Ÿäº§ä¸è¯¥è®°å½•å…³è”çš„é”ç»“æ„ï¼‰ï¼Œç„¶åå¦ä¸€ä¸ªäº‹åŠ¡ï¼š</p><ul><li><p>ç«‹å³ä½¿ç”¨<code>SELECT ... LOCK IN SHARE MODE</code>è¯­å¥è¯»å–è¿™æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¦è·å–è¿™æ¡è®°å½•çš„Sé”ï¼Œæˆ–è€…ä½¿ç”¨<code>SELECT ... FOR UPDATE</code>è¯­å¥è¯»å–è¿™æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¦è·å–è¿™æ¡è®°å½•çš„<code>Xé”</code>ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¦‚æœå…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œé‚£ä¹ˆå¯èƒ½äº§ç”Ÿè„è¯»é—®é¢˜ã€‚</p></li><li><p>ç«‹å³ä¿®æ”¹è¿™æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¦è·å–è¿™æ¡è®°å½•çš„xé”ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¦‚æœå…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œé‚£ä¹ˆå¯èƒ½äº§ç”Ÿè„å†™é—®é¢˜ã€‚</p></li></ul><p>è¿™æ—¶å€™æˆ‘ä»¬å‰è¾¹æè¿‡çš„<code>äº‹åŠ¡id</code>åˆè¦èµ·ä½œç”¨äº†ã€‚æˆ‘ä»¬æŠŠèšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•ä¸­çš„è®°å½•åˆ†å¼€çœ‹ä¸€ä¸‹ï¼š</p><ul><li><strong>æƒ…æ™¯ä¸€</strong>ï¼šå¯¹äºèšç°‡ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ‰ä¸€ä¸ª<code>trx_id</code>éšè—åˆ—ï¼Œè¯¥éšè—åˆ—è®°å½•ç€æœ€åæ”¹åŠ¨è¯¥è®°å½•çš„<code>äº‹åŠ¡ id</code>ã€‚é‚£ä¹ˆå¦‚æœåœ¨å½“å‰äº‹åŠ¡ä¸­æ–°æ’å…¥ä¸€æ¡èšç°‡ç´¢å¼•è®°å½•åï¼Œè¯¥è®°å½•çš„ trx_id éšè—åˆ—ä»£è¡¨çš„çš„å°±æ˜¯ å½“å‰äº‹åŠ¡çš„ äº‹åŠ¡id ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡æ­¤æ—¶æƒ³å¯¹è¯¥è®°å½•æ·»åŠ  Sé” æˆ–è€… Xé” æ—¶ï¼Œé¦–å…ˆä¼šçœ‹ä¸€ä¸‹è¯¥è®°å½•çš„ trx_id éšè—åˆ—ä»£è¡¨çš„äº‹åŠ¡æ˜¯å¦æ˜¯å½“å‰çš„æ´»è·ƒäº‹åŠ¡ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆå°±å¸®åŠ©å½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ª X é” ï¼ˆä¹Ÿå°±æ˜¯ä¸ºå½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ is_waiting å±æ€§æ˜¯ false ï¼‰ï¼Œç„¶åè‡ªå·±è¿›å…¥ç­‰å¾…çŠ¶æ€ ï¼ˆä¹Ÿå°±æ˜¯ä¸ºè‡ªå·±ä¹Ÿåˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ is_waiting å±æ€§æ˜¯ true ï¼‰ã€‚</li><li><strong>æƒ…æ™¯äºŒ</strong>ï¼šå¯¹äºäºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ¬èº«å¹¶æ²¡æœ‰ trx_id éšè—åˆ—ï¼Œä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•é¡µé¢çš„ Page Header éƒ¨åˆ†æœ‰ä¸€ä¸ª<code>PAGE_MAX_TRX_ID</code>å±æ€§ï¼Œè¯¥å±æ€§ä»£è¡¨å¯¹è¯¥é¡µé¢åšæ”¹åŠ¨çš„æœ€å¤§çš„<code>äº‹åŠ¡id</code>ï¼Œå¦‚ æœ PAGE_MAX_TRX_ID å±æ€§å€¼å°äºå½“å‰æœ€å°çš„æ´»è·ƒ äº‹åŠ¡id ï¼Œé‚£ä¹ˆè¯´æ˜å¯¹è¯¥é¡µé¢åšä¿®æ”¹çš„äº‹åŠ¡éƒ½å·² ç»æäº¤äº†ï¼Œå¦åˆ™å°±éœ€è¦åœ¨é¡µé¢ä¸­å®šä½åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œç„¶åå›è¡¨æ‰¾åˆ°å®ƒå¯¹åº”çš„èšç°‡ç´¢å¼•è®° å½•ï¼Œç„¶åå†é‡å¤ æƒ…æ™¯ä¸€ çš„åšæ³•ã€‚</li></ul><p>å³ï¼šä¸€ä¸ªäº‹åŠ¡å¯¹æ–°æ’å…¥çš„è®°å½•å¯ä»¥ä¸æ˜¾å¼çš„åŠ é”ï¼ˆç”Ÿæˆä¸€ä¸ªé”ç»“æ„ï¼‰ï¼Œä½†æ˜¯ç”±äº<code>äº‹åŠ¡id</code>çš„å­˜åœ¨ï¼Œç›¸å½“äºåŠ äº†ä¸€ä¸ª<code>éšå¼é”</code>ã€‚åˆ«çš„äº‹åŠ¡åœ¨å¯¹è¿™æ¡è®°å½•åŠ <code>Sé”</code>æˆ–è€…<code>Xé”</code>æ—¶ï¼Œç”±äº<code>éšå¼é”</code>çš„å­˜åœ¨ï¼Œä¼šå…ˆå¸®åŠ©å½“å‰äº‹åŠ¡ç”Ÿæˆä¸€ä¸ªé”ç»“æ„ï¼Œ ç„¶åè‡ªå·±å†ç”Ÿæˆä¸€ä¸ªé”ç»“æ„åè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚éšå¼é”æ˜¯ä¸€ç§<code>å»¶è¿ŸåŠ é”</code>çš„æœºåˆ¶ï¼Œä»è€Œæ¥å‡å°‘åŠ é”çš„æ•°é‡ã€‚</p><p>éšå¼é”åœ¨å®é™…å†…å­˜å¯¹è±¡ä¸­å¹¶ä¸å«æœ‰è¿™ä¸ªé”ä¿¡æ¯ã€‚åªæœ‰å½“äº§ç”Ÿé”ç­‰å¾…æ—¶ï¼Œéšå¼é”è½¬åŒ–ä¸ºæ˜¾å¼é”ã€‚</p><p>InnoDB çš„ insertæ“ä½œï¼Œå¯¹æ’å…¥çš„è®°å½•ä¸åŠ é”ï¼Œä½†æ˜¯æ­¤æ—¶å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå½“å‰è¯»ï¼Œç±»ä¼¼ä»¥ä¸‹çš„ç”¨ä¾‹ï¼Œsession 2 ä¼šé”ç­‰å¾… session 1ï¼Œ é‚£ä¹ˆè¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p><strong>session 1:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="number">34</span>,&quot;å‘¨å…«&quot;,&quot;äºŒç­&quot;);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><strong>session 2:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student lock <span class="keyword">in</span> share mode; #æ‰§è¡Œå®Œï¼Œå½“å‰äº‹åŠ¡è¢«é˜»å¡</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹è¿°è¯­å¥ï¼Œè¾“å‡ºç»“æœï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.data_lock_waits\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">              ENGINE: INNODB</span><br><span class="line">   REQUESTING_ENGINE_LOCK_ID: <span class="number">140562531358232</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">9</span>:<span class="number">140562535668584</span></span><br><span class="line">REQUESTING_ENGINE_TRANSACTION_ID: <span class="number">422037508068888</span></span><br><span class="line">      REQUESTING_THREAD_ID: <span class="number">64</span></span><br><span class="line">       REQUESTING_EVENT_ID: <span class="number">6</span></span><br><span class="line">REQUESTING_OBJECT_INSTANCE_BEGIN: <span class="number">140562535668584</span></span><br><span class="line">     BLOCKING_ENGINE_LOCK_ID: <span class="number">140562531351768</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">9</span>:<span class="number">140562535619104</span></span><br><span class="line">  BLOCKING_ENGINE_TRANSACTION_ID: <span class="number">15902</span></span><br><span class="line">        BLOCKING_THREAD_ID: <span class="number">64</span></span><br><span class="line">         BLOCKING_EVENT_ID: <span class="number">6</span></span><br><span class="line">  BLOCKING_OBJECT_INSTANCE_BEGIN: <span class="number">140562535619104</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>éšå¼é”çš„é€»è¾‘è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>A. InnoDBçš„æ¯æ¡è®°å½•ä¸­éƒ½ä¸€ä¸ªéšå«çš„trx_idå­—æ®µï¼Œè¿™ä¸ªå­—æ®µå­˜åœ¨äºèšç°‡ç´¢å¼•çš„B+Treeä¸­ã€‚</p><p>B. åœ¨æ“ä½œä¸€æ¡è®°å½•å‰ï¼Œé¦–å…ˆæ ¹æ®è®°å½•ä¸­çš„trx_idæ£€æŸ¥è¯¥äº‹åŠ¡æ˜¯å¦æ˜¯æ´»åŠ¨çš„äº‹åŠ¡(æœªæäº¤æˆ–å›æ»š)ã€‚å¦‚æœæ˜¯æ´»åŠ¨çš„äº‹åŠ¡ï¼Œé¦–å…ˆå°†<code>éšå¼é”</code>è½¬æ¢ä¸º<code>æ˜¾å¼é”</code>(å°±æ˜¯ä¸ºè¯¥äº‹åŠ¡æ·»åŠ ä¸€ä¸ªé”)ã€‚</p><p>C. æ£€æŸ¥æ˜¯å¦æœ‰é”å†²çªï¼Œå¦‚æœæœ‰å†²çªï¼Œåˆ›å»ºé”ï¼Œå¹¶è®¾ç½®ä¸ºwaitingçŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰å†²çªä¸åŠ é”ï¼Œè·³åˆ°Eã€‚</p><p>D. ç­‰å¾…åŠ é”æˆåŠŸï¼Œè¢«å”¤é†’ï¼Œæˆ–è€…è¶…æ—¶ã€‚</p><p>E. å†™æ•°æ®ï¼Œå¹¶å°†è‡ªå·±çš„trx_idå†™å…¥trx_idå­—æ®µã€‚</p><hr><h3 id="6-2-æ˜¾å¼é”">6.2 æ˜¾å¼é”</h3><p>é€šè¿‡ç‰¹å®šçš„è¯­å¥è¿›è¡ŒåŠ é”ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¾ç¤ºåŠ é”ï¼Œä¾‹å¦‚ï¼š</p><p>æ˜¾ç¤ºåŠ å…±äº«é”ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .... lock <span class="keyword">in</span> share mode</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºåŠ æ’å®ƒé”ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .... <span class="keyword">for</span> <span class="keyword">update</span></span><br></pre></td></tr></table></figure><hr><h2 id="7-å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”">7. å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”</h2><p>å…¨å±€é”å°±æ˜¯å¯¹<code>æ•´ä¸ªæ•°æ®åº“å®ä¾‹</code>åŠ é”ã€‚å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äº<code>åªè¯»çŠ¶æ€</code>çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹å å…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“ æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚å…¨å±€é”çš„å…¸å‹ä½¿ç”¨<code>åœºæ™¯</code>æ˜¯ï¼šåš<code>å…¨åº“é€»è¾‘å¤‡ä»½</code>ã€‚</p><p>å…¨å±€é”çš„å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flush tables <span class="keyword">with</span> read lock</span><br></pre></td></tr></table></figure><hr><h2 id="8-å…¶å®ƒé”ä¹‹ï¼šæ­»é”">8. å…¶å®ƒé”ä¹‹ï¼šæ­»é”</h2><h3 id="8-1-æ¦‚å¿µ">8.1 æ¦‚å¿µ</h3><p>ä¸¤ä¸ªäº‹åŠ¡éƒ½æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾ï¼Œå¹¶ä¸”åŒæ–¹éƒ½ä¸ä¼šé‡Šæ”¾è‡ªå·±çš„é”ã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713220714098.png" alt="image-20220713220714098"></p><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p>ç”¨æˆ·Aç»™ç”¨æˆ·Bè½¬è´¦100ï¼Œå†æ¬¡åŒæ—¶ï¼Œç”¨æˆ·Bä¹Ÿç»™ç”¨æˆ·Aè½¬è´¦100ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯èƒ½å¯¼è‡´æ­»é”ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713220936236.png" alt="image-20220713220936236" style="float:left;" /><h3 id="8-2-äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶">8.2 äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶</h3><ol><li>ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šäº‹åŠ¡</li><li>æ¯ä¸ªäº‹åŠ¡éƒ½å·²ç»æŒæœ‰é”å¹¶ä¸”ç”³è¯·æ–°çš„é”</li><li>é”èµ„æºåŒæ—¶åªèƒ½è¢«åŒä¸€ä¸ªäº‹åŠ¡æŒæœ‰æˆ–è€…ä¸å…¼å®¹</li><li>äº‹åŠ¡ä¹‹é—´å› ä¸ºæŒæœ‰é”å’Œç”³è¯·é”å¯¼è‡´å½¼æ­¤å¾ªç¯ç­‰å¾…</li></ol><blockquote><p>æ­»é”çš„å…³é”®åœ¨äºï¼šä¸¤ä¸ªï¼ˆæˆ–ä»¥ä¸Šï¼‰çš„SessionåŠ é”çš„é¡ºåºä¸ä¸€è‡´ã€‚</p></blockquote><h3 id="8-3-å¦‚ä½•å¤„ç†æ­»é”">8.3 å¦‚ä½•å¤„ç†æ­»é”</h3><p>**æ–¹å¼1ï¼š**ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼ˆinnodb_lock_wait_timeout=50s)</p><p>å³å½“ä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…æ—¶ï¼Œå½“â€”ä¸ªäº‹åŠ¡ç­‰å¾…æ—¶é—´è¶…è¿‡è®¾ç½®çš„åœ‹å€¼æ—¶ï¼Œå°±å°†å…¶å›æ»šï¼Œå¦å¤–äº‹åŠ¡ç»§ç»­è¿›è¡Œã€‚è¿™ç§æ–¹æ³•ç®€å•æœ‰æ•ˆï¼Œåœ¨innodbä¸­ï¼Œå‚æ•°<code>innodb_lock_wait_timeout</code>ç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p><p>ç¼ºç‚¹ï¼šå¯¹äºåœ¨çº¿æœåŠ¡æ¥è¯´ï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´å¾€å¾€æ˜¯æ— æ³•æ¥å—çš„ã€‚</p><p>é‚£å°†æ­¤å€¼ä¿®æ”¹çŸ­ä¸€äº›ï¼Œæ¯”å¦‚1sï¼Œ0.1sæ˜¯å¦åˆé€‚ï¼Ÿä¸åˆé€‚ï¼Œå®¹æ˜“è¯¯ä¼¤åˆ°æ™®é€šçš„é”ç­‰å¾…ã€‚</p><p>**æ–¹å¼2ï¼š**ä½¿ç”¨æ­»é”æ£€æµ‹å¤„ç†æ­»é”ç¨‹åº</p><p>æ–¹å¼1æ£€æµ‹æ­»é”å¤ªè¿‡è¢«åŠ¨ï¼Œinnodbè¿˜æä¾›äº†<code>wait-for graphç®—æ³•</code>æ¥ä¸»åŠ¨è¿›è¡Œæ­»é”æ£€æµ‹ï¼Œæ¯å½“åŠ é”è¯·æ±‚æ— æ³•ç«‹å³æ»¡è¶³éœ€è¦å¹¶è¿›å…¥ç­‰å¾…æ—¶ï¼Œwait-for graphç®—æ³•éƒ½ä¼šè¢«è§¦å‘ã€‚</p><p>è¿™æ˜¯ä¸€ç§è¾ƒä¸º<code>ä¸»åŠ¨çš„æ­»é”æ£€æµ‹æœºåˆ¶</code>ï¼Œè¦æ±‚æ•°æ®åº“ä¿å­˜<code>é”çš„ä¿¡æ¯é“¾è¡¨</code>å’Œ<code>äº‹åŠ¡ç­‰å¾…é“¾è¡¨</code>ä¸¤éƒ¨åˆ†ä¿¡æ¯ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713221758941.png" alt="image-20220713221758941" style="zoom:67%;" /><p>åŸºäºè¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå¯ä»¥ç»˜åˆ¶wait-for graphï¼ˆç­‰å¾…å›¾ï¼‰</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713221830455.png" alt="image-20220713221830455" style="zoom:67%;" /><blockquote><p>æ­»é”æ£€æµ‹çš„åŸç†æ˜¯æ„å»ºä¸€ä¸ªä»¥äº‹åŠ¡ä¸ºé¡¶ç‚¹ï¼Œé”ä¸ºè¾¹çš„æœ‰å‘å›¾ï¼Œåˆ¤æ–­æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯ï¼Œå­˜åœ¨æ—¢æœ‰æ­»é”ã€‚</p></blockquote><p>ä¸€æ—¦æ£€æµ‹åˆ°å›è·¯ã€æœ‰æ­»é”ï¼Œè¿™æ—¶å€™InnoDBå­˜å‚¨å¼•æ“ä¼šé€‰æ‹©<code>å›æ»šundoé‡æœ€å°çš„äº‹åŠ¡</code>ï¼Œè®©å…¶ä»–äº‹åŠ¡ç»§ç»­æ‰§è¡Œï¼ˆ<code>innodb_deadlock_detect=on</code>è¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ï¼‰ã€‚</p><p>ç¼ºç‚¹ï¼šæ¯ä¸ªæ–°çš„è¢«é˜»å¡çš„çº¿ç¨‹ï¼Œéƒ½è¦åˆ¤æ–­æ˜¯ä¸æ˜¯ç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”ï¼Œè¿™ä¸ªæ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚å¦‚æœ100ä¸ªå¹¶å‘çº¿ç¨‹åŒæ—¶æ›´æ–°åŒä¸€è¡Œï¼Œæ„å‘³ç€è¦æ£€æµ‹100*100=1ä¸‡æ¬¡ï¼Œ1ä¸‡ä¸ªçº¿ç¨‹å°±ä¼šæœ‰1åƒä¸‡æ¬¡æ£€æµ‹ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼Ÿ</strong></p><ul><li>æ–¹å¼1ï¼šå…³é—­æ­»é”æ£€æµ‹ï¼Œä½†æ„å‘³ç€å¯èƒ½ä¼šå‡ºç°å¤§é‡çš„è¶…æ—¶ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡æœ‰æŸã€‚</li><li>æ–¹å¼2ï¼šæ§åˆ¶å¹¶å‘è®¿é—®çš„æ•°é‡ã€‚æ¯”å¦‚åœ¨ä¸­é—´ä»¶ä¸­å®ç°å¯¹äºç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿï¼Œè¿™æ ·åœ¨InnoDBå†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œã€‚</li></ul><p><strong>è¿›ä¸€æ­¥çš„æ€è·¯ï¼š</strong></p><p>å¯ä»¥è€ƒè™‘é€šè¿‡å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘<code>é”å†²çª</code>ã€‚æ¯”å¦‚ï¼Œè¿é”è¶…å¸‚è´¦æˆ·æ€»é¢çš„è®°å½•ï¼Œå¯ä»¥è€ƒè™‘æ”¾åˆ°å¤šæ¡è®°å½•ä¸Šã€‚è´¦æˆ·æ€»é¢ç­‰äºè¿™å¤šä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚</p><hr><h3 id="8-4-å¦‚ä½•é¿å…æ­»é”">8.4 å¦‚ä½•é¿å…æ­»é”</h3><ul><li><p>åˆç†è®¾è®¡ç´¢å¼•ï¼Œä½¿ä¸šåŠ¡ SQL å°½å¯èƒ½é€šè¿‡ç´¢å¼•å®šä½æ›´å°‘çš„è¡Œï¼Œå‡å°‘é”ç«äº‰ã€‚</p></li><li><p>è°ƒæ•´ä¸šåŠ¡é€»è¾‘ SQLæ‰§è¡Œé¡ºåºï¼Œé¿å… update/delete é•¿æ—¶é—´æŒæœ‰é”çš„SQL åœ¨äº‹åŠ¡å‰é¢ã€‚</p></li><li><p>é¿å…å¤§äº‹åŠ¡ï¼Œå°½é‡å°†å¤§äº‹åŠ¡æ‹†æˆå¤šä¸ªå°äº‹åŠ¡æ¥å¤„ç†ï¼Œå°äº‹åŠ¡ç¼©çŸ­é”å®šèµ„æºçš„æ—¶é—´ï¼Œå‘ç”Ÿé”å†²çªçš„å‡ ç‡ä¹Ÿæ›´å°ã€‚</p></li><li><p>åœ¨å¹¶å‘æ¯”è¾ƒé«˜çš„ç³»ç»Ÿä¸­ï¼Œä¸è¦æ˜¾å¼åŠ é”ï¼Œç‰¹åˆ«æ˜¯æ˜¯åœ¨äº‹åŠ¡é‡Œæ˜¾å¼åŠ é”ã€‚å¦‚ selectâ€¦ for update è¯­å¥ï¼Œå¦‚æœæ˜¯åœ¨äº‹åŠ¡é‡Œè¿è¡Œäº† start transaction æˆ–è®¾ç½®äº†autocommit ç­‰äº0ï¼Œé‚£ä¹ˆå°±ä¼šé”å®šæ‰€æŸ¥æ‰¾åˆ°çš„è®°å½•ã€‚</p></li><li><p>é™ä½éš”ç¦»çº§åˆ«ã€‚å¦‚æœä¸šåŠ¡å…è®¸ï¼Œå°†éš”ç¦»çº§åˆ«è°ƒä½ä¹Ÿæ˜¯è¾ƒå¥½çš„é€‰æ‹©ï¼Œæ¯”å¦‚å°†éš”ç¦»çº§åˆ«ä»RRè°ƒæ•´ä¸ºRCï¼Œå¯ä»¥é¿å…æ‰å¾ˆå¤šå› ä¸ºgapé”é€ æˆçš„æ­»é”ã€‚</p></li></ul><hr><h2 id="9-é”çš„å†…éƒ¨ç»“æ„">9. é”çš„å†…éƒ¨ç»“æ„</h2><p>æˆ‘ä»¬å‰è¾¹è¯´å¯¹ä¸€æ¡è®°å½•åŠ é”çš„æœ¬è´¨å°±æ˜¯åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ª<code>é”ç»“æ„</code>ä¸ä¹‹å…³è”ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡å¯¹å¤šæ¡è®°å½•åŠ é”ï¼Œå°±è¦åˆ›å»ºå¤šä¸ª<code>é”ç»“æ„</code>å‘¢ï¼Ÿæ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># äº‹åŠ¡T1</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br></pre></td></tr></table></figure><p>ç†è®ºä¸Šåˆ›å»ºå¤šä¸ª<code>é”ç»“æ„</code>æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªäº‹åŠ¡è¦è·å–10000æ¡è®°å½•çš„é”ï¼Œç”Ÿæˆ10000ä¸ªé”ç»“æ„ä¹Ÿå¤ªå´©æºƒäº†ï¼æ‰€ä»¥å†³å®šåœ¨å¯¹ä¸åŒè®°å½•åŠ é”æ—¶ï¼Œå¦‚æœç¬¦åˆä¸‹è¾¹è¿™äº›æ¡ä»¶çš„è®°å½•ä¼šæ”¾åœ¨ä¸€ä¸ª<code>é”ç»“æ„</code>ä¸­ã€‚</p><ul><li>åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡ŒåŠ é”æ“ä½œ</li><li>è¢«åŠ é”çš„è®°å½•åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­</li><li>åŠ é”çš„ç±»å‹æ˜¯ä¸€æ ·çš„</li><li>ç­‰å¾…çŠ¶æ€æ˜¯ä¸€æ ·çš„</li></ul><p><code>InnoDB</code>å­˜å‚¨å¼•æ“ä¸­çš„<code>é”ç»“æ„</code>å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714132306208.png" alt="image-20220714132306208" style="zoom:67%;" /><p>ç»“æ„è§£æï¼š</p><p><code>1. é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯</code>ï¼š</p><p>ä¸è®ºæ˜¯<code>è¡¨é”</code>è¿˜æ˜¯<code>è¡Œé”</code>ï¼Œéƒ½æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ï¼Œå“ªä¸ªäº‹åŠ¡ç”Ÿæˆäº†è¿™ä¸ªé”ç»“æ„ ï¼Œè¿™é‡Œå°±è®°å½•è¿™ä¸ª äº‹åŠ¡çš„ä¿¡æ¯ã€‚</p><p>æ­¤<code>é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯</code>åœ¨å†…å­˜ç»“æ„ä¸­åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆå¯ä»¥æ‰¾åˆ°å†…å­˜ä¸­å…³äºè¯¥äº‹åŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œæ¯”æ–¹è¯´äº‹åŠ¡idç­‰ã€‚</p><p><code>2. ç´¢å¼•ä¿¡æ¯</code>ï¼š</p><p>å¯¹äº<code>è¡Œé”</code>æ¥è¯´ï¼Œéœ€è¦è®°å½•ä¸€ä¸‹åŠ é”çš„è®°å½•æ˜¯å±äºå“ªä¸ªç´¢å¼•çš„ã€‚è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚</p><p><code>3. è¡¨é”ï¼è¡Œé”ä¿¡æ¯</code>ï¼š</p><p><code>è¡¨é”ç»“æ„</code>å’Œ<code>è¡Œé”ç»“æ„</code>åœ¨è¿™ä¸ªä½ç½®çš„å†…å®¹æ˜¯ä¸åŒçš„ï¼š</p><ul><li><p>è¡¨é”ï¼š</p><p>è®°è½½ç€æ˜¯å¯¹å“ªä¸ªè¡¨åŠ çš„é”ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›ä¿¡æ¯ã€‚</p></li><li><p>è¡Œé”ï¼š</p><p>è®°è½½äº†ä¸‰ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š</p><p>*<code>Space ID</code>ï¼šè®°å½•æ‰€åœ¨è¡¨ç©ºé—´ã€‚<br>*<code>Page Number</code>ï¼šè®°å½•æ‰€åœ¨é¡µå·ã€‚<br>*<code>n_bits</code>ï¼šå¯¹äºè¡Œé”æ¥è¯´ï¼Œä¸€æ¡è®°å½•å°±å¯¹åº”ç€ä¸€ä¸ªæ¯”ç‰¹ä½ï¼Œä¸€ä¸ªé¡µé¢ä¸­åŒ…å«å¾ˆå¤šè®°å½•ï¼Œç”¨ä¸åŒ çš„æ¯”ç‰¹ä½æ¥åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€æ¡è®°å½•åŠ äº†é”ã€‚ä¸ºæ­¤åœ¨è¡Œé”ç»“æ„çš„æœ«å°¾æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œè¿™ä¸ª<code>n_bis</code>å±æ€§ä»£è¡¨ä½¿ç”¨äº†å¤šå°‘æ¯”ç‰¹ä½ã€‚</p><blockquote><p>n_bitsçš„å€¼ä¸€èˆ¬éƒ½æ¯”é¡µé¢ä¸­è®°å½•æ¡æ•°å¤šä¸€äº›ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¹‹ååœ¨é¡µé¢ä¸­æ’å…¥äº†æ–°è®°å½•å ä¹Ÿä¸è‡³äºé‡æ–°åˆ†é…é”ç»“æ„</p></blockquote></li></ul><p><code>4. type_mode</code>ï¼š</p><p>è¿™æ˜¯ä¸€ä¸ª32ä½çš„æ•°ï¼Œè¢«åˆ†æˆäº†<code>lock_mode</code>ã€<code>lock_type</code>å’Œ<code>rec_lock_type</code>ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714133319666.png" alt="image-20220714133319666"></p><ul><li>é”çš„æ¨¡å¼ï¼ˆ<code>lock_mode</code>ï¼‰ï¼Œå ç”¨ä½4ä½ï¼Œå¯é€‰çš„å€¼å¦‚ä¸‹ï¼š<br>*<code>LOCK_IS</code>ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤ºå…±äº«æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯<code>ISé”</code>ã€‚<br>*<code>LOCK_IX</code>ï¼ˆåè¿›åˆ¶çš„ 1 ï¼‰ï¼šè¡¨ç¤ºç‹¬å æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯<code>IXé”</code>ã€‚<br>*<code>LOCK_S</code>ï¼ˆåè¿›åˆ¶çš„ 2 ï¼‰ï¼šè¡¨ç¤ºå…±äº«é”ï¼Œä¹Ÿå°±æ˜¯<code>Sé”</code>ã€‚<br>*<code>LOCK_X</code>ï¼ˆåè¿›åˆ¶çš„ 3 ï¼‰ï¼šè¡¨ç¤ºç‹¬å é”ï¼Œä¹Ÿå°±æ˜¯<code>Xé”</code>ã€‚<br>*<code>LOCK_AUTO_INC</code>ï¼ˆåè¿›åˆ¶çš„ 4 ï¼‰ï¼šè¡¨ç¤º<code>AUTO-INCé”</code>ã€‚</li></ul><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼ŒLOCK_ISï¼ŒLOCK_IXï¼ŒLOCK_AUTO_INCéƒ½ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼ŒLOCK_Så’Œ LOCK_Xæ—¢å¯ä»¥ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡Œçº§é”çš„æ¨¡å¼ã€‚</p><ul><li>é”çš„ç±»å‹ï¼ˆ<code>lock_type</code>ï¼‰ï¼Œå ç”¨ç¬¬5ï½8ä½ï¼Œä¸è¿‡ç°é˜¶æ®µåªæœ‰ç¬¬5ä½å’Œç¬¬6ä½è¢«ä½¿ç”¨ï¼š<br>*<code>LOCK_TABLE</code>ï¼ˆåè¿›åˆ¶çš„ 16 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬5ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡¨çº§é”ã€‚<br>*<code>LOCK_REC</code>ï¼ˆåè¿›åˆ¶çš„ 32 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬6ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡Œçº§é”ã€‚</li><li>è¡Œé”çš„å…·ä½“ç±»å‹ï¼ˆ<code>rec_lock_type</code>ï¼‰ï¼Œä½¿ç”¨å…¶ä½™çš„ä½æ¥è¡¨ç¤ºã€‚åªæœ‰åœ¨<code>lock_type</code>çš„å€¼ä¸º<code>LOCK_REC</code>æ—¶ï¼Œä¹Ÿå°±æ˜¯åªæœ‰åœ¨è¯¥é”ä¸ºè¡Œçº§é”æ—¶ï¼Œæ‰ä¼šè¢«ç»†åˆ†ä¸ºæ›´å¤šçš„ç±»å‹ï¼š<br>*<code>LOCK_ORDINARY</code>ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤º<code>next-keyé”</code>ã€‚<br>*<code>LOCK_GAP</code>ï¼ˆåè¿›åˆ¶çš„ 512 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬10ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤º<code>gapé”</code>ã€‚<br>*<code>LOCK_REC_NOT_GAP</code>ï¼ˆåè¿›åˆ¶çš„ 1024 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬11ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ­£ç»<code>è®°å½•é”</code>ã€‚<br>*<code>LOCK_INSERT_INTENTION</code>ï¼ˆåè¿›åˆ¶çš„ 2048 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬12ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ’å…¥æ„å‘é”ã€‚å…¶ä»–çš„ç±»å‹ï¼šè¿˜æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„ç±»å‹æˆ‘ä»¬å°±ä¸å¤šè¯´äº†ã€‚<br>*<code>is_waiting</code>å±æ€§å‘¢ï¼ŸåŸºäºå†…å­˜ç©ºé—´çš„èŠ‚çœï¼Œæ‰€ä»¥æŠŠ<code>is_waiting</code>å±æ€§æ”¾åˆ°äº†<code>type_mode</code>è¿™ä¸ª32 ä½çš„æ•°å­—ä¸­ï¼š<br>*<code>LOCK_WAIT</code>ï¼ˆåè¿›åˆ¶çš„ 256 ï¼‰ ï¼šå½“ç¬¬9ä¸ªæ¯”ç‰¹ä½ç½®ä¸º 1 æ—¶ï¼Œè¡¨ç¤º<code>is_waiting</code>ä¸º<code>true</code>ï¼Œä¹Ÿ å°±æ˜¯å½“å‰äº‹åŠ¡å°šæœªè·å–åˆ°é”ï¼Œå¤„åœ¨ç­‰å¾…çŠ¶æ€ï¼›å½“è¿™ä¸ªæ¯”ç‰¹ä½ä¸º 0 æ—¶ï¼Œè¡¨ç¤º<code>is_waiting</code>ä¸º<code>false</code>ï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡è·å–é”æˆåŠŸã€‚</li></ul><p><code>5. å…¶ä»–ä¿¡æ¯</code>ï¼š</p><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å„ç§é”ç»“æ„è€Œè®¾è®¡äº†å„ç§å“ˆå¸Œè¡¨å’Œé“¾è¡¨ã€‚</p><p><code>6. ä¸€å †æ¯”ç‰¹ä½</code>ï¼š</p><p>å¦‚æœæ˜¯<code>è¡Œé”ç»“æ„</code>çš„è¯ï¼Œåœ¨è¯¥ç»“æ„æœ«å°¾è¿˜æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œæ¯”ç‰¹ä½çš„æ•°é‡æ˜¯ç”±ä¸Šè¾¹æåˆ°çš„<code>n_bits</code>å±æ€§ è¡¨ç¤ºçš„ã€‚InnoDBæ•°æ®é¡µä¸­çš„æ¯æ¡è®°å½•åœ¨<code>è®°å½•å¤´ä¿¡æ¯</code>ä¸­éƒ½åŒ…å«ä¸€ä¸ª<code>heap_no</code>å±æ€§ï¼Œä¼ªè®°å½•<code>Infimum</code>çš„<code>heap_no</code>å€¼ä¸º 0 ï¼Œ<code>Supremum</code>çš„<code>heap_no</code>å€¼ä¸º 1 ï¼Œä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œ<code>heap_no</code>å€¼å°±å¢1ã€‚ é”ç»“ æ„ æœ€åçš„ä¸€å †æ¯”ç‰¹ä½å°±å¯¹åº”ç€ä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ï¼Œä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ä¸€ä¸ª<code>heap_no</code>ï¼Œå³ä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ åˆ°é¡µå†…çš„ä¸€æ¡è®°å½•ã€‚</p><hr><h2 id="10-é”ç›‘æ§">10. é”ç›‘æ§</h2><p>å…³äºMySQLé”çš„ç›‘æ§ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡æ£€æŸ¥ InnoDB_row_lock ç­‰çŠ¶æ€å˜é‡æ¥åˆ†æç³»ç»Ÿä¸Šçš„è¡Œé”çš„äº‰å¤ºæƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;innodb_row_lock%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                 <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_current_waits <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_time          <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_time_avg      <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_time_max      <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_waits         <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+-------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>å¯¹å„ä¸ªçŠ¶æ€é‡çš„è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>Innodb_row_lock_current_waitsï¼šå½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡ï¼›<br>*<code>Innodb_row_lock_time</code>ï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦ï¼›ï¼ˆç­‰å¾…æ€»æ—¶é•¿ï¼‰<br>*<code>Innodb_row_lock_time_avg</code>ï¼šæ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é—´ï¼›ï¼ˆç­‰å¾…å¹³å‡æ—¶é•¿ï¼‰</li><li>Innodb_row_lock_time_maxï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€å¸¸çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´ï¼›<br>*<code>Innodb_row_lock_waits</code>ï¼šç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°ï¼›ï¼ˆç­‰å¾…æ€»æ¬¡æ•°ï¼‰</li></ul><p>å¯¹äºè¿™5ä¸ªçŠ¶æ€å˜é‡ï¼Œæ¯”è¾ƒé‡è¦çš„3ä¸ªè§ä¸Šé¢ï¼ˆç°è‰²ï¼‰ã€‚</p><p>å°¤å…¶æ˜¯å½“ç­‰å¾…æ¬¡æ•°å¾ˆé«˜ï¼Œè€Œä¸”æ¯æ¬¡ç­‰å¾…æ—¶é•¿ä¹Ÿä¸å°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ†æç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆä¼šæœ‰å¦‚æ­¤å¤šçš„ç­‰å¾…ï¼Œç„¶åæ ¹æ®åˆ†æç»“æœç€æ‰‹æŒ‡å®šä¼˜åŒ–è®¡åˆ’ã€‚</p><p><strong>å…¶ä»–ç›‘æ§æ–¹æ³•ï¼š</strong></p><p>MySQLæŠŠäº‹åŠ¡å’Œé”çš„ä¿¡æ¯è®°å½•åœ¨äº†<code>information_schema</code>åº“ä¸­ï¼Œæ¶‰åŠåˆ°çš„ä¸‰å¼ è¡¨åˆ†åˆ«æ˜¯<code>INNODB_TRX</code>ã€<code>INNODB_LOCKS</code>å’Œ<code>INNODB_LOCK_WAITS</code>ã€‚</p><p><code>MySQL5.7åŠä¹‹å‰</code>ï¼Œå¯ä»¥é€šè¿‡information_schema.INNODB_LOCKSæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œä½†åªèƒ½çœ‹åˆ°é˜»å¡äº‹ åŠ¡çš„é”ï¼›å¦‚æœäº‹åŠ¡å¹¶æœªè¢«é˜»å¡ï¼Œåˆ™åœ¨è¯¥è¡¨ä¸­çœ‹ä¸åˆ°è¯¥äº‹åŠ¡çš„é”æƒ…å†µã€‚</p><p>MySQL8.0åˆ é™¤äº†information_schema.INNODB_LOCKSï¼Œæ·»åŠ äº†<code>performance_schema.data_locks</code>ï¼Œå¯ä»¥é€šè¿‡performance_schema.data_locksæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œå’ŒMySQL5.7åŠä¹‹å‰ä¸åŒï¼Œ performance_schema.data_locksä¸ä½†å¯ä»¥çœ‹åˆ°é˜»å¡è¯¥äº‹åŠ¡çš„é”ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¯¥äº‹åŠ¡æ‰€æŒæœ‰çš„é”ã€‚</p><p>åŒæ—¶ï¼Œinformation_schema.INNODB_LOCK_WAITSä¹Ÿè¢«<code>performance_schema.data_lock_waits</code>æ‰€ä»£ æ›¿ã€‚</p><p>æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªé”ç­‰å¾…çš„åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä»è¿™ä¸‰å¼ è¡¨æ”¶é›†çš„ä¿¡æ¯</p><p>é”ç­‰å¾…åœºæ™¯ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨è®°å½•é”ä¸­çš„æ¡ˆä¾‹ï¼Œå½“äº‹åŠ¡2è¿›è¡Œç­‰å¾…æ—¶ï¼ŒæŸ¥è¯¢æƒ…å†µå¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰æŸ¥è¯¢æ­£åœ¨è¢«é”é˜»å¡çš„sqlè¯­å¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.INNODB_TRX\G;</span><br></pre></td></tr></table></figure><p>é‡è¦å±æ€§ä»£è¡¨å«ä¹‰å·²åœ¨ä¸Šè¿°ä¸­æ ‡æ³¨ã€‚</p><p>ï¼ˆ2ï¼‰æŸ¥è¯¢é”ç­‰å¾…æƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> data_lock_waits\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">REQUESTING_ENGINE_LOCK_ID: <span class="number">139750145405624</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">7</span>:<span class="number">139747028690608</span></span><br><span class="line">REQUESTING_ENGINE_TRANSACTION_ID: <span class="number">13845</span> #è¢«é˜»å¡çš„äº‹åŠ¡ID</span><br><span class="line">REQUESTING_THREAD_ID: <span class="number">72</span></span><br><span class="line">REQUESTING_EVENT_ID: <span class="number">26</span></span><br><span class="line">REQUESTING_OBJECT_INSTANCE_BEGIN: <span class="number">139747028690608</span></span><br><span class="line">BLOCKING_ENGINE_LOCK_ID: <span class="number">139750145406432</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">7</span>:<span class="number">139747028813248</span></span><br><span class="line">BLOCKING_ENGINE_TRANSACTION_ID: <span class="number">13844</span> #æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡IDï¼Œé˜»å¡äº†<span class="number">13845</span></span><br><span class="line">BLOCKING_THREAD_ID: <span class="number">71</span></span><br><span class="line">BLOCKING_EVENT_ID: <span class="number">24</span></span><br><span class="line">BLOCKING_OBJECT_INSTANCE_BEGIN: <span class="number">139747028813248</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æŸ¥è¯¢é”çš„æƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> performance_schema.data_locks\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">ENGINE_LOCK_ID: <span class="number">139750145405624</span>:<span class="number">1068</span>:<span class="number">139747028693520</span></span><br><span class="line">ENGINE_TRANSACTION_ID: <span class="number">13847</span></span><br><span class="line">THREAD_ID: <span class="number">72</span></span><br><span class="line">EVENT_ID: <span class="number">31</span></span><br><span class="line">OBJECT_SCHEMA: atguigu</span><br><span class="line">OBJECT_NAME: <span class="keyword">user</span></span><br><span class="line">PARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">SUBPARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">INDEX_NAME: <span class="keyword">NULL</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">139747028693520</span></span><br><span class="line">LOCK_TYPE: <span class="keyword">TABLE</span></span><br><span class="line">LOCK_MODE: IX</span><br><span class="line">LOCK_STATUS: GRANTED</span><br><span class="line">LOCK_DATA: <span class="keyword">NULL</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">2.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">ENGINE_LOCK_ID: <span class="number">139750145405624</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">7</span>:<span class="number">139747028690608</span></span><br><span class="line">ENGINE_TRANSACTION_ID: <span class="number">13847</span></span><br><span class="line">THREAD_ID: <span class="number">72</span></span><br><span class="line">EVENT_ID: <span class="number">31</span></span><br><span class="line">OBJECT_SCHEMA: atguigu</span><br><span class="line">OBJECT_NAME: <span class="keyword">user</span></span><br><span class="line">PARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">SUBPARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">INDEX_NAME: <span class="keyword">PRIMARY</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">139747028690608</span></span><br><span class="line">LOCK_TYPE: RECORD</span><br><span class="line">LOCK_MODE: X,REC_NOT_GAP</span><br><span class="line">LOCK_STATUS: WAITING</span><br><span class="line">LOCK_DATA: <span class="number">1</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">3.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">ENGINE_LOCK_ID: <span class="number">139750145406432</span>:<span class="number">1068</span>:<span class="number">139747028816304</span></span><br><span class="line">ENGINE_TRANSACTION_ID: <span class="number">13846</span></span><br><span class="line">THREAD_ID: <span class="number">71</span></span><br><span class="line">EVENT_ID: <span class="number">28</span></span><br><span class="line">OBJECT_SCHEMA: atguigu</span><br><span class="line">OBJECT_NAME: <span class="keyword">user</span></span><br><span class="line">PARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">SUBPARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">INDEX_NAME: <span class="keyword">NULL</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">139747028816304</span></span><br><span class="line">LOCK_TYPE: <span class="keyword">TABLE</span></span><br><span class="line">LOCK_MODE: IX</span><br><span class="line">LOCK_STATUS: GRANTED</span><br><span class="line">LOCK_DATA: <span class="keyword">NULL</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">4.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">ENGINE_LOCK_ID: <span class="number">139750145406432</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">7</span>:<span class="number">139747028813248</span></span><br><span class="line">ENGINE_TRANSACTION_ID: <span class="number">13846</span></span><br><span class="line">THREAD_ID: <span class="number">71</span></span><br><span class="line">EVENT_ID: <span class="number">28</span></span><br><span class="line">OBJECT_SCHEMA: atguigu</span><br><span class="line">OBJECT_NAME: <span class="keyword">user</span></span><br><span class="line">PARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">SUBPARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">INDEX_NAME: <span class="keyword">PRIMARY</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">139747028813248</span></span><br><span class="line">LOCK_TYPE: RECORD</span><br><span class="line">LOCK_MODE: X,REC_NOT_GAP</span><br><span class="line">LOCK_STATUS: GRANTED</span><br><span class="line">LOCK_DATA: <span class="number">1</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line"><span class="keyword">No</span> query specified</span><br></pre></td></tr></table></figure><p>ä»é”çš„æƒ…å†µå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«è·å–äº†IXé”ï¼Œæˆ‘ä»¬ä»æ„å‘é”ç« èŠ‚å¯ä»¥çŸ¥é“ï¼ŒIXé”äº’ç›¸æ—¶å…¼å®¹çš„ã€‚æ‰€ ä»¥è¿™é‡Œä¸ä¼šç­‰å¾…ï¼Œä½†æ˜¯äº‹åŠ¡1åŒæ ·æŒæœ‰Xé”ï¼Œæ­¤æ—¶äº‹åŠ¡2ä¹Ÿè¦å»åŒä¸€è¡Œè®°å½•è·å–Xé”ï¼Œä»–ä»¬ä¹‹é—´ä¸å…¼å®¹ï¼Œå¯¼ è‡´ç­‰å¾…çš„æƒ…å†µå‘ç”Ÿã€‚</p><hr><h2 id="é™„å½•-é—´éš™é”åŠ é”è§„åˆ™">é™„å½•:é—´éš™é”åŠ é”è§„åˆ™</h2><p>é—´éš™é”åŠ é”è§„åˆ™ï¼ˆå…±11ä¸ªæ¡ˆä¾‹ï¼‰</p><p>é—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ï¼š next-key lockå®é™…ä¸Šæ˜¯ç”±é—´éš™é”åŠ è¡Œé”å®ç°çš„ï¼Œå¦‚æœåˆ‡æ¢åˆ°è¯»æäº¤éš”ç¦»çº§åˆ« (read-committed) çš„è¯ï¼Œå°±å¥½ç†è§£äº†ï¼Œè¿‡ç¨‹ä¸­å»æ‰é—´éš™é”çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åªå‰©ä¸‹è¡Œé”çš„éƒ¨åˆ†ã€‚è€Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹é—´éš™é”å°±æ²¡æœ‰äº†ï¼Œä¸ºäº†è§£å†³å¯èƒ½å‡ºç°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦æŠŠ binlogæ ¼å¼è®¾ç½®ä¸º row ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¸å¤šå…¬å¸çš„é…ç½®ä¸ºï¼šè¯»æäº¤éš”ç¦»çº§åˆ«åŠ  binlog_format=rowã€‚ä¸šåŠ¡ä¸éœ€è¦å¯é‡å¤è¯»çš„ä¿è¯ï¼Œè¿™æ ·è€ƒè™‘åˆ°è¯»æäº¤ä¸‹æ“ä½œæ•°æ®çš„é”èŒƒå›´æ›´å°ï¼ˆæ²¡æœ‰é—´éš™é”ï¼‰ï¼Œè¿™ä¸ªé€‰æ‹©æ˜¯åˆç†çš„ã€‚</p><p>next-key lockçš„åŠ é”è§„åˆ™</p><p>æ€»ç»“çš„åŠ é”è§„åˆ™é‡Œé¢ï¼ŒåŒ…å«äº†ä¸¤ä¸ªåŸåˆ™ã€ä¸¤ä¸ªä¼˜åŒ–å’Œä¸€ä¸ªbug ã€‚</p><ol><li>åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lock ã€‚ next-key lockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚</li><li>åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚ä»»ä½•è¾…åŠ©ç´¢å¼•ä¸Šçš„é”ï¼Œæˆ–è€…éç´¢å¼•åˆ—ä¸Šçš„é”ï¼Œæœ€ç»ˆéƒ½è¦å›æº¯åˆ°ä¸»é”®ä¸Šï¼Œåœ¨ä¸»é”®ä¸Šä¹Ÿè¦åŠ ä¸€æŠŠé”ã€‚</li><li>ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œ next-key locké€€åŒ–ä¸ºè®°å½•é”ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ InnoDBæ‰«æçš„æ˜¯ä¸€ä¸ªä¸»é”®ã€æˆ–æ˜¯ä¸€ä¸ªå”¯ä¸€ç´¢å¼•çš„è¯ï¼Œé‚£InnoDBåªä¼šé‡‡ç”¨è®°å½•é”æ–¹å¼æ¥åŠ é”</li><li>ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Š(ä¸ä¸€å®šæ˜¯å”¯ä¸€ç´¢å¼•)çš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œ next-key locké€€åŒ–ä¸ºé—´éš™é”ã€‚</li><li>ä¸€ä¸ª bug ï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</li></ol><p>æˆ‘ä»¬ä»¥è¡¨testä½œä¸ºä¾‹å­ï¼Œå»ºè¡¨è¯­å¥å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹ï¼šå…¶ä¸­idä¸ºä¸»é”®ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`test`(</span><br><span class="line">`id`<span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`col1`<span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`col2`<span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">KEY`c`(`col1`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test <span class="keyword">values</span></span><br><span class="line">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>),</span><br><span class="line">(<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>),</span><br><span class="line">(<span class="number">20</span>,<span class="number">20</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">25</span>,<span class="number">25</span>,<span class="number">25</span>);</span><br></pre></td></tr></table></figure><div class="tabs" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-1"><i class="fas fa-cat"></i>1</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-2"><i class="fas fa-horse"></i>2</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-3"><i class="fas fa-dove"></i>3</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-4"><i class="fas fa-dragon"></i>4</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-5"><i class="fas fa-seedling"></i>5</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-6"><i class="fas fa-leaf"></i>6</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-7"><i class="fab fa-apple"></i>7</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-8"><i class="fas fa-tree"></i>8</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-9"><i class="fas fa-heartbeat"></i>9</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-10"><i class="fas fa-cookie-bite"></i>10</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-11"><i class="fas fa-child"></i>11</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-1"><p><mark class="hl-label blue">æ¡ˆä¾‹ä¸€ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é—´éš™é”</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134603698.png" alt="image-20220714134603698" style="zoom:67%;" /><p>ç”±äºè¡¨ test ä¸­æ²¡æœ‰ id=7 çš„è®°å½•</p><p>æ ¹æ®åŸåˆ™ 1 ï¼ŒåŠ é”å•ä½æ˜¯ next-key lock ï¼Œ sessionAåŠ é”èŒƒå›´å°±æ˜¯ (5,10] ï¼› åŒæ—¶æ ¹æ®ä¼˜åŒ–2 ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ (id=7) ï¼Œè€Œ id=10ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œ next-key lock é€€åŒ–æˆé—´éš™é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯ (5,10)</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-2"><p><mark class="hl-label blue">æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é”</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134623052-16577775838551.png" alt="image-20220714134623052" style="zoom:67%;" /><p>è¿™é‡Œ session A è¦ç»™ç´¢å¼•col1ä¸Šcol1=5çš„è¿™ä¸€è¡ŒåŠ ä¸Šè¯»é”ã€‚</p><ol><li>æ ¹æ®åŸåˆ™ 1 ï¼ŒåŠ é”å•ä½æ˜¯ next-key lock ï¼Œå·¦å¼€å³é—­ï¼Œ5æ˜¯é—­ä¸Šçš„ï¼Œå› æ­¤ä¼šç»™ (0,5] åŠ ä¸Š next-key lock ã€‚</li><li>è¦æ³¨æ„ c æ˜¯æ™®é€šç´¢å¼•ï¼Œå› æ­¤ä»…è®¿é—® c=5 è¿™ä¸€æ¡è®°å½•æ˜¯ä¸èƒ½é©¬ä¸Šåœä¸‹æ¥çš„ï¼ˆå¯èƒ½æœ‰col1=5çš„å…¶ä»–è®°å½•ï¼‰ï¼Œéœ€è¦å‘å³éå†ï¼ŒæŸ¥åˆ°c=10æ‰æ”¾å¼ƒã€‚æ ¹æ®åŸåˆ™ 2 ï¼Œè®¿é—®åˆ°çš„éƒ½è¦åŠ é”ï¼Œå› æ­¤è¦ç»™ (5,10] åŠ  next-key lock ã€‚</li><li>ä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ– 2 ï¼šç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ col1=5 è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´éš™é” (5,10) ã€‚</li><li>æ ¹æ®åŸåˆ™ 2 ,åªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•ä¸Šæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ session B çš„ update è¯­å¥å¯ä»¥æ‰§è¡Œå®Œæˆã€‚</li></ol><p>ä½† session C è¦æ’å…¥ä¸€ä¸ª (7,7,7) çš„è®°å½•ï¼Œå°±ä¼šè¢« session A çš„é—´éš™é” (5,10) é”ä½ è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ã€‚</p><p>æ‰§è¡Œ for update æ—¶ï¼Œç³»ç»Ÿä¼šè®¤ä¸ºä½ æ¥ä¸‹æ¥è¦æ›´æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ã€‚</p><p>å¦‚æœä½ è¦ç”¨ lock in share modeæ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå°±å¿…é¡»å¾—ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œå› ä¸ºè¦†ç›–ç´¢å¼•ä¸ä¼šè®¿é—®ä¸»é”®ç´¢å¼•ï¼Œä¸ä¼šç»™ä¸»é”®ç´¢å¼•ä¸ŠåŠ é”</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-3"><p><mark class="hl-label blue">æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”</mark></p><p>ä¸Šé¢ä¸¤ä¸ªä¾‹å­æ˜¯ç­‰å€¼æŸ¥è¯¢çš„ï¼Œè¿™ä¸ªä¾‹å­æ˜¯å…³äºèŒƒå›´æŸ¥è¯¢çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸‹é¢çš„è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">10</span> <span class="keyword">for</span> <span class="keyword">update</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">&gt;=</span><span class="number">10</span> <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="number">11</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134742049.png" alt="image-20220714134742049" style="zoom:67%;" /><ol><li>å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª id=10 çš„è¡Œï¼Œå› æ­¤æœ¬è¯¥æ˜¯ next-key lock(5,10] ã€‚ æ ¹æ®ä¼˜åŒ– 1 ï¼Œä¸»é”® id ä¸Šçš„ç­‰å€¼æ¡ä»¶ï¼Œé€€åŒ–æˆè¡Œé”ï¼ŒåªåŠ äº† id=10 è¿™ä¸€è¡Œçš„è¡Œé”ã€‚</li><li>å®ƒæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œ èŒƒå›´æŸ¥æ‰¾å°±å¾€åç»§ç»­æ‰¾ï¼Œæ‰¾åˆ° id=15 è¿™ä¸€è¡Œåœä¸‹æ¥ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå› æ­¤éœ€è¦åŠ  next-key lock(10,15] ã€‚</li></ol><p>session A è¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé” id=10 å’Œ next-key lock(10,15] ã€‚é¦–æ¬¡ session A å®šä½æŸ¥æ‰¾ id=10 çš„è¡Œçš„æ—¶å€™ï¼Œæ˜¯å½“åšç­‰å€¼æŸ¥è¯¢æ¥åˆ¤æ–­çš„ï¼Œè€Œå‘å³æ‰«æåˆ° id=15 çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢åˆ¤æ–­ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-4"><p><mark class="hl-label blue">æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”</mark></p><p>ä¸æ¡ˆä¾‹ä¸‰ä¸åŒçš„æ˜¯ï¼Œæ¡ˆä¾‹å››ä¸­æŸ¥è¯¢è¯­å¥çš„ where éƒ¨åˆ†ç”¨çš„æ˜¯å­—æ®µ c ï¼Œå®ƒæ˜¯æ™®é€šç´¢å¼•</p><p>è¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134822160.png" alt="image-20220714134822160" style="zoom:67%;" /><p>åœ¨ç¬¬ä¸€æ¬¡ç”¨ col1=10 å®šä½è®°å½•çš„æ—¶å€™ï¼Œç´¢å¼• c ä¸ŠåŠ äº† (5,10] è¿™ä¸ª next-key lock åï¼Œç”±äºç´¢å¼• col1 æ˜¯éå”¯ ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šèœ•å˜ä¸ºè¡Œé”ï¼Œå› æ­¤æœ€ç»ˆ sesion A åŠ çš„é”æ˜¯ï¼Œç´¢å¼• c ä¸Šçš„ (5,10] å’Œ (10,15] è¿™ä¸¤ä¸ª next-keylock ã€‚</p><p>è¿™é‡Œéœ€è¦æ‰«æåˆ° col1=15 æ‰åœæ­¢æ‰«æï¼Œæ˜¯åˆç†çš„ï¼Œå› ä¸º InnoDB è¦æ‰«åˆ° col1=15 ï¼Œæ‰çŸ¥é“ä¸éœ€è¦ç»§ç»­å¾€åæ‰¾äº†ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-5"><p><mark class="hl-label blue">æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”bug</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134846740.png" alt="image-20220714134846740" style="zoom:67%;" /><p>session A æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰ç…§åŸåˆ™ 1 çš„è¯ï¼Œåº”è¯¥æ˜¯ç´¢å¼• id ä¸ŠåªåŠ  (10,15] è¿™ä¸ª next-key lock ï¼Œå¹¶ä¸”å›  ä¸º id æ˜¯å”¯ä¸€é”®ï¼Œæ‰€ä»¥å¾ªç¯åˆ¤æ–­åˆ° id=15 è¿™ä¸€è¡Œå°±åº”è¯¥åœæ­¢äº†ã€‚</p><p>ä½†æ˜¯å®ç°ä¸Šï¼Œ InnoDB ä¼šå¾€å‰æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯ id=20 ã€‚è€Œä¸”ç”±äºè¿™æ˜¯ä¸ªèŒƒå›´æ‰«æï¼Œå› æ­¤ç´¢å¼• id ä¸Šçš„ (15,20] è¿™ä¸ª next-key lock ä¹Ÿä¼šè¢«é”ä¸Šã€‚ç…§ç†è¯´ï¼Œè¿™é‡Œé”ä½ id=20 è¿™ä¸€è¡Œçš„è¡Œä¸ºï¼Œå…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚å› ä¸ºæ‰«æåˆ° id=15 ï¼Œå°±å¯ä»¥ç¡®å®šä¸ç”¨å¾€åå†æ‰¾äº†ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-6"><p><mark class="hl-label blue">æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨ç­‰å€¼çš„ä¾‹å­</mark></p><p>è¿™é‡Œï¼Œæˆ‘ç»™è¡¨ t æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼šinsert into t values(30,10,30);ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨è¡¨é‡Œé¢æœ‰ä¸¤ä¸ªc=10çš„è¡Œ</p><p>ä½†æ˜¯å®ƒä»¬çš„ä¸»é”®å€¼ id æ˜¯ä¸åŒçš„ï¼ˆåˆ†åˆ«æ˜¯ 10 å’Œ 30 ï¼‰ï¼Œå› æ­¤è¿™ä¸¤ä¸ªc=10 çš„è®°å½•ä¹‹é—´ï¼Œä¹Ÿæ˜¯æœ‰é—´éš™çš„ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134923414.png" alt="image-20220714134923414" style="zoom:67%;" /><p>è¿™æ¬¡æˆ‘ä»¬ç”¨ delete è¯­å¥æ¥éªŒè¯ã€‚æ³¨æ„ï¼Œ delete è¯­å¥åŠ é”çš„é€»è¾‘ï¼Œå…¶å®è·Ÿ select â€¦ for update æ˜¯ç±»ä¼¼çš„ï¼Œ ä¹Ÿå°±æ˜¯æˆ‘åœ¨æ–‡ç« å¼€å§‹æ€»ç»“çš„ä¸¤ä¸ª â€œ åŸåˆ™ â€ ã€ä¸¤ä¸ª â€œ ä¼˜åŒ– â€ å’Œä¸€ä¸ª â€œbugâ€ ã€‚</p><p>è¿™æ—¶ï¼Œ session A åœ¨éå†çš„æ—¶å€™ï¼Œå…ˆè®¿é—®ç¬¬ä¸€ä¸ª col1=10 çš„è®°å½•ã€‚åŒæ ·åœ°ï¼Œæ ¹æ®åŸåˆ™ 1 ï¼Œè¿™é‡ŒåŠ çš„æ˜¯ (col1=5,id=5) åˆ° (col1=10,id=10) è¿™ä¸ª next-key lock ã€‚</p><p>ç”±äºcæ˜¯æ™®é€šç´¢å¼•ï¼Œæ‰€ä»¥ç»§ç»­å‘å³æŸ¥æ‰¾ï¼Œç›´åˆ°ç¢°åˆ° (col1=15,id=15) è¿™ä¸€è¡Œå¾ªç¯æ‰ç»“æŸã€‚æ ¹æ®ä¼˜åŒ– 2 ï¼Œè¿™æ˜¯ ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³æŸ¥æ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆ (col1=10,id=10) åˆ° (col1=15,id=15) çš„é—´éš™é”ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134945012.png" alt="image-20220714134945012" style="zoom:67%;" /><p>è¿™ä¸ª delete è¯­å¥åœ¨ç´¢å¼• c ä¸Šçš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯ä¸Šé¢å›¾ä¸­è“è‰²åŒºåŸŸè¦†ç›–çš„éƒ¨åˆ†ã€‚è¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½ æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´ï¼Œå³ (col1=5,id=5) å’Œ (col1=15,id=15) è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-7"><p><mark class="hl-label blue">æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”</mark></p><p>ä¾‹å­ 6 ä¹Ÿæœ‰ä¸€ä¸ªå¯¹ç…§æ¡ˆä¾‹ï¼Œåœºæ™¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135007118.png" alt="image-20220714135007118" style="zoom:67%;" /><p>session A çš„ delete è¯­å¥åŠ äº† limit 2 ã€‚ä½ çŸ¥é“è¡¨ t é‡Œ c=10 çš„è®°å½•å…¶å®åªæœ‰ä¸¤æ¡ï¼Œå› æ­¤åŠ ä¸åŠ  limit 2 ï¼Œåˆ é™¤çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯åŠ é”æ•ˆæœå´ä¸ä¸€æ ·</p><p>è¿™æ˜¯å› ä¸ºï¼Œæ¡ˆä¾‹ä¸ƒé‡Œçš„ delete è¯­å¥æ˜ç¡®åŠ äº† limit 2 çš„é™åˆ¶ï¼Œå› æ­¤åœ¨éå†åˆ° (col1=10, id=30) è¿™ä¸€è¡Œä¹‹åï¼Œ æ»¡è¶³æ¡ä»¶çš„è¯­å¥å·²ç»æœ‰ä¸¤æ¡ï¼Œå¾ªç¯å°±ç»“æŸäº†ã€‚å› æ­¤ï¼Œç´¢å¼• col1 ä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»ï¼ˆ col1=5,id=5) åˆ°ï¼ˆ col1=10,id=30) è¿™ä¸ªå‰å¼€åé—­åŒºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135025045-16577778257713.png" alt="image-20220714135025045" style="zoom:67%;" /><p>è¿™ä¸ªä¾‹å­å¯¹æˆ‘ä»¬å®è·µçš„æŒ‡å¯¼æ„ä¹‰å°±æ˜¯ï¼Œ åœ¨åˆ é™¤æ•°æ®çš„æ—¶å€™å°½é‡åŠ  limit ã€‚</p><p>è¿™æ ·ä¸ä»…å¯ä»¥æ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°ï¼Œè®©æ“ä½œæ›´å®‰å…¨ï¼Œè¿˜å¯ä»¥å‡å°åŠ é”çš„èŒƒå›´ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-8"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135047760.png" alt="image-20220714135047760" style="zoom:67%;" /><ol><li>session A å¯åŠ¨äº‹åŠ¡åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ  lock in share mode ï¼Œåœ¨ç´¢å¼• col1 ä¸ŠåŠ äº† next-keylock(5,10] å’Œ é—´éš™é” (10,15) ï¼ˆç´¢å¼•å‘å³éå†é€€åŒ–ä¸ºé—´éš™é”ï¼‰ï¼›</li><li>session B çš„ update è¯­å¥ä¹Ÿè¦åœ¨ç´¢å¼• c ä¸ŠåŠ  next-key lock(5,10] ï¼Œè¿›å…¥é”ç­‰å¾…ï¼› å®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œ å…ˆæ˜¯åŠ  (5,10) çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ  col1=10 çš„è¡Œé”ï¼Œå› ä¸ºsessionAä¸Šå·²ç»ç»™è¿™è¡ŒåŠ ä¸Šäº†è¯» é”ï¼Œæ­¤æ—¶ç”³è¯·æ­»é”æ—¶ä¼šè¢«é˜»å¡</li><li>ç„¶å session A è¦å†æ’å…¥ (8,8,8) è¿™ä¸€è¡Œï¼Œè¢« session B çš„é—´éš™é”é”ä½ã€‚ç”±äºå‡ºç°äº†æ­»é”ï¼Œ InnoDB è®© session B å›æ»š</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-9"><p><mark class="hl-label blue">æ¡ˆä¾‹ä¹ï¼šorderbyç´¢å¼•æ’åºçš„é—´éš™é”1</mark></p><p>å¦‚ä¸‹é¢ä¸€æ¡è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">&gt;</span><span class="number">9</span> <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="number">12</span> <span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">desc</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾ä¸ºè¿™ä¸ªè¡¨çš„ç´¢å¼•idçš„ç¤ºæ„å›¾ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135130668.png" alt="image-20220714135130668"></p><ol><li>é¦–å…ˆè¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰æ˜¯ order by id desc ï¼Œè¦æ‹¿åˆ°æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œä¼˜åŒ–å™¨å¿…é¡»å…ˆæ‰¾åˆ° â€œ ç¬¬ ä¸€ä¸ª id&lt;12 çš„å€¼ â€ ã€‚</li><li>è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ç´¢å¼•æ ‘çš„æœç´¢è¿‡ç¨‹å¾—åˆ°çš„ï¼Œåœ¨å¼•æ“å†…éƒ¨ï¼Œå…¶å®æ˜¯è¦æ‰¾åˆ° id=12 çš„è¿™ä¸ªå€¼ï¼Œåªæ˜¯æœ€ç»ˆ æ²¡æ‰¾åˆ°ï¼Œä½†æ‰¾åˆ°äº† (10,15) è¿™ä¸ªé—´éš™ã€‚ï¼ˆ id=15 ä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥ next-key lock é€€åŒ–ä¸ºäº†é—´éš™é” (10, 15) ã€‚ï¼‰</li><li>ç„¶åå‘å·¦éå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå°±ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢äº†ï¼Œä¼šæ‰«æåˆ° id=5 è¿™ä¸€è¡Œï¼Œåˆå› ä¸ºåŒºé—´æ˜¯å·¦å¼€å³ é—­çš„ï¼Œæ‰€ä»¥ä¼šåŠ ä¸€ä¸ªnext-key lock (0,5] ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ ‘æœç´¢çš„æ–¹å¼å®šä½è®°å½• çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ â€œ ç­‰å€¼æŸ¥è¯¢ â€ çš„æ–¹æ³•ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-10"><p><mark class="hl-label blue">æ¡ˆä¾‹åï¼šorderbyç´¢å¼•æ’åºçš„é—´éš™é”2</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135206504.png" alt="image-20220714135206504" style="zoom: 67%;" /><ol><li><p>ç”±äºæ˜¯ order by col1 desc ï¼Œç¬¬ä¸€ä¸ªè¦å®šä½çš„æ˜¯ç´¢å¼• col1 ä¸Š â€œ æœ€å³è¾¹çš„ â€col1=20 çš„è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªéå”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼š</p><p>å·¦å¼€å³é—­åŒºé—´ï¼Œé¦–å…ˆåŠ ä¸Š next-key lock (15,20] ã€‚ å‘å³éå†ï¼Œcol1=25ä¸æ»¡è¶³æ¡ä»¶ï¼Œé€€åŒ–ä¸ºé—´éš™é” æ‰€ä»¥ä¼š åŠ ä¸Šé—´éš™é”(20,25) å’Œ next-key lock (15,20] ã€‚</p></li><li><p>åœ¨ç´¢å¼• col1 ä¸Šå‘å·¦éå†ï¼Œè¦æ‰«æåˆ° col1=10 æ‰åœä¸‹æ¥ã€‚åŒæ—¶åˆå› ä¸ºå·¦å¼€å³é—­åŒºé—´ï¼Œæ‰€ä»¥ next-key lock ä¼šåŠ åˆ° (5,10] ï¼Œè¿™æ­£æ˜¯é˜»å¡session B çš„ insert è¯­å¥çš„åŸå› ã€‚</p></li><li><p>åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼Œ col1=20 ã€ col1=15 ã€ col1=10 è¿™ä¸‰è¡Œéƒ½å­˜åœ¨å€¼ï¼Œç”±äºæ˜¯ select * ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸»é”® id ä¸ŠåŠ ä¸‰ä¸ªè¡Œé”ã€‚ å› æ­¤ï¼Œ session A çš„ select è¯­å¥é”çš„èŒƒå›´å°±æ˜¯ï¼š</p><ol><li>ç´¢å¼• col1 ä¸Š (5, 25) ï¼›</li><li>ä¸»é”®ç´¢å¼•ä¸Š id=15 ã€ 20 ä¸¤ä¸ªè¡Œé”ã€‚</li></ol></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-11"><p><mark class="hl-label blue">æ¡ˆä¾‹åä¸€ï¼šupdateä¿®æ”¹æ•°æ®çš„ä¾‹å­-å…ˆæ’å…¥ååˆ é™¤</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135300189.png" alt="image-20220714135300189" style="zoom:67%;" /><p>æ³¨æ„ï¼šæ ¹æ® col1&gt;5 æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªè®°å½•æ˜¯ col1=10 ï¼Œå› æ­¤ä¸ä¼šåŠ  (0,5] è¿™ä¸ª next-key lock ã€‚</p><p>session A çš„åŠ é”èŒƒå›´æ˜¯ç´¢å¼• col1 ä¸Šçš„ (5,10] ã€ (10,15] ã€ (15,20] ã€ (20,25] å’Œ(25,supremum] ã€‚</p><p>ä¹‹å session B çš„ç¬¬ä¸€ä¸ª update è¯­å¥ï¼Œè¦æŠŠ col1=5 æ”¹æˆ col1=1 ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼š</p><ol><li>æ’å…¥ (col1=1, id=5) è¿™ä¸ªè®°å½•ï¼›</li><li>åˆ é™¤ (col1=5, id=5) è¿™ä¸ªè®°å½•ã€‚</li></ol><p>é€šè¿‡è¿™ä¸ªæ“ä½œï¼Œ session A çš„åŠ é”èŒƒå›´å˜æˆäº†å›¾ 7 æ‰€ç¤ºçš„æ ·å­:</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135333089.png" alt="image-20220714135333089" style="zoom:67%;" /><p>å¥½ï¼Œæ¥ä¸‹æ¥ session B è¦æ‰§è¡Œ update t set col1 = 5 where col1 = 1 è¿™ä¸ªè¯­å¥äº†ï¼Œä¸€æ ·åœ°å¯ä»¥æ‹†æˆä¸¤æ­¥ï¼š</p><ol><li>æ’å…¥ (col1=5, id=5) è¿™ä¸ªè®°å½•ï¼›</li><li>åˆ é™¤ (col1=1, id=5) è¿™ä¸ªè®°å½•ã€‚ ç¬¬ä¸€æ­¥è¯•å›¾åœ¨å·²ç»åŠ äº†é—´éš™é”çš„ (1,10) ä¸­æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥å°±è¢«å µä½äº†ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;é”&lt;/code&gt;æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹&lt;code&gt;å¹¶å‘è®¿é—®æŸä¸€èµ„æº&lt;/code&gt;çš„æœºåˆ¶ã€‚åœ¨ç¨‹åºå¼€å‘ä¸­ä¼šå­˜åœ¨å¤šçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ä¸€äº›æ•æ„Ÿçš„æ•°æ®ï¼ˆæ¯”å¦‚è®¢å•ã€é‡‘é¢ç­‰ï¼‰ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¿è¯è¿™ä¸ªæ•°æ®åœ¨ä»»ä½•æ—¶åˆ»&lt;code&gt;æœ€å¤šåªæœ‰ä¸€</summary>
      
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
</feed>
