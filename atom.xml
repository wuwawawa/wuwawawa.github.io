<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LuckyBoyğŸ¥</title>
  
  
  <link href="https://wuwawawa.github.io/atom.xml" rel="self"/>
  
  <link href="https://wuwawawa.github.io/"/>
  <updated>2023-04-18T07:12:30.420Z</updated>
  <id>https://wuwawawa.github.io/</id>
  
  <author>
    <name>LuckyBoyğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ•°æ®å¤‡ä»½ä¸æ¢å¤</title>
    <link href="https://wuwawawa.github.io/posts/73985825.html"/>
    <id>https://wuwawawa.github.io/posts/73985825.html</id>
    <published>2023-04-21T06:33:21.000Z</published>
    <updated>2023-04-18T07:12:30.420Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä»»ä½•æ•°æ®åº“ç¯å¢ƒä¸­ï¼Œæ€»ä¼šæœ‰<code>ä¸ç¡®å®šçš„æ„å¤–</code>æƒ…å†µå‘ç”Ÿï¼Œæ¯”å¦‚ä¾‹å¤–çš„åœç”µã€è®¡ç®—æœºç³»ç»Ÿä¸­çš„å„ç§è½¯ç¡¬ä»¶æ•…éšœã€äººä¸ºç ´åã€ç®¡ç†å‘˜è¯¯æ“ä½œç­‰æ˜¯ä¸å¯é¿å…çš„ï¼Œè¿™äº›æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´<code>æ•°æ®çš„ä¸¢å¤±</code>ã€<code>æœåŠ¡å™¨ç˜«ç—ª</code>ç­‰ä¸¥é‡çš„åæœã€‚å­˜åœ¨å¤šä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šå‡ºç°ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥é—®é¢˜ã€‚</p><p>ä¸ºäº†æœ‰æ•ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå¹¶å°†æŸå¤±é™åˆ°æœ€ä½ï¼Œåº”å®šæœŸå¯¹MySQLæ•°æ®åº“æœåŠ¡å™¨åšå¤‡ä»½ã€‚å¦‚æœæ•°æ®åº“ä¸­çš„æ•°æ®ä¸¢å¤±æˆ–è€…å‡ºç°é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨å¤‡ä»½çš„æ•°æ®è¿›è¡Œæ¢å¤ã€‚ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥é—®é¢˜å¯ä»¥é€šè¿‡å¤åˆ¶åŠŸèƒ½å®ç°ã€‚</p><h2 id="1-ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½">1. ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½</h2><p>**ç‰©ç†å¤‡ä»½ï¼š**å¤‡ä»½æ•°æ®æ–‡ä»¶ï¼Œè½¬å‚¨æ•°æ®åº“ç‰©ç†æ–‡ä»¶åˆ°æŸä¸€ç›®å½•ã€‚ç‰©ç†å¤‡ä»½æ¢å¤é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼ŒMySQLä¸­å¯ä»¥ç”¨ <code>xtrabackup</code> å·¥å…·æ¥è¿›è¡Œç‰©ç†å¤‡ä»½ã€‚</p><p>**é€»è¾‘å¤‡ä»½ï¼š**å¯¹æ•°æ®åº“å¯¹è±¡åˆ©ç”¨å·¥å…·è¿›è¡Œå¯¼å‡ºå·¥ä½œï¼Œæ±‡æ€»å…¥å¤‡ä»½æ–‡ä»¶å†…ã€‚é€»è¾‘å¤‡ä»½æ¢å¤é€Ÿåº¦æ…¢ï¼Œä½†å ç”¨ç©ºé—´å°ï¼Œæ›´çµæ´»ã€‚MySQL ä¸­å¸¸ç”¨çš„é€»è¾‘å¤‡ä»½å·¥å…·ä¸º <code>mysqldump</code> ã€‚é€»è¾‘å¤‡ä»½å°±æ˜¯ <code>å¤‡ä»½sqlè¯­å¥</code> ï¼Œåœ¨æ¢å¤çš„æ—¶å€™æ‰§è¡Œå¤‡ä»½çš„sqlè¯­å¥å®ç°æ•°æ®åº“æ•°æ®çš„é‡ç°ã€‚</p><hr><h2 id="2-mysqldumpå®ç°é€»è¾‘å¤‡ä»½">2. mysqldumpå®ç°é€»è¾‘å¤‡ä»½</h2><p>mysqldumpæ˜¯MySQLæä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ•°æ®åº“å¤‡ä»½å·¥å…·ã€‚</p><h3 id="2-1-å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“">2.1 å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“</h3><p>mysqldumpå‘½ä»¤æ‰§è¡Œæ—¶ï¼Œå¯ä»¥å°†æ•°æ®åº“å¤‡ä»½æˆä¸€ä¸ª<code>æ–‡æœ¬æ–‡ä»¶</code>ï¼Œè¯¥æ–‡ä»¶ä¸­å®é™…ä¸ŠåŒ…å«å¤šä¸ª<code>CREATE</code>å’Œ<code>INSERT</code>è¯­å¥ï¼Œä½¿ç”¨è¿™äº›è¯­å¥å¯ä»¥é‡æ–°åˆ›å»ºè¡¨å’Œæ’å…¥æ•°æ®ã€‚</p><ul><li>æŸ¥å‡ºéœ€è¦å¤‡ä»½çš„è¡¨çš„ç»“æ„ï¼Œåœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ªCREATEè¯­å¥</li><li>å°†è¡¨ä¸­çš„æ‰€æœ‰è®°å½•è½¬æ¢ä¸ºä¸€æ¡INSERTè¯­å¥ã€‚</li></ul><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump â€“u ç”¨æˆ·åç§° â€“h ä¸»æœºåç§° â€“på¯†ç  å¾…å¤‡ä»½çš„æ•°æ®åº“åç§°[tbname, [tbname...]]<span class="operator">&gt;</span> å¤‡ä»½æ–‡ä»¶åç§°.<span class="keyword">sql</span></span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š å¤‡ä»½çš„æ–‡ä»¶å¹¶éä¸€å®šè¦æ±‚åç¼€åä¸º.sqlï¼Œä¾‹å¦‚åç¼€åä¸º.txtçš„æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p></blockquote><p>ä¸¾ä¾‹ï¼šä½¿ç”¨rootç”¨æˆ·å¤‡ä»½atguiguæ•°æ®åº“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu<span class="operator">&gt;</span>atguigu.sql #å¤‡ä»½æ–‡ä»¶å­˜å‚¨åœ¨å½“å‰ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigudb1 <span class="operator">&gt;</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu.sql</span><br></pre></td></tr></table></figure><p>å¤‡ä»½æ–‡ä»¶å‰–æï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL dump 10.13 Distrib 8.0.26, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: localhost Database: atguigu</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version 8.0.26</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET NAMES utf8mb4 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;NO_AUTO_VALUE_ON_ZERO&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Current Database: `atguigu`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE <span class="comment">/*!32312 IF NOT EXISTS*/</span> `atguigu` <span class="comment">/*!40100 DEFAULT CHARACTER SET</span></span><br><span class="line"><span class="comment">utf8mb4 COLLATE utf8mb4_0900_ai_ci */</span> <span class="comment">/*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */</span>;</span><br><span class="line"></span><br><span class="line">USE `atguigu`;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `student`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `student`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET character_set_client = utf8mb4 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">`studentno` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`class` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`studentno`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;å¼ ä¸‰_back&#x27;</span>,<span class="string">&#x27;ä¸€ç­&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;æå››&#x27;</span>,<span class="string">&#x27;ä¸€ç­&#x27;</span>),(<span class="number">8</span>,<span class="string">&#x27;ç‹äº”&#x27;</span>,<span class="string">&#x27;äºŒç­&#x27;</span>),</span><br><span class="line">(<span class="number">15</span>,<span class="string">&#x27;èµµå…­&#x27;</span>,<span class="string">&#x27;äºŒç­&#x27;</span>),(<span class="number">20</span>,<span class="string">&#x27;é’±ä¸ƒ&#x27;</span>,<span class="string">&#x27;&gt;ä¸‰ç­&#x27;</span>),(<span class="number">22</span>,<span class="string">&#x27;zhang3_update&#x27;</span>,<span class="string">&#x27;1ban&#x27;</span>),(<span class="number">24</span>,<span class="string">&#x27;wang5&#x27;</span>,<span class="string">&#x27;2ban&#x27;</span>);</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `student` ENABLE KEYS */</span>;</span><br><span class="line">UNLOCK TABLES;</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;</span><br><span class="line"><span class="comment">-- Dump completed on 2022-01-07 9:58:23</span></span><br></pre></td></tr></table></figure><h3 id="2-2-å¤‡ä»½å…¨éƒ¨æ•°æ®åº“">2.2 å¤‡ä»½å…¨éƒ¨æ•°æ®åº“</h3><p>è‹¥æƒ³ç”¨mysqldumpå¤‡ä»½æ•´ä¸ªå®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ --all-databases æˆ– -A å‚æ•°ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>pxxxxxx <span class="comment">--all-databases &gt; all_database.sql</span></span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>pxxxxxx <span class="operator">-</span>A <span class="operator">&gt;</span> all_database.sql</span><br></pre></td></tr></table></figure><h3 id="2-3-å¤‡ä»½éƒ¨åˆ†æ•°æ®åº“">2.3 å¤‡ä»½éƒ¨åˆ†æ•°æ®åº“</h3><p>ä½¿ç”¨ <code>--databases</code> æˆ– <code>-B</code> å‚æ•°äº†ï¼Œè¯¥å‚æ•°åé¢è·Ÿæ•°æ®åº“åç§°ï¼Œå¤šä¸ªæ•°æ®åº“é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚å¦‚æœæŒ‡å®š databaseså‚æ•°ï¼Œå¤‡ä»½æ–‡ä»¶ä¸­ä¼šå­˜åœ¨åˆ›å»ºæ•°æ®åº“çš„è¯­å¥ï¼Œå¦‚æœä¸æŒ‡å®šå‚æ•°ï¼Œåˆ™ä¸å­˜åœ¨ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump â€“u <span class="keyword">user</span> â€“h host â€“p <span class="comment">--databases [æ•°æ®åº“çš„åç§°1 [æ•°æ®åº“çš„åç§°2...]] &gt; å¤‡ä»½æ–‡ä»¶åç§°.sql</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--databases atguigu atguigu12 &gt;two_database.sql</span></span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>B atguigu atguigu12 <span class="operator">&gt;</span> two_database.sql</span><br></pre></td></tr></table></figure><h3 id="2-4-å¤‡ä»½éƒ¨åˆ†è¡¨">2.4 å¤‡ä»½éƒ¨åˆ†è¡¨</h3><p>æ¯”å¦‚ï¼Œåœ¨è¡¨å˜æ›´å‰åšä¸ªå¤‡ä»½ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump â€“u <span class="keyword">user</span> â€“h host â€“p æ•°æ®åº“çš„åç§° [è¡¨å<span class="number">1</span> [è¡¨å<span class="number">2.</span>..]] <span class="operator">&gt;</span> å¤‡ä»½æ–‡ä»¶åç§°.<span class="keyword">sql</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šå¤‡ä»½atguiguæ•°æ®åº“ä¸‹çš„bookè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu book<span class="operator">&gt;</span> book.sql</span><br></pre></td></tr></table></figure><p>book.sqlæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu book<span class="operator">&gt;</span> book.sql<span class="operator">^</span>C</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# ls</span><br><span class="line">kk kubekey kubekey<span class="operator">-</span>v1<span class="number">.1</span><span class="number">.1</span><span class="operator">-</span>linux<span class="operator">-</span>amd64.tar.gz README.md test1.sql two_database.sql</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu book<span class="operator">&gt;</span> book.sql</span><br><span class="line">Enter password:</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# ls</span><br><span class="line">book.sql kk kubekey kubekey<span class="operator">-</span>v1<span class="number">.1</span><span class="number">.1</span><span class="operator">-</span>linux<span class="operator">-</span>amd64.tar.gz README.md test1.sql</span><br><span class="line">two_database.sql</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# vi book.sql</span><br><span class="line"><span class="comment">-- MySQL dump 10.13 Distrib 8.0.26, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: localhost Database: atguigu</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version 8.0.26</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET NAMES utf8mb4 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;NO_AUTO_VALUE_ON_ZERO&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `book`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `book`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET character_set_client = utf8mb4 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `book` (</span><br><span class="line">`bookid` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`card` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`test` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`bookid`),</span><br><span class="line">KEY `Y` (`card`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">101</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Dumping data for table `book`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line">LOCK TABLES `book` WRITE;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `book` DISABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `book` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">9</span>,<span class="keyword">NULL</span>),(<span class="number">2</span>,<span class="number">10</span>,<span class="keyword">NULL</span>),(<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">4</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">5</span>,<span class="number">7</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="number">10</span>,<span class="keyword">NULL</span>),(<span class="number">7</span>,<span class="number">11</span>,<span class="keyword">NULL</span>),(<span class="number">8</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">9</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">10</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),(<span class="number">11</span>,<span class="number">19</span>,<span class="keyword">NULL</span>),(<span class="number">12</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">13</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">14</span>,<span class="number">14</span>,<span class="keyword">NULL</span>),(<span class="number">15</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">16</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">17</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">18</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">19</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">20</span>,<span class="number">11</span>,<span class="keyword">NULL</span>),(<span class="number">21</span>,<span class="number">9</span>,<span class="keyword">NULL</span>),(<span class="number">22</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">23</span>,<span class="number">13</span>,<span class="keyword">NULL</span>),(<span class="number">24</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">25</span>,<span class="number">18</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">26</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">27</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">28</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">29</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">30</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">31</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">32</span>,<span class="number">11</span>,<span class="keyword">NULL</span>),(<span class="number">33</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">34</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">35</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">36</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">37</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">38</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">39</span>,<span class="number">16</span>,<span class="keyword">NULL</span>),(<span class="number">40</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">41</span>,<span class="number">18</span>,<span class="keyword">NULL</span>),(<span class="number">42</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">43</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">44</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">45</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">46</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">47</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">48</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),(<span class="number">49</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">50</span>,<span class="number">16</span>,<span class="keyword">NULL</span>),(<span class="number">51</span>,<span class="number">13</span>,<span class="keyword">NULL</span>),(<span class="number">52</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),(<span class="number">53</span>,<span class="number">7</span>,<span class="keyword">NULL</span>),(<span class="number">54</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">55</span>,<span class="number">9</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">56</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">57</span>,<span class="number">14</span>,<span class="keyword">NULL</span>),(<span class="number">58</span>,<span class="number">7</span>,<span class="keyword">NULL</span>),(<span class="number">59</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">60</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">61</span>,<span class="number">13</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">62</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">63</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">64</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">65</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">66</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">67</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),(<span class="number">68</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">69</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">70</span>,<span class="number">10</span>,<span class="keyword">NULL</span>),(<span class="number">71</span>,<span class="number">16</span>,<span class="keyword">NULL</span>),(<span class="number">72</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">73</span>,<span class="number">14</span>,<span class="keyword">NULL</span>),(<span class="number">74</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">75</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">76</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">77</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">78</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">79</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">80</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">81</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">82</span>,<span class="number">14</span>,<span class="keyword">NULL</span>),(<span class="number">83</span>,<span class="number">5</span>,<span class="keyword">NULL</span>),(<span class="number">84</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">85</span>,<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">86</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">87</span>,<span class="number">12</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">88</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">89</span>,<span class="number">8</span>,<span class="keyword">NULL</span>),(<span class="number">90</span>,<span class="number">18</span>,<span class="keyword">NULL</span>),(<span class="number">91</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">92</span>,<span class="number">3</span>,<span class="keyword">NULL</span>),(<span class="number">93</span>,<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">94</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">95</span>,<span class="number">4</span>,<span class="keyword">NULL</span>),(<span class="number">96</span>,<span class="number">17</span>,<span class="keyword">NULL</span>),(<span class="number">97</span>,<span class="number">15</span>,<span class="keyword">NULL</span>),(<span class="number">98</span>,<span class="number">1</span>,<span class="keyword">NULL</span>),(<span class="number">99</span>,<span class="number">20</span>,<span class="keyword">NULL</span>),(<span class="number">100</span>,<span class="number">15</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `book` ENABLE KEYS */</span>;</span><br><span class="line">UNLOCK TABLES;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œbookæ–‡ä»¶å’Œå¤‡ä»½çš„åº“æ–‡ä»¶ç±»ä¼¼ã€‚ä¸åŒçš„æ˜¯ï¼Œbookæ–‡ä»¶åªåŒ…å«bookè¡¨çš„DROPã€CREATEå’Œ INSERTè¯­å¥ã€‚</p><p>å¤‡ä»½å¤šå¼ è¡¨ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œæ¯”å¦‚å¤‡ä»½bookå’Œaccountè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#å¤‡ä»½å¤šå¼ è¡¨</span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu book account <span class="operator">&gt;</span> <span class="number">2</span>_tables_bak.sql</span><br></pre></td></tr></table></figure><h3 id="2-5-å¤‡ä»½å•è¡¨çš„éƒ¨åˆ†æ•°æ®">2.5 å¤‡ä»½å•è¡¨çš„éƒ¨åˆ†æ•°æ®</h3><p>æœ‰äº›æ—¶å€™ä¸€å¼ è¡¨çš„æ•°æ®é‡å¾ˆå¤§ï¼Œæˆ‘ä»¬åªéœ€è¦éƒ¨åˆ†æ•°æ®ã€‚è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ --where é€‰é¡¹äº†ã€‚whereåé¢é™„å¸¦éœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p><p>ä¸¾ä¾‹ï¼šå¤‡ä»½studentè¡¨ä¸­idå°äº10çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu student <span class="comment">--where=&quot;id &lt; 10 &quot; &gt; student_part_id10_low_bak.sql</span></span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼Œinsertè¯­å¥åªæœ‰idå°äº10çš„éƒ¨åˆ†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LOCK TABLES `student` WRITE;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `student` DISABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">100002</span>,<span class="string">&#x27;JugxTY&#x27;</span>,<span class="number">157</span>,<span class="number">280</span>),(<span class="number">2</span>,<span class="number">100003</span>,<span class="string">&#x27;QyUcCJ&#x27;</span>,<span class="number">251</span>,<span class="number">277</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="number">100004</span>,<span class="string">&#x27;lATUPp&#x27;</span>,<span class="number">80</span>,<span class="number">404</span>),(<span class="number">4</span>,<span class="number">100005</span>,<span class="string">&#x27;BmFsXI&#x27;</span>,<span class="number">240</span>,<span class="number">171</span>),(<span class="number">5</span>,<span class="number">100006</span>,<span class="string">&#x27;mkpSwJ&#x27;</span>,<span class="number">388</span>,<span class="number">476</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="number">100007</span>,<span class="string">&#x27;ujMgwN&#x27;</span>,<span class="number">259</span>,<span class="number">124</span>),(<span class="number">7</span>,<span class="number">100008</span>,<span class="string">&#x27;HBJTqX&#x27;</span>,<span class="number">429</span>,<span class="number">168</span>),(<span class="number">8</span>,<span class="number">100009</span>,<span class="string">&#x27;dvQSQA&#x27;</span>,<span class="number">61</span>,<span class="number">504</span>),</span><br><span class="line">(<span class="number">9</span>,<span class="number">100010</span>,<span class="string">&#x27;HljpVJ&#x27;</span>,<span class="number">234</span>,<span class="number">185</span>);</span><br></pre></td></tr></table></figure><h3 id="2-6-æ’é™¤æŸäº›è¡¨çš„å¤‡ä»½">2.6 æ’é™¤æŸäº›è¡¨çš„å¤‡ä»½</h3><p>å¦‚æœæˆ‘ä»¬æƒ³å¤‡ä»½æŸä¸ªåº“ï¼Œä½†æ˜¯æŸäº›è¡¨æ•°æ®é‡å¾ˆå¤§æˆ–è€…ä¸ä¸šåŠ¡å…³è”ä¸å¤§ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘æ’é™¤æ‰è¿™äº›è¡¨ï¼ŒåŒæ ·çš„ï¼Œé€‰é¡¹ <code>--ignore-table</code> å¯ä»¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu <span class="comment">--ignore-table=atguigu.student &gt; no_stu_bak.sql</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡å¦‚ä¸‹æŒ‡å®šåˆ¤å®šæ–‡ä»¶ä¸­æ²¡æœ‰studentè¡¨ç»“æ„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;student&quot; no_stu_bak.sql</span><br></pre></td></tr></table></figure><h3 id="2-7-åªå¤‡ä»½ç»“æ„æˆ–åªå¤‡ä»½æ•°æ®">2.7 åªå¤‡ä»½ç»“æ„æˆ–åªå¤‡ä»½æ•°æ®</h3><p>åªå¤‡ä»½ç»“æ„çš„è¯å¯ä»¥ä½¿ç”¨ <code>--no-data</code> ç®€å†™ä¸º <code>-d</code> é€‰é¡¹ï¼›åªå¤‡ä»½æ•°æ®å¯ä»¥ä½¿ç”¨ <code>--no-create-info</code> ç®€å†™ä¸º <code>-t</code>é€‰é¡¹ã€‚</p><ul><li><p>åªå¤‡ä»½ç»“æ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu <span class="comment">--no-data &gt; atguigu_no_data_bak.sql</span></span><br><span class="line">#ä½¿ç”¨grepå‘½ä»¤ï¼Œæ²¡æœ‰æ‰¾åˆ°<span class="keyword">insert</span>ç›¸å…³è¯­å¥ï¼Œè¡¨ç¤ºæ²¡æœ‰æ•°æ®å¤‡ä»½ã€‚</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# grep &quot;INSERT&quot; atguigu_no_data_bak.sql</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]#</span><br></pre></td></tr></table></figure></li><li><p>åªå¤‡ä»½æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu <span class="comment">--no-create-info &gt; atguigu_no_create_info_bak.sql</span></span><br><span class="line">#ä½¿ç”¨grepå‘½ä»¤ï¼Œæ²¡æœ‰æ‰¾åˆ°<span class="keyword">create</span>ç›¸å…³è¯­å¥ï¼Œè¡¨ç¤ºæ²¡æœ‰æ•°æ®ç»“æ„ã€‚</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# grep &quot;CREATE&quot; atguigu_no_create_info_bak.sql</span><br><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]#</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-8-å¤‡ä»½ä¸­åŒ…å«å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶">2.8 å¤‡ä»½ä¸­åŒ…å«å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶</h3><p>mysqldumpå¤‡ä»½é»˜è®¤æ˜¯ä¸åŒ…å«å­˜å‚¨è¿‡ç¨‹ï¼Œè‡ªå®šä¹‰å‡½æ•°åŠäº‹ä»¶çš„ã€‚å¯ä»¥ä½¿ç”¨ <code>--routines</code> æˆ– <code>-R</code> é€‰é¡¹æ¥å¤‡ä»½å­˜å‚¨è¿‡ç¨‹åŠå‡½æ•°ï¼Œä½¿ç”¨ <code>--events</code> æˆ– <code>-E</code> å‚æ•°æ¥å¤‡ä»½äº‹ä»¶ã€‚</p><p>ä¸¾ä¾‹ï¼šå¤‡ä»½æ•´ä¸ªatguiguåº“ï¼ŒåŒ…å«å­˜å‚¨è¿‡ç¨‹åŠäº‹ä»¶ï¼š</p><ul><li>ä½¿ç”¨ä¸‹é¢çš„SQLå¯ä»¥æŸ¥çœ‹å½“å‰åº“æœ‰å“ªäº›å­˜å‚¨è¿‡ç¨‹æˆ–è€…å‡½æ•°</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SPECIFIC_NAME,ROUTINE_TYPE ,ROUTINE_SCHEMA <span class="keyword">FROM</span></span><br><span class="line">information_schema.Routines <span class="keyword">WHERE</span> ROUTINE_SCHEMA<span class="operator">=</span>&quot;atguigu&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> SPECIFIC_NAME <span class="operator">|</span> ROUTINE_TYPE <span class="operator">|</span> ROUTINE_SCHEMA <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> rand_num      <span class="operator">|</span> <span class="keyword">FUNCTION</span>     <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> rand_string   <span class="operator">|</span> <span class="keyword">FUNCTION</span>     <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BatchInsert   <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> insert_class  <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> insert_order  <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> insert_stu    <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> insert_user   <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ts_insert     <span class="operator">|</span> <span class="keyword">PROCEDURE</span>    <span class="operator">|</span> atguigu        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------------+----------------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¤‡ä»½atguiguåº“çš„æ•°æ®ï¼Œå‡½æ•°ä»¥åŠå­˜å‚¨è¿‡ç¨‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>R <span class="operator">-</span>E <span class="comment">--databases atguigu &gt; fun_atguigu_bak.sql</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å¤‡ä»½æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®åŒ…å«äº†å‡½æ•°ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="operator">-</span>C <span class="number">5</span> &quot;rand_num&quot; fun_atguigu_bak.sql</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Dumping routines for database &#x27;atguigu&#x27;</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">/*!50003 DROP FUNCTION IF EXISTS `rand_num` */</span>;</span><br><span class="line"><span class="comment">/*!50003 SET @saved_cs_client = @@character_set_client */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET @saved_cs_results = @@character_set_results */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET @saved_col_connection = @@collation_connection */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET character_set_client = utf8mb3 */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET character_set_results = utf8mb3 */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET collation_connection = utf8_general_ci */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET @saved_sql_mode = @@sql_mode */</span> ;</span><br><span class="line"><span class="comment">/*!50003 SET sql_mode =</span></span><br><span class="line"><span class="comment">&#x27;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISIO</span></span><br><span class="line"><span class="comment">N_BY_ZERO,NO_ENGINE_SUBSTITUTION&#x27; */</span> ;</span><br><span class="line">DELIMITER ;;</span><br><span class="line"><span class="keyword">CREATE</span> DEFINER<span class="operator">=</span>`root`@`<span class="operator">%</span>` <span class="keyword">FUNCTION</span> `rand_num`(from_num <span class="type">BIGINT</span> ,to_num <span class="type">BIGINT</span>) <span class="keyword">RETURNS</span></span><br><span class="line"><span class="type">bigint</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> <span class="built_in">FLOOR</span>(from_num <span class="operator">+</span>RAND()<span class="operator">*</span>(to_num <span class="operator">-</span> from_num<span class="operator">+</span><span class="number">1</span>)) ;</span><br><span class="line"><span class="keyword">RETURN</span> i;</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    REPEAT</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> class ( classname,address,monitor ) <span class="keyword">VALUES</span></span><br><span class="line">    (rand_string(<span class="number">8</span>),rand_string(<span class="number">10</span>),rand_num());</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">    REPEAT #å¾ªç¯</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; #èµ‹å€¼</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_test (order_id, trans_id ) <span class="keyword">VALUES</span></span><br><span class="line">    (rand_num(<span class="number">1</span>,<span class="number">7000000</span>),rand_num(<span class="number">100000000000000000</span>,<span class="number">700000000000000000</span>));</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>; #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">    REPEAT #å¾ªç¯</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; #èµ‹å€¼</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> student (stuno, name ,age ,classId ) <span class="keyword">VALUES</span></span><br><span class="line">    ((<span class="keyword">START</span><span class="operator">+</span>i),rand_string(<span class="number">6</span>),rand_num(),rand_num());</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>; #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    REPEAT</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` ( name,age,sex ) <span class="keyword">VALUES</span> (&quot;atguigu&quot;,rand_num(<span class="number">1</span>,<span class="number">20</span>),&quot;male&quot;);</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h3 id="2-9-mysqldumpå¸¸ç”¨é€‰é¡¹">2.9 mysqldumpå¸¸ç”¨é€‰é¡¹</h3><p>mysqldumpå…¶ä»–å¸¸ç”¨é€‰é¡¹å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--add-drop-databaseï¼šåœ¨æ¯ä¸ªCREATE DATABASEè¯­å¥å‰æ·»åŠ DROP DATABASEè¯­å¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--add-drop-tablesï¼šåœ¨æ¯ä¸ªCREATE TABLEè¯­å¥å‰æ·»åŠ DROP TABLEè¯­å¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--add-lockingï¼šç”¨LOCK TABLESå’ŒUNLOCK TABLESè¯­å¥å¼•ç”¨æ¯ä¸ªè¡¨è½¬å‚¨ã€‚é‡è½½è½¬å‚¨æ–‡ä»¶æ—¶æ’å…¥å¾—æ›´å¿«ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--all-database, -Aï¼šè½¬å‚¨æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ã€‚ä¸ä½¿ç”¨--databaseé€‰é¡¹ç›¸åŒï¼Œåœ¨å‘½ä»¤è¡Œä¸­å‘½åæ‰€æœ‰æ•°æ®åº“ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--comment[=0|1]ï¼šå¦‚æœè®¾ç½®ä¸º0ï¼Œç¦æ­¢è½¬å‚¨æ–‡ä»¶ä¸­çš„å…¶ä»–ä¿¡æ¯ï¼Œä¾‹å¦‚ç¨‹åºç‰ˆæœ¬ã€æœåŠ¡å™¨ç‰ˆæœ¬å’Œä¸»æœºã€‚--skipcommentsä¸--comments=0çš„ç»“æœç›¸åŒã€‚é»˜è®¤å€¼ä¸º1ï¼Œå³åŒ…æ‹¬é¢å¤–ä¿¡æ¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--compactï¼šäº§ç”Ÿå°‘é‡è¾“å‡ºã€‚è¯¥é€‰é¡¹ç¦ç”¨æ³¨é‡Šå¹¶å¯ç”¨--skip-add-drop-tablesã€--no-set-namesã€--skipdisable-keyså’Œ--skip-add-lockingé€‰é¡¹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--compatible=nameï¼šäº§ç”Ÿä¸å…¶ä»–æ•°æ®åº“ç³»ç»Ÿæˆ–æ—§çš„MySQLæœåŠ¡å™¨æ›´å…¼å®¹çš„è¾“å‡ºï¼Œå€¼å¯ä»¥ä¸ºansiã€MySQL323ã€MySQL40ã€postgresqlã€oracleã€mssqlã€db2ã€maxdbã€no_key_optionsã€no_table_optionsæˆ–è€…no_field_optionsã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--complete_insert, -cï¼šä½¿ç”¨åŒ…æ‹¬åˆ—åçš„å®Œæ•´çš„INSERTè¯­å¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--debug[=debug_options], -#[debug_options]ï¼šå†™è°ƒè¯•æ—¥å¿—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--deleteï¼Œ-Dï¼šå¯¼å…¥æ–‡æœ¬æ–‡ä»¶å‰æ¸…ç©ºè¡¨ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--default-character-set=charsetï¼šä½¿ç”¨charsetsé»˜è®¤å­—ç¬¦é›†ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå°±ä½¿ç”¨utf8ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--delete--master-logsï¼šåœ¨ä¸»å¤åˆ¶æœåŠ¡å™¨ä¸Šï¼Œå®Œæˆè½¬å‚¨æ“ä½œååˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å¯ç”¨-masterdataã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--extended-insertï¼Œ-eï¼šä½¿ç”¨åŒ…æ‹¬å‡ ä¸ªVALUESåˆ—è¡¨çš„å¤šè¡ŒINSERTè¯­æ³•ã€‚è¿™æ ·ä½¿å¾—è½¬å‚¨æ–‡ä»¶æ›´å°ï¼Œé‡è½½æ–‡ä»¶æ—¶å¯ä»¥åŠ é€Ÿæ’å…¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--flush-logsï¼Œ-Fï¼šå¼€å§‹è½¬å‚¨å‰åˆ·æ–°MySQLæœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶ã€‚è¯¥é€‰é¡¹è¦æ±‚RELOADæƒé™ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--forceï¼Œ-fï¼šåœ¨è¡¨è½¬å‚¨è¿‡ç¨‹ä¸­ï¼Œå³ä½¿å‡ºç°SQLé”™è¯¯ä¹Ÿç»§ç»­ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--lock-all-tablesï¼Œ-xï¼šå¯¹æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨åŠ é”ã€‚åœ¨æ•´ä½“è½¬å‚¨è¿‡ç¨‹ä¸­é€šè¿‡å…¨å±€é”å®šæ¥å®ç°ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­--single-transactionå’Œ--lock-tablesã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--lock-tablesï¼Œ-lï¼šå¼€å§‹è½¬å‚¨å‰é”å®šæ‰€æœ‰è¡¨ã€‚ç”¨READ LOCALé”å®šè¡¨ä»¥å…è®¸å¹¶è¡Œæ’å…¥MyISAMè¡¨ã€‚å¯¹äºäº‹åŠ¡è¡¨ï¼ˆä¾‹å¦‚InnoDBå’ŒBDBï¼‰ï¼Œ--single-transactionæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰é¡¹ï¼Œå› ä¸ºå®ƒæ ¹æœ¬ä¸éœ€è¦é”å®šè¡¨ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--no-create-dbï¼Œ-nï¼šè¯¥é€‰é¡¹ç¦ç”¨CREATE DATABASE /*!32312 IF NOT EXIST*/db_nameè¯­å¥ï¼Œå¦‚æœç»™å‡º--databaseæˆ–--all-databaseé€‰é¡¹ï¼Œå°±åŒ…å«åˆ°è¾“å‡ºä¸­ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--no-create-infoï¼Œ-tï¼šåªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE TABLEè¯­å¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--no-dataï¼Œ-dï¼šä¸å†™è¡¨çš„ä»»ä½•è¡Œä¿¡æ¯ï¼Œåªè½¬å‚¨è¡¨çš„ç»“æ„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--optï¼šè¯¥é€‰é¡¹æ˜¯é€Ÿè®°ï¼Œå®ƒå¯ä»¥å¿«é€Ÿè¿›è¡Œè½¬å‚¨æ“ä½œå¹¶äº§ç”Ÿä¸€ä¸ªèƒ½å¾ˆå¿«è£…å…¥MySQLæœåŠ¡å™¨çš„è½¬å‚¨æ–‡ä»¶ã€‚è¯¥é€‰é¡¹é»˜è®¤å¼€å¯ï¼Œä½†å¯ä»¥ç”¨--skip-optç¦ç”¨ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--password[=password]ï¼Œ-p[password]ï¼šå½“è¿æ¥æœåŠ¡å™¨æ—¶ä½¿ç”¨çš„å¯†ç ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="operator">-</span>port<span class="operator">=</span>port_numï¼Œ<span class="operator">-</span>P port_numï¼šç”¨äºè¿æ¥çš„TCP<span class="operator">/</span>IPç«¯å£å·ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">--protocol=&#123;TCP|SOCKET|PIPE|MEMORY&#125;ï¼šä½¿ç”¨çš„è¿æ¥åè®®ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--replaceï¼Œ-r â€“replaceå’Œ--ignoreï¼šæ§åˆ¶æ›¿æ¢æˆ–å¤åˆ¶å”¯ä¸€é”®å€¼å·²æœ‰è®°å½•çš„è¾“å…¥è®°å½•çš„å¤„ç†ã€‚å¦‚æœæŒ‡å®š--replaceï¼Œæ–°è¡Œæ›¿æ¢æœ‰ç›¸åŒçš„å”¯ä¸€é”®å€¼çš„å·²æœ‰è¡Œï¼›å¦‚æœæŒ‡å®š--ignoreï¼Œå¤åˆ¶å·²æœ‰çš„å”¯ä¸€é”®å€¼çš„è¾“å…¥è¡Œè¢«è·³è¿‡ã€‚å¦‚æœä¸æŒ‡å®šè¿™ä¸¤ä¸ªé€‰é¡¹ï¼Œå½“å‘ç°ä¸€ä¸ªå¤åˆ¶é”®å€¼æ—¶ä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä¸”å¿½è§†æ–‡æœ¬æ–‡ä»¶çš„å‰©ä½™éƒ¨åˆ†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--silentï¼Œ-sï¼šæ²‰é»˜æ¨¡å¼ã€‚åªæœ‰å‡ºç°é”™è¯¯æ—¶æ‰è¾“å‡ºã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--socket=pathï¼Œ-S pathï¼šå½“è¿æ¥localhostæ—¶ä½¿ç”¨çš„å¥—æ¥å­—æ–‡ä»¶ï¼ˆä¸ºé»˜è®¤ä¸»æœºï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--user=user_nameï¼Œ-u user_nameï¼šå½“è¿æ¥æœåŠ¡å™¨æ—¶MySQLä½¿ç”¨çš„ç”¨æˆ·åã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--verboseï¼Œ-vï¼šå†—é•¿æ¨¡å¼ï¼Œæ‰“å°å‡ºç¨‹åºæ“ä½œçš„è¯¦ç»†ä¿¡æ¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--xmlï¼Œ-Xï¼šäº§ç”ŸXMLè¾“å‡ºã€‚</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œå¸®åŠ©å‘½ä»¤ <code>mysqldump --help</code> ï¼Œå¯ä»¥è·å¾—ç‰¹å®šç‰ˆæœ¬çš„å®Œæ•´é€‰é¡¹åˆ—è¡¨ã€‚</p><blockquote><p>æç¤º å¦‚æœè¿è¡Œmysqldumpæ²¡æœ‰â€“quickæˆ–â€“opté€‰é¡¹ï¼Œmysqldumpåœ¨è½¬å‚¨ç»“æœå‰å°†æ•´ä¸ªç»“æœé›†è£…å…¥å†… å­˜ã€‚å¦‚æœè½¬å‚¨å¤§æ•°æ®åº“å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œè¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œä½†å¯ä»¥ç”¨â€“skip-optç¦ç”¨ã€‚å¦‚æœä½¿ç”¨æœ€ æ–°ç‰ˆæœ¬çš„mysqldumpç¨‹åºå¤‡ä»½æ•°æ®ï¼Œå¹¶ç”¨äºæ¢å¤åˆ°æ¯”è¾ƒæ—§ç‰ˆæœ¬çš„MySQLæœåŠ¡å™¨ä¸­ï¼Œåˆ™ä¸è¦ä½¿ç”¨â€“opt æˆ–-eé€‰é¡¹ã€‚</p></blockquote><hr><h2 id="3-mysqlå‘½ä»¤æ¢å¤æ•°æ®">3. mysqlå‘½ä»¤æ¢å¤æ•°æ®</h2><p>ä½¿ç”¨mysqldumpå‘½ä»¤å°†æ•°æ®åº“ä¸­çš„æ•°æ®å¤‡ä»½æˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚éœ€è¦æ¢å¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>mysqlå‘½ä»¤</code>æ¥æ¢å¤å¤‡ä»½çš„æ•°æ®ã€‚</p><p>mysqlå‘½ä»¤å¯ä»¥æ‰§è¡Œå¤‡ä»½æ–‡ä»¶ä¸­çš„<code>CREATEè¯­å¥</code>å’Œ<code>INSERTè¯­å¥</code>ã€‚é€šè¿‡CREATEè¯­å¥æ¥åˆ›å»ºæ•°æ®åº“å’Œè¡¨ã€‚é€šè¿‡INSERTè¯­å¥æ¥æ’å…¥å¤‡ä»½çš„æ•°æ®ã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql â€“u root â€“p [dbname] <span class="operator">&lt;</span> backup.sql</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œdbnameå‚æ•°è¡¨ç¤ºæ•°æ®åº“åç§°ã€‚è¯¥å‚æ•°æ˜¯å¯é€‰å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šæ•°æ®åº“åï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šã€‚æŒ‡å®šæ•°æ®åº“åæ—¶ï¼Œè¡¨ç¤ºè¿˜åŸè¯¥æ•°æ®åº“ä¸‹çš„è¡¨ã€‚æ­¤æ—¶éœ€è¦ç¡®ä¿MySQLæœåŠ¡å™¨ä¸­å·²ç»åˆ›å»ºäº†è¯¥åçš„æ•°æ®åº“ã€‚ä¸æŒ‡å®šæ•°æ®åº“åï¼Œè¡¨ç¤ºè¿˜åŸæ–‡ä»¶ä¸­æ‰€æœ‰çš„æ•°æ®åº“ã€‚æ­¤æ—¶sqlæ–‡ä»¶ä¸­åŒ…å«æœ‰CREATE DATABASEè¯­å¥ï¼Œä¸éœ€è¦MySQLæœåŠ¡å™¨ä¸­å·²å­˜åœ¨çš„è¿™äº›æ•°æ®åº“ã€‚</p><h3 id="3-1-å•åº“å¤‡ä»½ä¸­æ¢å¤å•åº“">3.1 å•åº“å¤‡ä»½ä¸­æ¢å¤å•åº“</h3><p>ä½¿ç”¨rootç”¨æˆ·ï¼Œå°†ä¹‹å‰ç»ƒä¹ ä¸­å¤‡ä»½çš„atguigu.sqlæ–‡ä»¶ä¸­çš„å¤‡ä»½å¯¼å…¥æ•°æ®åº“ä¸­ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><p>å¦‚æœå¤‡ä»½æ–‡ä»¶ä¸­åŒ…å«äº†åˆ›å»ºæ•°æ®åº“çš„è¯­å¥ï¼Œåˆ™æ¢å¤çš„æ—¶å€™ä¸éœ€è¦æŒ‡å®šæ•°æ®åº“åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">&lt;</span> atguigu.sql</span><br></pre></td></tr></table></figure><p>å¦åˆ™éœ€è¦æŒ‡å®šæ•°æ®åº“åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu4<span class="operator">&lt;</span> atguigu.sql</span><br></pre></td></tr></table></figure><h3 id="3-2-å…¨é‡å¤‡ä»½æ¢å¤">3.2 å…¨é‡å¤‡ä»½æ¢å¤</h3><p>å¦‚æœæˆ‘ä»¬ç°åœ¨æœ‰æ˜¨å¤©çš„å…¨é‡å¤‡ä»½ï¼Œç°åœ¨æƒ³æ•´ä¸ªæ¢å¤ï¼Œåˆ™å¯ä»¥è¿™æ ·æ“ä½œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql â€“u root â€“p <span class="operator">&lt;</span> all.sql</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>pxxxxxx <span class="operator">&lt;</span> all.sql</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œåï¼ŒMySQLæ•°æ®åº“ä¸­å°±å·²ç»æ¢å¤äº†all.sqlæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®åº“ã€‚</p><h3 id="3-3-å…¨é‡å¤‡ä»½æ¢å¤">3.3 å…¨é‡å¤‡ä»½æ¢å¤</h3><p>å¯èƒ½æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬åªæƒ³æ¢å¤æŸä¸€ä¸ªåº“ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰çš„æ˜¯æ•´ä¸ªå®ä¾‹çš„å¤‡ä»½ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä»å…¨é‡å¤‡ä»½ä¸­åˆ†ç¦»å‡ºå•ä¸ªåº“çš„å¤‡ä»½ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="operator">-</span>n <span class="string">&#x27;/^-- Current Database: `atguigu`/,/^-- Current Database: `/p&#x27;</span> all_database.sql <span class="operator">&gt;</span> atguigu.sql</span><br><span class="line">#åˆ†ç¦»å®Œæˆåæˆ‘ä»¬å†å¯¼å…¥atguigu.sqlå³å¯æ¢å¤å•ä¸ªåº“</span><br></pre></td></tr></table></figure><h3 id="3-4-ä»å•åº“å¤‡ä»½ä¸­æ¢å¤å•è¡¨">3.4 ä»å•åº“å¤‡ä»½ä¸­æ¢å¤å•è¡¨</h3><p>è¿™ä¸ªéœ€æ±‚è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬çŸ¥é“å“ªä¸ªè¡¨è¯¯æ“ä½œäº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨å•è¡¨æ¢å¤çš„æ–¹å¼æ¥æ¢å¤ã€‚</p><p>ä¸¾ä¾‹ï¼šæˆ‘ä»¬æœ‰atguiguæ•´åº“çš„å¤‡ä»½ï¼Œä½†æ˜¯ç”±äºclassè¡¨è¯¯æ“ä½œï¼Œéœ€è¦å•ç‹¬æ¢å¤å‡ºè¿™å¼ è¡¨ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat atguigu.sql <span class="operator">|</span> sed <span class="operator">-</span>e <span class="string">&#x27;/./&#123;H;$!d;&#125;&#x27;</span> <span class="operator">-</span>e <span class="string">&#x27;x;/CREATE TABLE `class`/!d;q&#x27;</span> <span class="operator">&gt;</span> class_structure.sql</span><br><span class="line">cat atguigu.sql <span class="operator">|</span> grep <span class="comment">--ignore-case &#x27;insert into `class`&#x27; &gt; class_data.sql</span></span><br><span class="line">#ç”¨shellè¯­æ³•åˆ†ç¦»å‡ºåˆ›å»ºè¡¨çš„è¯­å¥åŠæ’å…¥æ•°æ®çš„è¯­å¥å å†ä¾æ¬¡å¯¼å‡ºå³å¯å®Œæˆæ¢å¤</span><br><span class="line"></span><br><span class="line">use atguigu;</span><br><span class="line">mysql<span class="operator">&gt;</span> source class_structure.sql;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> source class_data.sql;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><hr><h2 id="4-ç‰©ç†å¤‡ä»½ï¼šç›´æ¥å¤åˆ¶æ•´ä¸ªæ•°æ®åº“">4. ç‰©ç†å¤‡ä»½ï¼šç›´æ¥å¤åˆ¶æ•´ä¸ªæ•°æ®åº“</h2><p>ç›´æ¥å°†MySQLä¸­çš„æ•°æ®åº“æ–‡ä»¶å¤åˆ¶å‡ºæ¥ã€‚è¿™ç§æ–¹æ³•æœ€ç®€å•ï¼Œé€Ÿåº¦ä¹Ÿæœ€å¿«ã€‚MySQLçš„æ•°æ®åº“ç›®å½•ä½ç½®ä¸ä¸€ å®šç›¸åŒï¼š</p><ul><li>åœ¨Windowså¹³å°ä¸‹ï¼ŒMySQL 8.0å­˜æ”¾æ•°æ®åº“çš„ç›®å½•é€šå¸¸é»˜è®¤ä¸º â€œ C:\ProgramData\MySQL\MySQL Server 8.0\Data â€æˆ–è€…å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰ç›®å½•ï¼›</li><li>åœ¨Linuxå¹³å°ä¸‹ï¼Œæ•°æ®åº“ç›®å½•ä½ç½®é€šå¸¸ä¸º/var/lib/mysql/ï¼›</li><li>åœ¨MAC OSXå¹³å°ä¸‹ï¼Œæ•°æ®åº“ç›®å½•ä½ç½®é€šå¸¸ä¸ºâ€œ/usr/local/mysql/dataâ€</li></ul><p>ä½†ä¸ºäº†ä¿è¯å¤‡ä»½çš„ä¸€è‡´æ€§ã€‚éœ€è¦ä¿è¯ï¼š</p><ul><li>æ–¹å¼1ï¼šå¤‡ä»½å‰ï¼Œå°†æœåŠ¡å™¨åœæ­¢ã€‚</li><li>æ–¹å¼2ï¼šå¤‡ä»½å‰ï¼Œå¯¹ç›¸å…³è¡¨æ‰§è¡Œ FLUSH TABLES WITH READ LOCK æ“ä½œã€‚è¿™æ ·å½“å¤åˆ¶æ•°æ®åº“ç›®å½•ä¸­ çš„æ–‡ä»¶æ—¶ï¼Œå…è®¸å…¶ä»–å®¢æˆ·ç»§ç»­æŸ¥è¯¢è¡¨ã€‚åŒæ—¶ï¼ŒFLUSH TABLESè¯­å¥æ¥ç¡®ä¿å¼€å§‹å¤‡ä»½å‰å°†æ‰€æœ‰æ¿€æ´»çš„ç´¢ å¼•é¡µå†™å…¥ç¡¬ç›˜ã€‚</li></ul><p>è¿™ç§æ–¹å¼æ–¹ä¾¿ã€å¿«é€Ÿï¼Œä½†ä¸æ˜¯æœ€å¥½çš„å¤‡ä»½æ–¹æ³•ï¼Œå› ä¸ºå®é™…æƒ…å†µå¯èƒ½ <code>ä¸å…è®¸åœæ­¢MySQLæœåŠ¡å™¨</code> æˆ–è€… <code>é”ä½è¡¨</code> ï¼Œè€Œä¸”è¿™ç§æ–¹æ³• å¯¹InnoDBå­˜å‚¨å¼•æ“ çš„è¡¨ä¸é€‚ç”¨ã€‚å¯¹äºMyISAMå­˜å‚¨å¼•æ“çš„è¡¨ï¼Œè¿™æ ·å¤‡ä»½å’Œè¿˜åŸå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯è¿˜åŸæ—¶æœ€å¥½æ˜¯ç›¸åŒç‰ˆæœ¬çš„MySQLæ•°æ®åº“ï¼Œå¦åˆ™å¯èƒ½ä¼šå­˜åœ¨æ–‡ä»¶ç±»å‹ä¸åŒçš„æƒ…å†µã€‚</p><p>æ³¨æ„ï¼Œç‰©ç†å¤‡ä»½å®Œæ¯•åï¼Œæ‰§è¡Œ UNLOCK TABLES æ¥ç»“ç®—å…¶ä»–å®¢æˆ·å¯¹è¡¨çš„ä¿®æ”¹è¡Œä¸ºã€‚</p><blockquote><p>è¯´æ˜ï¼š åœ¨MySQLç‰ˆæœ¬å·ä¸­ï¼Œç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¸»ç‰ˆæœ¬å·ï¼Œä¸»ç‰ˆæœ¬å·ç›¸åŒçš„MySQLæ•°æ®åº“æ–‡ä»¶æ ¼å¼ç›¸åŒã€‚</p></blockquote><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥è€ƒè™‘ä½¿ç”¨ç›¸å…³å·¥å…·å®ç°å¤‡ä»½ã€‚æ¯”å¦‚ï¼Œ <code>MySQLhotcopy</code> å·¥å…·ã€‚MySQLhotcopyæ˜¯ä¸€ä¸ªPerlè„šæœ¬ï¼Œå®ƒä½¿ç”¨LOCK TABLESã€FLUSH TABLESå’Œcpæˆ–scpæ¥å¿«é€Ÿå¤‡ä»½æ•°æ®åº“ã€‚å®ƒæ˜¯å¤‡ä»½æ•°æ®åº“æˆ–å•ä¸ªè¡¨æœ€å¿«çš„é€”å¾„ï¼Œä½†å®ƒåªèƒ½è¿è¡Œåœ¨æ•°æ®åº“ç›®å½•æ‰€åœ¨çš„æœºå™¨ä¸Šï¼Œå¹¶ä¸”åªèƒ½å¤‡ä»½MyISAMç±»å‹çš„è¡¨ã€‚å¤šç”¨äºmysql5.5ä¹‹å‰ã€‚</p><h2 id="5-ç‰©ç†æ¢å¤ï¼šç›´æ¥å¤åˆ¶åˆ°æ•°æ®åº“ç›®å½•">5. ç‰©ç†æ¢å¤ï¼šç›´æ¥å¤åˆ¶åˆ°æ•°æ®åº“ç›®å½•</h2><p><strong>æ­¥éª¤ï¼š</strong></p><p>1ï¼‰æ¼”ç¤ºåˆ é™¤å¤‡ä»½çš„æ•°æ®åº“ä¸­æŒ‡å®šè¡¨çš„æ•°æ®</p><p>2ï¼‰å°†å¤‡ä»½çš„æ•°æ®åº“æ•°æ®æ‹·è´åˆ°æ•°æ®ç›®å½•ä¸‹ï¼Œå¹¶é‡å¯MySQLæœåŠ¡å™¨</p><p>3ï¼‰æŸ¥è¯¢ç›¸å…³è¡¨çš„æ•°æ®æ˜¯å¦æ¢å¤ã€‚éœ€è¦ä½¿ç”¨ä¸‹é¢çš„<code> chown</code> æ“ä½œã€‚</p><p><strong>è¦æ±‚ï¼š</strong></p><ul><li>å¿…é¡»ç¡®ä¿å¤‡ä»½æ•°æ®çš„æ•°æ®åº“å’Œå¾…æ¢å¤çš„æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»ç‰ˆæœ¬å·ç›¸åŒã€‚<ul><li>å› ä¸ºåªæœ‰MySQLæ•°æ®åº“ä¸»ç‰ˆæœ¬å·ç›¸åŒæ—¶ï¼Œæ‰èƒ½ä¿è¯è¿™ä¸¤ä¸ªMySQLæ•°æ®åº“æ–‡ä»¶ç±»å‹æ˜¯ç›¸åŒçš„ã€‚</li></ul></li><li>è¿™ç§æ–¹å¼å¯¹ <code>MyISAMç±»å‹çš„è¡¨æ¯”è¾ƒæœ‰æ•ˆ</code> ï¼Œå¯¹äºInnoDBç±»å‹çš„è¡¨åˆ™ä¸å¯ç”¨ã€‚<ul><li>å› ä¸ºInnoDBè¡¨çš„è¡¨ç©ºé—´ä¸èƒ½ç›´æ¥å¤åˆ¶ã€‚</li></ul></li><li>åœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹ï¼Œå¤åˆ¶åˆ°æ•°æ®åº“ç›®å½•åï¼Œä¸€å®šè¦å°†æ•°æ®åº“çš„ç”¨æˆ·å’Œç»„å˜æˆmysqlï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown <span class="operator">-</span>R mysql.mysql <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>dbname</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œä¸¤ä¸ªmysqlåˆ†åˆ«è¡¨ç¤ºç»„å’Œç”¨æˆ·ï¼›â€œ-Râ€å‚æ•°å¯ä»¥æ”¹å˜æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶çš„ç”¨æˆ·å’Œç»„ï¼›â€œdbnameâ€å‚æ•°è¡¨ç¤ºæ•°æ®åº“ç›®å½•ã€‚</p><blockquote><p>æç¤º Linuxæ“ä½œç³»ç»Ÿä¸‹çš„æƒé™è®¾ç½®éå¸¸ä¸¥æ ¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒMySQLæ•°æ®åº“åªæœ‰rootç”¨æˆ·å’Œmysqlç”¨æˆ· ç»„ä¸‹çš„mysqlç”¨æˆ·æ‰å¯ä»¥è®¿é—®ï¼Œå› æ­¤å°†æ•°æ®åº“ç›®å½•å¤åˆ¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹åï¼Œä¸€å®šè¦ä½¿ç”¨chownå‘½ä»¤å°† æ–‡ä»¶å¤¹çš„ç”¨æˆ·ç»„å˜ä¸ºmysqlï¼Œå°†ç”¨æˆ·å˜ä¸ºmysqlã€‚</p></blockquote><hr><h2 id="6-è¡¨çš„å¯¼å‡ºä¸å¯¼å…¥">6. è¡¨çš„å¯¼å‡ºä¸å¯¼å…¥</h2><h3 id="6-1-è¡¨çš„å¯¼å‡º">6.1 è¡¨çš„å¯¼å‡º</h3><div class="tabs" id="e07d7d47-d1c0-4a68-b584-44dd00f1d25b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#e07d7d47-d1c0-4a68-b584-44dd00f1d25b-1"><i class="fas fa-award"></i>SELECTâ€¦INTO OUTFILEå¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</button></li><li class="tab"><button type="button" data-href="#e07d7d47-d1c0-4a68-b584-44dd00f1d25b-2"><i class="fas fa-baseball-ball"></i>mysqldumpå‘½ä»¤å¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</button></li><li class="tab"><button type="button" data-href="#e07d7d47-d1c0-4a68-b584-44dd00f1d25b-3"><i class="fas fa-bone"></i>mysqlå‘½ä»¤å¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="e07d7d47-d1c0-4a68-b584-44dd00f1d25b-1"><p>åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨SELECTâ€¦INTO OUTFILEè¯­å¥å°†è¡¨çš„å†…å®¹å¯¼å‡ºæˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚</p><p>**ä¸¾ä¾‹ï¼š**ä½¿ç”¨SELECTâ€¦INTO OUTFILEå°†atguiguæ•°æ®åº“ä¸­accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ã€‚</p><p>ï¼ˆ1ï¼‰é€‰æ‹©æ•°æ®åº“atguiguï¼Œå¹¶æŸ¥è¯¢accountè¡¨ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use atguigu;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰ <span class="operator">|</span> <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> æå›› <span class="operator">|</span> <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span> ç‹äº” <span class="operator">|</span> <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰mysqlé»˜è®¤å¯¹å¯¼å‡ºçš„ç›®å½•æœ‰æƒé™é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œå¯¼å‡ºçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šç›®å½•è¿›è¡Œæ“ä½œã€‚</p><p>æŸ¥è¯¢secure_file_privå€¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%secure%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name            <span class="operator">|</span> <span class="keyword">Value</span>                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> require_secure_transport <span class="operator">|</span> OFF                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> secure_file_priv         <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">-</span>files<span class="operator">/</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p>å‚æ•°secure_file_privçš„å¯é€‰å€¼å’Œä½œç”¨åˆ†åˆ«æ˜¯ï¼š</p><ul><li><p>å¦‚æœè®¾ç½®ä¸ºemptyï¼Œè¡¨ç¤ºä¸é™åˆ¶æ–‡ä»¶ç”Ÿæˆçš„ä½ç½®ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„è®¾ç½®ï¼›</p></li><li><p>å¦‚æœè®¾è²·ä¸ºâ€”ä¸ªè¡¨ç¤ºè·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œå°±è¦æ±‚ç”Ÿæˆçš„æ–‡ä»¶åªèƒ½æ”¾åœ¨è¿™ä¸ªæŒ‡å®šçš„ç›®å½•ï¼Œæˆ–è€…å®ƒçš„å­ç›®å½•ï¼›</p></li><li><p>å¦‚æœè®¾ç½®ä¸ºNULLï¼Œå°±è¡¨ç¤ºç¦æ­¢åœ¨è¿™ä¸ªMySQLå®ä¾‹ä¸Šæ‰§è¡Œselectâ€¦ into outfile æ“ä½œã€‚</p></li></ul><p>ï¼ˆ3ï¼‰ä¸Šé¢ç»“æœä¸­æ˜¾ç¤ºï¼Œsecure_file_privå˜é‡çš„å€¼ä¸º/var/lib/mysql-files/ï¼Œå¯¼å‡ºç›®å½•è®¾ç½®ä¸ºè¯¥ç›®å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> account <span class="keyword">INTO</span> OUTFILE &quot;/var/lib/mysql-files/account.txt&quot;;</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æŸ¥çœ‹ /var/lib/mysql-files/account.txt`æ–‡ä»¶ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> å¼ ä¸‰ <span class="number">90</span></span><br><span class="line"><span class="number">2</span> æå›› <span class="number">100</span></span><br><span class="line"><span class="number">3</span> ç‹äº” <span class="number">0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e07d7d47-d1c0-4a68-b584-44dd00f1d25b-2"><p>**ä¸¾ä¾‹1ï¼š**ä½¿ç”¨mysqldumpå‘½ä»¤å°†å°†atguiguæ•°æ®åº“ä¸­accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>T &quot;/var/lib/mysql-files/&quot; atguigu account</span><br></pre></td></tr></table></figure><p>mysqldumpå‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œåœ¨æŒ‡å®šçš„ç›®å½•/var/lib/mysql-files/ä¸‹ç”Ÿæˆäº†account.sqlå’Œaccount.txtæ–‡ä»¶ã€‚</p><p>æ‰“å¼€account.sqlæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„CREATEè¯­å¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.sql</span><br><span class="line"><span class="comment">-- MySQL dump 10.13 Distrib 8.0.26, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: localhost Database: atguigu</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version 8.0.26</span></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET NAMES utf8mb4 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `account`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `account`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET character_set_client = utf8mb4 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account` (</span><br><span class="line">`id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`balance` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Dump completed on 2022-01-07 23:19:27</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€account.txtæ–‡ä»¶ï¼Œå…¶å†…å®¹åªåŒ…å«accountè¡¨ä¸­çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.txt</span><br><span class="line"><span class="number">1</span> å¼ ä¸‰ <span class="number">90</span></span><br><span class="line"><span class="number">2</span> æå›› <span class="number">100</span></span><br><span class="line"><span class="number">3</span> ç‹äº” <span class="number">0</span></span><br></pre></td></tr></table></figure><p>**ä¸¾ä¾‹2ï¼š**ä½¿ç”¨mysqldumpå°†atguiguæ•°æ®åº“ä¸­çš„accountè¡¨å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨FIELDSé€‰é¡¹ï¼Œè¦æ±‚å­—æ®µä¹‹ é—´ä½¿ç”¨é€—å·â€œï¼Œâ€é—´éš”ï¼Œæ‰€æœ‰å­—ç¬¦ç±»å‹å­—æ®µå€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>T &quot;/var/lib/mysql-files/&quot; atguigu account <span class="comment">--fields-terminatedby=&#x27;,&#x27; --fields-optionally-enclosed-by=&#x27;\&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¯­å¥mysqldumpè¯­å¥æ‰§è¡ŒæˆåŠŸä¹‹åï¼ŒæŒ‡å®šç›®å½•ä¸‹ä¼šå‡ºç°ä¸¤ä¸ªæ–‡ä»¶account.sqlå’Œaccount.txtã€‚</p><p>æ‰“å¼€account.sqlæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„CREATEè¯­å¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.sql</span><br><span class="line"><span class="comment">-- MySQL dump 10.13 Distrib 8.0.26, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: localhost Database: atguigu</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version 8.0.26</span></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET NAMES utf8mb4 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;&#x27; */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `account`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `account`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!50503 SET character_set_client = utf8mb4 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account` (</span><br><span class="line">`id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`balance` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;</span><br><span class="line"><span class="comment">-- Dump completed on 2022-01-07 23:36:39</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€account.txtæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„æ•°æ®ã€‚ä»æ–‡ä»¶ä¸­å¯ä»¥çœ‹å‡ºï¼Œå­—æ®µä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œå­— ç¬¦ç±»å‹çš„å€¼è¢«åŒå¼•å·æ‹¬èµ·æ¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.txt</span><br><span class="line"><span class="number">1</span>,&quot;å¼ ä¸‰&quot;,<span class="number">90</span></span><br><span class="line"><span class="number">2</span>,&quot;æå››&quot;,<span class="number">100</span></span><br><span class="line"><span class="number">3</span>,&quot;ç‹äº”&quot;,<span class="number">0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e07d7d47-d1c0-4a68-b584-44dd00f1d25b-3"><p>**ä¸¾ä¾‹1ï¼š**ä½¿ç”¨mysqlè¯­å¥å¯¼å‡ºatguiguæ•°æ®ä¸­accountè¡¨ä¸­çš„è®°å½•åˆ°æ–‡æœ¬æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--execute=&quot;SELECT * FROM account;&quot; atguigu&gt; &quot;/var/lib/mysql-files/account.txt&quot;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€account.txtæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account.txt</span><br><span class="line">id name balance</span><br><span class="line"><span class="number">1</span> å¼ ä¸‰ <span class="number">90</span></span><br><span class="line"><span class="number">2</span> æå›› <span class="number">100</span></span><br><span class="line"><span class="number">3</span> ç‹äº” <span class="number">0</span></span><br></pre></td></tr></table></figure><p>**ä¸¾ä¾‹2ï¼š**å°†atguiguæ•°æ®åº“accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨â€“veritcalå‚æ•°å°†è¯¥æ¡ä»¶è®°å½•åˆ†ä¸ºå¤šè¡Œæ˜¾ç¤ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--vertical --execute=&quot;SELECT * FROM account;&quot; atguigu &gt; &quot;/var/lib/mysql-files/account_1.txt&quot;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€account_1.txtæ–‡ä»¶ï¼Œå…¶å†…å®¹åŒ…å«åˆ›å»ºaccountè¡¨çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account_1.txt</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">id: <span class="number">1</span></span><br><span class="line">name: å¼ ä¸‰</span><br><span class="line">balance: <span class="number">90</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">2.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">id: <span class="number">2</span></span><br><span class="line">name: æå››</span><br><span class="line">balance: <span class="number">100</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">3.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">id: <span class="number">3</span></span><br><span class="line">name: ç‹äº”</span><br><span class="line">balance: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>**ä¸¾ä¾‹3ï¼š**å°†atguiguæ•°æ®åº“accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°xmlæ–‡ä»¶ï¼Œä½¿ç”¨â€“xmlå‚æ•°ï¼Œå…·ä½“è¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--xml --execute=&quot;SELECT * FROM account;&quot; atguigu&gt;&quot;/var/lib/mysqlfiles/account_3.xml&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> mysql<span class="operator">-</span>files]# cat account_3.xml</span><br><span class="line"><span class="operator">&lt;</span>?xml version<span class="operator">=</span>&quot;1.0&quot;?<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>resultset statement<span class="operator">=</span>&quot;SELECT * FROM account&quot;</span><br><span class="line">xmlns:xsi<span class="operator">=</span>&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;id&quot;<span class="operator">&gt;</span><span class="number">1</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;name&quot;<span class="operator">&gt;</span>å¼ ä¸‰<span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;balance&quot;<span class="operator">&gt;</span><span class="number">90</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;id&quot;<span class="operator">&gt;</span><span class="number">2</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;name&quot;<span class="operator">&gt;</span>æå››<span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;balance&quot;<span class="operator">&gt;</span><span class="number">100</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;id&quot;<span class="operator">&gt;</span><span class="number">3</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;name&quot;<span class="operator">&gt;</span>ç‹äº”<span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">=</span>&quot;balance&quot;<span class="operator">&gt;</span><span class="number">0</span><span class="operator">&lt;</span><span class="operator">/</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="type">row</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span>resultset<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå¦‚æœè¦å°†è¡¨æ•°æ®å¯¼å‡ºåˆ°htmlæ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>--html</code> é€‰é¡¹ã€‚ç„¶åå¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="6-2-è¡¨çš„å¯¼å…¥">6.2 è¡¨çš„å¯¼å…¥</h3><div class="tabs" id="2ca277d6-de61-4154-9f69-1b38e2f5ecd3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2ca277d6-de61-4154-9f69-1b38e2f5ecd3-1"><i class="fas fa-seedling"></i>LOAD DATA INFILEæ–¹å¼å¯¼å…¥æ–‡æœ¬æ–‡ä»¶</button></li><li class="tab"><button type="button" data-href="#2ca277d6-de61-4154-9f69-1b38e2f5ecd3-2"><i class="fas fa-leaf"></i>mysqlimportæ–¹å¼å¯¼å…¥æ–‡æœ¬æ–‡ä»¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2ca277d6-de61-4154-9f69-1b38e2f5ecd3-1"><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p>ä½¿ç”¨SELECTâ€¦INTO OUTFILEå°†atguiguæ•°æ®åº“ä¸­accountè¡¨çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigu.account <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/lib/mysql-files/account_0.txt&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åˆ é™¤accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> atguigu.account;</span><br></pre></td></tr></table></figure><p>ä»æ–‡æœ¬æ–‡ä»¶account.txtä¸­æ¢å¤æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">&#x27;/var/lib/mysql-files/account_0.txt&#x27;</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> atguigu.account;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰     <span class="operator">|</span> <span class="number">90</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> æå››     <span class="operator">|</span> <span class="number">100</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span> ç‹äº”     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong> é€‰æ‹©æ•°æ®åº“atguiguï¼Œä½¿ç”¨SELECTâ€¦INTO OUTFILEå°†atguiguæ•°æ®åº“accountè¡¨ä¸­çš„è®°å½•å¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨FIELDSé€‰é¡¹å’ŒLINESé€‰é¡¹ï¼Œè¦æ±‚å­—æ®µä¹‹é—´ä½¿ç”¨é€—å·&quot;ï¼Œ&quot;é—´éš”ï¼Œæ‰€æœ‰å­—æ®µå€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigu.account <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/lib/mysql-files/account_1.txt&#x27;</span> FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;\&quot;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åˆ é™¤accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> atguigu.account;</span><br></pre></td></tr></table></figure><p>ä»/var/lib/mysql-files/account.txtä¸­å¯¼å…¥æ•°æ®åˆ°accountè¡¨ä¸­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">&#x27;/var/lib/mysql-files/account_1.txt&#x27;</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> atguigu.account FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;\&quot;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢accountè¡¨ä¸­çš„æ•°æ®ï¼Œå…·ä½“SQLå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰     <span class="operator">|</span> <span class="number">90</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> æå››     <span class="operator">|</span> <span class="number">100</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span> ç‹äº”     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2ca277d6-de61-4154-9f69-1b38e2f5ecd3-2"><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>å¯¼å‡ºæ–‡ä»¶account.txtï¼Œå­—æ®µä¹‹é—´ä½¿ç”¨é€—å·&quot;ï¼Œ&quot;é—´éš”ï¼Œå­—æ®µå€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigu.account <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/lib/mysql-files/account.txt&#x27;</span> FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;\&quot;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åˆ é™¤accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> atguigu.account;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨mysqlimportå‘½ä»¤å°†account.txtæ–‡ä»¶å†…å®¹å¯¼å…¥åˆ°æ•°æ®åº“atguiguçš„accountè¡¨ä¸­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport <span class="operator">-</span>uroot <span class="operator">-</span>p atguigu <span class="string">&#x27;/var/lib/mysql-files/account.txt&#x27;</span> <span class="comment">--fields-terminated-by=&#x27;,&#x27; --fields-optionally-enclosed-by=&#x27;\&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢accountè¡¨ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰     <span class="operator">|</span> <span class="number">90</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> æå››     <span class="operator">|</span> <span class="number">100</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span> ç‹äº”     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="7-æ•°æ®åº“è¿ç§»">7. æ•°æ®åº“è¿ç§»</h2><h3 id="7-1-æ¦‚è¿°">7.1 æ¦‚è¿°</h3><p>æ•°æ®è¿ç§»ï¼ˆdata migrationï¼‰æ˜¯æŒ‡é€‰æ‹©ã€å‡†å¤‡ã€æå–å’Œè½¬æ¢æ•°æ®ï¼Œå¹¶<strong>å°†æ•°æ®ä»ä¸€ä¸ªè®¡ç®—æœºå­˜å‚¨ç³»ç»Ÿæ°¸ä¹…åœ°ä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºå­˜å‚¨ç³»ç»Ÿçš„è¿‡ç¨‹</strong>ã€‚æ­¤å¤–ï¼Œ<code> éªŒè¯è¿ç§»æ•°æ®çš„å®Œæ•´æ€§</code> å’Œ <code>é€€å½¹åŸæ¥æ—§çš„æ•°æ®å­˜å‚¨</code> ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯æ•´ä¸ªæ•°æ®è¿ç§»è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p><p>æ•°æ®åº“è¿ç§»çš„åŸå› æ˜¯å¤šæ ·çš„ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨æˆ–å­˜å‚¨è®¾å¤‡æ›´æ¢ã€ç»´æŠ¤æˆ–å‡çº§ï¼Œåº”ç”¨ç¨‹åºè¿ç§»ï¼Œç½‘ç«™é›†æˆï¼Œç¾éš¾æ¢å¤å’Œæ•°æ®ä¸­å¿ƒè¿ç§»ã€‚</p><p>æ ¹æ®ä¸åŒçš„éœ€æ±‚å¯èƒ½è¦é‡‡å–ä¸åŒçš„è¿ç§»æ–¹æ¡ˆï¼Œä½†æ€»ä½“æ¥è®²ï¼ŒMySQL æ•°æ®è¿ç§»æ–¹æ¡ˆå¤§è‡´å¯ä»¥åˆ†ä¸º<code>ç‰©ç†è¿ç§»</code>å’Œ <code>é€»è¾‘è¿ç§»</code> ä¸¤ç±»ã€‚é€šå¸¸ä»¥å°½å¯èƒ½ <code>è‡ªåŠ¨åŒ–</code> çš„æ–¹å¼æ‰§è¡Œï¼Œä»è€Œå°†äººåŠ›èµ„æºä»ç¹ççš„ä»»åŠ¡ä¸­è§£æ”¾å‡ºæ¥ã€‚</p><h3 id="7-2-è¿ç§»æ–¹æ¡ˆ">7.2 è¿ç§»æ–¹æ¡ˆ</h3><ul><li>ç‰©ç†è¿ç§»</li></ul><p>ç‰©ç†è¿ç§»é€‚ç”¨äºå¤§æ•°æ®é‡ä¸‹çš„æ•´ä½“è¿ç§»ã€‚ä½¿ç”¨ç‰©ç†è¿ç§»æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒå¿«é€Ÿï¼Œä½†éœ€è¦åœæœºè¿ç§»å¹¶ä¸”è¦ æ±‚ MySQL ç‰ˆæœ¬åŠé…ç½®å¿…é¡»å’ŒåŸæœåŠ¡å™¨ç›¸åŒï¼Œä¹Ÿå¯èƒ½å¼•èµ·æœªçŸ¥é—®é¢˜ã€‚</p><p>ç‰©ç†è¿ç§»åŒ…æ‹¬æ‹·è´æ•°æ®æ–‡ä»¶å’Œä½¿ç”¨ XtraBackup å¤‡ä»½å·¥å…·ä¸¤ç§ã€‚</p><p>ä¸åŒæœåŠ¡å™¨ä¹‹é—´å¯ä»¥é‡‡ç”¨ç‰©ç†è¿ç§»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–°çš„æœåŠ¡å™¨ä¸Šå®‰è£…å¥½åŒç‰ˆæœ¬çš„æ•°æ®åº“è½¯ä»¶ï¼Œåˆ›å»ºå¥½ç›¸åŒç›®å½•ï¼Œå»ºè®®é…ç½®æ–‡ä»¶ä¹Ÿè¦å’ŒåŸæ•°æ®åº“ç›¸åŒï¼Œç„¶åä»åŸæ•°æ®åº“æ–¹æ‹·è´æ¥æ•°æ®æ–‡ä»¶åŠæ—¥å¿—æ–‡ä»¶ï¼Œé…ç½®å¥½æ–‡ä»¶ç»„æƒé™ï¼Œä¹‹ååœ¨æ–°æœåŠ¡å™¨è¿™è¾¹ä½¿ç”¨ mysqld å‘½ä»¤å¯åŠ¨æ•°æ®åº“ã€‚</p><ul><li>é€»è¾‘è¿ç§»</li></ul><p>é€»è¾‘è¿ç§»é€‚ç”¨èŒƒå›´æ›´å¹¿ï¼Œæ— è®ºæ˜¯ <code>éƒ¨åˆ†è¿ç§»</code> è¿˜æ˜¯ <code>å…¨é‡è¿ç§»</code> ï¼Œéƒ½å¯ä»¥ä½¿ç”¨é€»è¾‘è¿ç§»ã€‚é€»è¾‘è¿ç§»ä¸­ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯é€šè¿‡ mysqldump ç­‰å¤‡ä»½å·¥å…·ã€‚</p><h3 id="7-3-è¿ç§»æ³¨æ„ç‚¹">7.3 è¿ç§»æ³¨æ„ç‚¹</h3><p><strong>1. ç›¸åŒç‰ˆæœ¬çš„æ•°æ®åº“ä¹‹é—´è¿ç§»æ³¨æ„ç‚¹</strong></p><p>æŒ‡çš„æ˜¯åœ¨ä¸»ç‰ˆæœ¬å·ç›¸åŒçš„MySQLæ•°æ®åº“ä¹‹é—´è¿›è¡Œæ•°æ®åº“ç§»åŠ¨ã€‚</p><p><code>æ–¹å¼1</code>ï¼š å› ä¸ºè¿ç§»å‰åMySQLæ•°æ®åº“çš„ <code>ä¸»ç‰ˆæœ¬å·ç›¸åŒ</code> ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å¤åˆ¶æ•°æ®åº“ç›®å½•æ¥å®ç°æ•°æ®åº“è¿ç§»ï¼Œä½†æ˜¯ç‰©ç†è¿ç§»æ–¹å¼åªé€‚ç”¨äºMyISAMå¼•æ“çš„è¡¨ã€‚å¯¹äºInnoDBè¡¨ï¼Œä¸èƒ½ç”¨ç›´æ¥å¤åˆ¶æ–‡ä»¶çš„æ–¹å¼å¤‡ä»½æ•°æ®åº“ã€‚</p><p><code>æ–¹å¼2</code>ï¼š æœ€å¸¸è§å’Œæœ€å®‰å…¨çš„æ–¹å¼æ˜¯ä½¿ç”¨ <code>mysqldumpå‘½ä»¤</code> å¯¼å‡ºæ•°æ®ï¼Œç„¶ååœ¨ç›®æ ‡æ•°æ®åº“æœåŠ¡å™¨ä¸­ä½¿ç”¨ MySQLå‘½ä»¤å¯¼å…¥ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#host1çš„æœºå™¨ä¸­å¤‡ä»½æ‰€æœ‰æ•°æ®åº“,å¹¶å°†æ•°æ®åº“è¿ç§»åˆ°åä¸ºhost2çš„æœºå™¨ä¸Š</span><br><span class="line">mysqldump â€“h host1 â€“uroot â€“p â€“<span class="operator">-</span><span class="keyword">all</span><span class="operator">-</span>databases<span class="operator">|</span></span><br><span class="line">mysql â€“h host2 â€“uroot â€“p</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°è¯­å¥ä¸­ï¼Œâ€œ|â€ç¬¦å·è¡¨ç¤ºç®¡é“ï¼Œå…¶ä½œç”¨æ˜¯å°†mysqldumpå¤‡ä»½çš„æ–‡ä»¶ç»™mysqlå‘½ä»¤ï¼›â€œâ€“all-databasesâ€è¡¨ç¤ºè¦è¿ç§»æ‰€æœ‰çš„æ•°æ®åº“ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥ç›´æ¥å®ç°è¿ç§»ã€‚</p><p><strong>2. ä¸åŒç‰ˆæœ¬çš„æ•°æ®åº“ä¹‹é—´è¿ç§»æ³¨æ„ç‚¹</strong></p><p>ä¾‹å¦‚ï¼ŒåŸæ¥å¾ˆå¤šæœåŠ¡å™¨ä½¿ç”¨5.7ç‰ˆæœ¬çš„MySQLæ•°æ®åº“ï¼Œåœ¨8.0ç‰ˆæœ¬æ¨å‡ºæ¥ä»¥åï¼Œæ”¹è¿›äº†5.7ç‰ˆæœ¬çš„å¾ˆå¤šç¼ºé™·ï¼Œ å› æ­¤éœ€è¦æŠŠæ•°æ®åº“å‡çº§åˆ°8.0ç‰ˆæœ¬</p><p>æ—§ç‰ˆæœ¬ä¸æ–°ç‰ˆæœ¬çš„MySQLå¯èƒ½ä½¿ç”¨ä¸åŒçš„é»˜è®¤å­—ç¬¦é›†ï¼Œä¾‹å¦‚æœ‰çš„æ—§ç‰ˆæœ¬ä¸­ä½¿ç”¨latin1ä½œä¸ºé»˜è®¤å­—ç¬¦é›†ï¼Œè€Œæœ€æ–°ç‰ˆæœ¬çš„MySQLé»˜è®¤å­—ç¬¦é›†ä¸ºutf8mb4ã€‚å¦‚æœæ•°æ®åº“ä¸­æœ‰ä¸­æ–‡æ•°æ®ï¼Œé‚£ä¹ˆè¿ç§»è¿‡ç¨‹ä¸­éœ€è¦å¯¹ <code>é»˜è®¤å­—ç¬¦é›†</code> è¿›è¡Œä¿®æ”¹ ï¼Œä¸ç„¶å¯èƒ½æ— æ³•æ­£å¸¸æ˜¾ç¤ºæ•°æ®ã€‚</p><p>é«˜ç‰ˆæœ¬çš„MySQLæ•°æ®åº“é€šå¸¸éƒ½ä¼š <code>å…¼å®¹ä½ç‰ˆæœ¬</code> ï¼Œå› æ­¤å¯ä»¥ä»ä½ç‰ˆæœ¬çš„MySQLæ•°æ®åº“è¿ç§»åˆ°é«˜ç‰ˆæœ¬çš„MySQL æ•°æ®åº“ã€‚</p><p><strong>3. ä¸åŒæ•°æ®åº“ä¹‹é—´è¿ç§»æ³¨æ„ç‚¹</strong></p><p>ä¸åŒæ•°æ®åº“ä¹‹é—´è¿ç§»æ˜¯æŒ‡ä»å…¶ä»–ç±»å‹çš„æ•°æ®åº“è¿ç§»åˆ°MySQLæ•°æ®åº“ï¼Œæˆ–è€…ä»MySQLæ•°æ®åº“è¿ç§»åˆ°å…¶ä»–ç±» å‹çš„æ•°æ®åº“ã€‚è¿™ç§è¿ç§»æ²¡æœ‰æ™®é€‚çš„è§£å†³æ–¹æ³•ã€‚</p><p>è¿ç§»ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä¸åŒæ•°æ®åº“çš„æ¶æ„ï¼Œ <code>æ¯”è¾ƒå®ƒä»¬ä¹‹é—´çš„å·®å¼‚</code> ã€‚ä¸åŒæ•°æ®åº“ä¸­å®šä¹‰ç›¸åŒç±»å‹çš„æ•°æ®çš„ <code>å…³é”®å­—å¯èƒ½ä¼šä¸åŒ</code> ã€‚ä¾‹å¦‚ï¼ŒMySQLä¸­æ—¥æœŸå­—æ®µåˆ†ä¸ºDATEå’ŒTIMEä¸¤ç§ï¼Œè€ŒORACLEæ—¥æœŸå­—æ®µåªæœ‰DATEï¼›SQL Serveræ•°æ®åº“ä¸­æœ‰ntextã€Imageç­‰æ•°æ®ç±»å‹ï¼ŒMySQLæ•°æ®åº“æ²¡æœ‰è¿™äº›æ•°æ®ç±»å‹ï¼›MySQLæ”¯æŒçš„ENUMå’ŒSET ç±»å‹ï¼Œè¿™äº›SQL Serveræ•°æ®åº“ä¸æ”¯æŒã€‚</p><p>å¦å¤–ï¼Œæ•°æ®åº“å‚å•†å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§SQLæ ‡å‡†æ¥è®¾è®¡æ•°æ®åº“ç³»ç»Ÿï¼Œå¯¼è‡´ä¸åŒçš„æ•°æ®åº“ç³»ç»Ÿçš„ <code>SQLè¯­å¥</code> æœ‰å·®åˆ«ã€‚ä¾‹å¦‚ï¼Œå¾®è½¯çš„SQL Serverè½¯ä»¶ä½¿ç”¨çš„æ˜¯T-SQLè¯­å¥ï¼ŒT-SQLä¸­åŒ…å«äº†éæ ‡å‡†çš„SQLè¯­å¥ï¼Œä¸èƒ½å’ŒMySQLçš„SQLè¯­å¥å…¼å®¹ã€‚</p><p>ä¸åŒç±»å‹æ•°æ®åº“ä¹‹é—´çš„å·®å¼‚é€ æˆäº†äº’ç›¸ <code>è¿ç§»çš„å›°éš¾</code> ï¼Œè¿™äº›å·®å¼‚å…¶å®æ˜¯å•†ä¸šå…¬å¸æ•…æ„é€ æˆçš„æŠ€æœ¯å£å’ã€‚ä½† æ˜¯ä¸åŒç±»å‹çš„æ•°æ®åº“ä¹‹é—´çš„è¿ç§»å¹¶ <code>ä¸æ˜¯å®Œå…¨ä¸å¯èƒ½</code> ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨<code> MyODBC</code> å®ç°MySQLå’ŒSQL Serverä¹‹ é—´çš„è¿ç§»ã€‚MySQLå®˜æ–¹æä¾›çš„å·¥å…· <code>MySQL Migration Toolkit</code> ä¹Ÿå¯ä»¥åœ¨ä¸åŒæ•°æ®ä¹‹é—´è¿›è¡Œæ•°æ®è¿ç§»ã€‚ MySQLè¿ç§»åˆ°Oracleæ—¶ï¼Œéœ€è¦ä½¿ç”¨mysqldumpå‘½ä»¤å¯¼å‡ºsqlæ–‡ä»¶ï¼Œç„¶åï¼Œ <code>æ‰‹åŠ¨æ›´æ”¹</code> sqlæ–‡ä»¶ä¸­çš„CREATEè¯­å¥ã€‚</p><h3 id="7-4-è¿ç§»å°ç»“">7.4 è¿ç§»å°ç»“</h3><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718165515965.png" alt="image-20220718165515965" style="zoom:67%;" /><hr><h2 id="8-åˆ åº“äº†ä¸æ•¢è·‘ï¼Œèƒ½å¹²ç‚¹å•¥ï¼Ÿ">8. åˆ åº“äº†ä¸æ•¢è·‘ï¼Œèƒ½å¹²ç‚¹å•¥ï¼Ÿ</h2><p>ä¼ ç»Ÿçš„é«˜å¯ç”¨æ¶æ„æ˜¯ä¸èƒ½é¢„é˜²è¯¯åˆ æ•°æ®çš„ï¼Œå› ä¸ºä¸»åº“çš„ä¸€ä¸ª<code>drop table</code>å‘½ä»¤ï¼Œä¼šé€šè¿‡binlogä¼ ç»™æ‰€æœ‰ä»åº“å’Œçº§è”ä»åº“ï¼Œè¿›è€Œå¯¼è‡´æ•´ä¸ªé›†ç¾¤çš„å®ä¾‹éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚</p><p>ä¸ºäº†æ‰¾åˆ°è§£å†³è¯¯åˆ æ•°æ®çš„æ›´é«˜æ•ˆçš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹å’ŒMySQLç›¸å…³çš„è¯¯åˆ æ•°æ®ï¼Œåšä¸‹åˆ†ç±»ï¼š</p><ol><li>ä½¿ç”¨deleteè¯­å¥è¯¯åˆ æ•°æ®è¡Œ;</li><li>ä½¿ç”¨drop tableæˆ–è€…truncate tableè¯­å¥è¯¯åˆ æ•°æ®è¡¨ï¼›</li><li>ä½¿ç”¨drop databaseè¯­å¥è¯¯åˆ æ•°æ®åº“ï¼›</li><li>ä½¿ç”¨rmå‘½ä»¤è¯¯åˆ æ•´ä¸ªMySQLå®ä¾‹ã€‚</li></ol><h3 id="8-1-deleteï¼šè¯¯åˆ è¡Œ">8.1 deleteï¼šè¯¯åˆ è¡Œ</h3><mark class="hl-label green">å¤„ç†æªæ–½1ï¼šæ•°æ®æ¢å¤</mark> <p>ä½¿ç”¨<code>Flashback</code>å·¥å…·æ¢å¤æ•°æ®ã€‚</p><p>åŸç†ï¼šä¿®æ”¹binlog å†…å®¹ï¼Œæ‹¿å›åŸåº“é‡æ”¾ã€‚å¦‚æœè¯¯åˆ æ•°æ®æ¶‰åŠåˆ°äº†å¤šä¸ªäº‹åŠ¡çš„è¯ï¼Œéœ€è¦å°†äº‹åŠ¡çš„é¡ºå­—è°ƒè¿‡æ¥å†æ‰§è¡Œã€‚</p><p>ä½¿ç”¨å‰æï¼šbinlog_format=row å’Œ binlog_row_image=FULLã€‚</p><mark class="hl-label green">å¤„ç†æªæ–½2ï¼šé¢„é˜²</mark> <ul><li><p>ä»£ç ä¸Šçº¿å‰ï¼Œå¿…é¡»SQLå®¡æŸ¥ã€å®¡è®¡ã€‚</p></li><li><p>å»ºè®®å¯ä»¥æ‰“å¼€å®‰å…¨æ¨¡å¼ï¼ŒæŠŠ<code>sql_safe_updates</code>å‚æ•°è®¾ç½®ä¸º onã€‚å¼ºåˆ¶è¦æ±‚åŠ  where æ¡ä»¶ä¸”whereåéœ€è¦æ˜¯ç´¢å¼•å­—æ®µï¼Œå¦åˆ™å¿…é¡»ä½¿ç”¨limitã€‚å¦åˆ™å°±ä¼šæŠ¥é”™ã€‚</p></li></ul><h3 id="8-2-truncate-drop-ï¼šè¯¯åˆ åº“-è¡¨">8.2 truncate/drop ï¼šè¯¯åˆ åº“/è¡¨</h3><p>èƒŒæ™¯ï¼š</p><p>deleteå…¨è¡¨æ˜¯å¾ˆæ…¢çš„ï¼Œéœ€è¦ç”Ÿæˆå›æ»šæ—¥å¿—ã€å†™redoã€å†™binlogã€‚æ‰€ä»¥ï¼Œä»æ€§èƒ½è§’åº¦è€ƒè™‘ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨truncate tableæˆ–è€…drop tableå‘½ä»¤ã€‚</p><p>ä½¿ç”¨deleteå‘½ä»¤åˆ é™¤çš„æ•°æ®ï¼Œä½ è¿˜å¯ä»¥ç”¨Flashbackæ¥æ¢å¤ã€‚è€Œä½¿ç”¨truncate /drop tableå’Œdrop databaseå‘½ä»¤åˆ é™¤çš„æ•°æ®ï¼Œå°±æ²¡åŠæ³•é€šè¿‡Flashbackæ¥æ¢å¤äº†ã€‚å› ä¸ºï¼Œå³ä½¿æˆ‘ä»¬é…ç½®äº† binlog_format=rowï¼Œæ‰§è¡Œè¿™ä¸‰ä¸ªå‘½ä»¤æ—¶ï¼Œè®°å½•çš„ binlogè¿˜æ˜¯statementæ ¼å¼ã€‚binlogé‡Œé¢å°±åªæœ‰ä¸€ä¸ªtruncate/drop è¯­å¥ï¼Œè¿™äº›ä¿¡æ¯æ˜¯æ¢å¤ä¸å‡ºæ•°æ®çš„ã€‚</p><p>æ–¹æ¡ˆï¼š</p><p>è¿™ç§æƒ…å†µä¸‹æ¢å¤æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨<code>å…¨é‡å¤‡ä»½</code>ä¸<code>å¢é‡æ—¥å¿—</code>ç»“åˆçš„æ–¹å¼ã€‚</p><p>æ–¹æ¡ˆçš„å‰æï¼šæœ‰å®šæœŸçš„å…¨é‡å¤‡ä»½ï¼Œå¹¶ä¸”å®æ—¶å¤‡ä»½binlogã€‚</p><p>ä¸¾ä¾‹ï¼šæœ‰äººè¯¯åˆ äº†ä¸€ä¸ªåº“ï¼Œæ—¶é—´ä¸ºä¸‹åˆ3ç‚¹ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>å–æœ€è¿‘ä¸€æ¬¡<code>å…¨é‡å¤‡ä»½</code>ã€‚å‡è®¾è®¾ç½®æ•°æ®åº“åº“æ˜¯ä¸€å¤©ä¸€å¤‡ï¼Œæœ€è¿‘å¤‡ä»½æ•°æ®æ˜¯å½“å¤©å‡Œæ™¨2ç‚¹ï¼›</p></li><li><p>ç”¨å¤‡ä»½æ¢å¤å‡ºä¸€ä¸ªä¸´æ—¶åº“ï¼›ï¼ˆæ³¨æ„ï¼šè¿™é‡Œé€‰æ‹©ä¸´æ—¶åº“ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œä¸»åº“)</p></li><li><p>å–å‡ºå‡Œæ™¨2ç‚¹ä¹‹åçš„binlogæ—¥å¿—ï¼›</p></li><li><p>å‰”é™¤è¯¯åˆ é™¤æ•°æ®çš„è¯­å¥å¤–ï¼Œå…¶å®ƒè¯­å¥å…¨éƒ¨åº”ç”¨åˆ°ä¸´æ—¶åº“ã€‚ï¼ˆå‰é¢è®²è¿‡binlogçš„æ¢å¤ï¼‰</p></li><li><p>æœ€åæ¢å¤åˆ°ä¸»åº“</p></li></ol><h3 id="8-3-é¢„é˜²ä½¿ç”¨truncate-dropè¯¯åˆ åº“-è¡¨">8.3 é¢„é˜²ä½¿ç”¨truncate/dropè¯¯åˆ åº“/è¡¨</h3><p>ä¸Šé¢æˆ‘ä»¬è¯´äº†ä½¿ç”¨truncate /dropè¯­å¥è¯¯åˆ åº“/è¡¨çš„æ¢å¤æ–¹æ¡ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥é€šè¿‡ä¸‹é¢å»ºè®®çš„æ–¹æ¡ˆæ¥å°½é‡çš„é¿å…ç±»ä¼¼çš„è¯¯æ“ä½œã€‚</p><p>ï¼ˆ1) æƒé™åˆ†ç¦»</p><ul><li><p>é™åˆ¶å¸æˆ·æƒé™ï¼Œæ ¸å¿ƒçš„æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½ä¸èƒ½éšä¾¿åˆ†é…å†™æƒé™ï¼Œæƒ³è¦è·å–å†™æƒé™éœ€è¦å®¡æ‰¹ã€‚æ¯”å¦‚åªç»™ä¸šåŠ¡å¼€å‘äººå‘˜DMLæƒé™ï¼Œä¸ç»™truncate/dropæƒé™ã€‚å³ä½¿æ˜¯DBAå›¢é˜Ÿæˆå‘˜ï¼Œæ—¥å¸¸ä¹Ÿéƒ½è§„å®šåªä½¿ç”¨åªè¯»è´¦å·ï¼Œå¿…è¦çš„æ—¶å€™æ‰ä½¿ç”¨æœ‰æ›´æ–°æƒé™çš„è´¦å·ã€‚</p></li><li><p>ä¸åŒçš„è´¦å·ï¼Œä¸åŒçš„æ•°æ®ä¹‹é—´è¦è¿›è¡Œæƒé™åˆ†ç¦»ï¼Œé¿å…ä¸€ä¸ªè´¦å·å¯ä»¥åˆ é™¤æ‰€æœ‰åº“ã€‚</p></li></ul><p>ï¼ˆ2)åˆ¶å®šæ“ä½œè§„èŒƒ</p><p>æ¯”å¦‚åœ¨åˆ é™¤æ•°æ®è¡¨ä¹‹å‰ï¼Œå¿…é¡»å…ˆå¯¹è¡¨åšæ”¹åæ“ä½œï¼ˆæ¯”å¦‚åŠ  _to_be_deleted)ã€‚ç„¶åï¼Œè§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œç¡®ä¿å¯¹ä¸šåŠ¡æ— å½±å“ä»¥åå†åˆ é™¤è¿™å¼ è¡¨ã€‚</p><p>(3) è®¾ç½®å»¶è¿Ÿå¤åˆ¶å¤‡åº“</p><p>ç®€å•çš„è¯´å»¶è¿Ÿå¤åˆ¶å°±æ˜¯è®¾ç½®ä¸€ä¸ªå›ºå®šçš„å»¶è¿Ÿæ—¶é—´ï¼Œæ¯”å¦‚1ä¸ªå°æ—¶ï¼Œè®©ä»åº“è½åä¸»åº“ä¸€ä¸ªå°æ—¶ã€‚å‡ºç°è¯¯åˆ é™¤æ“ä½œ1å°æ—¶å†…ï¼Œåˆ°è¿™ä¸ªå¤‡åº“ä¸Šæ‰§è¡Œstop slaveï¼Œå†é€šè¿‡ä¹‹å‰ä»‹ç»çš„æ–¹æ³•ï¼Œè·³è¿‡è¯¯æ“ä½œå‘½ä»¤ï¼Œå°±å¯ä»¥æ¢å¤å‡ºéœ€è¦çš„æ•°æ®ã€‚</p><p>è¿™é‡Œé€šè¿‡ CHANGE MASTER TO MASTER_DELAY=Nå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šè¿™ä¸ªå¤‡åº“æŒç»­ä¿æŒè·Ÿä¸»åº“æœ‰Nç§’çš„å»¶è¿Ÿã€‚æ¯”å¦‚æŠŠNè®¾ç½®ä¸º3600ï¼Œå³ä»£è¡¨1ä¸ªå°æ—¶ã€‚</p><p>æ­¤å¤–ï¼Œå»¶è¿Ÿå¤åˆ¶è¿˜å¯ä»¥ç”¨æ¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p><p>â‘  ç”¨æ¥åšå»¶è¿Ÿæ¸¬è¯•ï¼Œæ¯”å¦‚åšå¥½çš„æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼ŒæŠŠä»åº“ä½œä¸ºè¯»åº“ï¼Œé‚£ä¹ˆæƒ³çŸ¥é“å½“æ•°æ®äº§ç”Ÿå»¶è¿Ÿçš„æ—¶å€™åˆ°åº•ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ¨¡æ‹Ÿå»¶è¿Ÿã€‚</p><p>â‘¡ç”¨äºè€æ•°æ®çš„æŸ¥è¯¢ç­‰éœ€æ±‚ï¼Œæ¯”å¦‚ä½ ç»å¸¸éœ€è¦æŸ¥çœ‹æŸå¤©å‰ä¸€ä¸ªè¡¨æˆ–è€…å­—æ®µçš„æ•°å€¼ï¼Œä½ å¯èƒ½éœ€è¦æŠŠå¤‡ä»½æ¢å¤åè¿›è¡ŒæŸ¥çœ‹ï¼Œå¦‚æœæœ‰å»¶è¿Ÿä»åº“ï¼Œæ¯”å¦‚å»¶è¿Ÿä¸€å‘¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥è§£å†³è¿™æ ·ç±»ä¼¼çš„éœ€æ±‚ã€‚</p><h3 id="8-4-rmï¼šè¯¯åˆ MySQLå®ä¾‹">8.4 rmï¼šè¯¯åˆ MySQLå®ä¾‹</h3><p>å¯¹äºä¸€ä¸ªæœ‰é«˜å¯ç”¨æœºåˆ¶çš„MySQLé›†ç¾¤æ¥è¯´ï¼Œä¸ç”¨æ‹…å¿ƒrmåˆ é™¤æ•°æ®äº†ã€‚åªæ˜¯åˆ æ‰äº†å…¶ä¸­æŸä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®çš„è¯ï¼ŒHAç³»ç»Ÿå°±ä¼šå¼€å§‹å·¥ä½œï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„ä¸»åº“ï¼Œä»è€Œä¿è¯æ•´ä¸ªé›†ç¾¤çš„æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠæŠŠæ•°æ®æ¢å¤å›æ¥ï¼Œå†æ¥å…¥æ•´ä¸ªé›†ç¾¤ã€‚</p><p>ä½†å¦‚æœæ˜¯æ¶æ„åœ°æŠŠæ•´ä¸ªé›†ç¾¤åˆ é™¤ï¼Œé‚£å°±éœ€è¦è€ƒè™‘è·¨æœºæˆ¿å¤‡ä»½ï¼Œè·¨åŸå¸‚å¤‡ä»½ã€‚</p>]]></content>
    
    
    <summary type="html">ç‰©ç†å¤‡ä»½ã€é€»è¾‘å¤‡ä»½ã€æ•°æ®åº“è¿ç§»</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>ä¸»ä»å¤åˆ¶</title>
    <link href="https://wuwawawa.github.io/posts/351b5179.html"/>
    <id>https://wuwawawa.github.io/posts/351b5179.html</id>
    <published>2023-04-20T05:40:41.000Z</published>
    <updated>2023-04-19T03:55:14.937Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä¸»ä»å¤åˆ¶æ¦‚è¿°">1. ä¸»ä»å¤åˆ¶æ¦‚è¿°</h2><h3 id="1-1-å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›">1.1 å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›</h3><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å°†<code>Redis</code>ä½œä¸ºç¼“å­˜ä¸<code>MySQL</code>é…åˆæ¥ä½¿ç”¨ï¼Œå½“æœ‰è¯·æ±‚çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šä»ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥å–å‡ºã€‚å¦‚æœä¸å­˜åœ¨å†è®¿é—®æ•°æ®åº“ï¼Œè¿™æ ·å°±<code>æå‡äº†è¯»å–çš„æ•ˆç‡</code>ï¼Œä¹Ÿå‡å°‘äº†å¯¹åç«¯æ•°æ®åº“çš„<code>è®¿é—®å‹åŠ›</code>ã€‚Redisçš„ç¼“å­˜æ¶æ„æ˜¯<code>é«˜å¹¶å‘æ¶æ„</code>ä¸­éå¸¸é‡è¦çš„ä¸€ç¯ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715202237535.png" alt="image-20220715202237535" style="zoom: 67%;" /><p>æ­¤å¤–ï¼Œä¸€èˆ¬åº”ç”¨å¯¹æ•°æ®åº“è€Œè¨€éƒ½æ˜¯â€œ<code>è¯»å¤šå†™å°‘</code>â€ï¼Œä¹Ÿå°±è¯´å¯¹æ•°æ®åº“è¯»å–æ•°æ®çš„å‹åŠ›æ¯”è¾ƒå¤§ï¼Œæœ‰ä¸€ä¸ªæ€è·¯å°±æ˜¯é‡‡ç”¨æ•°æ®åº“é›†ç¾¤çš„æ–¹æ¡ˆï¼Œåš<code>ä¸»ä»æ¶æ„</code>ã€è¿›è¡Œ<code>è¯»å†™åˆ†ç¦»</code>ï¼Œè¿™æ ·åŒæ ·å¯ä»¥æå‡æ•°æ®åº“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œä¸»ä»æ¶æ„çš„è®¾ç½®ï¼Œæ¯•ç«Ÿè®¾ç½®æ¶æ„æœ¬èº«æ˜¯æœ‰æˆæœ¬çš„ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„ç›®çš„åœ¨äºæå‡æ•°æ®åº“é«˜å¹¶å‘è®¿é—®çš„æ•ˆç‡ï¼Œé‚£ä¹ˆé¦–å…ˆè€ƒè™‘çš„æ˜¯å¦‚ä½•<code>ä¼˜åŒ–SQLå’Œç´¢å¼•</code>ï¼Œè¿™ç§æ–¹å¼ ç®€å•æœ‰æ•ˆï¼›å…¶æ¬¡æ‰æ˜¯é‡‡ç”¨<code>ç¼“å­˜çš„ç­–ç•¥</code>ï¼Œæ¯”å¦‚ä½¿ç”¨ Rediså°†çƒ­ç‚¹æ•°æ®ä¿å­˜åœ¨å†…å­˜æ•°æ®åº“ä¸­ï¼Œæå‡è¯»å–çš„æ•ˆç‡ï¼›æœ€åæ‰æ˜¯å¯¹æ•°æ®åº“é‡‡ç”¨<code>ä¸»ä»æ¶æ„</code>ï¼Œè¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚</p><p>æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨å’Œç»´æŠ¤çš„æˆæœ¬æ˜¯ç”±ä½åˆ°é«˜çš„ã€‚</p><h3 id="1-2-ä¸»ä»å¤åˆ¶çš„ä½œç”¨">1.2 ä¸»ä»å¤åˆ¶çš„ä½œç”¨</h3><p>ä¸»ä»åŒæ­¥è®¾è®¡ä¸ä»…å¯ä»¥æé«˜æ•°æ®åº“çš„ååé‡ï¼Œè¿˜æœ‰ä»¥ä¸‹ 3 ä¸ªæ–¹é¢çš„ä½œç”¨ã€‚</p><span class='p green'>ç¬¬1ä¸ªä½œç”¨ï¼šè¯»å†™åˆ†ç¦»ã€‚</span>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸»ä»å¤åˆ¶çš„æ–¹å¼æ¥`åŒæ­¥æ•°æ®`ï¼Œç„¶åé€šè¿‡è¯»å†™åˆ†ç¦»æé«˜æ•°æ®åº“å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚<img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715212521601.png" alt="image-20220715212521601" style="zoom:50%;" /><p>å…¶ä¸­ä¸€ä¸ªæ˜¯Masterä¸»åº“ï¼Œè´Ÿè´£å†™å…¥æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šå†™åº“ã€‚</p><p>å…¶ä»–éƒ½æ˜¯Slaveä»åº“ï¼Œè´Ÿè´£è¯»å–æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šè¯»åº“ã€‚</p><p>å½“ä¸»åº“è¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°†æ•°æ®å¤åˆ¶åˆ°ä»åº“ä¸­ï¼Œè€Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¼šä»ä»åº“è¿›è¡Œè¯»å–ã€‚</p><p>é¢å¯¹â€œè¯»å¤šå†™å°‘â€çš„éœ€æ±‚ï¼Œé‡‡ç”¨è¯»å†™åˆ†ç¦»çš„æ–¹å¼ï¼Œå¯ä»¥å®ç°<code>æ›´é«˜çš„å¹¶å‘è®¿é—®</code>ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜èƒ½å¯¹ä»æœåŠ¡å™¨è¿›è¡Œ<code>è´Ÿè½½å‡è¡¡</code>ï¼Œè®©ä¸åŒçš„è¯»è¯·æ±‚æŒ‰ç…§ç­–ç•¥å‡åŒ€åœ°åˆ†å‘åˆ°ä¸åŒçš„ä»æœåŠ¡å™¨ä¸Šï¼Œè®©<code>è¯»å–æ›´åŠ é¡ºç•…</code>ã€‚è¯»å–é¡ºç•…çš„å¦ä¸€ä¸ªåŸå› ï¼Œå°±æ˜¯<code>å‡å°‘äº†é”è¡¨</code>çš„å½±å“ï¼Œæ¯”å¦‚æˆ‘ä»¬è®©ä¸»åº“è´Ÿè´£å†™ï¼Œå½“ä¸»åº“å‡ºç°å†™é”çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“åˆ°ä»åº“è¿›è¡ŒSELECTçš„è¯»å–ã€‚</p><span class='p green'>ç¬¬2ä¸ªä½œç”¨å°±æ˜¯æ•°æ®å¤‡ä»½ã€‚</span>æˆ‘ä»¬é€šè¿‡ä¸»ä»å¤åˆ¶å°†ä¸»åº“ä¸Šçš„æ•°æ®å¤åˆ¶åˆ°ä»åº“ä¸Šï¼Œç›¸å½“äºä¸€ç§`çƒ­å¤‡ä»½æœºåˆ¶`ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸»åº“æ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹è¿›è¡Œçš„å¤‡ä»½ï¼Œä¸ä¼šå½±å“åˆ°æœåŠ¡ã€‚<br/><span class='p green'>ç¬¬3ä¸ªä½œç”¨æ˜¯å…·æœ‰é«˜å¯ç”¨æ€§ã€‚</span>æ•°æ®å¤‡ä»½å®é™…ä¸Šæ˜¯ä¸€ç§å†—ä½™çš„æœºåˆ¶ï¼Œé€šè¿‡è¿™ç§å†—ä½™çš„æ–¹å¼å¯ä»¥æ¢å–æ•°æ®åº“çš„é«˜å¯ç”¨æ€§ï¼Œä¹Ÿå°±æ˜¯å½“æœåŠ¡å™¨å‡ºç°æ•…éšœæˆ–å®•æœºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ä»æœåŠ¡å™¨ä¸Šï¼Œä¿è¯æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚<p>å…³äºé«˜å¯ç”¨æ€§çš„ç¨‹åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæŒ‡æ ‡è¡¡é‡ï¼Œå³æ­£å¸¸å¯ç”¨æ—¶é—´/å…¨å¹´æ—¶é—´ã€‚æ¯”å¦‚è¦è¾¾åˆ°å…¨å¹´99.999%çš„æ—¶é—´éƒ½å¯ç”¨ï¼Œå°±æ„å‘³ç€ç³»ç»Ÿåœ¨ä¸€å¹´ä¸­çš„ä¸å¯ç”¨æ—¶é—´ä¸å¾—è¶…è¿‡ 3652460(1-99.999%ï¼‰=5.256 åˆ†é’Ÿï¼ˆå«ç³»ç»Ÿå´©æºƒçš„æ—¶é—´ã€æ—¥å¸¸ç»´æŠ¤æ“ä½œå¯¼è‡´çš„åœæœºæ—¶é—´ç­‰ï¼‰ï¼Œå…¶ä»–æ—¶é—´éƒ½éœ€è¦ä¿æŒå¯ç”¨çš„çŠ¶æ€ã€‚</p><p>å®é™…ä¸Šï¼Œæ›´é«˜çš„é«˜å¯ç”¨æ€§ï¼Œæ„å‘³ç€éœ€è¦ä»˜å‡ºæ›´é«˜çš„æˆæœ¬ä»£ä»·ã€‚åœ¨ç°å®ä¸­æˆ‘ä»¬éœ€è¦ç»“åˆä¸šåŠ¡éœ€æ±‚å’Œæˆæœ¬æ¥è¿›è¡Œé€‰æ‹©ã€‚</p><hr><h2 id="2-ä¸»ä»å¤åˆ¶çš„åŸç†">2. ä¸»ä»å¤åˆ¶çš„åŸç†</h2><p><code>Slave</code>ä¼šä»<code>Master</code>è¯»å–<code>binlog</code>æ¥è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p><h3 id="2-1-åŸç†å‰–æ">2.1 åŸç†å‰–æ</h3><mark class="hl-label blue">ä¸‰ä¸ªçº¿ç¨‹</mark> <p>å®é™…ä¸Šä¸»ä»åŒæ­¥çš„åŸç†å°±æ˜¯åŸºäº binlog è¿›è¡Œæ•°æ®åŒæ­¥çš„ã€‚åœ¨ä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¼šåŸºäº<code>3ä¸ªçº¿ç¨‹</code>æ¥æ“ä½œï¼Œä¸€ä¸ªä¸»åº“çº¿ç¨‹ï¼Œä¸¤ä¸ªä»åº“çº¿ç¨‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715215944767.png" alt="image-20220715215944767" style="zoom:67%;" /><p><code>äºŒè¿›åˆ¶æ—¥å¿—è½¬å‚¨çº¿ç¨‹</code>ï¼ˆBinlog dump threadï¼‰æ˜¯ä¸€ä¸ªä¸»åº“çº¿ç¨‹ã€‚å½“ä»åº“çº¿ç¨‹è¿æ¥çš„æ—¶å€™ï¼Œ ä¸»åº“å¯ä»¥å°†äºŒè¿› åˆ¶æ—¥å¿—å‘é€ç»™ä»åº“ï¼Œå½“ä¸»åº“è¯»å–äº‹ä»¶ï¼ˆEventï¼‰çš„æ—¶å€™ï¼Œä¼šåœ¨ Binlog ä¸Š<code>åŠ é”</code>ï¼Œè¯»å–å®Œæˆä¹‹åï¼Œå†å°†é”é‡Šæ”¾æ‰ã€‚</p><p><code>ä»åº“I/Oçº¿ç¨‹</code>ä¼šè¿æ¥åˆ°ä¸»åº“ï¼Œå‘ä¸»åº“å‘é€è¯·æ±‚æ›´æ–° Binlogã€‚è¿™æ—¶ä»åº“çš„ I/O çº¿ç¨‹å°±å¯ä»¥è¯»å–åˆ°ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—è½¬å‚¨çº¿ç¨‹å‘é€çš„ Binlog æ›´æ–°éƒ¨åˆ†ï¼Œå¹¶ä¸”æ‹·è´åˆ°æœ¬åœ°çš„ä¸­ç»§æ—¥å¿— ï¼ˆRelay logï¼‰ã€‚</p><p><code>ä»åº“SQLçº¿ç¨‹</code>ä¼šè¯»å–ä»åº“ä¸­çš„ä¸­ç»§æ—¥å¿—ï¼Œå¹¶ä¸”æ‰§è¡Œæ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†ä»åº“ä¸­çš„æ•°æ®ä¸ä¸»åº“ä¿æŒåŒæ­¥ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715220037213.png" alt="image-20220715220037213" style="zoom:67%;" /><blockquote><p>æ³¨æ„ï¼š</p><p>ä¸æ˜¯æ‰€æœ‰ç‰ˆæœ¬çš„MySQLéƒ½é»˜è®¤å¼€å¯æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚åœ¨è¿›è¡Œä¸»ä»åŒæ­¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²ç»å¼€å¯äº†äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p><p>é™¤éç‰¹æ®ŠæŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ä»æœåŠ¡å™¨ä¼šæ‰§è¡Œæ‰€æœ‰ä¸»æœåŠ¡å™¨ä¸­ä¿å­˜çš„äº‹ä»¶ã€‚ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ï¼Œä½¿ä»æœåŠ¡å™¨æ‰§è¡Œç‰¹å®šçš„äº‹ä»¶ã€‚</p></blockquote><mark class="hl-label green">å¤åˆ¶ä¸‰æ­¥éª¤</mark> <p>æ­¥éª¤1ï¼š<code>Master</code>å°†å†™æ“ä½œè®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆ<code>binlog</code>ï¼‰ã€‚</p><p>æ­¥éª¤2ï¼š<code>Slave</code>å°†<code>Master</code>çš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—ï¼ˆ<code>relay log</code>ï¼‰ï¼›</p><p>æ­¥éª¤3ï¼š<code>Slave</code>é‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­ã€‚ MySQLå¤åˆ¶æ˜¯å¼‚æ­¥çš„ä¸”ä¸²è¡ŒåŒ–çš„ï¼Œè€Œä¸”é‡å¯åä»<code>æ¥å…¥ç‚¹</code>å¼€å§‹å¤åˆ¶ã€‚</p><mark class="hl-label red">å¤åˆ¶çš„é—®é¢˜</mark> <p>å¤åˆ¶çš„æœ€å¤§é—®é¢˜ï¼š<code>å»¶æ—¶</code></p><hr><h3 id="2-2-å¤åˆ¶çš„åŸºæœ¬åŸåˆ™">2.2 å¤åˆ¶çš„åŸºæœ¬åŸåˆ™</h3><ul><li>æ¯ä¸ª<code>Slave</code>åªæœ‰ä¸€ä¸ª<code>Master</code></li><li>æ¯ä¸ª<code>Slave</code>åªèƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ID</li><li>æ¯ä¸ª<code>Master</code>å¯ä»¥æœ‰å¤šä¸ª<code>Slave</code></li></ul><h2 id="3-ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º">3. ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º</h2><p>ä¸€å°<code>ä¸»æœº</code>ç”¨äºå¤„ç†æ‰€æœ‰<code>å†™è¯·æ±‚</code>ï¼Œä¸€å°<code>ä»æœº</code>è´Ÿè´£æ‰€æœ‰<code>è¯»è¯·æ±‚</code>ï¼Œæ¶æ„å›¾å¦‚ä¸‹:</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715220852836.png" alt="image-20220715220852836" style="zoom:67%;" /><h3 id="3-1-å‡†å¤‡å·¥ä½œ">3.1 å‡†å¤‡å·¥ä½œ</h3><p>1ã€å‡†å¤‡ 2å° CentOS è™šæ‹Ÿæœº</p><p>2ã€æ¯å°è™šæ‹Ÿæœºä¸Šéœ€è¦å®‰è£…å¥½MySQL (å¯ä»¥æ˜¯MySQL8.0 )</p><p>è¯´æ˜ï¼šå‰é¢æˆ‘ä»¬è®²è¿‡å¦‚ä½•å…‹éš†ä¸€å°CentOSã€‚å¤§å®¶å¯ä»¥åœ¨ä¸€å°CentOSä¸Šå®‰è£…å¥½MySQLï¼Œè¿›è€Œé€šè¿‡å…‹éš†çš„æ–¹å¼å¤åˆ¶å‡º1å°åŒ…å«MySQLçš„è™šæ‹Ÿæœºã€‚</p><p>æ³¨æ„ï¼šå…‹éš†çš„æ–¹å¼éœ€è¦ä¿®æ”¹æ–°å…‹éš†å‡ºæ¥ä¸»æœºçš„ï¼šâ‘ <code>MACåœ°å€</code>â‘¡<code>hostname</code>â‘¢<code>IP åœ°å€</code>â‘£<code>UUID</code>ã€‚</p><p>æ­¤å¤–ï¼Œå…‹éš†çš„æ–¹å¼ç”Ÿæˆçš„è™šæ‹Ÿæœºï¼ˆåŒ…å«MySQL Serverï¼‰ï¼Œåˆ™å…‹éš†çš„è™šæ‹ŸæœºMySQL Serverçš„UUIDç›¸åŒï¼Œå¿…é¡»ä¿®æ”¹ï¼Œå¦åˆ™åœ¨æœ‰äº›åœºæ™¯ä¼šæŠ¥é”™ã€‚æ¯”å¦‚ï¼š<code>show slave status\G</code>ï¼ŒæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Last_IO_Error: Fatal error: The slave I<span class="operator">/</span>O thread stops because master <span class="keyword">and</span> slave have</span><br><span class="line">equal MySQL server UUIDs; these UUIDs must be different <span class="keyword">for</span> replication <span class="keyword">to</span> work.</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹MySQL Server çš„UUIDæ–¹å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>auto.cnf</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h3 id="3-2-ä¸»æœºé…ç½®æ–‡ä»¶">3.2 ä¸»æœºé…ç½®æ–‡ä»¶</h3><p>å»ºè®®mysqlç‰ˆæœ¬ä¸€è‡´ä¸”åå°ä»¥æœåŠ¡è¿è¡Œï¼Œä¸»ä»æ‰€æœ‰é…ç½®é¡¹éƒ½é…ç½®åœ¨<code>[mysqld]</code>èŠ‚ç‚¹ä¸‹ï¼Œä¸”éƒ½æ˜¯å°å†™å­—æ¯ã€‚</p><p>å…·ä½“å‚æ•°é…ç½®å¦‚ä¸‹ï¼š</p><ul><li>å¿…é€‰</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[å¿…é¡»]ä¸»æœåŠ¡å™¨å”¯ä¸€ID</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—,æŒ‡åè·¯å¾„ã€‚æ¯”å¦‚ï¼šè‡ªå·±æœ¬åœ°çš„è·¯å¾„/log/mysqlbin</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">atguigu-bin</span></span><br></pre></td></tr></table></figure><ul><li>å¯é€‰</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[å¯é€‰] 0ï¼ˆé»˜è®¤ï¼‰è¡¨ç¤ºè¯»å†™ï¼ˆä¸»æœºï¼‰ï¼Œ1è¡¨ç¤ºåªè¯»ï¼ˆä»æœºï¼‰</span></span><br><span class="line"><span class="attr">read-only</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#è®¾ç½®æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æ—¶é•¿ï¼Œå•ä½æ˜¯ç§’</span></span><br><span class="line"><span class="attr">binlog_expire_logs_seconds</span>=<span class="string">6000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#æ§åˆ¶å•ä¸ªäºŒè¿›åˆ¶æ—¥å¿—å¤§å°ã€‚æ­¤å‚æ•°çš„æœ€å¤§å’Œé»˜è®¤å€¼æ˜¯1GB</span></span><br><span class="line"><span class="attr">max_binlog_size</span>=<span class="string">200M</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“</span></span><br><span class="line"><span class="attr">binlog-ignore-db</span>=<span class="string">test</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“,é»˜è®¤å…¨éƒ¨è®°å½•ã€‚æ¯”å¦‚ï¼šbinlog-do-db=atguigu_master_slave</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=<span class="string">éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®binlogæ ¼å¼</span></span><br><span class="line"><span class="attr">binlog_format</span>=<span class="string">STATEMENT</span></span><br></pre></td></tr></table></figure><p>é‡å¯åå°mysqlæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</p><blockquote><p>æ³¨æ„ï¼š</p><p>å…ˆæ­å»ºå®Œä¸»ä»å¤åˆ¶ï¼Œå†åˆ›å»ºæ•°æ®åº“ã€‚</p><p>MySQLä¸»ä»å¤åˆ¶èµ·å§‹æ—¶ï¼Œä»æœºä¸ç»§æ‰¿ä¸»æœºæ•°æ®ã€‚</p></blockquote><p><strong>â‘  binlogæ ¼å¼è®¾ç½®ï¼š</strong></p><p>æ ¼å¼1ï¼š<code>STATEMENTæ¨¡å¼</code>ï¼ˆåŸºäºSQLè¯­å¥çš„å¤åˆ¶(statement-based replication, SBR)ï¼‰</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=<span class="string">STATEMENT</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqlè¯­å¥ä¼šè®°å½•åˆ°binlogä¸­ã€‚è¿™æ˜¯é»˜è®¤çš„binlogæ ¼å¼ã€‚</p><ul><li>SBR çš„ä¼˜ç‚¹ï¼š<ul><li>å†å²æ‚ ä¹…ï¼ŒæŠ€æœ¯æˆç†Ÿ</li><li>ä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼Œæ–‡ä»¶è¾ƒå°</li><li>binlogä¸­åŒ…å«äº†æ‰€æœ‰æ•°æ®åº“æ›´æ”¹ä¿¡æ¯ï¼Œå¯ä»¥æ®æ­¤æ¥å®¡æ ¸æ•°æ®åº“çš„å®‰å…¨ç­‰æƒ…å†µ</li><li>binlogå¯ä»¥ç”¨äºå®æ—¶çš„è¿˜åŸï¼Œè€Œä¸ä»…ä»…ç”¨äºå¤åˆ¶</li><li>ä¸»ä»ç‰ˆæœ¬å¯ä»¥ä¸ä¸€æ ·ï¼Œä»æœåŠ¡å™¨ç‰ˆæœ¬å¯ä»¥æ¯”ä¸»æœåŠ¡å™¨ç‰ˆæœ¬é«˜</li></ul></li><li>SBR çš„ç¼ºç‚¹ï¼š<ul><li>ä¸æ˜¯æ‰€æœ‰çš„UPDATEè¯­å¥éƒ½èƒ½è¢«å¤åˆ¶ï¼Œå°¤å…¶æ˜¯åŒ…å«ä¸ç¡®å®šæ“ä½œçš„æ—¶å€™</li></ul></li><li>ä½¿ç”¨ä»¥ä¸‹å‡½æ•°çš„è¯­å¥ä¹Ÿæ— æ³•è¢«å¤åˆ¶ï¼šLOAD_FILE()ã€UUID()ã€USER()ã€FOUND_ROWS()ã€SYSDATE() (é™¤éå¯åŠ¨æ—¶å¯ç”¨äº† --sysdate-is-now é€‰é¡¹)<ul><li>INSERT â€¦ SELECT ä¼šäº§ç”Ÿæ¯” RBR æ›´å¤šçš„è¡Œçº§é”</li><li>å¤åˆ¶éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æ(WHERE è¯­å¥ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•)çš„ UPDATE æ—¶ï¼Œéœ€è¦æ¯” RBR è¯·æ±‚æ›´å¤šçš„è¡Œçº§é”</li><li>å¯¹äºæœ‰ AUTO_INCREMENT å­—æ®µçš„ InnoDBè¡¨è€Œè¨€ï¼ŒINSERT è¯­å¥ä¼šé˜»å¡å…¶ä»– INSERT è¯­å¥</li><li>å¯¹äºä¸€äº›å¤æ‚çš„è¯­å¥ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸Šçš„è€—èµ„æºæƒ…å†µä¼šæ›´ä¸¥é‡ï¼Œè€Œ RBR æ¨¡å¼ä¸‹ï¼Œåªä¼šå¯¹é‚£ä¸ªå‘ ç”Ÿå˜åŒ–çš„è®°å½•äº§ç”Ÿå½±å“</li><li>æ‰§è¡Œå¤æ‚è¯­å¥å¦‚æœå‡ºé”™çš„è¯ï¼Œä¼šæ¶ˆè€—æ›´å¤šèµ„æº</li><li>æ•°æ®è¡¨å¿…é¡»å‡ ä¹å’Œä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´æ‰è¡Œï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å¤åˆ¶å‡ºé”™</li></ul></li></ul><p><strong>â‘¡ ROWæ¨¡å¼ï¼ˆåŸºäºè¡Œçš„å¤åˆ¶(row-based replication, RBR)ï¼‰</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=<span class="string">ROW</span></span><br></pre></td></tr></table></figure><p>5.1.5ç‰ˆæœ¬çš„MySQLæ‰å¼€å§‹æ”¯æŒï¼Œä¸è®°å½•æ¯æ¡sqlè¯­å¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»…è®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œä¿®æ”¹æˆä»€ä¹ˆæ ·äº†ã€‚</p><ul><li>RBR çš„ä¼˜ç‚¹ï¼š<ul><li>ä»»ä½•æƒ…å†µéƒ½å¯ä»¥è¢«å¤åˆ¶ï¼Œè¿™å¯¹å¤åˆ¶æ¥è¯´æ˜¯æœ€<code>å®‰å…¨å¯é </code>çš„ã€‚ï¼ˆæ¯”å¦‚ï¼šä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹ çš„å­˜å‚¨è¿‡ç¨‹ã€functionã€triggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ï¼‰</li><li>å¤šæ•°æƒ…å†µä¸‹ï¼Œä»æœåŠ¡å™¨ä¸Šçš„è¡¨å¦‚æœæœ‰ä¸»é”®çš„è¯ï¼Œå¤åˆ¶å°±ä¼šå¿«äº†å¾ˆå¤š</li><li>å¤åˆ¶ä»¥ä¸‹å‡ ç§è¯­å¥æ—¶çš„è¡Œé”æ›´å°‘ï¼šINSERT â€¦ SELECTã€åŒ…å« AUTO_INCREMENT å­—æ®µçš„ INSERTã€ æ²¡æœ‰é™„å¸¦æ¡ä»¶æˆ–è€…å¹¶æ²¡æœ‰ä¿®æ”¹å¾ˆå¤šè®°å½•çš„ UPDATE æˆ– DELETE è¯­å¥</li><li>æ‰§è¡Œ INSERTï¼ŒUPDATEï¼ŒDELETE è¯­å¥æ—¶é”æ›´å°‘</li><li>ä»æœåŠ¡å™¨ä¸Šé‡‡ç”¨ å¤šçº¿ç¨‹ æ¥æ‰§è¡Œå¤åˆ¶æˆä¸ºå¯èƒ½</li></ul></li><li>RBR çš„ç¼ºç‚¹ï¼š<ul><li>binlog å¤§äº†å¾ˆå¤š</li><li>å¤æ‚çš„å›æ»šæ—¶ binlog ä¸­ä¼šåŒ…å«å¤§é‡çš„æ•°æ®</li><li>ä¸»æœåŠ¡å™¨ä¸Šæ‰§è¡Œ UPDATE è¯­å¥æ—¶ï¼Œæ‰€æœ‰å‘ç”Ÿå˜åŒ–çš„è®°å½•éƒ½ä¼šå†™åˆ° binlog ä¸­ï¼Œè€Œ SBR åªä¼šå†™ä¸€æ¬¡ï¼Œè¿™ä¼šå¯¼è‡´é¢‘ç¹å‘ç”Ÿ binlog çš„å¹¶å‘å†™é—®é¢˜</li><li>æ— æ³•ä» binlog ä¸­çœ‹åˆ°éƒ½å¤åˆ¶äº†äº›ä»€ä¹ˆè¯­å¥</li></ul></li></ul><p><strong>â‘¢ MIXEDæ¨¡å¼ï¼ˆæ··åˆæ¨¡å¼å¤åˆ¶(mixed-based replication, MBR)ï¼‰</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=<span class="string">MIXED</span></span><br></pre></td></tr></table></figure><p>ä»5.1.8ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLæä¾›äº†Mixedæ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯Statementä¸Rowçš„ç»“åˆã€‚</p><p>åœ¨Mixedæ¨¡å¼ä¸‹ï¼Œä¸€èˆ¬çš„è¯­å¥ä¿®æ”¹ä½¿ç”¨statmentæ ¼å¼ä¿å­˜binlogã€‚å¦‚ä¸€äº›å‡½æ•°ï¼Œstatementæ— æ³•å®Œæˆä¸»ä»å¤åˆ¶çš„æ“ä½œï¼Œåˆ™é‡‡ç”¨rowæ ¼å¼ä¿å­˜binlogã€‚</p><p>MySQLä¼šæ ¹æ®æ‰§è¡Œçš„æ¯ä¸€æ¡å…·ä½“çš„sqlè¯­å¥æ¥åŒºåˆ†å¯¹å¾…è®°å½•çš„æ—¥å¿—å½¢å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨Statementå’ŒRowä¹‹é—´é€‰æ‹©ä¸€ç§ã€‚</p><h3 id="3-3-ä»æœºé…ç½®æ–‡ä»¶">3.3 ä»æœºé…ç½®æ–‡ä»¶</h3><p>è¦æ±‚ä¸»ä»æ‰€æœ‰é…ç½®é¡¹éƒ½é…ç½®åœ¨<code>my.cnf</code>çš„<code>[mysqld]</code>æ ä½ä¸‹ï¼Œä¸”éƒ½æ˜¯å°å†™å­—æ¯ã€‚</p><ul><li>å¿…é€‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#[å¿…é¡»]ä»æœåŠ¡å™¨å”¯ä¸€ID</span><br><span class="line">server<span class="operator">-</span>id<span class="operator">=</span><span class="number">2</span></span><br></pre></td></tr></table></figure><ul><li>å¯é€‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#[å¯é€‰]å¯ç”¨ä¸­ç»§æ—¥å¿—</span><br><span class="line">relay<span class="operator">-</span>log<span class="operator">=</span>mysql<span class="operator">-</span>relay</span><br></pre></td></tr></table></figure><p>é‡å¯åå°mysqlæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</p><blockquote><p>æ³¨æ„ï¼šä¸»ä»æœºéƒ½å…³é—­é˜²ç«å¢™<br>service iptables stop #CentOS 6<br>systemctl stop firewalld.service #CentOS 7</p></blockquote><h3 id="3-4-ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ">3.4 ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#åœ¨ä¸»æœºMySQLé‡Œæ‰§è¡Œæˆæƒä¸»ä»å¤åˆ¶çš„å‘½ä»¤</span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;slave1&#x27;</span>@<span class="string">&#x27;ä»æœºå™¨æ•°æ®åº“IP&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;abc123&#x27;</span>; #<span class="number">5.5</span>,<span class="number">5.7</span></span><br></pre></td></tr></table></figure><span class='p red'>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨çš„æ˜¯MySQL8ï¼Œéœ€è¦å¦‚ä¸‹çš„æ–¹å¼å»ºç«‹è´¦æˆ·ï¼Œå¹¶æˆæƒslave:</span><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;slave1&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;slave1&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#æ­¤è¯­å¥å¿…é¡»æ‰§è¡Œã€‚å¦åˆ™è§ä¸‹é¢ã€‚</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;slave1&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šåœ¨ä»æœºæ‰§è¡Œshow slave status\Gæ—¶æŠ¥é”™ï¼š</p><p>Last_IO_Error: error connecting to master â€˜slave1@192.168.1.150:3306â€™ - retry-time: 60 retries: 1 message:</p><p>Authentication plugin â€˜caching_sha2_passwordâ€™ reported error: Authentication requires secure connection.</p></blockquote><p>æŸ¥è¯¢Masterçš„çŠ¶æ€ï¼Œå¹¶è®°å½•ä¸‹Fileå’ŒPositionçš„å€¼ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718140722740.png" alt="image-20220718140722740"></p><ul><li>è®°å½•ä¸‹Fileå’ŒPositionçš„å€¼</li></ul><blockquote><p>æ³¨æ„ï¼šæ‰§è¡Œå®Œæ­¤æ­¥éª¤å<span class='p red'>ä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MySQL</span>ï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–ã€‚</p></blockquote><h3 id="3-5-ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº">3.5 ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº</h3><p>æ­¥éª¤1ï¼šä»æœºä¸Šå¤åˆ¶ä¸»æœºçš„å‘½ä»¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST<span class="operator">=</span><span class="string">&#x27;ä¸»æœºçš„IPåœ°å€&#x27;</span>,</span><br><span class="line">MASTER_USER<span class="operator">=</span><span class="string">&#x27;ä¸»æœºç”¨æˆ·å&#x27;</span>,</span><br><span class="line">MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;ä¸»æœºç”¨æˆ·åçš„å¯†ç &#x27;</span>,</span><br><span class="line">MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;mysql-bin.å…·ä½“æ•°å­—&#x27;</span>,</span><br><span class="line">MASTER_LOG_POS<span class="operator">=</span>å…·ä½“å€¼;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST<span class="operator">=</span><span class="string">&#x27;192.168.1.150&#x27;</span>,MASTER_USER<span class="operator">=</span><span class="string">&#x27;slave1&#x27;</span>,MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>,MASTER_LOG_F</span><br><span class="line">ILE<span class="operator">=</span><span class="string">&#x27;atguigu-bin.000007&#x27;</span>,MASTER_LOG_POS<span class="operator">=</span><span class="number">154</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718140946747.png" alt="image-20220718140946747"></p><p><strong>æ­¥éª¤2ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#å¯åŠ¨slaveåŒæ­¥</span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718141825228.png" alt="image-20220718141825228"></p><p>å¦‚æœæŠ¥é”™ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718141841862.png" alt="image-20220718141841862"></p><p>å¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼Œåˆ é™¤ä¹‹å‰çš„relay_logä¿¡æ¯ã€‚ç„¶åé‡æ–°æ‰§è¡Œ CHANGE MASTER TO â€¦è¯­å¥å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> reset slave; #åˆ é™¤SLAVEæ•°æ®åº“çš„relaylogæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯ç”¨æ–°çš„relaylogæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼ŒæŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718141951374.png" alt="image-20220718141951374"></p><blockquote><p>ä¸Šé¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸï¼</p></blockquote><p>æ˜¾å¼å¦‚ä¸‹çš„æƒ…å†µï¼Œå°±æ˜¯ä¸æ­£ç¡®çš„ã€‚å¯èƒ½é”™è¯¯çš„åŸå› æœ‰ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> ç½‘ç»œä¸é€š</span><br><span class="line"><span class="bullet">2.</span> è´¦æˆ·å¯†ç é”™è¯¯</span><br><span class="line"><span class="bullet">3.</span> é˜²ç«å¢™</span><br><span class="line"><span class="bullet">4.</span> mysqlé…ç½®æ–‡ä»¶é—®é¢˜</span><br><span class="line"><span class="bullet">5.</span> è¿æ¥æœåŠ¡å™¨æ—¶è¯­æ³•</span><br><span class="line"><span class="bullet">6.</span> ä¸»æœåŠ¡å™¨mysqlæƒé™</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718142045114.png" alt="image-20220718142045114" style="zoom:80%;" /><h3 id="3-6-æµ‹è¯•">3.6 æµ‹è¯•</h3><p>ä¸»æœºæ–°å»ºåº“ã€æ–°å»ºè¡¨ã€insertè®°å½•ï¼Œä»æœºå¤åˆ¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE atguigu_master_slave;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytbl(id <span class="type">INT</span>,NAME <span class="type">VARCHAR</span>(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytbl <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;zhang3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytbl <span class="keyword">VALUES</span>(<span class="number">2</span>,@<span class="variable">@hostname</span>);</span><br></pre></td></tr></table></figure><h3 id="3-7-åœæ­¢ä¸»ä»åŒæ­¥">3.7 åœæ­¢ä¸»ä»åŒæ­¥</h3><ul><li>åœæ­¢ä¸»ä»åŒæ­¥å‘½ä»¤ï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br></pre></td></tr></table></figure><ul><li><p>å¦‚ä½•é‡æ–°é…ç½®ä¸»ä»</p><p>å¦‚æœåœæ­¢ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½ï¼Œå†ä½¿ç”¨éœ€è¦é‡æ–°é…ç½®ä¸»ä»ã€‚å¦åˆ™ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718142549168.png" alt="image-20220718142549168"></p></li></ul><p>é‡æ–°é…ç½®ä¸»ä»ï¼Œéœ€è¦åœ¨ä»æœºä¸Šæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br><span class="line"></span><br><span class="line">reset master; #åˆ é™¤Masterä¸­æ‰€æœ‰çš„binglogæ–‡ä»¶ï¼Œå¹¶å°†æ—¥å¿—ç´¢å¼•æ–‡ä»¶æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹æ‰€æœ‰æ–°çš„æ—¥å¿—æ–‡ä»¶(æ…ç”¨)</span><br></pre></td></tr></table></figure><h3 id="3-8-æ­å»ºä¸»ä»å¤åˆ¶ï¼šåŒä¸»åŒä»">3.8 æ­å»ºä¸»ä»å¤åˆ¶ï¼šåŒä¸»åŒä»</h3><p>ä¸€ä¸ªä¸»æœºm1ç”¨äºå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œå®ƒçš„ä»æœºs1å’Œå¦ä¸€å°ä¸»æœºm2è¿˜æœ‰å®ƒçš„ä»æœºs2è´Ÿè´£æ‰€æœ‰è¯»è¯·æ±‚ã€‚å½“m1ä¸»æœºå®•æœºåï¼Œm2ä¸»æœºè´Ÿè´£å†™è¯·æ±‚ï¼Œm1ã€m2äº’ä¸ºå¤‡æœºã€‚ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718143705843.png" alt="image-20220718143705843" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718143716620.png" alt="image-20220718143716620" style="zoom:67%;" /><hr><h2 id="4-åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜">4. åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h2><p><strong>ä¸»ä»åŒæ­¥çš„è¦æ±‚ï¼š</strong></p><ul><li>è¯»åº“å’Œå†™åº“çš„æ•°æ®ä¸€è‡´(æœ€ç»ˆä¸€è‡´)ï¼›</li><li>å†™æ•°æ®å¿…é¡»å†™åˆ°å†™åº“ï¼›</li><li>è¯»æ•°æ®å¿…é¡»åˆ°è¯»åº“(ä¸ä¸€å®š)ï¼›</li></ul><h3 id="4-1-ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜">4.1 ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜</h3><p>è¿›è¡Œä¸»ä»åŒæ­¥çš„å†…å®¹æ˜¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿›è¡Œ<code>ç½‘ç»œä¼ è¾“</code>çš„è¿‡ç¨‹ä¸­å°±ä¸€å®šä¼š<code>å­˜åœ¨ä¸»ä»å»¶è¿Ÿ</code>ï¼ˆæ¯”å¦‚ 500msï¼‰ï¼Œè¿™æ ·å°±å¯èƒ½é€ æˆç”¨æˆ·åœ¨ä»åº“ä¸Šè¯»å–çš„æ•°æ®ä¸æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸»ä»åŒæ­¥ä¸­çš„<code>æ•°æ®ä¸ä¸€è‡´æ€§</code>é—®é¢˜ã€‚</p><p>ä¸¾ä¾‹ï¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿçš„æ—¶é—´ç‚¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªï¼š</p><ol><li>ä¸»åº“Aæ‰§è¡Œå®Œæˆä¸€ä¸ªäº‹åŠ¡ï¼Œå†™å…¥binlogï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸ºT1ï¼›</li><li>ä¹‹åä¼ ç»™ä»åº“Bï¼Œæˆ‘ä»¬æŠŠä»åº“Bæ¥æ”¶å®Œè¿™ä¸ªbinlogçš„æ—¶åˆ»è®°ä¸ºT2;</li><li>ä»åº“Bæ‰§è¡Œå®Œæˆè¿™ä¸ªäº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸ºT3ã€‚</li></ol><hr><h3 id="4-2-ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› ">4.2 ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› </h3><p>åœ¨ç½‘ç»œæ­£å¸¸çš„æ—¶å€™ï¼Œæ—¥å¿—ä»ä¸»åº“ä¼ ç»™ä»åº“æ‰€éœ€çš„æ—¶é—´æ˜¯å¾ˆçŸ­çš„ï¼Œå³T2-T1çš„å€¼æ˜¯éå¸¸å°çš„ã€‚å³ï¼Œç½‘ç»œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»å¤‡å»¶è¿Ÿçš„ä¸»è¦æ¥æºæ˜¯å¤‡åº“æ¥æ”¶å®Œbinlogå’Œæ‰§è¡Œå®Œè¿™ä¸ªäº‹åŠ¡ä¹‹é—´çš„æ—¶é—´å·®ã€‚</p><span class='p red'>ä¸»å¤‡å»¶è¿Ÿæœ€ç›´æ¥çš„è¡¨ç°æ˜¯ï¼Œä»åº“æ¶ˆè´¹ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰çš„é€Ÿåº¦ï¼Œæ¯”ä¸»åº“ç”Ÿäº§binlogçš„é€Ÿåº¦è¦æ…¢ã€‚</span>é€ æˆåŸå› ï¼š<p>1ã€ä»åº“çš„æœºå™¨æ€§èƒ½æ¯”ä¸»åº“è¦å·®</p><p>2ã€ä»åº“çš„å‹åŠ›å¤§</p><p>3ã€å¤§äº‹åŠ¡çš„æ‰§è¡Œ</p><p>ä¸¾ä¾‹1ï¼šä¸€æ¬¡æ€§ç”¨deleteè¯­å¥åˆ é™¤å¤ªå¤šæ•°æ®</p><p>ç»“è®ºï¼šåç»­å†åˆ é™¤æ•°æ®çš„æ—¶å€™ï¼Œè¦æ§åˆ¶æ¯ä¸ªäº‹åŠ¡åˆ é™¤çš„æ•°æ®é‡ï¼Œåˆ†æˆå¤šæ¬¡åˆ é™¤ã€‚</p><p>ä¸¾ä¾‹2ï¼šä¸€æ¬¡æ€§ç”¨insertâ€¦selectæ’å…¥å¤ªå¤šæ•°æ®</p><p>ä¸¾ä¾‹3ï¼šå¤§è¡¨DDL</p><p>æ¯”å¦‚åœ¨ä¸»åº“å¯¹ä¸€å¼ 500Wçš„è¡¨æ·»åŠ ä¸€ä¸ªå­—æ®µè€—è´¹äº†10åˆ†é’Ÿï¼Œé‚£ä¹ˆä»èŠ‚ç‚¹ä¸Šä¹Ÿä¼šè€—è´¹10åˆ†é’Ÿã€‚</p><hr><h3 id="4-3-å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ">4.3 å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ</h3><p>è‹¥æƒ³è¦å‡å°‘ä¸»ä»å»¶è¿Ÿçš„æ—¶é—´ï¼Œå¯ä»¥é‡‡å–ä¸‹é¢çš„åŠæ³•ï¼š</p><ol><li>é™ä½å¤šçº¿ç¨‹å¤§äº‹åŠ¡å¹¶å‘çš„æ¦‚ç‡ï¼Œä¼˜åŒ–ä¸šåŠ¡é€»è¾‘</li><li>ä¼˜åŒ–SQLï¼Œé¿å…æ…¢SQLï¼Œ<code>å‡å°‘æ‰¹é‡æ“ä½œ</code>ï¼Œå»ºè®®å†™è„šæœ¬ä»¥update-sleepè¿™æ ·çš„å½¢å¼å®Œæˆã€‚</li><li><code>æé«˜ä»åº“æœºå™¨çš„é…ç½®</code>ï¼Œå‡å°‘ä¸»åº“å†™binlogå’Œä»åº“è¯»binlogçš„æ•ˆç‡å·®ã€‚</li><li>å°½é‡é‡‡ç”¨<code>çŸ­çš„é“¾è·¯</code>ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“å’Œä»åº“æœåŠ¡å™¨çš„è·ç¦»å°½é‡è¦çŸ­ï¼Œæå‡ç«¯å£å¸¦å®½ï¼Œå‡å°‘binlogä¼ è¾“çš„ç½‘ç»œå»¶æ—¶ã€‚</li><li>å®æ—¶æ€§è¦æ±‚çš„ä¸šåŠ¡è¯»å¼ºåˆ¶èµ°ä¸»åº“ï¼Œä»åº“åªåšç¾å¤‡ï¼Œå¤‡ä»½ã€‚</li></ol><hr><h3 id="4-4-å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜">4.4 å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜</h3><p>å¦‚æœæ“ä½œçš„æ•°æ®å­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆå¯¹æ•°æ®è¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹è®°å½•åŠ å†™é”ï¼Œè¿™æ ·åœ¨è¯»å–çš„æ—¶å€™å°±ä¸ä¼šå‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä½†è¿™æ—¶ä»åº“çš„ä½œç”¨å°±æ˜¯<code>å¤‡ä»½</code>ï¼Œå¹¶æ²¡æœ‰èµ·åˆ°<code>è¯»å†™åˆ†ç¦»</code>ï¼Œåˆ†æ‹…ä¸»åº“<code>è¯»å‹åŠ›</code>çš„ä½œç”¨ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718144341584.png" alt="image-20220718144341584" style="zoom: 67%;" /><p>è¯»å†™åˆ†ç¦»æƒ…å†µä¸‹ï¼Œè§£å†³ä¸»ä»åŒæ­¥ä¸­æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œ å°±æ˜¯è§£å†³ä¸»ä»ä¹‹é—´<code>æ•°æ®å¤åˆ¶æ–¹å¼</code>çš„é—®é¢˜ï¼Œå¦‚æœæŒ‰ç…§æ•°æ®ä¸€è‡´æ€§<code>ä»å¼±åˆ°å¼º</code>æ¥è¿›è¡Œåˆ’åˆ†ï¼Œæœ‰ä»¥ä¸‹ 3 ç§å¤åˆ¶æ–¹å¼ã€‚</p><hr><div class="tabs" id="2ca9db54-a14a-42f7-8fa9-449c9b638852"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2ca9db54-a14a-42f7-8fa9-449c9b638852-1"><i class="fas fa-cat"></i>æ–¹æ³• 1ï¼šå¼‚æ­¥å¤åˆ¶</button></li><li class="tab"><button type="button" data-href="#2ca9db54-a14a-42f7-8fa9-449c9b638852-2"><i class="fas fa-horse"></i>æ–¹æ³• 2ï¼šåŠåŒæ­¥å¤åˆ¶</button></li><li class="tab"><button type="button" data-href="#2ca9db54-a14a-42f7-8fa9-449c9b638852-3"><i class="fas fa-dove"></i>æ–¹æ³• 3ï¼šç»„å¤åˆ¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2ca9db54-a14a-42f7-8fa9-449c9b638852-1"><p>å¼‚æ­¥æ¨¡å¼å°±æ˜¯å®¢æˆ·ç«¯æäº¤ COMMIT ä¹‹åä¸éœ€è¦ç­‰ä»åº“è¿”å›ä»»ä½•ç»“æœï¼Œè€Œæ˜¯ç›´æ¥å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸ä¼šå½±å“ä¸»åº“å†™çš„æ•ˆç‡ï¼Œä½†å¯èƒ½ä¼šå­˜åœ¨ä¸»åº“å®•æœºï¼Œè€ŒBinlogè¿˜æ²¡æœ‰åŒæ­¥åˆ°ä»åº“çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶çš„ä¸»åº“å’Œä»åº“æ•°æ®ä¸ä¸€è‡´ã€‚è¿™æ—¶å€™ä»ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°ä¸»ï¼Œé‚£ä¹ˆæ–°ä¸»åˆ™å¯èƒ½ç¼ºå°‘åŸæ¥ä¸»æœåŠ¡å™¨ä¸­å·²æäº¤çš„äº‹åŠ¡ã€‚æ‰€ä»¥ï¼Œè¿™ç§å¤åˆ¶æ¨¡å¼ä¸‹çš„æ•°æ®ä¸€è‡´æ€§æ˜¯æœ€å¼±çš„ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718144410731.png" alt="image-20220718144410731" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2ca9db54-a14a-42f7-8fa9-449c9b638852-2"><p>MysQL5.5ç‰ˆæœ¬ä¹‹åå¼€å§‹æ”¯æŒåŠåŒæ­¥å¤åˆ¶çš„æ–¹å¼ã€‚åŸç†æ˜¯åœ¨å®¢æˆ·ç«¯æäº¤ COMMIT ä¹‹åä¸ç›´æ¥å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œ è€Œæ˜¯ç­‰å¾…è‡³å°‘æœ‰ä¸€ä¸ªä»åº“æ¥æ”¶åˆ°äº† Binlogï¼Œå¹¶ä¸”å†™å…¥åˆ°ä¸­ç»§æ—¥å¿—ä¸­ï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æé«˜äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå½“ç„¶ç›¸æ¯”äºå¼‚æ­¥å¤åˆ¶æ¥è¯´ï¼Œè‡³å°‘å¤šå¢åŠ äº†ä¸€ä¸ªç½‘ç»œè¿æ¥çš„å»¶è¿Ÿï¼Œé™ä½äº†ä¸»åº“å†™çš„æ•ˆç‡ã€‚</p><p>åœ¨MysQL5.7ç‰ˆæœ¬ä¸­è¿˜å¢åŠ äº†ä¸€ä¸ª<code>rpl_semi_sync_master_wait_for_slave_count</code>å‚æ•°ï¼Œå¯ä»¥å¯¹åº”ç­”çš„ä»åº“æ•°é‡è¿›è¡Œè®¾ç½®ï¼Œé»˜è®¤ä¸º1ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æœ‰1ä¸ªä»åº“è¿›è¡Œäº†å“åº”ï¼Œå°±å¯ä»¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœå°†è¿™ä¸ªå‚æ•°è°ƒå¤§ï¼Œ å¯ä»¥æå‡æ•°æ®ä¸€è‡´æ€§çš„å¼ºåº¦ï¼Œä½†ä¹Ÿä¼šå¢åŠ ä¸»åº“ç­‰å¾…ä»åº“å“åº”çš„æ—¶é—´ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718144958357.png" alt="image-20220718144958357" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2ca9db54-a14a-42f7-8fa9-449c9b638852-3"><p>å¼‚æ­¥å¤åˆ¶å’ŒåŠåŒæ­¥å¤åˆ¶éƒ½æ— æ³•æœ€ç»ˆä¿è¯æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ï¼ŒåŠåŒæ­¥å¤åˆ¶æ˜¯é€šè¿‡åˆ¤æ–­ä»åº“å“åº”çš„ä¸ªæ•°æ¥å†³å®šæ˜¯å¦è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè™½ç„¶æ•°æ®ä¸€è‡´æ€§ç›¸æ¯”äºå¼‚æ­¥å¤åˆ¶æœ‰æå‡ï¼Œä½†ä»ç„¶æ— æ³•æ»¡è¶³å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚é‡‘èé¢†åŸŸã€‚MGR å¾ˆå¥½åœ°å¼¥è¡¥äº†è¿™ä¸¤ç§å¤åˆ¶æ¨¡å¼çš„ä¸è¶³ã€‚</p><p>ç»„å¤åˆ¶æŠ€æœ¯ï¼Œç®€ç§° MGRï¼ˆMySQL Group Replicationï¼‰ã€‚æ˜¯ MySQL åœ¨ 5.7.17 ç‰ˆæœ¬ä¸­æ¨å‡ºçš„ä¸€ç§æ–°çš„æ•°æ®å¤åˆ¶æŠ€æœ¯ï¼Œè¿™ç§å¤åˆ¶æŠ€æœ¯æ˜¯åŸºäºPaxosåè®®çš„çŠ¶æ€æœºå¤åˆ¶ã€‚</p><p><mark class="hl-label green">MGRæ˜¯å¦‚ä½•å·¥ä½œçš„</mark></p><p>é¦–å…ˆæˆ‘ä»¬å°†å¤šä¸ªèŠ‚ç‚¹å…±åŒç»„æˆä¸€ä¸ªå¤åˆ¶ç»„ï¼Œåœ¨<code>æ‰§è¡Œè¯»å†™ï¼ˆRWï¼‰äº‹åŠ¡</code>çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ä¸€è‡´æ€§åè®®å±‚ ï¼ˆConsensus å±‚ï¼‰çš„åŒæ„ï¼Œä¹Ÿå°±æ˜¯è¯»å†™äº‹åŠ¡æƒ³è¦è¿›è¡Œæäº¤ï¼Œå¿…é¡»è¦ç»è¿‡ç»„é‡Œâ€œå¤§å¤šæ•°äººâ€ï¼ˆå¯¹åº” Node èŠ‚ç‚¹ï¼‰çš„åŒæ„ï¼Œå¤§å¤šæ•°æŒ‡çš„æ˜¯åŒæ„çš„èŠ‚ç‚¹æ•°é‡éœ€è¦å¤§äº ï¼ˆN/2+1ï¼‰ï¼Œè¿™æ ·æ‰å¯ä»¥è¿›è¡Œæäº¤ï¼Œè€Œä¸æ˜¯åŸå‘èµ·æ–¹ä¸€ä¸ªè¯´äº†ç®—ã€‚è€Œé’ˆå¯¹<code>åªè¯»ï¼ˆROï¼‰äº‹åŠ¡</code>åˆ™ä¸éœ€è¦ç»è¿‡ç»„å†…åŒæ„ï¼Œç›´æ¥ COMMIT å³å¯ã€‚</p><p>åœ¨ä¸€ä¸ªå¤åˆ¶ç»„å†…æœ‰å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå®ƒä»¬å„è‡ªç»´æŠ¤äº†è‡ªå·±çš„æ•°æ®å‰¯æœ¬ï¼Œå¹¶ä¸”åœ¨ä¸€è‡´æ€§åè®®å±‚å®ç°äº†åŸå­æ¶ˆ æ¯å’Œå…¨å±€æœ‰åºæ¶ˆæ¯ï¼Œä»è€Œä¿è¯ç»„å†…æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145235499.png" alt="image-20220718145235499" style="zoom:67%;" /><p>MGR å°† MySQL å¸¦å…¥äº†æ•°æ®å¼ºä¸€è‡´æ€§çš„æ—¶ä»£ï¼Œæ˜¯ä¸€ä¸ªåˆ’æ—¶ä»£çš„åˆ›æ–°ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„åŸå› å°±æ˜¯MGR æ˜¯åŸº äº Paxos åè®®çš„ã€‚Paxos ç®—æ³•æ˜¯ç”± 2013 å¹´çš„å›¾çµå¥–è·å¾—è€… Leslie Lamport äº 1990 å¹´æå‡ºçš„ï¼Œæœ‰å…³è¿™ä¸ªç®—æ³•çš„å†³ç­–æœºåˆ¶å¯ä»¥æœä¸€ä¸‹ã€‚äº‹å®ä¸Šï¼ŒPaxos ç®—æ³•æå‡ºæ¥ä¹‹åå°±ä½œä¸º<code>åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•</code>è¢«å¹¿æ³›åº”ç”¨ï¼Œæ¯”å¦‚ Apache çš„ ZooKeeper ä¹Ÿæ˜¯åŸºäº Paxos å®ç°çš„ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="5-çŸ¥è¯†å»¶ä¼¸">5. çŸ¥è¯†å»¶ä¼¸</h2><p>åœ¨ä¸»ä»æ¶æ„çš„é…ç½®ä¸­ï¼Œå¦‚æœæƒ³è¦é‡‡å–è¯»å†™åˆ†ç¦»çš„ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥<code>è‡ªå·±ç¼–å†™ç¨‹åº</code>ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶</code>æ¥å®ç°ã€‚</p><ul><li>è‡ªå·±ç¼–å†™ç¨‹åºçš„å¥½å¤„å°±åœ¨äºæ¯”è¾ƒè‡ªä¸»ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ¤æ–­å“ªäº›æŸ¥è¯¢åœ¨ä»åº“ä¸Šæ¥æ‰§è¡Œï¼Œé’ˆå¯¹å®æ—¶æ€§è¦ æ±‚é«˜çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘å“ªäº›æŸ¥è¯¢å¯ä»¥åœ¨ä¸»åº“ä¸Šæ‰§è¡Œã€‚åŒæ—¶ï¼Œç¨‹åºç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œå‡å°‘äº†ä¸­é—´ä»¶å±‚ï¼Œç›¸å½“äºå‡å°‘äº†æ€§èƒ½æŸè€—ã€‚</li><li>é‡‡ç”¨ä¸­é—´ä»¶çš„æ–¹æ³•æœ‰å¾ˆæ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œ<code>åŠŸèƒ½å¼ºå¤§</code>ï¼Œ<code>ä½¿ç”¨ç®€å•</code>ã€‚ä½†å› ä¸ºåœ¨å®¢æˆ·ç«¯å’Œæ•°æ®åº“ä¹‹é—´å¢åŠ äº† ä¸­é—´ä»¶å±‚ä¼šæœ‰ä¸€äº›<code>æ€§èƒ½æŸè€—</code>ï¼ŒåŒæ—¶å•†ä¸šä¸­é—´ä»¶ä¹Ÿæ˜¯æœ‰ä½¿ç”¨æˆæœ¬çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘é‡‡å–ä¸€äº›ä¼˜ç§€çš„å¼€æºå·¥å…·ã€‚</li></ul><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145428456.png" alt="image-20220718145428456" style="zoom:67%;" /><p>â‘ <code>Cobar</code>å±äºé˜¿é‡ŒB2Bäº‹ä¸šç¾¤ï¼Œå§‹äº2008å¹´ï¼Œåœ¨é˜¿é‡Œæœå½¹3å¹´å¤šï¼Œæ¥ç®¡3000+ä¸ªMySQLæ•°æ®åº“çš„ schema,é›†ç¾¤æ—¥å¤„ç†åœ¨çº¿SQLè¯·æ±‚50äº¿æ¬¡ä»¥ä¸Šã€‚ç”±äºCobarå‘èµ·äººçš„ç¦»èŒï¼ŒCobaråœæ­¢ç»´æŠ¤ã€‚</p><p>â‘¡<code>Mycat</code>æ˜¯å¼€æºç¤¾åŒºåœ¨é˜¿é‡ŒcobaråŸºç¡€ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œè§£å†³äº†cobarå­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶ä¸”åŠ å…¥äº†è®¸å¤šæ–°çš„åŠŸèƒ½åœ¨å…¶ä¸­ã€‚é’å‡ºäºè“è€Œèƒœäºè“ã€‚</p><p>â‘¢<code>OneProxy</code>åŸºäºMySQLå®˜æ–¹çš„proxyæ€æƒ³åˆ©ç”¨cè¯­è¨€è¿›è¡Œå¼€å‘çš„ï¼ŒOneProxyæ˜¯ä¸€æ¬¾å•†ä¸š æ”¶è´¹ çš„ä¸­é—´ä»¶ã€‚èˆå¼ƒäº†ä¸€äº›åŠŸèƒ½ï¼Œä¸“æ³¨åœ¨ æ€§èƒ½å’Œç¨³å®šæ€§ä¸Š ã€‚</p><p>â‘£<code>kingshard</code>ç”±å°å›¢é˜Ÿç”¨goè¯­è¨€å¼€å‘ï¼Œè¿˜éœ€è¦å‘å±•ï¼Œéœ€è¦ä¸æ–­å®Œå–„ã€‚</p><p>â‘¤<code>Vitess</code>æ˜¯Youtubeç”Ÿäº§åœ¨ä½¿ç”¨ï¼Œæ¶æ„å¾ˆå¤æ‚ã€‚ä¸æ”¯æŒMySQLåŸç”Ÿåè®®ï¼Œä½¿ç”¨ éœ€è¦å¤§é‡æ”¹é€ æˆ æœ¬ ã€‚</p><p>â‘¥<code>Atlas</code>æ˜¯360å›¢é˜ŸåŸºäºmysql proxyæ”¹å†™ï¼ŒåŠŸèƒ½è¿˜éœ€å®Œå–„ï¼Œé«˜å¹¶å‘ä¸‹ä¸ç¨³å®šã€‚</p><p>â‘¦<code>MaxScale</code>æ˜¯mariadbï¼ˆMySQLåŸä½œè€…ç»´æŠ¤çš„ä¸€ä¸ªç‰ˆæœ¬ï¼‰ ç ”å‘çš„ä¸­é—´ä»¶</p><p>â‘§<code>MySQLRoute</code>æ˜¯MySQLå®˜æ–¹Oracleå…¬å¸å‘å¸ƒçš„ä¸­é—´ä»¶</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145523643.png" alt="image-20220718145523643" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145534856.png" alt="image-20220718145534856" style="zoom:67%;" /><p>ä¸»å¤‡åˆ‡æ¢ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220718145548526.png" alt="image-20220718145548526" style="zoom:67%;" /><ul><li>ä¸»åŠ¨åˆ‡æ¢</li><li>è¢«åŠ¨åˆ‡æ¢</li><li>å¦‚ä½•åˆ¤æ–­ä¸»åº“å‡ºé—®é¢˜äº†ï¼Ÿå¦‚ä½•è§£å†³è¿‡ç¨‹ä¸­çš„æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ ?</li></ul>]]></content>
    
    
    <summary type="html">ä¸»ä»å¤åˆ¶åŸç†ã€ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»ºã€åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>å…¶ä»–æ•°æ®åº“æ—¥å¿—</title>
    <link href="https://wuwawawa.github.io/posts/a42250fc.html"/>
    <id>https://wuwawawa.github.io/posts/a42250fc.html</id>
    <published>2023-04-19T03:05:41.000Z</published>
    <updated>2023-04-18T08:32:23.779Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨è®²è§£æ•°æ®åº“äº‹åŠ¡æ—¶ï¼Œè®²è¿‡ä¸¤ç§æ—¥å¿—ï¼šé‡åšæ—¥å¿—ã€å›æ»šæ—¥å¿—ã€‚</p><p>å¯¹äºçº¿ä¸Šæ•°æ®åº“åº”ç”¨ç³»ç»Ÿï¼Œçªç„¶é­é‡<code>æ•°æ®åº“å®•æœº</code>æ€ä¹ˆåŠï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>å®šä½å®•æœºçš„åŸå› </code>å°±éå¸¸å…³é”®ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æ•°æ®åº“çš„<code>é”™è¯¯æ—¥å¿—</code>ã€‚å› ä¸ºæ—¥å¿—ä¸­è®°å½•äº†æ•°æ®åº“è¿è¡Œä¸­çš„è¯Šæ–­ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†é”™è¯¯ã€è­¦å‘Šå’Œæ³¨é‡Šç­‰ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š</p><p>ä»æ—¥å¿—ä¸­å‘ç°æŸä¸ªè¿æ¥ä¸­çš„ SQL æ“ä½œå‘ç”Ÿäº†æ­»å¾ªç¯ï¼Œå¯¼è‡´å†…å­˜ä¸è¶³ï¼Œè¢«ç³»ç»Ÿå¼ºè¡Œç»ˆæ­¢äº†ã€‚æ˜ç¡®äº†åŸå› ï¼Œå¤„ç†èµ·æ¥ä¹Ÿå°±è½»æ¾äº†ï¼Œç³»ç»Ÿå¾ˆå¿«å°±æ¢å¤äº†è¿è¡Œã€‚</p><p>é™¤äº†å‘ç°é”™è¯¯ï¼Œæ—¥å¿—åœ¨æ•°æ®å¤åˆ¶ã€æ•°æ®æ¢å¤ã€æ“ä½œå®¡è®¡ï¼Œä»¥åŠç¡®ä¿æ•°æ®çš„æ°¸ä¹…æ€§å’Œä¸€è‡´æ€§ç­‰æ–¹é¢ï¼Œéƒ½æœ‰ç€ä¸å¯æ›¿ä»£çš„ä½œç”¨ã€‚</p><p><strong>åƒä¸‡ä¸è¦å°çœ‹æ—¥å¿—</strong>ã€‚å¾ˆå¤šçœ‹ä¼¼å¥‡æ€ªçš„é—®é¢˜ï¼Œç­”æ¡ˆå¾€å¾€å°±è—åœ¨æ—¥å¿—é‡Œã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œåªæœ‰é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ‰ èƒ½å‘ç°é—®é¢˜çš„åŸå› ï¼ŒçœŸæ­£è§£å†³é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦å­¦ä¼šæŸ¥çœ‹æ—¥å¿—ï¼Œå…»æˆæ£€æŸ¥æ—¥å¿—çš„ä¹ æƒ¯ï¼Œå¯¹æå‡ä½ çš„æ•° æ®åº“åº”ç”¨å¼€å‘èƒ½åŠ›è‡³å…³é‡è¦ã€‚</p><p>MySQL8.0 å®˜ç½‘æ—¥å¿—åœ°å€ï¼š <a href="https://dev.mysql.com/doc/refman/8.0/en/server-logs.html">https://dev.mysql.com/doc/refman/8.0/en/server-logs.html</a></p><hr><h2 id="1-MySQLæ”¯æŒçš„æ—¥å¿—">1. MySQLæ”¯æŒçš„æ—¥å¿—</h2><h3 id="1-1-æ—¥å¿—ç±»å‹">1.1 æ—¥å¿—ç±»å‹</h3><p>MySQLæœ‰ä¸åŒç±»å‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œç”¨æ¥å­˜å‚¨ä¸åŒç±»å‹çš„æ—¥å¿—ï¼Œåˆ†ä¸º<code>äºŒè¿›åˆ¶æ—¥å¿—</code>ã€<code>é”™è¯¯æ—¥å¿—</code>ã€<code>é€šç”¨æŸ¥è¯¢æ—¥å¿—</code>å’Œ<code>æ…¢æŸ¥è¯¢æ—¥å¿—</code>ï¼Œè¿™ä¹Ÿæ˜¯å¸¸ç”¨çš„4ç§ã€‚MySQL 8åˆæ–°å¢ä¸¤ç§æ”¯æŒçš„æ—¥å¿—ï¼š ä¸­ç»§æ—¥å¿— å’Œ æ•°æ®å®šä¹‰è¯­å¥æ—¥å¿— ã€‚ä½¿ç”¨è¿™äº›æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹MySQLå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚</p><p>è¿™6ç±»æ—¥å¿—åˆ†åˆ«ä¸ºï¼š</p><ul><li><strong>æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_timeçš„æ‰€æœ‰æŸ¥è¯¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚</li><li><strong>é€šç”¨æŸ¥è¯¢æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰è¿æ¥çš„èµ·å§‹æ—¶é—´å’Œç»ˆæ­¢æ—¶é—´ï¼Œä»¥åŠè¿æ¥å‘é€ç»™æ•°æ®åº“æœåŠ¡å™¨çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œ å¯¹æˆ‘ä»¬å¤åŸæ“ä½œçš„å®é™…åœºæ™¯ã€å‘ç°é—®é¢˜ï¼Œç”šè‡³æ˜¯å¯¹æ•°æ®åº“æ“ä½œçš„å®¡è®¡éƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</li><li><strong>é”™è¯¯æ—¥å¿—</strong>ï¼šè®°å½•MySQLæœåŠ¡çš„å¯åŠ¨ã€è¿è¡Œæˆ–åœæ­¢MySQLæœåŠ¡æ—¶å‡ºç°çš„é—®é¢˜ï¼Œæ–¹ä¾¿æˆ‘ä»¬äº†è§£æœåŠ¡å™¨çš„ çŠ¶æ€ï¼Œä»è€Œå¯¹æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ã€‚</li><li><strong>äºŒè¿›åˆ¶æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰æ›´æ”¹æ•°æ®çš„è¯­å¥ï¼Œå¯ä»¥ç”¨äºä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Œä»¥åŠæœåŠ¡å™¨é‡åˆ°æ•… éšœæ—¶æ•°æ®çš„æ— æŸå¤±æ¢å¤ã€‚</li><li><strong>ä¸­ç»§æ—¥å¿—</strong>ï¼šç”¨äºä¸»ä»æœåŠ¡å™¨æ¶æ„ä¸­ï¼Œä»æœåŠ¡å™¨ç”¨æ¥å­˜æ”¾ä¸»æœåŠ¡å™¨äºŒè¿›åˆ¶æ—¥å¿—å†…å®¹çš„ä¸€ä¸ªä¸­é—´æ–‡ä»¶ã€‚ ä»æœåŠ¡å™¨é€šè¿‡è¯»å–ä¸­ç»§æ—¥å¿—çš„å†…å®¹ï¼Œæ¥åŒæ­¥ä¸»æœåŠ¡å™¨ä¸Šçš„æ“ä½œã€‚</li><li><strong>æ•°æ®å®šä¹‰è¯­å¥æ—¥å¿—</strong>ï¼šè®°å½•æ•°æ®å®šä¹‰è¯­å¥æ‰§è¡Œçš„å…ƒæ•°æ®æ“ä½œã€‚</li></ul><p>é™¤äºŒè¿›åˆ¶æ—¥å¿—å¤–ï¼Œå…¶ä»–æ—¥å¿—éƒ½æ˜¯<code>æ–‡æœ¬æ–‡ä»¶</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ—¥å¿—åˆ›å»ºäº<code>MySQLæ•°æ®ç›®å½•</code>ä¸­ã€‚</p><h3 id="1-2-æ—¥å¿—çš„å¼Šç«¯">1.2 æ—¥å¿—çš„å¼Šç«¯</h3><ul><li>æ—¥å¿—åŠŸèƒ½ä¼š<code>é™ä½MySQLæ•°æ®åº“çš„æ€§èƒ½</code>ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸ¥è¯¢éå¸¸é¢‘ç¹çš„MySQLæ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¦‚æœå¼€å¯äº†é€šç”¨æŸ¥è¯¢æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒMySQLæ•°æ®åº“ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´è®°å½•æ—¥å¿—ã€‚</li><li>æ—¥å¿—ä¼š<code>å ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´</code>ã€‚å¯¹äºç”¨æˆ·é‡éå¸¸å¤§ï¼Œæ“ä½œéå¸¸é¢‘ç¹çš„æ•°æ®åº“ï¼Œæ—¥å¿—æ–‡ä»¶éœ€è¦çš„å­˜å‚¨ç©ºé—´è®¾ç½®æ¯”æ•°æ®åº“æ–‡ä»¶éœ€è¦çš„å­˜å‚¨ç©ºé—´è¿˜è¦å¤§ã€‚</li></ul><hr><h2 id="2-æ…¢æŸ¥è¯¢æ—¥å¿—-slow-query-log">2. æ…¢æŸ¥è¯¢æ—¥å¿—(slow query log)</h2><p>å‰é¢ç« èŠ‚ã€Šæ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨ã€‹å·²ç»è¯¦ç»†è®²è¿°ã€‚</p><div class="tag link"><a class="link-card" title="æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨" href="/posts/2678f2d3.html#4-å®šä½æ‰§è¡Œæ…¢çš„SQL-æ…¢æŸ¥è¯¢æ—¥å¿—"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/favicon.png"/></div><div class="right"><p class="text">æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</p><p class="url">/posts/2678f2d3.html#4-å®šä½æ‰§è¡Œæ…¢çš„SQL-æ…¢æŸ¥è¯¢æ—¥å¿—</p></div></a></div><hr><h2 id="3-é€šç”¨æŸ¥è¯¢æ—¥å¿—-general-query-log">3. é€šç”¨æŸ¥è¯¢æ—¥å¿—(general query log)</h2><p>é€šç”¨æŸ¥è¯¢æ—¥å¿—ç”¨æ¥<code>è®°å½•ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ</code>ï¼ŒåŒ…æ‹¬å¯åŠ¨å’Œå…³é—­MySQLæœåŠ¡ã€æ‰€æœ‰ç”¨æˆ·çš„è¿æ¥å¼€å§‹æ—¶é—´å’Œæˆªæ­¢ æ—¶é—´ã€å‘ç»™ MySQLæ•°æ®åº“æœåŠ¡å™¨çš„æ‰€æœ‰ SQLæŒ‡ä»¤ç­‰ã€‚å½“æˆ‘ä»¬çš„æ•°æ®å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ<span class='p green'>æŸ¥çœ‹é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œ è¿˜åŸæ“ä½œæ—¶çš„å…·ä½“åœºæ™¯</span>ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡†ç¡®å®šä½é—®é¢˜ã€‚</p><h3 id="3-1-é—®é¢˜åœºæ™¯">3.1 é—®é¢˜åœºæ™¯</h3><p>åœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œè´­ä¹°å•†å“å¹¶ä¸”ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜å®Œæˆä»¥åï¼Œå´å‘ç°æ”¯ä»˜ä¸­å¿ƒçš„è®°å½•å¹¶æ²¡æœ‰æ–°å¢ï¼Œæ­¤æ—¶ç”¨æˆ·å†æ¬¡ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ï¼Œå°±ä¼šå‡ºç°é‡å¤æ”¯ä»˜çš„é—®é¢˜ã€‚ä½†æ˜¯å½“å»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œä¼šå‘ç°åªæœ‰ä¸€æ¡è®°å½•å­˜åœ¨ã€‚é‚£ä¹ˆæ­¤æ—¶ç»™åˆ°çš„ç°è±¡å°±æ˜¯åªæœ‰ä¸€æ¡æ”¯ä»˜è®°å½•ï¼Œä½†æ˜¯ç”¨æˆ·å´æ”¯ä»˜äº†ä¸¤æ¬¡ã€‚</p><p>æˆ‘ä»¬å¯¹ç³»ç»Ÿè¿›è¡Œäº†ä»”ç»†æ£€æŸ¥ï¼Œæ²¡æœ‰å‘ç°æ•°æ®é—®é¢˜ï¼Œå› ä¸ºç”¨æˆ·ç¼–å·å’Œè®¢å•ç¼–å·ä»¥åŠç¬¬ä¸‰æ–¹æµæ°´å·éƒ½æ˜¯å¯¹çš„ã€‚å¯æ˜¯ç”¨æˆ·ç¡®å®æ”¯ä»˜äº†ä¸¤æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†æ£€æŸ¥é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œçœ‹çœ‹å½“å¤©åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>æŸ¥çœ‹ä¹‹åï¼Œå‘ç°ï¼š1æœˆ1æ—¥ä¸‹åˆ2ç‚¹ï¼Œç”¨æˆ·ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜å®Œä»¥åï¼Œä½†æ˜¯ç”±äºç½‘ç»œæ•…éšœï¼Œæ”¯ä»˜ä¸­å¿ƒæ²¡æœ‰åŠæ—¶æ”¶åˆ°å¾®ä¿¡æ”¯ä»˜çš„å›è°ƒé€šçŸ¥ï¼Œå¯¼è‡´å½“æ—¶æ²¡æœ‰å†™å…¥æ•°æ®ã€‚1æœˆ1æ—¥ä¸‹åˆ2ç‚¹30ï¼Œç”¨æˆ·åˆä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ï¼Œæ­¤æ—¶è®°å½•æ›´æ–°åˆ°æ”¯ä»˜ä¸­å¿ƒã€‚1æœˆ1æ—¥æ™šä¸Š9ç‚¹ï¼Œå¾®ä¿¡çš„å›è°ƒé€šçŸ¥è¿‡æ¥äº†ï¼Œä½†æ˜¯æ”¯ä»˜ä¸­å¿ƒå·²ç»å­˜åœ¨äº†æ”¯ä»˜å®çš„è®°å½•ï¼Œæ‰€ä»¥åªèƒ½è¦†ç›–è®°å½•äº†ã€‚</p><p>ç”±äºç½‘ç»œçš„åŸå› å¯¼è‡´äº†é‡å¤æ”¯ä»˜ã€‚è‡³äºè§£å†³é—®é¢˜çš„æ–¹æ¡ˆå°±å¾ˆå¤šäº†ï¼Œè¿™é‡Œçœç•¥ã€‚</p><p>å¯ä»¥çœ‹åˆ°é€šç”¨æŸ¥è¯¢æ—¥å¿—å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£æ“ä½œå‘ç”Ÿçš„å…·ä½“æ—¶é—´å’Œæ“ä½œçš„ç»†èŠ‚ï¼Œå¯¹æ‰¾å‡ºå¼‚å¸¸å‘ç”Ÿçš„åŸå› æå…¶å…³é”®ã€‚</p><hr><h3 id="2-æŸ¥çœ‹å½“å‰çŠ¶æ€">2 æŸ¥çœ‹å½“å‰çŠ¶æ€</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%general%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span>                        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="operator">|</span> general_log      <span class="operator">|</span> OFF                          <span class="operator">|</span> #é€šç”¨æŸ¥è¯¢æ—¥å¿—å¤„äºå…³é—­çŠ¶æ€</span><br><span class="line"><span class="operator">|</span> general_log_file <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>fortune01.log <span class="operator">|</span> #é€šç”¨æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„åç§° ä¸»æœºå</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure><p>è¯´æ˜1ï¼šç³»ç»Ÿå˜é‡ genera_log çš„å€¼æ˜¯OFFï¼Œå³é€šç”¨æŸ¥è¯¢æ—¥å¿—å¤„äºå…³é—­çŠ¶æ€ã€‚åœ¨MySQLä¸­ï¼Œè¿™ä¸ªå‚æ•°çš„<code>é»˜è®¤å€¼æ˜¯å…³é—­çš„</code>ã€‚å› ä¸ºä¸€æ—¦å¼€å¯è®°å½•é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼ŒMySQLä¼šè®°å½•æ‰€æœ‰çš„è¿æ¥èµ·æ­¢å’Œç›¸å…³çš„SQLæ“ä½œï¼Œè¿™æ ·ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºå¹¶ä¸”å ç”¨ç£ç›˜ç©ºé—´ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹å˜é‡çš„å€¼ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å¼€å¯æ—¥å¿—ã€‚</p><p>è¯´æ˜2ï¼šé€šç”¨æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„åç§°æ˜¯fortune01.logã€‚å­˜å‚¨è·¯å¾„æ˜¯/var/ib/mysqlï¼Œé»˜è®¤ä¹Ÿæ˜¯æ•°æ®è·¯å¾„ã€‚è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“åœ¨å“ªé‡Œå¯ä»¥æŸ¥çœ‹é€šç”¨æŸ¥è¯¢æ—¥å¿—çš„å†…å®¹äº†ã€‚</p><hr><h3 id="3-3-å¯åŠ¨æ—¥å¿—">3.3 å¯åŠ¨æ—¥å¿—</h3><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><p>ä¿®æ”¹my.cnfæˆ–è€…my.inié…ç½®æ–‡ä»¶æ¥è®¾ç½®ã€‚åœ¨[mysqld]ç»„ä¸‹åŠ å…¥logé€‰é¡¹ï¼Œå¹¶é‡å¯MySQLæœåŠ¡ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">general_log</span>=<span class="string">ON</span></span><br><span class="line"><span class="attr">general_log_file</span>=<span class="string">[path[filename]] #æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•è·¯å¾„ï¼Œfilenameä¸ºæ—¥å¿—æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æŒ‡å®šç›®å½•å’Œæ–‡ä»¶åï¼Œé€šç”¨æŸ¥è¯¢æ—¥å¿—å°†é»˜è®¤å­˜å‚¨åœ¨MySQLæ•°æ®ç›®å½•ä¸­çš„hostname.logæ–‡ä»¶ä¸­ï¼Œ hostnameè¡¨ç¤ºä¸»æœºåã€‚</p><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log<span class="operator">=</span><span class="keyword">on</span>; # å¼€å¯é€šç”¨æŸ¥è¯¢æ—¥å¿—</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log_file<span class="operator">=</span>â€™path<span class="operator">/</span>filenameâ€™; # è®¾ç½®æ—¥å¿—æ–‡ä»¶ä¿å­˜ä½ç½®</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ï¼Œå…³é—­æ“ä½œSQLå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log<span class="operator">=</span>off; # å…³é—­é€šç”¨æŸ¥è¯¢æ—¥å¿—</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è®¾ç½®åæƒ…å†µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;general_log%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="3-4-æŸ¥çœ‹æ—¥å¿—">3.4 æŸ¥çœ‹æ—¥å¿—</h3><p>é€šç”¨æŸ¥è¯¢æ—¥å¿—æ˜¯ä»¥<code>æ–‡æœ¬æ–‡ä»¶</code>çš„å½¢å¼å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ï¼Œå¯ä»¥ä½¿ç”¨<code>æ–‡æœ¬ç¼–è¾‘å™¨</code>ç›´æ¥æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚æ¯å° MySQLæœåŠ¡å™¨çš„é€šç”¨æŸ¥è¯¢æ—¥å¿—å†…å®¹æ˜¯ä¸åŒçš„ã€‚</p><ul><li>åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œä½¿ç”¨æ–‡æœ¬æ–‡ä»¶æŸ¥çœ‹å™¨ï¼›</li><li>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨viå·¥å…·æˆ–è€…geditå·¥å…·æŸ¥çœ‹ï¼›</li><li>åœ¨Mac OSXç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬æ–‡ä»¶æŸ¥çœ‹å™¨æˆ–è€…viç­‰å·¥å…·æŸ¥çœ‹ã€‚</li></ul><p>ä»<code>SHOW VARIABLES LIKE 'general_log%'</code>; ç»“æœä¸­å¯ä»¥çœ‹åˆ°é€šç”¨æŸ¥è¯¢æ—¥å¿—çš„ä½ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>usr<span class="operator">/</span>sbin<span class="operator">/</span>mysqld, Version: <span class="number">8.0</span><span class="number">.26</span> (MySQL Community Server <span class="operator">-</span> GPL). started <span class="keyword">with</span>:</span><br><span class="line">Tcp port: <span class="number">3306</span> Unix socket: <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>mysql.sock</span><br><span class="line"><span class="type">Time</span> Id Command Argument</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">44</span>:<span class="number">58.052890</span>Z <span class="number">10</span> Query <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%general%&#x27;</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">45</span>:<span class="number">15.666672</span>Z <span class="number">10</span> Query <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;general_log%&#x27;</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">45</span>:<span class="number">28.970765</span>Z <span class="number">10</span> Query <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">47</span>:<span class="number">38.706804</span>Z <span class="number">11</span> <span class="keyword">Connect</span> root<span class="variable">@localhost</span> <span class="keyword">on</span> <span class="keyword">using</span> Socket</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">47</span>:<span class="number">38.707435</span>Z <span class="number">11</span> Query <span class="keyword">select</span> @<span class="variable">@version</span>_comment limit <span class="number">1</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">21.384886</span>Z <span class="number">12</span> <span class="keyword">Connect</span> root<span class="variable">@172</span><span class="number">.16</span><span class="number">.210</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">using</span> TCP<span class="operator">/</span>IP</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">21.385253</span>Z <span class="number">12</span> Query <span class="keyword">SET</span> NAMES utf8</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">21.385640</span>Z <span class="number">12</span> Query USE`atguigu12`</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">21.386179</span>Z <span class="number">12</span> Query <span class="keyword">SHOW</span> <span class="keyword">FULL</span> TABLES <span class="keyword">WHERE</span> Table_Type <span class="operator">!=</span></span><br><span class="line"><span class="string">&#x27;VIEW&#x27;</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">23.901778</span>Z <span class="number">13</span> <span class="keyword">Connect</span> root<span class="variable">@172</span><span class="number">.16</span><span class="number">.210</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">using</span> TCP<span class="operator">/</span>IP</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">23.902128</span>Z <span class="number">13</span> Query <span class="keyword">SET</span> NAMES utf8</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">23.905179</span>Z <span class="number">13</span> Query USE`atguigu`</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">23.905825</span>Z <span class="number">13</span> Query <span class="keyword">SHOW</span> <span class="keyword">FULL</span> TABLES <span class="keyword">WHERE</span> Table_Type <span class="operator">!=</span></span><br><span class="line"><span class="string">&#x27;VIEW&#x27;</span></span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">32.163833</span>Z <span class="number">14</span> <span class="keyword">Connect</span> root<span class="variable">@172</span><span class="number">.16</span><span class="number">.210</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">using</span> TCP<span class="operator">/</span>IP</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">32.164451</span>Z <span class="number">14</span> Query <span class="keyword">SET</span> NAMES utf8</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">32.164840</span>Z <span class="number">14</span> Query USE`atguigu`</span><br><span class="line"><span class="number">2022</span><span class="number">-01</span><span class="number">-04</span>T07:<span class="number">48</span>:<span class="number">40.006687</span>Z <span class="number">14</span> Query <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account</span><br></pre></td></tr></table></figure><p>åœ¨é€šç”¨æŸ¥è¯¢æ—¥å¿—é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œä»€ä¹ˆæ—¶å€™å¼€å¯äº†æ–°çš„å®¢æˆ·ç«¯ç™»é™†æ•°æ®åº“ï¼Œç™»å½•ä¹‹ååšäº†ä»€ä¹ˆ SQL æ“ä½œï¼Œé’ˆå¯¹çš„æ˜¯å“ªä¸ªæ•°æ®è¡¨ç­‰ä¿¡æ¯ã€‚</p><h3 id="3-5-åœæ­¢æ—¥å¿—">3.5 åœæ­¢æ—¥å¿—</h3><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><p>ä¿®æ”¹<code>my.cnf</code>æˆ–è€…<code>my.ini</code>æ–‡ä»¶ï¼ŒæŠŠ[mysqld]ç»„ä¸‹çš„<code>general_log</code>å€¼è®¾ç½®ä¸º<code>OFF</code>æˆ–è€…æŠŠgeneral_logä¸€é¡¹ æ³¨é‡Šæ‰ã€‚ä¿®æ”¹ä¿å­˜åï¼Œå†<code>é‡å¯MySQLæœåŠ¡</code>ï¼Œå³å¯ç”Ÿæ•ˆã€‚</p><p>ä¸¾ä¾‹1ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">general_log</span>=<span class="string">OFF</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹2ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#general_log=ON</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><p>ä½¿ç”¨SETè¯­å¥åœæ­¢MySQLé€šç”¨æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log<span class="operator">=</span>off;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢é€šç”¨æ—¥å¿—åŠŸèƒ½ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;general_log%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="3-6-åˆ é™¤-åˆ·æ–°æ—¥å¿—">3.6 åˆ é™¤\åˆ·æ–°æ—¥å¿—</h3><p>å¦‚æœæ•°æ®çš„ä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œé‚£ä¹ˆé€šç”¨æŸ¥è¯¢æ—¥å¿—ä¼šå ç”¨æœåŠ¡å™¨éå¸¸å¤§çš„ç£ç›˜ç©ºé—´ã€‚æ•°æ®ç®¡ç†å‘˜å¯ä»¥åˆ é™¤å¾ˆé•¿æ—¶é—´ä¹‹å‰çš„æŸ¥è¯¢æ—¥å¿—ï¼Œä»¥ä¿è¯MySQLæœåŠ¡å™¨ä¸Šçš„ç¡¬ç›˜ç©ºé—´ã€‚</p><p><strong>æ‰‹åŠ¨åˆ é™¤æ–‡ä»¶</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;general_log%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œé€šç”¨æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•é»˜è®¤ä¸ºMySQLæ•°æ®ç›®å½•ã€‚åœ¨è¯¥ç›®å½•ä¸‹æ‰‹åŠ¨åˆ é™¤é€šç”¨æŸ¥è¯¢æ—¥å¿— atguigu01.log</p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”ŸæˆæŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ã€‚åˆ·æ–°MySQLæ•°æ®ç›®å½•ï¼Œå‘ç°åˆ›å»ºäº†æ–°çš„æ—¥å¿—æ–‡ ä»¶ã€‚å‰æä¸€å®šè¦å¼€å¯é€šç”¨æ—¥å¿—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin <span class="operator">-</span>uroot <span class="operator">-</span>p flush<span class="operator">-</span>logs</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›å¤‡ä»½æ—§çš„é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œå°±å¿…é¡»å…ˆå°†æ—§çš„æ—¥å¿—æ–‡ä»¶å¤åˆ¶å‡ºæ¥æˆ–è€…æ”¹åï¼Œç„¶åæ‰§è¡Œä¸Šé¢çš„mysqladminå‘½ä»¤ã€‚æ­£ç¡®æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd mysql-data-directory # è¾“å…¥è‡ªå·±çš„é€šç”¨æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br><span class="line">mv mysql.general.log mysql.general.log.old # æŒ‡å®šæ—§çš„æ–‡ä»¶å ä»¥åŠ æ–°çš„æ–‡ä»¶å</span><br><span class="line">mysqladmin -uroot -p flush-logs</span><br></pre></td></tr></table></figure><h2 id="4-é”™è¯¯æ—¥å¿—-error-log">4. é”™è¯¯æ—¥å¿—(error log)</h2><p>é”™è¯¯æ—¥å¿—è®°å½•äº† MySQLæœåŠ¡å™¨å¯åŠ¨ã€åœæ­¢è¿è¡Œçš„æ—¶é—´ï¼Œä»¥åŠç³»ç»Ÿå¯åŠ¨ã€è¿è¡Œå’Œåœæ­¢è¿‡ç¨‹ä¸­çš„è¯Šæ–­ä¿¡æ¯ï¼ŒåŒ…æ‹¬<code>é”™è¯¯</code>ã€<code>è­¦å‘Š</code>å’Œ<code>æç¤º</code>ç­‰ã€‚</p><p>é€šè¿‡é”™è¯¯æ—¥å¿—å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼Œä¾¿äºå³æ—¶å‘ç°æ•…éšœã€ä¿®å¤æ•…éšœã€‚å¦‚æœMySQLæœåŠ¡<code>å‡ºç°å¼‚å¸¸</code>ï¼Œé”™è¯¯æ—¥å¿—æ˜¯å‘ç°é—®é¢˜ã€è§£å†³æ•…éšœçš„<code>é¦–é€‰</code>ã€‚</p><h3 id="4-1-å¯åŠ¨æ—¥å¿—">4.1 å¯åŠ¨æ—¥å¿—</h3><p>åœ¨MySQLæ•°æ®åº“ä¸­ï¼Œé”™è¯¯æ—¥å¿—åŠŸèƒ½æ˜¯<code>é»˜è®¤å¼€å¯</code>çš„ã€‚è€Œä¸”ï¼Œé”™è¯¯æ—¥å¿—<code>æ— æ³•è¢«ç¦æ­¢</code>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—å­˜å‚¨åœ¨MySQLæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å¤¹ä¸‹ï¼Œåç§°é»˜è®¤ä¸º<code>mysqld.log</code>ï¼ˆLinuxç³»ç»Ÿï¼‰æˆ–<code>hostname.err</code>ï¼ˆmacç³»ç»Ÿï¼‰ã€‚å¦‚æœéœ€è¦åˆ¶å®šæ–‡ä»¶åï¼Œåˆ™éœ€è¦åœ¨my.cnfæˆ–è€…my.iniä¸­åšå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">log-error</span>=<span class="string">[path/[filename]] #pathä¸ºæ—¥å¿—æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è·¯å¾„ï¼Œfilenameä¸ºæ—¥å¿—æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®é¡¹åï¼Œéœ€è¦é‡å¯MySQLæœåŠ¡ä»¥ç”Ÿæ•ˆã€‚</p><h3 id="4-2-æŸ¥çœ‹æ—¥å¿—">4.2 æŸ¥çœ‹æ—¥å¿—</h3><p>MySQLé”™è¯¯æ—¥å¿—æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶å½¢å¼å­˜å‚¨çš„ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç›´æ¥æŸ¥çœ‹ã€‚</p><p>æŸ¥è¯¢é”™è¯¯æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;log_err%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+----------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name              <span class="operator">|</span> <span class="keyword">Value</span>                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+----------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_error                  <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log                    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_error_services         <span class="operator">|</span> log_filter_internal; log_sink_internal <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_error_suppression_list <span class="operator">|</span>                                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_error_verbosity        <span class="operator">|</span> <span class="number">2</span>                                      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+----------------------------------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœä¸­å¯ä»¥çœ‹åˆ°é”™è¯¯æ—¥å¿—æ–‡ä»¶æ˜¯mysqld.logï¼Œä½äºMySQLé»˜è®¤çš„æ•°æ®ç›®å½•ä¸‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715160657093.png" alt="image-20220715160657093"  /><h3 id="4-3-åˆ é™¤-åˆ·æ–°æ—¥å¿—">4.3 åˆ é™¤\åˆ·æ–°æ—¥å¿—</h3><p>å¯¹äºå¾ˆä¹…ä»¥å‰çš„é”™è¯¯æ—¥å¿—ï¼Œæ•°æ®åº“ç®¡ç†å‘˜æŸ¥çœ‹è¿™äº›é”™è¯¯æ—¥å¿—çš„å¯èƒ½æ€§ä¸å¤§ï¼Œå¯ä»¥å°†è¿™äº›é”™è¯¯æ—¥å¿—åˆ é™¤ï¼Œ ä»¥ä¿è¯MySQLæœåŠ¡å™¨ä¸Šçš„<code>ç¡¬ç›˜ç©ºé—´</code>ã€‚MySQLçš„é”™è¯¯æ—¥å¿—æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ï¼Œå¯ä»¥<code>ç›´æ¥åˆ é™¤</code>ã€‚</p><ul><li>ç¬¬ä¸€æ­¥ï¼ˆæ–¹å¼1ï¼‰ï¼šåˆ é™¤æ“ä½œ</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm <span class="operator">-</span>f <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>mysqld.log</span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡ŒçŠ¶æ€ä¸‹åˆ é™¤é”™è¯¯æ—¥å¿—æ–‡ä»¶åï¼ŒMySQLå¹¶ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ã€‚</p><ul><li>ç¬¬ä¸€æ­¥ï¼ˆæ–¹å¼2ï¼‰ï¼šé‡å‘½åæ–‡ä»¶</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log.old</span><br></pre></td></tr></table></figure><ul><li>ç¬¬äºŒæ­¥ï¼šé‡å»ºæ—¥å¿—</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin <span class="operator">-</span>uroot <span class="operator">-</span>p flush<span class="operator">-</span>logs</span><br></pre></td></tr></table></figure><p>å¯èƒ½ä¼šæŠ¥é”™</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@atguigu01</span> log]# mysqladmin <span class="operator">-</span>uroot <span class="operator">-</span>p flush<span class="operator">-</span>logs</span><br><span class="line">Enter password:</span><br><span class="line">mysqladmin: refresh failed; error: <span class="string">&#x27;Could not open file &#x27;</span><span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log<span class="string">&#x27; for</span></span><br><span class="line"><span class="string">error logging.&#x27;</span></span><br></pre></td></tr></table></figure><p>å®˜ç½‘æç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715161132368.png" alt="image-20220715161132368"></p><p>è¡¥å……æ“ä½œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install <span class="operator">-</span>omysql <span class="operator">-</span>gmysql <span class="operator">-</span>m0644 <span class="operator">/</span>dev<span class="operator">/</span><span class="keyword">null</span> <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log</span><br></pre></td></tr></table></figure><p><code>flush-logs</code>æŒ‡ä»¤æ“ä½œï¼š</p><ul><li><p>MysQL 5.5.7ä»¥å‰çš„ç‰ˆæœ¬ï¼Œflush-logså°†é”™è¯¯æ—¥å¿—æ–‡ä»¶é‡å‘½åä¸ºflename.err_oldï¼Œå¹¶åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚</p></li><li><p>ä»MySQL5.5.7å¼€å§‹ï¼Œflush-ogsåªæ˜¯é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸åšæ—¥å¿—å¤‡ä»½å’Œåˆ›å»ºçš„æ“ä½œã€‚</p></li><li><p>å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒMySQLå¯åŠ¨æˆ–è€…æ‰§è¡Œflush-logsæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚é‡æ–°åˆ›å»ºé”™è¯¯æ—¥å¿—ï¼Œå¤§å°ä¸º0å­—èŠ‚ã€‚</p></li></ul><h3 id="4-4-MySQL-8-0-æ–°ç‰¹æ€§">4.4 MySQL 8.0 æ–°ç‰¹æ€§</h3><p>MySQL8.0é‡Œå¯¹é”™è¯¯æ—¥å¿—çš„æ”¹è¿›ã€‚MySQL8.0çš„é”™è¯¯æ—¥å¿—å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå…¨æ–°çš„æ—¥å¿—ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬é‡Œï¼Œæ¥å—äº†æ¥è‡ªç¤¾åŒºçš„å¹¿æ³›æ‰¹è¯„æ„è§ï¼Œåœ¨è¿™äº›æ„è§å’Œå»ºè®®çš„åŸºç¡€ä¸Šç”Ÿæˆäº†æ–°çš„æ—¥å¿—ï¼Œ ä¸‹é¢è¿™äº›æ˜¯æ¥è‡ªç¤¾åŒºçš„æ„è§ï¼š</p><ul><li><p>é»˜è®¤æƒ…å†µä¸‹å†…å®¹è¿‡äºå†—é•¿</p></li><li><p>é—æ¼äº†æœ‰ç”¨çš„ä¿¡æ¯</p></li><li><p>éš¾ä»¥è¿‡æ»¤æŸäº›ä¿¡æ¯</p></li><li><p>æ²¡æœ‰æ ‡è¯†é”™è¯¯ä¿¡æ¯çš„å­ç³»ç»Ÿæº</p></li><li><p>æ²¡æœ‰é”™è¯¯ä»£ç ï¼Œè§£ææ¶ˆæ¯éœ€è¦è¯†åˆ«é”™è¯¯</p></li><li><p>å¼•å¯¼æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±</p></li><li><p>å›ºå®šæ ¼å¼</p></li></ul><p>é’ˆå¯¹è¿™äº›æ„è§ï¼ŒMySQLåšäº†å¦‚ä¸‹æ”¹å˜ï¼š</p><ul><li><p>é‡‡ç”¨ç»„ä»¶æ¶æ„ï¼Œé€šè¿‡ä¸åŒçš„ç»„ä»¶æ‰§è¡Œæ—¥å¿—çš„å†™å…¥å’Œè¿‡æ»¤åŠŸèƒ½</p></li><li><p>å†™å…¥é”™è¯¯æ—¥å¿—çš„å…¨éƒ¨ä¿¡æ¯éƒ½å…·æœ‰å”¯ä¸€çš„é”™è¯¯ä»£ç ä»10000å¼€å§‹</p></li><li><p>å¢åŠ äº†ä¸€ä¸ªæ–°çš„æ¶ˆæ¯åˆ†ç±»ã€Šsystemã€‹ç”¨äºåœ¨é”™è¯¯æ—¥å¿—ä¸­å§‹ç»ˆå¯è§çš„éé”™è¯¯ä½†æœåŠ¡å™¨çŠ¶æ€æ›´æ”¹äº‹ä»¶çš„æ¶ˆæ¯å¢åŠ äº†é¢å¤–çš„é™„åŠ ä¿¡æ¯ï¼Œä¾‹å¦‚å…³æœºæ—¶çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè°å‘èµ·çš„å…³æœºç­‰ç­‰</p></li><li><p>ä¸¤ç§è¿‡æ»¤æ–¹å¼ï¼ŒInternalå’ŒDragnet</p></li><li><p>ä¸‰ç§å†™å…¥å½¢å¼ï¼Œç»å…¸ã€JSONå’Œsyseventlog</p></li></ul><blockquote><p>å°ç»“ï¼š</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç®¡ç†å‘˜ä¸éœ€è¦æŸ¥çœ‹é”™è¯¯æ—¥å¿—ã€‚ä½†æ˜¯ï¼ŒMySQLæœåŠ¡å™¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œç®¡ç†å‘˜å¯ä»¥ä»é”™è¯¯æ—¥å¿—ä¸­æ‰¾åˆ°å‘ç”Ÿå¼‚å¸¸çš„æ—¶é—´ã€åŸå› ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯æ¥è§£å†³å¼‚å¸¸ã€‚</p></blockquote><hr><h2 id="5-äºŒè¿›åˆ¶æ—¥å¿—-bin-log">5. äºŒè¿›åˆ¶æ—¥å¿—(bin log)</h2><p>binlogå¯ä»¥è¯´æ˜¯MySQLä¸­æ¯”è¾ƒ<code>é‡è¦</code>çš„æ—¥å¿—äº†ï¼Œåœ¨æ—¥å¸¸å¼€å‘åŠè¿ç»´è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°ã€‚</p><p>binlogå³binary logï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œä¹Ÿå«ä½œå˜æ›´æ—¥å¿—ï¼ˆupdate logï¼‰ã€‚å®ƒè®°å½•äº†æ•°æ®åº“æ‰€æœ‰æ‰§è¡Œçš„<code>DDL</code>å’Œ<code>DML</code>ç­‰æ•°æ®åº“æ›´æ–°äº‹ä»¶çš„è¯­å¥ï¼Œä½†æ˜¯ä¸åŒ…å«æ²¡æœ‰ä¿®æ”¹ä»»ä½•æ•°æ®çš„è¯­å¥ï¼ˆå¦‚æ•°æ®æŸ¥è¯¢è¯­å¥selectã€ showç­‰ï¼‰ã€‚</p><p>å®ƒä»¥<code>äº‹ä»¶å½¢å¼</code>è®°å½•å¹¶ä¿å­˜åœ¨<code>äºŒè¿›åˆ¶æ–‡ä»¶</code>ä¸­ã€‚é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å†ç°æ•°æ®æ›´æ–°æ“ä½œçš„å…¨è¿‡ç¨‹ã€‚</p><blockquote><p>å¦‚æœæƒ³è¦è®°å½•æ‰€æœ‰è¯­å¥ï¼ˆä¾‹å¦‚ï¼Œä¸ºäº†è¯†åˆ«æœ‰é—®é¢˜çš„æŸ¥è¯¢ï¼‰ï¼Œéœ€è¦ä½¿ç”¨é€šç”¨æŸ¥è¯¢æ—¥å¿—ã€‚</p></blockquote><p>binlogä¸»è¦åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p>ä¸€æ˜¯ç”¨äº<code>æ•°æ®æ¢å¤</code>ï¼Œå¦‚æœMysQLæ•°æ®åº“æ„å¤–åœæ­¢ï¼Œå¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ¥æŸ¥çœ‹ç”¨æˆ·æ‰§è¡Œäº†å“ªäº›æ“ä½œï¼Œå¯¹æ•°æ®åº“æœåŠ¡å™¨æ–‡ä»¶åšäº†å“ªäº›ä¿®æ”¹ï¼Œç„¶åæ ¹æ®äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¸­çš„è®°å½•æ¥æ¢å¤æ•°æ®åº“æœåŠ¡å™¨ã€‚</p></li><li><p>äºŒæ˜¯ç”¨äº<code>æ•°æ®å¤åˆ¶</code>ï¼Œç”±äºæ—¥å¿—çš„å»¶ç»­æ€§å’Œæ—¶æ•ˆæ€§ï¼ŒmasteræŠŠå®ƒçš„äºŒè¿›åˆ¶æ—¥å¿—ä¼ é€’ç»™slavesæ¥è¾¾åˆ°master-slaveæ•°æ®ä¸€è‡´çš„ç›®çš„ã€‚</p></li></ul><p>å¯ä»¥è¯´MysQLæ•°æ®åº“çš„<span class='p red'>æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»</span>éƒ½ç¦»ä¸å¼€binlogï¼Œéœ€è¦ä¾é binlogæ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715161842703.png" alt="image-20220715161842703"></p><h3 id="5-1-æŸ¥çœ‹é»˜è®¤æƒ…å†µ">5.1 æŸ¥çœ‹é»˜è®¤æƒ…å†µ</h3><p>æŸ¥çœ‹è®°å½•äºŒè¿›åˆ¶æ—¥å¿—æ˜¯å¦å¼€å¯ï¼šåœ¨MySQL8ä¸­é»˜è®¤æƒ…å†µä¸‹ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¼€å¯çš„ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>                            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_bin                         <span class="operator">|</span> <span class="keyword">ON</span>                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_basename                <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>binlog            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_index                   <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>binlog.index      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_trust_function_creators <span class="operator">|</span> OFF                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_use_v1_row_events       <span class="operator">|</span> OFF                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sql_log_bin                     <span class="operator">|</span> <span class="keyword">ON</span>                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><code>log_bin_basename</code>ï¼šæ˜¯binlogæ—¥å¿—çš„åŸºæœ¬æ–‡ä»¶åï¼Œåé¢ä¼šè¿½åŠ æ ‡è¯†æ¥è¡¨ç¤ºæ¯ä¸€ä¸ªæ–‡ä»¶</p><p><code>log_bin_ index</code>ï¼šæ˜¯binlogæ–‡ä»¶çš„ç´¢å¼•æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç®¡ç†äº†æ‰€æœ‰çš„binlogæ–‡ä»¶çš„ç›®å½•</p><p><code>log_bin_trust_function_creators</code>ï¼šé™åˆ¶å­˜å‚¨è¿‡ç¨‹ï¼Œå‰é¢æˆ‘ä»¬å·±ç»è®²è¿‡äº†ï¼Œè¿™æ˜¯å› ä¸ºäºŒè¿›åˆ¶æ—¥å¿—çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯ç”¨äºä¸»ä»å¤åˆ¶ï¼Œè€Œå­˜å‚¨å‡½æ•°æœ‰å¯èƒ½å¯¼è‡´ä¸»ä»çš„æ•°æ®ä¸ä¸€è‡´ã€‚æ‰€ä»¥å½“å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åï¼Œéœ€è¦é™åˆ¶å­˜å‚¨å‡½æ•°çš„åˆ›å»ºã€ä¿®æ”¹ã€è°ƒç”¨</p><p><code>log_bin_use_v1_row_events</code>æ­¤åªè¯»ç³»ç»Ÿå˜é‡å·²å¼ƒç”¨ã€‚ONè¡¨ç¤ºä½¿ç”¨ç‰ˆæœ¬1äºŒè¿›åˆ¶æ—¥å¿—è¡Œï¼ŒOFFè¡¨ç¤ºä½¿ç”¨ç‰ˆæœ¬2 äºŒè¿›åˆ¶æ—¥å¿—è¡Œ(MySQL 5.6 çš„é»˜è®¤å€¼ä¸º2ï¼‰</p><hr><h3 id="5-2-æ—¥å¿—å‚æ•°è®¾ç½®">5.2 æ—¥å¿—å‚æ•°è®¾ç½®</h3><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><p>ä¿®æ”¹MySQLçš„<code>my.cnf</code>æˆ–<code>my.ini</code>æ–‡ä»¶å¯ä»¥è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„ç›¸å…³å‚æ•°ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">atguigu-bin</span></span><br><span class="line"><span class="attr">binlog_expire_logs_seconds</span>=<span class="string">600</span></span><br><span class="line"><span class="attr">max_binlog_size</span>=<span class="string">100M</span></span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼š</p><ol><li>log-bin=mysql-bin #æ‰“å¼€æ—¥å¿—(ä¸»æœºéœ€è¦æ‰“å¼€)ï¼Œè¿™ä¸ªmysql-binä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥åŠ ä¸Šè·¯å¾„ï¼Œ å¦‚ï¼š/home/www/mysql_bin_log/mysql-bin</li><li>binlog_expire_logs_secondsï¼šæ­¤å‚æ•°æ§åˆ¶äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æ—¶é•¿ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤2592000 30å¤© --14400 4å°æ—¶ï¼›86400 1å¤©ï¼›259200 3å¤©ï¼›</li><li>max_binlog_sizeï¼šæ§åˆ¶å•ä¸ªäºŒè¿›åˆ¶æ—¥å¿—å¤§å°ï¼Œå½“å‰æ—¥å¿—æ–‡ä»¶å¤§å°è¶…è¿‡æ­¤å˜é‡æ—¶ï¼Œæ‰§è¡Œåˆ‡æ¢åŠ¨ä½œã€‚æ­¤å‚æ•°çš„<code>æœ€å¤§å’Œé»˜è®¤å€¼æ˜¯1GB</code>ï¼Œè¯¥è®¾ç½®å¹¶<code>ä¸èƒ½ä¸¥æ ¼æ§åˆ¶Binlogçš„å¤§å°</code>ï¼Œå°¤å…¶æ˜¯Binlogæ¯”æ¯”è¾ƒé è¿‘æœ€å¤§å€¼è€Œåˆé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§äº‹åŠ¡æ—¶ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§ï¼Œå¯èƒ½ä¸åšåˆ‡æ¢æ—¥å¿—çš„åŠ¨ä½œï¼Œåªèƒ½å°†è¯¥äº‹åŠ¡çš„æ‰€æœ‰SQLéƒ½è®°å½•è¿›å½“å‰æ—¥å¿—ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸã€‚ä¸€èˆ¬æƒ…å†µä¸‹å¯é‡‡å–é»˜è®¤å€¼ã€‚</li></ol></blockquote><p>é‡æ–°å¯åŠ¨MySQLæœåŠ¡ï¼ŒæŸ¥è¯¢äºŒè¿›åˆ¶æ—¥å¿—çš„ä¿¡æ¯ï¼Œæ‰§è¡Œç»“æœï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>                            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_bin                         <span class="operator">|</span> <span class="keyword">ON</span>                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_basename                <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu<span class="operator">-</span>bin       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_index                   <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>atguigu<span class="operator">-</span>bin.index <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_trust_function_creators <span class="operator">|</span> OFF                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_use_v1_row_events       <span class="operator">|</span> OFF                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sql_log_bin                     <span class="operator">|</span> <span class="keyword">ON</span>                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+----------------------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><strong>è®¾ç½®å¸¦æ–‡ä»¶å¤¹çš„bin-logæ—¥å¿—å­˜æ”¾ç›®å½•</strong></p><p>å¦‚æœæƒ³æ”¹å˜æ—¥å¿—æ–‡ä»¶çš„ç›®å½•å’Œåç§°ï¼Œå¯ä»¥å¯¹my.cnfæˆ–my.iniä¸­çš„log_binå‚æ•°ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">&quot;/var/lib/mysql/binlog/atguigu-bin&quot;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæ–°å»ºçš„æ–‡ä»¶å¤¹éœ€è¦ä½¿ç”¨mysqlç”¨æˆ·ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown <span class="operator">-</span>R <span class="operator">-</span>v mysql:mysql binlog</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715164107352.png" alt="image-20220715164107352" /><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><p>å¦‚æœä¸å¸Œæœ›é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯çš„æ–¹å¼è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„è¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ åœ¨mysql8ä¸­åªæœ‰<code>ä¼šè¯çº§åˆ«</code>çš„è®¾ç½®ï¼Œæ²¡æœ‰äº†globalçº§åˆ«çš„è®¾ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">global</span> çº§åˆ«</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> sql_log_bin<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">ERROR <span class="number">1228</span> (HY000): Variable <span class="string">&#x27;sql_log_bin&#x27;</span> <span class="keyword">is</span> a SESSION variable <span class="keyword">and</span> can`t be used</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">SET</span> <span class="keyword">GLOBAL</span></span><br><span class="line"></span><br><span class="line"># sessionçº§åˆ«</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SET</span> sql_log_bin<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> ç§’)</span><br></pre></td></tr></table></figure><h3 id="5-3-æŸ¥çœ‹æ—¥å¿—">5.3 æŸ¥çœ‹æ—¥å¿—</h3><p>å½“MySQLåˆ›å»ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªä»¥â€œfilenameâ€ä¸ºåç§°ã€ä»¥â€œ.indexâ€ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œå†åˆ›å»ºä¸€ ä¸ªä»¥â€œfilenameâ€ä¸ºåç§°ã€ä»¥â€œ.000001â€ä¸ºåç¼€çš„æ–‡ä»¶ã€‚</p><p>MySQLæœåŠ¡<code>é‡æ–°å¯åŠ¨ä¸€æ¬¡</code>ï¼Œä»¥â€œ.000001â€ä¸ºåç¼€çš„æ–‡ä»¶å°±ä¼šå¢åŠ ä¸€ä¸ªï¼Œå¹¶ä¸”åç¼€åæŒ‰1é€’å¢ã€‚å³æ—¥å¿—æ–‡ä»¶çš„ ä¸ªæ•°ä¸MySQLæœåŠ¡å¯åŠ¨çš„æ¬¡æ•°ç›¸åŒï¼›å¦‚æœæ—¥å¿—é•¿åº¦è¶…è¿‡äº†<code>max_binlog_size</code>çš„ä¸Šé™ï¼ˆé»˜è®¤æ˜¯1GBï¼‰ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚</p><p>æŸ¥çœ‹å½“å‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åˆ—è¡¨åŠå¤§å°ã€‚æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="type">BINARY</span> LOGS;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Log_name           <span class="operator">|</span> File_size <span class="operator">|</span> Encrypted <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----------+-----------+</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">156</span>       <span class="operator">|</span> <span class="keyword">No</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----------+-----------+</span></span><br><span class="line"><span class="number">1</span> è¡Œäºæ•°æ®é›† (<span class="number">0.02</span> ç§’)</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å¯¹æ•°æ®åº“çš„ä¿®æ”¹éƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚ä½†binlogæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹ï¼Œæƒ³è¦æ›´ç›´è§‚çš„è§‚æµ‹å®ƒå°±è¦å€ŸåŠ©<code>mysqlbinlog</code>å‘½ä»¤å·¥å…·äº†ã€‚æŒ‡ä»¤å¦‚ä¸‹ï¼šåœ¨æŸ¥çœ‹æ‰§è¡Œï¼Œå…ˆæ‰§è¡Œä¸€æ¡SQLè¯­å¥ï¼Œå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> student <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰_back&#x27;</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>å¼€å§‹æŸ¥çœ‹binlog</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715164718970.png" alt="image-20220715164718970"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715164743351.png" alt="image-20220715164743351" /><p>æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ—¥å¿—ä¸­è®°å½•äº†ç”¨æˆ·çš„ä¸€äº›æ“ä½œï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å‡ºç°å…·ä½“çš„SQLè¯­å¥ï¼Œè¿™æ˜¯å› ä¸ºbinlogå…³é”®å­—åé¢çš„å†…å®¹æ˜¯ç»è¿‡ç¼–ç åçš„<code>äºŒè¿›åˆ¶æ—¥å¿—</code>ã€‚</p><p>è¿™é‡Œä¸€ä¸ªupdateè¯­å¥åŒ…å«å¦‚ä¸‹äº‹ä»¶</p><ul><li><p>Query äº‹ä»¶è´Ÿè´£å¼€å§‹ä¸€ä¸ªäº‹åŠ¡(BEGIN)</p></li><li><p>Table_mapäº‹ä»¶è´Ÿè´£æ˜ å°„éœ€è¦çš„è¡¨</p></li><li><p>Update_rowsäº‹ä»¶è´Ÿè´£å†™å…¥æ•°æ®</p></li><li><p>Xidäº‹ä»¶è´Ÿè´£ç»“æŸäº‹åŠ¡</p></li></ul><p>ä¸‹é¢å‘½ä»¤å°†è¡Œäº‹ä»¶ä»¥<code>ä¼ªSQLçš„å½¢å¼</code>è¡¨ç°å‡ºæ¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog <span class="operator">-</span>v &quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;</span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">324</span> CRC32 <span class="number">0x6b31978b</span> Query thread_id<span class="operator">=</span><span class="number">10</span></span><br><span class="line">exec_time<span class="operator">=</span><span class="number">0</span> error_code<span class="operator">=</span><span class="number">0</span></span><br><span class="line"><span class="keyword">SET</span> <span class="type">TIMESTAMP</span><span class="operator">=</span><span class="number">1641345397</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.pseudo_thread_id<span class="operator">=</span><span class="number">10</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.foreign_key_checks<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.sql_auto_is_null<span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">@<span class="variable">@session</span>.unique_checks<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.autocommit<span class="operator">=</span><span class="number">1</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.sql_mode<span class="operator">=</span><span class="number">1168113696</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.auto_increment_increment<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.auto_increment_offset<span class="operator">=</span><span class="number">1</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="comment">/*!\C utf8mb3 */</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">@<span class="variable">@session</span>.character_set_client<span class="operator">=</span><span class="number">33</span>,@<span class="variable">@session</span>.collation_connection<span class="operator">=</span><span class="number">33</span>,@<span class="variable">@session</span>.collatio</span><br><span class="line">n_server<span class="operator">=</span><span class="number">255</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.lc_time_names<span class="operator">=</span><span class="number">0</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.collation_database<span class="operator">=</span><span class="keyword">DEFAULT</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="comment">/*!80011 SET @@session.default_collation_for_utf8mb4=255*/</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">/*!*/</span>;</span><br><span class="line"># <span class="keyword">at</span> <span class="number">324</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">391</span> CRC32 <span class="number">0x74f89890</span> Table_map:</span><br><span class="line">`atguigu14`.`student`mapped <span class="keyword">to</span> number <span class="number">85</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">391</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">470</span> CRC32 <span class="number">0xc9920491</span> Update_rows: <span class="keyword">table</span> id</span><br><span class="line"><span class="number">85</span> flags: STMT_END_F</span><br><span class="line"></span><br><span class="line">BINLOG <span class="string">&#x27;</span></span><br><span class="line"><span class="string">dfHUYRMBAAAAQwAAAIcBAAAAAFUAAAAAAAEACWF0Z3VpZ3UxNAAHc3R1ZGVudAADAw8PBDwAHgAG</span></span><br><span class="line"><span class="string">AQEAAgEhkJj4dA==</span></span><br><span class="line"><span class="string">dfHUYR8BAAAATwAAANYBAAAAAFUAAAAAAAEAAgAD//8AAQAAAAblvKDkuIkG5LiA54+tAAEAAAAL</span></span><br><span class="line"><span class="string">5byg5LiJX2JhY2sG5LiA54+tkQSSyQ==</span></span><br><span class="line"><span class="string">&#x27;</span><span class="comment">/*!*/</span>;</span><br><span class="line">### <span class="keyword">UPDATE</span>`atguigu`.`student`</span><br><span class="line">### <span class="keyword">WHERE</span></span><br><span class="line">### <span class="variable">@1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">### <span class="variable">@2</span><span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line">### <span class="variable">@3</span><span class="operator">=</span><span class="string">&#x27;ä¸€ç­&#x27;</span></span><br><span class="line">### <span class="keyword">SET</span></span><br><span class="line">### <span class="variable">@1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">### <span class="variable">@2</span><span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰_back&#x27;</span></span><br><span class="line">### <span class="variable">@3</span><span class="operator">=</span><span class="string">&#x27;ä¸€ç­&#x27;</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">470</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">501</span> CRC32 <span class="number">0xca01d30f</span> Xid <span class="operator">=</span> <span class="number">15</span></span><br><span class="line"><span class="keyword">COMMIT</span><span class="comment">/*!*/</span>;</span><br></pre></td></tr></table></figure><p>å‰é¢çš„å‘½ä»¤åŒæ—¶æ˜¾ç¤ºbinlogæ ¼å¼çš„è¯­å¥ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸æ˜¾ç¤ºå®ƒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog <span class="operator">-</span>v <span class="comment">--base64-output=DECODE-ROWS &quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">324</span> CRC32 <span class="number">0x6b31978b</span> Query thread_id<span class="operator">=</span><span class="number">10</span></span><br><span class="line">exec_time<span class="operator">=</span><span class="number">0</span> error_code<span class="operator">=</span><span class="number">0</span></span><br><span class="line"><span class="keyword">SET</span> <span class="type">TIMESTAMP</span><span class="operator">=</span><span class="number">1641345397</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.pseudo_thread_id<span class="operator">=</span><span class="number">10</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.foreign_key_checks<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.sql_auto_is_null<span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">@<span class="variable">@session</span>.unique_checks<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.autocommit<span class="operator">=</span><span class="number">1</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.sql_mode<span class="operator">=</span><span class="number">1168113696</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.auto_increment_increment<span class="operator">=</span><span class="number">1</span>, @<span class="variable">@session</span>.auto_increment_offset<span class="operator">=</span><span class="number">1</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="comment">/*!\C utf8mb3 */</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">@<span class="variable">@session</span>.character_set_client<span class="operator">=</span><span class="number">33</span>,@<span class="variable">@session</span>.collation_connection<span class="operator">=</span><span class="number">33</span>,@<span class="variable">@session</span>.collatio</span><br><span class="line">n_server<span class="operator">=</span><span class="number">255</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.lc_time_names<span class="operator">=</span><span class="number">0</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.collation_database<span class="operator">=</span><span class="keyword">DEFAULT</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="comment">/*!80011 SET @@session.default_collation_for_utf8mb4=255*/</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">/*!*/</span>;</span><br><span class="line"># <span class="keyword">at</span> <span class="number">324</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">391</span> CRC32 <span class="number">0x74f89890</span> Table_map:</span><br><span class="line">`atguigu14`.`student`mapped <span class="keyword">to</span> number <span class="number">85</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">391</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">470</span> CRC32 <span class="number">0xc9920491</span> Update_rows: <span class="keyword">table</span> id</span><br><span class="line"><span class="number">85</span> flags: STMT_END_F</span><br><span class="line">### <span class="keyword">UPDATE</span>`atguigu14`.`student`</span><br><span class="line">### <span class="keyword">WHERE</span></span><br><span class="line">### <span class="variable">@1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">### <span class="variable">@2</span><span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line">### <span class="variable">@3</span><span class="operator">=</span><span class="string">&#x27;ä¸€ç­&#x27;</span></span><br><span class="line">### <span class="keyword">SET</span></span><br><span class="line">### <span class="variable">@1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">### <span class="variable">@2</span><span class="operator">=</span><span class="string">&#x27;å¼ ä¸‰_back&#x27;</span></span><br><span class="line">### <span class="variable">@3</span><span class="operator">=</span><span class="string">&#x27;ä¸€ç­&#x27;</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">470</span></span><br><span class="line">#<span class="number">220105</span> <span class="number">9</span>:<span class="number">16</span>:<span class="number">37</span> server id <span class="number">1</span> end_log_pos <span class="number">501</span> CRC32 <span class="number">0xca01d30f</span> Xid <span class="operator">=</span> <span class="number">15</span></span><br></pre></td></tr></table></figure><p>å…³äºmysqlbinlogå·¥å…·çš„ä½¿ç”¨æŠ€å·§è¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚åªè§£æå¯¹æŸä¸ªåº“çš„æ“ä½œæˆ–è€…æŸä¸ªæ—¶é—´æ®µå†…çš„æ“ä½œç­‰ã€‚ç®€å•åˆ†äº«å‡ ä¸ªå¸¸ç”¨çš„è¯­å¥ï¼Œæ›´å¤šæ“ä½œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å¯æŸ¥çœ‹å‚æ•°å¸®åŠ©</span><br><span class="line">mysqlbinlog <span class="comment">--no-defaults --help</span></span><br><span class="line"># æŸ¥çœ‹æœ€å<span class="number">100</span>è¡Œ</span><br><span class="line">mysqlbinlog <span class="comment">--no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |tail</span></span><br><span class="line"><span class="number">-100</span></span><br><span class="line"># æ ¹æ®positionæŸ¥æ‰¾</span><br><span class="line">mysqlbinlog <span class="comment">--no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |grep -A</span></span><br><span class="line"><span class="number">20</span> <span class="string">&#x27;4939002&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ç§åŠæ³•è¯»å–å‡ºbinlogæ—¥å¿—çš„å…¨æ–‡å†…å®¹æ¯”è¾ƒå¤šï¼Œä¸å®¹æ˜“åˆ†è¾¨æŸ¥çœ‹åˆ°posç‚¹ä¿¡æ¯ï¼Œä¸‹é¢ä»‹ç»ä¸€ç§æ›´ä¸ºæ–¹ä¾¿çš„æŸ¥è¯¢å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events [<span class="keyword">IN</span> <span class="string">&#x27;log_name&#x27;</span>] [<span class="keyword">FROM</span> pos] [LIMIT [<span class="keyword">offset</span>,] row_count];</span><br></pre></td></tr></table></figure><p>*<code>IN 'log_name'</code>ï¼šæŒ‡å®šè¦æŸ¥è¯¢çš„binlogæ–‡ä»¶åï¼ˆä¸æŒ‡å®šå°±æ˜¯ç¬¬ä¸€ä¸ªbinlogæ–‡ä»¶ï¼‰ã€€<br>*<code>FROM pos</code>ï¼šæŒ‡å®šä»å“ªä¸ªposèµ·å§‹ç‚¹å¼€å§‹æŸ¥èµ·ï¼ˆä¸æŒ‡å®šå°±æ˜¯ä»æ•´ä¸ªæ–‡ä»¶é¦–ä¸ªposç‚¹å¼€å§‹ç®—ï¼‰<br>*<code>LIMIT [offset]</code>ï¼šåç§»é‡(ä¸æŒ‡å®šå°±æ˜¯0)<br>*<code>row_count</code>:æŸ¥è¯¢æ€»æ¡æ•°ï¼ˆä¸æŒ‡å®šå°±æ˜¯æ‰€æœ‰è¡Œï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;atguigu-bin.000002&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Log_name           <span class="operator">|</span> Pos <span class="operator">|</span> Event_type     <span class="operator">|</span> Server_id <span class="operator">|</span> End_log_pos <span class="operator">|</span> Info                                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">4</span>   <span class="operator">|</span> Format_desc    <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">125</span>         <span class="operator">|</span> Server ver: <span class="number">8.0</span><span class="number">.26</span>, Binlog ver: <span class="number">4</span>                      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">125</span> <span class="operator">|</span> Previous_gtids <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">156</span>         <span class="operator">|</span>                                                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">156</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">235</span>         <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">235</span> <span class="operator">|</span> Query          <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">324</span>         <span class="operator">|</span> <span class="keyword">BEGIN</span>                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">324</span> <span class="operator">|</span> Table_map      <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">391</span>         <span class="operator">|</span> table_id: <span class="number">85</span>(atguigu14.student)                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">391</span> <span class="operator">|</span> Update_rows    <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">470</span>         <span class="operator">|</span> table_id: <span class="number">85</span>flags: STMT_END_F                          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">470</span> <span class="operator">|</span> Xid            <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">501</span>         <span class="operator">|</span> <span class="keyword">COMMIT</span> <span class="comment">/*xid=15 */</span>                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">501</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">578</span>         <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">578</span> <span class="operator">|</span> Query     <span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> <span class="number">721</span> <span class="operator">|</span> use`atguigu14`; <span class="keyword">create</span> <span class="keyword">table</span> test(id <span class="type">int</span>, title <span class="type">varchar</span>(<span class="number">100</span>)) <span class="comment">/* xid=19 */</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">721</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">800</span>         <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">800</span> <span class="operator">|</span> Query          <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">880</span>         <span class="operator">|</span> <span class="keyword">BEGIN</span>                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">880</span> <span class="operator">|</span> Table_map      <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">943</span>         <span class="operator">|</span> table_id: <span class="number">89</span>(atguigu14.test)                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">943</span> <span class="operator">|</span> Write_rows     <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">992</span>         <span class="operator">|</span> table_id: <span class="number">89</span> flags: STMT_END_F                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> atguigu<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">992</span> <span class="operator">|</span> Xid            <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span> <span class="number">1023</span>        <span class="operator">|</span> <span class="keyword">COMMIT</span> <span class="comment">/*xid=21 */</span>                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+</span></span><br><span class="line"><span class="number">14</span> è¡Œäºæ•°æ®é›† (<span class="number">0.02</span> ç§’)</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715165603879.png" alt="image-20220715165603879"  /><p>ä¸Šé¢æˆ‘ä»¬è®²äº†è¿™ä¹ˆå¤šéƒ½æ˜¯åŸºäºbinlogçš„é»˜è®¤æ ¼å¼ï¼Œbinlogæ ¼å¼æŸ¥çœ‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> binlog_format <span class="operator">|</span> <span class="type">ROW</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> è¡Œäºæ•°æ®é›† (<span class="number">0.02</span> ç§’)</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œbinlogè¿˜æœ‰2ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯<code>Statement</code>å’Œ<code>Mixed</code></p><ul><li><p>Statement</p><p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚</p><p>ä¼˜ç‚¹ï¼šä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†IOï¼Œæé«˜æ€§èƒ½ã€‚</p></li><li><p>Row</p><p>5.1.5ç‰ˆæœ¬çš„MySQLæ‰å¼€å§‹æ”¯æŒrow level çš„å¤åˆ¶ï¼Œå®ƒä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œä»…ä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹ã€‚</p><p>ä¼˜ç‚¹ï¼šrow level çš„æ—¥å¿—å†…å®¹ä¼šéå¸¸æ¸…æ¥šçš„è®°å½•ä¸‹æ¯ä¸€è¡Œæ•°æ®ä¿®æ”¹çš„ç»†èŠ‚ã€‚è€Œä¸”ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹ çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæˆ–functionï¼Œä»¥åŠtriggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚</p></li><li><p>Mixed</p><p>ä»5.1.8ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLæä¾›äº†Mixedæ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯Statementä¸Rowçš„ç»“åˆã€‚</p><p>è¯¦ç»†æƒ…å†µï¼Œä¸‹ç« è®²è§£ã€‚</p></li></ul><h3 id="5-4-ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®">5.4 ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®</h3><p>å¦‚æœMySQLæœåŠ¡å™¨å¯ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåœ¨æ•°æ®åº“å‡ºç°æ„å¤–ä¸¢å¤±æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨MySQLbinlogå·¥å…·ä»æŒ‡å®šçš„æ—¶é—´ç‚¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœ€åä¸€æ¬¡å¤‡ä»½ï¼‰ç›´åˆ°ç°åœ¨æˆ–å¦ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´ç‚¹çš„æ—¥å¿—ä¸­å›å¤æ•°æ®ã€‚</p><p>mysqlbinlogæ¢å¤æ•°æ®çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [option] filename<span class="operator">|</span>mysql â€“uuser <span class="operator">-</span>ppass;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥è¿™æ ·ç†è§£ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤æ¥è¯»å–filenameä¸­çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨mysqlå‘½ä»¤å°†è¿™äº›å†…å®¹æ¢å¤åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>*<code>filename</code>ï¼šæ˜¯æ—¥å¿—æ–‡ä»¶åã€‚</p><p>*<code>option</code>ï¼šå¯é€‰é¡¹ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸¤å¯¹optionå‚æ•°æ˜¯â€“start-dateã€â€“stop-date å’Œ --start-positionã€-- stop-positionã€‚<br>*<code>--start-date</code>å’Œ<code>--stop-date</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®åº“çš„èµ·å§‹æ—¶é—´ç‚¹å’Œç»“æŸæ—¶é—´ç‚¹ã€‚<br>*<code>--start-position</code>å’Œ<code>--stop-position</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</p><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤è¿›è¡Œæ¢å¤æ“ä½œæ—¶ï¼Œå¿…é¡»æ˜¯ç¼–å·å°çš„å…ˆæ¢å¤ï¼Œä¾‹å¦‚atguigu-bin.000001å¿…é¡»åœ¨atguigu-bin.000002ä¹‹å‰æ¢å¤ã€‚</p></blockquote><p>è¯¦è§p189ï¼Œç”±äºç¿»é¡µè¿‡å¿«ï¼Œè¿™éƒ¨åˆ†æ²¡åŠæ³•è®°å½•ã€‚</p><h3 id="5-5-åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—">5.5 åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—</h3><p>MySQLçš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥é…ç½®è‡ªåŠ¨åˆ é™¤ï¼ŒåŒæ—¶MySQLä¹Ÿæä¾›äº†å®‰å…¨çš„æ‰‹åŠ¨åˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚<code>PURGE MASTER LOGS</code>åªåˆ é™¤æŒ‡å®šéƒ¨åˆ†çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œ<code>RESET MASTER</code>åˆ é™¤æ‰€æœ‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ ä»¶ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p><strong>1. PURGE MASTER LOGSï¼šåˆ é™¤æŒ‡å®šæ—¥å¿—æ–‡ä»¶</strong></p><p>PURGE MASTER LOGSè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PURGE &#123;MASTER <span class="operator">|</span> <span class="type">BINARY</span>&#125; LOGS <span class="keyword">TO</span> â€˜æŒ‡å®šæ—¥å¿—æ–‡ä»¶åâ€™</span><br><span class="line">PURGE &#123;MASTER <span class="operator">|</span> <span class="type">BINARY</span>&#125; LOGS BEFORE â€˜æŒ‡å®šæ—¥æœŸâ€™</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715165603879.png" alt="image-20220715165603879"  /><p>ä¸Šé¢æˆ‘ä»¬è®²äº†è¿™ä¹ˆå¤šéƒ½æ˜¯åŸºäºbinlogçš„é»˜è®¤æ ¼å¼ï¼Œbinlogæ ¼å¼æŸ¥çœ‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> binlog_format <span class="operator">|</span> <span class="type">ROW</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> è¡Œäºæ•°æ®é›† (<span class="number">0.02</span> ç§’)</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œbinlogè¿˜æœ‰2ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯<code>Statement</code>å’Œ<code>Mixed</code></p><ul><li><p>Statement</p><p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚</p><p>ä¼˜ç‚¹ï¼šä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†IOï¼Œæé«˜æ€§èƒ½ã€‚</p></li><li><p>Row</p><p>5.1.5ç‰ˆæœ¬çš„MySQLæ‰å¼€å§‹æ”¯æŒrow level çš„å¤åˆ¶ï¼Œå®ƒä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œä»…ä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹ã€‚</p><p>ä¼˜ç‚¹ï¼šrow level çš„æ—¥å¿—å†…å®¹ä¼šéå¸¸æ¸…æ¥šçš„è®°å½•ä¸‹æ¯ä¸€è¡Œæ•°æ®ä¿®æ”¹çš„ç»†èŠ‚ã€‚è€Œä¸”ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹ çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæˆ–functionï¼Œä»¥åŠtriggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚</p></li><li><p>Mixed</p><p>ä»5.1.8ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLæä¾›äº†Mixedæ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯Statementä¸Rowçš„ç»“åˆã€‚</p><p>è¯¦ç»†æƒ…å†µï¼Œä¸‹ç« è®²è§£ã€‚</p></li></ul><h3 id="5-4-ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®-2">5.4 ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®</h3><p>å¦‚æœMySQLæœåŠ¡å™¨å¯ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåœ¨æ•°æ®åº“å‡ºç°æ„å¤–ä¸¢å¤±æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨MySQLbinlogå·¥å…·ä»æŒ‡å®šçš„æ—¶é—´ç‚¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœ€åä¸€æ¬¡å¤‡ä»½ï¼‰ç›´åˆ°ç°åœ¨æˆ–å¦ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´ç‚¹çš„æ—¥å¿—ä¸­å›å¤æ•°æ®ã€‚</p><p>mysqlbinlogæ¢å¤æ•°æ®çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [option] filename<span class="operator">|</span>mysql â€“uuser <span class="operator">-</span>ppass;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥è¿™æ ·ç†è§£ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤æ¥è¯»å–filenameä¸­çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨mysqlå‘½ä»¤å°†è¿™äº›å†…å®¹æ¢å¤åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>*<code>filename</code>ï¼šæ˜¯æ—¥å¿—æ–‡ä»¶åã€‚</p><p>*<code>option</code>ï¼šå¯é€‰é¡¹ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸¤å¯¹optionå‚æ•°æ˜¯â€“start-dateã€â€“stop-date å’Œ --start-positionã€-- stop-positionã€‚<br>*<code>--start-date</code>å’Œ<code>--stop-date</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®åº“çš„èµ·å§‹æ—¶é—´ç‚¹å’Œç»“æŸæ—¶é—´ç‚¹ã€‚<br>*<code>--start-position</code>å’Œ<code>--stop-position</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</p><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤è¿›è¡Œæ¢å¤æ“ä½œæ—¶ï¼Œå¿…é¡»æ˜¯ç¼–å·å°çš„å…ˆæ¢å¤ï¼Œä¾‹å¦‚atguigu-bin.000001å¿…é¡»åœ¨atguigu-bin.000002ä¹‹å‰æ¢å¤ã€‚</p></blockquote><h3 id="5-5-åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—-2">5.5 åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—</h3><p>MySQLçš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥é…ç½®è‡ªåŠ¨åˆ é™¤ï¼ŒåŒæ—¶MySQLä¹Ÿæä¾›äº†å®‰å…¨çš„æ‰‹åŠ¨åˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚<code>PURGE MASTER LOGS</code>åªåˆ é™¤æŒ‡å®šéƒ¨åˆ†çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œ<code>RESET MASTER</code>åˆ é™¤æ‰€æœ‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ ä»¶ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p><strong>1. PURGE MASTER LOGSï¼šåˆ é™¤æŒ‡å®šæ—¥å¿—æ–‡ä»¶</strong></p><p>PURGE MASTER LOGSè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PURGE &#123;MASTER <span class="operator">|</span> <span class="type">BINARY</span>&#125; LOGS <span class="keyword">TO</span> â€˜æŒ‡å®šæ—¥å¿—æ–‡ä»¶åâ€™</span><br><span class="line">PURGE &#123;MASTER <span class="operator">|</span> <span class="type">BINARY</span>&#125; LOGS BEFORE â€˜æŒ‡å®šæ—¥æœŸâ€™</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715171712026.png" alt="image-20220715171712026"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715172015185.png" alt="image-20220715172015185"  /><p><strong>2. RESET MASTER: åˆ é™¤æ‰€æœ‰äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715172104967.png" alt="image-20220715172104967"  /><h3 id="5-6-å…¶å®ƒåœºæ™¯">5.6 å…¶å®ƒåœºæ™¯</h3><p>äºŒè¿›åˆ¶æ—¥å¿—å¯ä»¥é€šè¿‡æ•°æ®åº“çš„<code>å…¨é‡å¤‡ä»½</code>å’ŒäºŒè¿›åˆ¶æ—¥å¿—ä¸­ä¿å­˜çš„<code>å¢é‡ä¿¡æ¯</code>ï¼Œå®Œæˆæ•°æ®åº“çš„<code>æ— æŸå¤±æ¢å¤</code>ã€‚ ä½†æ˜¯ï¼Œå¦‚æœé‡åˆ°æ•°æ®é‡å¤§ã€æ•°æ®åº“å’Œæ•°æ®è¡¨å¾ˆå¤šï¼ˆæ¯”å¦‚åˆ†åº“åˆ†è¡¨çš„åº”ç”¨ï¼‰çš„åœºæ™¯ï¼Œç”¨äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡Œæ•°æ®æ¢å¤ï¼Œæ˜¯å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„ï¼Œå› ä¸ºèµ·æ­¢ä½ç½®ä¸å®¹æ˜“ç®¡ç†ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„è§£å†³åŠæ³•æ˜¯<code>é…ç½®ä¸»ä»æ•°æ®åº“æœåŠ¡å™¨</code>ï¼Œç”šè‡³æ˜¯<code>ä¸€ä¸»å¤šä»</code>çš„æ¶æ„ï¼ŒæŠŠäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„å†…å®¹é€šè¿‡ä¸­ç»§æ—¥å¿—ï¼ŒåŒæ­¥åˆ°ä»æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆé¿å…æ•°æ®åº“æ•…éšœå¯¼è‡´çš„æ•°æ®å¼‚å¸¸ç­‰é—®é¢˜ã€‚</p><hr><h2 id="6-å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—-binlog">6. å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—(binlog)</h2><h3 id="6-1-å†™å…¥æœºåˆ¶">6.1 å†™å…¥æœºåˆ¶</h3><p>binlogçš„å†™å…¥æ—¶æœºä¹Ÿéå¸¸ç®€å•ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°<code>binlog cache</code>ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠbinlog cacheå†™åˆ°binlogæ–‡ä»¶ä¸­ã€‚å› ä¸ºä¸€ä¸ªäº‹åŠ¡çš„binlogä¸èƒ½è¢«æ‹†å¼€ï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå—å†…å­˜ä½œä¸ºbinlog cacheã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>binlog_cache_size</code>å‚æ•°æ§åˆ¶å•ä¸ªçº¿ç¨‹ binlog cache å¤§å°ï¼Œå¦‚æœå­˜å‚¨å†…å®¹è¶…è¿‡äº†è¿™ä¸ªå‚æ•°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ï¼ˆSwapï¼‰ã€‚binlogæ—¥å¿—åˆ·ç›˜æµç¨‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715172958729.png" alt="image-20220715172958729" style="zoom: 50%;" /><blockquote><ul><li>ä¸Šå›¾çš„writeï¼Œæ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«</li><li>ä¸Šå›¾çš„fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œ</li></ul></blockquote><p>writeå’Œfsyncçš„æ—¶æœºï¼Œå¯ä»¥ç”±å‚æ•°<code>sync_binlog</code>æ§åˆ¶ï¼Œé»˜è®¤æ˜¯<code>0</code>ã€‚ä¸º0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª writeï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œfsyncã€‚è™½ç„¶æ€§èƒ½å¾—åˆ°æå‡ï¼Œä½†æ˜¯æœºå™¨å®•æœºï¼Œpage cacheé‡Œé¢çš„ binglog ä¼šä¸¢å¤±ã€‚å¦‚ä¸‹å›¾ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715193749462.png" alt="image-20220715193749462" style="zoom:50%;" /><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥è®¾ç½®ä¸º<code>1</code>ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œfsyncï¼Œå°±å¦‚åŒ<strong>redo log åˆ·ç›˜æµç¨‹</strong>ä¸€æ ·ã€‚ æœ€åè¿˜æœ‰ä¸€ç§æŠ˜ä¸­æ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ä¸ºN(N&gt;1)ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½writeï¼Œä½†ç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsyncã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715194624080.png" alt="image-20220715194624080" style="zoom:50%;" /><p>åœ¨å‡ºç°IOç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†sync_binlogè®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åŒæ ·çš„ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘Nä¸ªäº‹åŠ¡çš„binlogæ—¥å¿—ã€‚</p><h3 id="6-2-binlogä¸redologå¯¹æ¯”">6.2 binlogä¸redologå¯¹æ¯”</h3><ul><li>redo log å®ƒæ˜¯<code>ç‰©ç†æ—¥å¿—</code>ï¼Œè®°å½•å†…å®¹æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äº InnoDB å­˜å‚¨å¼•æ“å±‚äº§ç”Ÿçš„ã€‚</li><li>è€Œ binlog æ˜¯<code>é€»è¾‘æ—¥å¿—</code>ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œç±»ä¼¼äºâ€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1â€ï¼Œå±äº MySQL Server å±‚ã€‚</li><li>è™½ç„¶å®ƒä»¬éƒ½å±äºæŒä¹…åŒ–çš„ä¿è¯ï¼Œä½†æ˜¯ä¾§é‡ç‚¹ä¸åŒã€‚<ul><li>redo logè®©InnoDBå­˜å‚¨å¼•æ“æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</li><li>binlogä¿è¯äº†MySQLé›†ç¾¤æ¶æ„çš„æ•°æ®ä¸€è‡´æ€§ã€‚</li></ul></li></ul><h3 id="6-3-ä¸¤é˜¶æ®µæäº¤">6.3 ä¸¤é˜¶æ®µæäº¤</h3><p>åœ¨æ‰§è¡Œæ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½•redo logä¸binlogä¸¤å—æ—¥å¿—ï¼Œä»¥åŸºæœ¬çš„äº‹åŠ¡ä¸ºå•ä½ï¼Œredo logåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å†™å…¥ï¼Œè€Œbinlogåªæœ‰åœ¨æäº¤äº‹åŠ¡æ—¶æ‰å†™å…¥ï¼Œæ‰€ä»¥redo logä¸binlogçš„<code>å†™å…¥æ—¶æœº</code>ä¸ä¸€æ ·ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715194959405.png" alt="image-20220715194959405" style="zoom:67%;" /><p><strong>redo logä¸binlogä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€è‡´ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><p>ä»¥updateè¯­å¥ä¸ºä¾‹ï¼Œå‡è®¾<code>id=2</code>çš„è®°å½•ï¼Œå­—æ®µ<code>c</code>å€¼æ˜¯<code>0</code>ï¼ŒæŠŠå­—æ®µcå€¼æ›´æ–°ä¸º<code>1</code>ï¼ŒSQLè¯­å¥ä¸ºupdate T set c = 1 where id = 2ã€‚</p><p>å‡è®¾æ‰§è¡Œè¿‡ç¨‹ä¸­å†™å®Œredo logæ—¥å¿—åï¼Œbinlogæ—¥å¿—å†™æœŸé—´å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715195016492.png" alt="image-20220715195016492" style="zoom:67%;" /><p>ç”±äºbinlogæ²¡å†™å®Œå°±å¼‚å¸¸ï¼Œè¿™æ—¶å€™binlogé‡Œé¢æ²¡æœ‰å¯¹åº”çš„ä¿®æ”¹è®°å½•ã€‚å› æ­¤ï¼Œä¹‹åç”¨binlogæ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±ä¼šå°‘è¿™ä¸€æ¬¡æ›´æ–°ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œcå€¼ä¸º0ï¼Œè€ŒåŸåº“å› ä¸ºredo logæ—¥å¿—æ¢å¤ï¼Œè¿™ä¸€è¡Œcçš„å€¼æ˜¯1ï¼Œæœ€ç»ˆæ•°æ®ä¸ä¸€è‡´ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715195521986.png" alt="image-20220715195521986" style="zoom:67%;" /><p>ä¸ºäº†è§£å†³ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´é—®é¢˜ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>æ–¹æ¡ˆã€‚åŸç†å¾ˆç®€å•ï¼Œå°†redo logçš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤prepareå’Œcommitï¼Œè¿™å°±æ˜¯<strong>ä¸¤é˜¶æ®µæäº¤</strong>ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715195635196.png" alt="image-20220715195635196" style="zoom:67%;" /><p>ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åï¼Œå†™å…¥binlogæ—¶å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸ºMySQLæ ¹æ®redo logæ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå‘ç°redo logè¿˜å¤„äºprepareé˜¶æ®µï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åº”binlogæ—¥å¿—ï¼Œå°±ä¼šå›æ»šè¯¥äº‹åŠ¡ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715200248193.png" alt="image-20220715200248193" style="zoom:67%;" /><p>å¦ä¸€ä¸ªåœºæ™¯ï¼Œredo logè®¾ç½®commité˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¼šä¸ä¼šå›æ»šäº‹åŠ¡å‘¢ï¼Ÿ</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715200321717.png" alt="image-20220715200321717" style="zoom:67%;" /><p>å¹¶ä¸ä¼šå›æ»šäº‹åŠ¡ï¼Œå®ƒä¼šæ‰§è¡Œä¸Šå›¾æ¡†ä½çš„é€»è¾‘ï¼Œè™½ç„¶redo logæ˜¯å¤„äºprepareé˜¶æ®µï¼Œä½†æ˜¯èƒ½é€šè¿‡äº‹åŠ¡idæ‰¾åˆ°å¯¹åº”çš„binlogæ—¥å¿—ï¼Œæ‰€ä»¥MySQLè®¤ä¸ºæ˜¯å®Œæ•´çš„ï¼Œå°±ä¼šæäº¤äº‹åŠ¡æ¢å¤æ•°æ®ã€‚</p><hr><h2 id="7-ä¸­ç»§æ—¥å¿—-relay-log">7. ä¸­ç»§æ—¥å¿—(relay log)</h2><h3 id="7-1-ä»‹ç»">7.1 ä»‹ç»</h3><p><strong>ä¸­ç»§æ—¥å¿—åªåœ¨ä¸»ä»æœåŠ¡å™¨æ¶æ„çš„ä»æœåŠ¡å™¨ä¸Šå­˜åœ¨</strong>ã€‚ä»æœåŠ¡å™¨ä¸ºäº†ä¸ä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼Œè¦ä»ä¸»æœåŠ¡å™¨è¯»å–äºŒè¿›åˆ¶æ—¥å¿—çš„å†…å®¹ï¼Œå¹¶ä¸”æŠŠè¯»å–åˆ°çš„ä¿¡æ¯å†™å…¥<code>æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶</code>ä¸­ï¼Œè¿™ä¸ªä»æœåŠ¡å™¨æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶å°±å«<code>ä¸­ç»§æ—¥å¿—</code>ã€‚ç„¶åï¼Œä»æœåŠ¡å™¨è¯»å–ä¸­ç»§æ—¥å¿—ï¼Œå¹¶æ ¹æ®ä¸­ç»§æ—¥å¿—çš„å†…å®¹å¯¹ä»æœåŠ¡å™¨çš„æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œå®Œæˆä¸» ä»æœåŠ¡å™¨çš„ æ•°æ®åŒæ­¥ ã€‚</p><p>æ­å»ºå¥½ä¸»ä»æœåŠ¡å™¨ä¹‹åï¼Œä¸­ç»§æ—¥å¿—é»˜è®¤ä¼šä¿å­˜åœ¨ä»æœåŠ¡å™¨çš„æ•°æ®ç›®å½•ä¸‹ã€‚</p><p>æ–‡ä»¶åçš„æ ¼å¼æ˜¯ï¼š<code>ä»æœåŠ¡å™¨å-relay-bin.åºå·</code>ã€‚ä¸­ç»§æ—¥å¿—è¿˜æœ‰ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼š<code>ä»æœåŠ¡å™¨å-relaybin.index</code>ï¼Œç”¨æ¥å®šä½å½“å‰æ­£åœ¨ä½¿ç”¨çš„ä¸­ç»§æ—¥å¿—ã€‚</p><h3 id="7-2-æŸ¥çœ‹ä¸­ç»§æ—¥å¿—">7.2 æŸ¥çœ‹ä¸­ç»§æ—¥å¿—</h3><p>ä¸­ç»§æ—¥å¿—ä¸äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ç›¸åŒï¼Œå¯ä»¥ç”¨<code>mysqlbinlog</code>å·¥å…·è¿›è¡ŒæŸ¥çœ‹ã€‚ä¸‹é¢æ˜¯ä¸­ç»§æ—¥å¿—çš„ä¸€ä¸ªç‰‡æ®µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="type">TIMESTAMP</span><span class="operator">=</span><span class="number">1618558728</span><span class="comment">/*!*/</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">/*!*/</span>;</span><br><span class="line"># <span class="keyword">at</span> <span class="number">950</span></span><br><span class="line">#<span class="number">210416</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">48</span> server id <span class="number">1</span> end_log_pos <span class="number">832</span> CRC32 <span class="number">0xcc16d651</span> Table_map:</span><br><span class="line">`atguigu`.`test`mapped <span class="keyword">to</span> number <span class="number">91</span></span><br><span class="line"># <span class="keyword">at</span> <span class="number">1000</span></span><br><span class="line">#<span class="number">210416</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">48</span> server id <span class="number">1</span> end_log_pos <span class="number">872</span> CRC32 <span class="number">0x07e4047c</span> Delete_rows: <span class="keyword">table</span> id</span><br><span class="line"><span class="number">91</span> flags: STMT_END_F <span class="comment">-- server id 1 æ˜¯ä¸»æœåŠ¡å™¨ï¼Œæ„æ€æ˜¯ä¸»æœåŠ¡å™¨åˆ äº†ä¸€è¡Œæ•°æ®</span></span><br><span class="line">BINLOG <span class="string">&#x27;</span></span><br><span class="line"><span class="string">CD95YBMBAAAAMgAAAEADAAAAAFsAAAAAAAEABGRlbW8ABHRlc3QAAQMAAQEBAFHWFsw=</span></span><br><span class="line"><span class="string">CD95YCABAAAAKAAAAGgDAAAAAFsAAAAAAAEAAgAB/wABAAAAfATkBw==</span></span><br><span class="line"><span class="string">&#x27;</span><span class="comment">/*!*/</span>;</span><br><span class="line"># <span class="keyword">at</span> <span class="number">1040</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µçš„æ„æ€æ˜¯ï¼Œä¸»æœåŠ¡å™¨ï¼ˆâ€œserver id 1â€ï¼‰å¯¹è¡¨ atguigu.test è¿›è¡Œäº† 2 æ­¥æ“ä½œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å®šä½åˆ°è¡¨ atguigu.test ç¼–å·æ˜¯ <span class="number">91</span> çš„è®°å½•ï¼Œæ—¥å¿—ä½ç½®æ˜¯ <span class="number">832</span>ï¼›</span><br><span class="line">åˆ é™¤ç¼–å·æ˜¯ <span class="number">91</span> çš„è®°å½•ï¼Œæ—¥å¿—ä½ç½®æ˜¯ <span class="number">872</span></span><br></pre></td></tr></table></figure><h3 id="7-3-æ¢å¤çš„å…¸å‹é”™è¯¯">7.3 æ¢å¤çš„å…¸å‹é”™è¯¯</h3><p>å¦‚æœä»æœåŠ¡å™¨å®•æœºï¼Œæœ‰çš„æ—¶å€™ä¸ºäº†ç³»ç»Ÿæ¢å¤ï¼Œè¦é‡è£…æ“ä½œç³»ç»Ÿï¼Œè¿™æ ·å°±å¯èƒ½ä¼šå¯¼è‡´ä½ çš„<code>æœåŠ¡å™¨åç§°</code>ä¸ä¹‹å‰<code>ä¸åŒ</code>ã€‚è€Œä¸­ç»§æ—¥å¿—é‡Œæ˜¯<code>åŒ…å«ä»æœåŠ¡å™¨å</code>çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯èƒ½å¯¼è‡´ä½ æ¢å¤ä»æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæ— æ³• ä»å®•æœºå‰çš„ä¸­ç»§æ—¥å¿—é‡Œè¯»å–æ•°æ®ï¼Œä»¥ä¸ºæ˜¯æ—¥å¿—æ–‡ä»¶æŸåäº†ï¼Œå…¶å®æ˜¯åç§°ä¸å¯¹äº†ã€‚</p><p>è§£å†³çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠä»æœåŠ¡å™¨çš„åç§°æ”¹å›ä¹‹å‰çš„åç§°ã€‚</p>]]></content>
    
    
    <summary type="html">æ…¢æŸ¥è¯¢æ—¥å¿—ã€bin logã€é”™è¯¯æ—¥å¿—ã€é€šç”¨æŸ¥è¯¢æ—¥å¿—</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQLå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</title>
    <link href="https://wuwawawa.github.io/posts/1f4b46b6.html"/>
    <id>https://wuwawawa.github.io/posts/1f4b46b6.html</id>
    <published>2023-04-18T06:43:04.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<p>MVCC ï¼ˆMultiversion Concurrency Controlï¼‰ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚é¡¾åæ€ä¹‰ï¼ŒMVCC æ˜¯é€šè¿‡æ•°æ®è¡Œçš„å¤šä¸ªç‰ˆæœ¬ç®¡ç†æ¥å®ç°æ•°æ®åº“çš„<code>å¹¶å‘æ§åˆ¶</code>ã€‚è¿™é¡¹æŠ€æœ¯ä½¿å¾—åœ¨InnoDBçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œ<code>ä¸€è‡´æ€§è¯»</code>æ“ä½œæœ‰äº†ä¿è¯ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯ä¸ºäº†æŸ¥è¯¢ä¸€äº›æ­£åœ¨è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„è¡Œï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°å®ƒä»¬è¢«æ›´æ–°ä¹‹å‰çš„å€¼ï¼Œè¿™æ · åœ¨åšæŸ¥è¯¢çš„æ—¶å€™å°±ä¸ç”¨ç­‰å¾…å¦ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾é”ã€‚</p><p>MVCCæ²¡æœ‰æ­£å¼çš„æ ‡å‡†ï¼Œåœ¨ä¸åŒçš„DBMSä¸­MVCCçš„å®ç°æ–¹å¼å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œä¹Ÿä¸æ˜¯æ™®éä½¿ç”¨çš„ï¼ˆå¤§å®¶å¯ä»¥å‚è€ƒç›¸å…³çš„DBMSæ–‡æ¡£ï¼‰ã€‚è¿™é‡Œè®²è§£InnoDBä¸­MVCCçš„å®ç°æœºåˆ¶ï¼ˆMySQLå…¶ä»–çš„å­˜å‚¨å¼•æ“å¹¶ä¸æ”¯æŒå®ƒï¼‰</p><hr><h2 id="1-å¿«ç…§è¯»ä¸å½“å‰è¯»">1. å¿«ç…§è¯»ä¸å½“å‰è¯»</h2><p>MVCCåœ¨MySQL InnoDBä¸­çš„å®ç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½ï¼Œç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†<code>è¯»-å†™å†²çª</code>ï¼Œåšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶ï¼Œä¹Ÿèƒ½åšåˆ°<code>ä¸åŠ é”</code>ï¼Œ<code>éé˜»å¡å¹¶å‘è¯»</code>ï¼Œè€Œè¿™ä¸ªè¯»æŒ‡çš„å°±æ˜¯<code>å¿«ç…§è¯»</code>, è€Œé<code>å½“å‰è¯»</code>ã€‚å½“å‰ è¯»å®é™…ä¸Šæ˜¯ä¸€ç§åŠ é”çš„æ“ä½œï¼Œæ˜¯æ‚²è§‚é”çš„å®ç°ã€‚è€ŒMVCCæœ¬è´¨æ˜¯é‡‡ç”¨ä¹è§‚é”æ€æƒ³çš„ä¸€ç§æ–¹å¼ã€‚</p><div class="tabs" id="3c12d972-9050-44fe-9000-e79d518eb69e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#3c12d972-9050-44fe-9000-e79d518eb69e-1"><i class="fas fa-cat"></i>å¿«ç…§è¯»</button></li><li class="tab"><button type="button" data-href="#3c12d972-9050-44fe-9000-e79d518eb69e-2"><i class="fas fa-horse"></i>å½“å‰è¯»</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="3c12d972-9050-44fe-9000-e79d518eb69e-1"><p>å¿«ç…§è¯»åˆå«ä¸€è‡´æ€§è¯»ï¼Œè¯»å–çš„æ˜¯å¿«ç…§æ•°æ®ã€‚<span class='p green'>ä¸åŠ é”çš„ç®€å•çš„ SELECT éƒ½å±äºå¿«ç…§è¯»</span>ï¼Œå³ä¸åŠ é”çš„éé˜»å¡è¯»ï¼›æ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> player <span class="keyword">WHERE</span> ...</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥å‡ºç°å¿«ç…§è¯»çš„æƒ…å†µï¼Œæ˜¯åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œå¿«ç…§è¯»çš„å®ç°æ˜¯åŸºäºMVCCï¼Œå®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œ é¿å…äº†åŠ é”æ“ä½œï¼Œé™ä½äº†å¼€é”€ã€‚</p><p>æ—¢ç„¶æ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰çš„å†å²ç‰ˆæœ¬ã€‚</p><p>å¿«ç…§è¯»çš„å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«ï¼Œä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–æˆå½“å‰è¯»ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3c12d972-9050-44fe-9000-e79d518eb69e-2"><p>å½“å‰è¯»è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆæœ€æ–°æ•°æ®ï¼Œè€Œä¸æ˜¯å†å²ç‰ˆæœ¬çš„æ•°æ®ï¼‰ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚åŠ é”çš„ SELECTï¼Œæˆ–è€…å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹éƒ½ä¼šè¿›è¡Œå½“å‰è¯»ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student LOCK <span class="keyword">IN</span> SHARE MODE; # å…±äº«é”</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>; # æ’ä»–é”</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">values</span> ... # æ’ä»–é”</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> ... # æ’ä»–é”</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> ... # æ’ä»–é”</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="2-å†è°ˆéš”ç¦»çº§åˆ«">2. å†è°ˆéš”ç¦»çº§åˆ«</h2><p>æˆ‘ä»¬çŸ¥é“äº‹åŠ¡æœ‰ 4 ä¸ªéš”ç¦»çº§åˆ«ï¼Œå¯èƒ½å­˜åœ¨ä¸‰ç§å¹¶å‘é—®é¢˜ï¼š</p><p>åœ¨MySQLä¸­ï¼Œé»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼Œå¯ä»¥è§£å†³è„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå¦‚æœä»…ä»å®šä¹‰çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå¹¶ä¸èƒ½è§£å†³å¹»è¯»é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è§£å†³å¹»è¯»é—®é¢˜ï¼Œå°±éœ€è¦é‡‡ç”¨ä¸²è¡ŒåŒ–çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å°†éš”ç¦»çº§åˆ«æå‡åˆ°æœ€é«˜ï¼Œä½†è¿™æ ·ä¸€æ¥å°±ä¼šå¤§å¹…é™ä½æ•°æ®åº“çš„äº‹åŠ¡å¹¶å‘èƒ½åŠ›ã€‚</p><p>MVCCå¯ä»¥ä¸é‡‡ç”¨é”æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡ä¹è§‚é”çš„æ–¹å¼æ¥è§£å†³ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ï¼å®ƒå¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ›¿ä»£è¡Œçº§é”ï¼Œé™ä½ç³»ç»Ÿçš„å¼€é”€ã€‚</p><h2 id="3-éšè—å­—æ®µã€Undo-Logç‰ˆæœ¬é“¾">3. éšè—å­—æ®µã€Undo Logç‰ˆæœ¬é“¾</h2><p>å›é¡¾ä¸€ä¸‹undoæ—¥å¿—çš„ç‰ˆæœ¬é“¾ï¼Œå¯¹äºä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œå®ƒçš„èšç°‡ç´¢å¼•è®°å½•ä¸­éƒ½åŒ…å«ä¸¤ä¸ªå¿…è¦çš„éšè—åˆ—ã€‚</p><p>*<code>trx_id</code>ï¼šæ¯æ¬¡ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠè¯¥äº‹åŠ¡çš„<code>äº‹åŠ¡id</code>èµ‹å€¼ç»™<code>trx_id</code>éšè—åˆ—ã€‚<br>*<code>roll_pointer</code>ï¼šæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§çš„ç‰ˆæœ¬å†™å…¥åˆ°<code>undoæ—¥å¿—</code>ä¸­ï¼Œç„¶ åè¿™ä¸ªéšè—åˆ—å°±ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯ã€‚</p><p>ä¸¾ä¾‹ï¼šstudentè¡¨æ•°æ®å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name <span class="operator">|</span> class<span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span>   <span class="operator">|</span> å¼ ä¸‰  <span class="operator">|</span> ä¸€ç­ <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.07</span> sec)</span><br></pre></td></tr></table></figure><p>å‡è®¾æ’å…¥è¯¥è®°å½•çš„<code>äº‹åŠ¡id</code>ä¸º<code>8</code>ï¼Œé‚£ä¹ˆæ­¤åˆ»è¯¥æ¡è®°å½•çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714140801595.png" alt="image-20220714140801595"></p><blockquote><p>insert undoåªåœ¨äº‹åŠ¡å›æ»šæ—¶èµ·ä½œç”¨ï¼Œå½“äº‹åŠ¡æäº¤åï¼Œè¯¥ç±»å‹çš„undoæ—¥å¿—å°±æ²¡ç”¨äº†ï¼Œå®ƒå ç”¨çš„Undo Log Segmentä¹Ÿä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼ˆä¹Ÿå°±æ˜¯è¯¥undoæ—¥å¿—å ç”¨çš„Undoé¡µé¢é“¾è¡¨è¦ä¹ˆè¢«é‡ç”¨ï¼Œè¦ä¹ˆè¢«é‡Šæ”¾ï¼‰ã€‚</p></blockquote><p>å‡è®¾ä¹‹åä¸¤ä¸ªäº‹åŠ¡idåˆ†åˆ«ä¸º<code>10</code>ã€<code>20</code>çš„äº‹åŠ¡å¯¹è¿™æ¡è®°å½•è¿›è¡Œ<code>UPDATE</code>æ“ä½œï¼Œæ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714140846658.png" alt="image-20220714140846658"></p><p>æ¯æ¬¡å¯¹è®°å½•è¿›è¡Œæ”¹åŠ¨ï¼Œéƒ½ä¼šè®°å½•ä¸€æ¡undoæ—¥å¿—ï¼Œæ¯æ¡undoæ—¥å¿—ä¹Ÿéƒ½æœ‰ä¸€ä¸ª<code>roll_pointer</code>å±æ€§ ï¼ˆ<code>INSERT</code>æ“ä½œå¯¹åº”çš„undoæ—¥å¿—æ²¡æœ‰è¯¥å±æ€§ï¼Œå› ä¸ºè¯¥è®°å½•å¹¶æ²¡æœ‰æ›´æ—©çš„ç‰ˆæœ¬ï¼‰ï¼Œå¯ä»¥å°†è¿™äº›<code>undoæ—¥å¿—</code>éƒ½è¿èµ·æ¥ï¼Œä¸²æˆä¸€ä¸ªé“¾è¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714141012874.png" alt="image-20220714141012874"></p><p>å¯¹è¯¥è®°å½•æ¯æ¬¡æ›´æ–°åï¼Œéƒ½ä¼šå°†æ—§å€¼æ”¾åˆ°ä¸€æ¡<code>undoæ—¥å¿—</code>ä¸­ï¼Œå°±ç®—æ˜¯è¯¥è®°å½•çš„ä¸€ä¸ªæ—§ç‰ˆæœ¬ï¼Œéšç€æ›´æ–°æ¬¡æ•° çš„å¢å¤šï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬éƒ½ä¼šè¢«<code>roll_pointer</code>å±æ€§è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé“¾è¡¨ç§°ä¹‹ä¸º<code>ç‰ˆæœ¬é“¾</code>ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰è®°å½•æœ€æ–°çš„å€¼ã€‚</p><p>æ¯ä¸ªç‰ˆæœ¬ä¸­è¿˜åŒ…å«ç”Ÿæˆè¯¥ç‰ˆæœ¬æ—¶å¯¹åº”çš„<code>äº‹åŠ¡id</code>ã€‚</p><hr><h2 id="4-MVCCå®ç°åŸç†ä¹‹ReadView">4. MVCCå®ç°åŸç†ä¹‹ReadView</h2><p>MVCC çš„å®ç°ä¾èµ–äºï¼š<code>éšè—å­—æ®µ</code>ã€<code>Undo Log</code>ã€<code>Read View</code>ã€‚</p><h3 id="4-1-ä»€ä¹ˆæ˜¯ReadView">4.1 ä»€ä¹ˆæ˜¯ReadView</h3><p>åœ¨MVCCæœºåˆ¶ä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªè¡Œè®°å½•è¿›è¡Œæ›´æ–°ä¼šäº§ç”Ÿå¤šä¸ªå†å²å¿«ç…§ï¼Œè¿™äº›å†å²å¿«ç…§ä¿å­˜åœ¨ Undo Logé‡Œã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡æƒ³è¦æŸ¥è¯¢è¿™ä¸ªè¡Œè®°å½•ï¼Œéœ€è¦è¯»å–å“ªä¸ªç‰ˆæœ¬çš„è¡Œè®°å½•å‘¢ï¼Ÿè¿™æ—¶å°±éœ€è¦ç”¨åˆ° Readviewäº†ï¼Œå®ƒå¸®æˆ‘ä»¬è§£å†³äº†è¡Œçš„å¯è§æ€§é—®é¢˜ã€‚</p><p>Readviewå°±æ˜¯äº‹åŠ¡åœ¨ä½¿ç”¨MVCCæœºåˆ¶è¿›è¡Œå¿«ç…§è¯»æ“ä½œæ—¶äº§ç”Ÿçš„è¯»è§†å›¾ã€‚å½“äº‹åŠ¡å¯åŠ¨æ—¶ï¼Œä¼šç”Ÿæˆæ•°æ®åº“ç³»ç»Ÿå½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼ŒInnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥è®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰<code>æ´»è·ƒäº‹åŠ¡</code>çš„Dï¼ˆâ€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ï¼‰</p><h3 id="4-2-è®¾è®¡æ€è·¯">4.2 è®¾è®¡æ€è·¯</h3><p>ä½¿ç”¨<code>READ UNCOMMITTED</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œç”±äºå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬å°±å¥½äº†ã€‚</p><p>ä½¿ç”¨<code>SERIALIZABLE</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼ŒInnoDBè§„å®šä½¿ç”¨åŠ é”çš„æ–¹å¼æ¥è®¿é—®è®°å½•ã€‚</p><p>ä½¿ç”¨<code>READ COMMITTED</code>å’Œ<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œéƒ½å¿…é¡»ä¿è¯è¯»åˆ°<code>å·²ç»æäº¤äº†çš„</code>äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ã€‚å‡å¦‚å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»ä¿®æ”¹äº†è®°å½•ä½†æ˜¯å°šæœªæäº¤ï¼Œæ˜¯ä¸èƒ½ç›´æ¥è¯»å–æœ€æ–°ç‰ˆæœ¬çš„è®°å½•çš„ï¼Œæ ¸å¿ƒé—®é¢˜å°±æ˜¯éœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬é“¾ä¸­çš„å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰äº‹åŠ¡å¯è§çš„ï¼Œè¿™æ˜¯ReadViewè¦è§£å†³çš„ä¸»è¦é—®é¢˜ã€‚</p><p>è¿™ä¸ªReadViewä¸­ä¸»è¦åŒ…å«4ä¸ªæ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><p>1.<code>creator_trx_id</code>ï¼Œåˆ›å»ºè¿™ä¸ªRead Viewçš„äº‹åŠ¡IDã€‚</p><blockquote><p>è¯´æ˜ï¼šåªæœ‰åœ¨å¯¹è¡¨ä¸­çš„è®°å½•åšæ”¹åŠ¨æ—¶ï¼ˆæ‰§è¡ŒINSERTã€DELETEã€UPDATEè¿™äº›è¯­å¥æ—¶ï¼‰æ‰ä¼šä¸º äº‹åŠ¡åˆ†é…äº‹åŠ¡idï¼Œå¦åˆ™åœ¨ä¸€ä¸ªåªè¯»äº‹åŠ¡ä¸­çš„äº‹åŠ¡idå€¼éƒ½é»˜è®¤ä¸º0ã€‚</p></blockquote><p>2.<code>trx_ids</code>ï¼Œè¡¨ç¤ºåœ¨ç”ŸæˆReadViewæ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„è¯»å†™äº‹åŠ¡çš„<code>äº‹åŠ¡idåˆ—è¡¨</code>ã€‚</p><p>3.<code>up_limit_id</code>ï¼Œæ´»è·ƒçš„äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡ IDã€‚</p><p>4.<code>low_limit_id</code>ï¼Œè¡¨ç¤ºç”ŸæˆReadViewæ—¶ç³»ç»Ÿä¸­åº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ id å€¼ã€‚low_limit_id æ˜¯ç³» ç»Ÿæœ€å¤§çš„äº‹åŠ¡idå€¼ï¼Œè¿™é‡Œè¦æ³¨æ„æ˜¯ç³»ç»Ÿä¸­çš„äº‹åŠ¡idï¼Œéœ€è¦åŒºåˆ«äºæ­£åœ¨æ´»è·ƒçš„äº‹åŠ¡IDã€‚</p><blockquote><p>æ³¨æ„ï¼šlow_limit_idå¹¶ä¸æ˜¯trx_idsä¸­çš„æœ€å¤§å€¼ï¼Œäº‹åŠ¡idæ˜¯é€’å¢åˆ†é…çš„ã€‚æ¯”å¦‚ï¼Œç°åœ¨æœ‰idä¸º1ï¼Œ 2ï¼Œ3è¿™ä¸‰ä¸ªäº‹åŠ¡ï¼Œä¹‹åidä¸º3çš„äº‹åŠ¡æäº¤äº†ã€‚é‚£ä¹ˆä¸€ä¸ªæ–°çš„è¯»äº‹åŠ¡åœ¨ç”ŸæˆReadViewæ—¶ï¼Œ trx_idså°±åŒ…æ‹¬1å’Œ2ï¼Œup_limit_idçš„å€¼å°±æ˜¯1ï¼Œlow_limit_idçš„å€¼å°±æ˜¯4ã€‚</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714142254768.png" alt="image-20220714142254768"  /><hr><h3 id="4-3-ReadViewçš„è§„åˆ™">4.3 ReadViewçš„è§„åˆ™</h3><p>æœ‰äº†è¿™ä¸ªReadViewï¼Œè¿™æ ·åœ¨è®¿é—®æŸæ¡è®°å½•æ—¶ï¼Œåªéœ€è¦æŒ‰ç…§ä¸‹è¾¹çš„æ­¥éª¤åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§ã€‚</p><ul><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼ä¸ReadViewä¸­çš„ creator_trx_id å€¼ç›¸åŒï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®å®ƒè‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å°äºReadViewä¸­çš„ up_limit_id å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewå‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å¤§äºæˆ–ç­‰äºReadViewä¸­çš„ low_limit_id å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewåæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼åœ¨ReadViewçš„ up_limit_id å’Œ low_limit_id ä¹‹é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹trx_idå±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨ trx_ids åˆ—è¡¨ä¸­ã€‚<ul><li>å¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ã€‚</li><li>å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—®ã€‚</li></ul></li></ul><hr><h3 id="4-4-MVCCæ•´ä½“æ“ä½œæµç¨‹">4.4 MVCCæ•´ä½“æ“ä½œæµç¨‹</h3><p>äº†è§£äº†è¿™äº›æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å½“æŸ¥è¯¢ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œç³»ç»Ÿå¦‚ä½•é€šè¿‡MVCCæ‰¾åˆ°å®ƒï¼š</p><ol><li>é¦–å…ˆè·å–äº‹åŠ¡è‡ªå·±çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ IDï¼›</li><li>è·å– ReadViewï¼›</li><li>æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®ï¼Œç„¶åä¸ ReadView ä¸­çš„äº‹åŠ¡ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒï¼›</li><li>å¦‚æœä¸ç¬¦åˆ ReadView è§„åˆ™ï¼Œå°±éœ€è¦ä» Undo Log ä¸­è·å–å†å²å¿«ç…§ï¼›</li><li>æœ€åè¿”å›ç¬¦åˆè§„åˆ™çš„æ•°æ®ã€‚</li></ol><p>å¦‚æœæŸä¸ªç‰ˆæœ¬çš„æ•°æ®å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§çš„è¯ï¼Œé‚£å°±é¡ºç€ç‰ˆæœ¬é“¾æ‰¾åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œç»§ç»­æŒ‰ç…§ä¸Šè¾¹çš„æ­¥éª¤åˆ¤æ–­å¯è§æ€§ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç‰ˆæœ¬é“¾ä¸­çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚å¦‚æœæœ€åä¸€ä¸ªç‰ˆæœ¬ä¹Ÿä¸å¯è§çš„è¯ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€è¯¥æ¡è®°å½•å¯¹è¯¥äº‹åŠ¡å®Œå…¨ä¸å¯è§ï¼ŒæŸ¥è¯¢ç»“æœå°±ä¸åŒ…å«è¯¥è®°å½•ã€‚</p><blockquote><p>InnoDB ä¸­ï¼ŒMVCCæ˜¯é€šè¿‡ Undo Log + Read View è¿›è¡Œæ•°æ®è¯»å–ï¼ŒUndo Log ä¿å­˜äº†å†å²å¿«ç…§ï¼Œè€Œ Read View è§„åˆ™å¸®æˆ‘ä»¬åˆ¤æ–­å½“å‰ç‰ˆæœ¬çš„æ•°æ®æ˜¯å¦å¯è§ã€‚</p></blockquote><p>åœ¨éš”ç¦»çº§åˆ«ä¸ºè¯»å·²æäº¤ï¼ˆRead Committedï¼‰æ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ¯ä¸€æ¬¡ SELECT æŸ¥è¯¢éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡ Read Viewã€‚</p><p>å¦‚è¡¨æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715130843147.png" alt="image-20220715130843147" style="zoom:67%;" /><blockquote><p>æ³¨æ„ï¼Œæ­¤æ—¶åŒæ ·çš„æŸ¥è¯¢è¯­å¥éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡ Read Viewï¼Œè¿™æ—¶å¦‚æœ Read View ä¸åŒï¼Œå°±å¯èƒ½äº§ç”Ÿä¸å¯é‡å¤è¯»æˆ–è€…å¹»è¯»çš„æƒ…å†µã€‚</p></blockquote><p>å½“éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»çš„æ—¶å€™ï¼Œå°±é¿å…äº†ä¸å¯é‡å¤è¯»ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªäº‹åŠ¡åªåœ¨ç¬¬ä¸€æ¬¡ SELECT çš„æ—¶å€™ä¼šè·å–ä¸€æ¬¡ Read Viewï¼Œè€Œåé¢æ‰€æœ‰çš„ SELECT éƒ½ä¼šå¤ç”¨è¿™ä¸ª Read Viewï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715130916437.png" alt="image-20220715130916437" style="zoom:67%;" /><hr><h2 id="5-ä¸¾ä¾‹è¯´æ˜">5. ä¸¾ä¾‹è¯´æ˜</h2><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715131200077.png" alt="image-20220715131200077"  /><h3 id="5-1-READ-COMMITTEDçº§åˆ«">5.1 READ COMMITTEDçº§åˆ«</h3><p><strong>READ COMMITTED ï¼šæ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ªReadViewã€‚</strong></p><p>ç°åœ¨æœ‰ä¸¤ä¸ª<code>äº‹åŠ¡id</code>åˆ†åˆ«ä¸º<code>10</code>ã€<code>20</code>çš„äº‹åŠ¡åœ¨æ‰§è¡Œ:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">10</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;æå››&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;ç‹äº”&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># Transaction <span class="number">20</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line">...</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡çœŸæ­£ä¿®æ”¹è®°å½•æ—¶ï¼ˆæ¯”å¦‚ä½¿ç”¨INSERTã€DELETEã€UPDATEè¯­å¥ï¼‰ï¼Œæ‰ä¼šè¢«åˆ†é…ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡idï¼Œè¿™ä¸ªäº‹åŠ¡idæ˜¯é€’å¢çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ‰åœ¨äº‹åŠ¡2ä¸­æ›´æ–°ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•ï¼Œç›®çš„æ˜¯è®©å®ƒåˆ†é…äº‹åŠ¡idã€‚</p></blockquote><p>æ­¤åˆ»ï¼Œè¡¨student ä¸­ id ä¸º 1 çš„è®°å½•å¾—åˆ°çš„ç‰ˆæœ¬é“¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715133640655.png" alt="image-20220715133640655"></p><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½¿ç”¨<code>READ COMMITTED</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"># SELECT1ï¼šTransaction <span class="number">10</span>ã€<span class="number">20</span>æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715134540737.png" alt="image-20220715134540737"  /><p>ä¹‹åï¼Œæˆ‘ä»¬æŠŠ<code>äº‹åŠ¡id</code>ä¸º<code>10</code>çš„äº‹åŠ¡æäº¤ä¸€ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">10</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;æå››&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;ç‹äº”&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åå†åˆ°<code>äº‹åŠ¡id</code>ä¸º<code>20</code>çš„äº‹åŠ¡ä¸­æ›´æ–°ä¸€ä¸‹è¡¨<code>student</code>ä¸­<code>id</code>ä¸º<code>1</code>çš„è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">20</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line">...</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;é’±ä¸ƒ&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;å®‹å…«&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>æ­¤åˆ»ï¼Œè¡¨studentä¸­<code>id</code>ä¸º<code>1</code>çš„è®°å½•çš„ç‰ˆæœ¬é“¾å°±é•¿è¿™æ ·ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715134839081.png" alt="image-20220715134839081"></p><p>ç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨<code>READ COMMITTED</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ª id ä¸º 1 çš„è®°å½•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"># SELECT1ï¼šTransaction <span class="number">10</span>ã€<span class="number">20</span>å‡æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line"></span><br><span class="line"># SELECT2ï¼šTransaction <span class="number">10</span>æäº¤ï¼ŒTransaction <span class="number">20</span>æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;ç‹äº”&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715135017000.png" alt="image-20220715135017000"  /><blockquote><p>å¼ºè°ƒï¼šä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ¯æ¬¡æŸ¥è¯¢å¼€å§‹æ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ReadViewã€‚</p></blockquote><hr><h3 id="5-2-REPEATABLE-READçº§åˆ«">5.2 REPEATABLE READçº§åˆ«</h3><p>ä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œåªä¼šåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ª<code>ReadView</code>ï¼Œä¹‹åçš„æŸ¥è¯¢å°±ä¸ä¼šé‡å¤ç”Ÿæˆäº†ã€‚</p><p>æ¯”å¦‚ï¼Œç³»ç»Ÿé‡Œæœ‰ä¸¤ä¸ª<code>äº‹åŠ¡id</code>åˆ†åˆ«ä¸º<code>10</code>ã€<code>20</code>çš„äº‹åŠ¡åœ¨æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">10</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;æå››&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;ç‹äº”&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># Transaction <span class="number">20</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ­¤åˆ»ï¼Œè¡¨student ä¸­ id ä¸º 1 çš„è®°å½•å¾—åˆ°çš„ç‰ˆæœ¬é“¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140006061.png" alt="image-20220715140006061"></p><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"># SELECT1ï¼šTransaction <span class="number">10</span>ã€<span class="number">20</span>æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140155744.png" alt="image-20220715140155744"  /><p>ä¹‹åï¼Œæˆ‘ä»¬æŠŠ<code>äº‹åŠ¡id</code>ä¸º<code>10</code>çš„äº‹åŠ¡æäº¤ä¸€ä¸‹ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">10</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;æå››&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;ç‹äº”&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åå†åˆ°<code>äº‹åŠ¡id</code>ä¸º<code>20</code>çš„äº‹åŠ¡ä¸­æ›´æ–°ä¸€ä¸‹è¡¨<code>student</code>ä¸­<code>id</code>ä¸º<code>1</code>çš„è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Transaction <span class="number">20</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line">...</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;é’±ä¸ƒ&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name<span class="operator">=</span>&quot;å®‹å…«&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>æ­¤åˆ»ï¼Œè¡¨student ä¸­<code>id</code>ä¸º<code>1</code>çš„è®°å½•çš„ç‰ˆæœ¬é“¾é•¿è¿™æ ·ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140354217.png" alt="image-20220715140354217"></p><p>ç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ª<code>id</code>ä¸º<code>1</code>çš„è®°å½•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># SELECT1ï¼šTransaction <span class="number">10</span>ã€<span class="number">20</span>å‡æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line"># SELECT2ï¼šTransaction <span class="number">10</span>æäº¤ï¼ŒTransaction <span class="number">20</span>æœªæäº¤</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä»ä¸º<span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140555172.png" alt="image-20220715140555172"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715140620328.png" alt="image-20220715140620328"  /><p>è¿™æ¬¡<code>SELECT</code>æŸ¥è¯¢å¾—åˆ°çš„ç»“æœæ˜¯é‡å¤çš„ï¼Œè®°å½•çš„åˆ—<code>c</code>å€¼éƒ½æ˜¯<code>å¼ ä¸‰</code>ï¼Œè¿™å°±æ˜¯<code>å¯é‡å¤è¯»</code>çš„å«ä¹‰ã€‚å¦‚æœæˆ‘ä»¬ä¹‹åå†æŠŠ<code>äº‹åŠ¡id</code>ä¸º<code>20</code>çš„è®°å½•æäº¤äº†ï¼Œç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ª<code>id</code>ä¸º<code>1</code>çš„è®°å½•ï¼Œå¾—åˆ°çš„ç»“æœè¿˜æ˜¯<code>å¼ ä¸‰</code>ï¼Œå…·ä½“æ‰§è¡Œè¿‡ç¨‹å¤§å®¶å¯ä»¥è‡ªå·±åˆ†æä¸€ä¸‹ã€‚</p><hr><h3 id="5-3-å¦‚ä½•è§£å†³å¹»è¯»">5.3 å¦‚ä½•è§£å†³å¹»è¯»</h3><p>æ¥ä¸‹æ¥è¯´æ˜InnoDB æ˜¯å¦‚ä½•è§£å†³å¹»è¯»çš„ã€‚</p><p>å‡è®¾ç°åœ¨è¡¨ student ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œæ•°æ®å†…å®¹ä¸­ï¼Œä¸»é”® id=1ï¼Œéšè—çš„ trx_id=10ï¼Œå®ƒçš„ undo log å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715141002035.png" alt="image-20220715141002035" style="zoom:80%;" /><p>å‡è®¾ç°åœ¨æœ‰äº‹åŠ¡ A å’Œäº‹åŠ¡ B å¹¶å‘æ‰§è¡Œï¼Œ<code>äº‹åŠ¡ A</code>çš„äº‹åŠ¡ id ä¸º<code>20</code>ï¼Œ<code>äº‹åŠ¡ B</code>çš„äº‹åŠ¡ id ä¸º<code>30</code>ã€‚</p><p>æ­¥éª¤1ï¼šäº‹åŠ¡ A å¼€å§‹ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ•°æ®ï¼ŒæŸ¥è¯¢çš„ SQL è¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&gt;=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>åœ¨å¼€å§‹æŸ¥è¯¢ä¹‹å‰ï¼ŒMySQL ä¼šä¸ºäº‹åŠ¡ A äº§ç”Ÿä¸€ä¸ª ReadViewï¼Œæ­¤æ—¶ ReadView çš„å†…å®¹å¦‚ä¸‹ï¼š<code>trx_ids= [20,30] ï¼Œ up_limit_id=20 ï¼Œ low_limit_id=31 ï¼Œ creator_trx_id=20</code>ã€‚</p><p>ç”±äºæ­¤æ—¶è¡¨ student ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œä¸”ç¬¦åˆ where id&gt;=1 æ¡ä»¶ï¼Œå› æ­¤ä¼šæŸ¥è¯¢å‡ºæ¥ã€‚ç„¶åæ ¹æ® ReadView æœºåˆ¶ï¼Œå‘ç°è¯¥è¡Œæ•°æ®çš„trx_id=10ï¼Œå°äºäº‹åŠ¡ A çš„ ReadView é‡Œ up_limit_idï¼Œè¿™è¡¨ç¤ºè¿™æ¡æ•°æ®æ˜¯äº‹åŠ¡ A å¼€å¯ä¹‹å‰ï¼Œå…¶ä»–äº‹åŠ¡å°±å·²ç»æäº¤äº†çš„æ•°æ®ï¼Œå› æ­¤äº‹åŠ¡ A å¯ä»¥è¯»å–åˆ°ã€‚</p><p>ç»“è®ºï¼šäº‹åŠ¡ A çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œèƒ½è¯»å–åˆ°ä¸€æ¡æ•°æ®ï¼Œid=1ã€‚</p><p>æ­¥éª¤2ï¼šæ¥ç€äº‹åŠ¡ B(trx_id=30)ï¼Œå¾€è¡¨ student ä¸­æ–°æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œå¹¶æäº¤äº‹åŠ¡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student(id,name) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;æå››&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student(id,name) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;ç‹äº”&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è¡¨student ä¸­å°±æœ‰ä¸‰æ¡æ•°æ®äº†ï¼Œå¯¹åº”çš„ undo å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715141208667.png" alt="image-20220715141208667"></p><p>æ­¥éª¤3ï¼šæ¥ç€äº‹åŠ¡ A å¼€å¯ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œæ ¹æ®å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„è§„åˆ™ï¼Œæ­¤æ—¶äº‹åŠ¡ A å¹¶ä¸ä¼šå†é‡æ–°ç”Ÿæˆ ReadViewã€‚æ­¤æ—¶è¡¨ student ä¸­çš„ 3 æ¡æ•°æ®éƒ½æ»¡è¶³ where id&gt;=1 çš„æ¡ä»¶ï¼Œå› æ­¤ä¼šå…ˆæŸ¥å‡ºæ¥ã€‚ç„¶åæ ¹æ® ReadView æœºåˆ¶ï¼Œåˆ¤æ–­æ¯æ¡æ•°æ®æ˜¯ä¸æ˜¯éƒ½å¯ä»¥è¢«äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>1ï¼‰é¦–å…ˆ id=1 çš„è¿™æ¡æ•°æ®ï¼Œå‰é¢å·²ç»è¯´è¿‡äº†ï¼Œå¯ä»¥è¢«äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>2ï¼‰ç„¶åæ˜¯ id=2 çš„æ•°æ®ï¼Œå®ƒçš„ trx_id=30ï¼Œæ­¤æ—¶äº‹åŠ¡ A å‘ç°ï¼Œè¿™ä¸ªå€¼å¤„äº up_limit_id å’Œ low_limit_id ä¹‹ é—´ï¼Œå› æ­¤è¿˜éœ€è¦å†åˆ¤æ–­ 30 æ˜¯å¦å¤„äº trx_ids æ•°ç»„å†…ã€‚ç”±äºäº‹åŠ¡ A çš„ trx_ids=[20,30]ï¼Œå› æ­¤åœ¨æ•°ç»„å†…ï¼Œè¿™è¡¨ ç¤º id=2 çš„è¿™æ¡æ•°æ®æ˜¯ä¸äº‹åŠ¡ A åœ¨åŒä¸€æ—¶åˆ»å¯åŠ¨çš„å…¶ä»–äº‹åŠ¡æäº¤çš„ï¼Œæ‰€ä»¥è¿™æ¡æ•°æ®ä¸èƒ½è®©äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>3ï¼‰åŒç†ï¼Œid=3 çš„è¿™æ¡æ•°æ®ï¼Œtrx_id ä¹Ÿä¸º 30ï¼Œå› æ­¤ä¹Ÿä¸èƒ½è¢«äº‹åŠ¡ A çœ‹è§ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220715141243993.png" alt="image-20220715141243993"></p><p>ç»“è®ºï¼šæœ€ç»ˆäº‹åŠ¡ A çš„ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œåªèƒ½æŸ¥è¯¢å‡º id=1 çš„è¿™æ¡æ•°æ®ã€‚è¿™å’Œäº‹åŠ¡ A çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€æ · çš„ï¼Œå› æ­¤æ²¡æœ‰å‡ºç°å¹»è¯»ç°è±¡ï¼Œæ‰€ä»¥è¯´åœ¨ MySQL çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸å­˜åœ¨å¹»è¯»é—®é¢˜ã€‚</p><h2 id="6-æ€»ç»“">6. æ€»ç»“</h2><p>è¿™é‡Œä»‹ç»äº† MVCC åœ¨<code>READ COMMITTD</code>ã€<code>REPEATABLE READ</code>è¿™ä¸¤ç§éš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ‰§è¡Œå¿«ç…§è¯»æ“ä½œæ—¶ è®¿é—®è®°å½•çš„ç‰ˆæœ¬é“¾çš„è¿‡ç¨‹ã€‚è¿™æ ·ä½¿ä¸åŒäº‹åŠ¡çš„<code>è¯»-å†™</code>ã€<code>å†™-è¯»</code>æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><p>æ ¸å¿ƒç‚¹åœ¨äº ReadView çš„åŸç†ï¼Œ<code>READ COMMITTD</code>ã€<code>REPEATABLE READ</code>è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«çš„ä¸€ä¸ªå¾ˆå¤§ä¸åŒ å°±æ˜¯ç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼š</p><p>*<code>READ COMMITTD</code>åœ¨æ¯ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadView<br>*<code>REPEATABLE READ</code>åªåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„æŸ¥è¯¢æ“ä½œéƒ½é‡å¤ ä½¿ç”¨è¿™ä¸ªReadViewå°±å¥½äº†ã€‚</p><blockquote><p>è¯´æ˜ï¼šæˆ‘ä»¬ä¹‹å‰è¯´æ‰§è¡ŒDELETEè¯­å¥æˆ–è€…æ›´æ–°ä¸»é”®çš„UPDATEè¯­å¥å¹¶ä¸ä¼šç«‹å³æŠŠå¯¹åº”çš„è®°å½•å®Œå…¨ä»é¡µé¢ä¸­åˆ é™¤ï¼Œ è€Œæ˜¯æ‰§è¡Œä¸€ä¸ªæ‰€è°“çš„deletemarkæ“ä½œï¼Œç›¸å½“äºåªæ˜¯å¯¹è®°å½•æ‰“ä¸Šäº†ä¸€ä¸ªåˆ é™¤æ ‡å¿—ä½ï¼Œè¿™ä¸»è¦å°±æ˜¯ä¸ºMVCCæœåŠ¡çš„ã€‚</p></blockquote><p>é€šè¿‡MVCCæˆ‘ä»¬å¯ä»¥è§£å†³ï¼š</p><ol><li><p>è¯»å†™ä¹‹é—´é˜»å¯¨çš„é—®é¢˜ã€‚é€šè¿‡MVCCå¯ä»¥è®©è¯»å†™äº’ç›¸ä¸é˜³å¡ï¼Œå³è¯»ä¸é˜»å¡å†™ï¼Œå†™ä¸é˜»å¡è¯»ï¼Œè¿™æ ·å°±å¯ä»¥æå‡äº‹åŠ¡å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p></li><li><p>é™ä½äº†æ­»é”çš„æ¦‚ç‡ã€‚è¿™æ˜¯å› ä¸ºMVCCé‡‡ç”¨äº†ä¹è§‚é”çš„æ–¹å¼ï¼Œè¯»å–æ•°æ®æ—¶å¹¶ä¸éœ€è¦åŠ é”ï¼Œå¯¹äºå†™æ“ä½œï¼Œä¹Ÿåªé”å®šå¿…è¦çš„è¡Œã€‚</p></li><li><p>è§£å†³å¿«ç…§è¯»çš„é—®é¢˜ã€‚å½“æˆ‘ä»¬æŸ¥è¯¢æ•°æ®åº“åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ—¶ï¼Œåªèƒ½çœ‹åˆ°è¿™ä¸ªæ—¶é—´ç‚¹ä¹‹å‰äº‹åŠ¡æäº¤æ›´æ–°çš„ç»“æœï¼Œè€Œä¸èƒ½çœ‹åˆ°è¿™ä¸ªæ—¶é—´ç‚¹ä¹‹åäº‹åŠ¡æäº¤çš„æ›´æ–°ç»“æœã€‚</p></li></ol>]]></content>
    
    
    <summary type="html">ä»€ä¹ˆæ˜¯MVCCã€MVCCå®ç°åŸç†ä¹‹ReadView</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Contrastive Multiview Coding</title>
    <link href="https://wuwawawa.github.io/posts/b456fe1.html"/>
    <id>https://wuwawawa.github.io/posts/b456fe1.html</id>
    <published>2023-04-17T11:03:25.000Z</published>
    <updated>2023-04-17T11:38:05.354Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-æ‘˜è¦">1. æ‘˜è¦</h2><div class="tabs" id="6798128c-286b-444b-b400-a070611978b1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b1-1"><i class="fas fa-cat"></i>ç¿»è¯‘</button></li><li class="tab"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b1-2"><i class="fas fa-dove"></i>åŸæ–‡</button></li><li class="tab"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b1-3"><i class="fas fa-horse"></i>åˆ†æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="6798128c-286b-444b-b400-a070611978b1-1"><p>äººç±»é€šè¿‡å¤šç§æ„Ÿå®˜é€šé“æ¥è§‚å¯Ÿä¸–ç•Œï¼Œä¾‹å¦‚å·¦çœ¼çœ‹åˆ°çš„é•¿æ³¢é•¿å…‰é€šé“ï¼Œæˆ–å³è€³å¬åˆ°çš„é«˜é¢‘æŒ¯åŠ¨é€šé“ã€‚æ¯ä¸ªè§†è§’éƒ½å­˜åœ¨å™ªå£°å’Œä¸å®Œæ•´æ€§ï¼Œä½†é‡è¦å› ç´ ï¼ˆä¾‹å¦‚ç‰©ç†ã€å‡ ä½•å’Œè¯­ä¹‰ï¼‰å¾€å¾€åœ¨æ‰€æœ‰è§†è§’ä¹‹é—´å…±äº«ï¼ˆä¾‹å¦‚ï¼Œâ€œç‹—â€å¯ä»¥è¢«çœ‹åˆ°ã€å¬åˆ°å’Œæ„Ÿå—åˆ°ï¼‰ã€‚æˆ‘ä»¬ç ”ç©¶äº†ä¸€ä¸ªç»å…¸å‡è®¾ï¼Œå³å¼ºå¤§çš„è¡¨ç¤ºåº”è¯¥æ¨¡æ‹Ÿè§†è§’ä¸å˜çš„å› ç´ ã€‚æˆ‘ä»¬åœ¨å¤šè§†è§’å¯¹æ¯”å­¦ä¹ æ¡†æ¶ä¸‹ç ”ç©¶äº†è¿™ä¸ªå‡è®¾ï¼Œå­¦ä¹ ä¸€ä¸ªæ—¨åœ¨æœ€å¤§åŒ–ç›¸åŒåœºæ™¯ä¸åŒè§†è§’ä¹‹é—´çš„äº’ä¿¡æ¯çš„è¡¨ç¤ºï¼Œä½†å…¶å®ƒæ–¹é¢åˆ™éå¸¸ç´§å‡‘ã€‚æˆ‘ä»¬çš„æ–¹æ³•é€‚ç”¨äºä»»æ„æ•°é‡çš„è§†è§’ï¼Œå¹¶ä¸”æ˜¯è§†è§’æ— å…³çš„ã€‚æˆ‘ä»¬åˆ†æäº†ä½¿å…¶æœ‰æ•ˆçš„å…³é”®å±æ€§ï¼Œå‘ç°å¯¹æ¯”æŸå¤±ä¼˜äºåŸºäºäº¤å‰è§†å›¾é¢„æµ‹çš„æµè¡Œæ›¿ä»£æ–¹æ¡ˆï¼Œå¹¶ä¸”æˆ‘ä»¬ä»è¶Šå¤šè§†è§’å­¦ä¹ ï¼Œç»“æœè¡¨ç¤ºå°±è¶Šå¥½åœ°æ•æ‰åº•å±‚åœºæ™¯è¯­ä¹‰ã€‚æˆ‘ä»¬çš„æ–¹æ³•åœ¨å›¾åƒå’Œè§†é¢‘æ— ç›‘ç£å­¦ä¹ åŸºå‡†æµ‹è¯•ä¸­å–å¾—äº†æœ€å…ˆè¿›çš„ç»“æœã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6798128c-286b-444b-b400-a070611978b1-2"><p>Humans view the world through many sensory channels,e.g., the long-wavelength light channel, viewed by the left eye, or the high-frequency vibrations channel, heard by the right ear. Each view is noisy and incomplete, but important factors, such as physics, geometry, and semantics, tend to be shared between all views (e.g., a â€œdogâ€ can be seen, heard, and felt). We investigate the classic hypothesis that a powerful representation is one that models view-invariant factors. We study this hypothesis under the framework of multiview contrastive learning, where we learn a representation that aims to maximize mutual information between different views of the same scene but is otherwise compact. Our approach scales to any number of views, and is viewagnostic. We analyze key properties of the approach that make it work, finding that the contrastive loss outperforms a popular alternative based on cross-view prediction, and that the more views we learn from, the better the resulting representation captures underlying scene semantics. Our approach achieves state-of-the-art results on image and video unsupervised learning benchmarks.</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6798128c-286b-444b-b400-a070611978b1-3"><p>è¿™ç¯‡è®ºæ–‡ä¸»è¦æ¢è®¨äº†ä¸€ä¸ªå‡è®¾ï¼Œå³å¼ºå¤§çš„è¡¨ç¤ºæ˜¯ä¸€ç§æ¨¡æ‹Ÿè§†è§’ä¸å˜å› ç´ çš„è¡¨ç¤ºã€‚ä½œè€…ä»¬åœ¨å¤šè§†è§’å¯¹æ¯”å­¦ä¹ çš„æ¡†æ¶ä¸‹ï¼Œé€šè¿‡å­¦ä¹ ä¸€ä¸ªæ—¨åœ¨æœ€å¤§åŒ–åŒä¸€åœºæ™¯çš„ä¸åŒè§†è§’ä¹‹é—´çš„äº’ä¿¡æ¯çš„è¡¨ç¤ºæ¥éªŒè¯è¿™ä¸ªå‡è®¾ã€‚ä»–ä»¬å‘ç°ï¼Œå¯¹æ¯”æŸå¤±èƒœè¿‡åŸºäºè·¨è§†å›¾é¢„æµ‹çš„æµè¡Œæ›¿ä»£æ–¹æ¡ˆï¼Œå¹¶ä¸”ä»æ›´å¤šçš„è§†è§’å­¦ä¹ ï¼Œç»“æœè¡¨ç¤ºèƒ½å¤Ÿæ›´å¥½åœ°æ•è·åŸºç¡€åœºæ™¯è¯­ä¹‰ã€‚è¯¥æ–¹æ³•åœ¨å›¾åƒå’Œè§†é¢‘æ— ç›‘ç£å­¦ä¹ åŸºå‡†æµ‹è¯•ä¸­å®ç°äº†æœ€å…ˆè¿›çš„ç»“æœã€‚è¿™äº›å‘ç°å¯èƒ½ä¼šä¸ºè¿›ä¸€æ­¥ç ”ç©¶è§†è§’ä¸å˜æ€§åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„åº”ç”¨æä¾›å¯ç¤ºã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-Introduction">2. Introduction</h2><div class="tabs" id="6798128c-286b-444b-b400-a070611978b2"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b2-1"><i class="fas fa-cat"></i>ç¿»è¯‘</button></li><li class="tab"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b2-2"><i class="fas fa-dove"></i>åŸæ–‡</button></li><li class="tab"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b2-3"><i class="fas fa-horse"></i>åˆ†æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="6798128c-286b-444b-b400-a070611978b2-1"><p>ç¼–ç ç†è®ºä¸­çš„ä¸€ä¸ªåŸºæœ¬æ€æƒ³æ˜¯å­¦ä¹ å‹ç¼©è¡¨ç¤ºï¼Œä½†ä»ç„¶å¯ä»¥ç”¨äºé‡æ„åŸå§‹æ•°æ®ã€‚è¿™ä¸ªæƒ³æ³•ä»¥è‡ªç¼–ç å™¨[65]å’Œç”Ÿæˆæ¨¡å‹[40,24]çš„å½¢å¼å‡ºç°åœ¨å½“ä»£è¡¨ç¤ºå­¦ä¹ ä¸­ï¼Œå®ƒä»¬è¯•å›¾å°½å¯èƒ½åœ°æ— æŸåœ°è¡¨ç¤ºæ•°æ®ç‚¹æˆ–åˆ†å¸ƒã€‚ç„¶è€Œï¼Œæ— æŸè¡¨ç¤ºå¯èƒ½å¹¶ä¸æ˜¯æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ï¼Œè€Œä¸”å®é™…ä¸Šå¾ˆå®¹æ˜“å®ç°â€”â€”åŸå§‹æ•°æ®æœ¬èº«å°±æ˜¯ä¸€ç§æ— æŸè¡¨ç¤ºã€‚ç›¸åï¼Œæˆ‘ä»¬å¯èƒ½æ›´å–œæ¬¢ä¿ç•™â€œå¥½â€çš„ä¿¡æ¯ï¼ˆä¿¡å·ï¼‰å¹¶æ‰”æ‰å…¶ä½™çš„ä¿¡æ¯ï¼ˆå™ªå£°ï¼‰ã€‚æˆ‘ä»¬å¦‚ä½•ç¡®å®šå“ªäº›ä¿¡æ¯æ˜¯ä¿¡å·ï¼Œå“ªäº›æ˜¯å™ªå£°å‘¢ï¼Ÿ</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6798128c-286b-444b-b400-a070611978b2-2"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6798128c-286b-444b-b400-a070611978b2-3"><p>æœ¬æ®µå¼•å…¥äº†ç¼–ç ç†è®ºä¸­çš„åŸºæœ¬æ€æƒ³ï¼šå­¦ä¹ å‹ç¼©è¡¨ç¤ºï¼Œå¹¶ä»‹ç»äº†åœ¨å½“ä»£è¡¨ç¤ºå­¦ä¹ ä¸­å‡ºç°çš„ä¸¤ç§æ–¹æ³•ï¼šè‡ªç¼–ç å™¨å’Œç”Ÿæˆæ¨¡å‹ï¼Œå®ƒä»¬æ—¨åœ¨å°½å¯èƒ½æ— æŸåœ°è¡¨ç¤ºæ•°æ®ç‚¹æˆ–åˆ†å¸ƒã€‚ç„¶è€Œï¼Œä½œè€…æŒ‡å‡ºæ— æŸè¡¨ç¤ºå¯èƒ½ä¸æ˜¯æˆ‘ä»¬çœŸæ­£éœ€è¦çš„ï¼Œå› ä¸ºåŸå§‹æ•°æ®æœ¬èº«å°±æ˜¯ä¸€ç§æ— æŸè¡¨ç¤ºã€‚ç›¸åï¼Œæˆ‘ä»¬æ›´å¸Œæœ›ä¿ç•™æœ‰ç”¨çš„ä¿¡æ¯ï¼ˆä¿¡å·ï¼‰è€Œå»æ‰æ— ç”¨çš„ä¿¡æ¯ï¼ˆå™ªå£°ï¼‰ã€‚ç„¶åä½œè€…æå‡ºäº†é—®é¢˜ï¼šå¦‚ä½•ç¡®å®šå“ªäº›ä¿¡æ¯æ˜¯ä¿¡å·ï¼Œå“ªäº›æ˜¯å™ªå£°ï¼Ÿè¿™ä¸ªé—®é¢˜æ˜¯æœ¬æ–‡ç ”ç©¶çš„å‡ºå‘ç‚¹ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tabs" id="6798128c-286b-444b-b400-a070611978b3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b3-1"><i class="fas fa-cat"></i>ç¿»è¯‘</button></li><li class="tab"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b3-2"><i class="fas fa-dove"></i>åŸæ–‡</button></li><li class="tab"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b3-3"><i class="fas fa-horse"></i>åˆ†æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="6798128c-286b-444b-b400-a070611978b3-1"><p>å¯¹äºè‡ªç¼–ç å™¨æˆ–æœ€å¤§ä¼¼ç„¶ç”Ÿæˆæ¨¡å‹æ¥è¯´ï¼Œä¸€ä¸ªæ¯”ç‰¹å°±æ˜¯ä¸€ä¸ªæ¯”ç‰¹ã€‚æ²¡æœ‰ä¸€ä¸ªæ¯”ç‰¹æ¯”å…¶ä»–ä»»ä½•æ¯”ç‰¹æ›´å¥½ã€‚æœ¬æ–‡çš„çŒœæµ‹æ˜¯ï¼Œå®é™…ä¸Šæœ‰äº›æ¯”ç‰¹æ¯”å…¶ä»–æ¯”ç‰¹æ›´å¥½ã€‚ä¸€äº›æ¯”ç‰¹ç¼–ç äº†é‡è¦çš„å±æ€§ï¼Œå¦‚è¯­ä¹‰ã€ç‰©ç†å’Œå‡ ä½•ï¼Œè€Œå…¶ä»–ä¸€äº›æ¯”ç‰¹ç¼–ç çš„æ˜¯æˆ‘ä»¬å¯èƒ½è®¤ä¸ºä¸å¤ªé‡è¦çš„å±æ€§ï¼Œå¦‚å¶ç„¶çš„å…‰ç…§æ¡ä»¶æˆ–ç›¸æœºä¼ æ„Ÿå™¨ä¸­çš„çƒ­å™ªå£°ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6798128c-286b-444b-b400-a070611978b3-2"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6798128c-286b-444b-b400-a070611978b3-3"><p>æœ¬æ®µæŒ‡å‡ºï¼Œå¯¹äºè‡ªç¼–ç å™¨æˆ–æœ€å¤§ä¼¼ç„¶ç”Ÿæˆæ¨¡å‹æ¥è¯´ï¼Œæ‰€æœ‰æ¯”ç‰¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œæ²¡æœ‰ä¸€ä¸ªæ¯”ç‰¹æ¯”å…¶ä»–ä»»ä½•æ¯”ç‰¹æ›´å¥½ã€‚ä½†æœ¬æ–‡çš„çŒœæµ‹æ˜¯ï¼Œæœ‰äº›æ¯”ç‰¹ç¡®å®æ¯”å…¶ä»–æ¯”ç‰¹æ›´å¥½ã€‚ä½œè€…è®¤ä¸ºï¼Œä¸€äº›æ¯”ç‰¹ç¼–ç äº†é‡è¦çš„å±æ€§ï¼Œå¦‚è¯­ä¹‰ã€ç‰©ç†å’Œå‡ ä½•ï¼Œè€Œå…¶ä»–ä¸€äº›æ¯”ç‰¹ç¼–ç çš„æ˜¯æˆ‘ä»¬å¯èƒ½è®¤ä¸ºä¸å¤ªé‡è¦çš„å±æ€§ï¼Œå¦‚å¶ç„¶çš„å…‰ç…§æ¡ä»¶æˆ–ç›¸æœºä¼ æ„Ÿå™¨ä¸­çš„çƒ­å™ªå£°ã€‚è¿™ä¸ªçŒœæµ‹æ˜¯æœ¬æ–‡çš„ä¸€ä¸ªé‡è¦å‡è®¾ï¼Œæ˜¯ç ”ç©¶çš„å‡ºå‘ç‚¹ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tabs" id="6798128c-286b-444b-b400-a070611978b4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b4-1"><i class="fas fa-cat"></i>ç¿»è¯‘</button></li><li class="tab"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b4-2"><i class="fas fa-dove"></i>åŸæ–‡</button></li><li class="tab"><button type="button" data-href="#6798128c-286b-444b-b400-a070611978b4-3"><i class="fas fa-horse"></i>åˆ†æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="6798128c-286b-444b-b400-a070611978b4-1"><p>æˆ‘ä»¬é‡æ–°å®¡è§†äº†ä¸€ä¸ªç»å…¸å‡è®¾ï¼Œå³å¥½çš„æ¯”ç‰¹æ˜¯åœ¨å¤šç§ä¸–ç•Œè§‚çš„å¤šä¸ªè§†å›¾ä¹‹é—´å…±äº«çš„ï¼Œä¾‹å¦‚è§†è§‰ã€å¬è§‰å’Œè§¦è§‰ç­‰å¤šä¸ªæ„Ÿå®˜æ¨¡å¼ä¹‹é—´ [70]ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œâ€œå­˜åœ¨ç‹—â€çš„ä¿¡æ¯æ˜¯å¥½çš„ä¿¡æ¯ï¼Œå› ä¸ºç‹—å¯ä»¥è¢«çœ‹åˆ°ã€å¬åˆ°å’Œæ„Ÿå—åˆ°ï¼Œä½†â€œç›¸æœºå§¿æ€â€çš„ä¿¡æ¯æ˜¯ä¸å¥½çš„ä¿¡æ¯ï¼Œå› ä¸ºç›¸æœºçš„å§¿æ€å¯¹æˆåƒåœºæ™¯çš„å£°å­¦å’Œè§¦è§‰å±æ€§å‡ ä¹æ²¡æœ‰å½±å“ã€‚è¿™ä¸ªå‡è®¾å¯¹åº”äºå½’çº³åå·®ï¼Œå³è§‚å¯Ÿåœºæ™¯çš„æ–¹å¼ä¸åº”å½±å“å…¶è¯­ä¹‰ã€‚åœ¨è®¤çŸ¥ç§‘å­¦å’Œç¥ç»ç§‘å­¦æ–‡çŒ®ä¸­æœ‰å¤§é‡è¯æ®è¡¨æ˜ï¼Œå¤§è„‘ç¼–ç è¿™ç§è§†å›¾ä¸å˜çš„è¡¨ç¤ºæ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œ[70ã€15ã€32]ï¼‰ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç‰¹åˆ«ç ”ç©¶äº†ä¸åŒå›¾åƒé€šé“ä¹‹é—´çš„ä¸åŒè§†å›¾çš„æƒ…å†µï¼Œä¾‹å¦‚äº®åº¦ã€è‰²åº¦ã€æ·±åº¦å’Œå…‰æµã€‚æˆ‘ä»¬åˆ©ç”¨è‡ªç„¶æ•°æ®ä¸­ç›¸åŒåœºæ™¯çš„å¤šä¸ªè§†å›¾çš„å…±ç°ä½œä¸ºåŸºæœ¬ç›‘ç£ä¿¡å·ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†Labé¢œè‰²ç©ºé—´ä¸­çš„å›¾åƒè§†ä¸ºåœºæ™¯ä¸¤ä¸ªè§†å›¾çš„å…±ç°ç¤ºä¾‹ï¼Œå³Lè§†å›¾å’Œabè§†å›¾çš„é…å¯¹ç¤ºä¾‹ï¼š{Lï¼Œab}ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6798128c-286b-444b-b400-a070611978b4-2"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6798128c-286b-444b-b400-a070611978b4-3"><p>æœ¬æ®µé˜è¿°äº†ä½œè€…é‡æ–°å®¡è§†äº†ä¸€ä¸ªç»å…¸å‡è®¾ï¼Œå³å¥½çš„æ¯”ç‰¹æ˜¯åœ¨å¤šç§ä¸–ç•Œè§‚çš„å¤šä¸ªè§†å›¾ä¹‹é—´å…±äº«çš„ã€‚åœ¨è¿™ç§å‡è®¾ä¸‹ï¼Œâ€œå­˜åœ¨ç‹—â€çš„ä¿¡æ¯æ˜¯å¥½çš„ä¿¡æ¯ï¼Œå› ä¸ºç‹—å¯ä»¥è¢«çœ‹åˆ°ã€å¬åˆ°å’Œæ„Ÿå—åˆ°ï¼Œä½†â€œç›¸æœºå§¿æ€â€çš„ä¿¡æ¯æ˜¯ä¸å¥½çš„ä¿¡æ¯ã€‚è¿™ä¸ªå‡è®¾å¯¹åº”äºå½’çº³åå·®ï¼Œå³è§‚å¯Ÿåœºæ™¯çš„æ–¹å¼ä¸åº”å½±å“å…¶è¯­ä¹‰ã€‚ä½œè€…ç ”ç©¶äº†ä¸åŒå›¾åƒé€šé“ä¹‹é—´çš„ä¸åŒè§†å›¾çš„æƒ…å†µï¼Œå¹¶å°†è‡ªç„¶æ•°æ®ä¸­ç›¸åŒåœºæ™¯çš„å¤šä¸ªè§†å›¾çš„å…±ç°ä½œä¸ºåŸºæœ¬ç›‘ç£ä¿¡å·ã€‚è¿™ä¸ªå‡è®¾ä¸è®¤çŸ¥ç§‘å­¦å’Œç¥ç»ç§‘å­¦æ–‡çŒ®ä¸­çš„ç ”ç©¶ç›¸å»åˆã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tabs" id="d5826f3f-2acb-4f14-a9ab-ed8955cd90f5"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#d5826f3f-2acb-4f14-a9ab-ed8955cd90f5-1"><i class="fas fa-cat"></i>ç¿»è¯‘</button></li><li class="tab"><button type="button" data-href="#d5826f3f-2acb-4f14-a9ab-ed8955cd90f5-2"><i class="fas fa-dove"></i>åŸæ–‡</button></li><li class="tab"><button type="button" data-href="#d5826f3f-2acb-4f14-a9ab-ed8955cd90f5-3"><i class="fas fa-horse"></i>åˆ†æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="d5826f3f-2acb-4f14-a9ab-ed8955cd90f5-1"><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å­¦ä¹ èƒ½å¤Ÿæ•è·å¤šä¸ªä¼ æ„Ÿé€šé“ä¹‹é—´å…±äº«ä¿¡æ¯çš„è¡¨ç¤ºï¼ŒåŒæ—¶æŠ›å¼ƒé€šé“ç‰¹å®šçš„æ— ç”¨å› ç´ ï¼ˆå¦‚å™ªå£°ï¼‰ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨å¯¹æ¯”å­¦ä¹ æ–¹æ³•ï¼Œå­¦ä¹ ä¸€ä¸ªç‰¹å¾åµŒå…¥ï¼Œä½¿å¾—åŒä¸€åœºæ™¯çš„ä¸åŒè§†è§’æ˜ å°„åˆ°ç›¸é‚»çš„ç‚¹ï¼ˆåœ¨è¡¨ç¤ºç©ºé—´ä¸­ç”¨æ¬§å‡ é‡Œå¾—è·ç¦»æµ‹é‡ï¼‰ï¼Œè€Œä¸åŒåœºæ™¯çš„è§†è§’æ˜ å°„åˆ°ç›¸è·é¥è¿œçš„ç‚¹ã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬æ”¹è¿›äº†æœ€è¿‘æå‡ºçš„å¯¹æ¯”é¢„æµ‹ç¼–ç ï¼ˆContrastive Predictive Codingï¼ŒCPCï¼‰æ–¹æ³•[57]ï¼Œå»é™¤äº†é€’å½’ç½‘ç»œçš„éƒ¨åˆ†ï¼Œå¹¶å°†å…¶æ¨å¹¿åˆ°ä»»æ„å›¾åƒé€šé“é›†åˆï¼Œè€Œéä»…é™äºæ—¶åºæˆ–ç©ºé—´é¢„æµ‹ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºå¯¹æ¯”å¤šè§†è§’ç¼–ç ï¼ˆContrastive Multiview Codingï¼ŒCMCï¼‰ï¼Œå°½ç®¡æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬çš„å…¬å¼ä¸å®ä¾‹åˆ¤åˆ«å¼[79] ä¹Ÿæœ‰å¾ˆå¤§å…³ç³»ã€‚æˆ‘ä»¬å…¬å¼ä¸­çš„å¯¹æ¯”ç›®æ ‡ä¸ CPC å’Œå®ä¾‹åˆ¤åˆ«å¼ä¸€æ ·ï¼Œå¯ä»¥ç†è§£ä¸ºè¯•å›¾æœ€å¤§åŒ–æ•°æ®å¤šä¸ªè§†è§’è¡¨ç¤ºä¹‹é—´çš„äº’ä¿¡æ¯ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d5826f3f-2acb-4f14-a9ab-ed8955cd90f5-2"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d5826f3f-2acb-4f14-a9ab-ed8955cd90f5-3"><p>æœ¬æ®µä»‹ç»äº†ä½œè€…çš„ç›®æ ‡ï¼Œå³å­¦ä¹ å¤šä¸ªä¼ æ„Ÿé€šé“ä¹‹é—´å…±äº«ä¿¡æ¯çš„ç´§å‡‘è¡¨ç¤ºï¼Œå¹¶æŠ›å¼ƒé€šé“ç‰¹å®šçš„æ— ç”¨å› ç´ ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä½œè€…é‡‡ç”¨å¯¹æ¯”å­¦ä¹ æ–¹æ³•ï¼Œå­¦ä¹ ä¸€ä¸ªç‰¹å¾åµŒå…¥ï¼Œä½¿å¾—åŒä¸€åœºæ™¯çš„ä¸åŒè§†è§’æ˜ å°„åˆ°ç›¸é‚»çš„ç‚¹ï¼Œè€Œä¸åŒåœºæ™¯çš„è§†è§’æ˜ å°„åˆ°ç›¸è·é¥è¿œçš„ç‚¹ã€‚ä½œè€…æ”¹è¿›äº†æœ€è¿‘æå‡ºçš„å¯¹æ¯”é¢„æµ‹ç¼–ç æ–¹æ³•ï¼Œå¹¶å°†å…¶æ¨å¹¿åˆ°ä»»æ„å›¾åƒé€šé“é›†åˆï¼Œç§°ä¹‹ä¸ºå¯¹æ¯”å¤šè§†è§’ç¼–ç ã€‚ä½œè€…è¿˜æåˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¸å®ä¾‹åˆ¤åˆ«å¼ä¹Ÿæœ‰å¾ˆå¤§å…³ç³»ï¼Œå…¶å¯¹æ¯”ç›®æ ‡å¯ä»¥ç†è§£ä¸ºè¯•å›¾æœ€å¤§åŒ–æ•°æ®å¤šä¸ªè§†è§’è¡¨ç¤ºä¹‹é—´çš„äº’ä¿¡æ¯ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tabs" id="42284e68-1044-410d-94bb-d148db3bbad1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#42284e68-1044-410d-94bb-d148db3bbad1-1"><i class="fas fa-cat"></i>ç¿»è¯‘</button></li><li class="tab"><button type="button" data-href="#42284e68-1044-410d-94bb-d148db3bbad1-2"><i class="fas fa-dove"></i>åŸæ–‡</button></li><li class="tab"><button type="button" data-href="#42284e68-1044-410d-94bb-d148db3bbad1-3"><i class="fas fa-horse"></i>åˆ†æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="42284e68-1044-410d-94bb-d148db3bbad1-1"><p>æˆ‘ä»¬æœ‰æ„åœ°å°†â€œå¥½çš„ä½â€ï¼ˆgood bitsï¼‰çš„å®šä¹‰ä¿æŒå®½æ³›ï¼Œå¹¶å°†å…¶å®šä¹‰ä½œä¸ºä¸€ä¸ªç»éªŒé—®é¢˜ã€‚æœ€ç»ˆçš„è¯æ˜åœ¨äºå®è·µï¼šæˆ‘ä»¬è®¤ä¸ºï¼Œå¦‚æœä¸€ç§è¡¨ç¤ºèƒ½å¤Ÿä½¿å¾—åç»­çš„é—®é¢˜è§£å†³æ›´å®¹æ˜“ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå¥½çš„è¡¨ç¤ºï¼Œå› ä¸ºè¿™äº›é—®é¢˜æ˜¯ä¸äººç±»åˆ©ç›Šç›¸å…³çš„ã€‚ä¾‹å¦‚ï¼Œå›¾åƒçš„æœ‰ç”¨è¡¨ç¤ºå¯èƒ½æ˜¯ä¸€ä¸ªç‰¹å¾ç©ºé—´ï¼Œåœ¨è¿™ä¸ªç‰¹å¾ç©ºé—´ä¸­å®¹æ˜“å­¦ä¹ è¯†åˆ«å¯¹è±¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡æµ‹è¯•å­¦ä¹ åˆ°çš„è¡¨ç¤ºæ˜¯å¦èƒ½å¤Ÿå¾ˆå¥½åœ°è½¬ç§»åº”ç”¨äºæ ‡å‡†çš„è¯­ä¹‰è¯†åˆ«ä»»åŠ¡æ¥è¯„ä¼°æˆ‘ä»¬çš„æ–¹æ³•ã€‚åœ¨å‡ ä¸ªåŸºå‡†ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨è‡ªç›‘ç£è¡¨ç¤ºå­¦ä¹ æ–¹é¢çš„è¡¨ç°ä¸æœ€å…ˆè¿›çš„æ–¹æ³•ç›¸æ¯”å…·æœ‰ç«äº‰åŠ›ã€‚æˆ‘ä»¬è¿˜å‘ç°ï¼Œè¡¨ç¤ºçš„è´¨é‡éšç€è®­ç»ƒæ‰€ç”¨çš„è§†è§’æ•°é‡çš„å¢åŠ è€Œæé«˜ã€‚æœ€åï¼Œæˆ‘ä»¬å°†å¤šè§†å›¾å­¦ä¹ çš„å¯¹æ¯”å…¬å¼ä¸æœ€è¿‘æµè¡Œçš„äº¤å‰è§†å›¾é¢„æµ‹æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œå‘ç°åœ¨æ¯”è¾ƒä¸­ï¼Œå¯¹æ¯”æ–¹æ³•å­¦ä¹ åˆ°äº†æ›´å¼ºçš„è¡¨ç¤ºã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="42284e68-1044-410d-94bb-d148db3bbad1-2"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="42284e68-1044-410d-94bb-d148db3bbad1-3"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    
    <summary type="html">è®¡ç®—æœºå­¦ä¹ è®ºæ–‡æ±‡æŠ¥</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>MySQLé”</title>
    <link href="https://wuwawawa.github.io/posts/d940f18d.html"/>
    <id>https://wuwawawa.github.io/posts/d940f18d.html</id>
    <published>2023-04-17T09:39:07.000Z</published>
    <updated>2023-04-18T06:31:27.167Z</updated>
    
    <content type="html"><![CDATA[<p><code>é”</code>æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹<code>å¹¶å‘è®¿é—®æŸä¸€èµ„æº</code>çš„æœºåˆ¶ã€‚åœ¨ç¨‹åºå¼€å‘ä¸­ä¼šå­˜åœ¨å¤šçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ä¸€äº›æ•æ„Ÿçš„æ•°æ®ï¼ˆæ¯”å¦‚è®¢å•ã€é‡‘é¢ç­‰ï¼‰ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¿è¯è¿™ä¸ªæ•°æ®åœ¨ä»»ä½•æ—¶åˆ»<code>æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹</code>åœ¨è®¿é—®ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­åŠ é”æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¿™ä¸ªæ€æƒ³åœ¨æ•°æ®åº“é¢†åŸŸä¸­åŒæ ·å¾ˆé‡è¦ã€‚</p><p>åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€RAMã€I/Oç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„ èµ„æºã€‚ä¸ºä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦å¯¹<code>å¹¶å‘æ“ä½œè¿›è¡Œæ§åˆ¶</code>ï¼Œå› æ­¤äº§ç”Ÿäº†<code>é”</code>ã€‚åŒæ—¶<code>é”æœºåˆ¶</code>ä¹Ÿä¸ºå®ç°MySQL çš„å„ä¸ªéš”ç¦»çº§åˆ«æä¾›äº†ä¿è¯ã€‚<code>é”å†²çª</code>ä¹Ÿæ˜¯å½±å“æ•°æ®åº“<code>å¹¶å‘è®¿é—®æ€§èƒ½</code>çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚æ‰€ä»¥é”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p><hr><h2 id="1-MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•">1. MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•</h2><p>å¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•çš„æƒ…å†µå¤§è‡´å¯ä»¥åˆ’åˆ†ä¸º3ç§ï¼š</p><h3 id="1-1-è¯»-è¯»æƒ…å†µ">1.1 è¯»-è¯»æƒ…å†µ</h3><p><code>è¯»-è¯»</code>æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§<code>è¯»å–ç›¸åŒçš„è®°å½•</code>ã€‚è¯»å–æ“ä½œæœ¬èº«ä¸ä¼šå¯¹è®°å½•æœ‰ä»»ä½•å½±å“ï¼Œå¹¶ä¸ä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥å…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚</p><h3 id="1-2-å†™-å†™æƒ…å†µ">1.2 å†™-å†™æƒ…å†µ</h3><p><code>å†™-å†™</code>æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§å¯¹ç›¸åŒçš„è®°å½•åšå‡ºæ”¹åŠ¨ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿ<code>è„å†™</code>çš„é—®é¢˜ï¼Œä»»ä½•ä¸€ç§éš”ç¦»çº§åˆ«éƒ½ä¸å…è®¸è¿™ç§é—®é¢˜çš„å‘ç”Ÿã€‚æ‰€ä»¥åœ¨å¤šä¸ªæœªæäº¤äº‹åŠ¡ç›¸ç»§å¯¹ä¸€æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œéœ€è¦è®©å®ƒä»¬<code>æ’é˜Ÿæ‰§è¡Œ</code>ï¼Œè¿™ä¸ªæ’é˜Ÿçš„è¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡<code>é”</code>æ¥å®ç°çš„ã€‚è¿™ä¸ªæ‰€è°“çš„é”å…¶å®æ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„ç»“æ„ ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œå‰æœ¬æ¥æ˜¯æ²¡æœ‰é”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹æ˜¯æ²¡æœ‰<code>é”ç»“æ„</code>å’Œ<code>è®°å½•</code>è¿›è¡Œå…³è”çš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711181120639.png" alt="image-20220711181120639"></p><p>å½“ä¸€ä¸ªäº‹åŠ¡æƒ³å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šçœ‹çœ‹å†…å­˜ä¸­æœ‰æ²¡æœ‰ä¸è¿™æ¡è®°å½•å…³è”çš„<code>é”ç»“æ„</code>ï¼Œå½“æ²¡æœ‰çš„æ—¶å€™ å°±ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ª<code>é”ç»“æ„</code>ä¸ä¹‹å…³è”ã€‚æ¯”å¦‚ï¼Œäº‹åŠ¡<code>T1</code>è¦å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨ï¼Œå°±éœ€è¦ç”Ÿæˆä¸€ä¸ª<code>é”ç»“æ„</code>ä¸ä¹‹å…³è”ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711192633239.png" alt="image-20220711192633239" style="zoom:67%;" /><p>åœ¨<code>é”ç»“æ„</code>é‡Œæœ‰å¾ˆå¤šä¿¡æ¯ï¼Œä¸ºäº†ç®€åŒ–ç†è§£ï¼ŒåªæŠŠä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„å±æ€§æ‹¿äº†å‡ºæ¥ï¼š</p><p>*<code>trxä¿¡æ¯</code>ï¼šä»£è¡¨è¿™ä¸ªé”ç»“æ„æ˜¯å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ã€‚<br>*<code>is_waiting</code>ï¼šä»£è¡¨å½“å‰äº‹åŠ¡æ˜¯å¦åœ¨ç­‰å¾…ã€‚</p><p>åœ¨äº‹åŠ¡<code>T1</code>æ”¹åŠ¨äº†è¿™æ¡è®°å½•åï¼Œå°±ç”Ÿæˆäº†ä¸€ä¸ª<code>é”ç»“æ„</code>ä¸è¯¥è®°å½•å…³è”ï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡ä¸ºè¿™æ¡è®°å½•åŠ é”ï¼Œæ‰€ä»¥<code>is_waiting</code>å±æ€§å°±æ˜¯<code>false</code>ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å°±ç§°å€¼ä¸º<code>è·å–é”æˆåŠŸ</code>ï¼Œæˆ–è€…<code>åŠ é”æˆåŠŸ</code>ï¼Œç„¶åå°±å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œäº†ã€‚</p><p>åœ¨äº‹åŠ¡<code>T1</code>æäº¤ä¹‹å‰ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡<code>T2</code>ä¹Ÿæƒ³å¯¹è¯¥è®°å½•åšæ”¹åŠ¨ï¼Œé‚£ä¹ˆå…ˆçœ‹çœ‹æœ‰æ²¡æœ‰<code>é”ç»“æ„</code>ä¸è¿™æ¡è®°å½•å…³è”ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>é”ç»“æ„</code>ä¸ä¹‹å…³è”åï¼Œç„¶åä¹Ÿç”Ÿæˆäº†ä¸€ä¸ªé”ç»“æ„ä¸è¿™æ¡è®°å½•å…³è”ï¼Œä¸è¿‡é”ç»“æ„çš„<code>is_waiting</code>å±æ€§å€¼ä¸º<code>true</code>ï¼Œè¡¨ç¤ºå½“å‰äº‹åŠ¡éœ€è¦ç­‰å¾…ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å°±ç§°ä¹‹ä¸º<code>è·å–é”å¤±è´¥</code>ï¼Œæˆ–è€…<code>åŠ é”å¤±è´¥</code>ï¼Œå›¾ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711193732567.png" alt="image-20220711193732567" style="zoom:50%;" /><p>åœ¨äº‹åŠ¡T1æäº¤ä¹‹åï¼Œå°±ä¼šæŠŠè¯¥äº‹åŠ¡ç”Ÿæˆçš„<code>é”ç»“æ„é‡Šæ”¾</code>æ‰ï¼Œç„¶åçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡åœ¨ç­‰å¾…è·å–é”ï¼Œå‘ç°äº†äº‹åŠ¡T2è¿˜åœ¨ç­‰å¾…è·å–é”ï¼Œæ‰€ä»¥æŠŠäº‹åŠ¡T2å¯¹åº”çš„é”ç»“æ„çš„<code>is_waiting</code>å±æ€§è®¾ç½®ä¸º<code>false</code>ï¼Œç„¶åæŠŠè¯¥äº‹åŠ¡å¯¹åº”çš„çº¿ç¨‹å”¤é†’ï¼Œè®©å®ƒç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶äº‹åŠ¡T2å°±ç®—è·å–åˆ°é”äº†ã€‚æ•ˆæœå°±æ˜¯è¿™æ ·ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711194904328.png" alt="image-20220711194904328" style="zoom:50%;" /><p>å°ç»“å‡ ç§è¯´æ³•ï¼š</p><ul><li><p>ä¸åŠ é”</p><p>æ„æ€å°±æ˜¯ä¸éœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆå¯¹åº”çš„<code>é”ç»“æ„</code>ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œæ“ä½œã€‚</p></li><li><p>è·å–é”æˆåŠŸï¼Œæˆ–è€…åŠ é”æˆåŠŸ</p><p>æ„æ€å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†å¯¹åº”çš„<code>é”ç»“æ„</code>ï¼Œè€Œä¸”é”ç»“æ„çš„<code>is_waiting</code>å±æ€§ä¸º<code>false</code>ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚</p></li><li><p>è·å–é”å¤±è´¥ï¼Œæˆ–è€…åŠ é”å¤±è´¥ï¼Œæˆ–è€…æ²¡æœ‰è·å–åˆ°é”</p><p>æ„æ€å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†å¯¹åº”çš„<code>é”ç»“æ„</code>ï¼Œä¸è¿‡é”ç»“æ„çš„<code>is_waiting</code>å±æ€§ä¸º<code>true</code>ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ éœ€è¦ç­‰å¾…ï¼Œä¸å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚</p></li></ul><h3 id="1-3-è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ">1.3 è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ</h3><p><code>è¯»-å†™</code>æˆ–<code>å†™-è¯»</code>ï¼Œå³ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªè¿›è¡Œæ”¹åŠ¨æ“ä½œã€‚è¿™ç§æƒ…å†µä¸‹å¯èƒ½å‘ç”Ÿ<code>è„è¯» ã€ä¸å¯é‡å¤è¯» ã€å¹»è¯»</code>çš„é—®é¢˜ã€‚</p><p>å„ä¸ªæ•°æ®åº“å‚å•†å¯¹<code>SQLæ ‡å‡†</code>çš„æ”¯æŒéƒ½å¯èƒ½ä¸ä¸€æ ·ã€‚æ¯”å¦‚MySQLåœ¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«ä¸Šå°±å·²ç»è§£å†³äº†<code>å¹»è¯»</code>é—®é¢˜ã€‚</p><h3 id="1-4-å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ">1.4 å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</h3><p>æ€ä¹ˆè§£å†³<code>è„è¯» ã€ä¸å¯é‡å¤è¯» ã€å¹»è¯»</code>è¿™äº›é—®é¢˜å‘¢ï¼Ÿå…¶å®æœ‰ä¸¤ç§å¯é€‰çš„è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>æ–¹æ¡ˆä¸€ï¼šè¯»æ“ä½œåˆ©ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ<code>MVCC</code>ï¼Œä¸‹ç« è®²è§£ï¼‰ï¼Œå†™æ“ä½œè¿›è¡Œ<code>åŠ é”</code>ã€‚</p><p>æ‰€è°“çš„<code>MVCC</code>ï¼Œå°±æ˜¯ç”Ÿæˆä¸€ä¸ª<code>ReadView</code>ï¼Œé€šè¿‡Readviewæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•ç‰ˆæœ¬ï¼ˆå†å²ç‰ˆæœ¬ç”±<code>undoæ—¥å¿—</code>æ„å»ºï¼‰ã€‚æŸ¥è¯¢è¯­å¥åªèƒ½<code>è¯»</code>åˆ°åœ¨ç”ŸæˆReadViewä¹‹å‰<code>å·±æäº¤äº‹åŠ¡æ‰€åšçš„æ›´æ”¹</code>ï¼Œåœ¨ç”ŸæˆReadViewä¹‹å‰æœªæäº¤çš„äº‹åŠ¡æˆ–è€…ä¹‹åæ‰å¼€å¯çš„äº‹åŠ¡æ‰€åšçš„æ›´æ”¹æ˜¯çœ‹ä¸åˆ°çš„ã€‚è€Œ<code>å†™æ“ä½œ</code>è‚¯å®šé’ˆå¯¹çš„æ˜¯<code>æœ€æ–°ç‰ˆæœ¬çš„è®°å½•</code>ï¼Œè¯»è®°å½•çš„å†å²ç‰ˆæœ¬å’Œæ”¹åŠ¨è®°å½•çš„æœ€æ–°ç‰ˆæœ¬æœ¬èº«å¹¶ä¸å†²çªï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨MVCCæ—¶ï¼Œ<code>è¯»-å†™</code>æ“ä½œå¹¶ä¸å†²çªã€‚</p></li></ul><blockquote><p>æ™®é€šçš„SELECTè¯­å¥åœ¨READ COMMITTEDå’ŒREPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ä¼šä½¿ç”¨åˆ°MVCCè¯»å–è®°å½•ã€‚</p><ul><li>åœ¨<code>READ COMMITTED</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯æ¬¡æ‰§è¡ŒSELECTæ“ä½œæ—¶éƒ½ä¼šç”Ÿæˆä¸€ ä¸ªReadViewï¼ŒReadViewçš„å­˜åœ¨æœ¬èº«å°±ä¿è¯äº†<code>äº‹åŠ¡ä¸å¯ä»¥è¯»å–åˆ°æœªæäº¤çš„äº‹åŠ¡æ‰€åšçš„æ›´æ”¹</code>ï¼Œä¹Ÿå°±æ˜¯é¿å…äº†è„è¯»ç°è±¡ï¼›</li><li>åœ¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åªæœ‰<code>ç¬¬ä¸€æ¬¡æ‰§è¡ŒSELECTæ“ä½œ</code>æ‰ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„SELECTæ“ä½œéƒ½<code>å¤ç”¨</code>è¿™ä¸ªReadViewï¼Œè¿™æ ·ä¹Ÿå°±é¿å…äº†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜ã€‚</li></ul></blockquote><ul><li><p>æ–¹æ¡ˆäºŒï¼šè¯»ã€å†™æ“ä½œéƒ½é‡‡ç”¨<code>åŠ é”</code>çš„æ–¹å¼ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸å…è®¸è¯»å–è®°å½•çš„æ—§ç‰ˆæœ¬ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½å¿…é¡»å»<code>è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬</code>ã€‚æ¯”å¦‚ï¼Œåœ¨é“¶è¡Œå­˜æ¬¾çš„äº‹åŠ¡ä¸­ï¼Œä½ éœ€è¦å…ˆæŠŠè´¦æˆ·çš„ä½™é¢è¯»å‡ºæ¥ï¼Œç„¶åå°†å…¶åŠ ä¸Šæœ¬æ¬¡å­˜æ¬¾çš„æ•°é¢ï¼Œæœ€åå†å†™åˆ°æ•°æ®åº“ä¸­ã€‚åœ¨å°†è´¦æˆ·ä½™é¢è¯»å–å‡ºæ¥åï¼Œå°±ä¸æƒ³è®©åˆ«çš„äº‹åŠ¡å†è®¿é—®è¯¥ä½™é¢ï¼Œç›´åˆ°æœ¬æ¬¡å­˜æ¬¾äº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œå…¶ä»–äº‹åŠ¡æ‰å¯ä»¥è®¿é—®è´¦æˆ·çš„ä½™é¢ã€‚è¿™æ ·åœ¨è¯»å–è®°å½•çš„æ—¶å€™å°±éœ€è¦å¯¹å…¶è¿›è¡Œ<code>åŠ é”</code>æ“ä½œï¼Œè¿™æ ·ä¹Ÿå°±æ„å‘³ç€<code>è¯»æ“ä½œ</code>å’Œ<code>å†™æ“ä½œ</code>ä¹Ÿåƒå†™-å†™æ“ä½œé‚£æ ·æ’é˜Ÿæ‰§è¡Œã€‚</p></li></ul><p><code>è„è¯»</code>çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡å†™çš„ä¸€æ¡è®°å½•ï¼Œå¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡åœ¨å†™è®°å½•çš„æ—¶å€™å°±ç»™è¿™æ¡è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡å°±æ— æ³•ç»§ç»­è¯»å–è¯¥è®°å½•äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šæœ‰è„è¯»é—®é¢˜çš„äº§ç”Ÿäº†ã€‚</p><p><code>ä¸å¯é‡å¤è¯»</code>çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡å…ˆè¯»å–ä¸€æ¡è®°å½•ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯¹è¯¥è®°å½•åšäº†æ”¹åŠ¨ä¹‹åå¹¶æäº¤ä¹‹åï¼Œå½“å‰äº‹åŠ¡å†æ¬¡è¯»å–æ—¶ä¼šè·å¾—ä¸åŒçš„å€¼ï¼Œå¦‚æœåœ¨å½“å‰äº‹åŠ¡è¯»å–è®°å½•æ—¶å°±ç»™è¯¥è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡å°±æ— æ³•ä¿®æ”¹è¯¥è®°å½•ï¼Œ è‡ªç„¶ä¹Ÿä¸ä¼šå‘ç”Ÿä¸å¯é‡å¤è¯»äº†ã€‚</p><p><code>å¹»è¯»</code>é—®é¢˜çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡è¯»å–äº†ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œç„¶åå¦å¤–çš„äº‹åŠ¡å‘è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°è®°å½•ï¼Œå½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è¯¥èŒƒå›´çš„è®°å½•æ—¶å‘ç°äº†æ–°æ’å…¥çš„æ–°è®°å½•ã€‚é‡‡ç”¨åŠ é”çš„æ–¹å¼è§£å†³å¹»è¯»é—®é¢˜å°±æœ‰ä¸€äº›éº»çƒ¦ï¼Œå› ä¸ºå½“å‰äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡è¯»å–è®°å½•æ—¶å¹»å½±è®°å½•å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¯»å–çš„æ—¶å€™åŠ é”å°±æœ‰ç‚¹å°´å°¬ï¼ˆå› ä¸ºä½ å¹¶ä¸çŸ¥é“ç»™è°åŠ é”ï¼‰</p><ul><li><p>å°ç»“å¯¹æ¯”å‘ç°ï¼š</p><ul><li>é‡‡ç”¨<code>MVCC</code>æ–¹å¼çš„è¯ï¼Œ è¯»-å†™æ“ä½œå½¼æ­¤å¹¶ä¸å†²çªï¼Œ æ€§èƒ½æ›´é«˜ ã€‚</li><li>é‡‡ç”¨<code>åŠ é”</code>æ–¹å¼çš„è¯ï¼Œ è¯»-å†™æ“ä½œå½¼æ­¤éœ€è¦<code>æ’é˜Ÿæ‰§è¡Œ</code>ï¼Œå½±å“æ€§èƒ½ã€‚</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å½“ç„¶æ„¿æ„é‡‡ç”¨<code>MVCC</code>æ¥è§£å†³<code>è¯»-å†™</code>æ“ä½œå¹¶å‘æ‰§è¡Œçš„é—®é¢˜ï¼Œä½†æ˜¯ä¸šåŠ¡åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¦æ±‚å¿…é¡»é‡‡ç”¨<code>åŠ é”</code>çš„æ–¹å¼æ‰§è¡Œã€‚ä¸‹é¢å°±è®²è§£ä¸‹MySQLä¸­ä¸åŒç±»åˆ«çš„é”ã€‚</p></li></ul><hr><h2 id="2-é”çš„ä¸åŒè§’åº¦åˆ†ç±»">2. é”çš„ä¸åŒè§’åº¦åˆ†ç±»</h2><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711203519162.png" alt="image-20220711203519162" style="zoom: 67%;" /><hr><h2 id="3-è¯»é”-å†™é”">3. è¯»é”/å†™é”</h2><blockquote><mark class="hl-label green">ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†ï¼šè¯»é”ã€å†™é”</mark> </blockquote><p>å¯¹äºæ•°æ®åº“ä¸­å¹¶å‘äº‹åŠ¡çš„<code>è¯»-è¯»</code>æƒ…å†µå¹¶ä¸ä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜ã€‚å¯¹äº<code>å†™-å†™</code>ã€<code>è¯»-å†™</code>æˆ–<code>å†™-è¯»</code>è¿™äº›æƒ…å†µå¯èƒ½ä¼šå¼•èµ·ä¸€äº›é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨<code>MVCC</code>æˆ–è€…<code>åŠ é”</code>çš„æ–¹å¼æ¥è§£å†³å®ƒä»¬ã€‚åœ¨ä½¿ç”¨<code>åŠ é”</code>çš„æ–¹å¼è§£å†³é—®é¢˜æ—¶ï¼Œç”±äºæ—¢è¦å…è®¸<code>è¯»-è¯»</code>æƒ…å†µä¸å—å½±å“ï¼Œåˆè¦ä½¿<code>å†™-å†™</code>ã€<code>è¯»-å†™</code>æˆ–<code>å†™-è¯»</code>æƒ…å†µä¸­çš„æ“ä½œç›¸äº’é˜»å¡ï¼Œæ‰€ä»¥MySQLå®ç°ä¸€ä¸ªç”±ä¸¤ç§ç±»å‹çš„é”ç»„æˆçš„é”ç³»ç»Ÿæ¥è§£å†³ã€‚è¿™ä¸¤ç§ç±»å‹çš„é”é€šå¸¸è¢«ç§°ä¸º<span class='p red'>å…±äº«é” Shared Lock</span>å’Œ<span class='p green'>æ’ä»–é” Exclusive Lock</span>ä¹Ÿå«<span class='p red'>è¯»é” readlock</span>å’Œ<span class='p green'>å†™é” write lock</span></p><p>*<code>è¯»é”</code>ï¼šä¹Ÿç§°ä¸º<code>å…±äº«é”</code>ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚<br>*<code>å†™é”</code>ï¼šä¹Ÿç§°ä¸º<code>æ’ä»–é”</code>ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ · å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚</p><span class='p blue'>éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºInnoDBå¼•æ“æ¥è¯´ï¼Œè¯»é”å’Œå†™é”å¯ä»¥åŠ åœ¨è¡¨ä¸Šï¼Œä¹Ÿå¯ä»¥åŠ åœ¨è¡Œä¸Šã€‚</span><br/><p>ä¸¾ä¾‹è¡Œçº§è¯»å†™é” ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡T1å·²ç»è·å¾—äº†æŸä¸ªè¡Œrçš„è¯»é”ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦å¤–çš„ä¸€ä¸ªäº‹åŠ¡ T2 æ˜¯å¯ä»¥å»è·å¾—è¿™ä¸ªè¡Œrçš„è¯»é”çš„ï¼Œå› ä¸ºè¯»å–æ“ä½œå¹¶æ²¡æœ‰æ”¹å˜è¡Œrçš„æ•°æ®ï¼›ä½†æ˜¯ï¼Œå¦‚æœæŸä¸ªäº‹åŠ¡ T3 æƒ³è·å¾—è¡Œrçš„å†™é”ï¼Œåˆ™å®ƒå¿…é¡»ç­‰å¾…äº‹åŠ¡ T1ã€T2é‡Šæ”¾æ‰è¡Œrä¸Šçš„è¯»é”æ‰è¡Œã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">å†™é”</th><th style="text-align:center">è¯»é”</th></tr></thead><tbody><tr><td style="text-align:center">å†™</td><td style="text-align:center">ä¸å…¼å®¹</td><td style="text-align:center">ä¸å…¼å®¹</td></tr><tr><td style="text-align:center">è¯»é”</td><td style="text-align:center">ä¸å…¼å®¹</td><td style="text-align:center">å…¼å®¹</td></tr></tbody></table><p>æ€»ç»“ï¼šè¿™é‡Œçš„å…¼å®¹æ˜¯æŒ‡å¯¹åŒä¸€å¼ è¡¨æˆ–è®°å½•çš„é”çš„å…¼å®¹æ€§æƒ…å†µã€‚</p><hr><mark class="hl-label pink">é”å®šè¯»</mark> <p>åœ¨é‡‡ç”¨<code>åŠ é”</code>æ–¹å¼è§£å†³<code>è„è¯»</code>ã€<code>ä¸å¯é‡å¤è¯»</code>ã€<code>å¹»è¯»</code>è¿™äº›é—®é¢˜æ—¶ï¼Œè¯»å–ä¸€æ¡è®°å½•æ—¶éœ€è¦è·å–è¯¥è®°å½•çš„<code>Sé”</code>ï¼Œå…¶å®æ˜¯ä¸ä¸¥è°¨çš„ï¼Œæœ‰æ—¶å€™éœ€è¦åœ¨è¯»å–è®°å½•æ—¶å°±è·å–è®°å½•çš„<code>Xé”</code>ï¼Œæ¥ç¦æ­¢åˆ«çš„äº‹åŠ¡è¯»å†™è¯¥è®°å½•ï¼Œä¸ºæ­¤MySQLæå‡ºäº†ä¸¤ç§æ¯”è¾ƒç‰¹æ®Šçš„<code>SELECT</code>è¯­å¥æ ¼å¼ï¼š</p><ul><li>å¯¹è¯»å–çš„è®°å½•åŠ <code>Sé”</code>ï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line">#æˆ–</span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> SHARE; #(<span class="number">8.0</span>æ–°å¢è¯­æ³•)</span><br></pre></td></tr></table></figure><p>åœ¨æ™®é€šçš„<code>SELECT</code>è¯­å¥åè¾¹åŠ <code>LOCK IN SHARE MODE</code>ï¼Œå¦‚æœå½“å‰äº‹åŠ¡æ‰§è¡Œäº†è¯¥è¯­å¥ï¼Œé‚£ä¹ˆå®ƒä¼šä¸ºè¯»å–åˆ°çš„è®°å½•åŠ <code>Sé”</code>ï¼Œè¿™æ ·å…è®¸åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¿™äº›è®°å½•çš„<code>Sé”</code>ï¼ˆæ¯”æ–¹è¯´åˆ«çš„äº‹åŠ¡ä¹Ÿä½¿ç”¨ SELECT â€¦ LOCK IN SHARE MODE è¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼‰ï¼Œä½†æ˜¯ä¸èƒ½è·å–è¿™äº›è®°å½•çš„<code>Xé”</code>ï¼ˆæ¯”å¦‚ä½¿ç”¨<code>SELECT .... FOR UPDATE</code>è¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹è¿™äº›è®°å½•ï¼‰ã€‚å¦‚æœåˆ«çš„äº‹åŠ¡æƒ³è¦è·å–è¿™äº›è®°å½•çš„<code>Xé”</code>ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰äº‹åŠ¡æäº¤ä¹‹åå°†è¿™äº›è®°å½•ä¸Šçš„<code>Sé”</code>é‡Šæ”¾æ‰ã€‚</p><ul><li>å¯¹è¯»å–çš„è®°å½•åŠ <code>Xé”</code>ï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>åœ¨æ™®é€šçš„<code>SELECT</code>è¯­å¥åè¾¹åŠ <code>FOR UPDATE</code>ï¼Œå¦‚æœå½“å‰äº‹åŠ¡æ‰§è¡Œäº†è¯¥è¯­å¥ï¼Œé‚£ä¹ˆå®ƒä¼šä¸ºè¯»å–åˆ°çš„è®°å½•åŠ <code>Xé”</code>ï¼Œ è¿™æ ·æ—¢ä¸å…è®¸åˆ«çš„äº‹åŠ¡è·å–è¿™äº›è®°å½•çš„<code>Sé”</code>ï¼ˆæ¯”æ–¹è¯´åˆ«çš„äº‹åŠ¡ä½¿ç”¨<code>SELECT .... LOCK IN SHARE MODE</code>è¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼‰ï¼Œä¹Ÿä¸å…è®¸è·å–è¿™äº›è®°å½•çš„<code>Xé”</code>ï¼ˆæ¯”å¦‚ä½¿ç”¨<code>SELECT ... FOR UPDATE</code>è¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹è¿™äº›è®°å½•ï¼‰ã€‚å¦‚æœåˆ«çš„äº‹åŠ¡æƒ³è¦è·å–è¿™äº›è®°å½•çš„<code>Sé”</code>æˆ–è€…<code>Xé”</code>ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰äº‹åŠ¡æäº¤ä¹‹åå°†è¿™äº›è®°å½•ä¸Šçš„<code>Xé”</code>é‡Šæ”¾æ‰ã€‚</p><span class='p red'>MySQL8.0æ–°ç‰¹æ€§</span><p>åœ¨5.7åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œ<code>SELECT ...FOR UPDATE</code>ï¼Œå¦‚æœè·å–ä¸åˆ°é”ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°<code>innodb_ lock_wait_timeout</code>è¶…æ—¶ã€‚åœ¨8.0ç‰ˆæœ¬ä¸­ï¼Œ<code>SELECT ... FOR UPDATE</code>,<code>SELECT ... FOR SHARE</code>æ·»åŠ <code>NOWAIT</code>ã€<code>SKIP LOCKED</code>è¯­æ³•ï¼Œè·³è¿‡é”ç­‰å¾…ï¼Œæˆ–è€…è·³è¿‡é”å®šã€‚</p><ul><li>é€šè¿‡æ·»åŠ NOWAITã€SKIP LOCKEDè¯­æ³•ï¼Œèƒ½å¤Ÿç«‹å³è¿”å›ã€‚å¦‚æœæŸ¥è¯¢çš„è¡Œå·²ç»åŠ é”ï¼š<ul><li>é‚£ä¹ˆNOWAITä¼šç«‹å³æŠ¥é”™è¿”å›</li><li>è€ŒSKIP LOCKEDä¹Ÿä¼šç«‹å³è¿”å›ï¼Œåªæ˜¯è¿”å›çš„ç»“æœä¸­ä¸åŒ…å«è¢«é”å®šçš„è¡Œã€‚</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># session1:</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">mysgl<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> c1 <span class="operator">=</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="operator">|</span>  c1  <span class="operator">|</span>  c2  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span>   <span class="operator">|</span> <span class="number">60530</span><span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span>   <span class="operator">|</span> <span class="number">24678</span><span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># session2:</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> c1 <span class="operator">=</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span> nowaitï¼›</span><br><span class="line">ERROR <span class="number">3572</span> (HY000): Statement aborted because lock(s) could <span class="keyword">not</span> be acquired immediately <span class="keyword">and</span> NOWAIT <span class="keyword">is</span> set.</span><br><span class="line">mysgl<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> c1 <span class="operator">=</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span> <span class="keyword">skip</span> locked;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><hr><blockquote><mark class="hl-label pink">å†™æ“ä½œ</mark> </blockquote><p>å¹³å¸¸æ‰€ç”¨åˆ°çš„å†™æ“ä½œæ— éæ˜¯<code>DELETE</code>ã€<code>UPDATE</code>ã€<code>INSERT</code>è¿™ä¸‰ç§ï¼š</p><p>-<code>DELETE</code></p><p>å¯¹ä¸€æ¡è®°å½•åšDELETEæ“ä½œçš„è¿‡ç¨‹å…¶å®æ˜¯å…ˆåœ¨<code>B+æ ‘</code>ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–è¿™æ¡è®°å½•çš„<code>Xé”</code>ï¼Œå†æ‰§è¡Œ<code>delete mark</code>æ“ä½œã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå®šä½å¾…åˆ é™¤è®°å½•åœ¨B+æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ªè·å–<code>Xé”</code>çš„<code>é”å®šè¯»</code>ã€‚</p><p>-<code>UPDATE</code>ï¼š åœ¨å¯¹ä¸€æ¡è®°å½•åšUPDATEæ“ä½œæ—¶åˆ†ä¸ºä¸‰ç§æƒ…å†µ</p><ul><li>æƒ…å†µ1ï¼šæœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œå¹¶ä¸”è¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨ä¿®æ”¹å‰åæœªå‘ç”Ÿå˜åŒ–ã€‚åˆ™å…ˆåœ¨<code>B+æ ‘</code>ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åå†è·å–ä¸€ä¸‹è®°å½•çš„<code>Xé”</code>ï¼Œæœ€ååœ¨åŸè®°å½•çš„ä½ç½®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå®šä½å¾…ä¿®æ”¹è®°å½•åœ¨B+ æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ªè·å–<code>Xé”</code>çš„<code>é”å®šè¯»</code>ã€‚</li><li>æƒ…å†µ2ï¼šæœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªè¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨ä¿®æ”¹å‰åå‘ç”Ÿå˜åŒ–ã€‚åˆ™å…ˆåœ¨<code>B+æ ‘</code>ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–ä¸€ä¸‹è®°å½•çš„<code>Xé”</code>ï¼Œå°†è¯¥è®°å½•å½»åº•åˆ é™¤æ‰ï¼ˆå°±æ˜¯æŠŠè®°å½•å½»åº•ç§»å…¥åƒåœ¾é“¾è¡¨ï¼‰ï¼Œæœ€åå†æ’å…¥ä¸€æ¡æ–°è®°å½•ã€‚è¿™ä¸ªå®šä½å¾…ä¿®æ”¹è®°å½•åœ¨B+ æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ªè·å–ã€‰ é”çš„é”å®šè¯»ï¼Œæ–°æ’å…¥çš„è®°å½•ç”±<code>INSERT</code>æ“ä½œæä¾›çš„<code>éšå¼é”</code>è¿›è¡Œä¿æŠ¤ã€‚</li><li>æƒ…å†µ3ï¼šä¿®æ”¹äº†è¯¥è®°å½•çš„å¥å€¼ï¼Œåˆ™ç›¸å½“äºåœ¨åŸè®°å½•ä¸Šåš<code>DELETE</code>æ“ä½œä¹‹åå†æ¥ä¸€æ¬¡<code>INSERT</code>æ“ä½œï¼ŒåŠ é”æ“ä½œå°±éœ€è¦æŒ‰ç…§<code>DELETE</code>å’Œ<code>INSERT</code>çš„è§„åˆ™è¿›è¡Œäº†ã€‚</li></ul><p>-<code>INSERT</code></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–°æ’å…¥ä¸€æ¡è®°å½•çš„æ“ä½œå¹¶ä¸åŠ é”ï¼Œé€šè¿‡ä¸€ç§ç§°ä¹‹ä¸ºéšå¼é”çš„ç»“æ„æ¥ä¿æŠ¤è¿™æ¡æ–°æ’å…¥çš„è®°å½•åœ¨æœ¬äº‹åŠ¡æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—®ã€‚</p><hr><h2 id="4-è¡¨çº§é”-é¡µçº§é”-è¡Œé”">4. è¡¨çº§é”/é¡µçº§é”/è¡Œé”</h2><blockquote><mark class="hl-label green">ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†ï¼šè¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”</mark> </blockquote><p>ä¸ºäº†å°½å¯èƒ½æé«˜æ•°æ®åº“çš„å¹¶å‘åº¦ï¼Œæ¯æ¬¡é”å®šçš„æ•°æ®èŒƒå›´è¶Šå°è¶Šå¥½ï¼Œç†è®ºä¸Šæ¯æ¬¡åªé”å®šå½“å‰æ“ä½œçš„æ•°æ®çš„æ–¹æ¡ˆä¼šå¾—åˆ°æœ€å¤§çš„å¹¶å‘åº¦ï¼Œä½†æ˜¯ç®¡ç†é”æ˜¯å¾ˆ<code>è€—èµ„æº</code>çš„äº‹æƒ…ï¼ˆæ¶‰åŠè·å–ã€æ£€æŸ¥ã€é‡Šæ”¾é”ç­‰åŠ¨ä½œï¼‰ã€‚å› æ­¤æ•°æ®åº“ç³»ç»Ÿéœ€è¦åœ¨<code>é«˜å¹¶å‘å“åº”</code>å’Œ<code>ç³»ç»Ÿæ€§èƒ½</code>ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†ï¼š<code>é”ç²’åº¦(Lock granularity)</code>çš„æ¦‚å¿µã€‚</p><p>å¯¹ä¸€æ¡è®°å½•åŠ é”å½±å“çš„ä¹Ÿåªæ˜¯è¿™æ¡è®°å½•è€Œå·²ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªé”çš„ç²’åº¦æ¯”è¾ƒç»†ï¼›å…¶å®ä¸€ä¸ªäº‹åŠ¡ä¹Ÿå¯ä»¥åœ¨<code>è¡¨çº§åˆ«</code>è¿›è¡ŒåŠ é”ï¼Œè‡ªç„¶å°±è¢«ç§°ä¹‹ä¸º<code>è¡¨çº§é”</code>æˆ–è€…<code>è¡¨é”</code>ï¼Œå¯¹ä¸€ä¸ªè¡¨åŠ é”å½±å“æ•´ä¸ªè¡¨ä¸­çš„è®°å½•ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªé”çš„ç²’åº¦æ¯”è¾ƒç²—ã€‚é”çš„ç²’åº¦ä¸»è¦åˆ†ä¸ºè¡¨çº§é”ã€é¡µçº§é”å’Œè¡Œé”ã€‚</p><hr><h3 id="4-1-è¡¨é”ï¼ˆTable-Lockï¼‰">4.1 è¡¨é”ï¼ˆTable Lockï¼‰</h3><p>è¯¥é”ä¼šé”å®šæ•´å¼ è¡¨ï¼Œå®ƒæ˜¯ MySQL ä¸­æœ€åŸºæœ¬çš„é”ç­–ç•¥ï¼Œ<code>å¹¶ä¸ä¾èµ–äºå­˜å‚¨å¼•æ“</code>ï¼ˆä¸ç®¡ä½ æ˜¯ MySQL çš„ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œ å¯¹äºè¡¨é”çš„ç­–ç•¥éƒ½æ˜¯ä¸€æ ·çš„ï¼‰ï¼Œå¹¶ä¸”è¡¨é”æ˜¯<code>å¼€é”€æœ€å°</code>çš„ç­–ç•¥ï¼ˆå› ä¸ºç²’åº¦æ¯”è¾ƒå¤§ï¼‰ã€‚ç”±äºè¡¨çº§é”ä¸€æ¬¡ä¼šå°†æ•´ä¸ªè¡¨é”å®šï¼Œæ‰€ä»¥å¯ä»¥å¾ˆå¥½çš„<code>é¿å…æ­»é”</code>é—®é¢˜ã€‚å½“ç„¶ï¼Œé”çš„ç²’åº¦å¤§æ‰€å¸¦æ¥æœ€å¤§çš„è´Ÿé¢å½±å“å°±æ˜¯å‡ºç°é”èµ„æºäº‰ç”¨çš„æ¦‚ç‡ä¹Ÿä¼šæœ€é«˜ï¼Œå¯¼è‡´<code>å¹¶å‘ç‡å¤§æ‰“æŠ˜æ‰£</code>ã€‚</p><hr><h4 id="4-1-1-è¡¨çº§åˆ«çš„Sé”ã€Xé”">4.1.1 è¡¨çº§åˆ«çš„Sé”ã€Xé”</h4><p>åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„<code>Sé”</code>æˆ–è€…<code>Xé”</code>çš„ã€‚åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡Œä¸€äº›è¯¸å¦‚<code>ALTER TABLE ã€ DROP TABLE</code>è¿™ç±»çš„ DDL è¯­å¥æ—¶ï¼Œå…¶ ä»–äº‹åŠ¡å¯¹è¿™ä¸ªè¡¨å¹¶å‘æ‰§è¡Œè¯¸å¦‚SELECTã€INSERTã€DELETEã€UPDATEçš„è¯­å¥ä¼šå‘ç”Ÿé˜»å¡ã€‚åŒç†ï¼ŒæŸä¸ªäº‹åŠ¡ä¸­å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼Œåœ¨å…¶ä»–ä¼šè¯ä¸­å¯¹è¿™ä¸ªè¡¨æ‰§è¡Œ<code>DDL</code>è¯­å¥ä¹Ÿä¼š å‘ç”Ÿé˜»å¡ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡åœ¨ serverå±‚ä½¿ç”¨ä¸€ç§ç§°ä¹‹ä¸º<code>å…ƒæ•°æ®é”</code>ï¼ˆè‹±æ–‡åï¼š Metadata Locks ï¼Œ ç®€ç§° MDL ï¼‰ç»“æ„æ¥å®ç°çš„ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨çº§åˆ«çš„<code>Sé”</code>å’Œ<code>Xé”</code>ã€‚åªä¼šåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”æ–¹è¯´<code>å´©æºƒæ¢å¤</code>è¿‡ç¨‹ä¸­ç”¨åˆ°ã€‚æ¯”å¦‚ï¼Œåœ¨ç³»ç»Ÿå˜é‡<code>autocommit=0ï¼Œinnodb_table_locks = 1</code>æ—¶ï¼Œ æ‰‹åŠ¨ è·å– InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨t çš„<code>Sé”</code>æˆ–è€…<code>Xé”</code>å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><p>*<code>LOCK TABLES t READ</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„<code>Sé”</code>ã€‚</p><p>*<code>LOCK TABLES t WRITE</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„<code>Xé”</code>ã€‚</p><p>ä¸è¿‡å°½é‡é¿å…åœ¨ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨ä¸Šä½¿ç”¨<code>LOCK TABLES</code>è¿™æ ·çš„æ‰‹åŠ¨é”è¡¨è¯­å¥ï¼Œå®ƒä»¬å¹¶ä¸ä¼šæä¾›ä»€ä¹ˆé¢å¤–çš„ä¿æŠ¤ï¼Œåªæ˜¯ä¼šé™ä½å¹¶å‘èƒ½åŠ›è€Œå·²ã€‚InnoDBçš„å‰å®³ä¹‹å¤„è¿˜æ˜¯å®ç°äº†æ›´ç»†ç²’åº¦çš„<code>è¡Œé”</code>ï¼Œå…³äº InnoDBè¡¨çº§åˆ«çš„<code>Sé”</code>å’Œ<code>Xé”</code>å¤§å®¶äº†è§£ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><mark class="hl-label blue">ä¸¾ä¾‹ï¼šä¸‹é¢æˆ‘ä»¬è®²è§£MyISAMå¼•æ“ä¸‹çš„è¡¨é”</mark>  <div class="tabs" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-1"><i class="fas fa-atom"></i>åˆ›å»ºè¡¨å¹¶æ·»åŠ æ•°æ®</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-2"><i class="far fa-sun"></i>æŸ¥çœ‹è¡¨ä¸ŠåŠ è¿‡çš„é”</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-3"><i class="fas fa-wind"></i>æ‰‹åŠ¨å¢åŠ è¡¨é”å‘½ä»¤</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-4"><i class="fas fa-fire-alt"></i>é‡Šæ”¾è¡¨é”</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-5"><i class="fas fa-heartbeat"></i>åŠ è¯»é”</button></li><li class="tab"><button type="button" data-href="#0f4dc028-1f6c-4356-9c0f-108a3a87687e-6"><i class="fas fa-cookie-bite"></i>åŠ å†™é”</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-1"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mylock(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY auto_increment,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">)ENGINE MYISAM;</span><br><span class="line"></span><br><span class="line"># æ’å…¥ä¸€æ¡æ•°æ®</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mylock(NAME) <span class="keyword">VALUES</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰æ•°æ®</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mylock;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> Name <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> a    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-2"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">OPEN</span> TABLES; # ä¸»è¦å…³æ³¨In_useå­—æ®µçš„å€¼</span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">OPEN</span> TABLES <span class="keyword">where</span> In_use <span class="operator">&gt;</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220342251.png" alt="image-20220711220342251" style="zoom: 50%;" /><p>æˆ–è€…</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220418859.png" alt="image-20220711220418859"  /><p>ä¸Šé¢çš„ç»“æœè¡¨æ˜ï¼Œå½“å‰æ•°æ®åº“ä¸­æ²¡æœ‰è¢«é”å®šçš„è¡¨</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-3"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOCK TABLES t READ; # å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨tåŠ è¡¨çº§åˆ«çš„å…±äº«é”ã€‚å…±äº«é”ä¹Ÿå«è¯»é”æˆ–Sé”ï¼ˆShareçš„ç¼©å†™ï¼‰</span><br><span class="line">LOCK TABLES t WRITE; # å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨tåŠ è¡¨çº§åˆ«çš„æ’ä»–é”ã€‚æ’ä»–é”ä¹Ÿå«ç‹¬å é”ã€å†™é”æˆ–Xé”ï¼ˆexclusiveçš„ç¼©å†™ï¼‰</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220442269.png" alt="image-20220711220442269"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-4"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNLOCK TABLES; # ä½¿ç”¨æ­¤å‘½ä»¤è§£é”å½“å‰åŠ é”çš„è¡¨</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220502141.png" alt="image-20220711220502141"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-5"><p>æˆ‘ä»¬ä¸ºmylockè¡¨åŠ readé”ï¼ˆè¯»é˜»å¡å†™ï¼‰ï¼Œè§‚å¯Ÿé˜»å¡çš„æƒ…å†µï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220553225.png" alt="image-20220711220553225" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220616537.png" alt="image-20220711220616537" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0f4dc028-1f6c-4356-9c0f-108a3a87687e-6"><p>ä¸ºmylockè¡¨åŠ writeé”ï¼Œè§‚å¯Ÿé˜»å¡çš„æƒ…å†µï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220711630.png" alt="image-20220711220711630" style="zoom:67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711220730112.png" alt="image-20220711220730112" style="zoom: 67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <mark class="hl-label blue">æ€»ç»“</mark> <p>MyISAMåœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼ˆSELECTï¼‰å‰ï¼Œä¼šç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æ“ä½œå‰ï¼Œä¼šç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ã€‚InnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„è¯»é”å’Œå†™é”çš„ã€‚</p><p>MySQLçš„è¡¨çº§é”æœ‰ä¸¤ç§æ¨¡å¼ï¼šï¼ˆä»¥MyISAMè¡¨è¿›è¡Œæ“ä½œçš„æ¼”ç¤ºï¼‰</p><ul><li><p>è¡¨å…±äº«è¯»é”ï¼ˆTable Read Lockï¼‰</p></li><li><p>è¡¨ç‹¬å å†™é”ï¼ˆTable Write Lockï¼‰</p><table><thead><tr><th style="text-align:center">é”ç±»å‹</th><th style="text-align:center">è‡ªå·±å¯è¯»</th><th style="text-align:center">è‡ªå·±å¯å†™</th><th style="text-align:center">è‡ªå·±å¯æ“ä½œå…¶ä»–è¡¨</th><th style="text-align:center">ä»–äººå¯è¯»</th><th style="text-align:center">ä»–äººå¯å†™</th></tr></thead><tbody><tr><td style="text-align:center">è¯»é”</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">å¦</td><td style="text-align:center">å¦</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">å¦ï¼Œç­‰</td></tr><tr><td style="text-align:center">å†™é”</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">å¦</td><td style="text-align:center">å¦ï¼Œç­‰</td><td style="text-align:center">å¦ï¼Œç­‰</td></tr></tbody></table></li></ul><hr><h4 id="4-1-2-æ„å‘é”-intention-lock">4.1.2 æ„å‘é”(intention lock)</h4><p>InnoDB æ”¯æŒ<code>å¤šç²’åº¦é”ï¼ˆmultiple granularity lockingï¼‰</code>ï¼Œå®ƒå…è®¸<code>è¡Œçº§é”</code>ä¸<code>è¡¨çº§é”</code>å…±å­˜ï¼Œè€Œ<code>æ„å‘é”</code>å°±æ˜¯å…¶ä¸­çš„ä¸€ç§<code>è¡¨é”</code>ã€‚</p><ol><li>æ„å‘é”çš„å­˜åœ¨æ˜¯ä¸ºäº†åè°ƒè¡Œé”å’Œè¡¨é”çš„å…³ç³»ï¼Œæ”¯æŒå¤šç²’åº¦ï¼ˆè¡¨é”å’Œè¡Œé”ï¼‰çš„é”å¹¶å­˜ã€‚</li><li>æ„å‘é”æ˜¯ä¸€ç§<code>ä¸ä¸è¡Œçº§é”å†²çªè¡¨çº§é”</code>ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</li><li>è¡¨æ˜â€œæŸä¸ªäº‹åŠ¡æ­£åœ¨æŸäº›è¡ŒæŒæœ‰äº†é”æˆ–è¯¥äº‹åŠ¡å‡†å¤‡å»æŒæœ‰é”â€</li></ol><p>æ„å‘é”åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>æ„å‘å…±äº«é”ï¼ˆintention shared lock, ISï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ å…±äº«é”ï¼ˆSé”ï¼‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span> <span class="keyword">FROM</span> <span class="keyword">table</span> ... LOCK <span class="keyword">IN</span> SHARE MODE;</span><br></pre></td></tr></table></figure><ul><li>æ„å‘æ’ä»–é”ï¼ˆintention exclusive lock, IXï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ æ’ä»–é”ï¼ˆXé”ï¼‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span> <span class="keyword">FROM</span> <span class="keyword">table</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>å³ï¼šæ„å‘é”æ˜¯ç”±å­˜å‚¨å¼•æ“<code>è‡ªå·±ç»´æŠ¤çš„</code>ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº« / æ’ä»–é”ä¹‹å‰ï¼Œ InooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œ<code>æ‰€åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”</code>ã€‚</p><mark class="hl-label green">æ„å‘é”è¦è§£å†³çš„é—®é¢˜</mark> <p>ç°åœ¨æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œåˆ†åˆ«æ˜¯T1å’ŒT2ï¼Œå…¶ä¸­T2è¯•å›¾åœ¨è¯¥è¡¨çº§åˆ«ä¸Šåº”ç”¨å…±äº«æˆ–æ’å®ƒé”ï¼Œå¦‚æœæ²¡æœ‰æ„å‘é”å­˜åœ¨ï¼Œé‚£ä¹ˆT2å°±éœ€è¦å»æ£€æŸ¥å„ä¸ªé¡µæˆ–è¡Œæ˜¯å¦å­˜åœ¨é”ï¼›å¦‚æœå­˜åœ¨æ„å‘é”ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå—åˆ°ç”±T1æ§åˆ¶çš„<code>è¡¨çº§åˆ«æ„å‘é”çš„é˜»å¡</code>ã€‚T2åœ¨é”å®šè¯¥è¡¨å‰ä¸å¿…æ£€æŸ¥å„ä¸ªé¡µæˆ–è¡Œé”ï¼Œè€Œåªéœ€æ£€æŸ¥è¡¨ä¸Šçš„æ„å‘é”ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç»™æ›´å¤§ä¸€çº§åˆ«çš„ç©ºé—´ç¤ºæ„é‡Œé¢æ˜¯å¦å·²ç»ä¸Šè¿‡é”ã€‚</p><p>åœ¨æ•°æ®è¡¨çš„åœºæ™¯ä¸­ï¼Œ<span class='p red'>å¦‚æœæˆ‘ä»¬ç»™æŸä¸€è¡Œæ•°æ®åŠ ä¸Šäº†æ’å®ƒé”ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ç»™æ›´å¤§ä¸€çº§çš„ç©ºé—´ï¼Œæ¯”å¦‚æ•°æ®é¡µæˆ–æ•°æ®è¡¨åŠ ä¸Šæ„å‘é”ï¼Œå‘Šè¯‰å…¶ä»–äººè¿™ä¸ªæ•°æ®é¡µæˆ–æ•°æ®è¡¨å·±ç»æœ‰äººä¸Šè¿‡æ’å®ƒé”äº†</span>ï¼Œè¿™æ ·å½“å…¶ä»–äººæƒ³è¦è·å–æ•°æ®è¡¨æ’å®ƒé”çš„æ—¶å€™ï¼Œåªéœ€è¦äº†è§£æ˜¯å¦æœ‰äººå·²ç»è·å–äº†è¿™ä¸ªæ•°æ®è¡¨çš„æ„å‘æ’ä»–é”å³å¯ã€‚</p><ul><li><p>å¦‚æœäº‹åŠ¡æƒ³è¦è·å¾—æ•°æ®è¡¨ä¸­æŸäº›è®°å½•çš„å…±äº«é”ï¼Œå°±éœ€è¦åœ¨æ•°æ®è¡¨ä¸Šæ·»åŠ æ„å‘å…±äº«é”ã€‚</p></li><li><p>å¦‚æœäº‹åŠ¡æƒ³è¦è·å¾—æ•°æ®è¡¨ä¸­æŸäº›è®°å½•çš„æ’ä»–é”ï¼Œå°±éœ€è¦åœ¨æ•°æ®è¡¨ä¸Šæ·»åŠ æ„å‘æ’ä»–é”ã€‚</p></li></ul><p>è¿™æ—¶ï¼Œæ„å‘é”ä¼šå‘Šè¯‰å…¶ä»–äº‹åŠ¡å·²ç»æœ‰äººé”å®šäº†è¡¨ä¸­çš„æŸäº›è®°å½•ã€‚</p><blockquote><p>ä¸¾ä¾‹</p></blockquote><div class="tabs" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-1"><i class="fas fa-seedling"></i>1</button></li><li class="tab"><button type="button" data-href="#bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-2"><i class="fas fa-leaf"></i>2</button></li><li class="tab"><button type="button" data-href="#bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-3"><i class="fab fa-apple"></i>3</button></li><li class="tab"><button type="button" data-href="#bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-4"><i class="fas fa-tree"></i>4</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-1"><p>åˆ›å»ºè¡¨teacher,æ’å…¥6æ¡æ•°æ®ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«é»˜è®¤ä¸º<code>Repeatable-Read</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`teacher`(</span><br><span class="line">`id`<span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name`<span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`teacher`<span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;lisi&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;wangwu&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;zhaoliu&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;songhongkang&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;leifengyang&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> @<span class="variable">@transaction</span>_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@transaction</span>_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-2"><p>å‡è®¾äº‹åŠ¡Aè·å–äº†æŸä¸€è¡Œçš„æ’ä»–é”ï¼Œå¹¶æœªæäº¤ï¼Œè¯­å¥å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">6</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨çš„è¡¨è¯»é”ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">LOCK TABLES teacher READ;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-3"><p>å› ä¸ºå…±äº«é”ä¸æ’ä»–é”äº’æ–¥ï¼Œæ‰€ä»¥äº‹åŠ¡B åœ¨è¯•å›¾å¯¹ teacher è¡¨åŠ å…±äº«é”çš„æ—¶å€™ï¼Œå¿…é¡»ä¿è¯ä¸¤ä¸ªæ¡ä»¶ã€‚</p><p>(1) å½“å‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡æŒæœ‰ teacher è¡¨çš„æ’ä»–é”</p><p>(2) å½“å‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡æŒæœ‰ teacher è¡¨ä¸­ä»»æ„ä¸€è¡Œçš„æ’ä»–é”ã€‚</p><p>ä¸ºäº†æ£€æµ‹æ˜¯å¦æ»¡è¶³ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œäº‹åŠ¡Bå¿…é¡»åœ¨ç¡®ä¿ teacher è¡¨ä¸å­˜åœ¨ä»»ä½•æ’ä»–é”çš„å‰æä¸‹ï¼Œå»æ£€æµ‹è¡¨ä¸­çš„æ¯ä¸€è¡Œæ˜¯å¦å­˜åœ¨æ’ä»–é”ã€‚å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸€ä¸ªæ•ˆç‡å¾ˆå·®çš„åšæ³•ï¼Œä½†æ˜¯æœ‰äº†æ„å‘é”ä¹‹åï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bd12d2a2-cd7b-45bd-9379-5b0ad79a5758-4"><p>æ„å‘é”æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ„å‘é”ä¹‹é—´çš„å…¼å®¹äº’æ–¥æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220712124209006.png" alt="image-20220712124209006"  /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">6</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶teacherè¡¨å­˜åœ¨ä¸¤æŠŠé”ï¼šteacherè¡¨ä¸Šçš„æ„å‘æ’ä»–é”ä¸idæœª6çš„æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚äº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨çš„å…±äº«é”ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">LOCK TABLES teacher READ;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶äº‹åŠ¡Bæ£€æµ‹äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ï¼Œå°±å¯ä»¥å¾—çŸ¥äº‹åŠ¡Aå¿…é¡»æŒæœ‰è¯¥è¡¨ä¸­æŸäº›æ•°æ®è¡Œçš„æ’ä»–é”ï¼Œé‚£ä¹ˆäº‹åŠ¡Bå¯¹teacherè¡¨çš„åŠ é”è¯·æ±‚å°±ä¼šè¢«æ’æ–¥ï¼ˆé˜»å¡ï¼‰ï¼Œè€Œæ— éœ€å»æ£€æµ‹è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®æ˜¯å¦å­˜åœ¨æ’ä»–é”ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><mark class="hl-label green">æ„å‘é”çš„å¹¶å‘æ€§</mark> <p>æ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº« / æ’ä»–é”äº’æ–¥ï¼æ­£å› ä¸ºå¦‚æ­¤ï¼Œæ„å‘é”å¹¶ä¸ä¼šå½±å“åˆ°å¤šä¸ªäº‹åŠ¡å¯¹ä¸åŒæ•°æ®è¡ŒåŠ æ’ä»–é”æ—¶çš„å¹¶å‘æ€§ã€‚ï¼ˆä¸ç„¶æˆ‘ä»¬ç›´æ¥ç”¨æ™®é€šçš„è¡¨é”å°±è¡Œäº†ï¼‰</p><p>æˆ‘ä»¬æ‰©å±•ä¸€ä¸‹ä¸Šé¢ teacherè¡¨çš„ä¾‹å­æ¥æ¦‚æ‹¬ä¸€ä¸‹æ„å‘é”çš„ä½œç”¨ï¼ˆä¸€æ¡æ•°æ®ä»è¢«é”å®šåˆ°è¢«é‡Šæ”¾çš„è¿‡ç¨‹ä¸­ï¼Œå¯ èƒ½å­˜åœ¨å¤šç§ä¸åŒé”ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬åªç€é‡è¡¨ç°æ„å‘é”ï¼‰ã€‚</p><p>äº‹åŠ¡Aå…ˆè·å¾—äº†æŸä¸€è¡Œçš„æ’ä»–é”ï¼Œå¹¶æœªæäº¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">6</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡Aè·å–äº†teacherè¡¨ä¸Šçš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Aè·å–äº†idä¸º6çš„æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚ä¹‹åäº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨ä¸Šçš„å…±äº«é”ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">LOCK TABLES teacher READ;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡Bæ£€æµ‹åˆ°äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Bå¯¹teacherè¡¨çš„åŠ é”è¯·æ±‚è¢«é˜»å¡ï¼ˆæ’æ–¥ï¼‰ã€‚æœ€åäº‹åŠ¡Cä¹Ÿæƒ³è·å–teacherè¡¨ä¸­æŸä¸€è¡Œçš„æ’ä»–é”ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">5</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡Cç”³è¯·teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Cæ£€æµ‹åˆ°äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚å› ä¸ºæ„å‘é”ä¹‹é—´å¹¶ä¸äº’æ–¥ï¼Œæ‰€ä»¥äº‹åŠ¡Cè·å–åˆ°äº†teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚å› ä¸ºidä¸º5çš„æ•°æ®è¡Œä¸Šä¸å­˜åœ¨ä»»ä½•æ’ä»–é”ï¼Œæœ€ç»ˆäº‹åŠ¡CæˆåŠŸè·å–åˆ°äº†è¯¥æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚</p><p>ä»ä¸Šé¢çš„æ¡ˆä¾‹å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“è®ºï¼š</p><ol><li>InnoDB æ”¯æŒ<code>å¤šç²’åº¦é”</code>ï¼Œç‰¹å®šåœºæ™¯ä¸‹ï¼Œè¡Œçº§é”å¯ä»¥ä¸è¡¨çº§é”å…±å­˜ã€‚</li><li>æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ<code>æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥</code>ã€‚</li><li>IXï¼ŒISæ˜¯è¡¨çº§é”ï¼Œä¸ä¼šå’Œè¡Œçº§çš„Xï¼ŒSé”å‘ç”Ÿå†²çªã€‚åªä¼šå’Œè¡¨çº§çš„Xï¼ŒSå‘ç”Ÿå†²çªã€‚</li><li>æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº†<code>è¡Œé”å’Œè¡¨é”å…±å­˜</code>ä¸”<code>æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§</code>çš„è¦æ±‚ã€‚</li></ol><hr><h4 id="4-1-3-è‡ªå¢é”-AUTO-INCé”">4.1.3 è‡ªå¢é”(AUTO-INCé”)</h4><p>åœ¨ä½¿ç”¨MySQLè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¡¨çš„æŸä¸ªåˆ—æ·»åŠ <code>AUTO_INCREMENT</code>å±æ€§ã€‚ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`teacher`(</span><br><span class="line">`id`<span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name`<span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure><p>ç”±äºè¿™ä¸ªè¡¨çš„idå­—æ®µå£°æ˜äº†AUTO_INCREMENTï¼Œæ„å‘³ç€åœ¨ä¹¦å†™æ’å…¥è¯­å¥æ—¶ä¸éœ€è¦ä¸ºå…¶èµ‹å€¼ï¼ŒSQLè¯­å¥ä¿®æ”¹ å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`teacher`(name) <span class="keyword">VALUES</span> (<span class="string">&#x27;zhangsan&#x27;</span>), (<span class="string">&#x27;lisi&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šè¾¹çš„æ’å…¥è¯­å¥å¹¶æ²¡æœ‰ä¸ºidåˆ—æ˜¾å¼èµ‹å€¼ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå®ƒèµ‹ä¸Šé€’å¢çš„å€¼ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> zhangsan <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> lisi     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬çœ‹åˆ°çš„ä¸Šé¢æ’å…¥æ•°æ®åªæ˜¯ä¸€ç§ç®€å•çš„æ’å…¥æ¨¡å¼ï¼Œæ‰€æœ‰æ’å…¥æ•°æ®çš„æ–¹å¼æ€»å…±åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ â€œ<code>Simple inserts</code>â€ï¼Œâ€œ<code>Bulk inserts</code>â€å’Œâ€œ<code>Mixed-mode inserts</code>â€ã€‚</p><div class="tabs" id="4434cedb-9dd6-40ab-a889-79476e2dbea7"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#4434cedb-9dd6-40ab-a889-79476e2dbea7-1"><i class="fas fa-atom"></i>1.Simple inserts(ç®€å•æ’å…¥)</button></li><li class="tab"><button type="button" data-href="#4434cedb-9dd6-40ab-a889-79476e2dbea7-2"><i class="far fa-sun"></i>2.Bulk inserts(æ‰¹é‡æ’å…¥)</button></li><li class="tab"><button type="button" data-href="#4434cedb-9dd6-40ab-a889-79476e2dbea7-3"><i class="fas fa-wind"></i>3.Mixed-mode inserts(æ··åˆæ¨¡å¼æ’å…¥)</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="4434cedb-9dd6-40ab-a889-79476e2dbea7-1"><p>å¯ä»¥<code>é¢„å…ˆç¡®å®šè¦æ’å…¥çš„è¡Œæ•°</code>ï¼ˆå½“è¯­å¥è¢«åˆå§‹å¤„ç†æ—¶ï¼‰çš„è¯­å¥ã€‚åŒ…æ‹¬æ²¡æœ‰åµŒå¥—å­æŸ¥è¯¢çš„å•è¡Œå’Œå¤šè¡Œ<code>INSERT...VALUES()</code>å’Œ<code>REPLACE</code>è¯­å¥ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­å°±å±äºè¯¥ç±»æ’å…¥ï¼Œå·²ç»ç¡®å®šè¦æ’å…¥çš„è¡Œ æ•°ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4434cedb-9dd6-40ab-a889-79476e2dbea7-2"><p><code>äº‹å…ˆä¸çŸ¥é“è¦æ’å…¥çš„è¡Œæ•°</code>ï¼ˆå’Œæ‰€éœ€è‡ªåŠ¨é€’å¢å€¼çš„æ•°é‡ï¼‰çš„è¯­å¥ã€‚æ¯”å¦‚<code>INSERT ... SELECT</code>ï¼Œ<code>REPLACE ... SELECT</code>å’Œ<code>LOAD DATA</code>è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬çº¯INSERTã€‚ InnoDBåœ¨æ¯å¤„ç†ä¸€è¡Œï¼Œä¸ºAUTO_INCREMENTåˆ—</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4434cedb-9dd6-40ab-a889-79476e2dbea7-3"><p>è¿™äº›æ˜¯â€œSimple insertsâ€è¯­å¥ä½†æ˜¯æŒ‡å®šéƒ¨åˆ†æ–°è¡Œçš„è‡ªåŠ¨é€’å¢å€¼ã€‚ä¾‹å¦‚<code>INSERT INTO teacher (id,name) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');</code>åªæ˜¯æŒ‡å®šäº†éƒ¨åˆ†idçš„å€¼ã€‚å¦ä¸€ç§ç±»å‹çš„â€œæ··åˆæ¨¡å¼æ’å…¥â€æ˜¯<code>INSERT ... ON DUPLICATE KEY UPDATE</code>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>å¯¹äºä¸Šé¢æ•°æ®æ’å…¥çš„æ¡ˆä¾‹ï¼ŒMysQLä¸­é‡‡ç”¨äº†<code>è‡ªå¢é”</code>çš„æ–¹å¼æ¥å®ç°ï¼Œ<span class='p red'>AUTO-INCé”æ˜¯å½“å‘ä½¿ç”¨å«æœ‰AUTO_INCREMENT åˆ—çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶éœ€è¦è·å–çš„ä¸€ç§ç‰¹æ®Šçš„è¡¨çº§é”</span>ï¼Œåœ¨æ‰§è¡Œæ’å…¥è¯­å¥æ—¶å°±åœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªAUTO-INCé”ï¼Œç„¶åä¸ºæ¯æ¡å¾…æ’å…¥è®°å½•çš„AUTO_INCREMENTä¿®é¥°çš„åˆ—åˆ†é…é€’å¢çš„å€¼ï¼Œåœ¨è¯¥è¯­å¥æ‰§è¡Œç»“æŸåï¼Œå†æŠŠAUTO-INCé”é‡Šæ”¾æ‰ã€‚<span class='p red'>ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰AUTO-INCé”çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„æ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡</span>ï¼Œå¯ä»¥ä¿è¯ä¸€ä¸ªè¯­å¥ä¸­åˆ†é…çš„é€’å¢å€¼æ˜¯è¿ç»­çš„ã€‚ä¹Ÿæ­£å› ä¸ºæ­¤ï¼Œå…¶å¹¶å‘æ€§æ˜¾ç„¶å¹¶ä¸é«˜ï¼Œå½“æˆ‘ä»¬å‘ä¸€ä¸ªæœ‰AUTO_INCREMENTå…³é”®å­—çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦å¯¹è¿™ä¸ªè¡¨é”è¿›è¡Œç«äº‰ï¼Œè¿™æ ·çš„å¹¶å‘æ½œåŠ›å…¶å®æ˜¯å¾ˆä½ä¸‹çš„ï¼Œæ‰€ä»¥innodbé€šè¿‡<code>innodb_autoinc-lock-mode</code>çš„ä¸åŒå–å€¼æ¥æä¾›ä¸åŒçš„é”å®šæœºåˆ¶ï¼Œæ¥æ˜¾è‘—æé«˜SQLè¯­å¥çš„å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ã€‚</p><p>innodb_autoinc_lock_modeæœ‰ä¸‰ç§å–å€¼ï¼Œåˆ†åˆ«å¯¹åº”ä¸ä¸åŒé”å®šæ¨¡å¼ï¼š</p><div class="tabs" id="651b2759-d9b3-4f0d-a0dd-ea3da71236e5"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#651b2759-d9b3-4f0d-a0dd-ea3da71236e5-1"><i class="fas fa-award"></i>0(â€œä¼ ç»Ÿâ€é”å®šæ¨¡å¼)</button></li><li class="tab"><button type="button" data-href="#651b2759-d9b3-4f0d-a0dd-ea3da71236e5-2"><i class="fas fa-baseball-ball"></i>1(â€œè¿ç»­â€é”å®šæ¨¡å¼)</button></li><li class="tab"><button type="button" data-href="#651b2759-d9b3-4f0d-a0dd-ea3da71236e5-3"><i class="fas fa-bone"></i>2(â€œäº¤é”™â€é”å®šæ¨¡å¼)</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="651b2759-d9b3-4f0d-a0dd-ea3da71236e5-1"><p>åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç±»å‹çš„insertè¯­å¥éƒ½ä¼šè·å¾—ä¸€ä¸ªç‰¹æ®Šçš„è¡¨çº§AUTO-INCé”ï¼Œç”¨äºæ’å…¥å…·æœ‰ AUTO_INCREMENTåˆ—çš„è¡¨ã€‚è¿™ç§æ¨¡å¼å…¶å®å°±å¦‚æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ï¼Œå³æ¯å½“æ‰§è¡Œinsertçš„æ—¶å€™ï¼Œéƒ½ä¼šå¾—åˆ°ä¸€ä¸ª è¡¨çº§é”(AUTO-INCé”)ï¼Œä½¿å¾—è¯­å¥ä¸­ç”Ÿæˆçš„auto_incrementä¸ºé¡ºåºï¼Œä¸”åœ¨binlogä¸­é‡æ”¾çš„æ—¶å€™ï¼Œå¯ä»¥ä¿è¯ masterä¸slaveä¸­æ•°æ®çš„auto_incrementæ˜¯ç›¸åŒçš„ã€‚å› ä¸ºæ˜¯è¡¨çº§é”ï¼Œå½“åœ¨åŒä¸€æ—¶é—´å¤šä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œinsertçš„ æ—¶å€™ï¼Œå¯¹äºAUTO-INCé”çš„äº‰å¤ºä¼š<code>é™åˆ¶å¹¶å‘</code>èƒ½åŠ›ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="651b2759-d9b3-4f0d-a0dd-ea3da71236e5-2"><p>åœ¨ MySQL 8.0 ä¹‹å‰ï¼Œè¿ç»­é”å®šæ¨¡å¼æ˜¯<code>é»˜è®¤</code>çš„ã€‚</p><p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œâ€œbulk insertsâ€ä»ç„¶ä½¿ç”¨AUTO-INCè¡¨çº§é”ï¼Œå¹¶ä¿æŒåˆ°è¯­å¥ç»“æŸã€‚è¿™é€‚ç”¨äºæ‰€æœ‰INSERT â€¦ SELECTï¼ŒREPLACE â€¦ SELECTå’ŒLOAD DATAè¯­å¥ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¯­å¥å¯ä»¥æŒæœ‰AUTO-INCé”ã€‚</p><p>å¯¹äºâ€œSimple insertsâ€ï¼ˆè¦æ’å…¥çš„è¡Œæ•°äº‹å…ˆå·²çŸ¥ï¼‰ï¼Œåˆ™é€šè¿‡åœ¨<code>mutexï¼ˆè½»é‡é”ï¼‰</code>çš„æ§åˆ¶ä¸‹è·å¾—æ‰€éœ€æ•°é‡çš„è‡ªåŠ¨é€’å¢å€¼æ¥é¿å…è¡¨çº§AUTO-INCé”ï¼Œ å®ƒåªåœ¨åˆ†é…è¿‡ç¨‹çš„æŒç»­æ—¶é—´å†…ä¿æŒï¼Œè€Œä¸æ˜¯ç›´åˆ°è¯­å¥å®Œæˆã€‚ä¸ä½¿ç”¨è¡¨çº§AUTO-INCé”ï¼Œé™¤éAUTO-INCé”ç”±å¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒã€‚å¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒAUTO-INCé”ï¼Œåˆ™â€œSimple insertsâ€ç­‰å¾…AUTO-INCé”ï¼Œå¦‚åŒå®ƒæ˜¯ä¸€ä¸ªâ€œbulk insertsâ€ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="651b2759-d9b3-4f0d-a0dd-ea3da71236e5-3"><p>ä» MySQL 8.0 å¼€å§‹ï¼Œäº¤é”™é”æ¨¡å¼æ˜¯<code>é»˜è®¤</code>è®¾ç½®ã€‚</p><p>åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œè‡ªåŠ¨é€’å¢å€¼<code>ä¿è¯</code>åœ¨æ‰€æœ‰å¹¶å‘æ‰§è¡Œçš„æ‰€æœ‰ç±»å‹çš„insertè¯­å¥ä¸­æ˜¯<code>å”¯ä¸€</code>ä¸”<code>å•è°ƒé€’å¢</code>çš„ã€‚ä½†æ˜¯ï¼Œç”±äºå¤šä¸ªè¯­å¥å¯ä»¥åŒæ—¶ç”Ÿæˆæ•°å­—ï¼ˆå³ï¼Œè·¨è¯­å¥äº¤å‰ç¼–å·ï¼‰ï¼Œä¸ºä»»ä½•ç»™å®šè¯­å¥æ’å…¥çš„è¡Œç”Ÿæˆçš„å€¼å¯èƒ½ä¸æ˜¯è¿ç»­çš„ã€‚</p><p>å¦‚æœæ‰§è¡Œçš„è¯­å¥æ˜¯â€œsimple inserts&quot;ï¼Œå…¶ä¸­è¦æ’å…¥çš„è¡Œæ•°å·²æå‰çŸ¥é“ï¼Œé™¤äº†&quot;Mixed-mode inserts&quot;ä¹‹å¤–ï¼Œä¸ºå•ä¸ªè¯­å¥ç”Ÿæˆçš„æ•°å­—ä¸ä¼šæœ‰é—´éš™ã€‚ç„¶åï¼Œå½“æ‰§è¡Œ&quot;bulk inserts&quot;æ—¶ï¼Œåœ¨ç”±ä»»ä½•ç»™å®šè¯­å¥åˆ†é…çš„è‡ªåŠ¨é€’å¢å€¼ä¸­å¯èƒ½å­˜åœ¨é—´éš™ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h4 id="4-1-4-å…ƒæ•°æ®é”-MDLé”">4.1.4 å…ƒæ•°æ®é”(MDLé”)</h4><p>MySQL5.5å¼•å…¥äº†meta data lockï¼Œç®€ç§°MDLé”ï¼Œå±äºè¡¨é”èŒƒç•´ã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ª<code>è¡¨ç»“æ„åšå˜æ›´</code>ï¼Œå¢åŠ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p><p>å› æ­¤ï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é”ã€‚</p><p>è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æŸ¥æ”¹ã€‚è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´éƒ½æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ï¼Œè§£å†³äº†DMLå’ŒDDLæ“ä½œä¹‹é—´çš„ä¸€è‡´æ€§é—®é¢˜ã€‚<code>ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨</code>ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚</p><p>ä¸¾ä¾‹ï¼šå…ƒæ•°æ®é”çš„ä½¿ç”¨åœºæ™¯æ¨¡æ‹Ÿ</p><p>ä¼šè¯Aï¼šä»è¡¨ä¸­æŸ¥è¯¢æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">BEGIN</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> teacher;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="type">int</span> <span class="keyword">set</span> (<span class="number">7.46</span> sec)</span><br></pre></td></tr></table></figure><p>ä¼šè¯Bï¼šä¿®æ”¹è¡¨ç»“æ„ï¼Œå¢åŠ æ–°åˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">BEGIN</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">add</span> age <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p>ä¼šè¯Cï¼šæŸ¥çœ‹å½“å‰MySQLçš„è¿›ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> processlist;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713142808924.png" alt="image-20220713142808924"></p><p>é€šè¿‡ä¼šè¯Cå¯ä»¥çœ‹å‡ºä¼šè¯Bè¢«é˜»å¡ï¼Œè¿™æ˜¯ç”±äºä¼šè¯Aæ‹¿åˆ°äº†teacherè¡¨çš„å…ƒæ•°æ®è¯»é”ï¼Œä¼šè¯Bæƒ³ç”³è¯·teacherè¡¨çš„å…ƒæ•°æ®å†™é”ï¼Œç”±äºè¯»å†™é”äº’æ–¥ï¼Œä¼šè¯Béœ€è¦ç­‰å¾…ä¼šè¯Aé‡Šæ”¾å…ƒæ•°æ®é”æ‰èƒ½æ‰§è¡Œã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713143156759.png" alt="image-20220713143156759" /><hr><h3 id="4-2-è¡Œé”ï¼ˆRow-Lockï¼‰">4.2 è¡Œé”ï¼ˆRow Lockï¼‰</h3><p>è¡Œé”ï¼ˆRow Lockï¼‰ä¹Ÿç§°ä¸ºè®°å½•é”ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é”ä½æŸä¸€è¡Œï¼ˆæŸæ¡è®°å½• rowï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQLæœåŠ¡å™¨å±‚å¹¶æ²¡æœ‰å®ç°è¡Œé”æœºåˆ¶ï¼Œ<span class='p green'>è¡Œçº§é”åªåœ¨å­˜å‚¨å¼•æ“å±‚å®ç°</span>ã€‚</p><p>ä¼˜ç‚¹ï¼šé”å®šåŠ›åº¦å°ï¼Œå‘ç”Ÿ<code>é”å†²çªæ¦‚ç‡ä½</code>ï¼Œå¯ä»¥å®ç°çš„<code>å¹¶å‘åº¦é«˜</code>ã€‚</p><p>ç¼ºç‚¹ï¼šå¯¹äº<code>é”çš„å¼€é”€æ¯”è¾ƒå¤§</code>ï¼ŒåŠ é”ä¼šæ¯”è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°<code>æ­»é”</code>æƒ…å†µã€‚</p><p>InnoDBä¸MyISAMçš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼ˆTRANSACTIONï¼‰ï¼›äºŒæ˜¯é‡‡ç”¨äº†è¡Œçº§é”ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºè¡¨å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (</span><br><span class="line">  id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    class <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) Engine<span class="operator">=</span>InnoDB CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>å‘è¿™ä¸ªè¡¨é‡Œæ’å…¥å‡ æ¡è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="string">&#x27;ä¸€ç­&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;æå››&#x27;</span>, <span class="string">&#x27;ä¸€ç­&#x27;</span>),</span><br><span class="line">(<span class="number">8</span>, <span class="string">&#x27;ç‹äº”&#x27;</span>, <span class="string">&#x27;äºŒç­&#x27;</span>),</span><br><span class="line">(<span class="number">15</span>, <span class="string">&#x27;èµµå…­&#x27;</span>, <span class="string">&#x27;äºŒç­&#x27;</span>),</span><br><span class="line">(<span class="number">20</span>, <span class="string">&#x27;é’±ä¸ƒ&#x27;</span>, <span class="string">&#x27;ä¸‰ç­&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713161549241.png" alt="image-20220713161549241"  /><p>studentè¡¨ä¸­çš„èšç°‡ç´¢å¼•çš„ç®€å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713163353648.png" alt="image-20220713163353648"></p><p>è¿™é‡ŒæŠŠB+æ ‘çš„ç´¢å¼•ç»“æ„åšäº†è¶…çº§ç®€åŒ–ï¼ŒåªæŠŠç´¢å¼•ä¸­çš„è®°å½•ç»™æ‹¿äº†å‡ºæ¥ï¼Œä¸‹é¢çœ‹çœ‹éƒ½æœ‰å“ªäº›å¸¸ç”¨çš„è¡Œé”ç±»å‹ã€‚</p><hr><h4 id="4-2-1-è®°å½•é”">4.2.1 è®°å½•é”</h4><p>è®°å½•é”ä¹Ÿå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_REC_NOT_GAP</code>ã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªè®°å½•é”çš„ç¤ºæ„å›¾å¦‚æœæ‰€ç¤ºã€‚ä»…ä»…æ˜¯é”ä½äº†idå€¼ä¸º8çš„è®°å½•ï¼Œå¯¹å‘¨å›´çš„æ•°æ®æ²¡æœ‰å½±å“ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713164811567.png" alt="image-20220713164811567" style="zoom:50%;" /><p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713164948405.png" alt="image-20220713164948405" style="zoom: 50%;" /><p>è®°å½•é”æ˜¯æœ‰Sé”å’ŒXé”ä¹‹åˆ†çš„ï¼Œç§°ä¹‹ä¸º<code>Så‹è®°å½•é”</code>å’Œ<code>Xå‹è®°å½•é”</code>ã€‚</p><ul><li>å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Så‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä½†ä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ï¼›</li><li>å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Xå‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸å¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä¹Ÿä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ã€‚</li></ul><hr><h4 id="4-2-2-é—´éš™é”">4.2.2 é—´éš™é”</h4><p><code>MySQL</code>åœ¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜çš„ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œå¯ä»¥ä½¿ç”¨<code>MVCC</code>æ–¹ æ¡ˆè§£å†³ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨<code>åŠ é”</code>æ–¹æ¡ˆè§£å†³ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨åŠ é”æ–¹æ¡ˆè§£å†³æ—¶æœ‰ä¸ªå¤§é—®é¢˜ï¼Œå°±æ˜¯äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œé‚£äº›å¹»å½±è®°å½•å°šä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ— æ³•ç»™è¿™äº›<code>å¹»å½±è®°å½•</code>åŠ ä¸Š<code>è®°å½•é”</code>ã€‚InnoDBæå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º<code>Gap Locks</code>çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_GAP</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç®€ç§°ä¸º<code>gapé”</code>ã€‚æ¯”å¦‚ï¼ŒæŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªgapé”çš„ç¤ºæ„å›¾å¦‚ä¸‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713171650888.png" alt="image-20220713171650888" style="zoom:50%;" /><p>å›¾ä¸­idå€¼ä¸º8çš„è®°å½•åŠ äº†gapé”ï¼Œæ„å‘³ç€<code>ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨idå€¼ä¸º8çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½•</code>ï¼Œå…¶å®å°±æ˜¯idåˆ—çš„å€¼(3, 8)è¿™ä¸ªåŒºé—´çš„æ–°è®°å½•æ˜¯ä¸å…è®¸ç«‹å³æ’å…¥çš„ã€‚æ¯”å¦‚ï¼Œæœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡å†æƒ³æ’å…¥ä¸€æ¡idå€¼ä¸º4çš„æ–°è®°å½•ï¼Œ<span class='p green'>å®ƒå®šä½åˆ°è¯¥æ¡æ–°è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•çš„idå€¼ä¸º8ï¼Œè€Œè¿™æ¡è®°å½•ä¸Šåˆæœ‰ä¸€ä¸ªgapé”ï¼Œæ‰€ä»¥å°±ä¼šé˜»å¡æ’å…¥æ“ä½œ</span> ï¼Œç›´åˆ°æ‹¥æœ‰è¿™ä¸ªgapé”çš„äº‹åŠ¡æäº¤äº†ä¹‹åï¼Œidåˆ—çš„å€¼åœ¨åŒºé—´(3, 8)ä¸­çš„æ–°è®°å½•æ‰å¯ä»¥è¢«æ’å…¥ã€‚<span class='p red'>gapé”çš„æå‡ºä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„ã€‚</span>è™½ç„¶å…±äº«gapé”å’Œç‹¬å gapé”è¿™æ ·çš„è¯´æ³•ï¼Œä½†æ˜¯å®ƒä»¬èµ·åˆ°çš„ä½œç”¨æ˜¯ç›¸åŒçš„ã€‚è€Œä¸”å¦‚æœå¯¹ä¸€æ¡è®°å½•åŠ äº†gapé”ï¼ˆä¸è®ºæ˜¯å…±äº«gapé”è¿˜æ˜¯ç‹¬å gapé”ï¼‰ï¼Œå¹¶ä¸ä¼šé™åˆ¶å…¶ä»–äº‹åŠ¡å¯¹è¿™æ¡è®°å½•åŠ è®°å½•é”æˆ–è€…ç»§ç»­åŠ gapé”ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><table><thead><tr><th style="text-align:left">Session1</th><th>Session2</th></tr></thead><tbody><tr><td style="text-align:left">select * from student where id=5 lock in share mode;</td><td></td></tr><tr><td style="text-align:left"></td><td>select * from student where id=5 for update;</td></tr></tbody></table><p>è¿™é‡Œsession2å¹¶ä¸ä¼šè¢«å µä½ã€‚å› ä¸ºè¡¨é‡Œå¹¶æ²¡æœ‰id=5è¿™æ¡è®°å½•ï¼Œå› æ­¤session1åŠ çš„æ˜¯é—´éš™é”(3,8)ã€‚è€Œsession2ä¹Ÿæ˜¯åœ¨è¿™ä¸ªé—´éš™åŠ çš„é—´éš™é”ã€‚å®ƒä»¬æœ‰å…±åŒçš„ç›®æ ‡ï¼Œå³ï¼šä¿æŠ¤è¿™ä¸ªé—´éš™é”ï¼Œä¸å…è®¸æ’å…¥å€¼ã€‚ä½†ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä¸å†²çªçš„ã€‚<span class='p red'>(PS:è‹¥Session1å’ŒSession2éƒ½æƒ³åœ¨è¿™ä¸ªé—´éš™æ’å…¥æ•°æ®ï¼Œé‚£å°±ä¼šå‘ç”Ÿæ­»é”ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹çš„é—´éš™é”é‡Šæ”¾)</span></p><p>æ³¨æ„ï¼Œç»™ä¸€æ¡è®°å½•åŠ äº†<code>gapé”</code>åªæ˜¯<code>ä¸å…è®¸</code>å…¶ä»–äº‹åŠ¡å¾€è¿™æ¡è®°å½•å‰è¾¹çš„é—´éš™<code>æ’å…¥æ–°è®°å½•</code>ï¼Œé‚£å¯¹äºæœ€åä¸€æ¡è®°å½•ä¹‹åçš„é—´éš™ï¼Œä¹Ÿå°±æ˜¯student è¡¨ä¸­idå€¼ä¸º<code>20</code>çš„è®°å½•ä¹‹åçš„é—´éš™è¯¥å’‹åŠå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ç»™å“ªæ¡è®°å½•åŠ <code>gapé”</code>æ‰èƒ½é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥<code>id</code>å€¼åœ¨<code>(20ï¼Œ+âˆï¼‰</code>è¿™ä¸ªåŒºé—´çš„æ–°è®°å½•å‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘ä»¬åœ¨è®²æ•°æ®é¡µæ—¶ä»‹ç»çš„ä¸¤æ¡ä¼ªè®°å½•æ´¾ä¸Šç”¨åœºäº†ï¼š</p><p>*<code>Infimum</code>è®°å½•ï¼Œè¡¨ç¤ºè¯¥é¡µé¢ä¸­æœ€å°çš„è®°å½•ã€‚<br>*<code>Supremun</code>è®°å½•ï¼Œè¡¨ç¤ºè¯¥é¡µé¢ä¸­æœ€å¤§çš„è®°å½•ã€‚</p><p>ä¸ºäº†å®ç°é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥idå€¼å†(20,æ­£æ— ç©·)è¿™ä¸ªåŒºé—´çš„æ–°çºªå½•ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç´¢å¼•ä¸­çš„æœ€åä¸€æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯idå€¼ä¸º20çš„é‚£æ¡è®°å½•æ‰€åœ¨é¡µé¢çš„Supremunè®°å½•åŠ  ä¸Šä¸€ä¸ªgapé”ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713174108634.png" alt="image-20220713174108634" style="zoom:50%;" /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">20</span> lock <span class="keyword">in</span> share mode;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>æ£€æµ‹ï¼š</p><div class="fj-gallery"><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414220905714.png" alt="image-20230414220905714"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414220939203.png" alt="image-20230414220939203"></p>          </div><p>è¿™æ ·å°±å¯ä»¥é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥idå€¼åœ¨(20ï¼Œ+âˆ)è¿™ä¸ªåŒºé—´çš„æ–°è®°å½•ã€‚</p><p>é—´éš™é”çš„å¼•å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œè¿™å…¶å®æ˜¯å½±å“äº†å¹¶å‘åº¦çš„ã€‚ä¸‹é¢çš„ä¾‹å­ä¼šäº§ç”Ÿ<code>æ­»é”</code></p><table><thead><tr><th>Session1</th><th>Session2</th></tr></thead><tbody><tr><td>begin;<br/>select * from student where id = 5 for update;</td><td>begin;<br/>select * from student where id 5 for update;</td></tr><tr><td></td><td>INSERT INTO student VALUES (5, â€˜å®‹çº¢åº·â€™ï¼Œ'â€˜äºŒç­â€™);é˜»å¡</td></tr><tr><td>INSERT INTO student VALUES (5,â€˜å®‹çº¢åº·â€™ï¼Œâ€˜äºŒç­â€™ï¼‰; <br/> (ERROR 1213 (40001): Deadlock found when trying to get lock;try restarting transaction)</td><td></td></tr></tbody></table><p>(1) session 1æ‰§è¡Œ selectâ€¦ for update è¯­å¥ï¼Œç”±äºid=5è¿™ä¸€è¡Œå¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤ä¼šåŠ ä¸Šé—´éš™é”(3, 8)ï¼›</p><p>(2) session 2 æ‰§è¡Œ selectâ€¦ for update è¯­å¥ï¼ŒåŒæ ·ä¼šåŠ ä¸Šé—´éš™é”ï¼ˆ3ï¼Œ8)ï¼Œé—´éš™é”ä¹‹é—´ä¸ä¼šå†²çªï¼Œå› æ­¤è¿™ä¸ªè¯­å¥å¯ä»¥æ‰§è¡ŒæˆåŠŸ</p><p>(3) session 2 è¯•å›¾æ’å…¥ä¸€è¡Œ(5,â€˜å®‹çº¢åº·â€™ï¼Œâ€˜äºŒç­â€™ï¼‰ï¼Œè¢« session 1 çš„é—´éš™é”æŒ¡ä½äº†ï¼Œåªå¥½è¿›å…¥ç­‰å¾…ï¼›</p><p>(4) session 1 è¯•å›¾æ’å…¥ä¸€è¡Œ(5,â€˜å®‹çº¢åº·â€™ï¼Œâ€˜äºŒç­â€™ï¼‰ï¼Œè¢« session 2 çš„é—´éš™é”æŒ¡ä½äº†ã€‚è‡³æ­¤ï¼Œä¸¤ä¸ª session è¿›å…¥äº’ç›¸ç­‰å¾…çŠ¶æ€ï¼Œå½¢æˆæ­»é”ã€‚å½“ç„¶ï¼ŒInnoDB çš„æ­»é”æ£€æµ‹é©¬ä¸Šå°±å‘ç°äº†è¿™å¯¹æ­»é”å…³ç³»ï¼Œè®© session 1 çš„ insert è¯­å¥æŠ¥é”™è¿”å›ã€‚</p><hr><h4 id="4-2-3-ä¸´é”®é”">4.2.3 ä¸´é”®é”</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬æ—¢æƒ³<code>é”ä½æŸæ¡è®°å½•</code>ï¼Œåˆæƒ³é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ï¼Œæ‰€ä»¥InnoDBå°±æå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º Next-Key Locks çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š LOCK_ORDINARY ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€ç§°ä¸º next-keyé” ã€‚Next-Key Locksæ˜¯åœ¨å­˜å‚¨å¼•æ“ innodb ã€äº‹åŠ¡çº§åˆ«åœ¨ å¯é‡å¤è¯» çš„æƒ…å†µä¸‹ä½¿ç”¨çš„æ•°æ®åº“é”ï¼Œ <span class='p green'>innodbé»˜è®¤çš„é”å°±æ˜¯Next-Key locksã€‚</span>æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªnext-keyé”çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713192549340.png" alt="image-20220713192549340" style="zoom:50%;" /><p><code>next-keyé”</code>çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª<code>è®°å½•é”</code>å’Œä¸€ä¸ª<code>gapé”</code>çš„åˆä½“ï¼Œå®ƒæ—¢èƒ½ä¿æŠ¤è¯¥æ¡è®°å½•ï¼Œåˆèƒ½é˜»æ­¢åˆ«çš„äº‹åŠ¡å°†æ–°è®°å½•æ’å…¥è¢«ä¿æŠ¤è®°å½•å‰è¾¹çš„<code>é—´éš™</code>ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&lt;=</span><span class="number">8</span> <span class="keyword">and</span> id <span class="operator">&gt;</span> <span class="number">3</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure><hr><h4 id="4-2-4-æ’å…¥æ„å‘é”">4.2.4 æ’å…¥æ„å‘é”</h4><p>æˆ‘ä»¬è¯´ä¸€ä¸ªäº‹åŠ¡åœ¨<code>æ’å…¥</code>ä¸€æ¡è®°å½•æ—¶éœ€è¦åˆ¤æ–­ä¸€ä¸‹æ’å…¥ä½ç½®æ˜¯ä¸æ˜¯è¢«åˆ«çš„äº‹åŠ¡åŠ äº†<code>gapé”</code>(<code>next-keyé”</code>ä¹ŸåŒ…å«<code>gapé”</code>ï¼‰ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œæ’å…¥æ“ä½œéœ€è¦ç­‰å¾…ï¼Œç›´åˆ°æ‹¥æœ‰ gapé”çš„é‚£ä¸ªäº‹åŠ¡æäº¤ã€‚ä½†æ˜¯<span class='p red'>InnoDBè§„å®šäº‹åŠ¡åœ¨ç­‰å¾…çš„æ—¶å€™ä¹Ÿéœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªé”ç»“æ„</span>ï¼Œè¡¨æ˜æœ‰äº‹åŠ¡æƒ³åœ¨æŸä¸ª<code>é—´éš™</code>ä¸­<code>æ’å…¥</code>æ–°è®°å½•ï¼Œä½†æ˜¯ç°åœ¨åœ¨ç­‰å¾…ã€‚InnoDBå°±æŠŠè¿™ç§ç±»å‹çš„é”å‘½åä¸º<code>Insert Intention Locks</code>ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_INSERT_INTENTION</code>ï¼Œæˆ‘ä»¬ç§°ä¸º<code>æ’å…¥æ„å‘é”</code>ã€‚æ’å…¥æ„å‘é”æ˜¯ä¸€ç§<code>Gapé”</code>ï¼Œä¸æ˜¯æ„å‘é”ï¼Œåœ¨insertæ“ä½œæ—¶äº§ç”Ÿã€‚</p><p>æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”±<code>INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”</code>ã€‚è¯¥é”ç”¨ä»¥è¡¨ç¤ºæ’å…¥æ„å‘ï¼Œå½“å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€åŒºé—´ï¼ˆgap)æ’å…¥ä½ç½®ä¸åŒçš„å¤šæ¡æ•°æ®æ—¶ï¼Œäº‹åŠ¡ä¹‹é—´ä¸éœ€è¦äº’ç›¸ç­‰å¾…ã€‚å‡è®¾å­˜åœ¨ä¸¤æ¡å€¼åˆ†åˆ«ä¸º4å’Œ7çš„è®°å½•ï¼Œä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡åˆ†åˆ«è¯•å›¾æ’å…¥å€¼ä¸º5å’Œ6çš„ä¸¤æ¡è®°å½•ï¼Œæ¯ä¸ªäº‹åŠ¡åœ¨è·å–æ’å…¥è¡Œä¸Šç‹¬å çš„ï¼ˆæ’ä»–ï¼‰é”å‰ï¼Œéƒ½ä¼šè·å–ï¼ˆ4ï¼Œ7ï¼‰ä¹‹é—´çš„é—´éš™é”ï¼Œä½†æ˜¯å› ä¸ºæ•°æ®è¡Œä¹‹é—´å¹¶<code>ä¸å†²çª</code>ï¼Œæ‰€ä»¥ä¸¤ä¸ªäº‹åŠ¡ä¹‹é—´å¹¶ä¸ä¼šäº§ç”Ÿå†²çªï¼ˆé˜»å¡ç­‰å¾…ï¼‰ï¼Œ æ€»ç»“æ¥è¯´ï¼Œæ’å…¥æ„å‘é”çš„ç‰¹æ€§å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†ï¼š</p><p>(1ï¼‰æ’å…¥æ„å‘é”æ˜¯ä¸€ç§<code>ç‰¹æ®Šçš„é—´éš™é”</code>â€”é—´éš™é”å¯ä»¥é”å®šå¼€åŒºé—´å†…çš„éƒ¨åˆ†è®°å½•ã€‚</p><p>(2) æ’å…¥æ„å‘é”ä¹‹é—´<code>äº’ä¸æ’æ–¥</code>ï¼Œæ‰€ä»¥å³ä½¿å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€åŒºé—´æ’å…¥å¤šæ¡è®°å½•ï¼Œåªè¦è®°å½•æœ¬èº«ï¼ˆä¸»é”®ã€å”¯ä¸€ç´¢å¼•ï¼‰ä¸å†²çªï¼Œé‚£ä¹ˆäº‹åŠ¡ä¹‹é—®å°±ä¸ä¼šå‡ºç°å†²çªç­‰å¾…ã€‚</p><p>æ³¨æ„ï¼Œè™½ç„¶æ’å…¥æ„å‘é”ä¸­å«æœ‰æ„å‘é”ä¸‰ä¸ªå­—ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å±äºæ„å‘é”è€Œå±äºé—´éš™é”ï¼Œå› ä¸ºæ„å‘é”æ˜¯è¡¨é”è€Œæ’å…¥æ„å‘é”æ˜¯<code>è¡Œé”</code>ã€‚</p><div class="fj-gallery"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713203532124.png" alt="image-20220713203532124"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713203619704.png" alt="image-20220713203619704" />          </div><hr><h3 id="4-3-é¡µé”ï¼ˆPage-Lockï¼‰">4.3 é¡µé”ï¼ˆPage Lockï¼‰</h3><p>é¡µé”å°±æ˜¯åœ¨<code>é¡µçš„ç²’åº¦</code>ä¸Šè¿›è¡Œé”å®šï¼Œé”å®šçš„æ•°æ®èµ„æºæ¯”è¡Œé”è¦å¤šï¼Œå› ä¸ºä¸€ä¸ªé¡µä¸­å¯ä»¥æœ‰å¤šä¸ªè¡Œè®°å½•ã€‚å½“æˆ‘ ä»¬ä½¿ç”¨é¡µé”çš„æ—¶å€™ï¼Œä¼šå‡ºç°æ•°æ®æµªè´¹çš„ç°è±¡ï¼Œä½†è¿™æ ·çš„æµªè´¹æœ€å¤šä¹Ÿå°±æ˜¯ä¸€ä¸ªé¡µä¸Šçš„æ•°æ®è¡Œã€‚<span class='p green'>é¡µé”çš„å¼€é”€ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œä¼šå‡ºç°æ­»é”ã€‚é”å®šç²’åº¦ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚</span></p><p>æ¯ä¸ªå±‚çº§çš„é”æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œå› ä¸ºé”ä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œ<code>é”ç©ºé—´çš„å¤§å°æ˜¯æœ‰é™çš„</code>ã€‚å½“æŸä¸ªå±‚çº§çš„é”æ•°é‡ è¶…è¿‡äº†è¿™ä¸ªå±‚çº§çš„é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ<code>é”å‡çº§</code>ã€‚é”å‡çº§å°±æ˜¯ç”¨æ›´å¤§ç²’åº¦çš„é”æ›¿ä»£å¤šä¸ªæ›´å°ç²’åº¦çš„é”ï¼Œæ¯”å¦‚ InnoDB ä¸­è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å ç”¨çš„é”ç©ºé—´é™ä½äº†ï¼Œä½†åŒæ—¶æ•°æ®çš„å¹¶å‘åº¦ä¹Ÿä¸‹é™äº†ã€‚</p><hr><h2 id="5-ä¹è§‚é”-æ‚²è§‚é”">5. ä¹è§‚é”/æ‚²è§‚é”</h2><mark class="hl-label green">ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†:ä¹è§‚é”ã€æ‚²è§‚é”</mark> <p>ä»å¯¹å¾…é”çš„æ€åº¦æ¥çœ‹é”çš„è¯ï¼Œå¯ä»¥å°†é”åˆ†æˆä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œä»åå­—ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸¤ç§é”æ˜¯ä¸¤ç§çœ‹å¾…<code>æ•°æ®å¹¶å‘çš„æ€ç»´æ–¹å¼</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”å’Œæ‚²è§‚é”å¹¶ä¸æ˜¯é”ï¼Œè€Œæ˜¯é”çš„<code>è®¾è®¡æ€æƒ³</code>ã€‚</p><h3 id="5-1-æ‚²è§‚é”-Pessimistic-Locking">5.1 æ‚²è§‚é”(Pessimistic Locking)</h3><p>æ‚²è§‚é”æ˜¯ä¸€ç§æ€æƒ³ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œå¯¹æ•°æ®è¢«å…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹æŒä¿å®ˆæ€åº¦ï¼Œä¼šé€šè¿‡æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶æ¥å®ç°ï¼Œä»è€Œä¿è¯æ•°æ®æ“ä½œçš„æ’å®ƒæ€§ã€‚</p><p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š<code>é˜»å¡</code>ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œ ç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚æ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ï¼Œå½“å…¶ä»–çº¿ç¨‹æƒ³è¦è®¿é—®æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦é˜»å¡æŒ‚èµ·ã€‚Javaä¸­<code>synchronized</code>å’Œ<code>ReentrantLock</code>ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p><p><strong>ç§’æ€æ¡ˆä¾‹1ï¼š</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713204544767.png" alt="image-20220713204544767"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713205010502.png" alt="image-20220713205010502"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713205135694.png" alt="image-20220713205135694"  /><hr><h3 id="5-2-ä¹è§‚é”-Optimistic-Locking">5.2 ä¹è§‚é”(Optimistic Locking)</h3><p>ä¹è§‚é”è®¤ä¸ºå¯¹åŒä¸€æ•°æ®çš„å¹¶å‘æ“ä½œä¸ä¼šæ€»å‘ç”Ÿï¼Œå±äºå°æ¦‚ç‡äº‹ä»¶ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œä¹Ÿå°±æ˜¯<span class='p green'>ä¸é‡‡ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶</span>ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºæ¥å®ç°ã€‚åœ¨ç¨‹åºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>ç‰ˆæœ¬å·æœºåˆ¶</code>æˆ–è€…<code>CASæœºåˆ¶</code>å®ç°ã€‚<span class='p green'>ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡</span>ã€‚åœ¨Javaä¸­<code>java.util.concurrent.atomic</code>åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼šCASå®ç°çš„ã€‚</p><mark class="hl-label pink">1.ä¹è§‚é”çš„ç‰ˆæœ¬å·æœºåˆ¶</mark> <p>åœ¨è¡¨ä¸­è®¾è®¡ä¸€ä¸ª<code>ç‰ˆæœ¬å­—æ®µ version</code>ï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™ï¼Œä¼šè·å– version å­—æ®µçš„å–å€¼ã€‚ç„¶åå¯¹æ•°æ®è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ï¼Œä¼šæ‰§è¡Œ<code>UPDATE ... SET version=version+1 WHERE version=version</code>ã€‚æ­¤æ—¶ å¦‚æœå·²ç»æœ‰äº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œäº†æ›´æ”¹ï¼Œä¿®æ”¹å°±ä¸ä¼šæˆåŠŸã€‚</p><p>è¿™ç§æ–¹å¼ç±»ä¼¼æˆ‘ä»¬ç†Ÿæ‚‰çš„SVNã€CVSç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†ä»£ç è¿›è¡Œæäº¤æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥å½“å‰ç‰ˆæœ¬å·ä¸æœåŠ¡å™¨ä¸Šçš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´å°±å¯ä»¥ç›´æ¥æäº¤ï¼Œå¦‚æœä¸ä¸€è‡´å°±éœ€è¦æ›´æ–°æœåŠ¡å™¨ä¸Šçš„æœ€æ–°ä»£ç ï¼Œç„¶åå†è¿›è¡Œæäº¤ã€‚</p><mark class="hl-label pink">2.ä¹è§‚é”çš„æ—¶é—´æˆ³æœºåˆ¶</mark> <p>æ—¶é—´æˆ³å’Œç‰ˆæœ¬å·æœºåˆ¶ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™ï¼Œå°†å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å’Œæ›´æ–°ä¹‹å‰å–å¾—çš„æ—¶é—´æˆ³è¿›è¡Œ æ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ä¸€è‡´åˆ™æ›´æ–°æˆåŠŸï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚</p><p>ä½ èƒ½çœ‹åˆ°ä¹è§‚é”å°±æ˜¯ç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•°æ®å¹¶å‘æ“ä½œçš„æƒé™ï¼ŒåŸºæœ¬æ˜¯é€šè¿‡ç»™æ•°æ®è¡Œå¢åŠ ä¸€ä¸ªæˆ³ï¼ˆç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ï¼‰ï¼Œä»è€Œè¯æ˜å½“å‰æ‹¿åˆ°çš„æ•°æ®æ˜¯å¦æœ€æ–°ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713210951100.png" alt="image-20220713210951100"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713211139670.png" alt="image-20220713211139670"  /><hr><h3 id="5-3-ä¸¤ç§é”çš„é€‚ç”¨åœºæ™¯">5.3 ä¸¤ç§é”çš„é€‚ç”¨åœºæ™¯</h3><p>ä»è¿™ä¸¤ç§é”çš„è®¾è®¡æ€æƒ³ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”çš„é€‚ç”¨åœºæ™¯ï¼š</p><p>1.<code>ä¹è§‚é”</code>é€‚åˆ<code>è¯»æ“ä½œå¤š</code>çš„åœºæ™¯ï¼Œç›¸å¯¹æ¥è¯´å†™çš„æ“ä½œæ¯”è¾ƒå°‘ã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äº<code>ç¨‹åºå®ç°</code>ï¼Œ<code>ä¸å­˜åœ¨æ­»é”</code>é—®é¢˜ï¼Œä¸è¿‡é€‚ç”¨åœºæ™¯ä¹Ÿä¼šç›¸å¯¹ä¹è§‚ï¼Œå› ä¸ºå®ƒé˜»æ­¢ä¸äº†é™¤äº†ç¨‹åºä»¥å¤–çš„æ•°æ®åº“æ“ä½œã€‚<br>2.<code>æ‚²è§‚é”</code>é€‚åˆ<code>å†™æ“ä½œå¤š</code>çš„åœºæ™¯ï¼Œå› ä¸ºå†™çš„æ“ä½œå…·æœ‰<code>æ’å®ƒæ€§</code>ã€‚é‡‡ç”¨æ‚²è§‚é”çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨æ•°æ®åº“å±‚ é¢é˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥æ•°æ®çš„æ“ä½œæƒé™ï¼Œé˜²æ­¢<code>è¯» - å†™</code>å’Œ<code>å†™ - å†™</code>çš„å†²çªã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713211417909.png" alt="image-20220713211417909" /><hr><h2 id="6-æ˜¾å¼é”-éšå¼é”">6. æ˜¾å¼é”/éšå¼é”</h2><mark class="hl-label green">æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†ï¼šæ˜¾å¼é”ã€éšå¼é”</mark> <h3 id="6-1-éšå¼é”">6.1 éšå¼é”</h3><p>ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œ<code>INSERT</code>æ“ä½œæ—¶ï¼Œå¦‚æœå³å°†æ’å…¥çš„<code>é—´éš™</code>å·²ç»è¢«å…¶ä»–äº‹åŠ¡åŠ äº†<code>gapé”</code>ï¼Œé‚£ä¹ˆæœ¬æ¬¡<code>INSERT</code>æ“ä½œä¼šé˜»å¡ï¼Œå¹¶ä¸”å½“å‰äº‹åŠ¡ä¼šåœ¨è¯¥é—´éš™ä¸ŠåŠ ä¸€ä¸ª<code>æ’å…¥æ„å‘é”</code>ï¼Œå¦åˆ™ä¸€èˆ¬æƒ…å†µä¸‹<code>INSERT</code>æ“ä½œæ˜¯ä¸åŠ é”çš„ã€‚é‚£å¦‚æœä¸€ä¸ªäº‹åŠ¡é¦–å…ˆæ’å…¥äº†ä¸€æ¡è®°å½•ï¼ˆæ­¤æ—¶å¹¶æ²¡æœ‰åœ¨å†…å­˜ç”Ÿäº§ä¸è¯¥è®°å½•å…³è”çš„é”ç»“æ„ï¼‰ï¼Œç„¶åå¦ä¸€ä¸ªäº‹åŠ¡ï¼š</p><ul><li><p>ç«‹å³ä½¿ç”¨<code>SELECT ... LOCK IN SHARE MODE</code>è¯­å¥è¯»å–è¿™æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¦è·å–è¿™æ¡è®°å½•çš„Sé”ï¼Œæˆ–è€…ä½¿ç”¨<code>SELECT ... FOR UPDATE</code>è¯­å¥è¯»å–è¿™æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¦è·å–è¿™æ¡è®°å½•çš„<code>Xé”</code>ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¦‚æœå…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œé‚£ä¹ˆå¯èƒ½äº§ç”Ÿè„è¯»é—®é¢˜ã€‚</p></li><li><p>ç«‹å³ä¿®æ”¹è¿™æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¦è·å–è¿™æ¡è®°å½•çš„xé”ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¦‚æœå…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œé‚£ä¹ˆå¯èƒ½äº§ç”Ÿè„å†™é—®é¢˜ã€‚</p></li></ul><p>è¿™æ—¶å€™æˆ‘ä»¬å‰è¾¹æè¿‡çš„<code>äº‹åŠ¡id</code>åˆè¦èµ·ä½œç”¨äº†ã€‚æˆ‘ä»¬æŠŠèšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•ä¸­çš„è®°å½•åˆ†å¼€çœ‹ä¸€ä¸‹ï¼š</p><ul><li><strong>æƒ…æ™¯ä¸€</strong>ï¼šå¯¹äºèšç°‡ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ‰ä¸€ä¸ª<code>trx_id</code>éšè—åˆ—ï¼Œè¯¥éšè—åˆ—è®°å½•ç€æœ€åæ”¹åŠ¨è¯¥è®°å½•çš„<code>äº‹åŠ¡ id</code>ã€‚é‚£ä¹ˆå¦‚æœåœ¨å½“å‰äº‹åŠ¡ä¸­æ–°æ’å…¥ä¸€æ¡èšç°‡ç´¢å¼•è®°å½•åï¼Œè¯¥è®°å½•çš„ trx_id éšè—åˆ—ä»£è¡¨çš„çš„å°±æ˜¯ å½“å‰äº‹åŠ¡çš„ äº‹åŠ¡id ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡æ­¤æ—¶æƒ³å¯¹è¯¥è®°å½•æ·»åŠ  Sé” æˆ–è€… Xé” æ—¶ï¼Œé¦–å…ˆä¼šçœ‹ä¸€ä¸‹è¯¥è®°å½•çš„ trx_id éšè—åˆ—ä»£è¡¨çš„äº‹åŠ¡æ˜¯å¦æ˜¯å½“å‰çš„æ´»è·ƒäº‹åŠ¡ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆå°±å¸®åŠ©å½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ª X é” ï¼ˆä¹Ÿå°±æ˜¯ä¸ºå½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ is_waiting å±æ€§æ˜¯ false ï¼‰ï¼Œç„¶åè‡ªå·±è¿›å…¥ç­‰å¾…çŠ¶æ€ ï¼ˆä¹Ÿå°±æ˜¯ä¸ºè‡ªå·±ä¹Ÿåˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ is_waiting å±æ€§æ˜¯ true ï¼‰ã€‚</li><li><strong>æƒ…æ™¯äºŒ</strong>ï¼šå¯¹äºäºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ¬èº«å¹¶æ²¡æœ‰ trx_id éšè—åˆ—ï¼Œä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•é¡µé¢çš„ Page Header éƒ¨åˆ†æœ‰ä¸€ä¸ª<code>PAGE_MAX_TRX_ID</code>å±æ€§ï¼Œè¯¥å±æ€§ä»£è¡¨å¯¹è¯¥é¡µé¢åšæ”¹åŠ¨çš„æœ€å¤§çš„<code>äº‹åŠ¡id</code>ï¼Œå¦‚ æœ PAGE_MAX_TRX_ID å±æ€§å€¼å°äºå½“å‰æœ€å°çš„æ´»è·ƒ äº‹åŠ¡id ï¼Œé‚£ä¹ˆè¯´æ˜å¯¹è¯¥é¡µé¢åšä¿®æ”¹çš„äº‹åŠ¡éƒ½å·² ç»æäº¤äº†ï¼Œå¦åˆ™å°±éœ€è¦åœ¨é¡µé¢ä¸­å®šä½åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œç„¶åå›è¡¨æ‰¾åˆ°å®ƒå¯¹åº”çš„èšç°‡ç´¢å¼•è®° å½•ï¼Œç„¶åå†é‡å¤ æƒ…æ™¯ä¸€ çš„åšæ³•ã€‚</li></ul><p>å³ï¼šä¸€ä¸ªäº‹åŠ¡å¯¹æ–°æ’å…¥çš„è®°å½•å¯ä»¥ä¸æ˜¾å¼çš„åŠ é”ï¼ˆç”Ÿæˆä¸€ä¸ªé”ç»“æ„ï¼‰ï¼Œä½†æ˜¯ç”±äº<code>äº‹åŠ¡id</code>çš„å­˜åœ¨ï¼Œç›¸å½“äºåŠ äº†ä¸€ä¸ª<code>éšå¼é”</code>ã€‚åˆ«çš„äº‹åŠ¡åœ¨å¯¹è¿™æ¡è®°å½•åŠ <code>Sé”</code>æˆ–è€…<code>Xé”</code>æ—¶ï¼Œç”±äº<code>éšå¼é”</code>çš„å­˜åœ¨ï¼Œä¼šå…ˆå¸®åŠ©å½“å‰äº‹åŠ¡ç”Ÿæˆä¸€ä¸ªé”ç»“æ„ï¼Œ ç„¶åè‡ªå·±å†ç”Ÿæˆä¸€ä¸ªé”ç»“æ„åè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚éšå¼é”æ˜¯ä¸€ç§<code>å»¶è¿ŸåŠ é”</code>çš„æœºåˆ¶ï¼Œä»è€Œæ¥å‡å°‘åŠ é”çš„æ•°é‡ã€‚</p><p>éšå¼é”åœ¨å®é™…å†…å­˜å¯¹è±¡ä¸­å¹¶ä¸å«æœ‰è¿™ä¸ªé”ä¿¡æ¯ã€‚åªæœ‰å½“äº§ç”Ÿé”ç­‰å¾…æ—¶ï¼Œéšå¼é”è½¬åŒ–ä¸ºæ˜¾å¼é”ã€‚</p><p>InnoDB çš„ insertæ“ä½œï¼Œå¯¹æ’å…¥çš„è®°å½•ä¸åŠ é”ï¼Œä½†æ˜¯æ­¤æ—¶å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå½“å‰è¯»ï¼Œç±»ä¼¼ä»¥ä¸‹çš„ç”¨ä¾‹ï¼Œsession 2 ä¼šé”ç­‰å¾… session 1ï¼Œ é‚£ä¹ˆè¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p><strong>session 1:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="number">34</span>,&quot;å‘¨å…«&quot;,&quot;äºŒç­&quot;);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><strong>session 2:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student lock <span class="keyword">in</span> share mode; #æ‰§è¡Œå®Œï¼Œå½“å‰äº‹åŠ¡è¢«é˜»å¡</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹è¿°è¯­å¥ï¼Œè¾“å‡ºç»“æœï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.data_lock_waits\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">              ENGINE: INNODB</span><br><span class="line">   REQUESTING_ENGINE_LOCK_ID: <span class="number">140562531358232</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">9</span>:<span class="number">140562535668584</span></span><br><span class="line">REQUESTING_ENGINE_TRANSACTION_ID: <span class="number">422037508068888</span></span><br><span class="line">      REQUESTING_THREAD_ID: <span class="number">64</span></span><br><span class="line">       REQUESTING_EVENT_ID: <span class="number">6</span></span><br><span class="line">REQUESTING_OBJECT_INSTANCE_BEGIN: <span class="number">140562535668584</span></span><br><span class="line">     BLOCKING_ENGINE_LOCK_ID: <span class="number">140562531351768</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">9</span>:<span class="number">140562535619104</span></span><br><span class="line">  BLOCKING_ENGINE_TRANSACTION_ID: <span class="number">15902</span></span><br><span class="line">        BLOCKING_THREAD_ID: <span class="number">64</span></span><br><span class="line">         BLOCKING_EVENT_ID: <span class="number">6</span></span><br><span class="line">  BLOCKING_OBJECT_INSTANCE_BEGIN: <span class="number">140562535619104</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>éšå¼é”çš„é€»è¾‘è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>A. InnoDBçš„æ¯æ¡è®°å½•ä¸­éƒ½ä¸€ä¸ªéšå«çš„trx_idå­—æ®µï¼Œè¿™ä¸ªå­—æ®µå­˜åœ¨äºèšç°‡ç´¢å¼•çš„B+Treeä¸­ã€‚</p><p>B. åœ¨æ“ä½œä¸€æ¡è®°å½•å‰ï¼Œé¦–å…ˆæ ¹æ®è®°å½•ä¸­çš„trx_idæ£€æŸ¥è¯¥äº‹åŠ¡æ˜¯å¦æ˜¯æ´»åŠ¨çš„äº‹åŠ¡(æœªæäº¤æˆ–å›æ»š)ã€‚å¦‚æœæ˜¯æ´»åŠ¨çš„äº‹åŠ¡ï¼Œé¦–å…ˆå°†<code>éšå¼é”</code>è½¬æ¢ä¸º<code>æ˜¾å¼é”</code>(å°±æ˜¯ä¸ºè¯¥äº‹åŠ¡æ·»åŠ ä¸€ä¸ªé”)ã€‚</p><p>C. æ£€æŸ¥æ˜¯å¦æœ‰é”å†²çªï¼Œå¦‚æœæœ‰å†²çªï¼Œåˆ›å»ºé”ï¼Œå¹¶è®¾ç½®ä¸ºwaitingçŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰å†²çªä¸åŠ é”ï¼Œè·³åˆ°Eã€‚</p><p>D. ç­‰å¾…åŠ é”æˆåŠŸï¼Œè¢«å”¤é†’ï¼Œæˆ–è€…è¶…æ—¶ã€‚</p><p>E. å†™æ•°æ®ï¼Œå¹¶å°†è‡ªå·±çš„trx_idå†™å…¥trx_idå­—æ®µã€‚</p><hr><h3 id="6-2-æ˜¾å¼é”">6.2 æ˜¾å¼é”</h3><p>é€šè¿‡ç‰¹å®šçš„è¯­å¥è¿›è¡ŒåŠ é”ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¾ç¤ºåŠ é”ï¼Œä¾‹å¦‚ï¼š</p><p>æ˜¾ç¤ºåŠ å…±äº«é”ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .... lock <span class="keyword">in</span> share mode</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºåŠ æ’å®ƒé”ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .... <span class="keyword">for</span> <span class="keyword">update</span></span><br></pre></td></tr></table></figure><hr><h2 id="7-å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”">7. å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”</h2><p>å…¨å±€é”å°±æ˜¯å¯¹<code>æ•´ä¸ªæ•°æ®åº“å®ä¾‹</code>åŠ é”ã€‚å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äº<code>åªè¯»çŠ¶æ€</code>çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹å å…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“ æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚å…¨å±€é”çš„å…¸å‹ä½¿ç”¨<code>åœºæ™¯</code>æ˜¯ï¼šåš<code>å…¨åº“é€»è¾‘å¤‡ä»½</code>ã€‚</p><p>å…¨å±€é”çš„å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flush tables <span class="keyword">with</span> read lock</span><br></pre></td></tr></table></figure><hr><h2 id="8-å…¶å®ƒé”ä¹‹ï¼šæ­»é”">8. å…¶å®ƒé”ä¹‹ï¼šæ­»é”</h2><h3 id="8-1-æ¦‚å¿µ">8.1 æ¦‚å¿µ</h3><p>ä¸¤ä¸ªäº‹åŠ¡éƒ½æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾ï¼Œå¹¶ä¸”åŒæ–¹éƒ½ä¸ä¼šé‡Šæ”¾è‡ªå·±çš„é”ã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713220714098.png" alt="image-20220713220714098"></p><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p>ç”¨æˆ·Aç»™ç”¨æˆ·Bè½¬è´¦100ï¼Œå†æ¬¡åŒæ—¶ï¼Œç”¨æˆ·Bä¹Ÿç»™ç”¨æˆ·Aè½¬è´¦100ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯èƒ½å¯¼è‡´æ­»é”ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713220936236.png" alt="image-20220713220936236" style="float:left;" /><h3 id="8-2-äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶">8.2 äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶</h3><ol><li>ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šäº‹åŠ¡</li><li>æ¯ä¸ªäº‹åŠ¡éƒ½å·²ç»æŒæœ‰é”å¹¶ä¸”ç”³è¯·æ–°çš„é”</li><li>é”èµ„æºåŒæ—¶åªèƒ½è¢«åŒä¸€ä¸ªäº‹åŠ¡æŒæœ‰æˆ–è€…ä¸å…¼å®¹</li><li>äº‹åŠ¡ä¹‹é—´å› ä¸ºæŒæœ‰é”å’Œç”³è¯·é”å¯¼è‡´å½¼æ­¤å¾ªç¯ç­‰å¾…</li></ol><blockquote><p>æ­»é”çš„å…³é”®åœ¨äºï¼šä¸¤ä¸ªï¼ˆæˆ–ä»¥ä¸Šï¼‰çš„SessionåŠ é”çš„é¡ºåºä¸ä¸€è‡´ã€‚</p></blockquote><h3 id="8-3-å¦‚ä½•å¤„ç†æ­»é”">8.3 å¦‚ä½•å¤„ç†æ­»é”</h3><p>**æ–¹å¼1ï¼š**ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼ˆinnodb_lock_wait_timeout=50s)</p><p>å³å½“ä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…æ—¶ï¼Œå½“â€”ä¸ªäº‹åŠ¡ç­‰å¾…æ—¶é—´è¶…è¿‡è®¾ç½®çš„åœ‹å€¼æ—¶ï¼Œå°±å°†å…¶å›æ»šï¼Œå¦å¤–äº‹åŠ¡ç»§ç»­è¿›è¡Œã€‚è¿™ç§æ–¹æ³•ç®€å•æœ‰æ•ˆï¼Œåœ¨innodbä¸­ï¼Œå‚æ•°<code>innodb_lock_wait_timeout</code>ç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p><p>ç¼ºç‚¹ï¼šå¯¹äºåœ¨çº¿æœåŠ¡æ¥è¯´ï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´å¾€å¾€æ˜¯æ— æ³•æ¥å—çš„ã€‚</p><p>é‚£å°†æ­¤å€¼ä¿®æ”¹çŸ­ä¸€äº›ï¼Œæ¯”å¦‚1sï¼Œ0.1sæ˜¯å¦åˆé€‚ï¼Ÿä¸åˆé€‚ï¼Œå®¹æ˜“è¯¯ä¼¤åˆ°æ™®é€šçš„é”ç­‰å¾…ã€‚</p><p>**æ–¹å¼2ï¼š**ä½¿ç”¨æ­»é”æ£€æµ‹å¤„ç†æ­»é”ç¨‹åº</p><p>æ–¹å¼1æ£€æµ‹æ­»é”å¤ªè¿‡è¢«åŠ¨ï¼Œinnodbè¿˜æä¾›äº†<code>wait-for graphç®—æ³•</code>æ¥ä¸»åŠ¨è¿›è¡Œæ­»é”æ£€æµ‹ï¼Œæ¯å½“åŠ é”è¯·æ±‚æ— æ³•ç«‹å³æ»¡è¶³éœ€è¦å¹¶è¿›å…¥ç­‰å¾…æ—¶ï¼Œwait-for graphç®—æ³•éƒ½ä¼šè¢«è§¦å‘ã€‚</p><p>è¿™æ˜¯ä¸€ç§è¾ƒä¸º<code>ä¸»åŠ¨çš„æ­»é”æ£€æµ‹æœºåˆ¶</code>ï¼Œè¦æ±‚æ•°æ®åº“ä¿å­˜<code>é”çš„ä¿¡æ¯é“¾è¡¨</code>å’Œ<code>äº‹åŠ¡ç­‰å¾…é“¾è¡¨</code>ä¸¤éƒ¨åˆ†ä¿¡æ¯ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713221758941.png" alt="image-20220713221758941" style="zoom:67%;" /><p>åŸºäºè¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå¯ä»¥ç»˜åˆ¶wait-for graphï¼ˆç­‰å¾…å›¾ï¼‰</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220713221830455.png" alt="image-20220713221830455" style="zoom:67%;" /><blockquote><p>æ­»é”æ£€æµ‹çš„åŸç†æ˜¯æ„å»ºä¸€ä¸ªä»¥äº‹åŠ¡ä¸ºé¡¶ç‚¹ï¼Œé”ä¸ºè¾¹çš„æœ‰å‘å›¾ï¼Œåˆ¤æ–­æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯ï¼Œå­˜åœ¨æ—¢æœ‰æ­»é”ã€‚</p></blockquote><p>ä¸€æ—¦æ£€æµ‹åˆ°å›è·¯ã€æœ‰æ­»é”ï¼Œè¿™æ—¶å€™InnoDBå­˜å‚¨å¼•æ“ä¼šé€‰æ‹©<code>å›æ»šundoé‡æœ€å°çš„äº‹åŠ¡</code>ï¼Œè®©å…¶ä»–äº‹åŠ¡ç»§ç»­æ‰§è¡Œï¼ˆ<code>innodb_deadlock_detect=on</code>è¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ï¼‰ã€‚</p><p>ç¼ºç‚¹ï¼šæ¯ä¸ªæ–°çš„è¢«é˜»å¡çš„çº¿ç¨‹ï¼Œéƒ½è¦åˆ¤æ–­æ˜¯ä¸æ˜¯ç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”ï¼Œè¿™ä¸ªæ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚å¦‚æœ100ä¸ªå¹¶å‘çº¿ç¨‹åŒæ—¶æ›´æ–°åŒä¸€è¡Œï¼Œæ„å‘³ç€è¦æ£€æµ‹100*100=1ä¸‡æ¬¡ï¼Œ1ä¸‡ä¸ªçº¿ç¨‹å°±ä¼šæœ‰1åƒä¸‡æ¬¡æ£€æµ‹ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼Ÿ</strong></p><ul><li>æ–¹å¼1ï¼šå…³é—­æ­»é”æ£€æµ‹ï¼Œä½†æ„å‘³ç€å¯èƒ½ä¼šå‡ºç°å¤§é‡çš„è¶…æ—¶ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡æœ‰æŸã€‚</li><li>æ–¹å¼2ï¼šæ§åˆ¶å¹¶å‘è®¿é—®çš„æ•°é‡ã€‚æ¯”å¦‚åœ¨ä¸­é—´ä»¶ä¸­å®ç°å¯¹äºç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿï¼Œè¿™æ ·åœ¨InnoDBå†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œã€‚</li></ul><p><strong>è¿›ä¸€æ­¥çš„æ€è·¯ï¼š</strong></p><p>å¯ä»¥è€ƒè™‘é€šè¿‡å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘<code>é”å†²çª</code>ã€‚æ¯”å¦‚ï¼Œè¿é”è¶…å¸‚è´¦æˆ·æ€»é¢çš„è®°å½•ï¼Œå¯ä»¥è€ƒè™‘æ”¾åˆ°å¤šæ¡è®°å½•ä¸Šã€‚è´¦æˆ·æ€»é¢ç­‰äºè¿™å¤šä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚</p><hr><h3 id="8-4-å¦‚ä½•é¿å…æ­»é”">8.4 å¦‚ä½•é¿å…æ­»é”</h3><ul><li><p>åˆç†è®¾è®¡ç´¢å¼•ï¼Œä½¿ä¸šåŠ¡ SQL å°½å¯èƒ½é€šè¿‡ç´¢å¼•å®šä½æ›´å°‘çš„è¡Œï¼Œå‡å°‘é”ç«äº‰ã€‚</p></li><li><p>è°ƒæ•´ä¸šåŠ¡é€»è¾‘ SQLæ‰§è¡Œé¡ºåºï¼Œé¿å… update/delete é•¿æ—¶é—´æŒæœ‰é”çš„SQL åœ¨äº‹åŠ¡å‰é¢ã€‚</p></li><li><p>é¿å…å¤§äº‹åŠ¡ï¼Œå°½é‡å°†å¤§äº‹åŠ¡æ‹†æˆå¤šä¸ªå°äº‹åŠ¡æ¥å¤„ç†ï¼Œå°äº‹åŠ¡ç¼©çŸ­é”å®šèµ„æºçš„æ—¶é—´ï¼Œå‘ç”Ÿé”å†²çªçš„å‡ ç‡ä¹Ÿæ›´å°ã€‚</p></li><li><p>åœ¨å¹¶å‘æ¯”è¾ƒé«˜çš„ç³»ç»Ÿä¸­ï¼Œä¸è¦æ˜¾å¼åŠ é”ï¼Œç‰¹åˆ«æ˜¯æ˜¯åœ¨äº‹åŠ¡é‡Œæ˜¾å¼åŠ é”ã€‚å¦‚ selectâ€¦ for update è¯­å¥ï¼Œå¦‚æœæ˜¯åœ¨äº‹åŠ¡é‡Œè¿è¡Œäº† start transaction æˆ–è®¾ç½®äº†autocommit ç­‰äº0ï¼Œé‚£ä¹ˆå°±ä¼šé”å®šæ‰€æŸ¥æ‰¾åˆ°çš„è®°å½•ã€‚</p></li><li><p>é™ä½éš”ç¦»çº§åˆ«ã€‚å¦‚æœä¸šåŠ¡å…è®¸ï¼Œå°†éš”ç¦»çº§åˆ«è°ƒä½ä¹Ÿæ˜¯è¾ƒå¥½çš„é€‰æ‹©ï¼Œæ¯”å¦‚å°†éš”ç¦»çº§åˆ«ä»RRè°ƒæ•´ä¸ºRCï¼Œå¯ä»¥é¿å…æ‰å¾ˆå¤šå› ä¸ºgapé”é€ æˆçš„æ­»é”ã€‚</p></li></ul><hr><h2 id="9-é”çš„å†…éƒ¨ç»“æ„">9. é”çš„å†…éƒ¨ç»“æ„</h2><p>æˆ‘ä»¬å‰è¾¹è¯´å¯¹ä¸€æ¡è®°å½•åŠ é”çš„æœ¬è´¨å°±æ˜¯åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ª<code>é”ç»“æ„</code>ä¸ä¹‹å…³è”ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡å¯¹å¤šæ¡è®°å½•åŠ é”ï¼Œå°±è¦åˆ›å»ºå¤šä¸ª<code>é”ç»“æ„</code>å‘¢ï¼Ÿæ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># äº‹åŠ¡T1</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br></pre></td></tr></table></figure><p>ç†è®ºä¸Šåˆ›å»ºå¤šä¸ª<code>é”ç»“æ„</code>æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªäº‹åŠ¡è¦è·å–10000æ¡è®°å½•çš„é”ï¼Œç”Ÿæˆ10000ä¸ªé”ç»“æ„ä¹Ÿå¤ªå´©æºƒäº†ï¼æ‰€ä»¥å†³å®šåœ¨å¯¹ä¸åŒè®°å½•åŠ é”æ—¶ï¼Œå¦‚æœç¬¦åˆä¸‹è¾¹è¿™äº›æ¡ä»¶çš„è®°å½•ä¼šæ”¾åœ¨ä¸€ä¸ª<code>é”ç»“æ„</code>ä¸­ã€‚</p><ul><li>åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡ŒåŠ é”æ“ä½œ</li><li>è¢«åŠ é”çš„è®°å½•åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­</li><li>åŠ é”çš„ç±»å‹æ˜¯ä¸€æ ·çš„</li><li>ç­‰å¾…çŠ¶æ€æ˜¯ä¸€æ ·çš„</li></ul><p><code>InnoDB</code>å­˜å‚¨å¼•æ“ä¸­çš„<code>é”ç»“æ„</code>å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714132306208.png" alt="image-20220714132306208" style="zoom:67%;" /><p>ç»“æ„è§£æï¼š</p><p><code>1. é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯</code>ï¼š</p><p>ä¸è®ºæ˜¯<code>è¡¨é”</code>è¿˜æ˜¯<code>è¡Œé”</code>ï¼Œéƒ½æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ï¼Œå“ªä¸ªäº‹åŠ¡ç”Ÿæˆäº†è¿™ä¸ªé”ç»“æ„ ï¼Œè¿™é‡Œå°±è®°å½•è¿™ä¸ª äº‹åŠ¡çš„ä¿¡æ¯ã€‚</p><p>æ­¤<code>é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯</code>åœ¨å†…å­˜ç»“æ„ä¸­åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆå¯ä»¥æ‰¾åˆ°å†…å­˜ä¸­å…³äºè¯¥äº‹åŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œæ¯”æ–¹è¯´äº‹åŠ¡idç­‰ã€‚</p><p><code>2. ç´¢å¼•ä¿¡æ¯</code>ï¼š</p><p>å¯¹äº<code>è¡Œé”</code>æ¥è¯´ï¼Œéœ€è¦è®°å½•ä¸€ä¸‹åŠ é”çš„è®°å½•æ˜¯å±äºå“ªä¸ªç´¢å¼•çš„ã€‚è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚</p><p><code>3. è¡¨é”ï¼è¡Œé”ä¿¡æ¯</code>ï¼š</p><p><code>è¡¨é”ç»“æ„</code>å’Œ<code>è¡Œé”ç»“æ„</code>åœ¨è¿™ä¸ªä½ç½®çš„å†…å®¹æ˜¯ä¸åŒçš„ï¼š</p><ul><li><p>è¡¨é”ï¼š</p><p>è®°è½½ç€æ˜¯å¯¹å“ªä¸ªè¡¨åŠ çš„é”ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›ä¿¡æ¯ã€‚</p></li><li><p>è¡Œé”ï¼š</p><p>è®°è½½äº†ä¸‰ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š</p><p>*<code>Space ID</code>ï¼šè®°å½•æ‰€åœ¨è¡¨ç©ºé—´ã€‚<br>*<code>Page Number</code>ï¼šè®°å½•æ‰€åœ¨é¡µå·ã€‚<br>*<code>n_bits</code>ï¼šå¯¹äºè¡Œé”æ¥è¯´ï¼Œä¸€æ¡è®°å½•å°±å¯¹åº”ç€ä¸€ä¸ªæ¯”ç‰¹ä½ï¼Œä¸€ä¸ªé¡µé¢ä¸­åŒ…å«å¾ˆå¤šè®°å½•ï¼Œç”¨ä¸åŒ çš„æ¯”ç‰¹ä½æ¥åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€æ¡è®°å½•åŠ äº†é”ã€‚ä¸ºæ­¤åœ¨è¡Œé”ç»“æ„çš„æœ«å°¾æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œè¿™ä¸ª<code>n_bis</code>å±æ€§ä»£è¡¨ä½¿ç”¨äº†å¤šå°‘æ¯”ç‰¹ä½ã€‚</p><blockquote><p>n_bitsçš„å€¼ä¸€èˆ¬éƒ½æ¯”é¡µé¢ä¸­è®°å½•æ¡æ•°å¤šä¸€äº›ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¹‹ååœ¨é¡µé¢ä¸­æ’å…¥äº†æ–°è®°å½•å ä¹Ÿä¸è‡³äºé‡æ–°åˆ†é…é”ç»“æ„</p></blockquote></li></ul><p><code>4. type_mode</code>ï¼š</p><p>è¿™æ˜¯ä¸€ä¸ª32ä½çš„æ•°ï¼Œè¢«åˆ†æˆäº†<code>lock_mode</code>ã€<code>lock_type</code>å’Œ<code>rec_lock_type</code>ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714133319666.png" alt="image-20220714133319666"></p><ul><li>é”çš„æ¨¡å¼ï¼ˆ<code>lock_mode</code>ï¼‰ï¼Œå ç”¨ä½4ä½ï¼Œå¯é€‰çš„å€¼å¦‚ä¸‹ï¼š<br>*<code>LOCK_IS</code>ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤ºå…±äº«æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯<code>ISé”</code>ã€‚<br>*<code>LOCK_IX</code>ï¼ˆåè¿›åˆ¶çš„ 1 ï¼‰ï¼šè¡¨ç¤ºç‹¬å æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯<code>IXé”</code>ã€‚<br>*<code>LOCK_S</code>ï¼ˆåè¿›åˆ¶çš„ 2 ï¼‰ï¼šè¡¨ç¤ºå…±äº«é”ï¼Œä¹Ÿå°±æ˜¯<code>Sé”</code>ã€‚<br>*<code>LOCK_X</code>ï¼ˆåè¿›åˆ¶çš„ 3 ï¼‰ï¼šè¡¨ç¤ºç‹¬å é”ï¼Œä¹Ÿå°±æ˜¯<code>Xé”</code>ã€‚<br>*<code>LOCK_AUTO_INC</code>ï¼ˆåè¿›åˆ¶çš„ 4 ï¼‰ï¼šè¡¨ç¤º<code>AUTO-INCé”</code>ã€‚</li></ul><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼ŒLOCK_ISï¼ŒLOCK_IXï¼ŒLOCK_AUTO_INCéƒ½ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼ŒLOCK_Så’Œ LOCK_Xæ—¢å¯ä»¥ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡Œçº§é”çš„æ¨¡å¼ã€‚</p><ul><li>é”çš„ç±»å‹ï¼ˆ<code>lock_type</code>ï¼‰ï¼Œå ç”¨ç¬¬5ï½8ä½ï¼Œä¸è¿‡ç°é˜¶æ®µåªæœ‰ç¬¬5ä½å’Œç¬¬6ä½è¢«ä½¿ç”¨ï¼š<br>*<code>LOCK_TABLE</code>ï¼ˆåè¿›åˆ¶çš„ 16 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬5ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡¨çº§é”ã€‚<br>*<code>LOCK_REC</code>ï¼ˆåè¿›åˆ¶çš„ 32 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬6ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡Œçº§é”ã€‚</li><li>è¡Œé”çš„å…·ä½“ç±»å‹ï¼ˆ<code>rec_lock_type</code>ï¼‰ï¼Œä½¿ç”¨å…¶ä½™çš„ä½æ¥è¡¨ç¤ºã€‚åªæœ‰åœ¨<code>lock_type</code>çš„å€¼ä¸º<code>LOCK_REC</code>æ—¶ï¼Œä¹Ÿå°±æ˜¯åªæœ‰åœ¨è¯¥é”ä¸ºè¡Œçº§é”æ—¶ï¼Œæ‰ä¼šè¢«ç»†åˆ†ä¸ºæ›´å¤šçš„ç±»å‹ï¼š<br>*<code>LOCK_ORDINARY</code>ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤º<code>next-keyé”</code>ã€‚<br>*<code>LOCK_GAP</code>ï¼ˆåè¿›åˆ¶çš„ 512 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬10ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤º<code>gapé”</code>ã€‚<br>*<code>LOCK_REC_NOT_GAP</code>ï¼ˆåè¿›åˆ¶çš„ 1024 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬11ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ­£ç»<code>è®°å½•é”</code>ã€‚<br>*<code>LOCK_INSERT_INTENTION</code>ï¼ˆåè¿›åˆ¶çš„ 2048 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬12ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ’å…¥æ„å‘é”ã€‚å…¶ä»–çš„ç±»å‹ï¼šè¿˜æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„ç±»å‹æˆ‘ä»¬å°±ä¸å¤šè¯´äº†ã€‚<br>*<code>is_waiting</code>å±æ€§å‘¢ï¼ŸåŸºäºå†…å­˜ç©ºé—´çš„èŠ‚çœï¼Œæ‰€ä»¥æŠŠ<code>is_waiting</code>å±æ€§æ”¾åˆ°äº†<code>type_mode</code>è¿™ä¸ª32 ä½çš„æ•°å­—ä¸­ï¼š<br>*<code>LOCK_WAIT</code>ï¼ˆåè¿›åˆ¶çš„ 256 ï¼‰ ï¼šå½“ç¬¬9ä¸ªæ¯”ç‰¹ä½ç½®ä¸º 1 æ—¶ï¼Œè¡¨ç¤º<code>is_waiting</code>ä¸º<code>true</code>ï¼Œä¹Ÿ å°±æ˜¯å½“å‰äº‹åŠ¡å°šæœªè·å–åˆ°é”ï¼Œå¤„åœ¨ç­‰å¾…çŠ¶æ€ï¼›å½“è¿™ä¸ªæ¯”ç‰¹ä½ä¸º 0 æ—¶ï¼Œè¡¨ç¤º<code>is_waiting</code>ä¸º<code>false</code>ï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡è·å–é”æˆåŠŸã€‚</li></ul><p><code>5. å…¶ä»–ä¿¡æ¯</code>ï¼š</p><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å„ç§é”ç»“æ„è€Œè®¾è®¡äº†å„ç§å“ˆå¸Œè¡¨å’Œé“¾è¡¨ã€‚</p><p><code>6. ä¸€å †æ¯”ç‰¹ä½</code>ï¼š</p><p>å¦‚æœæ˜¯<code>è¡Œé”ç»“æ„</code>çš„è¯ï¼Œåœ¨è¯¥ç»“æ„æœ«å°¾è¿˜æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œæ¯”ç‰¹ä½çš„æ•°é‡æ˜¯ç”±ä¸Šè¾¹æåˆ°çš„<code>n_bits</code>å±æ€§ è¡¨ç¤ºçš„ã€‚InnoDBæ•°æ®é¡µä¸­çš„æ¯æ¡è®°å½•åœ¨<code>è®°å½•å¤´ä¿¡æ¯</code>ä¸­éƒ½åŒ…å«ä¸€ä¸ª<code>heap_no</code>å±æ€§ï¼Œä¼ªè®°å½•<code>Infimum</code>çš„<code>heap_no</code>å€¼ä¸º 0 ï¼Œ<code>Supremum</code>çš„<code>heap_no</code>å€¼ä¸º 1 ï¼Œä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œ<code>heap_no</code>å€¼å°±å¢1ã€‚ é”ç»“ æ„ æœ€åçš„ä¸€å †æ¯”ç‰¹ä½å°±å¯¹åº”ç€ä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ï¼Œä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ä¸€ä¸ª<code>heap_no</code>ï¼Œå³ä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ åˆ°é¡µå†…çš„ä¸€æ¡è®°å½•ã€‚</p><hr><h2 id="10-é”ç›‘æ§">10. é”ç›‘æ§</h2><p>å…³äºMySQLé”çš„ç›‘æ§ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡æ£€æŸ¥ InnoDB_row_lock ç­‰çŠ¶æ€å˜é‡æ¥åˆ†æç³»ç»Ÿä¸Šçš„è¡Œé”çš„äº‰å¤ºæƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;innodb_row_lock%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                 <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_current_waits <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_time          <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_time_avg      <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_time_max      <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_waits         <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+-------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>å¯¹å„ä¸ªçŠ¶æ€é‡çš„è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>Innodb_row_lock_current_waitsï¼šå½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡ï¼›<br>*<code>Innodb_row_lock_time</code>ï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦ï¼›ï¼ˆç­‰å¾…æ€»æ—¶é•¿ï¼‰<br>*<code>Innodb_row_lock_time_avg</code>ï¼šæ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é—´ï¼›ï¼ˆç­‰å¾…å¹³å‡æ—¶é•¿ï¼‰</li><li>Innodb_row_lock_time_maxï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€å¸¸çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´ï¼›<br>*<code>Innodb_row_lock_waits</code>ï¼šç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°ï¼›ï¼ˆç­‰å¾…æ€»æ¬¡æ•°ï¼‰</li></ul><p>å¯¹äºè¿™5ä¸ªçŠ¶æ€å˜é‡ï¼Œæ¯”è¾ƒé‡è¦çš„3ä¸ªè§ä¸Šé¢ï¼ˆç°è‰²ï¼‰ã€‚</p><p>å°¤å…¶æ˜¯å½“ç­‰å¾…æ¬¡æ•°å¾ˆé«˜ï¼Œè€Œä¸”æ¯æ¬¡ç­‰å¾…æ—¶é•¿ä¹Ÿä¸å°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ†æç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆä¼šæœ‰å¦‚æ­¤å¤šçš„ç­‰å¾…ï¼Œç„¶åæ ¹æ®åˆ†æç»“æœç€æ‰‹æŒ‡å®šä¼˜åŒ–è®¡åˆ’ã€‚</p><p><strong>å…¶ä»–ç›‘æ§æ–¹æ³•ï¼š</strong></p><p>MySQLæŠŠäº‹åŠ¡å’Œé”çš„ä¿¡æ¯è®°å½•åœ¨äº†<code>information_schema</code>åº“ä¸­ï¼Œæ¶‰åŠåˆ°çš„ä¸‰å¼ è¡¨åˆ†åˆ«æ˜¯<code>INNODB_TRX</code>ã€<code>INNODB_LOCKS</code>å’Œ<code>INNODB_LOCK_WAITS</code>ã€‚</p><p><code>MySQL5.7åŠä¹‹å‰</code>ï¼Œå¯ä»¥é€šè¿‡information_schema.INNODB_LOCKSæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œä½†åªèƒ½çœ‹åˆ°é˜»å¡äº‹ åŠ¡çš„é”ï¼›å¦‚æœäº‹åŠ¡å¹¶æœªè¢«é˜»å¡ï¼Œåˆ™åœ¨è¯¥è¡¨ä¸­çœ‹ä¸åˆ°è¯¥äº‹åŠ¡çš„é”æƒ…å†µã€‚</p><p>MySQL8.0åˆ é™¤äº†information_schema.INNODB_LOCKSï¼Œæ·»åŠ äº†<code>performance_schema.data_locks</code>ï¼Œå¯ä»¥é€šè¿‡performance_schema.data_locksæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œå’ŒMySQL5.7åŠä¹‹å‰ä¸åŒï¼Œ performance_schema.data_locksä¸ä½†å¯ä»¥çœ‹åˆ°é˜»å¡è¯¥äº‹åŠ¡çš„é”ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¯¥äº‹åŠ¡æ‰€æŒæœ‰çš„é”ã€‚</p><p>åŒæ—¶ï¼Œinformation_schema.INNODB_LOCK_WAITSä¹Ÿè¢«<code>performance_schema.data_lock_waits</code>æ‰€ä»£ æ›¿ã€‚</p><p>æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªé”ç­‰å¾…çš„åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä»è¿™ä¸‰å¼ è¡¨æ”¶é›†çš„ä¿¡æ¯</p><p>é”ç­‰å¾…åœºæ™¯ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨è®°å½•é”ä¸­çš„æ¡ˆä¾‹ï¼Œå½“äº‹åŠ¡2è¿›è¡Œç­‰å¾…æ—¶ï¼ŒæŸ¥è¯¢æƒ…å†µå¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰æŸ¥è¯¢æ­£åœ¨è¢«é”é˜»å¡çš„sqlè¯­å¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.INNODB_TRX\G;</span><br></pre></td></tr></table></figure><p>é‡è¦å±æ€§ä»£è¡¨å«ä¹‰å·²åœ¨ä¸Šè¿°ä¸­æ ‡æ³¨ã€‚</p><p>ï¼ˆ2ï¼‰æŸ¥è¯¢é”ç­‰å¾…æƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> data_lock_waits\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">REQUESTING_ENGINE_LOCK_ID: <span class="number">139750145405624</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">7</span>:<span class="number">139747028690608</span></span><br><span class="line">REQUESTING_ENGINE_TRANSACTION_ID: <span class="number">13845</span> #è¢«é˜»å¡çš„äº‹åŠ¡ID</span><br><span class="line">REQUESTING_THREAD_ID: <span class="number">72</span></span><br><span class="line">REQUESTING_EVENT_ID: <span class="number">26</span></span><br><span class="line">REQUESTING_OBJECT_INSTANCE_BEGIN: <span class="number">139747028690608</span></span><br><span class="line">BLOCKING_ENGINE_LOCK_ID: <span class="number">139750145406432</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">7</span>:<span class="number">139747028813248</span></span><br><span class="line">BLOCKING_ENGINE_TRANSACTION_ID: <span class="number">13844</span> #æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡IDï¼Œé˜»å¡äº†<span class="number">13845</span></span><br><span class="line">BLOCKING_THREAD_ID: <span class="number">71</span></span><br><span class="line">BLOCKING_EVENT_ID: <span class="number">24</span></span><br><span class="line">BLOCKING_OBJECT_INSTANCE_BEGIN: <span class="number">139747028813248</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æŸ¥è¯¢é”çš„æƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> performance_schema.data_locks\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">ENGINE_LOCK_ID: <span class="number">139750145405624</span>:<span class="number">1068</span>:<span class="number">139747028693520</span></span><br><span class="line">ENGINE_TRANSACTION_ID: <span class="number">13847</span></span><br><span class="line">THREAD_ID: <span class="number">72</span></span><br><span class="line">EVENT_ID: <span class="number">31</span></span><br><span class="line">OBJECT_SCHEMA: atguigu</span><br><span class="line">OBJECT_NAME: <span class="keyword">user</span></span><br><span class="line">PARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">SUBPARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">INDEX_NAME: <span class="keyword">NULL</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">139747028693520</span></span><br><span class="line">LOCK_TYPE: <span class="keyword">TABLE</span></span><br><span class="line">LOCK_MODE: IX</span><br><span class="line">LOCK_STATUS: GRANTED</span><br><span class="line">LOCK_DATA: <span class="keyword">NULL</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">2.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">ENGINE_LOCK_ID: <span class="number">139750145405624</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">7</span>:<span class="number">139747028690608</span></span><br><span class="line">ENGINE_TRANSACTION_ID: <span class="number">13847</span></span><br><span class="line">THREAD_ID: <span class="number">72</span></span><br><span class="line">EVENT_ID: <span class="number">31</span></span><br><span class="line">OBJECT_SCHEMA: atguigu</span><br><span class="line">OBJECT_NAME: <span class="keyword">user</span></span><br><span class="line">PARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">SUBPARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">INDEX_NAME: <span class="keyword">PRIMARY</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">139747028690608</span></span><br><span class="line">LOCK_TYPE: RECORD</span><br><span class="line">LOCK_MODE: X,REC_NOT_GAP</span><br><span class="line">LOCK_STATUS: WAITING</span><br><span class="line">LOCK_DATA: <span class="number">1</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">3.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">ENGINE_LOCK_ID: <span class="number">139750145406432</span>:<span class="number">1068</span>:<span class="number">139747028816304</span></span><br><span class="line">ENGINE_TRANSACTION_ID: <span class="number">13846</span></span><br><span class="line">THREAD_ID: <span class="number">71</span></span><br><span class="line">EVENT_ID: <span class="number">28</span></span><br><span class="line">OBJECT_SCHEMA: atguigu</span><br><span class="line">OBJECT_NAME: <span class="keyword">user</span></span><br><span class="line">PARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">SUBPARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">INDEX_NAME: <span class="keyword">NULL</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">139747028816304</span></span><br><span class="line">LOCK_TYPE: <span class="keyword">TABLE</span></span><br><span class="line">LOCK_MODE: IX</span><br><span class="line">LOCK_STATUS: GRANTED</span><br><span class="line">LOCK_DATA: <span class="keyword">NULL</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">4.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">ENGINE: INNODB</span><br><span class="line">ENGINE_LOCK_ID: <span class="number">139750145406432</span>:<span class="number">7</span>:<span class="number">4</span>:<span class="number">7</span>:<span class="number">139747028813248</span></span><br><span class="line">ENGINE_TRANSACTION_ID: <span class="number">13846</span></span><br><span class="line">THREAD_ID: <span class="number">71</span></span><br><span class="line">EVENT_ID: <span class="number">28</span></span><br><span class="line">OBJECT_SCHEMA: atguigu</span><br><span class="line">OBJECT_NAME: <span class="keyword">user</span></span><br><span class="line">PARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">SUBPARTITION_NAME: <span class="keyword">NULL</span></span><br><span class="line">INDEX_NAME: <span class="keyword">PRIMARY</span></span><br><span class="line">OBJECT_INSTANCE_BEGIN: <span class="number">139747028813248</span></span><br><span class="line">LOCK_TYPE: RECORD</span><br><span class="line">LOCK_MODE: X,REC_NOT_GAP</span><br><span class="line">LOCK_STATUS: GRANTED</span><br><span class="line">LOCK_DATA: <span class="number">1</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line"><span class="keyword">No</span> query specified</span><br></pre></td></tr></table></figure><p>ä»é”çš„æƒ…å†µå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«è·å–äº†IXé”ï¼Œæˆ‘ä»¬ä»æ„å‘é”ç« èŠ‚å¯ä»¥çŸ¥é“ï¼ŒIXé”äº’ç›¸æ—¶å…¼å®¹çš„ã€‚æ‰€ ä»¥è¿™é‡Œä¸ä¼šç­‰å¾…ï¼Œä½†æ˜¯äº‹åŠ¡1åŒæ ·æŒæœ‰Xé”ï¼Œæ­¤æ—¶äº‹åŠ¡2ä¹Ÿè¦å»åŒä¸€è¡Œè®°å½•è·å–Xé”ï¼Œä»–ä»¬ä¹‹é—´ä¸å…¼å®¹ï¼Œå¯¼ è‡´ç­‰å¾…çš„æƒ…å†µå‘ç”Ÿã€‚</p><hr><h2 id="é™„å½•-é—´éš™é”åŠ é”è§„åˆ™">é™„å½•:é—´éš™é”åŠ é”è§„åˆ™</h2><p>é—´éš™é”åŠ é”è§„åˆ™ï¼ˆå…±11ä¸ªæ¡ˆä¾‹ï¼‰</p><p>é—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ï¼š next-key lockå®é™…ä¸Šæ˜¯ç”±é—´éš™é”åŠ è¡Œé”å®ç°çš„ï¼Œå¦‚æœåˆ‡æ¢åˆ°è¯»æäº¤éš”ç¦»çº§åˆ« (read-committed) çš„è¯ï¼Œå°±å¥½ç†è§£äº†ï¼Œè¿‡ç¨‹ä¸­å»æ‰é—´éš™é”çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åªå‰©ä¸‹è¡Œé”çš„éƒ¨åˆ†ã€‚è€Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹é—´éš™é”å°±æ²¡æœ‰äº†ï¼Œä¸ºäº†è§£å†³å¯èƒ½å‡ºç°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦æŠŠ binlogæ ¼å¼è®¾ç½®ä¸º row ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¸å¤šå…¬å¸çš„é…ç½®ä¸ºï¼šè¯»æäº¤éš”ç¦»çº§åˆ«åŠ  binlog_format=rowã€‚ä¸šåŠ¡ä¸éœ€è¦å¯é‡å¤è¯»çš„ä¿è¯ï¼Œè¿™æ ·è€ƒè™‘åˆ°è¯»æäº¤ä¸‹æ“ä½œæ•°æ®çš„é”èŒƒå›´æ›´å°ï¼ˆæ²¡æœ‰é—´éš™é”ï¼‰ï¼Œè¿™ä¸ªé€‰æ‹©æ˜¯åˆç†çš„ã€‚</p><p>next-key lockçš„åŠ é”è§„åˆ™</p><p>æ€»ç»“çš„åŠ é”è§„åˆ™é‡Œé¢ï¼ŒåŒ…å«äº†ä¸¤ä¸ªåŸåˆ™ã€ä¸¤ä¸ªä¼˜åŒ–å’Œä¸€ä¸ªbug ã€‚</p><ol><li>åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lock ã€‚ next-key lockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚</li><li>åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚ä»»ä½•è¾…åŠ©ç´¢å¼•ä¸Šçš„é”ï¼Œæˆ–è€…éç´¢å¼•åˆ—ä¸Šçš„é”ï¼Œæœ€ç»ˆéƒ½è¦å›æº¯åˆ°ä¸»é”®ä¸Šï¼Œåœ¨ä¸»é”®ä¸Šä¹Ÿè¦åŠ ä¸€æŠŠé”ã€‚</li><li>ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œ next-key locké€€åŒ–ä¸ºè®°å½•é”ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ InnoDBæ‰«æçš„æ˜¯ä¸€ä¸ªä¸»é”®ã€æˆ–æ˜¯ä¸€ä¸ªå”¯ä¸€ç´¢å¼•çš„è¯ï¼Œé‚£InnoDBåªä¼šé‡‡ç”¨è®°å½•é”æ–¹å¼æ¥åŠ é”</li><li>ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Š(ä¸ä¸€å®šæ˜¯å”¯ä¸€ç´¢å¼•)çš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œ next-key locké€€åŒ–ä¸ºé—´éš™é”ã€‚</li><li>ä¸€ä¸ª bug ï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</li></ol><p>æˆ‘ä»¬ä»¥è¡¨testä½œä¸ºä¾‹å­ï¼Œå»ºè¡¨è¯­å¥å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹ï¼šå…¶ä¸­idä¸ºä¸»é”®ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`test`(</span><br><span class="line">`id`<span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`col1`<span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`col2`<span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">KEY`c`(`col1`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test <span class="keyword">values</span></span><br><span class="line">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>),</span><br><span class="line">(<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>),</span><br><span class="line">(<span class="number">20</span>,<span class="number">20</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">25</span>,<span class="number">25</span>,<span class="number">25</span>);</span><br></pre></td></tr></table></figure><div class="tabs" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-1"><i class="fas fa-cat"></i>1</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-2"><i class="fas fa-horse"></i>2</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-3"><i class="fas fa-dove"></i>3</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-4"><i class="fas fa-dragon"></i>4</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-5"><i class="fas fa-seedling"></i>5</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-6"><i class="fas fa-leaf"></i>6</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-7"><i class="fab fa-apple"></i>7</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-8"><i class="fas fa-tree"></i>8</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-9"><i class="fas fa-heartbeat"></i>9</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-10"><i class="fas fa-cookie-bite"></i>10</button></li><li class="tab"><button type="button" data-href="#2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-11"><i class="fas fa-child"></i>11</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-1"><p><mark class="hl-label blue">æ¡ˆä¾‹ä¸€ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é—´éš™é”</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134603698.png" alt="image-20220714134603698" style="zoom:67%;" /><p>ç”±äºè¡¨ test ä¸­æ²¡æœ‰ id=7 çš„è®°å½•</p><p>æ ¹æ®åŸåˆ™ 1 ï¼ŒåŠ é”å•ä½æ˜¯ next-key lock ï¼Œ sessionAåŠ é”èŒƒå›´å°±æ˜¯ (5,10] ï¼› åŒæ—¶æ ¹æ®ä¼˜åŒ–2 ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ (id=7) ï¼Œè€Œ id=10ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œ next-key lock é€€åŒ–æˆé—´éš™é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯ (5,10)</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-2"><p><mark class="hl-label blue">æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é”</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134623052-16577775838551.png" alt="image-20220714134623052" style="zoom:67%;" /><p>è¿™é‡Œ session A è¦ç»™ç´¢å¼•col1ä¸Šcol1=5çš„è¿™ä¸€è¡ŒåŠ ä¸Šè¯»é”ã€‚</p><ol><li>æ ¹æ®åŸåˆ™ 1 ï¼ŒåŠ é”å•ä½æ˜¯ next-key lock ï¼Œå·¦å¼€å³é—­ï¼Œ5æ˜¯é—­ä¸Šçš„ï¼Œå› æ­¤ä¼šç»™ (0,5] åŠ ä¸Š next-key lock ã€‚</li><li>è¦æ³¨æ„ c æ˜¯æ™®é€šç´¢å¼•ï¼Œå› æ­¤ä»…è®¿é—® c=5 è¿™ä¸€æ¡è®°å½•æ˜¯ä¸èƒ½é©¬ä¸Šåœä¸‹æ¥çš„ï¼ˆå¯èƒ½æœ‰col1=5çš„å…¶ä»–è®°å½•ï¼‰ï¼Œéœ€è¦å‘å³éå†ï¼ŒæŸ¥åˆ°c=10æ‰æ”¾å¼ƒã€‚æ ¹æ®åŸåˆ™ 2 ï¼Œè®¿é—®åˆ°çš„éƒ½è¦åŠ é”ï¼Œå› æ­¤è¦ç»™ (5,10] åŠ  next-key lock ã€‚</li><li>ä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ– 2 ï¼šç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ col1=5 è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´éš™é” (5,10) ã€‚</li><li>æ ¹æ®åŸåˆ™ 2 ,åªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•ä¸Šæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ session B çš„ update è¯­å¥å¯ä»¥æ‰§è¡Œå®Œæˆã€‚</li></ol><p>ä½† session C è¦æ’å…¥ä¸€ä¸ª (7,7,7) çš„è®°å½•ï¼Œå°±ä¼šè¢« session A çš„é—´éš™é” (5,10) é”ä½ è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ã€‚</p><p>æ‰§è¡Œ for update æ—¶ï¼Œç³»ç»Ÿä¼šè®¤ä¸ºä½ æ¥ä¸‹æ¥è¦æ›´æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ã€‚</p><p>å¦‚æœä½ è¦ç”¨ lock in share modeæ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå°±å¿…é¡»å¾—ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œå› ä¸ºè¦†ç›–ç´¢å¼•ä¸ä¼šè®¿é—®ä¸»é”®ç´¢å¼•ï¼Œä¸ä¼šç»™ä¸»é”®ç´¢å¼•ä¸ŠåŠ é”</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-3"><p><mark class="hl-label blue">æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”</mark></p><p>ä¸Šé¢ä¸¤ä¸ªä¾‹å­æ˜¯ç­‰å€¼æŸ¥è¯¢çš„ï¼Œè¿™ä¸ªä¾‹å­æ˜¯å…³äºèŒƒå›´æŸ¥è¯¢çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸‹é¢çš„è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">10</span> <span class="keyword">for</span> <span class="keyword">update</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">&gt;=</span><span class="number">10</span> <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="number">11</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134742049.png" alt="image-20220714134742049" style="zoom:67%;" /><ol><li>å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª id=10 çš„è¡Œï¼Œå› æ­¤æœ¬è¯¥æ˜¯ next-key lock(5,10] ã€‚ æ ¹æ®ä¼˜åŒ– 1 ï¼Œä¸»é”® id ä¸Šçš„ç­‰å€¼æ¡ä»¶ï¼Œé€€åŒ–æˆè¡Œé”ï¼ŒåªåŠ äº† id=10 è¿™ä¸€è¡Œçš„è¡Œé”ã€‚</li><li>å®ƒæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œ èŒƒå›´æŸ¥æ‰¾å°±å¾€åç»§ç»­æ‰¾ï¼Œæ‰¾åˆ° id=15 è¿™ä¸€è¡Œåœä¸‹æ¥ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå› æ­¤éœ€è¦åŠ  next-key lock(10,15] ã€‚</li></ol><p>session A è¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé” id=10 å’Œ next-key lock(10,15] ã€‚é¦–æ¬¡ session A å®šä½æŸ¥æ‰¾ id=10 çš„è¡Œçš„æ—¶å€™ï¼Œæ˜¯å½“åšç­‰å€¼æŸ¥è¯¢æ¥åˆ¤æ–­çš„ï¼Œè€Œå‘å³æ‰«æåˆ° id=15 çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢åˆ¤æ–­ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-4"><p><mark class="hl-label blue">æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”</mark></p><p>ä¸æ¡ˆä¾‹ä¸‰ä¸åŒçš„æ˜¯ï¼Œæ¡ˆä¾‹å››ä¸­æŸ¥è¯¢è¯­å¥çš„ where éƒ¨åˆ†ç”¨çš„æ˜¯å­—æ®µ c ï¼Œå®ƒæ˜¯æ™®é€šç´¢å¼•</p><p>è¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134822160.png" alt="image-20220714134822160" style="zoom:67%;" /><p>åœ¨ç¬¬ä¸€æ¬¡ç”¨ col1=10 å®šä½è®°å½•çš„æ—¶å€™ï¼Œç´¢å¼• c ä¸ŠåŠ äº† (5,10] è¿™ä¸ª next-key lock åï¼Œç”±äºç´¢å¼• col1 æ˜¯éå”¯ ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šèœ•å˜ä¸ºè¡Œé”ï¼Œå› æ­¤æœ€ç»ˆ sesion A åŠ çš„é”æ˜¯ï¼Œç´¢å¼• c ä¸Šçš„ (5,10] å’Œ (10,15] è¿™ä¸¤ä¸ª next-keylock ã€‚</p><p>è¿™é‡Œéœ€è¦æ‰«æåˆ° col1=15 æ‰åœæ­¢æ‰«æï¼Œæ˜¯åˆç†çš„ï¼Œå› ä¸º InnoDB è¦æ‰«åˆ° col1=15 ï¼Œæ‰çŸ¥é“ä¸éœ€è¦ç»§ç»­å¾€åæ‰¾äº†ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-5"><p><mark class="hl-label blue">æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”bug</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134846740.png" alt="image-20220714134846740" style="zoom:67%;" /><p>session A æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰ç…§åŸåˆ™ 1 çš„è¯ï¼Œåº”è¯¥æ˜¯ç´¢å¼• id ä¸ŠåªåŠ  (10,15] è¿™ä¸ª next-key lock ï¼Œå¹¶ä¸”å›  ä¸º id æ˜¯å”¯ä¸€é”®ï¼Œæ‰€ä»¥å¾ªç¯åˆ¤æ–­åˆ° id=15 è¿™ä¸€è¡Œå°±åº”è¯¥åœæ­¢äº†ã€‚</p><p>ä½†æ˜¯å®ç°ä¸Šï¼Œ InnoDB ä¼šå¾€å‰æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯ id=20 ã€‚è€Œä¸”ç”±äºè¿™æ˜¯ä¸ªèŒƒå›´æ‰«æï¼Œå› æ­¤ç´¢å¼• id ä¸Šçš„ (15,20] è¿™ä¸ª next-key lock ä¹Ÿä¼šè¢«é”ä¸Šã€‚ç…§ç†è¯´ï¼Œè¿™é‡Œé”ä½ id=20 è¿™ä¸€è¡Œçš„è¡Œä¸ºï¼Œå…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚å› ä¸ºæ‰«æåˆ° id=15 ï¼Œå°±å¯ä»¥ç¡®å®šä¸ç”¨å¾€åå†æ‰¾äº†ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-6"><p><mark class="hl-label blue">æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨ç­‰å€¼çš„ä¾‹å­</mark></p><p>è¿™é‡Œï¼Œæˆ‘ç»™è¡¨ t æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼šinsert into t values(30,10,30);ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨è¡¨é‡Œé¢æœ‰ä¸¤ä¸ªc=10çš„è¡Œ</p><p>ä½†æ˜¯å®ƒä»¬çš„ä¸»é”®å€¼ id æ˜¯ä¸åŒçš„ï¼ˆåˆ†åˆ«æ˜¯ 10 å’Œ 30 ï¼‰ï¼Œå› æ­¤è¿™ä¸¤ä¸ªc=10 çš„è®°å½•ä¹‹é—´ï¼Œä¹Ÿæ˜¯æœ‰é—´éš™çš„ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134923414.png" alt="image-20220714134923414" style="zoom:67%;" /><p>è¿™æ¬¡æˆ‘ä»¬ç”¨ delete è¯­å¥æ¥éªŒè¯ã€‚æ³¨æ„ï¼Œ delete è¯­å¥åŠ é”çš„é€»è¾‘ï¼Œå…¶å®è·Ÿ select â€¦ for update æ˜¯ç±»ä¼¼çš„ï¼Œ ä¹Ÿå°±æ˜¯æˆ‘åœ¨æ–‡ç« å¼€å§‹æ€»ç»“çš„ä¸¤ä¸ª â€œ åŸåˆ™ â€ ã€ä¸¤ä¸ª â€œ ä¼˜åŒ– â€ å’Œä¸€ä¸ª â€œbugâ€ ã€‚</p><p>è¿™æ—¶ï¼Œ session A åœ¨éå†çš„æ—¶å€™ï¼Œå…ˆè®¿é—®ç¬¬ä¸€ä¸ª col1=10 çš„è®°å½•ã€‚åŒæ ·åœ°ï¼Œæ ¹æ®åŸåˆ™ 1 ï¼Œè¿™é‡ŒåŠ çš„æ˜¯ (col1=5,id=5) åˆ° (col1=10,id=10) è¿™ä¸ª next-key lock ã€‚</p><p>ç”±äºcæ˜¯æ™®é€šç´¢å¼•ï¼Œæ‰€ä»¥ç»§ç»­å‘å³æŸ¥æ‰¾ï¼Œç›´åˆ°ç¢°åˆ° (col1=15,id=15) è¿™ä¸€è¡Œå¾ªç¯æ‰ç»“æŸã€‚æ ¹æ®ä¼˜åŒ– 2 ï¼Œè¿™æ˜¯ ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³æŸ¥æ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆ (col1=10,id=10) åˆ° (col1=15,id=15) çš„é—´éš™é”ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714134945012.png" alt="image-20220714134945012" style="zoom:67%;" /><p>è¿™ä¸ª delete è¯­å¥åœ¨ç´¢å¼• c ä¸Šçš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯ä¸Šé¢å›¾ä¸­è“è‰²åŒºåŸŸè¦†ç›–çš„éƒ¨åˆ†ã€‚è¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½ æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´ï¼Œå³ (col1=5,id=5) å’Œ (col1=15,id=15) è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-7"><p><mark class="hl-label blue">æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”</mark></p><p>ä¾‹å­ 6 ä¹Ÿæœ‰ä¸€ä¸ªå¯¹ç…§æ¡ˆä¾‹ï¼Œåœºæ™¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135007118.png" alt="image-20220714135007118" style="zoom:67%;" /><p>session A çš„ delete è¯­å¥åŠ äº† limit 2 ã€‚ä½ çŸ¥é“è¡¨ t é‡Œ c=10 çš„è®°å½•å…¶å®åªæœ‰ä¸¤æ¡ï¼Œå› æ­¤åŠ ä¸åŠ  limit 2 ï¼Œåˆ é™¤çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯åŠ é”æ•ˆæœå´ä¸ä¸€æ ·</p><p>è¿™æ˜¯å› ä¸ºï¼Œæ¡ˆä¾‹ä¸ƒé‡Œçš„ delete è¯­å¥æ˜ç¡®åŠ äº† limit 2 çš„é™åˆ¶ï¼Œå› æ­¤åœ¨éå†åˆ° (col1=10, id=30) è¿™ä¸€è¡Œä¹‹åï¼Œ æ»¡è¶³æ¡ä»¶çš„è¯­å¥å·²ç»æœ‰ä¸¤æ¡ï¼Œå¾ªç¯å°±ç»“æŸäº†ã€‚å› æ­¤ï¼Œç´¢å¼• col1 ä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»ï¼ˆ col1=5,id=5) åˆ°ï¼ˆ col1=10,id=30) è¿™ä¸ªå‰å¼€åé—­åŒºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135025045-16577778257713.png" alt="image-20220714135025045" style="zoom:67%;" /><p>è¿™ä¸ªä¾‹å­å¯¹æˆ‘ä»¬å®è·µçš„æŒ‡å¯¼æ„ä¹‰å°±æ˜¯ï¼Œ åœ¨åˆ é™¤æ•°æ®çš„æ—¶å€™å°½é‡åŠ  limit ã€‚</p><p>è¿™æ ·ä¸ä»…å¯ä»¥æ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°ï¼Œè®©æ“ä½œæ›´å®‰å…¨ï¼Œè¿˜å¯ä»¥å‡å°åŠ é”çš„èŒƒå›´ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-8"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135047760.png" alt="image-20220714135047760" style="zoom:67%;" /><ol><li>session A å¯åŠ¨äº‹åŠ¡åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ  lock in share mode ï¼Œåœ¨ç´¢å¼• col1 ä¸ŠåŠ äº† next-keylock(5,10] å’Œ é—´éš™é” (10,15) ï¼ˆç´¢å¼•å‘å³éå†é€€åŒ–ä¸ºé—´éš™é”ï¼‰ï¼›</li><li>session B çš„ update è¯­å¥ä¹Ÿè¦åœ¨ç´¢å¼• c ä¸ŠåŠ  next-key lock(5,10] ï¼Œè¿›å…¥é”ç­‰å¾…ï¼› å®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œ å…ˆæ˜¯åŠ  (5,10) çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ  col1=10 çš„è¡Œé”ï¼Œå› ä¸ºsessionAä¸Šå·²ç»ç»™è¿™è¡ŒåŠ ä¸Šäº†è¯» é”ï¼Œæ­¤æ—¶ç”³è¯·æ­»é”æ—¶ä¼šè¢«é˜»å¡</li><li>ç„¶å session A è¦å†æ’å…¥ (8,8,8) è¿™ä¸€è¡Œï¼Œè¢« session B çš„é—´éš™é”é”ä½ã€‚ç”±äºå‡ºç°äº†æ­»é”ï¼Œ InnoDB è®© session B å›æ»š</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-9"><p><mark class="hl-label blue">æ¡ˆä¾‹ä¹ï¼šorderbyç´¢å¼•æ’åºçš„é—´éš™é”1</mark></p><p>å¦‚ä¸‹é¢ä¸€æ¡è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">&gt;</span><span class="number">9</span> <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="number">12</span> <span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">desc</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾ä¸ºè¿™ä¸ªè¡¨çš„ç´¢å¼•idçš„ç¤ºæ„å›¾ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135130668.png" alt="image-20220714135130668"></p><ol><li>é¦–å…ˆè¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰æ˜¯ order by id desc ï¼Œè¦æ‹¿åˆ°æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œä¼˜åŒ–å™¨å¿…é¡»å…ˆæ‰¾åˆ° â€œ ç¬¬ ä¸€ä¸ª id&lt;12 çš„å€¼ â€ ã€‚</li><li>è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ç´¢å¼•æ ‘çš„æœç´¢è¿‡ç¨‹å¾—åˆ°çš„ï¼Œåœ¨å¼•æ“å†…éƒ¨ï¼Œå…¶å®æ˜¯è¦æ‰¾åˆ° id=12 çš„è¿™ä¸ªå€¼ï¼Œåªæ˜¯æœ€ç»ˆ æ²¡æ‰¾åˆ°ï¼Œä½†æ‰¾åˆ°äº† (10,15) è¿™ä¸ªé—´éš™ã€‚ï¼ˆ id=15 ä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥ next-key lock é€€åŒ–ä¸ºäº†é—´éš™é” (10, 15) ã€‚ï¼‰</li><li>ç„¶åå‘å·¦éå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå°±ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢äº†ï¼Œä¼šæ‰«æåˆ° id=5 è¿™ä¸€è¡Œï¼Œåˆå› ä¸ºåŒºé—´æ˜¯å·¦å¼€å³ é—­çš„ï¼Œæ‰€ä»¥ä¼šåŠ ä¸€ä¸ªnext-key lock (0,5] ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ ‘æœç´¢çš„æ–¹å¼å®šä½è®°å½• çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ â€œ ç­‰å€¼æŸ¥è¯¢ â€ çš„æ–¹æ³•ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-10"><p><mark class="hl-label blue">æ¡ˆä¾‹åï¼šorderbyç´¢å¼•æ’åºçš„é—´éš™é”2</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135206504.png" alt="image-20220714135206504" style="zoom: 67%;" /><ol><li><p>ç”±äºæ˜¯ order by col1 desc ï¼Œç¬¬ä¸€ä¸ªè¦å®šä½çš„æ˜¯ç´¢å¼• col1 ä¸Š â€œ æœ€å³è¾¹çš„ â€col1=20 çš„è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªéå”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼š</p><p>å·¦å¼€å³é—­åŒºé—´ï¼Œé¦–å…ˆåŠ ä¸Š next-key lock (15,20] ã€‚ å‘å³éå†ï¼Œcol1=25ä¸æ»¡è¶³æ¡ä»¶ï¼Œé€€åŒ–ä¸ºé—´éš™é” æ‰€ä»¥ä¼š åŠ ä¸Šé—´éš™é”(20,25) å’Œ next-key lock (15,20] ã€‚</p></li><li><p>åœ¨ç´¢å¼• col1 ä¸Šå‘å·¦éå†ï¼Œè¦æ‰«æåˆ° col1=10 æ‰åœä¸‹æ¥ã€‚åŒæ—¶åˆå› ä¸ºå·¦å¼€å³é—­åŒºé—´ï¼Œæ‰€ä»¥ next-key lock ä¼šåŠ åˆ° (5,10] ï¼Œè¿™æ­£æ˜¯é˜»å¡session B çš„ insert è¯­å¥çš„åŸå› ã€‚</p></li><li><p>åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼Œ col1=20 ã€ col1=15 ã€ col1=10 è¿™ä¸‰è¡Œéƒ½å­˜åœ¨å€¼ï¼Œç”±äºæ˜¯ select * ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸»é”® id ä¸ŠåŠ ä¸‰ä¸ªè¡Œé”ã€‚ å› æ­¤ï¼Œ session A çš„ select è¯­å¥é”çš„èŒƒå›´å°±æ˜¯ï¼š</p><ol><li>ç´¢å¼• col1 ä¸Š (5, 25) ï¼›</li><li>ä¸»é”®ç´¢å¼•ä¸Š id=15 ã€ 20 ä¸¤ä¸ªè¡Œé”ã€‚</li></ol></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2dd36c9e-3786-4eba-9e69-1329ee7eaa1b-11"><p><mark class="hl-label blue">æ¡ˆä¾‹åä¸€ï¼šupdateä¿®æ”¹æ•°æ®çš„ä¾‹å­-å…ˆæ’å…¥ååˆ é™¤</mark></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135300189.png" alt="image-20220714135300189" style="zoom:67%;" /><p>æ³¨æ„ï¼šæ ¹æ® col1&gt;5 æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªè®°å½•æ˜¯ col1=10 ï¼Œå› æ­¤ä¸ä¼šåŠ  (0,5] è¿™ä¸ª next-key lock ã€‚</p><p>session A çš„åŠ é”èŒƒå›´æ˜¯ç´¢å¼• col1 ä¸Šçš„ (5,10] ã€ (10,15] ã€ (15,20] ã€ (20,25] å’Œ(25,supremum] ã€‚</p><p>ä¹‹å session B çš„ç¬¬ä¸€ä¸ª update è¯­å¥ï¼Œè¦æŠŠ col1=5 æ”¹æˆ col1=1 ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼š</p><ol><li>æ’å…¥ (col1=1, id=5) è¿™ä¸ªè®°å½•ï¼›</li><li>åˆ é™¤ (col1=5, id=5) è¿™ä¸ªè®°å½•ã€‚</li></ol><p>é€šè¿‡è¿™ä¸ªæ“ä½œï¼Œ session A çš„åŠ é”èŒƒå›´å˜æˆäº†å›¾ 7 æ‰€ç¤ºçš„æ ·å­:</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220714135333089.png" alt="image-20220714135333089" style="zoom:67%;" /><p>å¥½ï¼Œæ¥ä¸‹æ¥ session B è¦æ‰§è¡Œ update t set col1 = 5 where col1 = 1 è¿™ä¸ªè¯­å¥äº†ï¼Œä¸€æ ·åœ°å¯ä»¥æ‹†æˆä¸¤æ­¥ï¼š</p><ol><li>æ’å…¥ (col1=5, id=5) è¿™ä¸ªè®°å½•ï¼›</li><li>åˆ é™¤ (col1=1, id=5) è¿™ä¸ªè®°å½•ã€‚ ç¬¬ä¸€æ­¥è¯•å›¾åœ¨å·²ç»åŠ äº†é—´éš™é”çš„ (1,10) ä¸­æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥å°±è¢«å µä½äº†ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;é”&lt;/code&gt;æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹&lt;code&gt;å¹¶å‘è®¿é—®æŸä¸€èµ„æº&lt;/code&gt;çš„æœºåˆ¶ã€‚åœ¨ç¨‹åºå¼€å‘ä¸­ä¼šå­˜åœ¨å¤šçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ä¸€äº›æ•æ„Ÿçš„æ•°æ®ï¼ˆæ¯”å¦‚è®¢å•ã€é‡‘é¢ç­‰ï¼‰ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¿è¯è¿™ä¸ªæ•°æ®åœ¨ä»»ä½•æ—¶åˆ»&lt;code&gt;æœ€å¤šåªæœ‰ä¸€</summary>
      
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQLäº‹åŠ¡æ—¥å¿—</title>
    <link href="https://wuwawawa.github.io/posts/46982315.html"/>
    <id>https://wuwawawa.github.io/posts/46982315.html</id>
    <published>2023-04-16T02:21:04.000Z</published>
    <updated>2023-04-19T03:28:01.583Z</updated>
    
    <content type="html"><![CDATA[<p>äº‹åŠ¡æœ‰4ç§ç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ã€‚é‚£ä¹ˆäº‹åŠ¡çš„å››ç§ç‰¹æ€§åˆ°åº•æ˜¯åŸºäºä»€ä¹ˆæœºåˆ¶å®ç°å‘¢ï¼Ÿ</p><ul><li>äº‹åŠ¡çš„éš”ç¦»æ€§ç”±<code>é”æœºåˆ¶</code>å®ç°ã€‚</li><li>è€Œäº‹åŠ¡çš„åŸå­æ€§ã€ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ç”±äº‹åŠ¡çš„ redo æ—¥å¿—å’Œ undo æ—¥å¿—æ¥ä¿è¯ã€‚<ul><li>REDO LOG ç§°ä¸º<code>é‡åšæ—¥å¿—</code>ï¼Œæä¾›å†å†™å…¥æ“ä½œï¼Œæ¢å¤æäº¤äº‹åŠ¡ä¿®æ”¹çš„é¡µæ“ä½œï¼Œç”¨æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚</li><li>UNDO LOG ç§°ä¸º<code>å›æ»šæ—¥å¿—</code>ï¼Œå›æ»šè¡Œè®°å½•åˆ°æŸä¸ªç‰¹å®šç‰ˆæœ¬ï¼Œç”¨æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€ä¸€è‡´æ€§ã€‚</li></ul></li></ul><p>æœ‰çš„DBAæˆ–è®¸ä¼šè®¤ä¸º UNDO æ˜¯ REDO çš„é€†è¿‡ç¨‹ï¼Œå…¶å®ä¸ç„¶ã€‚REDO å’Œ UNDOéƒ½å¯ä»¥è§†ä¸ºæ˜¯ä¸€ç§<code>æ¢å¤æ“ä½œ</code>ï¼Œä½†æ˜¯ï¼š</p><ul><li>redo log: æ˜¯å­˜å‚¨å¼•æ“å±‚ (innodb) ç”Ÿæˆçš„æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯<code>&quot;ç‰©ç†çº§åˆ«&quot;</code>ä¸Šçš„é¡µä¿®æ”¹æ“ä½œï¼Œæ¯”å¦‚é¡µå·xxxï¼Œåç§»é‡yyyå†™å…¥äº†â€™zzzâ€™æ•°æ®ã€‚ä¸»è¦ä¸ºäº†ä¿è¯æ•°æ®çš„å¯é æ€§ã€‚</li><li>undo log: æ˜¯å­˜å‚¨å¼•æ“å±‚ (innodb) ç”Ÿæˆçš„æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯<code>é€»è¾‘æ“ä½œ</code>æ—¥å¿—ï¼Œæ¯”å¦‚å¯¹æŸä¸€è¡Œæ•°æ®è¿›è¡Œäº†INSERTè¯­å¥æ“ä½œï¼Œé‚£ä¹ˆundo logå°±è®°å½•ä¸€æ¡ä¸ä¹‹ç›¸åçš„DELETEæ“ä½œã€‚ä¸»è¦ç”¨äº<code>äº‹åŠ¡çš„å›æ»š</code>(undo log è®°å½•çš„æ˜¯æ¯ä¸ªä¿®æ”¹æ“ä½œçš„<code>é€†æ“ä½œ</code>) å’Œ<code>ä¸€è‡´æ€§éé”å®šè¯»</code>(undo log å›æ»šè¡Œè®°å½•åˆ°æŸç§ç‰¹å®šçš„ç‰ˆæœ¬â€”â€”MVCCï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)ã€‚</li></ul><p>äº‹åŠ¡<span class='p green'>æäº¤ä¹‹å‰</span>å‘ç”Ÿäº†å´©æºƒï¼Œé‡å¯åä¼šé€šè¿‡ undo log å›æ»šäº‹åŠ¡ï¼Œäº‹åŠ¡<span class='p green'>æäº¤ä¹‹å</span>å‘ç”Ÿäº†å´©æºƒï¼Œé‡å¯åä¼šé€šè¿‡ redo log æ¢å¤äº‹åŠ¡ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/undo%20redo.png" alt="undo redo" style="zoom:75%;" /><hr><h2 id="1-redoæ—¥å¿—">1. redoæ—¥å¿—</h2><p>InnoDBå­˜å‚¨å¼•æ“æ˜¯ä»¥<code>é¡µä¸ºå•ä½</code>æ¥ç®¡ç†å­˜å‚¨ç©ºé—´çš„ã€‚åœ¨çœŸæ­£è®¿é—®é¡µé¢ä¹‹å‰ï¼Œéœ€è¦æŠŠåœ¨<code>ç£ç›˜ä¸Š</code>çš„é¡µç¼“å­˜åˆ°å†…å­˜ä¸­çš„<code>Buffer Pool</code>ä¹‹åæ‰å¯ä»¥è®¿é—®ã€‚æ‰€æœ‰çš„å˜æ›´éƒ½å¿…é¡»<code>å…ˆæ›´æ–°ç¼“å†²æ± </code>ä¸­çš„æ•°æ®ï¼Œç„¶åç¼“å†²æ± ä¸­çš„<code>è„é¡µ</code>ä¼šä»¥ä¸€å®šçš„é¢‘ç‡è¢«åˆ·å…¥ç£ç›˜ (<code>checkPoint</code>æœºåˆ¶)ï¼Œé€šè¿‡ç¼“å†²æ± æ¥ä¼˜åŒ–CPUå’Œç£ç›˜ä¹‹é—´çš„é¸¿æ²Ÿï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ•´ä½“çš„æ€§èƒ½ä¸ä¼šä¸‹é™å¤ªå¿«ã€‚</p><hr><h3 id="1-1-ä¸ºä»€ä¹ˆéœ€è¦redoæ—¥å¿—">1.1 ä¸ºä»€ä¹ˆéœ€è¦redoæ—¥å¿—</h3><p>ä¸€æ–¹é¢ï¼Œç¼“å†²æ± å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¶ˆé™¤CPUå’Œç£ç›˜ä¹‹é—´çš„é¸¿æ²Ÿï¼Œcheckpointæœºåˆ¶å¯ä»¥ä¿è¯æ•°æ®çš„æœ€ç»ˆè½ç›˜ï¼Œç„¶è€Œç”±äºcheckpoint<code>å¹¶ä¸æ˜¯æ¯æ¬¡å˜æ›´çš„æ—¶å€™å°±è§¦å‘</code>çš„ï¼Œè€Œæ˜¯masterçº¿ç¨‹éš”ä¸€æ®µæ—¶é—´å»å¤„ç†çš„ã€‚æ‰€ä»¥æœ€åçš„æƒ…å†µå°±æ˜¯äº‹åŠ¡æäº¤åï¼Œåˆšå†™å®Œç¼“å†²æ± ï¼Œæ•°æ®åº“å®•æœºäº†ï¼Œé‚£ä¹ˆè¿™æ®µæ•°æ®å°±æ˜¯ä¸¢å¤±çš„ï¼Œæ— æ³•æ¢å¤ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œäº‹åŠ¡åŒ…å«<code>æŒä¹…æ€§</code>çš„ç‰¹æ€§ï¼Œå°±æ˜¯è¯´å¯¹äºä¸€ä¸ªå·²ç»æäº¤çš„äº‹åŠ¡ï¼Œåœ¨äº‹åŠ¡æäº¤åå³ä½¿ç³»ç»Ÿå‘ç”Ÿäº†å´©æºƒï¼Œè¿™ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ‰€åšçš„æ›´æ”¹ä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•ä¿è¯è¿™ä¸ªæŒä¹…æ€§å‘¢ï¼Ÿ<code>ä¸€ä¸ªç®€å•çš„åšæ³•</code>ï¼šåœ¨äº‹åŠ¡æäº¤å®Œæˆä¹‹å‰æŠŠè¯¥äº‹åŠ¡æ‰€ä¿®æ”¹çš„æ‰€æœ‰é¡µé¢éƒ½åˆ·æ–°åˆ°ç£ç›˜ï¼Œä½†æ˜¯è¿™ä¸ªç®€å•ç²—æš´çš„åšæ³•æœ‰äº›é—®é¢˜:</p><ul><li><p><strong>ä¿®æ”¹é‡ä¸åˆ·æ–°ç£ç›˜å·¥ä½œé‡ä¸¥é‡ä¸æˆæ¯”ä¾‹</strong></p><p>æœ‰æ—¶å€™æˆ‘ä»¬ä»…ä»…ä¿®æ”¹äº†æŸä¸ªé¡µé¢ä¸­çš„ä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“åœ¨InnoDBä¸­æ˜¯ä»¥é¡µä¸ºå•ä½æ¥è¿›è¡Œç£ç›˜IOçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨è¯¥äº‹åŠ¡æäº¤æ—¶ä¸å¾—ä¸å°†ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ä»å†…å­˜ä¸­åˆ·æ–°åˆ°ç£ç›˜ï¼Œæˆ‘ä»¬åˆçŸ¥é“ä¸€ä¸ªé»˜è®¤é¡µé¢æ—¶16KBå¤§å°ï¼Œåªä¿®æ”¹ä¸€ä¸ªå­—èŠ‚å°±è¦åˆ·æ–°16KBçš„æ•°æ®åˆ°ç£ç›˜ä¸Šæ˜¾ç„¶æ˜¯å°é¢˜å¤§åšäº†ã€‚</p></li><li><p><strong>éšæœºIOåˆ·æ–°è¾ƒæ…¢</strong></p><p>ä¸€ä¸ªäº‹åŠ¡å¯èƒ½åŒ…å«å¾ˆå¤šè¯­å¥ï¼Œå³ä½¿æ˜¯ä¸€æ¡è¯­å¥ä¹Ÿå¯èƒ½ä¿®æ”¹è®¸å¤šé¡µé¢ï¼Œå‡å¦‚è¯¥äº‹åŠ¡ä¿®æ”¹çš„è¿™äº›é¡µé¢å¯èƒ½å¹¶ä¸ç›¸é‚»ï¼Œè¿™å°±æ„å‘³ç€åœ¨å°†æŸä¸ªäº‹åŠ¡ä¿®æ”¹çš„Buffer Poolä¸­çš„é¡µé¢<code>åˆ·æ–°åˆ°ç£ç›˜</code>æ—¶ï¼Œéœ€è¦è¿›è¡Œå¾ˆå¤šçš„<code>éšæœºIO</code>ï¼ŒéšæœºIOæ¯”é¡ºåºIOè¦æ…¢ï¼Œå°¤å…¶å¯¹äºä¼ ç»Ÿçš„æœºæ¢°ç¡¬ç›˜æ¥è¯´ã€‚</p></li></ul><p><code>å¦ä¸€ä¸ªè§£å†³çš„æ€è·¯</code>ï¼šæˆ‘ä»¬åªæ˜¯æƒ³è®©å·²ç»æäº¤äº†çš„äº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ•°æ®æ‰€åšçš„ä¿®æ”¹æ°¸ä¹…ç”Ÿæ•ˆï¼Œå³ä½¿åæ¥ç³»ç»Ÿå´©æºƒï¼Œåœ¨é‡å¯åä¹Ÿèƒ½æŠŠè¿™ç§ä¿®æ”¹æ¢å¤å‡ºæ¥ã€‚æ‰€ä»¥æˆ‘ä»¬å…¶å®æ²¡æœ‰å¿…è¦åœ¨æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶å°±æŠŠè¯¥äº‹åŠ¡åœ¨å†…å­˜ä¸­ä¿®æ”¹è¿‡çš„å…¨éƒ¨é¡µé¢åˆ·æ–°åˆ°ç£ç›˜ï¼Œåªéœ€è¦æŠŠä¿®æ”¹äº†å“ªäº›ä¸œè¥¿è®°å½•ä¸€ä¸‹å°±å¥½ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªäº‹åŠ¡å°†ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ç¬¬10å·é¡µé¢ä¸­åç§»é‡ä¸º100 å¤„çš„é‚£ä¸ªå­—èŠ‚çš„å€¼ 1 æ”¹æˆ 2 ã€‚æˆ‘ä»¬åªéœ€è¦è®°å½•ä¸€ä¸‹ï¼šå°†ç¬¬0å·è¡¨ç©ºé—´çš„10å·é¡µé¢çš„åç§»é‡ä¸º100å¤„çš„å€¼æ›´æ–°ä¸º 2</p><p>InnoDBå¼•æ“çš„äº‹åŠ¡é‡‡ç”¨äº†WALæŠ€æœ¯ (<code>Write-Ahead Logging</code>)ï¼Œ<span class='p red'>è¿™ç§æŠ€æœ¯çš„æ€æƒ³å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ï¼Œåªæœ‰æ—¥å¿—å†™å…¥æˆåŠŸï¼Œæ‰ç®—äº‹åŠ¡æäº¤æˆåŠŸï¼Œè¿™é‡Œçš„æ—¥å¿—å°±æ˜¯redo logã€‚</span>å½“å‘ç”Ÿå®•æœºä¸”æ•°æ®æœªåˆ·åˆ°ç£ç›˜çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡redo logæ¥æ¢å¤ï¼Œä¿è¯ACIDä¸­çš„Dï¼Œè¿™å°±æ˜¯redo logçš„ä½œç”¨ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710202517977.png" alt="image-20220710202517977" style="zoom:50%;" /><hr><h3 id="1-2-redoæ—¥å¿—çš„å¥½å¤„ã€ç‰¹ç‚¹">1.2 redoæ—¥å¿—çš„å¥½å¤„ã€ç‰¹ç‚¹</h3><ol><li>å¥½å¤„</li></ol><ul><li>redoæ—¥å¿—é™ä½äº†åˆ·ç›˜é¢‘ç‡</li><li>redoæ—¥å¿—å ç”¨çš„ç©ºé—´éå¸¸å°</li></ul><p>å­˜å‚¨è¡¨ç©ºé—´IDã€é¡µå·ã€åç§»é‡ä»¥åŠéœ€è¦æ›´æ–°çš„å€¼ï¼Œæ‰€éœ€çš„å­˜å‚¨ç©ºé—´æ˜¯å¾ˆå°çš„ï¼Œåˆ·ç›˜å¿«ã€‚</p><ol start="2"><li>ç‰¹ç‚¹</li></ol><ul><li><p><strong>redoæ—¥å¿—æ˜¯é¡ºåºå†™å…¥ç£ç›˜çš„</strong></p><p>åœ¨æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œå°±å¯èƒ½äº§ç”Ÿè‹¥å¹²æ¡redoæ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—æ˜¯æŒ‰ç…§<code>äº§ç”Ÿçš„é¡ºåºå†™å…¥ç£ç›˜çš„</code>ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨é¡ºåºIDï¼Œæ•ˆç‡æ¯”éšæœºIOå¿«ã€‚</p></li><li><p><strong>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œredo logä¸æ–­è®°å½•</strong></p><p>redo logè·Ÿbin logçš„åŒºåˆ«ï¼Œredo logæ˜¯<code>å­˜å‚¨å¼•æ“å±‚</code>äº§ç”Ÿçš„ï¼Œè€Œbin logæ˜¯<code>æ•°æ®åº“å±‚</code>äº§ç”Ÿçš„ã€‚å‡è®¾ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯¹è¡¨åš10ä¸‡è¡Œçš„è®°å½•æ’å…¥ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸€ç›´ä¸æ–­çš„å¾€redo logé¡ºåºè®°å½•ï¼Œè€Œbin logä¸ä¼šè®°å½•ï¼Œç›´åˆ°è¿™ä¸ªäº‹åŠ¡æäº¤ï¼Œæ‰ä¼šä¸€æ¬¡å†™å…¥åˆ°bin logæ–‡ä»¶ä¸­ã€‚</p></li></ul><hr><h3 id="1-3-redoçš„æ•´ä½“æµç¨‹">1.3 redoçš„æ•´ä½“æµç¨‹</h3><p>ä»¥ä¸€ä¸ªæ›´æ–°äº‹åŠ¡ä¸ºä¾‹ï¼Œredo log æµè½¬è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710204810264-16574572910841.png" alt="image-20220710204810264"></p><p>ç¬¬1æ­¥ï¼šå…ˆå°†åŸå§‹æ•°æ®ä»ç£ç›˜ä¸­è¯»å…¥å†…å­˜ä¸­æ¥ï¼Œä¿®æ”¹æ•°æ®çš„å†…å­˜æ‹·è´<br>ç¬¬2æ­¥ï¼šç”Ÿæˆä¸€æ¡é‡åšæ—¥å¿—å¹¶å†™å…¥redo log bufferï¼Œè®°å½•çš„æ˜¯æ•°æ®è¢«ä¿®æ”¹åçš„å€¼<br>ç¬¬3æ­¥ï¼šå½“äº‹åŠ¡commitæ—¶ï¼Œå°†redo log bufferä¸­çš„å†…å®¹åˆ·æ–°åˆ° redo log fileï¼Œå¯¹ redo log fileé‡‡ç”¨è¿½åŠ å†™çš„æ–¹å¼<br>ç¬¬4æ­¥ï¼šå®šæœŸå°†å†…å­˜ä¸­ä¿®æ”¹çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­</p><blockquote><p>ä½“ä¼šï¼š Write-Ahead Log(é¢„å…ˆæ—¥å¿—æŒä¹…åŒ–)ï¼šåœ¨æŒä¹…åŒ–ä¸€ä¸ªæ•°æ®é¡µä¹‹å‰ï¼Œå…ˆå°†å†…å­˜ä¸­ç›¸åº”çš„æ—¥å¿—é¡µæŒä¹…åŒ–ã€‚</p></blockquote><hr><h3 id="1-4-redo-logçš„åˆ·ç›˜ç­–ç•¥">1.4 redo logçš„åˆ·ç›˜ç­–ç•¥</h3><p>redo logçš„å†™å…¥å¹¶ä¸æ˜¯ç›´æ¥å†™å…¥ç£ç›˜çš„ï¼ŒInnoDBå¼•æ“ä¼šåœ¨å†™redo logçš„æ—¶å€™å…ˆå†™redo log bufferï¼Œä¹‹åä»¥<code>ä¸€å®šçš„é¢‘ç‡</code>åˆ·å…¥åˆ°çœŸæ­£çš„redo log file ä¸­ã€‚è¿™é‡Œçš„ä¸€å®šé¢‘ç‡æ€ä¹ˆçœ‹å¾…å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬è¦è¯´çš„åˆ·ç›˜ç­–ç•¥ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710205015302.png" alt="image-20220710205015302" style="zoom:67%;" /><p>æ³¨æ„ï¼Œredo log bufferåˆ·ç›˜åˆ°redo log fileçš„è¿‡ç¨‹å¹¶ä¸æ˜¯çœŸæ­£çš„åˆ·åˆ°ç£ç›˜ä¸­å»ï¼Œåªæ˜¯åˆ·å…¥åˆ°<code>æ–‡ä»¶ç³»ç»Ÿç¼“å­˜(page cache)</code>ä¸­å»ï¼ˆè¿™æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿä¸ºäº†æé«˜æ–‡ä»¶å†™å…¥æ•ˆç‡åšçš„ä¸€ä¸ªä¼˜åŒ–ï¼‰ï¼ŒçœŸæ­£çš„å†™å…¥ä¼šäº¤ç»™ç³»ç»Ÿè‡ªå·±æ¥å†³å®šï¼ˆæ¯”å¦‚page cacheè¶³å¤Ÿå¤§äº†ï¼‰ã€‚é‚£ä¹ˆå¯¹äºInnoDBæ¥è¯´å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœäº¤ç»™ç³»ç»Ÿæ¥åŒ æ­¥ï¼ŒåŒæ ·å¦‚æœç³»ç»Ÿå®•æœºï¼Œé‚£ä¹ˆæ•°æ®ä¹Ÿä¸¢å¤±äº†ï¼ˆè™½ç„¶æ•´ä¸ªç³»ç»Ÿå®•æœºçš„æ¦‚ç‡è¿˜æ˜¯æ¯”è¾ƒå°çš„ï¼‰ã€‚</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒInnoDBç»™å‡º<code>innodb_flush_log_at_trx_commit</code>å‚æ•°ï¼Œè¯¥å‚æ•°æ§åˆ¶ commitæäº¤äº‹åŠ¡ æ—¶ï¼Œå¦‚ä½•å°† redo log buffer ä¸­çš„æ—¥å¿—åˆ·æ–°åˆ° redo log fileä¸­ã€‚å®ƒæ”¯æŒä¸‰ç§ç­–ç•¥ï¼š</p><p>*<code>è®¾ç½®ä¸º0</code>ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œåˆ·ç›˜æ“ä½œã€‚ï¼ˆç³»ç»Ÿé»˜è®¤master threadæ¯éš”1sè¿›è¡Œä¸€æ¬¡é‡åšæ—¥å¿—çš„åŒæ­¥)<br>*<code>è®¾ç½®ä¸º1</code>ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†è¿›è¡ŒåŒæ­¥ï¼Œåˆ·ç›˜æ“ä½œï¼ˆ é»˜è®¤å€¼ ï¼‰<br>*<code>è®¾ç½®ä¸º2</code>ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠ redo log buffer å†…å®¹å†™å…¥ page cacheï¼Œä¸è¿›è¡ŒåŒæ­¥ã€‚ç”±osè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥åˆ°ç£ç›˜æ–‡ä»¶ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710205948156.png" alt="image-20220710205948156" /><p>å¦å¤–ï¼ŒInnoDBå­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš”<code>1ç§’</code>ï¼Œå°±ä¼šæŠŠ<code>redo log buffer</code>ä¸­çš„å†…å®¹å†™åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜(<code>page cache</code>)ï¼Œç„¶åè°ƒç”¨åˆ·ç›˜æ“ä½œã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710210339724.png" alt="image-20220710210339724" style="zoom:67%;" /><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„<code>redo log</code>è®°å½•ï¼Œä¹Ÿå¯èƒ½ä¼šåˆ·ç›˜ã€‚å› ä¸ºåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ redo log è®°å½•æ˜¯ä¼šå†™å…¥<code>redo log buffer</code>ä¸­ï¼Œè¿™äº›redo log è®°å½•ä¼šè¢«<code>åå°çº¿ç¨‹</code>åˆ·ç›˜ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710210532805.png" alt="image-20220710210532805" style="zoom:50%;" /><p>é™¤äº†åå°çº¿ç¨‹æ¯ç§’<code>1æ¬¡</code>çš„è½®è¯¢æ“ä½œï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå½“<code>redo log buffer</code>å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ°<code>innodb_log_buffer_size</code>ï¼ˆè¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯16Mï¼‰çš„ä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨åˆ·ç›˜ã€‚</p><hr><h3 id="1-5-ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º">1.5 ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º</h3><div class="tabs" id="8923db4d-3949-4b45-b62b-a27aeef05192"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#8923db4d-3949-4b45-b62b-a27aeef05192-1"><i class="fas fa-atom"></i>è®¾ç½®ä¸º0</button></li><li class="tab"><button type="button" data-href="#8923db4d-3949-4b45-b62b-a27aeef05192-2"><i class="far fa-sun"></i>è®¾ç½®ä¸º1(é»˜è®¤å€¼)</button></li><li class="tab"><button type="button" data-href="#8923db4d-3949-4b45-b62b-a27aeef05192-3"><i class="fas fa-wind"></i>è®¾ç½®ä¸º2</button></li><li class="tab"><button type="button" data-href="#8923db4d-3949-4b45-b62b-a27aeef05192-4"><i class="fas fa-fire-alt"></i>ä¸¾ä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="8923db4d-3949-4b45-b62b-a27aeef05192-1"><p>æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œåˆ·ç›˜æ“ä½œã€‚ï¼ˆç³»ç»Ÿé»˜è®¤master threadæ¯éš”1sè¿›è¡Œä¸€æ¬¡é‡åšæ—¥å¿—çš„åŒæ­¥)</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414104240464.png" alt="image-20230414104240464" style="zoom:50%;" /><blockquote><p>å°ç»“ï¼šinnodb_flush_log_at_trx_commit=0ä¸º0æ—¶ï¼Œmaster threadä¸­æ¯1ç§’è¿›è¡Œä¸€æ¬¡é‡åšæ—¥å¿—çš„fsyncæ“ä½œï¼Œå› æ­¤å®ä¾‹ crash æœ€å¤šä¸¢å¤±1ç§’é’Ÿå†…çš„äº‹åŠ¡ã€‚</p><p>(master threadæ˜¯è´Ÿè´£å°†ç¼“å†²æ± ä¸­çš„æ•°æ®å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼‰</p><p>æ•°å€¼0çš„è¯ï¼Œæ˜¯ä¸€ç§æŠ˜ä¸­çš„åšæ³•ï¼Œå®ƒçš„IOæ•ˆç‡ç†è®ºæ˜¯é«˜äº1çš„ï¼Œä½äº2çš„ï¼Œè¿™ç§ç­–ç•¥ä¹Ÿæœ‰ä¸Ÿå¤±æ•°æ®çš„é£é™©ï¼Œä¹Ÿæ— æ³•ä¿è¯Dã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8923db4d-3949-4b45-b62b-a27aeef05192-2"><p>æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†è¿›è¡ŒåŒæ­¥ï¼Œåˆ·ç›˜æ“ä½œ</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414104841508.png" alt="image-20230414104841508" style="zoom:50%;" /><blockquote><p>å°ç»“ï¼šinnodb_flush_log_at_trx_commit=1ä¸º1æ—¶ï¼Œåªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œredo log è®°å½•å°±ä¸€å®šåœ¨ç¡¬ç›˜é‡Œï¼Œä¸ä¼šæœ‰ä»»ä½•æ•°æ®ä¸¢å¤±ã€‚</p><p>å¦‚æœäº‹åŠ¡è¡ŒæœŸé—´ MySQL æŒ‚äº†æˆ–å®•æœºï¼Œè¿™éƒ¨åˆ†æ—¥å¿—ä¸¢äº†ï¼Œä½†æ˜¯äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±ã€‚å¯ä»¥ä¿è¯ACIDçš„Dï¼Œæ•°æ®ç»å¯¹<code>ä¸ä¼šä¸¢å¤±</code>ï¼Œä½†æ˜¯<code>æ•ˆç‡æœ€å·®</code>çš„ã€‚</p><p>å»ºè®®ä½¿ç”¨é»˜è®¤å€¼ï¼Œè™½ç„¶æ“ä½œç³»ç»Ÿå®•æœºçš„æ¦‚ç‡ç†è®ºå°äºæ•°æ®åº“å®•æœºçš„æ¦‚ç‡ï¼Œä½†æ˜¯ä¸€èˆ¬æ—¢ç„¶ä½¿ç”¨äº†äº‹åŠ¡ï¼Œé‚£ä¹ˆæ•°æ®çš„å®‰å…¨ç›¸å¯¹æ¥è¯´æ›´é‡è¦äº›ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8923db4d-3949-4b45-b62b-a27aeef05192-3"><p>æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠ redo log buffer å†…å®¹å†™å…¥ page cacheï¼Œä¸è¿›è¡ŒåŒæ­¥ã€‚ç”±osè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥åˆ°ç£ç›˜æ–‡ä»¶ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414105342602.png" alt="image-20230414105342602" style="zoom:50%;" /><blockquote><p>å°ç»“innodb_flush_log_at _trx_commit=2ä¸º2æ—¶ï¼Œåªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œredo log buffer ä¸­çš„å†…å®¹åªå†™å…¥æ–‡ä»¶ç³»ç»Ÿç¼“å­˜( page cache )</p><p>å¦‚æœä»…ä»…åªæ˜¯ MySQL æŒ‚äº†ä¸ä¼šæœ‰ä»»ä½•æ•°æ®ä¸¢å¤±ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿå®•æœºå¯èƒ½ä¼šæœ‰1ç§’æ•°æ®çš„ä¸¢å¤±ï¼Œè¿™ç§æƒ…å†µä¸‹æ— æ³•æ»¡è¶³ACIDä¸­çš„Dã€‚ä½†æ˜¯æ•°å€¼2è‚¯å®šæ˜¯æ•ˆç‡æœ€é«˜çš„ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8923db4d-3949-4b45-b62b-a27aeef05192-4"><p>æ¯”è¾ƒinnodb_flush_log_at_trx_commitå¯¹äº‹åŠ¡çš„å½±å“ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_load(</span><br><span class="line">a <span class="type">INT</span>,</span><br><span class="line">b <span class="type">CHAR</span>(<span class="number">80</span>)</span><br><span class="line">)ENGINE<span class="operator">=</span>INNODB;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER<span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> p_load(COUNT <span class="type">INT</span> UNSIGNED)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> s <span class="type">INT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> c <span class="type">CHAR</span>(<span class="number">80</span>) <span class="keyword">DEFAULT</span> REPEAT(<span class="string">&#x27;a&#x27;</span>,<span class="number">80</span>);</span><br><span class="line">WHILE s<span class="operator">&lt;=</span>COUNT DO</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_load <span class="keyword">SELECT</span> <span class="keyword">NULL</span>, c;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">SET</span> s<span class="operator">=</span>s<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER;</span><br></pre></td></tr></table></figure><p>å­˜å‚¨è¿‡ç¨‹ä»£ç ä¸­ï¼Œæ¯æ’å…¥ä¸€æ¡æ•°æ®å°±è¿›è¡Œä¸€æ¬¡æ˜¾å¼çš„COMMITæ“ä½œã€‚åœ¨é»˜è®¤çš„è®¾ç½®ä¸‹ï¼Œå³å‚æ•° innodb_ flush _log_at_trx_commitä¸º1çš„æƒ…å†µä¸‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šå°†é‡åšæ—¥å¿—ç¼“å†²ä¸­çš„æ—¥å¿—å†™å…¥æ–‡ä»¶ï¼Œå¹¶è°ƒç”¨ä¸€æ¬¡fsyncæ“ä½œã€‚</p><p>æ‰§è¡Œå‘½ä»¤CALL p_loadï¼ˆ30000ï¼‰ï¼Œå‘è¡¨ä¸­æ’å…¥3ä¸‡è¡Œçš„è®°å½•ï¼Œå¹¶æ‰§è¡Œ3ä¸‡æ¬¡çš„fsyncæ“ä½œã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹æ‰€éœ€çš„æ—¶é—®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> p_load(<span class="number">30000</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected(<span class="number">1</span> min <span class="number">23</span> sec)</span><br></pre></td></tr></table></figure><p><code>1 min 23 sec</code>çš„æ—¶é—´æ˜¾ç„¶æ˜¯ä¸èƒ½æ¥å—çš„ã€‚è€Œé€ æˆæ—¶é—´æ¯”è¾ƒé•¿çš„åŸå› å°±åœ¨äºfsyncæ“ä½œæ‰€éœ€è¦çš„æ—¶é—´ã€‚</p><p>ä¿®æ”¹å‚æ•°innodb_flush_log_at_trx_commitï¼Œè®¾ç½®ä¸º0ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> innodb_flush_log_at_trx_commit <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> p_load(<span class="number">30000</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected(<span class="number">38</span> sec)</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å‚æ•°innodb_flush_log_at_trx_commitï¼Œè®¾ç½®ä¸º2ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> innodb_flush_log_at_trx_commit <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> p_load(<span class="number">30000</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected(<span class="number">46</span> sec)</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710215353893.png" alt="image-20220710215353893"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="1-6-å†™å…¥redo-log-buffer-è¿‡ç¨‹">1.6 å†™å…¥redo log buffer è¿‡ç¨‹</h3><h4 id="1-6-1-Mini-Transaction">1.6.1 Mini-Transaction</h4><p>MySQLæŠŠå¯¹åº•å±‚é¡µé¢ä¸­çš„ä¸€æ¬¡åŸå­è®¿é—®è¿‡ç¨‹ç§°ä¹‹ä¸ºä¸€ä¸ª<code>Mini-Transaction</code>ï¼Œç®€ç§°<code>mtr</code>ï¼Œæ¯”å¦‚ï¼Œå‘æŸä¸ªç´¢å¼•å¯¹åº”çš„B+æ ‘ä¸­æ’å…¥ä¸€æ¡è®°å½•çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ª<code>Mini-Transaction</code>ã€‚ä¸€ä¸ªæ‰€è°“çš„<code>mtr</code>å¯ä»¥åŒ…å«ä¸€ç»„redoæ—¥å¿—ï¼Œåœ¨è¿›è¡Œå´©æºƒæ¢å¤æ—¶è¿™ä¸€ç»„<code>redo</code>æ—¥å¿—å¯ä»¥ä½œä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ã€‚</p><p>ä¸€ä¸ªäº‹åŠ¡å¯ä»¥åŒ…å«è‹¥å¹²æ¡è¯­å¥ï¼Œæ¯ä¸€æ¡è¯­å¥å…¶å®æ˜¯ç”±è‹¥å¹²ä¸ª<code>mtr</code>ç»„æˆï¼Œæ¯ä¸€ä¸ª<code>mtr</code>åˆå¯ä»¥åŒ…å«è‹¥å¹²æ¡ redoæ—¥å¿—ï¼Œç”»ä¸ªå›¾è¡¨ç¤ºå®ƒä»¬çš„å…³ç³»å°±æ˜¯è¿™æ ·ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710220653131.png" alt="image-20220710220653131" style="zoom:33%;" /><h4 id="1-6-2-redo-æ—¥å¿—å†™å…¥log-buffer">1.6.2  redo æ—¥å¿—å†™å…¥log buffer</h4><p>å‘<code>log buffer</code>ä¸­å†™å…¥redoæ—¥å¿—çš„è¿‡ç¨‹æ˜¯é¡ºåºçš„ï¼Œä¹Ÿå°±æ˜¯å…ˆå¾€å‰è¾¹çš„blockä¸­å†™ï¼Œå½“è¯¥blockçš„ç©ºé—²ç©ºé—´ç”¨å®Œä¹‹åå†å¾€ä¸‹ä¸€ä¸ªblockä¸­å†™ã€‚å½“æˆ‘ä»¬æƒ³å¾€<code>log buffer</code>ä¸­å†™å…¥redoæ—¥å¿—æ—¶ï¼Œç¬¬ä¸€ä¸ªé‡åˆ°çš„é—®é¢˜å°±æ˜¯åº”è¯¥å†™åœ¨å“ªä¸ª<code>block</code>çš„å“ªä¸ªåç§»æ˜¯å¤„ï¼Œæ‰€ä»¥ InnoDBçš„è®¾è®¡è€…ç‰¹æ„æä¾›äº†ä¸€ä¸ªç§°ä¹‹ä¸º<code>buf_free</code>çš„å…¨å±€å˜é‡ï¼Œè¯¥å˜é‡æŒ‡æ˜åç»­å†™å…¥çš„ redoæ—¥å¿—åº”è¯¥å†™å…¥åˆ°log bufferä¸­çš„å“ªä¸ªä½ç½®ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710220919271.png" alt="image-20220710220919271" style="zoom:50%;" /><p>â€”ä¸ªmtræ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿè‹¥å¹²æ¡redoæ—¥å¿—ï¼Œ<code>è¿™äº›redoæ—¥å¿—æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç»„</code>ï¼Œæ‰€ä»¥å…¶å®å¹¶ä¸æ˜¯æ¯ç”Ÿæˆä¸€æ¡ redoæ—¥å¿—ï¼Œå°±å°†å…¶æ’å…¥åˆ°log buferä¸­ï¼Œè€Œæ˜¯æ¯ä¸ªmtrè¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—å…ˆæš‚æ—¶å­˜åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œå½“è¯¥mtrç»“æŸçš„æ—¶å€™ï¼Œå°†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€ç»„redoæ—¥å¿—å†å…¨éƒ¨å¤åˆ¶åˆ°log bufferä¸­ã€‚æˆ‘ä»¬ç°åœ¨å‡è®¾æœ‰ä¸¤ä¸ªåä¸º<code>T1ã€T2</code>çš„äº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½åŒ…å«2ä¸ªmtrï¼Œæˆ‘ä»¬ç»™è¿™å‡ ä¸ªmtrå‘½åä¸€ä¸‹ï¼š</p><ul><li><p>äº‹åŠ¡T1 çš„ä¸¤ä¸ªmtråˆ†åˆ«ç§°ä¸ºmtr_T1_1 å’Œmtr_T1_2ã€‚</p></li><li><p>äº‹åŠ¡ T2 çš„ä¸¤ä¸ªmtråˆ†åˆ«ç§°ä¸º mtr_T2_1 å’Œmtr_T2_2ã€‚</p></li></ul><p>æ¯ä¸ªmtréƒ½ä¼šäº§ç”Ÿä¸€ç»„redoæ—¥å¿—ï¼Œç”¨ç¤ºæ„å›¾æ¥æè¿°ä¸€ä¸‹è¿™äº›mträº§ç”Ÿçš„æ—¥å¿—æƒ…å†µï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710221318271.png" alt="image-20220710221318271" style="zoom:50%;" /><p>ä¸åŒçš„äº‹åŠ¡å¯èƒ½æ˜¯<code>å¹¶å‘</code>æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ T1 ã€ T2 ä¹‹é—´çš„ mtr å¯èƒ½æ˜¯<code>äº¤æ›¿æ‰§è¡Œ</code>çš„ã€‚æ²¡å½“ä¸€ä¸ªmtræ‰§è¡Œå®Œæˆæ—¶ï¼Œä¼´éšè¯¥mtrç”Ÿæˆçš„ä¸€ç»„redoæ—¥å¿—å°±éœ€è¦è¢«å¤åˆ¶åˆ°log bufferä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒäº‹åŠ¡çš„mtrå¯èƒ½æ˜¯äº¤æ›¿å†™å…¥log bufferçš„ï¼Œæˆ‘ä»¬ç”»ä¸ªç¤ºæ„å›¾ï¼ˆä¸ºäº†ç¾è§‚ï¼Œæˆ‘ä»¬æŠŠä¸€ä¸ªmträ¸­äº§ç”Ÿçš„æ‰€æœ‰redoæ—¥å¿—å½“åšä¸€ä¸ªæ•´ä½“æ¥ç”»ï¼‰ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710221620291.png" alt="image-20220710221620291" style="zoom:50%;" /><p>æœ‰çš„mträº§ç”Ÿçš„redoæ—¥å¿—é‡éå¸¸å¤§ï¼Œæ¯”å¦‚<code>mtr_t1_2</code>äº§ç”Ÿçš„redoæ—¥å¿—å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œå ç”¨äº†3ä¸ªblockæ¥å­˜å‚¨ã€‚</p><h4 id="1-6-3-redo-log-blockçš„ç»“æ„å›¾">1.6.3 redo log blockçš„ç»“æ„å›¾</h4><p>ä¸€ä¸ªredo log blockæ˜¯ç”±<code>æ—¥å¿—å¤´ã€æ—¥å¿—ä½“ã€æ—¥å¿—å°¾</code>ç»„æˆã€‚æ—¥å¿—å¤´å ç”¨12å­—èŠ‚ï¼Œæ—¥å¿—å°¾å ç”¨8å­—èŠ‚ï¼Œæ‰€ä»¥ä¸€ä¸ªblockçœŸæ­£èƒ½å­˜å‚¨çš„æ•°æ®æ˜¯512-12-8=492å­—èŠ‚ã€‚</p><blockquote><span class='p red'>ä¸ºä»€ä¹ˆä¸€ä¸ªblockè®¾è®¡æˆ512å­—èŠ‚ï¼Ÿ</span><p>è¿™ä¸ªå’Œç£ç›˜çš„æ‰‡åŒºæœ‰å…³ï¼Œæœºæ¢°ç£ç›˜é»˜è®¤çš„æ‰‡åŒºå°±æ˜¯512å­—èŠ‚ï¼Œå¦‚æœä½ è¦å†™å…¥çš„æ•°æ®å¤§äº512å­—èŠ‚ï¼Œé‚£ä¹ˆè¦å†™å…¥çš„æ‰‡åŒºè‚¯å®šä¸æ­¢ä¸€ä¸ªï¼Œè¿™æ—¶å°±è¦æ¶‰åŠåˆ°ç›˜ç‰‡çš„è½¬åŠ¨ï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªæ‰‡åŒºï¼Œå‡è®¾ç°åœ¨éœ€è¦å†™å…¥ä¸¤ä¸ªæ‰‡åŒºAå’ŒBï¼Œå¦‚æœæ‰‡åŒºAå†™å…¥æˆåŠŸï¼Œè€Œæ‰‡åŒºBå†™å…¥å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°<code>éåŸå­æ€§</code>çš„å†™å…¥ï¼Œè€Œå¦‚æœæ¯æ¬¡åªå†™å…¥å’Œæ‰‡åŒºçš„å¤§å°ä¸€æ ·çš„512å­—èŠ‚ï¼Œé‚£ä¹ˆæ¯æ¬¡çš„å†™å…¥éƒ½æ˜¯åŸå­æ€§çš„ã€‚</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220710223135374.png" alt="image-20220710223135374" style="zoom:50%;" /><p>çœŸæ­£çš„redoæ—¥å¿—éƒ½æ˜¯å­˜å‚¨åˆ°å ç”¨<code>496</code>å­—èŠ‚å¤§å°çš„<code>log block body</code>ä¸­ï¼Œå›¾ä¸­çš„<code>log block header</code>å’Œ<code>log block trailer</code>å­˜å‚¨çš„æ˜¯ä¸€äº›ç®¡ç†ä¿¡æ¯ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›æ‰€è°“<code>ç®¡ç†ä¿¡æ¯</code>éƒ½æœ‰ä»€ä¹ˆã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711144546439.png" alt="image-20220711144546439" style="zoom: 67%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711144608223.png" alt="image-20220711144608223"/><hr><hr><h3 id="1-7-redo-log-file">1.7 redo log file</h3><h4 id="1-7-1-ç›¸å…³å‚æ•°è®¾ç½®">1.7.1 ç›¸å…³å‚æ•°è®¾ç½®</h4><p>*<code>innodb_log_group_home_dir</code>ï¼šæŒ‡å®š redo log æ–‡ä»¶ç»„æ‰€åœ¨çš„è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º<code>./</code>ï¼Œè¡¨ç¤ºåœ¨æ•°æ®åº“ çš„æ•°æ®ç›®å½•ä¸‹ã€‚MySQLçš„é»˜è®¤æ•°æ®ç›®å½•ï¼ˆ<code>var/lib/mysql</code>ï¼‰ä¸‹é»˜è®¤æœ‰ä¸¤ä¸ªåä¸º<code>ib_logfile0</code>å’Œ<code>ib_logfile1</code>çš„æ–‡ä»¶ï¼Œlog bufferä¸­çš„æ—¥å¿—é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯åˆ·æ–°åˆ°è¿™ä¸¤ä¸ªç£ç›˜æ–‡ä»¶ä¸­ã€‚æ­¤redoæ—¥å¿— æ–‡ä»¶ä½ç½®è¿˜å¯ä»¥ä¿®æ”¹ã€‚</p><p>*<code>innodb_log_files_in_group</code>ï¼šæŒ‡æ˜redo log fileçš„ä¸ªæ•°ï¼Œå‘½åæ–¹å¼å¦‚ï¼šib_logfile0ï¼Œiblogfile1â€¦ iblogfilenã€‚é»˜è®¤2ä¸ªï¼Œæœ€å¤§100ä¸ªã€‚</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_log_files_in_group&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name             <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> innodb_log_files_in_group <span class="operator">|</span> <span class="number">2</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+-------+</span></span><br><span class="line">#ib_logfile0</span><br><span class="line">#ib_logfile1</span><br></pre></td></tr></table></figure><p>*<code>innodb_flush_log_at_trx_commit</code>ï¼šæ§åˆ¶ redo log åˆ·æ–°åˆ°ç£ç›˜çš„ç­–ç•¥ï¼Œé»˜è®¤ä¸º1ã€‚</p><p>*<code>innodb_log_file_size</code>ï¼šå•ä¸ª redo log æ–‡ä»¶è®¾ç½®å¤§å°ï¼Œé»˜è®¤å€¼ä¸º<code>48M</code>ã€‚æœ€å¤§å€¼ä¸º512Gï¼Œæ³¨æ„æœ€å¤§å€¼ æŒ‡çš„æ˜¯æ•´ä¸ª redo log ç³»åˆ—æ–‡ä»¶ä¹‹å’Œï¼Œå³ï¼ˆinnodb_log_files_in_group * innodb_log_file_size ï¼‰ä¸èƒ½å¤§ äºæœ€å¤§å€¼512Gã€‚</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_log_file_size&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name        <span class="operator">|</span> <span class="keyword">Value</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> innodb_log_file_size <span class="operator">|</span> <span class="number">50331648</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸šåŠ¡ä¿®æ”¹å…¶å¤§å°ï¼Œä»¥ä¾¿å®¹çº³è¾ƒå¤§çš„äº‹åŠ¡ã€‚ç¼–è¾‘my.cnfæ–‡ä»¶å¹¶é‡å¯æ•°æ®åº“ç”Ÿæ•ˆï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# vim <span class="operator">/</span>etc<span class="operator">/</span>my.cnf</span><br><span class="line">innodb_log_file_size<span class="operator">=</span><span class="number">200</span>M</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ•°æ®åº“å®ä¾‹æ›´æ–°æ¯”è¾ƒé¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‚å½“åŠ å¤§ redo log æ•°ç»„å’Œå¤§å°ã€‚ä½†ä¹Ÿä¸æ¨è redo log è®¾ç½®è¿‡å¤§ï¼Œåœ¨MySQLå´©æºƒæ—¶ä¼šé‡æ–°æ‰§è¡ŒREDOæ—¥å¿—ä¸­çš„è®°å½•ã€‚</p></blockquote><h4 id="1-7-2-æ—¥å¿—æ–‡ä»¶ç»„">1.7.2 æ—¥å¿—æ–‡ä»¶ç»„</h4><blockquote><p>æˆ‘ä»¬çŸ¥é“ redo log æ˜¯ä¸ºäº†<span class='p red'>é˜²æ­¢Buffer Poolä¸­çš„è„é¡µä¸¢å¤±è€Œè®¾è®¡çš„</span>ï¼Œé‚£ä¹ˆå¦‚æœéšç€ç³»ç»Ÿè¿è¡Œï¼ŒBuffer Poolçš„è„é¡µåˆ·æ–°åˆ°äº†ç£ç›˜ä¸­ï¼Œé‚£ä¹ˆ redo logå¯¹åº”çš„è®°å½•ä¹Ÿå°±æ²¡ç”¨äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ“¦é™¤è¿™äº›æ—§è®°å½•ï¼Œä»¥è…¾å‡ºç©ºé—´è®°å½•æ–°çš„æ›´æ–°æ“ä½œã€‚</p></blockquote><p>ä»ä¸Šè¾¹çš„æè¿°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç£ç›˜ä¸Šçš„<code>redo</code>æ—¥å¿—æ–‡ä»¶ä¸åªä¸€ä¸ªï¼Œè€Œæ˜¯ä»¥ä¸€ä¸ª<code>æ—¥å¿—æ–‡ä»¶ç»„</code>çš„å½¢å¼å‡ºç°çš„ã€‚è¿™äº›æ–‡ä»¶ä»¥ib_logfile[æ•°å­—] (æ•°å­—å¯ä»¥æ˜¯0ã€1ã€2â€¦)çš„å½¢å¼è¿›è¡Œå‘½åï¼Œæ¯ä¸ªçš„redoæ—¥å¿—æ–‡ä»¶å¤§å°éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>åœ¨å°†redoæ—¥å¿—å†™å…¥æ—¥å¿—æ–‡ä»¶ç»„æ—¶ï¼Œæ˜¯ä»<code>ib-1ogfile0</code>å¼€å§‹å†™ï¼Œå¦‚æœ<code>ib_logfile0</code>å†™æ»¡äº†ï¼Œå°±æ¥ç€<code>ib-1ogfile1</code>å†™ã€‚åŒç†,<code>ib_1ogfile1</code>å†™æ»¡äº†å°±å»å†™<code>ib_logfile2</code>ï¼Œä¾æ­¤ç±»æ¨ã€‚å¦‚æœå†™åˆ°æœ€åä¸€ä¸ªæ–‡ä»¶è¯¥å’‹åŠï¼Ÿé‚£å°±é‡æ–°è½¬åˆ°<code>ib_logfile0</code>ç»§ç»­å†™ï¼Œæ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711152242300.png" alt="image-20220711152242300" style="zoom:67%;" /><p>æ€»å…±çš„redoæ—¥å¿—æ–‡ä»¶å¤§å°å…¶å®å°±æ˜¯ï¼š<code>innodb_log_file_size Ã— innodb_log_files_in_group</code></p><p>é‡‡ç”¨å¾ªç¯ä½¿ç”¨çš„æ–¹å¼å‘redoæ—¥å¿—æ–‡ä»¶ç»„é‡Œå†™æ•°æ®çš„è¯ï¼Œä¼šå¯¼è‡´åå†™å…¥çš„redoæ—¥å¿—è¦†ç›–æ‰å‰è¾¹å†™çš„redoæ—¥å¿—ï¼Ÿå½“ç„¶ï¼æ‰€ä»¥InnoDBçš„è®¾è®¡è€…æå‡ºäº†checkpointçš„æ¦‚å¿µã€‚</p><h4 id="1-7-3-checkpoint">1.7.3 checkpoint</h4><p>åœ¨æ•´ä¸ªæ—¥å¿—æ–‡ä»¶ç»„ä¸­è¿˜æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯ write posã€checkpoint</p><ul><li><code>write pos</code>æ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»</li><li><code>checkpoint</code>æ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯å¾€åæ¨ç§»</li></ul><p>æ¯æ¬¡åˆ·ç›˜ redo logè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ç»„ä¸­ï¼Œwrite posä½ç½®å°±ä¼šåç§»æ›´æ–°ã€‚æ¯æ¬¡MySQLåŠ è½½æ—¥å¿—æ–‡ä»¶ç»„æ¢å¤æ•°æ®æ—¶ï¼Œä¼šæ¸…ç©ºåŠ è½½è¿‡çš„ redo logè®°å½•ï¼Œå¹¶æŠŠcheck pointåç§»æ›´æ–°ã€‚write poså’Œ checkpointä¹‹é—´çš„è¿˜ç©ºç€çš„éƒ¨åˆ†å¯ä»¥ç”¨æ¥å†™å…¥æ–°çš„ redo logè®°å½•ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711152631108.png" alt="image-20220711152631108" style="zoom: 50%;" /><p>å¦‚æœ write posè¿½ä¸Š checkpoint ï¼Œè¡¨ç¤º<code>æ—¥å¿—æ–‡ä»¶ç»„</code>æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†å†™å…¥æ–°çš„ redo logè®°å½•ï¼ŒMySQLå¾—åœä¸‹æ¥ï¼Œæ¸…ç©ºä¸€äº›è®°å½•ï¼ŒæŠŠ checkpoint æ¨è¿›ä¸€ä¸‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711152802294.png" alt="image-20220711152802294" style="zoom: 50%;" /><hr><h3 id="1-8-redo-log-å°ç»“">1.8 redo log å°ç»“</h3><p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ redo log çš„ä½œç”¨å’Œå®ƒçš„åˆ·ç›˜æ—¶æœºã€å­˜å‚¨å½¢å¼ï¼š</p><span class='p red'>InnoDB çš„æ›´æ–°æ“ä½œé‡‡ç”¨çš„æ˜¯ Write Ahead Log(é¢„å…ˆæ—¥å¿—æŒä¹…åŒ–)ç­–ç•¥ï¼Œå³å…ˆå†™æ—¥å¿—ï¼Œå†å†™å…¥ç£ç›˜ã€‚</span><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414113010900.png" alt="image-20230414113010900" style="zoom:67%;" /><hr><h2 id="2-undoæ—¥å¿—">2. undoæ—¥å¿—</h2><p>redo logæ˜¯äº‹åŠ¡æŒä¹…æ€§çš„ä¿è¯ï¼Œundo logæ˜¯äº‹åŠ¡åŸå­æ€§çš„ä¿è¯ã€‚åœ¨äº‹åŠ¡ä¸­<code>æ›´æ–°æ•°æ®</code>çš„<code>å‰ç½®æ“ä½œ</code>å…¶å®æ˜¯è¦å…ˆå†™å…¥ä¸€ä¸ª<code>undo log</code>ã€‚</p><hr><h3 id="2-1-å¦‚ä½•ç†è§£undoæ—¥å¿—">2.1 å¦‚ä½•ç†è§£undoæ—¥å¿—</h3><p>äº‹åŠ¡éœ€è¦ä¿è¯<code>åŸå­æ€§</code>ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆä»€ä¹ˆä¹Ÿä¸åšã€‚ä½†æœ‰æ—¶å€™äº‹åŠ¡æ‰§è¡Œåˆ°ä¸€åŠä¼šå‡ºç°ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚ï¼š</p><ul><li>æƒ…å†µä¸€ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°å„ç§é”™è¯¯ï¼Œæ¯”å¦‚<code>æœåŠ¡å™¨æœ¬èº«çš„é”™è¯¯</code>ï¼Œ<code>æ“ä½œç³»ç»Ÿé”™è¯¯</code>ï¼Œç”šè‡³æ˜¯çªç„¶<code>æ–­ç”µ</code>å¯¼è‡´çš„é”™è¯¯ã€‚</li><li>æƒ…å†µäºŒï¼šç¨‹åºå‘˜å¯ä»¥åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰‹åŠ¨è¾“å…¥<code>ROLLBACK</code>è¯­å¥ç»“æŸå½“å‰äº‹åŠ¡çš„æ‰§è¡Œã€‚</li></ul><p>ä»¥ä¸Šæƒ…å†µå‡ºç°ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®æ”¹å›åŸå…ˆçš„æ ·å­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸º<code>å›æ»š</code>ï¼Œè¿™æ ·å°±å¯ä»¥é€ æˆä¸€ä¸ªå‡è±¡ï¼šè¿™ä¸ªäº‹åŠ¡çœ‹èµ·æ¥ä»€ä¹ˆéƒ½æ²¡åšï¼Œæ‰€ä»¥ç¬¦åˆ<code>åŸå­æ€§</code>è¦æ±‚ã€‚</p><p>æ¯å½“æˆ‘ä»¬è¦å¯¹ä¸€æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼ˆè¿™é‡Œçš„<code>æ”¹åŠ¨</code>å¯ä»¥æŒ‡<code>INSERT</code>ã€<code>DELETE</code>ã€<code>UPDATE</code>ï¼‰ï¼Œéƒ½éœ€è¦&quot;ç•™ä¸€æ‰‹&quot;â€“æŠŠå›æ»šæ—¶æ‰€éœ€çš„ä¸œè¥¿è®°ä¸‹æ¥ã€‚æ¯”å¦‚ï¼š</p><ul><li><p>ä½ <code>æ’å…¥ä¸€æ¡è®°å½•</code>ï¼Œè‡³å°‘è¦æŠŠè¿™æ¡è®°å½•çš„<code>ä¸»é”®å€¼</code>è®°ä¸‹æ¥ï¼Œä¹‹åå›æ»šçš„æ—¶å€™åªéœ€è¦æŠŠè¿™ä¸ªä¸»é”®å€¼å¯¹åº”çš„è®°å½•<code>åˆ æ‰</code>å°±å¥½äº†ã€‚ï¼ˆå¯¹äºæ¯ä¸ªINSERTï¼Œ InnoDBå­˜å‚¨å¼•æ“ä¼šå®Œæˆä¸€ä¸ªDELETE)</p></li><li><p>ä½ <code>åˆ é™¤äº†ä¸€æ¡è®°å½•</code>ï¼Œè‡³å°‘è¦æŠŠè¿™æ¡è®°å½•ä¸­çš„<code>å†…å®¹</code>éƒ½è®°ä¸‹æ¥ï¼Œè¿™æ ·ä¹‹åå›æ»šæ—¶å†æŠŠç”±è¿™äº›å†…å®¹ç»„æˆçš„è®°å½•<code>æ’å…¥</code>åˆ°è¡¨ä¸­å°±å¥½äº†ã€‚ï¼ˆå¯¹äºæ¯ä¸ªDELETEï¼Œ InnoDBå­˜å‚¨å¼•æ“ä¼šæ‰§è¡Œä¸€ä¸ªINSERT)</p></li><li><p>ä½ <code>ä¿®æ”¹äº†ä¸€æ¡è®°å½•</code>ï¼Œè‡³å°‘è¦æŠŠä¿®æ”¹è¿™æ¡è®°å½•å‰çš„<code>æ—§å€¼</code>éƒ½è®°å½•ä¸‹æ¥ï¼Œè¿™æ ·ä¹‹åå›æ»šæ—¶å†æŠŠè¿™æ¡è®°å½•<code>æ›´æ–°ä¸ºæ—§å€¼</code>å°±å¥½äº†ã€‚ï¼ˆå¯¹äºæ¯ä¸ªUPDATEï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šæ‰§è¡Œä¸€ä¸ªç›¸åçš„UPDATEï¼Œå°†ä¿®æ”¹å‰çš„è¡Œæ”¾å›å»ï¼‰</p></li></ul><p>MySQLæŠŠè¿™äº›ä¸ºäº†å›æ»šè€Œè®°å½•çš„è¿™äº›å†…å®¹ç§°ä¹‹ä¸º<code>æ’¤é”€æ—¥å¿—</code>æˆ–è€…<code>å›æ»šæ—¥å¿—</code>ï¼ˆå³ undo log)ã€‚æ³¨æ„ï¼Œç”±äºæŸ¥è¯¢æ“ä½œ (<code>SELECT</code>ï¼‰å¹¶ä¸ä¼šä¿®æ”¹ä»»ä½•ç”¨æˆ·è®°å½•ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢æ“ä½œæ‰§è¡Œæ—¶ï¼Œå¹¶<code>ä¸éœ€è¦è®°å½•</code>ç›¸åº”çš„undoæ—¥å¿—ã€‚</p><p>æ­¤å¤–ï¼Œundo log<code>ä¼šäº§ç”Ÿredo log</code>ï¼Œä¹Ÿå°±æ˜¯undo logçš„äº§ç”Ÿä¼šä¼´éšç€redo logçš„äº§ç”Ÿï¼Œè¿™æ˜¯å› ä¸ºundo logä¹Ÿéœ€è¦æŒä¹…æ€§çš„ä¿æŠ¤ã€‚</p><hr><h3 id="2-2-undoæ—¥å¿—çš„ä½œç”¨">2.2 undoæ—¥å¿—çš„ä½œç”¨</h3><ul><li><p>ä½œç”¨1ï¼šå›æ»šæ•°æ®</p><p>ç”¨æˆ·å¯¹undoæ—¥å¿—å¯èƒ½<code>æœ‰è¯¯è§£</code>ï¼šundoç”¨äºå°†æ•°æ®åº“ç‰©ç†åœ°æ¢å¤åˆ°æ‰§è¡Œè¯­å¥æˆ–äº‹åŠ¡ä¹‹å‰çš„æ ·å­ã€‚ä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚</p><p>undoæ˜¯<code>é€»è¾‘æ—¥å¿—</code>ï¼Œå› æ­¤åªæ˜¯å°†æ•°æ®åº“é€»è¾‘åœ°æ¢å¤åˆ°åŸæ¥çš„æ ·å­ã€‚æ‰€æœ‰ä¿®æ”¹éƒ½è¢«é€»è¾‘åœ°å–æ¶ˆäº†ï¼Œ<span class='p green'>ä½†æ˜¯æ•°æ®ç»“æ„å’Œé¡µæœ¬èº«åœ¨å›æ»šä¹‹åå¯èƒ½å¤§ä¸ç›¸åŒã€‚</span></p><p>è¿™æ˜¯å› ä¸ºåœ¨å¤šç”¨æˆ·å¹¶å‘ç³»ç»Ÿä¸­ï¼Œå¯èƒ½ä¼šæœ‰æ•°åã€æ•°ç™¾ç”šè‡³æ•°å¹²ä¸ªå¹¶å‘äº‹åŠ¡ã€‚æ•°æ®åº“çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯åè°ƒå¯¹æ•°æ®è®°å½•çš„å¹¶å‘è®¿é—®ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨ä¿®æ”¹å½“å‰ä¸€ä¸ªé¡µä¸­æŸå‡ æ¡è®°å½•ï¼ŒåŒæ—¶è¿˜æœ‰åˆ«çš„äº‹åŠ¡åœ¨å¯¹åŒä¸€ä¸ªé¡µä¸­å¦å‡ æ¡è®°å½•è¿›è¡Œä¿®æ”¹ã€‚å› æ­¤ï¼Œä¸èƒ½å°†ä¸€ä¸ªé¡µå›æ»šåˆ°äº‹åŠ¡å¼€å§‹çš„æ ·å­ï¼Œå› ä¸ºè¿™æ ·ä¼šå½±å“å…¶ä»–äº‹åŠ¡æ­£åœ¨è¿›è¡Œçš„å·¥ä½œã€‚</p></li><li><p>ä½œç”¨2ï¼šMVCC</p><p>undoçš„å¦ä¸€ä¸ªä½œç”¨æ˜¯MVCCï¼Œå³åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­MVCCçš„å®ç°æ˜¯é€šè¿‡undoæ¥å®Œæˆã€‚å½“ç”¨æˆ·è¯»å–ä¸€è¡Œè®°å½•æ—¶ï¼Œè‹¥è¯¥è®°å½•ä»¥åŠè¢«å…¶ä»–äº‹åŠ¡å ç”¨ï¼Œå½“å‰äº‹åŠ¡å¯ä»¥é€šè¿‡undoè¯»å–ä¹‹å‰çš„è¡Œç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥æ­¤å®ç°éé”å®šè¯»å–ã€‚</p></li></ul><hr><h3 id="2-3-undoçš„å­˜å‚¨ç»“æ„">2.3 undoçš„å­˜å‚¨ç»“æ„</h3><h4 id="2-3-1-å›æ»šæ®µä¸undoé¡µ">2.3.1 å›æ»šæ®µä¸undoé¡µ</h4><p>InnoDBå¯¹undo logçš„ç®¡ç†é‡‡ç”¨æ®µçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯<code>å›æ»šæ®µï¼ˆrollback segmentï¼‰</code>ã€‚æ¯ä¸ªå›æ»šæ®µè®°å½•äº†<code>1024</code>ä¸ª<code>undo log segment</code>ï¼Œè€Œåœ¨æ¯ä¸ªundo log segmentæ®µä¸­è¿›è¡Œ<code>undoé¡µ</code>çš„ç”³è¯·ã€‚</p><ul><li>åœ¨<code>InnoDB1.1ç‰ˆæœ¬ä¹‹å‰</code>ï¼ˆä¸åŒ…æ‹¬1.1ç‰ˆæœ¬ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªrollback segmentï¼Œå› æ­¤æ”¯æŒåŒæ—¶åœ¨çº¿çš„äº‹åŠ¡é™åˆ¶ä¸º<code>1024</code>ã€‚è™½ç„¶å¯¹ç»å¤§å¤šæ•°çš„åº”ç”¨æ¥è¯´éƒ½å·²ç»å¤Ÿç”¨ã€‚</li><li>ä»1.1ç‰ˆæœ¬å¼€å§‹InnoDBæ”¯æŒæœ€å¤§<code>128ä¸ªrollback segment</code>ï¼Œæ•…å…¶æ”¯æŒåŒæ—¶åœ¨çº¿çš„äº‹åŠ¡é™åˆ¶æé«˜åˆ° äº†<code>128*1024</code>ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_undo_logs&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> innodb_undo_logs <span class="operator">|</span> <span class="number">128</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br></pre></td></tr></table></figure><p>è™½ç„¶InnoDB1.1ç‰ˆæœ¬æ”¯æŒäº†128ä¸ªrolback segmentï¼Œä½†æ˜¯è¿™äº›rollback segmentéƒ½å­˜å‚¨äºå…±äº«è¡¨ç©ºé—´ibdataä¸­ã€‚ä» InnoDB1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¯é€šè¿‡å‚æ•°å¯¹rollback segmentåšè¿›ä¸€æ­¥çš„è®¾ç½®ã€‚è¿™äº›å‚æ•°åŒ…æ‹¬ï¼š</p><p>-<code>innodb_undo_directory</code>ï¼šè®¾ç½®rollback segmentæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ã€‚è¿™æ„å‘³ç€rollback segmentå¯ä»¥å­˜æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ä»¥å¤–çš„ä½ç½®ï¼Œå³å¯ä»¥è®¾ç½®ä¸ºç‹¬ç«‹è¡¨ç©ºé—´ã€‚è¯¥å‚æ•°çš„é»˜è®¤å€¼ä¸º&quot;./&quot;ï¼Œè¡¨ç¤ºå½“å‰InnoDBå­˜å‚¨å¼•æ“çš„ç›®å½•ã€‚</p><p>-<code>innodb_undo_logs</code>ï¼šè®¾ç½®rollback segmentçš„ä¸ªæ•°ï¼Œé»˜è®¤å€¼ä¸º128ã€‚åœ¨InnoDB1.2ç‰ˆæœ¬ä¸­ï¼Œè¯¥å‚æ•°ç”¨æ¥æ›¿æ¢ä¹‹å‰ç‰ˆæœ¬çš„å‚æ•°innodb_rollback_segmentsã€‚</p><p>-<code>innodb_undo_tablespaces</code>ï¼šè®¾ç½®æ„æˆrollback segmentæ–‡ä»¶çš„æ•°é‡ï¼Œè¿™æ ·rollback segmentå¯ä»¥è¾ƒä¸ºå¹³å‡åœ°åˆ†å¸ƒåœ¨å¤šä¸ªæ–‡ä»¶ä¸­ã€‚è®¾ç½®è¯¥å‚æ•°åï¼Œä¼šåœ¨è·¯å¾„imnodb_undo_directoryçœ‹åˆ°undoä¸ºå‰ç¼€çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°±ä»£è¡¨ rollback segmentæ–‡ä»¶ã€‚</p><p>undo log ç›¸å…³å‚æ•°ä¸€èˆ¬å¾ˆå°‘æ”¹åŠ¨ã€‚</p><span class='p red'>undoé¡µçš„é‡ç”¨</span><p>å½“æˆ‘ä»¬å¼€å¯ä¸€ä¸ªäº‹åŠ¡éœ€è¦å†™undo logçš„æ—¶å€™ï¼Œå°±å¾—å…ˆå»undo log segmentä¸­å»æ‰¾åˆ°ä¸€ä¸ªç©ºé—²çš„ä½ç½®ï¼Œå½“æœ‰ç©ºä½çš„æ—¶å€™ï¼Œå°±å»ç”³è¯·undoé¡µï¼Œåœ¨è¿™ä¸ªç”³è¯·åˆ°çš„undoé¡µä¸­è¿›è¡Œundo logçš„å†™å…¥ã€‚æˆ‘ä»¬çŸ¥é“mysqlé»˜è®¤ä¸€é¡µçš„å¤§å°æ˜¯16kã€‚</p><p>ä¸ºæ¯ä¸€ä¸ªäº‹åŠ¡åˆ†é…ä¸€ä¸ªé¡µï¼Œæ˜¯éå¸¸æµªè´¹çš„ï¼ˆé™¤éä½ çš„äº‹åŠ¡éå¸¸é•¿ï¼‰ï¼Œå‡è®¾ä½ çš„åº”ç”¨çš„TPSï¼ˆæ¯ç§’å¤„ç†çš„äº‹åŠ¡æ•°ç›®ï¼‰ä¸º1000ï¼Œé‚£ä¹ˆ1så°±éœ€è¦1000ä¸ªé¡µï¼Œå¤§æ¦‚éœ€è¦16Mçš„å­˜å‚¨ï¼Œ1åˆ†é’Ÿå¤§æ¦‚éœ€è¦1Gçš„å­˜å‚¨ã€‚å¦‚æœç…§è¿™æ ·ä¸‹å»é™¤é MySQLæ¸…ç†çš„éå¸¸å‹¤å¿«ï¼Œå¦åˆ™éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç£ç›˜ç©ºé—´ä¼šå¢é•¿çš„éå¸¸å¿«ï¼Œè€Œä¸”å¾ˆå¤šç©ºé—´éƒ½æ˜¯æµªè´¹çš„ã€‚</p><p>äºæ˜¯undoé¡µå°±è¢«è®¾è®¡çš„å¯ä»¥<code>é‡ç”¨</code>äº†ï¼Œå½“äº‹åŠ¡æäº¤æ—¶ï¼Œå¹¶ä¸ä¼šç«‹åˆ»åˆ é™¤undoé¡µã€‚å› ä¸ºé‡ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªundoé¡µå¯èƒ½æ··æ‚ç€å…¶ä»–äº‹åŠ¡çš„undo logã€‚undo logåœ¨commitåï¼Œä¼šè¢«æ”¾åˆ°ä¸€ä¸ª<code>é“¾è¡¨</code>ä¸­ï¼Œç„¶ååˆ¤æ–­undoé¡µçš„ä½¿ç”¨ç©ºé—´æ˜¯å¦<code>å°äº 3/4</code>ï¼Œå¦‚æœå°äº3/4çš„è¯ï¼Œåˆ™è¡¨ç¤ºå½“å‰çš„undoé¡µå¯ä»¥è¢«é‡ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šè¢«å›æ”¶ï¼Œå…¶ä»–äº‹åŠ¡çš„undo logå¯ä»¥è®°å½•åœ¨å½“å‰undoé¡µçš„åé¢ã€‚ç”±äºundo logæ˜¯<code>ç¦»æ•£</code>çš„ï¼Œæ‰€ä»¥æ¸…ç†å¯¹åº”çš„ç£ç›˜ç©ºé—´æ—¶ï¼Œæ•ˆç‡ä¸é«˜ã€‚</p><hr><h4 id="2-3-2-å›æ»šæ®µä¸äº‹åŠ¡">2.3.2 å›æ»šæ®µä¸äº‹åŠ¡</h4><ol><li><p>æ¯ä¸ªäº‹åŠ¡åªä¼šä½¿ç”¨ä¸€ä¸ªå›æ»šæ®µï¼Œä¸€ä¸ªå›æ»šæ®µåœ¨åŒä¸€æ—¶åˆ»å¯èƒ½ä¼šæœåŠ¡äºå¤šä¸ªäº‹åŠ¡ã€‚</p></li><li><p>å½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œä¼šåˆ¶å®šä¸€ä¸ªå›æ»šæ®µï¼Œåœ¨äº‹åŠ¡è¿›è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼ŒåŸå§‹çš„æ•°æ®ä¼šè¢«å¤åˆ¶åˆ°å›æ»šæ®µã€‚</p></li><li><p>åœ¨å›æ»šæ®µä¸­ï¼Œäº‹åŠ¡ä¼šä¸æ–­å¡«å……ç›˜åŒºï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæˆ–æ‰€æœ‰çš„ç©ºé—´è¢«ç”¨å®Œã€‚å¦‚æœå½“å‰çš„ç›˜åŒºä¸å¤Ÿ ç”¨ï¼Œäº‹åŠ¡ä¼šåœ¨æ®µä¸­è¯·æ±‚æ‰©å±•ä¸‹ä¸€ä¸ªç›˜åŒºï¼Œå¦‚æœæ‰€æœ‰å·²åˆ†é…çš„ç›˜åŒºéƒ½è¢«ç”¨å®Œï¼Œäº‹åŠ¡ä¼šè¦†ç›–æœ€åˆçš„ç›˜ åŒºæˆ–è€…åœ¨å›æ»šæ®µå…è®¸çš„æƒ…å†µä¸‹æ‰©å±•æ–°çš„ç›˜åŒºæ¥ä½¿ç”¨ã€‚</p></li><li><p>å›æ»šæ®µå­˜åœ¨äºundoè¡¨ç©ºé—´ä¸­ï¼Œåœ¨æ•°æ®åº“ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªundoè¡¨ç©ºé—´ï¼Œä½†åŒä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨ä¸€ä¸ª undoè¡¨ç©ºé—´ã€‚</p></li></ol>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_undo_tablespaces&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name           <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> innodb_undo_tablespaces <span class="operator">|</span> <span class="number">2</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+-------+</span></span><br><span class="line"># undo logçš„æ•°é‡ï¼Œæœ€å°‘ä¸º<span class="number">2.</span> undo logçš„<span class="keyword">truncate</span>æ“ä½œæœ‰purgeåè°ƒçº¿ç¨‹å‘èµ·ã€‚åœ¨<span class="keyword">truncate</span>æŸä¸ªundo logè¡¨ç©ºé—´çš„è¿‡ç¨‹ä¸­ï¼Œä¿è¯æœ‰ä¸€ä¸ªå¯ç”¨çš„undo logå¯ç”¨ã€‚</span><br></pre></td></tr></table></figure><ol start="5"><li><p>å½“äº‹åŠ¡æäº¤æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šåšä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li>å°†undo logæ”¾å…¥åˆ—è¡¨ä¸­ï¼Œä»¥ä¾›ä¹‹åçš„purgeæ“ä½œ</li><li>åˆ¤æ–­undo logæ‰€åœ¨çš„é¡µæ˜¯å¦å¯ä»¥é‡ç”¨ï¼Œè‹¥å¯ä»¥åˆ†é…ç»™ä¸‹ä¸ªäº‹åŠ¡ä½¿ç”¨</li></ul></li></ol><hr><h4 id="2-3-3-å›æ»šæ®µä¸­çš„æ•°æ®åˆ†ç±»">2.3.3 å›æ»šæ®µä¸­çš„æ•°æ®åˆ†ç±»</h4><p>1.<code>æœªæäº¤çš„å›æ»šæ•°æ®(uncommitted undo information)</code>ï¼šè¯¥æ•°æ®æ‰€å…³è”çš„äº‹åŠ¡å¹¶æœªæäº¤ï¼Œç”¨äºå®ç°è¯»ä¸€è‡´æ€§ï¼Œæ‰€ä»¥è¯¥æ•°æ®ä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡çš„æ•°æ®è¦†ç›–ã€‚<br>2.<code>å·²ç»æäº¤ä½†æœªè¿‡æœŸçš„å›æ»šæ•°æ®(committed undo information)</code>ï¼šè¯¥æ•°æ®å…³è”çš„äº‹åŠ¡å·²ç»æäº¤ï¼Œä½†æ˜¯ä»å—åˆ°undo retentionå‚æ•°çš„ä¿æŒæ—¶é—´çš„å½±å“ã€‚<br>3.<code>äº‹åŠ¡å·²ç»æäº¤å¹¶è¿‡æœŸçš„æ•°æ®(expired undo information)</code>ï¼šäº‹åŠ¡å·²ç»æäº¤ï¼Œè€Œä¸”æ•°æ®ä¿å­˜æ—¶é—´å·²ç»è¶…è¿‡ undo retentionå‚æ•°æŒ‡å®šçš„æ—¶é—´ï¼Œå±äºå·²ç»è¿‡æœŸçš„æ•°æ®ã€‚å½“å›æ»šæ®µæ»¡äº†ä¹‹åï¼Œå°±ä¼˜å…ˆè¦†ç›–â€œäº‹åŠ¡å·²ç»æäº¤å¹¶è¿‡æœŸçš„æ•°æ®&quot;ã€‚</p><p>äº‹åŠ¡æäº¤åä¸èƒ½é©¬ä¸Šåˆ é™¤undo logåŠundo logæ‰€åœ¨çš„é¡µã€‚è¿™æ˜¯å› ä¸ºå¯èƒ½è¿˜æœ‰å…¶ä»–äº‹åŠ¡éœ€è¦é€šè¿‡undo logæ¥å¾—åˆ°è¡Œè®°å½•ä¹‹å‰çš„ç‰ˆæœ¬ã€‚æ•…äº‹åŠ¡æäº¤æ—¶å°†undo logæ”¾å…¥ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œæ˜¯å¦å¯ä»¥æœ€ç»ˆåˆ é™¤undo logä»¥undo logæ‰€åœ¨é¡µç”±purgeçº¿ç¨‹æ¥åˆ¤æ–­ã€‚</p><hr><h3 id="2-4-undoçš„ç±»å‹">2.4 undoçš„ç±»å‹</h3><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œundo logåˆ†ä¸ºï¼š</p><ul><li><p>insert undo log</p><p>insert undo logæ˜¯æŒ‡insertæ“ä½œä¸­äº§ç”Ÿçš„undo logã€‚å› ä¸ºinsertæ“ä½œçš„è®°å½•ï¼Œåªå¯¹äº‹åŠ¡æœ¬èº«å¯è§ï¼Œå¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ï¼ˆè¿™æ˜¯äº‹åŠ¡éš”ç¦»æ€§çš„è¦æ±‚ï¼‰ï¼Œæ•…è¯¥undo logå¯ä»¥åœ¨äº‹åŠ¡æäº¤åç›´æ¥åˆ é™¤ã€‚ä¸éœ€è¦è¿›è¡Œpurgeæ“ä½œã€‚</p></li><li><p>update undo log</p><p>update undo logè®°å½•çš„æ˜¯å¯¹deleteå’Œupdateæ“ä½œäº§ç”Ÿçš„undo logã€‚è¯¥undo logå¯èƒ½éœ€è¦æä¾›MVCCæœºåˆ¶ï¼Œå› æ­¤ä¸èƒ½åœ¨äº‹åŠ¡æäº¤æ—¶å°±è¿›è¡Œåˆ é™¤ã€‚æäº¤æ—¶æ”¾å…¥undo logé“¾è¡¨ï¼Œç­‰å¾…purgeçº¿ç¨‹è¿›è¡Œæœ€åçš„åˆ é™¤ã€‚</p></li></ul><hr><h3 id="2-5-undo-logçš„ç”Ÿå‘½å‘¨æœŸ">2.5 undo logçš„ç”Ÿå‘½å‘¨æœŸ</h3><h4 id="2-5-1-ç®€è¦ç”Ÿæˆè¿‡ç¨‹">2.5.1 ç®€è¦ç”Ÿæˆè¿‡ç¨‹</h4><p>ä»¥ä¸‹æ˜¯undo+redoäº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹</p><p>å‡è®¾æœ‰ä¸¤ä¸ªæ•°å€¼ï¼Œåˆ†åˆ«ä¸ºA=1å’ŒB=2ï¼Œç„¶åå°†Aä¿®æ”¹ä¸º3ï¼ŒBä¿®æ”¹ä¸º4</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711162414928.png" alt="image-20220711162414928"  /><p><strong>åªæœ‰Buffer Poolçš„æµç¨‹ï¼š</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711162505008.png" alt="image-20220711162505008" style="zoom: 67%;" /><p><strong>æœ‰äº†Redo Logå’ŒUndo Logä¹‹åï¼š</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711162642305.png" alt="image-20220711162642305" style="zoom:67%;" /><p>åœ¨æ›´æ–°Buffer Poolä¸­çš„æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†è¯¥æ•°æ®äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€å†™å…¥Undo Logä¸­ã€‚å‡è®¾æ›´æ–°åˆ°ä¸€åŠå‡ºé”™äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Undo Logæ¥å›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰ã€‚</p><hr><h4 id="2-5-2-è¯¦ç»†ç”Ÿæˆè¿‡ç¨‹">2.5.2 è¯¦ç»†ç”Ÿæˆè¿‡ç¨‹</h4><p>å¯¹äºInnoDBå¼•æ“æ¥è¯´ï¼Œæ¯ä¸ªè¡Œè®°å½•é™¤äº†è®°å½•æœ¬èº«çš„æ•°æ®ä¹‹å¤–ï¼Œè¿˜æœ‰å‡ ä¸ªéšè—çš„åˆ—ï¼š</p><ul><li><code>DB_ROW_ID</code>ï¼šå¦‚æœæ²¡æœ‰ä¸ºè¡¨æ˜¾å¼çš„å®šä¹‰ä¸»é”®ï¼Œå¹¶ä¸”è¡¨ä¸­ä¹Ÿæ²¡æœ‰å®šä¹‰å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆInnoDBä¼šè‡ªåŠ¨ä¸ºè¡¨æ·»åŠ ä¸€ä¸ªrow_idçš„éšè—åˆ—ä½œä¸ºä¸»é”®ã€‚</li><li><code>DB_TRX_ID</code>ï¼šæ¯ä¸ªäº‹åŠ¡éƒ½ä¼šåˆ†é…ä¸€ä¸ªäº‹åŠ¡IDï¼Œå½“å¯¹æŸæ¡è®°å½•å‘ç”Ÿå˜æ›´æ—¶ï¼Œå°±ä¼šå°†è¿™ä¸ªäº‹åŠ¡çš„äº‹åŠ¡IDå†™å…¥trx_id ä¸­ã€‚</li><li><code>DB_ ROLL_PTR</code>ï¼š å›æ»šæŒ‡é’ˆï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æŒ‡å‘ undo log çš„æŒ‡é’ˆã€‚</li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230414112728356.png" alt="image-20230414112728356"></p><p><strong>å½“æˆ‘ä»¬æ‰§è¡ŒINSERTæ—¶ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> (name) <span class="keyword">VALUES</span> (&quot;tom&quot;);</span><br></pre></td></tr></table></figure><p>æ’å…¥çš„æ•°æ®éƒ½ä¼šç”Ÿæˆä¸€æ¡insert undo logï¼Œå¹¶ä¸”æ•°æ®çš„å›æ»šæŒ‡é’ˆä¼šæŒ‡å‘å®ƒã€‚undo logä¼šè®°å½•undo logçš„åºå·ã€æ’å…¥ä¸»é”®çš„åˆ—å’Œå€¼â€¦ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œrollbackçš„æ—¶å€™ï¼Œé€šè¿‡ä¸»é”®ç›´æ¥æŠŠå¯¹åº”çš„æ•°æ®åˆ é™¤å³å¯ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711163725129.png" alt="image-20220711163725129" style="zoom:50%;" /><p><strong>å½“æˆ‘ä»¬æ‰§è¡ŒUPDATEæ—¶ï¼š</strong></p><p>å¯¹åº”æ›´æ–°çš„æ“ä½œä¼šäº§ç”Ÿupdate undo logï¼Œå¹¶ä¸”ä¼šåˆ†æ›´æ–°ä¸»é”®å’Œä¸æ›´æ–°ä¸»é”®çš„ï¼Œå‡è®¾ç°åœ¨æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> name<span class="operator">=</span>&quot;Sun&quot; <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711164138414.png" alt="image-20220711164138414" style="zoom:50%;" /><p>è¿™æ—¶ä¼šæŠŠè€çš„è®°å½•å†™å…¥æ–°çš„undo logï¼Œè®©å›æ»šæŒ‡é’ˆæŒ‡å‘æ–°çš„undo logï¼Œå®ƒçš„undo noæ˜¯1ï¼Œå¹¶ä¸”æ–°çš„undo logä¼šæŒ‡å‘è€çš„undo logï¼ˆundo no=0ï¼‰ã€‚</p><p>å‡è®¾ç°åœ¨æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> id<span class="operator">=</span><span class="number">2</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711164421494.png" alt="image-20220711164421494" style="zoom:50%;" /><p>å¯¹äºæ›´æ–°ä¸»é”®çš„æ“ä½œï¼Œä¼šå…ˆæŠŠåŸæ¥çš„æ•°æ®deletemarkæ ‡è¯†æ‰“å¼€ï¼Œè¿™æ—¶å¹¶æ²¡æœ‰çœŸæ­£çš„åˆ é™¤æ•°æ®ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šäº¤ç»™æ¸…ç†çº¿ç¨‹å»åˆ¤æ–­ï¼Œç„¶ååœ¨åé¢æ’å…¥ä¸€æ¡æ–°çš„æ•°æ®ï¼Œæ–°çš„æ•°æ®ä¹Ÿä¼šäº§ç”Ÿundo logï¼Œå¹¶ä¸”undo logçš„åºå·ä¼šé€’å¢ã€‚</p><p>å¯ä»¥å‘ç°æ¯æ¬¡å¯¹æ•°æ®çš„å˜æ›´éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªundo logï¼Œå½“ä¸€æ¡è®°å½•è¢«å˜æ›´å¤šæ¬¡æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå¤šæ¡undo logï¼Œundo logè®°å½•çš„æ˜¯å˜æ›´å‰çš„æ—¥å¿—ï¼Œå¹¶ä¸”æ¯ä¸ªundo logçš„åºå·æ˜¯é€’å¢çš„ï¼Œé‚£ä¹ˆå½“è¦å›æ»šçš„æ—¶å€™ï¼ŒæŒ‰ç…§åºå·<code>ä¾æ¬¡å‘å‰æ¨</code>ï¼Œå°±å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬çš„åŸå§‹æ•°æ®äº†ã€‚</p><hr><h4 id="2-5-3-undo-logæ˜¯å¦‚ä½•å›æ»šçš„">2.5.3 undo logæ˜¯å¦‚ä½•å›æ»šçš„</h4><p>ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå‡è®¾æ‰§è¡Œrollbackï¼Œé‚£ä¹ˆå¯¹åº”çš„æµç¨‹åº”è¯¥æ˜¯è¿™æ ·ï¼š</p><ol><li>é€šè¿‡undo no=3çš„æ—¥å¿—æŠŠid=2çš„æ•°æ®åˆ é™¤</li><li>é€šè¿‡undo no=2çš„æ—¥å¿—æŠŠid=1çš„æ•°æ®çš„deletemarkè¿˜åŸæˆ0</li><li>é€šè¿‡undo no=1çš„æ—¥å¿—æŠŠid=1çš„æ•°æ®çš„nameè¿˜åŸæˆTom</li><li>é€šè¿‡undo no=0çš„æ—¥å¿—æŠŠid=1çš„æ•°æ®åˆ é™¤</li></ol><hr><h4 id="2-5-4-undo-logçš„åˆ é™¤">2.5.4 undo logçš„åˆ é™¤</h4><ul><li><p>é’ˆå¯¹äºinsert undo log</p><p>å› ä¸ºinsertæ“ä½œçš„è®°å½•ï¼Œåªå¯¹äº‹åŠ¡æœ¬èº«å¯è§ï¼Œå¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ã€‚æ•…è¯¥undo logå¯ä»¥åœ¨äº‹åŠ¡æäº¤åç›´æ¥åˆ é™¤ï¼Œä¸éœ€è¦è¿›è¡Œpurgeæ“ä½œã€‚</p></li><li><p>é’ˆå¯¹äºupdate undo log</p><p>è¯¥undo logå¯èƒ½éœ€è¦æä¾›MVCCæœºåˆ¶ï¼Œå› æ­¤ä¸èƒ½åœ¨äº‹åŠ¡æäº¤æ—¶å°±è¿›è¡Œåˆ é™¤ã€‚æäº¤æ—¶æ”¾å…¥undo logé“¾è¡¨ï¼Œç­‰å¾…purgeçº¿ç¨‹è¿›è¡Œæœ€åçš„åˆ é™¤ã€‚</p></li></ul><blockquote><p>è¡¥å……ï¼š</p><p>purgeçº¿ç¨‹ä¸¤ä¸ªä¸»è¦ä½œç”¨æ˜¯ï¼š<code>æ¸…ç†undoé¡µ</code>å’Œ<code>æ¸…ç†pageé‡Œé¢å¸¦æœ‰Delete_Bitæ ‡è¯†çš„æ•°æ®è¡Œ</code>ã€‚åœ¨InnoDBä¸­ï¼Œäº‹åŠ¡ä¸­çš„Deleteæ“ä½œå®é™…ä¸Šå¹¶ä¸æ˜¯çœŸæ­£çš„åˆ é™¤æ‰æ•°æ®è¡Œï¼Œè€Œæ˜¯ä¸€ç§Delete Markæ“ä½œï¼Œåœ¨è®°å½•ä¸Šæ ‡è¯†Delete_Bitï¼Œè€Œä¸åˆ é™¤è®°å½•ã€‚æ˜¯ä¸€ç§â€œå‡åˆ é™¤â€ï¼Œåªæ˜¯åšäº†ä¸ªæ ‡è®°ï¼ŒçœŸæ­£çš„åˆ é™¤å·¥ä½œéœ€è¦åå°purgeçº¿ç¨‹å»å®Œæˆã€‚</p></blockquote><hr><h3 id="2-6-å°ç»“">2.6 å°ç»“</h3><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220711165612956.png" alt="image-20220711165612956" style="zoom:67%;" /><p>undo logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯¹äº‹åŠ¡å›æ»šæ—¶ï¼Œåªæ˜¯å°†æ•°æ®åº“é€»è¾‘åœ°æ¢å¤åˆ°åŸæ¥çš„æ ·å­ã€‚</p><p>redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼Œundo logä¸æ˜¯redo logçš„é€†è¿‡ç¨‹ã€‚</p><hr><h2 id="3-ä¸‰å¤§æ—¥å¿—æ‚è°ˆ">3. ä¸‰å¤§æ—¥å¿—æ‚è°ˆ</h2><h3 id="3-1-redo-logå’Œbinlogå¯¹æ¯”">3.1  redo logå’Œbinlogå¯¹æ¯”</h3><div class="tabs" id="7518bf51-49e8-43be-ad33-0f261453ead3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7518bf51-49e8-43be-ad33-0f261453ead3-1"><i class="fas fa-dove"></i>ç”¨é€”ä¸åŒ</button></li><li class="tab"><button type="button" data-href="#7518bf51-49e8-43be-ad33-0f261453ead3-2"><i class="fas fa-cat"></i>é€‚ç”¨å¯¹è±¡ä¸åŒ</button></li><li class="tab"><button type="button" data-href="#7518bf51-49e8-43be-ad33-0f261453ead3-3"><i class="fas fa-horse"></i>å†™å…¥æ–¹å¼ä¸åŒ</button></li><li class="tab"><button type="button" data-href="#7518bf51-49e8-43be-ad33-0f261453ead3-4"><i class="fas fa-dragon"></i>æ–‡ä»¶æ ¼å¼ä¸åŒ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7518bf51-49e8-43be-ad33-0f261453ead3-1"><ul><li>binlog ç”¨äºå¤‡ä»½æ¢å¤ã€ä¸»ä»å¤åˆ¶ï¼›</li><li>redo log ç”¨äºæ‰ç”µç­‰æ•…éšœæ¢å¤ã€‚</li></ul><blockquote><p>å¦‚æœä¸å°å¿ƒæ•´ä¸ªæ•°æ®åº“çš„æ•°æ®è¢«åˆ é™¤äº†ï¼Œèƒ½ä½¿ç”¨ redo log æ–‡ä»¶æ¢å¤æ•°æ®å—ï¼Ÿ</p></blockquote><p>ä¸å¯ä»¥ä½¿ç”¨ redo log æ–‡ä»¶æ¢å¤ï¼Œåªèƒ½ä½¿ç”¨ binlog æ–‡ä»¶æ¢å¤ã€‚</p><p>å› ä¸º redo log æ–‡ä»¶æ˜¯å¾ªç¯å†™ï¼Œæ˜¯ä¼šè¾¹å†™è¾¹æ“¦é™¤æ—¥å¿—çš„ï¼Œåªè®°å½•æœªè¢«åˆ·å…¥ç£ç›˜çš„æ•°æ®çš„ç‰©ç†æ—¥å¿—ï¼Œå·²ç»åˆ·å…¥ç£ç›˜çš„æ•°æ®éƒ½ä¼šä» redo log æ–‡ä»¶é‡Œæ“¦é™¤ã€‚</p><p>binlog æ–‡ä»¶ä¿å­˜çš„æ˜¯å…¨é‡çš„æ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜äº†æ‰€æœ‰æ•°æ®å˜æ›´çš„æƒ…å†µï¼Œç†è®ºä¸Šåªè¦è®°å½•åœ¨ binlog ä¸Šçš„æ•°æ®ï¼Œéƒ½å¯ä»¥æ¢å¤ï¼Œæ‰€ä»¥å¦‚æœä¸å°å¿ƒæ•´ä¸ªæ•°æ®åº“çš„æ•°æ®è¢«åˆ é™¤äº†ï¼Œå¾—ç”¨ binlog æ–‡ä»¶æ¢å¤æ•°æ®ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7518bf51-49e8-43be-ad33-0f261453ead3-2"><ul><li>binlog æ˜¯MySQLçš„Serverå±‚å®ç°çš„æ—¥å¿—ï¼Œæ‰€æœ‰å­˜å‚¨å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ï¼›</li><li>redo logæ˜¯Innodb å­˜å‚¨å¼•æ“å®ç°çš„æ—¥å¿—ï¼›</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7518bf51-49e8-43be-ad33-0f261453ead3-3"><ul><li>binlog æ˜¯è¿½åŠ å†™ï¼Œå†™æ»¡ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç»§ç»­å†™ï¼Œä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ï¼Œä¿å­˜çš„æ˜¯å…¨é‡çš„æ—¥å¿—ã€‚</li><li>redo log æ˜¯å¾ªç¯å†™ï¼Œæ—¥å¿—ç©ºé—´å¤§å°æ˜¯å›ºå®šï¼Œå…¨éƒ¨å†™æ»¡å°±ä»å¤´å¼€å§‹ï¼Œä¿å­˜æœªè¢«åˆ·å…¥ç£ç›˜çš„è„é¡µæ—¥å¿—ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7518bf51-49e8-43be-ad33-0f261453ead3-4"><ul><li>binlog æœ‰ 3 ç§æ ¼å¼ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ STATEMENTï¼ˆé»˜è®¤æ ¼å¼ï¼‰ã€ROWã€ MIXEDï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š<ul><li>STATEMENTï¼šæ¯ä¸€æ¡ä¿®æ”¹æ•°æ®çš„ SQL éƒ½ä¼šè¢«è®°å½•åˆ° binlog ä¸­ï¼ˆç›¸å½“äºè®°å½•äº†é€»è¾‘æ“ä½œï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§æ ¼å¼ï¼Œ binlog å¯ä»¥ç§°ä¸ºé€»è¾‘æ—¥å¿—ï¼‰ï¼Œä¸»ä»å¤åˆ¶ä¸­ slave ç«¯å†æ ¹æ® SQL è¯­å¥é‡ç°ã€‚ä½† STATEMENT æœ‰åŠ¨æ€å‡½æ•°çš„é—®é¢˜ï¼Œæ¯”å¦‚ä½ ç”¨äº† uuid æˆ–è€… now è¿™äº›å‡½æ•°ï¼Œä½ åœ¨ä¸»åº“ä¸Šæ‰§è¡Œçš„ç»“æœå¹¶ä¸æ˜¯ä½ åœ¨ä»åº“æ‰§è¡Œçš„ç»“æœï¼Œè¿™ç§éšæ—¶åœ¨å˜çš„å‡½æ•°ä¼šå¯¼è‡´å¤åˆ¶çš„æ•°æ®ä¸ä¸€è‡´ï¼›</li><li>ROWï¼šè®°å½•è¡Œæ•°æ®æœ€ç»ˆè¢«ä¿®æ”¹æˆä»€ä¹ˆæ ·äº†ï¼ˆè¿™ç§æ ¼å¼çš„æ—¥å¿—ï¼Œå°±ä¸èƒ½ç§°ä¸ºé€»è¾‘æ—¥å¿—äº†ï¼‰ï¼Œä¸ä¼šå‡ºç° STATEMENT ä¸‹åŠ¨æ€å‡½æ•°çš„é—®é¢˜ã€‚ä½† ROW çš„ç¼ºç‚¹æ˜¯æ¯è¡Œæ•°æ®çš„å˜åŒ–ç»“æœéƒ½ä¼šè¢«è®°å½•ï¼Œæ¯”å¦‚æ‰§è¡Œæ‰¹é‡ update è¯­å¥ï¼Œæ›´æ–°å¤šå°‘è¡Œæ•°æ®å°±ä¼šäº§ç”Ÿå¤šå°‘æ¡è®°å½•ï¼Œä½¿ binlog æ–‡ä»¶è¿‡å¤§ï¼Œè€Œåœ¨ STATEMENT æ ¼å¼ä¸‹åªä¼šè®°å½•ä¸€ä¸ª update è¯­å¥è€Œå·²ï¼›</li><li>MIXEDï¼šåŒ…å«äº† STATEMENT å’Œ ROW æ¨¡å¼ï¼Œå®ƒä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µè‡ªåŠ¨ä½¿ç”¨ ROW æ¨¡å¼å’Œ STATEMENT æ¨¡å¼ï¼›</li></ul></li><li>redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯åœ¨æŸä¸ªæ•°æ®é¡µåšäº†ä»€ä¹ˆä¿®æ”¹ï¼Œæ¯”å¦‚å¯¹ XXX è¡¨ç©ºé—´ä¸­çš„ YYY æ•°æ®é¡µ ZZZ åç§»é‡çš„åœ°æ–¹åšäº†AAA æ›´æ–°ï¼›</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="3-2-ä¸¤é˜¶æ®µæäº¤">3.2 ä¸¤é˜¶æ®µæäº¤</h3><div class="tag link"><a class="link-card" title="å…¶ä»–æ•°æ®åº“æ—¥å¿—" href="/posts/a42250fc.html#6-3-ä¸¤é˜¶æ®µæäº¤"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/favicon.png"/></div><div class="right"><p class="text">å…¶ä»–æ•°æ®åº“æ—¥å¿—</p><p class="url">/posts/a42250fc.html#6-3-ä¸¤é˜¶æ®µæäº¤</p></div></a></div><p>ä¸€æ¡æ›´æ–°è¯­å¥ï¼Œåˆ°åº•æ˜¯æ€æ ·æ‰§è¡Œçš„å‘¢ï¼Ÿä¾‹å¦‚<code>update t set number=number+1 where id=1</code></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/15477e4c8e68ee00bc5e496ed287f3af.png" alt="img" style="zoom:67%;" /><p>ä¸¤é˜¶æ®µæäº¤å³å°†å†™å…¥redo logè¿™ä¸ªæ“ä½œï¼Œæ‹†æˆäº†å†™prepareå’Œå†™commitã€‚ç”±æ­¤å¯ä»¥ä¿è¯redo logå’Œbinlogçš„é€»è¾‘ä¸€è‡´æ€§ï¼Œé¿å…ä¸»ä»å¤åˆ¶æ—¶äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>è¯•æƒ³å…ˆå†™redo logå†å†™binlogæˆ–è€…å…ˆå†™binlogå†å†™redo logä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼š</p><ul><li>å…ˆå†™redo log, æ­¤æ—¶MySQL(master)å´©æºƒï¼ˆæ²¡æ¥å¾—åŠåˆ·è„é¡µï¼‰ï¼Œé‚£ä¹ˆbinlogé‡Œé¢è¿™æ¡æ•°æ®è¿˜æ˜¯åŸæ¥çš„ã€‚MySQL(master)é‡å¯ï¼Œä¼šæ ¹æ®redo logæ¥é‡æ”¾ï¼Œé‚£ä¹ˆæ­¤æ—¶masterçš„æ•°æ®æ˜¯æ›´æ–°è¿‡åçš„ï¼Œè€Œä»èŠ‚ç‚¹é€šè¿‡binlogå»åšå¤åˆ¶çš„æ—¶å€™ï¼Œè¿™æ¡æ•°æ®å°±æ˜¯è€çš„ã€‚ä¸»æ¯”ä»å¤šäº†ä¸€æ¬¡æ•°æ®æ›´æ–°ã€‚</li><li>å…ˆå†™bin log, æ­¤æ—¶MySQL(master)å´©æºƒï¼Œé‚£ä¹ˆredo logé‡Œé¢è¿™æ¡æ•°æ®æ˜¯æ—§çš„ã€‚MySQL(master)é‡å¯ï¼Œæ ¹æ®redo logæ¥é‡æ”¾ï¼Œé‚£ä¹ˆæ­¤æ—¶masterçš„æ•°æ®æ˜¯åŸæ¥çš„ï¼Œè€Œä»èŠ‚ç‚¹é€šè¿‡binlogå»åšå¤åˆ¶çš„æ—¶å€™ï¼Œè¿™æ¡æ•°æ®å°±æ˜¯æ–°çš„ã€‚ä»æ¯”ä¸»å¤šäº†ä¸€æ¬¡æ•°æ®æ›´æ–°ã€‚</li></ul><p>ä½†ä¸¤é˜¶æ®µæäº¤å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼š</p><ul><li>å¦‚æœå†™å…¥äº†redo log - prepare, MySQLå´©æºƒï¼Œæ­¤æ—¶binlogå•¥ä¹Ÿæ²¡æœ‰ã€‚MySQLé‡å¯ï¼Œæ ¹æ®redo logé‡æ”¾çš„æ—¶å€™å‘ç°redo logæ˜¯prepareä½†æ˜¯binlogå•¥ä¹Ÿæ²¡æœ‰ï¼Œé‚£å°±å›æ»šã€‚ä»èŠ‚ç‚¹æ ¹æ®binlogå¤åˆ¶ï¼Œä¸ä¼šæœ‰è¿™æ¡è®°å½•ï¼›masterå›æ»šäº†ï¼Œä¹Ÿä¸ä¼šæœ‰è¿™æ¡è®°å½•ã€‚</li><li>å¦‚æœå†™å…¥äº†redo log -prepare, å†™å…¥äº†binlog, MySQLå´©æºƒï¼Œæ­¤æ—¶binlogæ˜¯æœ‰æ•°æ®çš„ã€‚MySQLé‡å¯ï¼Œæ ¹æ®redo logé‡æ”¾çš„æ—¶å€™å‘ç°redo logæ˜¯prepareä½†æ˜¯binlogæœ‰å¯¹åº”çš„è®°å½•ï¼Œé‚£å°±æäº¤ã€‚ä»èŠ‚ç‚¹æ ¹æ®binlogå¤åˆ¶ï¼Œä¼šæœ‰è¿™æ¡è®°å½•ï¼›masteræäº¤äº†ï¼Œä¹Ÿä¼šæœ‰è¿™æ¡è®°å½•</li><li>å¦‚æœå†™å…¥äº†redo log-prepareï¼Œå†™å…¥äº†binlog, å†™å…¥äº†redo log-commitè¿‡åï¼ŒMySQLå´©æºƒäº†ã€‚MySQLé‡å¯ï¼Œå°±æŒ‰éƒ¨å°±ç­é‡æ”¾redo logå°±è¡Œäº†ï¼Œå•¥ä¹Ÿä¸ç”¨åšã€‚</li></ul>]]></content>
    
    
    <summary type="html">redoæ—¥å¿—ã€undoæ—¥å¿—</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“äº‹åŠ¡åŸºç¡€</title>
    <link href="https://wuwawawa.github.io/posts/2ba1a1a7.html"/>
    <id>https://wuwawawa.github.io/posts/2ba1a1a7.html</id>
    <published>2023-04-15T07:34:16.000Z</published>
    <updated>2023-04-19T14:12:47.701Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•!" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="f46b7bca21f4a6a4d8f045fe2bf2b2a323ae1f61e273ead94d0609b9ac56a67e">98b9bce3395e8307c58744c126888424e5ee9b7e2514e1abc7cba60c06145d105ad89a0d62f28eb7cc502bcd063a9041c91bf6796115bab1433b442de79709d0f0cba54ca10bd7234bedc75cb715543098663997dc80a7ecf0475ad6d7d37e0cc65ac7239f44790dee81cf6fda003e13f0fc4d528e603aa619dcd9e247dc0a479c1f34b472f9a26c5e17ef4595dc8e5d3c9043d8611a775bfa8484498f6c092f92f2d803d09ddf392553844e82017ca8611763590aec966de8d80bfa96bc82d5b082147e9860d40177fc25fc9331e1ad27877712a33489376356f54999536d7d42a488a471ec557f31b0752d3d2db9f1443aa766ce8c91fdb78a6bf45b4c3e1a9ffa753874e6b0976f7d8c598a8ae8c3c10e1e097286ed032ea7beb5fb2d3dc160972280fc2930b8b9dfd13bdd5951d88f1306c935e2bba4aa1cea0fee6ab9012f27b43f29e759dfbdbabc1697abf6a9f973ecd96cd3d0a56c84d06901a36f20a9460166f91be44c55ab849de78ffc6108ec2e80c4caa58d71eb4b1bd14fdd9d61e28bc588f4255b54762dd381ed596e3f6c8cf90b56915b25f80404335b4cd9e87dd178ae7b168b60b7ca361cee9b2f4c5e0bb2f7f76284924964ef2d0c0be5264da005997d500e7c0bccf245d6bbb92932865b44ab634c7a9f1726b6c65d4efff7feaa05303a60d5e8e2f7466c7039f02f46e4b2e44722be70e73225a29d1f98b01f4f5f505ce6d632cc60cdf31a85645c69be775950516c1c43d145177d41ee745d92e6750be1c0f11aa39b56bd223c747e91436770d24b6a86e23e81542068587736fe44942f157decd30fac0da9b185d82f196e352282615b9dcbc3a9d004c0aab7c5a12b4234d49fb91bed30b121a1f4690d762de49888b46930c83e9a62f703450d40491064c438527703bc87e72d2fe64d35311245d13165bf1a63ac90af6f8c24b7c1855ec6f5be1ec5ff3e73ea65e6b483417f3bd3ee274fe76fbbcd33fc119eaaa4f6d06f7171a20948f087b103c65b34758cef510cbf5ae8d53be79f8213f5862e49d42ebef0fbc94adbddfbc77db75568fb90d9c011cb00af01b7d5a15d606bf7c966484121f92700c3afc798da100b7abe5665212f39c79e6b0395f20288387613c23dd93ba5023c132b1d4353a8bc83412e0e11b4f8c1ced8bbf9b68498f00de62f3467f0c5abc7378b08d427aae378f65b4a161fb8646b8ac8d1eec70805190b3feffebe2353705217abf05d360d3f7767c3baaa5ff5e6b39013cd7cc24fb47df46171158e10e6881d91ce4b3d8b51f8e760c1b08d10825164af651ff80194a9ee8130f928cb98f964cbc932365f3c7cb14f0e8adc6df98e6a37cca706b140fdca960f01ad83436f8d9fd7eae2dc46595ba3d7b927933da8f98e495960fc2117276dce4237fe2fd1b5f0b8ffe17b4497aa731aea4f4f007b806d536645b1c1cd43cb7952bf27ad7e63820c561cf1e7c5e5787d5431b5c97cb824bd0695267c6e58be9e8563fd7c1621c42b5afa28978905e9f8c6ff6e0e56387146e9d56a2effd0b4e0ad10b8dfb030ea8b03682a1a6bad43741bbfa432f266db4747f1e9cdb033bab1217d4f9fd958cfae41d366d5bea180e16ce77fd4f188e001c8566847326bfc346d9b6e5537526e50e0f0a835fd9dbe1ee37c48774901e26853729155da4e889b505c3860bfcf428ecf9ea76a91e8c614c954212d48e650ca9c92747c7e9a3f3515b46ab0a0c232392dca76c5c83fb5c7caf532e10f189a628690ca8756915027c4f20addaa063452320f4ee8e50dfa0dfed2af5e891572d433f54764b29695c2bbb4e5272ade25ade9cf79cc30a2f1abbd281164278f05bc65592a81bd62709e6ea8a257f3bf386ec42668dd4e04c8d0b926209b48c1f6ede4ac2a1d82ae0e0797a5f1c15e14dda65bba1bac3a944fe8e283a24aff96690902cacba35a03444df5639aae981ded09f982b600285998cde2adcddbbebb7f677225eb89e5b25d70a2f8f2343c9aa04dd09c6407e671ba42044995e2e654fd197428f51f36566d32912bec3495fe1ecee91df07ba780e2f011cf456142bb8ad319436663c10bef5c5392a843a20bf5863618dd38f5882d27538067b8a36db6a41c8ac7092e0409630cbd560d380b404a5f376089d773d6f2ffaec9ae2ad1c5e8f34a2fb3296ec095d2c77dee8abe9286f00b0e178ed0b1d6b47f5141fc93c7a908e8820d653c37bc36980b6cad201e757391103f96df4574ce0e80e6514457d2a6be9c57c63120e826e485ad206c01b59f9bbf4254e1daf4246561c1f4c08b42024875b59c1cfc02cc67537829407593d71fdb288b527a33b23dc99418b3f3bbe6622b0faed803fb36f9367536db9bcd0aab3605b74142c8f58738c8f4e0a1dcc80a95250528bfa3b24635c57f5a370f4df10ffeb6db28275394e2b32821432f439a71ff252a367d6984bb07d1abe64d0260d5bedb5694180a600f425f703b85a62d35bb086e77d25b97e0bb42fff16a8a3f4ecadb1ba74ac7ea524efb8665c62061d1981a81cff00c39d160db49fce835d5cce78c5c99361d2f818685d81bfc6a960c451f4693d03f8a55ccacf8ac0c42b673c5d2dc7e3fe9eb5425bd90b9579e94dbbe5f5acc091b9d0cc022ab6faf80c1504ff97ef5e92512bea5cf3c2eca529d4846953c91ae752a2a5b1ba6a538e47bc874a2cc262324846ad44e8ee6079f583d806813d42a40f6ca0eec520ff532f87cfed512085d9e73d7b395a4cdd17ec1b6f0370e942b29ec3d8edcb93bf5a243befc53ab294f1978b3af3f10b99e9d91f05a882d15da2f61c3c0fc6113c2b9355c20896c7ebc34d67b7aecbe88b15a6df1d3019eb9bc3b9dd5edc25fe328a705eb776748d339748ea1179dbc8c80ffdc95ca779102fc5d902f239b74e89c60469050b913de0a8068f1100121f638d847b80c2173deb7357c2266550e2c5c79abcc759864b99ab6197c4597969c0fc6d7b42eb075d16038041fd894c27a532ae38fce7e92db6a1d0425917d3c23240b8ad9d5f06841abe77ea26b7f655968b5916324ebaf23fa664f9eadae12f7e48f165e17c7b7fe831e83fc2b0c8d4215f5795c5fd0543c05f9b681bc1491735218ce64ce686dde0260379b4724fa8f969a80f6324c968cf6eb8cb329fdbab5bfa5affaee5a31a7b31db2dd2d3078e7cd201e64e6c23c37a589a089f0d4944ae013efe854a4cdfb6761e4e7619f3362fc85ba31ce0b85f3aceb008b7354e794833985cdc2b994e6a1a8e185df3bce79bf3b00e248efbcfc57080ea16b3c4b36772e2e3a87b78b391b07b54f1fb07ac2904e3fbf476c112384876e3a908f0b062f8f0a2947185852043852c657f234be59ffe7b877aff0f4414c5ffcd379f52361a0e82cdcb222ad2a45542d7bab3ba6b247b468e342ea08761dc8472db023918d8b3967c391d5e6a3aa796cddf1fa2d3eb10e22e17cb725f90bfb4126b8d3e408c41838f4f273b23c09d2552c24d73b109e38b28b1a2d0ebb9d8859fdb43d15b35387f6a6f9130e0a9ac93021927f657a7b39c369784fcbf28be3e8c74c4d3e28523381eb99089534eca180e615ff9349d6ad567cc3401f77402874ed2f2f734a81e7525ccf9a6d5016eabb07489ca1ff527466b0817f6d033c13959c4a42dee66825f256e34d7ee6c8da7acc9f5111b91842337cc92f6712ecf2677391fe58ea5fdf80f95d3f2d0a23b30ef4ef40a1cb4c0ca61ef3891e32609853742d529efa35d827cbf2679079a742e1e8e82c037d7a4db5b91dc836c2bc7b58edb5b910f3af6471ad5d682bc3d869fc1a9a80ebd888a80e9c2ff96067fd26fd36fce04133a999441990b4e5f580ef4507609f3619fce0f8615917a53f5554888ea86a003b4b322c964edee90c7f4fd8b06b92293fc55b520f88c68cf3f042f3ca56005fd92f9f93561e688ce679d271e312ba8828179d02b41388f8c0c9a369d1ab565dde2c80f465a321a4f5dc0b39fce6d23f595025406c20807e5f7d55a2a240e9e73c355dad7e5edfa8109a09380929b256de8bdaf08735fd0d430497e0cefdf6bb241c7d8e47658be7c07d723f99280d81480b4099658a086f24ffda5f460a494d4a0fdef8fafd82d7b0fc28c1e6f55388da770686f3ca6eef225840ed1ff680d701d0aa3254216bd6c723d5147bace20da11950a82b6978415e5bb6f5bdcb5aac3270004dba2cd048abd180564317f6ac2f2fde4b97fbf2cc1f331ab5fe6b081ac7880e50fe1832312d66fa50b58e783c3c2e92d34c71f2e198e331acab1e9cac7f1501a8ed10b697c26cc406c6ed83d29a2bb8ccb3457fc65b3800ff9c10bafb8ea6f52b5b689a1ec5dbe740ea21248a51eb3cc8bef52dcb4d3cb64f2b2d5e3b6be13717b871af20b77ebaf0e8f7438fb77aca5c59986dfc50a071d1e41190498ed6e49315cf30d055d32058a9db5cc9450d6cf454ed3e908f8c7ba3a47f074aeb8ba851cf4f281629c6cdd32b0213c0f8fa0ae02f3a9fcb5d8975cabe7def537947609d2e29434061201b7bb9028cafcd2ff96ed7f22e934f0885e18db80a3840cba74f5e549a58e90335eb1893249b06c400438f69397481e5695169121b8c67c430c890420de9fd273733d4801be299b1ea6eda731b4534170e9b02fbac12dd3597fd7aa265b829d124741797f2c950c05def7ef6612118fa609e2ec32de21dcc740227e73e887e94bf28ebab1d2b47a7d975362fe70b20fbdd563f4bbdcf96e54e38d80962d9d847fa35523c4c4433668fb1b3b1f67f426df91f37890f75abb5359b1251f80daeaa67bf8634c7b6c8200bb2fa95dd022b665bf4d1fdbf775d5266ffa317b16736fcaba5b4105ec8b0760b2a25f834dae2181ed9c8296ebb884b48626fe9e9ee3441c02a4eb2fe2cb8d9bc9baf05f024eab8a595b9045b5a4880e7e75a4cd8df6f6a377540d8ba383f21e0859f3a2c9761eafc44ff8bd0c9fe4e49dd396b08897eea26f4f8c6fc06cf26ba8bcbdc001a9ae2bbd92f1332a6a9842c1f78ac8670b2d632ea0ad1222caf970242cad79e25cbd4cf18cf9fc0c4852989fd1a8ea1252882d059f96457df2ab66f697c314cd55304f5a5f0f4f13f49b42553181c698dc4c26c7e3674438915dbec3a9cad13896a100bd7f590460a6b043eadde3a5e9d6eefcea5da8f6b767654e4ea2c265ff6a432549d48f23dcde452bffc807b54e5bf91eac1e068fda1d784477b55c870be02b6cf1e69361d9209ef59837800f0197dea1cf6945a3e63d0e073bbc17d7e4f19a937b3558aa8e6166a09879bac941a969b3746a710b5d9099dc5a9984eb81a6146120241d5982475169e4642a8fdac2c040073d43cfa9757f119e46b903004932e87b782b3d8c2130135c8e7377cf564bfe1c50c887390da2d80121b79af2a11df1bc018a84d6faba8f4e2d5d25ddc5e7e831bf296bab7187f58f0cc503ae2aab4bc6c987a80abc9a19eaffab29eb7b3c738f3a199762ada9b013eec1d0e39a70e49e2b8967bcdc4d162bf39b6372721e3822808e6761a76591659b4ffda081ae5dfe83d52008e2e67a9a7ee118a380912915431e37112e1681d8a1b09ab152c0677a136a6ab18e4097f931dfa95f9279007283b4e6da39cf3ad728125161c0879b8a93e6ed077cdc0aac6a2675cec41b4a8f972ddd7c69fa6e6be01c9b10b32e3321f6535ea065747b0b29d04a8961f1fa5a5084bf371c4c4b12fd5f163605bcf7c6b552ade8907286455cd5525f89538f40688df711b27388ddfba23b3d1e1f0cc8253107b1974693919612a0c2f1ddcbda430f6d9807f314aab67fb32cd5c9e460c4359ce0e73fc9069441744fbd624d92c742d21fbd5358cdee4f321f89744febd9a4cf7d56748f27c22e38e2bfff66c944ee02f19cf29cddc26d33acc9954f1199cf2a38b50197735302811b533aaef1513e3f84476c631ad088c9591dc3108ae2154ad3d31f4ed994f6070e2b0ebbafc53f386605eb772e5d3d4e924156f30e0d27603713d704ce29248a1f377ada3e82ef7681ab2dc8f99965ff08837670a082ee941f7befe6756b965003bafd1be468501b8ccc396cda5b0c69277d01259c1929e69f51b27b0e3b9d471c3b6d858ec1831dcae4b810a385f6004e5f978d88e494012337676bb3859d2f016031c2320f5d1d3cca09d0203b6096c7c4c77abd10cdbf21d75b38626748c372595dc960c9e7af8a73995c55dc1ebbca17f55042db7b065d93252be21bb438595b22929bcf415f2070de926d32c5c45cd0f23f2d60ff7d0458053d0f4c252f01d7e065177d55682cdca7cf4d97d715ca7b3f7a6e98766db847618f6e832d6f844706154bc7e422adbbc4568c0cd4d469aa235747e52d47c3f8f649b8062ef3ed675d791c3609bcdc12c48173bcf7930271dd0dc8597c8ed6f92d2b909c29fa67b1e5560d812364b5432e693fe3d3dd730b02e81cb0ec74d94e2c201703a213f261a08f45683a7321660008d6dcc578d1be5abbdc1f4633b5af668f7e0984fbdfcd572e3446096653269cea88798121f3b806ef43ba468b452e6734311adc0506e3a971fb8339ced8848daf38e57ef7afdc7d5541847d4eab2bbcdb899c3258759af06e9507e60494884626fffd02e6bafbc3c81fac0066985be0f16b067a67bd87885b51d901c6f5c2ce9ddd1487b9756ebf57d340047b80f518b67966b3ee4570c8264c85a352ea031b833711eda0fa50a7ae86291fba66a67b40c1371f95b0931ff061e058fb54a9e3786cedfd890a5b83f0c47f4fe9c6e0e49141946874e750f42a1127087efe0deadab7e928c2152ac20048caa9388139698c404b633445a39f9fdeefb2b425b31a8483c92092a4cb7366b27bf2ce3324f9f9d7bbc87405444aa64018a07835bf8e0640da940d36f5bee0962a9202dfbe0a3ea8b2c69f4b09e24487c83ae618b132b136a79563384d48c266977d119a2e3e76add89e3d3eb043f3fa028293e5786c98bc54c3700a56bc54084f545ed9823090910fac3bdd883b6fd4f4d7f5a90263d21225847e63847f71d24093071126b1b8a503fc07f3769b27bfc6404565bc44cd825b8e96e2b1769868b05fcb40b55b039cc571ecddec6873ece5e10dd803bf7828664a22f1656df1378fabc44e584bd79bdb69f42a20bbedddbed704a627038140ac0553f375bedd102a7343ffb8dec068f8588126f0775163231dddf2ee54299be51e6a6a627147e0e9e46c01728efa51db4f73d0b3d0c35f99f74b3d640da5562fed123e6be7512c9281ab84c87d51f9dd63a5ebd2dc4cf05ed41d241b6e6982d90352e2b15515a4a962d3d6e8e901de70a852f5590e541c9aff4052e10380d81d77d52837e3c94e8ddf3653806b4051e40d38400e9f0d0d7a0384c0f7699d2f4ebfed23115e790740d7a58ecd39de2245b550bbce787e3ab049483c016fb4aa480b8d73a9f45661fd49fdea82f75566e745554cfd604c7257cf0e8507b825a4243e64590a96428011302df4fa9794a74b9aa72053660a8591b02e041bd92e03bce22420ee6ab1549a299407708820e3656cbae64fa47eddee4b2b65b01dca10dbd1ee18dad460c93cc2a2f38206a5a8c0e684fe8847f0baa965db5de93bc283fe4d51b8035e1e3d281d64d970eb51d7183e1e03186178233385c3f890839e5664ee7b6c3ac07c723eb22ee82de5473edc3b92931a9c3e41f03a7fa930d79619e0efc46502aa4e35b01e365c397e242aa9f6a8b8d6c8d51d528c5294c1502b92b099569344451cdcfba3ffa1fe6def8396259baf6dcc52534ea5ca8348812ace765d1c84cb93792df093ba6d74a0e02c0565ddc8b867fb657b553537bd12aef52f8782a794f1c7fe7344732efd953a2f5f2955461d3588921d6fbc3ff7f721ed3feea9d3990f9a36e1be7a50baa855f1a775c4325481d9c98390cc84ce32c7195f89f60abf50eba94cd41ed6abe2746ebe82468ac4f8c0435d60f3224cef8091570052621a97601afb65158406dd81c866bc500e513a0ef3923dd350bad4cc8e4a112274bb6a7ca51cfc870bdcc24f793203af05a861ff2fb02fb5cf2bd38f42191f7dc7dddac97693772705dbf812db22f7a5a335a69879138e20fd3f39457bfc676058d31a2bdd6b0693aee3644d771cf7fc5dfdfef65aa277dc2015f8d3eadf3b7449d49f2b8855f4d5a91024eeea2419f32aaecde35227af48374871ec6108b0fd765e98359605160214e187491f21c9485e54eb9ab1f624dc1d08e8e35808e9ea863963d3c8bafdf74981ad0c0ce88367687a6ab79f80ce669be9af5777c59a0bacfb682c4789a43a325bd30544bcc1b901d81135c3fea651d98f2ad7168c4cdce439059eb2870bf8c451aa85ae7fc943fcd6b589f7704573c90f02baa082fa690158fcc35eed6b4366a2b50e6ecaa648e7ff0120051b7440ce3d5bbfab222b96f6f49d78731d186ee317cdc4dde9f9cdd73007eedcb539e0f992471ac32129d0dce2fb0d74840c588c390604090b9e06338e6ce86b202b119d26b11c9372b1056d862afef75261beedf52c110c397de3433a0e909ec3f6b93bff05de3b1f0f2f23002ef9ee14dbdfef2b378506042a6190862dbb1e03441d9789378ae804ac0202e66b4fa416f2877b3d60b9f76e40537b2cab97579bec969ac752f82460f8ebfe8bb1891dc1e7f5093bc0362abdc8410d61b22bb11ce27627d3e07c090fd46522c3d79973d460dc385878731929c70a9e5fd246f4260c2235d8b5ad34d3fe28830c56733e7cef21d93d6ea07fa93694ce61871886caa53f5c9859fd2253c4cc4a22e51863a9947ae833370c6f292bacce9141a4511c3edcf3acf7fb76b8b613672bb37a294aa5f9202439826f19a90a50ebab465ff67a99ca53ff8c4fc278f935bfe834924f32922f1eb1f655cdb22b0da92b5dd48b3eeb3b4fdb8e0e1f81ef77fe2f1ac9d1984f5d0fea6df42069e7a2c3d9ceec4fe33648f52711f46ed97a37052facccec4be5fde4a0f8c262ac338c6057680447aa659693fd061e53aeca6e9f6641adf8c6071b3292d0f421a47c2984e921df6f35fe693d093ee5bea157729052766f6d080cac06d30f970a583af54e4eaf53a412cbb82ebe6df28caaa46c12db11b8f1681d376a3e60dff9d54db5efb4e274c81cc5b94bc903f39451c2466ecf808fe17ed2dec995e29e1cb0b60972c8d53488d28a010e8df305770762372ec4014f08cb65ef8b9f06b248aa2c8f5ca784431e860a53978dde17868e0fc8db60e579da2f65ce3c9860f47c68b44c5da00f3b0c7c702fe5d7930b64c150eea962709dc4858a2594b103680721157b7f4ff301b59e5b4e4db490fa83abe5b473c5c65d6c43dc1e68068058012582034fccb7addfb66620bfe1c103c712ecfa5f51f777b5fb8c0c5c5a7985e747781caa8b924e64e6b834fa77f174d341af20382e98b6e5a87191e14e80f6417ee18425fca3a57c5e569d1ab1953b4bac330f98dd871579799854a8ab219daf96d88618a75d9b8959fabf38bd39e082a9ed8da93480d162f3e63854213dd10a76fe88426555675dcdf03fc8e3a31f0fd62e186bd52a4597630705e77967c789878c071640d95d4c7faed8e08f7a0e4f04686f84424db9974c7d51fc0ecd807467866f7748f9fc0aed90331dd0f14a72cdcc7409960f7382099db0aa50f38ce11090668b9808952692e40d413af2aabb2ad7110a2f56936433632dc7e7152e2fdc44ce72e058b68d0122b964c39b3cef691512a29989629317f66dfea4beb55ad16fea6afeb0f65b7bb852d444450487be6ffe41dc8e9cf9f8c5484732984323e43e896a971a619b49392067fbf55cc1f31f581d982915d87cb384a63b1df3e47b54c9cdca0ed44494ab033c6a848d4ac05c7ce0f661ec5c52c3beb5d487db2b8fe0616a7563643d48b554edb802d29caa2d937c091578dfdd729184cc169cb0ad9cf21981a04da8792710c08d42000814c651e74ebd49dfe4b07ee14e3c372044a0076908125cbee4467b29b018edbf377f24d8926dfece5c3e6ff95f50ae71e32f99962fec71d71cb73e6e6fd668fc3d3cdb88c3c2aed83c028710dd946194358a9eb1ac65cf964fdfaa8d7daeb729762d7071daa4c1570e54f14aceaeeda256a668a370c2427cce44da6952f311f6ed62651f4df766e8d4ec876afd741d7bc4c301e0e3e06bc1b894dc7fa16f8931d6dc7af0ab8700143e888e3015f5a90f11e0ee6e5de2a8cf773d1d16765238377f519460ecb39a4a434a8eeb7f964ef4709657aff647bba80106e763a1f1c589989b33da70921a7252b5bc585590586cf665bbe11b1f2ecd2d77d3f4e74f5726c073a00a92977cceb1b5c3b393528bcb2e4f937015c51f39e6ead9cd654a83cf6a9ffaae662efa3a964fef7231085701818468f682cf7ff9ac999834e160094e21799f070fc38434fce1281af1e5acfe4488c04a378ef43eb41ad97658ae1e0a7fb1fdd760330ed515ed6290825e542dbe8dc2396b8c5a64c431ff108e79b886a094819748ef630cc40148f06c2af1f6149c5b04b3341038855f462c119c277bf3a5e167cb3a812f4fdba43588d463abed35fcb3ae07ae11c8670953dda91298c993bc8aeb820506c0bf97bea16540af74d56135aee56730e688a09c557278c5e28e1074eb8ab0d20b29ba7bba79fbd598b42c3b64bc344a3c580843abc2fd164a4581ecd987d8c33aac8d27851bf18f5fc74830b49c7c674ace4adc64beb59df22b8ea8d923b0b759bff0a7c9df4ac2190a42601ea17bc92226cbff1e7937229b51dacde2345d161052a130ec5c1401300b4f8a62e2200703bc3754c28b393ba688b47f1a8537d55aba91945ac69998ccf88874c1f57c8263b9228a0378f0dd370cc1af6cea1ddcbcf3895a1e0ec5b9e431ef630d0299b916a1b6f3c1cf7e61682b0237e8ffb728bae5ff373095c772fd466960d69ccccbcfefed1ece44fc0e1d95e9d12fd938c843d52e329f873925aa5b30716049ef7e6b08e62c9ef1b7f17b2d9a5481ceab08b559222b7525d8507e684103429d81e3dc0f6e79e1cddde030f1e8c6ad24aa4347882115e54d5b38d68273a054a7e916c23d3acc5400d90c7d45db6cbb65422aa0e87afb59905e633594f816fb16776604a799519c5a282d69eb3056d607763b0a71249f9fd2507b13ec23db76dd0e4f20a66a48a8748c151325346842347abd3f047f1b280703ce7e3aa658bb4c71e4c42d52d70b833005c913cf9cefa7a2516d5d53f406fead1cf285bcd805614d8c97a961f13327d83648356b561adf131ba92308b8ac3aff5bb540048d723b047a9a3f33d85862b770b8175631f29e42a7b57b16d1723a7770ed93fc9af4402382eb71555cdfd6fb2e714207fc1dbdd1feb41760282a46683aa8190dae007849049f7a0838e80bcd704ef0b51c964b30daccf4d00317ab64e65706b1cb82a10d33decf77e71b86e544fc54c27e9a86b5895c90df2331724aa5892153e9b3293738f30c77abb7387003cd4350f8bfff2eeca54a3d297992cfa53abc3313ceec17e7d18c85d349307827071f64cb646dd0dac12dabf9e9bd6cb720455c550c028b0f87501acc700cf63b77bbf633f4b5194d901fc688ba5202e89e04798e05581ea5e59fafdd563c2c830ead0ce816fd50a338ec8eb6419b8414eefaee69201c3193677e8d85a6e78fc6e56c4643af8eaf8e7f377afc6935d697036ed2da11aa3a3076569d25f1258ad958baed843823f81dba141fda5df4f040e4b0bbb80eb5e56672bd7d521de72468fbe39eeb4594a810e95fccf6612a5dd2d651b2581dfebef8ab59240880ed03d7a38d20b217c47a2a770289bb95a9f5594094205f5d873dcf490576e1e1201c74d9648bb2b94adc4bc17e7471e858e7fc502654772c520dc93578ffd11b596a4d041a6b22bd7b2b542790624676d495a8be3229c500eaca0783d7ed1be88dbedb68ed62e9a1785ac8a0644ab905334ce132f871d3d1a7b6cf37734705272c1acb1dd9c1ed2b54bba98a0fba4ac67c86741696de9b8111d3ef09be6dd557ff7d1b62a5260a4e78b6d0e03b3b2da72604ac43dd53e326f9394d176b71789cd35dde7f6256200674304c83716971730b5b787e7237b254998a152bc6a3431813493e9c9c6596fe44faa340af12704c4ef34d908e54972b24d858025098b87448de9d24d9767db75f0a610cd20989123ae51a41f06e5b30d8ededeb66e80fbaecfc07f9a7de2caab24a132044104849963a79ab5614725cf6df10bf5b4b0c5e27fcc07c1a33d914d148a3d231ad812dc4fce49db3e3069a9f88f407a78fe4aa0e3b17753afc9f89bdae5869d14beed4969ceaa011dda8ace405f8d3ad6df18f04ea97c558e07d74877f47f5833ee222c6bfad4b5897d215e329e465adcb30b11875abc3d828783c7c651fe88b4860294c5dfb32509802243fecb3f84d6e3efc0ffa22d3031a207c61d7ae40b0a858f1e16146584274d92e222410c9af3fc19d4c0560877fdb38289fc17c1a821cfb1be2faa38b80290c00ffb756a2487bf447f13b50e83c618615e78bd70ac40fe77a916f03c21965aec282084d17a522eac18267987e7a3c2970af5ed83fd96f07130d93fccbfc1c1f067cf10e07483fbcd310d56918229a12135923b3baaab3a7a2f9223c137d2926defc8ff201e2cc9fb09190ab82be9f5be0aed481f806b9d8d64bae088588360030d4cf34744f5f528e3a095cefd511cf4ceeddd934ae3466badea5d189cda5059ec65feedb205b250d7e066543ac70821a251517724779503b73f897addb753702c28478168f1c7854d5ef44c4c5d87b314be9ccc635713e4c7e9f107bf2495eb32b31e8085fb574c7d741e8533203878b28818cd901ddea6fe0039eb1c79aa7f899454f6e4a4eb6f76bc90a0cf91ffa1e914d4fbca58ae4f18793ff8837bd775f12b457ed885b44106b390161d582b1a8ec1462763c3cfed68a8f8961e50e385aa49ce35dcf76421d7e79664eba6cc26e4b134b85ed5b8819a051c358837d12df0f8a58c6f15dc180071a6ac37dab92457ce9dd602580a278646f45711c7a83631e10f2ea8bb31002216c74dfc4c56cc0208efa09241747c8ea7b60a29bd08d3327b03ba077c231759c9852835265c2d46f120615585f6caa8d0b97123ebd9a24bf9472fbe1d1f46d694cdbdd6def4771aa434029b0a4f5bc321e9ce816248436acdc1e9d6e8a861787dbc0d53182e05d9aeab7f45b58bcb1e0259b14bebf8791d7201935d39a8846c739f2766f499005df1e94b10cc138d4225e69971bbafe56e6387f63766452ef0869ad84cb1a9e7226abbc5abe3c2cb126bbfee900a05ed558bd7b855fc728055519c0b3ef7ae5b46a2df6e9fdee456adb1cd1ca18b7de647aa3dab74897df207d7ca13a498fb8091e676bf397ab3964c93f5f3df8d26675e531c10e432398f267f99d39633d34e4ccaa75c362f50b43f34b5d624bdb11257bc1cb111c029b7c7e6b318a92e309feceafda3b38e99bc0d72c68edb2f728ac4a7a88b1b8a17e1192306105f227cfef1df750f9248c335f032aca699548b2390ed4a714955d9d10b647144fc14338734aae84ec9a2d7636ee02775ff0a984b9abf37ce72e80c3ac3b59d0d46e10b806a8396be0b85aa28c4cf97a7b6df584e3aa042466a3efa0c0a2a104008d7588aef48af92e692ecbd0cf4de866ac1f780fb28454de5e805804b56f6423f9d98b62ae7a4dd2d609b3c243bbdaeba75f3edb123fc1f6bc4e5b80c224219c6c8c28ef0bc9c0e71c804e3cb07eaa63d68495a0524457eddd51a61b77b8bebcf95dcf9002f501915b22926033c93eeeb2d8f6c3224c15215e71bc0e0ad3532865661e89af03d8492e967022e08159973e454226260751d5a841ccc856080a93c813af2f0c293bf141169dc7d0b9b960c4d62f9b945ecf6eb74b15e008d5c93b883da991a845dd960eee5dfc6be54e79244e300bc04bf446453cb101e8d7cc8ba018174fc60bc6dc4273f384ee310d804dc2d9d1e79b5c1bd7a692a7967cb2d9a4c2a0d8e21b87c6f7e84e5e226dc6e1df0e29c55d0df74a97c376d01439109ebc468e070b2c290a5654e2f6445800dee7d6443b2b9d106d8fa06bf57ced172628f6dea241c961cb0cc3ee335522ca589b90c06c3a8c9ad2700eea2a658e29bf0091d7db1cc875f19e68c15fa19dd7fa94af46250c35e43985babd9ee70dce771f2da8aa5c84701c0bf68b139cfa5b679aad16eb65aafaaaf6cdf117bc5ed7ca0dcb1a8872700cc563c69b138e0937e782f234d0d2d45138325e2ede501b792f839f651b22169833bc96393959dfd4797cf2115daf9ea1199a4d228e1a7d6d7e75593c78b0418c11cb2fe2c561ec3607fe8dcaf7afacbcc2b2cca5f8e3ba6dc3f43d0682fc336c5daeeab9b32d23a0a0a811cf2091505cdfc10317b4a94d106e20cce7f901fa4418fa22b1bbe4e9decac4bfcbe45826499d9443b8d4c77cede6fa573a2b4d9f2694bfaa49d2980f18dc01e5ba099b3fcc84ca09cfcc722d0d3912da632ff5a48a28753d2cbd434d82c816a23eb01b20dc9b43d7a6ccfcbd8f257c61b74f4231c8723fae779e3bb45fca862a9cd9e79936b7bee84c2ba3f4de2ba074b736a1ae9e84fcb14a82d504c4eca3e60d27af2c425d90cbf2c35eac01a2f7c987ab11f09c381dd894b8daf5671e578321fa69c53f91489c70bc432fdc2633b91487f6276c71f1358e4e8a7c0d3847a7b53cd627accf2f5556501814a6000dc4dc56907304c85ece8e70ab23014247baefdde8928566fb338f5ee372feca07301a02898b6cc0e3c036c278394853045f3ebd3e39b22dbcc6d7593e4b1a4cc5ee89fb86598ae9d16b56c314a761470c38e4e2f55a3a783b7b5ee1f71cabf5c3b9e01cff8a2a5ce9fd11913bc43eaae6ee262baf6d8c255737ae0a2864703cfa3b2b72a9e057b824e9ba1e278c507a9883b1cb9e181c4c17af90d6c418e15a2e347a668c95923fa5f9e04976b2e9b819322ecb72434ab0ee0e737be35164beb521cee7c84ab6b31f05ab741ecd086cf4e04f200574009a83fb9dcf6278162ce1461a930fba3550fe1ee355b77f03753c8e9cc124ed1426a050d26197b3eb36dcc66eae9fd0ef1b2ba094dd85bf2d697c28a55742e5f48ef0253211297bb76f2281b8e878cd51893ac5cf5bb54955d3d4d773671029c9cd70d74585bab4ce7c832f61a9b2ac2c1776dbbaec251770952f5755722e6f08a1e1058c7d530f1510b33923bd5a8fc757b147599ff6b07d4ee94c886468d0ad002cfbc44ce7ec4c6e89d417d20e6c354a2ec32ee4b7414e72500f3913087cbe040830e0f95f6a37fb99bc7b7e25e8bb81f74d52bddccb7c613092b1ecef880b066629c155b11023b22ec0d76dbc2599c34df89b9371d31b40477f0d6bcb57420909e20b4a4f5a6dd1cbbb81e82dd9ade34ca179b2031114668bda75038b4e805dc8602c436cb18953bf06484a377ce6ce672f40286124f1c0cdeca666a6399c4b0007061f762c0a7efaf6b2fecff3812aec89a9da6013e9536c3709b83844343db3a5a4d45203fbca0bee8fa83863c739db56b9106b29d8125c5365607a74b005e1530bcc8206df2c04c374206626548ddd200406ec92669de6feb90005851c29b1d8f1fa5a8c89cc47351674141380878ebbf2645f00752b4972638f0f163c0ccd3951581c8fad28404c1b4437bcca1772eb0b07447730633a06975d48ce5156d3265e73fd3966d7d090b0b2ddbf94d1e340592d4e93821c14b131c74c0f7b3e72cac84047b1194ccfb9ade0ec21ad17e0f695e60183a2ea64eeaeae3d764e76fa5ae5d7cf2f0e2fab5f8c3700cf59ee3fe33dc0f186a5fe7a67bf18fbc72ffdfc5759b28a07e3b626165ab769bf8ef114fd6b83d898a99b87e6f6f5214e2284e5d6c7e67fb161ebd1b546c06f49fa74d3a543b7cfab33ee3f22a5d943f9cb7200294e5c86566149fbe6ddf19f9f11933c95418a4a5526ca3565db9d48ce2f08239df47921883134106ccf527ce32b5fdde0f145abf3e684906e9a9b500ec48d92a3d69153623c84b73f31026081176c21c39f7ea76cbef25f9fc6187f669b7361e74d897eed884d6293c4e3196627d3f77262506caf68f2e84e0e4889a7900ee8f8327c183b935855fb865125754d04c6436953d8369754e861f91949d49f1f090482c298458abd0dc783ca1352a79552ccb386dc115c103b9566944646e105db89d68079eaba65b281944557cfdaeee23a1bb6b6ac37885cf879519a29ee6ae7bd552bcdd510a132916b6a37ea4b7e36a9a2668edf8cc9a4f8e5818bd7da411ed1ae733eba220d26b12daffc3c275ee86e59a530da2e86d7bca02fc3941ab9b90de5d60bfd83096733f9f17f7c64b1e826dbb3ec7dd6b7335b682102b7678cf78b06a8392bf76d9b3693f715f06b3bbeaceb18b3b2afb105f26b286b5726bf7775a8733211bedd26966aa35976d78a0538e618cc5070e266476e1fba04b8b56a096f427f345dddfd8c5e4e99958d1c037d2d3259a5d92a360ac890245b71bab032b35a4fb985f95757d86b2f2f4f6e3ed05e38e1cd421026c8d39e3940081c4106da8eb77b8814388344e9b9f9d00fc3787e7278cf0d51420f2bae14b62bf5e024ee34b69cb5433df7a157812acff7d2b383e19a11f067ce85bde2316d1ef52f2163f0c894e2ed36eaec070a9ae63dc0c9de9b93f4f9a49f3c2e752964e67ca42d829ed44816804beb413b397fcdc1394afb9da7b21aecda894d9a14254274f4846ed07308a103bb3a925a3f40bcfadaf0dc81aed3efd4af20ba8141c446c1f3461c24d06fd750d7da816f8232b95e9509fb69b6b156f059e2405c253bc8f86d3f76fd9af8c0f78ad622f0d4df491e3b25e10d99da7e6d300445d45aed564ded676c6af59a408481cae04973f610f8e7d3f2f94cdef4f66fa772887534c9b58293b544f42fdb6da0294ae1f45c3ebfac50e6b2cc4fd2fb880348a36b8c64fa4151ebbcd4dd4bedb8928b61bfdc7c9e65ff8beee9516b3aea81000c1813be1a1fdd7b819686f241a0390423d20a6923b571c911a1c67115ac96d91e8ba60cec1fbf37542c6a8e3c931ea8c9b19a6120ed69dde16e762e9b41f1df5fcfe243af4fc6c240b8665aac8048c03fe2d14842254cdbac3b9e942e8a737c4711b6cad83a3b7a9cd9bab701e9cb710b2b32394a481e5bf8fe0c402ef00d745e07cb9277a2fb4ccb7f5006ce8a18f57a7f9ea948cf43df07987dfd20c93d437bae44c8a91b5ba403388925a9eefd91888b4e705782a5cd02cef050b82ed86bbf85dd1e137738532489fa46a89f0ca0e21bf7ffbe817aa9da0f9145fb62df0a0e521eb60517c1fb309a4add1b9720c3821fcdd664352aece6ab3dd6c03aed9bf399708fb145029000d80a952e55d75c72186a0df23d278c73fab6796198b0e5890e22774f863204d2c74dca4477699ec788d61368add111dbbafd8b022e3aa567ebd9370f6dee2145fbd16c8d9197acab087709621b74ef1e5c58f8fd940d516c1a7b57941077b9c9e028f0fb2f97544e22fc64510cee52b5595ff27820ef9e5105773ccae838922acd50bc5bbec2e49aa6e5dbbde1df2582b2d262a71a89b7d8a4e6623938fdfc257a0236ec830e5cd60cb2ee950e516e5615d7c3555dfe2efe1c6a3791602deb3f4316bc25446cc3ce67aa8196b2365b831fbbdf5065e2eb1502436849626fbac86b08c00526852e7e3c559cced961cac11e45592a8a228913ab657517d5640168622bdc7a3dd21a07d07bdc845fb6049ccacf78b8736c7f547a1e0b319e956124ba615be1e9f6e44808ac0c3e8e3551e14c5ba247f7b1902e773f296bf8d36ece0427fd0061ddf0941f5a80f448eff673b53045236021fb783c2ff69ca35fbaea15171188059fce1e51123f90003543bdff0a68aeea4d918159b224c547a68966af7089ccbe59408baf37d34bbed72242742d99c84a389617c470015fa62df2d7f235ad9990a8b2401bf076da7d31a26caa739c154e0505e989d7fd2698e9038935cb77ac8e50ca39ca7d56c68a53c3d37de394a4a1811b728067021359080f31c3b5bd0dc1dcd4d123f163c6b75cd1bbf23dc8e6138b0d63c53e8bacf6ea325bb7756c1cd7a0421dc8c31193e14a1cb88b13a707c65aba537f1738ac95eed882adedd1e7672ecd4e39621bbce3b15d919630176717bf4c28c199ec4b5d61fec953c2c40015bcc4523c0093b79263a34b57f6d3b34db7be47a612b4f755834761c8527fff9423e7b8f8f49b398cc1f16f146766ff640070c09f9851b92a5821007a58abd5f972d8620de5a3e3295f74a5add822f74ffa5457705cee3aa99e05675e2fefc30d95dc059618b2c78fa95c9b248709cb20e7267168ee316bb53a054c11fac0a772e6f189c4a17a8462ddef883f27cc6ade71b571c005d95bc625e12616c4560e0b06bb7a8ff1c6ac75ca9a3f8964c6eec35780f10627cf87b6998d2db0636381020f599d12ec07614d3c6fe9c050ca58b1edd412b01a4cc7f15a154ec89027b3fdf48510c89f94729729d7e3e291bdda2a9f693605ac9c65525ab05722c90fa78821258df0a78bbc4b126082d70517117d26d23d9a27cd7cf250d706f7470a1f983d99739f86686ae7b2238cd292b880544090a3f0b9e49d8900df0279e2e83f40a4300620656dcf6c4c4592534e98a854e83f229cddef6d468a1209ddbf13ea8d86ccc05b46db60959d2bbe0772e86f52c58803b0b123d23349c116e1149a64a096c5f4ec4a25f5eee914fe76df0b59b1b865cead7f089e8f6e5fd77bc7997823e2dcf0e26e44b39bbf7a8d995615d48eca12befb6eeda33da408fbc93deac5d03cb6a44b06985374563f2abbd8e24b8ca14e19b651517dff5777ae8fb73a337093d36625116e2e8f5a23b0228fdd2b433fe10918768999cab0e85c82c0d1fc00dfb626f13e4c5bde335f84d39fdb7696251ff2efa4fbd0fe3dcdaab264942ca8b1877868fd0ea0b54f15ec3b9b7020f40de109879879682c4f6932217df1e223b542bad15f2225796cd55b02d654c31a1126a0d2f27c4d5c76b4d03139378076ecc7c475573066c2900deae6fc9915947a459f8b43af342f7fb144447c241004efcbeea35ed6deebe2bcc138bbeb9cac71a761349af545508ea8d18cdf966564146048af3713a96719de809efcd137335e76d2347c10cdfef388c5d5259a6266f25f2e0ffd809094d07ca22d44e73cf592533f25211a6172684dca579dba2571cb3b68f7fd20e29d74b80e0ba2a828b76302e41ff370aa93f4e5046adfa7371537547059c709879da6a2fe1bf1c08505400fa511e6a24ee4c890aa4472b7492757af2d642d9dff2181b98b1f44f19556850853d77e49fe727b2483966c9d9a0ce77219218d72a163476dd9afd2dde3ba582c1c6a315234a212da9e0dc6a0cc0792f7c11acdc365367371913e965a560424ba7b60a3050359499a7366405dcccec7e23a8f901ffec87118a65f46c7836ccf295aa3f98e9ae89d7926bdfb5b4b41ab8ec3ebca27bbf36e50d7509015b41b0ae5afa22a5685e162a673acf4a22ec67849d5ed82c1c7e7baa6cbd0fc646c4f82befb9edcdc5a9e61882e32900471c0e50528a613ec98b435cdfb0c9561d55717f0ee85d9a1f4dc427f1761a4937dc167d4499bb007b345d576578ebe4e1ebc02ab4e7e984b7ef97a7e42c7ff43398f7c9025ecf5708a04666de4d9f1d4b180acc344e7bebaa22a7e0f65008b5ab8f73f7775a3c90e866244456e251a97e64ac92a8a5f48cafa1acc3e122dafe7dbb7e752bd9daee642254db56971ebadb08c69dffa05505db4955f2c71b76200f99f33ec80941fe256f6ac8ac68d0bdae34918401a64c4d63b311ff34db21802776a280e2fc222b617704acc730c164703bbd269c8c6809c1106eb5210258b9986a82c2cb74d87bced72b1075778e0e196c810085fbe83332518015361a97b13ffb0ec7ebdf9601beb5f49e8260a1c9506143055fd449f693d1ee5d5d7e27ae80ad7dc802da53b9ecdd51c48276f429b6aa3f5b18dcc5c6fa7ca9bfdbc39914a8450476682e2b283812a34a88befa1a6397bb97904d15cd87cab25bd193d35f3558bb13211a9eb9fc9269542846e4e704e983835d72fd4afce96d7e46569f3198e5c336fb0dd1d0e1c63ef6e4adfd2cb6a6d528d50b5e4e1f6ff67158b8d694efe32e01b88ad3c36ddcb561280f816d7d4bda763b4cd8ef9a575f5eb3e1bb3d2236aace33518f8509b0c474120461b1695cba6473e4584e6cba0d6f42c7b2ee90c1dc3b3bc75bb1d3ba598ae60d41fd180a174591ba0814bf5f904e1f31b03784bd9d9d68babb390c7f6666af7926347b176709187c0ad6da6161da71209cc30b1ee52e1ef1dd9b1dbca477da82eb989db360e7ea3b3409840124c79bbf120a3a517862682365f49bbaa505c6e897047ceae3d273225621ece2b47c33c577e918170ead7c550b5d06bc768505239aadc807d1b469a27f1a8e56ab68d33f74c111ce4f18fa759d04d6d363cb7b5b66f08a908d9b114114758ba018482cad0f2dd76a8ef2f79c2040a46948748471820bbe3296939e33d324a9fcd674dc18a3bd92861142ed88d1c2c8a9f4d02ec64cc85ceb06ed69c746f8c725c2f9f1f60f48625f1300b91d7a14f2d36bffb4de329326dd52c76cfd45d21f6fc803478de16b3cd6e87369d3b2be3e2826d4a7834fd1ea861bfdab9306f8baec6c28813efee784b0c707c47e8d04d91158b9505d563d3a8420b37d6f61ba026d05dac3f4b140a9cef9627a9b40e669c4a7a8233cef94703e2114aae7a13d5c4c43065d305a37505d64db6b98615d922bd94a7ecf10c37da80f3c091bdcef982b6ab655024d7a19eeb8911966b3bf59735f9bd8b0572add286b0845f692efbb802de86a8b77476fa51a6bf177c8a828f06711c38896729a2b073cca2fe19f304cce49b4f5b202f55ec4ac8f4e5a61507a7033a6b003221c05184d6869a83f1f735a9a3439f2eb62c6b8f5dcbe34a26eda97f6cf20b00127215889057aa2a0994b3ad0b2be64f286f3c2cff693863c76e017b7e4267a3ae8885bed8d7ef4dc3639a92d279d548b6d83deb4bd34de040853cff824607e20e861a1497b8d1ed3d28a7874d6dd4005fc227b16477072c9b1bd5f6c04790169f1b609347fb255ab3ade0db0380a18d2d05543a5571b891ef3fae2bbe815cca9501f01af57d7bb557f5a1ddbdc297bc9449dc6e46ba120b70aee874d93bf83ea63a4b3d794ec890e23cee42a51f7a9c274e3c405a9e905919c3be70ee4f935bd96e9b18716dc1cb41e4a50acb7040d3b08881160d4f92ca852d3edaf4b373b186cfd30d934d02e3599a814deea02bab713e15689a17f472ea80109c51df2c2f5741c5c2adeec816bd20711d4787b9085b7adb5ef1b5f47c10a7ad4992949d8846c591f67d713257e67dfcab0d72ecf09abe2468ad8b1eb456fae36c1bfbc8cfc6f77cacff3697d6bf54ecea2ed2f822d64b6ad38b73167e26267a83d5796e36d4fb60648c77cd441101f4dcb8cf7b570ff9847bc3487567bd5be8e10630ba739a7bbd87383c332c541fc3ad84c24b697fa4c499e1f6f2b245b4de02e1443e73fd1ec1ba0d95fba7da4f5da7fb9dbcf60523a5a160a6b59e84e1b5fda829872fa838253f42edd04a8444c6ccd5c464e28945005257c1c66eefbb00cea844c798c2c456a58fd35cfe6ac2c42358adbed9a33abd5317d4d7f1bb1f452baa5f0cc761042994752ada810d8828aa9c229da2a166348bcbf7c99261320e4f6cab96e112f5c760507051a19e91acbe494cb623d63f1b16ed62c35800af93228eeb43fb530226921db0712c583499fbc5459b74139cddc663c4c97f7d55923375adf254b1c629bcbf8da2186d9a39925909c2abf3a451cf74002a1e46bacd7edf661724e3378fe75997c93fb68bdb8f5160692cc1954a337ef15ed2cad0254da5841ec69a32020f3390de1c03866f43077ca90d8108a05f8048454ef2540a194b8205556fd5cef395cb306ccb8119f4e5802864cb562292941baf7a3fad1d89f8896766cc2e295e3ab1d6dc924f0e93ca3b3b793b2bd67a42d3ad3328b4ba2c6da3e76d3378348c3acdfa491cce4cbece12047927d440ee1c0a2f1371b2f93f5c534f9aaf0c70480d193335d5d0c1ddbe316e3ff824bd73b52be057a491fe1979d70bf781b6e2c1a043ba42be6891bcb6813ceac06086c62e977bea3173349e92b9f4943fead6449fc2580c930db29ee3ca5c2c88608b6c6b254be2d72c3a48725a09cb3fff20f03364f67fc9cf8ba4bc747cd7bd7e03471fda7470126d7bef68b62654c098ca1f203cd1093bb19f16cdbca29e344b87af8e23c3327c2254edaeb642deb95a31d300297f01a7e2ec0258b86b11a6739f6e65e7abd8127b019070b1798699f0f9778965ee9ef590d83e4ce6ae1b26e018e499f5faa5df511501c15b616c16f00244ea79ac5cbbe212f840528aa6fea6ed0b76e34c9aa75e1bbb36df1398f18b68bd07e1e71cd5b0ea57c5ce85e8d3f32fe6c6cfd083161e40cbc00c301c556c80eac4ac74b101a33905aece0fa612a5fac48c6e2e930bc0f9a90da3e1be3d323949cad83a2b2a2f82620625c30ca50e1cb4a448d209d233dd037e52a8b14b1d701a5abf6b4a8a90db17b0bfc41b255154c48ce02ef586613c850f11d4a53271aa0f58014bbc5c05505b417a0852995222ac47e9d1cd7ef598c3038887c5ef08b1107357315427027fc07c480aa808c11145a0f2a4c7b0f805218754c1a094452d8c309d7063bd562f25c9fcd00109d1c77b375fbdecdc8d4e8cca2c909fad53b8713236bc9654fdf258ec16184b3da45b5a432b43398ecb17cfc62c0b7d6bee734dd3f411ae4ed69f50c251a63e84a45618fc90f0ce405ba64703169a83146aa69251d2b15e5798a18aaedcd007f43e0db2e225077ccc094932d386e1d2b991110c0d0ebb582e31739b4e3ae2a32f6b35dccb6ab0621967c691dfbfa3e54fc474e3da616c9593d81a95f22a4e174960c702444166af6298f37bdada98f60da4d547d8a1cbd8f9fda1e88e4fa2f0f22e41ac3a098b5b64d0f52d891d3c20397a77eac715bfbaef10ea9bb471b0dcfcc989c90962393aa659cd8b371e49b708736ac01d5a068c657bc68e6194d7a3fe80fde8a1943bd74879aac8a17011111dc98b22c7ac727aace010b19205a1b869d652d7a55205d9c0d397224dc0f481f50f75f6c7cd18b2f0d7b92b3baabe357b21d971ce6389252d4683a892aff90c4cbb0da5a66af87ad893eb3982986216b6d3c7aa50cf8885ca3188ac8a30d175b4bdd8a45daaa8fb7a8a26de3e62cf0c7426ddf8be8dfb45699604d7c36635c7e530bd9e6ca4e7404c3011c21c66624c2c76a2d2cee9bc954e2496059ea174fc866771b10e9b3eb68345b69ce38a237e36eaebf061168033c75ef075ded7f2ae2b8e0be72657acc52bed2967f24a5d4bd12964621d4ff53ee6cb582bbd7688122207941c74940badc55efc139dd2c50bc146e253a19dfe2805b06c765d1871f603d750563e2e819cb9d43f18c68edde0aa8f94572cfc023b18d8e70cd743d837d8eba388e0fde5771d512c72ff749eca44c43cb73d50fed0d74d26bd435a68ebf8e3281838347be042626a0dcdd9b5376c2159b39e55d3969391ae612cb8ac57cbc1fa437c7d0d95c06bdee886c894b5f0786f59e895181d30c90650ef0d427d27f8532ff7c5dec3f20cbdc283ef6b604bcfa49826d8fe30dccfb4cab3bc70bffd06422ea5f77578c5ec627f2767bc3c5c4e564522cefd0e65fb6266781f32e5c7cbd2969d6476770034e0d2a08a8b5f75f7bca46a2ea80d86e776796f070e30472eeb67f101a2c17d72b0843b428ec800362bbb40b0c94550da0c5c2827aa916365ae4d8ee3b278e5e3dcddccd002963e8cc0bfa8a8ff37918aa3702e124d4d434cfad2bbb25ea8f6e2272e8c165a660f032a0726bec44e3e6758a6f4b9ad95a5017b95576369a9fab9ad60ac64c1564d888d28979975c37f576d322f535df0d10af3d97dfd24848c54e2999e71344d0aa24269f691086eac285720dc39e0b6ae55746fdcbfcb3210333c7c19c9128c0728585f9fea99528bfa867b3fb03359158a0e44519f100fc209adba8cbd8aa0fea8b9735803f349b6f0e04509ec5ff5df382d7b03eb91b30e8de63fc6d783055c8cf9ef7fc87f43d96642660edc2b31c4f5f545ad484b068572a896d6c4add04f115f792617b409c3743a892caa24609a6c27cf34bd3a37a89170bb2c765c02b208d1e0d7bd741ca92f35a9d37d163c3e6eb447b44c08d775003d23a1906cc58c22b074011cfe8e5e349e143fa6fc24e3af34ba84c122feba77fe6f20cba903c3b8a111ffa21d6a2bfc4284ae12fc21e688a7674d62da39532d6bd38a35a723ea79f47276320e3bdf3acca605fc6fc8a76db5809049fdb0341cba05c25ffde83508aef37d4564ab272be77bd910dd76ebd8fed50311a5a99c24ab79ef0d552739a34b3cc8694b18cda7c87345b65213b11a91cbccd2f7588bb00f6d2c7eabbf4cd10b38ebe10373beefa4b4d71c66a549cb19742e1dd9ab7230823233fffe5606a496ffe2593f9caba711f1d01ed3b29bc162536aeeafb08074c2620e036b9d33484a420756cf56ff7da526f623cf8b7238afd5f537d87ba9bd34217c794697dbf21b7dd746ef91a207d75ee374f0704b2d6ac62136b668cc1701e41a61161132f588d93e18edaefcac0d6129a9d490fc4de8c15cc2f8f88d14dc0eca5e1fb0af303d9ab9984e4fd84915e2331b68c771a9d4ddf303788f7497fa70eb967089594aeec91b7df4d2fb2e5881488439ded80cd382d471cc2dc4848e01291e78e9624c18c8a23113b316e98b2b7f3427d1707856a341172895139593e7ddde0e12fbbd6e585477482df2b104c76e04d4d81d9b3a2a27a29f42dbcff56191a690d1368895820910d846fe6594e6e7ee35da2ac7292def9ff0ac3b2fa4670a2087076835986a2d7d471383dc870ab0b0fefa8d53c2faeb0e5bdfc1d4e8d7e09939e71d15cf7e771ea54007dfa567ef2fa94a3582651745baaee616ba4734bb0d0ea14b4f8adcf9f0123766b469085ecca9f033080a000ffae89e4c29a49df839d90858a0863d44484cfb7727d2110371b542e0855d71211ff7196bf2c1e7829e1ac9fb4cec2aad3595c04fe524b03326691e80ae39f071bd52088aa87a1f22ab27c750cae71ecfca1c754b3c6df0fa71e8049928a7dbf1befaa8b0312843b2fc9a0696cafdcab17c71835e8eafa7014193e8aa6c0c20d685403c64a678bc6b7c1dd1d798fe11878f583f4893e213cca6c910f1d36525b15efaedd2e498966c141b22e9688f918c680d015e073d3701fe336af9cd96f25ce9b7a98c5d80f4940cab3bfb5d62faebe73f302451076dc7162a07a48f3970dbdb09dbcaa59556c94930cc2f184571002c5d3d1d3640587c6d1fd9eeb7d401af64a7d77e3cf4fdfea307a34e6f5bc7c5125f2bd5ecbf3fb9ff4c39cdc6e348fd7b9d7b686520f4d6ad7393584e131232b740f84a7fb13671f5e0fa5ca7743f8a73207834c789b3ef08f8349c43a8757707c69fe46bd5a2cc75dc7502ba7d115c90b2aa822a82b823c5e9905cb083c0a65ff8c05947a9efbc25bbc416e044c5def746381dbb6f566c0722016ad0c7fa0d8b7bc7eded48291e788d505bf52fc9f00d1191e77990a38223de8ebd351b4cab413a760a482d89ae2be44c550e89f7c9b0c7a11fd6a05455695326a8398162c90eb35ed023435db797cf8f03ef4f13dfbd40240e26560fcfd2622cc7fd0ffdfa53385b73d1d6590de6ea60ce71d196315d53671fdc432351039dcaa6048c0438ac638eb312abf8d19cf504222d6976cffc54196b8a6b573f4f44b5eb9128a8275b6dcd4601d463c4f92a2353ff65576986c2d3be16b048446319730c9a56e5e3135a648569d3d32701fbd69a893c8b6f19087e3840d44244c24b34614b1ec4b0102638f0a05c5be2031345caa60f059b37119beee342022e248864f8d69081ce612f971d79dd3abc5afe877fdd708fac5996f843c83e69ff83dcd65ed719178bf25fc068842be90a5979718ac1f4c3088cadce13eea570264958cb7faa112742316bc06a5986c01b8f7bf5f00086151b86f1f8855e19c05a8bc7d0db29a611ecee87f5c8a53ae0ab519979df99f93a025803622c3684e99a94380f066257e70ccd91a3aad59ed1c79cdc09fd5b0868cefaf65a3377686c497ed2926d94034adeceaec504b50e55b0a82a094d61e6c27eb272b47c1c54b663b1979e20906f4470f99eb0f91939e88cfcd2c92313a794e67d48ed1fcc2f7bbe3ac35c1947febfe18a5a52529730ee4b9a8b9d55de9bd862b3e669d391f631f31e6a5eec9c5d9bd5c2c6403639190092dd86bb3d1dc22442e7025ebe87ee8cfd3272139369704ddab4030ff1966f04f61c08235c968274871296e8972b02704f4c8d182da8e40c3239b959c864c7ce5c4edfdec4518f107c94e544f201ac87000c12527af5e1cccea1431072931026274008ca108d580fdd1284141162f50827b76eb79c4479da0604d9a1ab30397272219ec7e6e00d798db11cedc76e3ae5b75fb25210cd1e7fa771ab8df25258cfa01fc7abd9e7d5345b7bbb6a860a5d157c2e75cb06beb8e8c587cbc988a52f6a7a1c19ec073b858040eceb80ff0754d05e70f12f62b44d37ae95a2ab7d210bb75aedc86c25c85edfc24313082cd54c3c64a4f092526a0a90411eb246a0eda90ddbe914c2ee74388c4585e0439f7f2fcf30357b5af3407bacb01ba02ba0c46c1a96a6a3ff011b1b8164ade0af635141416c7ac15c8c364daae5437e6460659cf937523221e147cb827d00c0315f94eeaadff7ae882a395ce33e7918f95bba89a9d9768382e43979e791caeb82159774dc244d893a79c000bc316dc412d0bca67d84c15ca7d21e585b8101b82bb978ee04abd027c8121f7bca1bb61f9b938df06ea44250c76e77af6e7599aacae6bd64f80bb21e105c04ce5e62a830515eb64458a1bf6a0923e18009a69b68720c49a06d7ffa5e54e353a0619038950256d4824105d598f708e182a01e3cdb88e76386bf543439c885293c494107c265701bc5d3a21b350c36a5bf7c5fafb9e8155bf6f1948b5099d96e59bc5331111995710129f01903c8c7a413d2cfb2890c6394d2c9fbb413dfec56ce4675c1de65e44b2197739a2c277849d733ed9db90af18e05a8c739d1d10670a457ff47dcec11752eb25c5656a8c612b1692c9f6db616de87aeb979a2005ba5c31c2c5bbc54b1dd0a578ce11ac8270cd943b5c5e6ebce05f9b5b38083456e5ef8dd47335aaff26dd3aaec632a1a1cd15399fd6946aaeb973922aa0affe6cfa080242aa65690d64ee594901770d61bc22bb31343bf01233f013a1ca5bd69c658e8c306c8922fdf5a2ebe9507478aa216f7b37e6ec29dcbe50bedbc1d54431a9788d141b2ba0627aa039f4507d173d41f770ed180183ab9b84a68b78a468544bc1e3660e0518df0925ab96712d171515657322ce5b8298ed65277b43cfda4a748cff0d0a6932d732b401f5b91f95128b070efa0093fc45c9c889920dbb1a73c149dd81c90d9d828232de6c7cfb5ca508f46dc2eb235c9b2286478f32450a0f0dfb42e606e3db86d6d008be996467da4777e8b00d25198f4be204082767922182c9202e267310f7ec106f2141961540de240299e35fa8451cec71762ed60b2c941bc49cbe98b7ffc68a5bf493f37fffb6fc7af820815fb3af8531e0a7ada7509727d8317ca0235c9af72a3fd981e2c4df3d3407860a2bcb66538886cd13f0859e0ecfe207424450755cc925d30939c2d0d0c1b7fbc33fea9eb1e92c9c7be142080c5f4915cf61a6c676e47743bb3c7a4eadda9ddb9ae250ead92e3f0dc35b1c4d4c55b2e78077f6b3ed5ef7a8d7c6007a446f2a91107971d7fdc18711617af5ff73748c03742457b9b55c2849bddfc383b53fb87a4583d8bd8eb29dca01531690f651511b24787326ea49214e6c7b0b3be28153f5c68ad25b780370aaf7cd9ffb5d57c386cb015ad207ec9f64452f2c045f307632da5c967c7f662996a89e89f894a254b60167bd281cc2e0632398667c71a4f2ebce8049170beb9ff2812b792e2856080ef11d5fec9523e76637667ffee45b3e7d5f0264e5a56da35fd8a97bd822a3597a7b5938faffd9731f3f7991b54f632c862527b6f1def5b3538af4baf72564c189596f2fe620e5c3f6a733c84eb0f1c471501f6a14876836ffb56313e6eba36baf33bf9d9a208f8730a20465fc353f36971a4d1bc2270698294f8f0d3df390ceb70df1e7dcc1526e7ba6718b2ea05d98c5e47ba5ff97830db49032c729cfc1c45ab61133f1251693bf154f6128377ecdd53ca8e74a88721f61d340804b66b117e6c8271af2d0a1220e1ae10e5cfbc5607efeef4d990897c1870e6214a40a8666cf11a2644874237860437a0a6c646ccfb335461bb2ebcea982d50f029e2e42ae86c6fd8694aaae91431f6fa6286b5fc77019cc17a92e3f1e089ea39d188c5728c111a41050a7be36644dfd9cfb30e581e829541bc6a506c4c3a5d3a2870ba991152e30bb1f6c11bdc6bb1267093d760917c4447914bd7067cc856d527a4b42e89050af2f0f04e35e822c184539f8cad2ae960b2a427010baad857b22ce6f2d0af8154160902a7424dbfee94523910b2d58e8b068caf09621d346ef743d09aaad6601f7a09e1475f9fe30e422f071083b80e9d39760c0c4e538160f3a2695566274c36283805989a74a26872d49ea2368959e087a63a47138434b56bfbf4c740d1ef8927fd3033f0c1b4123fb066cbaaa8e6b45e0a5d69912fb606412446afef47fcc24b6afc8f761357efc88727aabb6f93542a4627c63fc28962e8d33bc9d497a0fca8f779cabd27e3ca20b5ab651967c9211e3835ad8ea4bb24bb63a2d079d6a6f93b5e2cddc2d36cfed848cef92b811f8dfc8ab78772790b24f8b39bb18879b7d2a584c82e40eae78e6a777dd464bbae75e19aecd6b641768cc772dc9fae607146b817099c3c3db79ab33658320e11977ed6ade1d7d6f6d294ca9d919ab04623dab40b85946d85c41f6236cd96cf7c8007b6a495f63affa5c36001e0f48261de885f61139ba9844de5ea4310f7ba865436c927a8e768a2f4375a6310aa4452bae3d76b545041160671f76878590970d7e0ca8c8839a63a04cd6204525bdbd67938b8396a08f89c6bb11ea084abc67d03222472e3c4cba095b88f58b13a5637ca52aee1107fa07044c075cad31b011137088a23767bdf46a987e2baca72a6d8ab0c527925abf2edf3eaec391c238efdd43fd68e12fe800416ab644ed04ee0b18453fa561ec6974281adbbf3967d13e6324164f309cbb8433765b445169ea50c6b5326e158ee3df7b5c3b6d78cc97c835b1677432bc871552cd148f00129453d25c47c9ea12232236483de2777f4d9ac8774ae637afae999c3011f2ec82ebdcf9c95d240e9a7238661b234c64a77450f0ee02816c43565f7e677af31773a221239ddda20c82051b835dac5f46e67ed305c5f9b4f6314df2fd6829f46722a82715ab602c7d1e219b4747567e20e1a4947ba51b0b2bd9ae2f7528256e3f43758451a0e770a399a4d688fe1da899ae117dc254addba95a65279610258b8b37af5bff613aa984ea431f96bd3ac29718cb7d946935f2bff37ea18c804a1e9ca97c18248d4d3e01a03479d57ef8b2301e463fc13e00e0756841d92b07534e1bb72e9b480420a46c6eb0b74a2518bff0b6f28a17d279f0dcc18de83f2bd49d96a7b31dcd4d978800b87d2b0f3239c599e4d3e42292e36437c6d7db26201cdeb155eb0b7083a327b430e1a6abb22b3d796b1762e2d5ef1de65bd0295cbb1010a0cc703035e1ad61c0f3e567121f14b1e82317e801c489f085e207684e4ab82514b1cad2b0455f077a52efdd78c264eaa54567e62a12c195fe089cfb416fdc1a925a54e8af7dc79d5a3ee40a96bec55f7f6327f85fd515fb8b140e1badf95c4b04ecfd53b834a5e5be73631543c64478d0ea948231e4628101bae9dd19d116aa82f9691e2fc275b69d61025104fc01700cd46c889f5bae1d7a753278b7d843082ead81c6cfa3ede37f40858755b5aa6f09a5f73488677052b9b64489a09abdc5ae8928b1f81eb0601817dcb866747a24fc52d9e80287917457c14cf2c7454724bf283a25030c3d3fa7c588ec8b88c14bf6ed2f62a03c2baf19c0b0f1211f95d5bff399c4b67ebd5706790aa3f66873c6b65060ce11de2b0ae76d239521fbf9bae15e88b9ad7ec3722aaf89c24969432c1c1051cd128384f81e789b29c9928d1d83d37594eb8e1ff6f3dbda8ae46b30b8dfab35765067d4d187b322e63e2e9688d4c9ee32094edfc9ecf7fac75990e10672fa2a5263a99ff317b72223394ca14c3a98d7a178ba417be60dde97a3fbb6700ae55b378cccb452442c5881dd563f5fc243807b76349556a9756bd81e7e460a31d238aa4d06bf9c2d6828f7bdf08abeea9401e5481f64f48af7a48d7eb471dcc76f7ae94c405e60be841a036c3c772f9c0d7cc237fbb9b894be89f6648d9a17aaa21e60e04e5747d2f0862f6bee4c297f54abbd4100336bcf15be6096f30a7e2fe8e56a84180d4bf7da169c344b0ebdcb6a374a90b37cfb2196a66bd88ed7455a5342fbb0750bce76231399206ba4e3b8fec5aa736e5e62187494bf5ede523fef2268c2040c876a23139c5ff5898abe4c26765a095b35fd831403ceb6b3c774a918dca7a387a8e512af1f120238d1bb9fbe5c646a2ce91b600d72b65a4fe93165d09d5815fc8657ebe5bc1a8444dddd53ff6ce1215647ddf2937eea85fabf4d939f9e2afeb1031f7cfcb7b3f002fab8bae8358aa2db39abef1662dc7143d2e94c12381cbc3035769d7084f9cc0caaf4f06524f3ac09a0a0d13d9ca5ba29cde61a7902a4059fdb9338b132da15f2d883f9c0697f4fa70459ac9ac356e3dded277a86efdb731789b3facb03444af0752c20f0281ad573f26ef92f6fe29f5533dd88b78ef57494c6576a590384d2ff11a60761c5b4398b07ceb1b4d050d6d8e76ee16290fb8abf97e2ecdb67070752d3e1f72878f7b3434f6f270cd61295d3f59bc9d9f30166e67162f6278ec026b07cb20cc37e411764457095e44f6e44ee8410eefb40b15b6f66aeb1ad71f0a31cef16d6b80b2a5eab609ba9bf5cd95e0f885dc14a4ac500fdaa5b5438ff6b7f009f24876b44dcae3751c445e524daf8905ed5bdf8da2cd73ed9f8729454f4163f2800f8d60d2431a770a748e099948d2c6de4485d04a8d4289a4475b7a346db5fd0763fb21d07918424d370b3371e30d37c82b01ca2d425d56e1df9d983d2059da250af26f0777216c293139e2a460c2a528dd5d13df8183205bab937b22f66b1821c8b5cc28fae94f7495da2ad01df8d33657f76cea4c459188f73e4b29dce2bab033feabb3af3d99a6dbe72c619be71e17d3e64de2a54d9bd05ceffb6b91199da00e785e93b25c82f41cf2d41c6ef3afcf73c85b19284b3033f90f3681234f8bcec4cb634c3ee8f515b3a58340e266758a11f9161607199cc85a0c2a3280c5cfc5c470af8b06c1e764ab6e18a7de64670393170706aaa50e233c8b15fb5640bdfa182fe3b25ad0adf08bf39db949c86ce7372b48489cb8350aafacb0823262d307d4996b37ac39aa68f5aa9d7815c138bd7599a74e8b488324d080c2bbb861ad34ff7e8c4ee00a2311ea770f642d1b0398d97a6349d1ece2a1b812f8b11c8f732021446ccb50c6dda4ab2e6de974850311f1b4bb2135ba836ac89d15111ef32c5e741d8ed03d272fb5e8cc1c5f4d6e59312ecb2b4fd96a875dd2d4fae504cf525bd9bf8e6e939f988f1469475ed762db008571f7b607194cbbb7fca7488512ddded91885e463c2cefb046a550215f76046e83af0e4dc0e8c74b5631a26471d55a58e557aa8a27a8103919ddf5b67a8e2822fb85592eb4027d0fa83d9cfa66c800452f498eb54ff0807163d57172d13fcc64e3d8abf1a0e8ffb43c5464d8f47828d04cea58938c2108cfe50d567bd95149ae40819cebf094d90120fdddf3bc214434769ffcc8a1e521581e1bc09c675cc95064e3a884f5938a1159e18a649463f20dd13e507f40a841324a7569586060d8865b23b2df5d51b20d8fbbd1ef2846719689ab1abeb7afe28fb7eba66b97216ec87e457de8fc4938675b4ce8fcacbe85ea0eae568c9ab7f73cbd6d69500fc757395af6722ad50fa8652f43c18adb82d9e1cfea9903b0c9506dcb3ebae13575fc730302a8846c7f8772d8171e886b8ef0e0107e6d677664bd315c2a67c25d28a86b0077c5c2d6ebcbff48aa2a312cfd967d7975c36a234783cf7c3746c46710fc4acf2b345c7df1bcfb55469a0abb26c9c02518d8563a55e8d068c5d963b65e69e13461ddba3ff426cacc9c10096e268ced84fd923d85f89bc3d0a6b0fd7c0eb2685a8252e3918af22107de14fcc385de801d052ac957212e98dae1a44017e18eadcf3da6ce14a9e85fb95c6a054e5319d5eb3371dd06f6a18273bf22498dbb4814cf9c428a14d205b90e0cefbeffad699d0b40c3608763664d532c1512f53f799444c0f3231107890e82dfa81a61f49ee2020874e0e592acb7d62ab24a7059ae63b724c01376f6fab7675aca5f7ddefbc6963ada2ba5f1bc31bf22b305541bb65a79f243439c88f47085de7d31215e251af4ca03bd58b2f2ad0e9f94257c5523890e37cfdbcef4faa6a8fff6b2f58a2aa34b9cdcb486d90851956e7494969064bf497201b7ed72cb8ccad6304aa88d4a76958c04e97f3022ea19e118f3a4e1b443bdc8801a0a8069983b1d09c6c24bfd906bb633c405d8c63849a6b46d19d54db979d50d367c00ba4f4739a4c6ed5fde037b79a813af10d4d3fd381995847a91ae51d9676aa2de7744c305be5cb1b1cc3b9349880a4ad7467d029c82c8e550711f6ff7f1955b0c505b48f3b8c69edf8f658ac892b18f83ea26609d0a35ce19821482619f12317373ea83155f58de8e023980c59489fe535d46c576ae2d0a823fc8fa04380f0cc4e76842f3eb7a73f68a65d398c3ed4b2ed6198a78d2d6b456c8b364841176a2ea1bc38e607fd39e4a3054f6bc155c1a6a67a3c7f17654cff81f734fec149905adfaa01e2473423389b939fa8f99acd17c7f0ba79900ca4d0da3c3931ab0fee67b1acdc871b1d52c491a1a11a8216ccd6bd2b968575d758f128ee8c33cca5c50a880e336b18434bc6f0b83aec7157dc564ceac870e4df3d6a642548c18894c88f6274e868d7c8604f8fbb6f09d4118fd9826ff99ccb07456809213f17c212cd1c0f8c3accb436568455df565b84ec45d546502b0a4f9e8864a54d3d7ca4fe5d8c58410321b57b6400e14162a27e97fc9dec60762d196d5be226542777cd4b634cefcdb0270c16f2406cfe5b224ad80253a730ae58a1e15f138d744f1be7627df307f58244f48a03c147ca26157bf489f4e6cae64362862ee000217844862e4812a2c166443c835eb4b00f1e7d6a9fce35327b14175c17015faf61530da67bc470a132314475120e944879a63b87d843c3342376257bcbb2539a1e3bf38dd6ae21a72fa023736fc365e27a18a3263dc2845e25a54807e2aa76bea9a53d2af84f27202fcc848b42cd47cfecbf8489aeeb960b4dd99955d7cffa9a2f3afd2af4ad39cf7b91d16c295c937abac58e2071db34746e2de31e3c53919f0e95c17fe85dfd76e29184dd49d48cf54aa536f0d447007d7311abc5e8f9837b2f8d677c2aa0b13a1e9603a329f0032d3128a00cf2bbbf38d7125b2586bbe4c455856e154567990e96609337cc057c628d9245ac5cad2e8e045848fff3318950c500661b22ff86c2968bb25d61b0af765fd1c82c424105b8b6ceb0475b985d9cf60736c279439215fa051d7c97d1771f621b825148ccd004e1c6af08a8c3cddc5d47458a5e7e9a6fac4f124df411984f773370bceac86342105e7812c242f5cde9bc949c3fc7d9bb8b9fab222c1bcdff434464988a37d9d84373e1ae2bdc5c3397d38c104c4ed71eeb0c3503d43bf9941ee67e4402ce2fdef5bb20e4f2f132e4cc1fe46721b4ef5ed2878dcd376590c984e028344fbea4f294ddf97e63300bcd5313853b88096c3a2dd1a34160a0124843149d6666de1b20469396700d1047a7c9f3006f31b7a0dc8890e5c181648701a1d60d1c7146409c8343c326a1003bd5ad36a81b78658f37f530361caea26aaeedae8b8c117914a183b6a518c5dd2c15f0077d7f84b06f27440b5360bb45780c2ff7938ace9909e70f85da4de9f4974c632d89244b019cef3e78c1db004b6419b00060c9ea13c63854561fad2a9e26caa95510f81025f1d3a633e7340119d0a1d1499ad944be5c6805ca3ccc6a3147b46239826f9c79275ff3f9ca0b038a73f24e6493aecc06f0cc9fa56fb8f58409fc2d75884eade18d4f905b7cda1cb8e3a5be3732e201b34b80672e284923129c4ec2a8bac24875d109e5f8e4fcfdf037d79c9c5467e7c1d6a9b65e1e4af33bf1b4b6e932c5254bde89437f2b8f0e6378afb92a26bdc17ab8b0269cccc73eafb7fc4ce9f3c60dcdf89563c28872f540a3e9bcd91132256eb27cb7faed71c2aa7889f0c8e3e7c7c292376bf2ad9870e34f9cf06eef781321a87d3ee23ab72c856bb4ac986fe3467cb28cc5c490f94315922c91490a9e1954a9ade5afd7728dc1af92e8d989adaebf5ffc309e78d35fa66eafd791b83c1fb5c4460204a218f728d1a967787ca9545dc629a9ab5a8fb8fdd06e7fa721591809f6b06938d9e4258e10fb4916733ab43d78d318781920c525ff69b25a9043a48ea1d03dd63231351aba8640883993947407ff66fd50d19feacfa86686c7a596a43f9b3918342b51bfb4c07009f7b3a228dcdc2d880aecdb4597350e5dab0c9f4fee57341ad6bb57a6328ee3423c51eeb55dbcd6add34037f85c0aedacbca10f9d3298aa5970f84e22f25053dc407cbe6b494b7edd933c2dc453db2796a69d7ba723d441a8d6737c26d23022472b40fe5ef36c6e726edb566501caf22b9b6089160b61f40cbad9b2326e807719a7c7205e17304cd358a189cce83fb6b1d6386097ae8d8220944c7aa7d8448bc106c89de24f3c57ac786404300e70defc5aaf485b9931e815d0e9d23bbe6616d1e9767b0ebcf40faa1555ede3bf84dec0fd6def0afe14b520365ff67bb27bce66b7b28b4c9d12133940bf8636c62df376a5b5a04368f2c2b4ed6cfb10f8461b59341d9894fc6fca65954baaeca171998e380153f5ab90bc2d43318d0a306eeed175f3ced2bc05a041a2b45b81c381f5a9626e7acbc20344f7cb108046c9394259da0860b1bce28aa29a22df9d6af99dbb8a453e3fdfdddfaed510e084521989a2c82a6297a2bf12ffad37aa677b814152f6a6870343c120a21663fcd5e28bd0a984bda028ae4c39b0986aba277ebf72919f54d2b7d279d7405224035442b649c58b9f596756df01db54b84006f803f1a30de250327bb80c1589c3d6fa92efe23ed2bcaec347fd29b83c51bd1435c6206f81159dbf21104e3dc75d365832589b8daec40984d4ab380a19d365e6beac9638fdbc361974afda3b379ab41e8d216957d3d388741f5a2d1780cd3679c528531487eb64b7ace250d8b6f5baacc2b4bd1e965c2e4afa6a1551dcbdd236cbce1d24ceb5e25f18e7ff000bc5b4ca2c0e8b0e1df079926834e48ff1925898044433780f59610f6bf8b9dcc2fdf70c0e122cbd9c4003a59a2f9cb8c261f4caf936a1bafbcdb321071fa1d0f0da77c6f840847d6c0fd3e80c338ae73fa80d5a5f9ec60043a1240d9ea313a5a79a4318552c75f5648abf39343a7a47ae9b731a992a259c4979dc424d217999424250551a231040d89b97a442eae720271e32be9fe6ce2cd68fdb0d84885bda3548e82b295d2022580c64afaca9f2d2fc7ec90dcf048883bdffc8c46c1edccf3be72cf3be7e4302e1a2763090630118d19dd0cff079375cb5b6be48abeda6a506f4ae787ae4b8acec418efcb4ef9e54e8ff8f37537d8c24c8f3bedac8c017eceb529cc4d492a540101ea3163df6bccd91fb8fcb001d3093e70d06ad8aaafbe5920de57a317ec150072ace900cdc92a1c7ed4f7d4d538940ac799a1366cc71086648a064706e5bba8df1a11b9ce6e1fe94e26fb1a0d7c2b59636622bedbd671ec9589a0155e2aeb3dbce86b0e1943da54e9f1c17130d07ca9e6b6adb5c77f7146833d255a4c6ec4e91f665b53d170f992525fc10442ee3a9c007878a092ba7caddd1b3063098f2f3a98029f8af378aeb551ae9f155f32494a228bf9379003280543d5547c05e2b5f69e592fbfa9fd178da3f197abd527ca7ec9e92221eb7b522fcf87eeeb6a66ef07271372d10728f5aad6b1f5ef93ca3fcc7dab6dc84c0f85c6e360c63a907095689a95f710179ef8fff7f289da381ada1b1d442e5ed0b38b2ab17cd693634b2c352fe0376c1d9cf471e5f868be8abe2fbbc8e5145f89b58865ef0e388f4def03cd8c1d7d8496e8a877079ac8628fb37fa15e36669448a2f6dce7efc6255d51c95e2178138afeeec2416cab28fd142397c93b473cfa23903e84f2fec665dd75f7297d827843f0fd3a67150ac96b8911171c91b790f3d8185365cafdc734b234fdfa48d81582fe04360df167b2051a83f8f6694e6207f126d784fa35501d1890a7397fd3111f544c365b1e189103951e6a594e12b7a57cd92c4e3c471e5ccd7282828bff5ec04a99dd8f846c2b28f0c80e68d03df62941fd6556082e1f835e93dea1e83f9b173df02cd7f9ac3af96bc10b3772788713d558e581a698325ae17c87bfa0fb2cc9a5dd02a57270df0502cbf018609796e3205052e444cbcd1151f6369e05eecd7d980b39a15b2ed71c107b13e2791dfa540779471dc172467b05e8e1a3f70468601168c1ef64bcee9f90779337d41c2834817b4717c5c663bde56368a41473ae296b9bcdc66056cf766c36cc73932371ad6df81a6f05439c231cbc688a53c7577b6a0e7cd34ea8071275ea4052c5c1965599e1a064df137bd6ce15c64b7435012141d8009ece20e2f669f44ba17a47116fff4f45d3ee8816ae60a11e8ce46372272612f723b132b5a5e5f991050349e2b0364b960c40d4e251af3dedc1deceea325d52d9bdac52de0274bd28a920c88b92c99c3ba994d91de9b8b41cf25f3b8f63af436343d801e2d2473aa15fb02efd151e409dc9f400ff54a6bdaebf73c4b0cfa3bf69062fd1e3b2b953881b7b38ba697d13630c84708b03b835cea83843ede6a3c4437e5e7f57ccf3a1df768e216a5c48c5139a92295d52591f5e2020543f1dc0fbf5d533d5578632a0077ee4bef6f80f5912cd86fb7ac90cca3c858917ce0cbac8136b75462f4a17f5c65fe90236efea987922a8e06d5cafbbf698ce013d691f2bf37854cc1add06f1ac43ca1f200448bb05f5641ab02dddf45347002b1462ed45690f8f3d330189cffd3182c32c1dbaf30f32c44b031644f354926d30e4e59f9d4914af64e78dc5db56d661b0bdbb68e9afd59cd1e2500fd95c7d9fb61b72fe2117c4f48e0719536ddaa4a27048b99dc7fcaa982f6d0e8fb32ae5da87b9b99188bb085c16f74bf79926079cbe8be2e43fb0cc359c0deaf420498d4a0ebe6e8c1fc03d76d70c7d8e305fc922f81836f617d7e08f7f189a4a140454f753a8807a4727ceb865b446eba6c2189cf61d30f3f2d69e851f50342b6f5a08c1e4788666c63d880c037ec2ccd91e23151b700feee7f498d82dd3647ccc52344d6f88165e9357bfa21c82adb38318e3a8aa7f671fcd5888b4f83ba5411004e7855cee74f14bf4a2c073f62a97f58cd8fea8987ed79c46b36ece45f48219e4d673c685fb904fe3de6da71c821feb1db85222b7dc2c4eb9396fabf76f5d721a620e3ec128268741071e182ca5635aeccf97f129365cbdddc58b3d29a26d5c8f5b38a7da5279b4bc89e2f01003262285c9b64f3e927dafc310d13f07557c5e7597f26e785a81a8cf3f6d458907118f8340af2b1ba2db3afb63c1e1a6ee7742e31357dd3f45551f6a981e812a5528c97f4a63120562e04b4da94d0981cb4f5e7d401cf4866c89bd106ee15962b0379709f5b8e8b299316f9afaff268b57b5fdd43c71ed45a7b33ce8c1a57c5ad4be3872b4aded8fa0a7bf5359b447490bfbb0ab343051f53c48563269cea381e628383196616ca18799c5b880304f6e3446f2e49186b4865287d8af49ac86afa67013aeb0897d8dba5dbaf9857da45522272fd0eaa66ff3a161a6c4d43795a1cda661639fd2cefec187a9b503d7354347ac707ec2796413d9d7c7dfe28d1ee6d0b7044ff265825833e482c2ccd95c5bbf0b2448c279cfd1363df326e44c7478324634057662dcae05bd3a58a23b140f5b47eb8472342b3a5a58d59e77a80fae9d06d02666caeb91627d8d798441e669c25a42615ff1fe5d18a370e6dcbfb273120f23c7192d992d7d2bae094b45c57017977e197beb2521214cbd096d94615d282b1cc70fd032a47bd8a65263a0d3c3ad068801988e2f84a6eefc0b9411ee7c6417386ae63c912158856abb28337498757adf80e61ea8da7dccac062214392b7b524d321128b7fb4feb24f83fa1c12c15f3ba7d74ec57153d7ac2b9153b9a664b9f08d68355509846811898ee941a40bc2715bee0e62d1dd0b74b39ecf7658904788ee9600a91496c5fe51f7cb28227432bd1b3eaad82858f1f4179071f0a7d418f77b8a7fc611ddad09df69fd93f00c4ff6d5ebeb65331a3ca58ba3db7a13e29d1678d24e7ca2fcc9eeafcea49c5f846b5d8a841f83ae8b672ba7f6ad799ef8c858f64bac5d195f3ab43bc1be50adbf195bab1858cdaf0eec21f9cca4d1d0c28d82ae8bca94f2d03afa432b43104bc91bfe75363f468bdfa47973a6978c43a38961ee4d6121800fec1ea512b1af691ff877b83adbbbfeb1451253c6c82b4c7807c4f80d8d4d56e2462fad45d882d46359fa29290b599d7b9a1fed83d0987d3d9ddd7573bdb3aef4ca32cdcd78ab6265956c7519e6f0aaa3c46ebacb1d80bcc88b50b7ae3025be43f2aeba24fccddec400f1c82e33e15bd08f429e786e3bc092c51c04e0950daca824ba49b4b79161c79c3d7a74a540a12c8fe3e26d94e8351b008e4699a907b4fc3497098a3043688669369acfe751ebf09f855fa02d910220229a830c4cc150aca934a960da34da2708be8e96f29a17edbdc425f75f134a16a437ddf12c2cab24ad3e377ab044a537d6b7c4b670ea15924113e3e9a944213ac4dd610391c1d3d1b544e5bf54d364828ee6a5e9d409c1a416538553c8c94443d1b425ca7c0e4afc61ccc08bcd7351ab243203f3d3e829d4c8948212d453fd22175e057947265d7c5af88ebbee9bbf2544062912050a321158ee4fd9f2593796f906a33eb0a9be69b2d17329c1e61565405f85710bd3216905d711fc0c25d7d568e58b44501602114cb104a687aa3238b79f5365eb78f4469c54ab084e88544c867f8a5f2b39e21c22ccf946a9e798f33104792a9553c99afc6d2f0d787d07c248e534b1dc86d829c5c047e7d43623d212ecdeef2938b802c33437164268cf180eeba224028cc55d99278f6172dcd59dde0305b67793ea09a0644ea2f97f28267ef9356d6e8a173557cf7941065a95c26e04b7416d7e8a1cc07c9c207eabbcd7dab7bab75b3b15f2f895a1bc79f99288016bfaa70fafa603ecc363fd06cefdcde1c9715666ebb6e60037728dcca35eeb114ff4eccc44f602fcdf430f9d5539739c448fbd5e1f92c26971152e2a321cb1c5833a120ce5e7c954971231b903a4e6806d2d7ac7a4fcf5102df4436c4c9657377d81c4deccf63cf0aa90c0f9e8d5e222d816947f655a4546a2878a0b4e5ba0ddc6585caa55d4a442307f3ef8c82f51d506aab07299c63155b6a90afc94ff9ec7d18786a3c8fb255d0b0ee6473ab552a06c22ace42c0dfda14f91c4d29ca236114f889da1fdb406f67ef9b5a4c633cebe9748182ad98ddcff877bd8ffb9dd8d50efb77929e13bf3d336373221ed909bcfcaaa88201f01aff4ebad99372c8e3f5c6eff809df4ef42d1fe3d8c8e615f8b918d167e494b3f3a84405daeac51a2fb7440f199f4392d2b60751973760fbbd740c2333eb79d88fef8f63789e163eb9b564e214713f3552535cca778172c37f02917a68c0d68afeec2abc1c6d22e6516d62aab47cef166bad2732f3c0139888233e65b31fa281e5736ec07f60db04290bfd5d9b76e283e3787b1f714f4924467a0c15db0754662e2dfc9bdf5f84a1a2b95dad2925c06b119cf48591c55291e489ab9217037b6cd91483149813b2ebf07ea30844d6b3d99df66c9b0adeec05319b68c9181d86da055a7c935c59a14f9dbada204d92ca027d935e9f364ce45773e4695107eaaefd90a57f4e0dc6b9dc4f07b77dba42ff35894d659037fa8469b21167b61a73a178a24cbb69493b2f103efcb0e469469b494a30060d1d5607176096cbd5ba9d09eeb67f284fd8230fc19a960a3f39f1b81f02b58000efbce5d6aeffd676c8c21015aa106e57176e091a6c8ef9bdfc701cc5cd39c0e767d4c8a1aba8fc9b90b625f10c36cab774fec527156f6c4413ab9ba0212f382a78bead70b7777c588cbe49daf6945c12c3542bb53092761b0a7ac8cdd36430f4c8abfcb98d57babfb05034b86c1e7406f986574c1f4eeb0c241a84719faba19e7d8ca2b94523bef7a95eddd3e4dc2255691e3c77b10fee8f5c55bbe676289b017e10837a6d5cd735065df968f135bf3124a16211e47bb20065d8ca17df8fa31b1bd0d42ea940eb45b90e585474362b48acb2b279332899f0281113e8b37179165e86a4cf72af7715ec1434692072b45f8715fe2582db211fb5ad160fc6082fe1635cd791a26e175b661315b788db42a3efab5f7ab0c3f53fe1b61784ef50bd34d8897a8d63282c104d50a971b668fab46fb9b650486193c570f1ecd09194955b16597dcd1670afb7a9de88296868fb3f6a1614d28a131d7f91e6c804ee2a47e4a23a6a53d9d55b65276fb7ff7eb317b5d8d1e4e8379425592ca43d4199dc8bae9e74fa429ca2c14e863af8f229b68fecc5f586e636b2357bec5fe503ce7e7cbee296fceea45e9ddd959b08fd473a396305ee6a63b002ecdc823695fe877dbdf4298b70f0a34bef89e161b51e8bda17400bdbf79dff24ceab8ca5d6b3d216ba1927de595038481a93055fd43295d0601abf6224ee3aa7522ed79bfcbe71f790e607b04e73d988526a4eb1be56f4d459398132856a5e73aff5cc78d08b615826909595e256d02c2a76512cefe90a318cd5fd8fd79f49ceaaa79eda51d18ec34b37ba56f68dd8a3339e05531fcf5232209fd0a32b72471abff7b0d0a30ba5a33aa40790f5f4acf3b4d92953ea7450ce37322318d714f655b15abba2722ddf41fcb69b1a377f3e01c33838d66f1b7c785d5ce8225915ae7c6e7e2f5186409ad5816f7d975dfc0b7996812bf6855d3ce856823f71dc4f068406e9c165da2bc34490da0cc3cec397f63a682f3a6278c5db4c67de1cfb944bad01d74c1f66387f3b84e7222900125ac66f78287ded54510ebd5b844e0ee18daa60552497221130df09144d241eab22ea474d383645298051362f84f0e2cf1f9b57c7e279f9cfa63e412c0e00eded0ad6264e586213166bf28f1792c77494b31c25452e79efcd14dc78b8001eab126c894e7034051101c8f5a3c12f58c43022401f6d2ebe67391bd3bdd7c574958c9878c3e73b1ba1215972e17016eef55c55912d5dd87a6d6d3d28153d4845161ef4b0b6b07c7267a5269222abb3237c994dc6e89b92578673216358f8f2014f4016223756bbca82def831479d70b1ee56fcf48c9ba3e3bc5a534cc6c5e981b4749d58ee72a259dc23c1dc6a3927db448468f18e8b51398b8fabfc01d54b7be4367c6637b03a26b78a5207bcde255a6e2e0be559f54732fd0c76fc6d9a2bfe342fddf1c30872cd9a3dedd6e4e979bca107facf76dbae8bde34e334f19d65b10f83d6bf9af987b04f36faabd45b5ba94cdb03706d2cfeb23958a4c2c994ac97d0bb2bd186ab24bb3b4d226f6ee9f83129222a7ad0d2c19ca83f0049c682e1772809dc2de76a928e55be772e1216c886e793b41dfef56afef259a5cdf4faf074cb83690ce4494b4521f0f9beecaa35aff581e0f1125a6e745bbf88143940b77c000f9684efe372106fb6c7a05de0326b5e9e450821a30b11d4a1b4215e3ecfcfba1fe1b2eb546a675184b19d989d95d599860f83f5db02821ff18b23403128156406fc5f0ecf5c911d3862ace8d24d512cde7d98b7821f2643a70914ed93bbc738691ff98fbe2d551f6dfc0ef9ae38fc92ce8da3e12b02b7ac7515792aba1658cd7309d04818e0b0bc7b5042fa84457e6d333f382e23eadcba4a09c7c4394ac61fefbaeec6e3b7486d87838f74533dbe1718effab48459cc5e18f611ab655a30696068fc94fbe3b8297fc9dedf6dff7d26b4bc0c6ef08ad4414e1f8587b7ef9fda4b796351540a95927fb11916d8a8287360ef5824465ee88e38a3b018f1cad192c5671db03c6614de91874a20eecec5f4d00efa6c2495c1ae67b65f129986e5f655110a35495b1878c4797c6dfb0a7d69e31b4b31ef83307a45a8e81f84c48e9897051a94b3688012ba4f3f04fc28dfaa88cdd15e1d85d2628e0870a7ac50dfb0acf5891610712dc8010e3e39415ec2bcbe1bdc840e1b7ff6d892d1a8c0deee756919160d5cd57c24dd70f9f1f78b5aac0b80feea7e998e2bec5509def18b133439d83197cc8600c136f33b8323389ccb16a570ca5adc2c7903504c90c5085cc88bb2f7083d11be7918122899990b6aaaf35fe8e9835e0d6d8ff1f23b42b1739dedfdc90d359eee0bfc0eb5584b277342189648dc4d143f259c710699c9d4a53235368b6e4699d3971c79d64a10c29cbcb3df41c5b7e08681289047f07f38120c3264cf2bc3c008a47a769952811299f67c2651af42f1922960f561de2f469075bcb66eb3636da4b30adef7226df1a816c96e180dd62ac740b4f5238b8a6f719029a51c524b5fdc6b38992becdfc91e8aa28983ff569427d183f3c756f523205d814c9067b60e8a422c10fc0c2acfbcb74740f667220a72405223d88b32623baccaa1ec3161d8d36f0318ded506769c6aeb9e5e78a317c05a617e6697f848e1787b0dc35ecf9f6c6955faacbcf553a84465ee69b41cb54d152dea7a8fd89c7ac4d40746256d29382d1660431ab51c9f91716975263fd5f7e4237e9b7ac7d82ef89d0169480ca05ee75a33a6e47d12d5e7b077da25bdd6c691a64a2dea0e180d25bd29c38bc7cc34ecd280ba1177355549b3548769f15946b91141014f405d898b8e36379d675ab446689ef99b9882763acd465d31de6d0a7807d9893e880c261d86911e0f2938b778882baaeb433ae19c3417514b655cf968d188d22ada4b09b9da86bdc9fcef1771a58f1c1ed77bc590542f3c5035e46bcc7707ff00bb3a66faaa6af9caefab9429a157b75c0d3a0851a882a7a652382a154bfc86227e574c3315b61ab90f6989f79ecdd3f44dfc032d8bb69c550229a9c731f012247457a4f39425875a0f1ead6a0e9a4985e54a0b722aaf43457393261635d2633daebef79f5a446d122991372090bf353a69f083a2558987bb193ce311499326dd958e29c75443201689940f1a1335514e82cd93150558a2ed186f2e73216101ccb3f2add2ec13036363ea27a70df88011b3b20de4a9eda9c771eb73796ed7d4c0cf60f5c984b25944df9f432fcb6a6e37742e7862488e5af8cd81139a9c708718c3ae00e854d8e0273ca7885c4e1463d6499de5e715eb102b5eb1611e4355dbf52db04c1a6fa95a4f7730c9b38b4a8094af52f55b0803cdb8a1fa0211d375195bb3194525ab732ae2d1906691b5dc63394bd1653f94cac5128c05e4a7de5dc97b5cd4d070739939df4884d8cc364012e1d8a39be706974d6c9b34683d71b494ad1f6dd1b47ec41380adee4777272b7c652fda7a089259810e7877d6bb6ff90fadcfaf4cd903fdc9d4018e339b1b3e83a0063da0c2ffece0a5bb61636b59476efbd178ad3b6225c4bfc59f8383fb86ae35a5fad38f2a44a1bdadf2026bbdc88006d724411b4e788259d7704fab55d5875eece8f2f16622375cafaf7556179c0733b37d207af24a2fa1426de302c597d586f01c74ad9c54111a3cc13761492bc92a9bff6709fdee96e26a0dc5a00094610651d0e5f695895fae8d13201a2d42f846309229140f043d0e23550e888702c09a86c25769df2b9eed875c37a5649d5ae45d8dbe4ca6d86b95d486eba4f822c5649be20c196c65738899c2631778203f5a5652e28dd73cce9b737ef0d1dda7050025422d3001a5135d1dda2724f5fffa2d79fcc6b33fb50e6324fd50bd23607773d8739ccd705a2f5cd4bccee273f373940b462e2819e3779542b6e795c26f6d942ec9b5918565c2011507d3ed93d6fa5ec31d4241f3bdc51a13d555bf1497711c20e5390d15caa37c668c264cd901ef462dea1553a227776cd22ad83972e6467973189f7b5a85a274a07420ad1c54a08ca0f8e510da9ce13ec20155a5a98a77c6cd8f5bdacee705b85cb6596c0bd3a58cfff221ea610cc7bd21a037b27cc53e3a853f1fe21443b6abe78ac39aca9ccdb46253a0534bf3be126daec9e3c9cf9872637b1c5c87f0a96f5ce0c07fdb2ad2171a310f77b05efe98b3cd6810cfa95a7714669f1c63452f841a84fa9f829b759b6c09396a48037e2cc8ff6a15ace821496c1bb6027c1f6b2f7298cab629453aca6b21888b51d4a36cf0380469cb0060bcf71aed9228f93db032a3641f8b14a6a38003aa05e0dc31e46ce12696caee6421d91909345421d0af5f17b0fa46df68ef68ad80a59ffafa583b30554fc3c63f6ab90b88e643050cbd0cf935757ed6ac23371bf60a24417ff2e75704e5be212208dcb9be784ee5b70627cde81d09f1956f721ea5ce9ded2dabe05af60bf29ff48c06bb66d690187567d40ccf7bc5b6ea9a0da273bf40baf94277c64fb767d921b5950b0c287697a6ecfd9a4979da7150ef3ac36bfab59c340a9cd35d10519786e4a9e097096b7a0bdfad17930aaedb44bfc57d26fd722108dbaada57fa1b29a16c6428af1d0eb619a33d1c087c91ffa3cc8c3e34b2be17cb5c9b6085223f2c6c0d22a0bb39082cf35b1c5e9b6118ab42495a9b49375223c165413c41a572ef16862ecd048949db452692204dc7cf38db67505546497d1a068aaa9ef9b899d5a1026710c1e683ad80ac25f861d56f21c4116049866e32488e0802de8e7427dd1093943c3e0eed1664b847314420e84f3f693748a0056b9acef3b207e463aee8047ebeb6bbc7087faed45dd6415ada9eeccc2ad9942685f91ddb380650e142824838ce145b5f5d65d26d5d6fd9d101ded2381a2d3144ffa300b825e44f1edd5fb7d8bce3e95cafddf58187e7bac3867fbdfbc1300156a3f003f8db451ee502e001dfdf35bb220758abe8ef29726137974b8776729d5019fe388935e60646c3350183af8c1680548b2d5bf0596fb00ad1a713d8906460be36830076dd484c862695522e6f1a558f93b77668884adb02659901a3f11036813c2bfb72063cfaf25ec96ba77fa3474792e606afffb440175ba62c52fbd008e494a89de2968b8ffb0a34edb39f094c1903a0c3f5a65f20b1c64e5a799b2bdcf93ab387e5f4a39d671e7a65c6217714e1f5c4e554b4ad431fa14322b068d8dfb7e8e6cf678d7d05f2cdcb61c195fe34eaaa0ebcce7c986ece747a4e7bc269e7199c177ac6ee4784083db755b56ef172f67fe033075b75301db75dbc17a1fb0097898c178672f7a574634dcd8399a2e3dfdf935378ed711cf8927b6aa86baed8d017bafceb69e11244434448156677ec9b68ba031d6578dbe3bf89d531a71df5379fa84365bc59ef563cea6683d60b8bcb05064a9620fc87fc972c6f03a4327f66c22144c0e37bfa1b6669e6561f14bea09ecc30be7604048c0adc9ed4158af9e0e916f1f657d51cc2e17bf42d5c41dbda1366fd8beeac612102565f43dd8efa8e0f9f386ba34138c566d534e9601a37b8deb0ba68bd3e912ecfdb40a676adf7666bb0df544c0abb3aed6599416f1c647301720783f7fa0c8533f10a0df8a846b5bc76b84b2dac9211754daf6318ef212a70ca7391560395796c5dd55b5c3df5069c038461c8295ce997a57263d7369a22ecdd578fdaae0a9a657509947200a3844dcb8f263ef3be3e2cb9b92b39985ff05f681f092b14347148015b8ad0ca8858db4e68fb1884e8cca326dc8ede310d0c406816e1b616463e01d570bc37090dd9009034de8ec58de19ddb6a6804c5f33d44a0246bc507a2a00feed20931acef34f5142472993cbb14958837efd1aec7a991b1bd676ec31457abfc4c72ceb9d061b16ad1d5d6ab88c3b105001a273657f52b111fcc79adc121983ca48503b794d6e5f5cbbb74b8f87d815c3c2a3d287a1da9030e126ee82454807933d389d9ad57a795b2398e070648d99f48cfec8579a1cc6d8d9943058b0d4d60d006005a35e952ec775adc7660a00e1b5f9703100975da7f3f1aa0998a6fe35e8de15c8bb2f551b53b84a8e18d9f30a679b5eeccab43ba9dd4c67126c43e40c6ab60d9847dca2bf3d343976f4e37103b6de2ed12fa9a4c3e1343e5ac9d16faf762e811777f68d7fb74c7d77e0fec08d18cbc793af7d1270f0e693453e41d26907a1ea666e9f3a312fd60b3d70a895df4cf949b86557d7fbdbd8d26ad7003f4fb3b36445c621c4c976ea9b52e11bff9fc253204541fe816b72e9b6eab5e84ad11a33c8b73114db0df4032f4f10a701979896ebfc7e5a091e06f8ead247fa7b235843fc3144dbb4acb13acbc8a6686499ce59f2ec1ed15cf8119f6c926e4d2adb7cbe568d20e08b1bbf164be672fd76761194c8efaf22973d014a3e23d62c5bb363c888605bb584cf4ebe09a3cce7592c48f49ce12d44bdaff29585f6d9719562aac0643bca50f76873ead9f2a01746c69f34c0792f66e286a43a498e05bd111cbb9502a5e4575e4d329133d384df0e8c92d396c85cfa55522ff31fb81779f78307fc51561e63fadc93139866fc19f4e2f566451e772f804d32b5155a618c14f2df9f96abc51eb6e2e526c90d802f0a3c52e45a4092a9ef8e2647a3ffd44c215f7f793b1b53bcc0548d39e95334c73fe791cd8ed0608ee8cc103749ebfd0ab29bf9bf27a5654b6584754440f0f14c1482a596428837d1a1c77a6a9cd9f4cbab771072857e4eb0738c3271b10122c97f30e22f44f0e6d4ef00da55a0697676504d915593689174f5d9b921ed7af5bf23f339e7676e1b9c64eac4dd0a7414fa0ef952102a25529142fe84da79b6ec779d1ce4017de2b32d471585ebc8ba0f536c61df73d0c07b1bea8fad00d74d63293a76f6c4e380075c660779556b5437221576eb0b10b715aa98015511c0ad042ae70a700f56a301799c713c653c44deb897893858128055250f39760fc5c4bb2188a905f6b19057b662c682c99fc992b855f5d2840627ab30f52d1cad6dcb63996b3d4623285cd5cf118ade68fa34c5eea96c9748b36322c77dbb7c105285c73312cbbff97a77ce90c8625aa3efb6df0e75249f20ee691b09eaab42c05e9b88de034a85774998c5708a4b0f464a92514255c3da82f3311e02552a73f2bf242c52a1d4aeefb4d46e9ffacd722951f865b108a62ec8505b38cc74bf0d12ec3cb54335cafe5b093e6677563bd93a855dcbf00d8ba70f319b8c252b06ec7b060505f853de6a0d69afe6069c6becf7f32326e3b9a24f02c28e753ed0b552213c4668befa8783364cafe93b91283c9377c95a3522f521fb8e3b5f75911b5ea5c5df20f7530f0bccef44c49703b391c8e448aef605d48d02b72bfdbb87921bf4b96e18531647c7e1cccb1a2db7fa899ba4eeee1201b5f215d8edd49ced8f7c9d9adbac6889c0ad1549e748a10bc59a66f0dac01d9bc9ecd42a4af420f4042619fc0f0df3229bce24c947138202c801e4e55c53f2d56e695e4f3df3566100c7274c3aa34560f27a6fea53fba40f00261aed3cfe5c499116fc0dbd38e50f94a9a4c10a158ef19f833ef6c3d4b1de329fc87c85e3afcaaa295c4209dde12d75f7a6b501538d30829456bcc7284ea24007d169deba505d76b968a80b7d918d40429fcd95d4e465e44fe29ea5f47074edcfa36d9f7fc40a5319530aefa4e1e35960fab22739b877659cfc0e1479d88bac966983c5ed32c06f305cd16ed4ed1f885ec8ee54a0c3a350b2c1a58f854a39a78bd1d1be6190015fede92130f1eb49d5a9a9240738feeaf611b6b94f266657ea52d63806710402e4757eb6cc35c67dd7c53a5553346b43119110aa51b8be6536b8290df2e339dd606a7f731d2bc3de6db6e0967d6a1680288f2bbabb057bc948887691bdecd1dba2658a0ebbfd3b2abee80b5ce86481fb9611aa98071c8a55433c02119d9ccd4c2fa5452b9e7b1fe2b2d4df3cedbe596509440703c694c6e9b10f537fb982f84062a2928837e09c8bba25fbe18f877f900389e03b59469e1c92d48b5dfccf7e598e7bd9fba3ce0b7b0c0edfe762f1d6f8573a941fbd37655c4dc97a845d6fc2310438c19d3c637b5f60a3b9a25c8647c8dc2e3b6cd586f9b10a887871544186f504b126ad5d05243b418dea39094ad838ab36aa1dff74173204469bfcbcaa0d08f5a5a687897f4c835b916317ed33d1bc3a7da8ada84cde3d1b4bacfbb0a7a60a0fed8574a01bf86de29f36105b54f551222383951bec4e3736f461ae38fc2f7462fdf18ba5888e4a45bd7a8dfb92a0e4e76b0c9e853b8f774a6ec862f56f1440c865dbf74e563af51e92a239e605d7644582f065e748bfb11de91a1d918c4985da214e559fa233aa624e3a38a21df9da81f53c7068c3447e3ea1abc78895898a50506c365db0419fcf2bdd9d2ed95fff882b9603cc234c3f75ff068e197977b76a3427d0c8b55dc930f8224b66d28b61320f5a1bf1d9c5c6de86c969c62d6c24f10859ea2bca9ff94e856b325aa5a202c16c4d3084a70eb52322304627f26142518572482d867f7b2a41994dbd715a37c5998f8050d1021deae4b70ae12ca17ac207c8f5f3a00b2eb1eed901a591064eac553e5ca5537d451cddca2ed56df154b1be6905149f68c696fdf6f4351925ed82e112d9a8567aca6a0a5f1473aeb9a1c3029980fc79b5e14428abb878965ae2e869f80eef356b515b0f941ab5528679401fa32154e6ee09029183782893a4660981bbf0b41626b1ff22615a4ee562770177599523139006aff510689460e4fa1ca7b56bb71a962e0d35f2dea09e3358eedd0d881c2085cfb2d8460ffbf7798ada86eb3aa11ff18f49ecf5920806e5b8446456f797996729a5a9598df69934676f654824e08d26ac0f20988a924421403334ae6e4391ce31e58830e04c38505951b3c05fd0aeba18599dbdfabcc1979056e3d09c13297715d99aceb8e210264507514cbcadc347f99ff72c808aef9634420f7f0edd215429205b128e4c2e2abbaf5940f71460106aa94b34a06c11ca70d84ccaedd89d4581714604bf81e26ead0fde7a153a236d7d25aed6bcb6b17ce821aa024db4b89d137fe71bb0b955cc6829d4cb51291778c856c02a204f1ba82d9b921fd9e855945b295f223c119c2498b7b043ada6c56433472c4ea2a0bf7f25e3c6c66058de4a6012875925be49ed5a457afa5d5926c5276ac1a3cad95c9127addefb5cca6186fe57f22a17cd34f6207e57a1c7ce16a8478393226fa10cc231669cec200ba4fbcceae2271e86923ee0af2b40a400bc72d4baba50c22aa0e3c14d4203521f2255d1ae1a0b5b8d543bd3bb0ab51bea6581b84ef8d97c16933aa85a3197a11b3b1de8be9bd099e9fc3b242fadc30d255348817b158a6aa746337bdd585cd13c11ed35fb1a359785afe69396f263b32b39be1975f7c98088d16637aa3ae551e6689c04ff09cd4be689dedd090bdc9be340bbea74f01ff1d255af44444b0871a34a66263c83057aa1d1763260d885e9fd98783c0da69c64fe31f853b0c055c82650eb540a585cb950b52b98ae27702771deb203499062280c01239ed62954b7e29239cea5a2c8ad4d06f2e16c265b131f69468d47bc4f11f8eafe906863d89f5330fa4c429f754b22545f611eb4ec5468715ea276ba776dac1fe4eadc8341c536424528a42550f87c9d357f243f819f8197e06344de69247c031eed04801e0a1afc488e1a09c7071aa8b8d478ee76700c5b5fd7274178e503995f3361ccea0ba9fcf705ecf97af069d294fa67c94420de2cf781ec07d745bd51e11b79c82fb22cfb05c4faa3e4f6565543ea796db37fdf59b3008a533e892ade80284c54970cdcf495513de22d3bd16f3f3d7de0e534f767adf002fc1f77719bf7b83805b73ec479900fa25f0b5000b7d7182ce4b7721e0d88ae356e955a3e33069f9f12b42f85c380296852d8b328b777a84b098b312db8faad4b5940d17f078f760d23e685d25137174356ff83183efe9cee4f88dea80445d49bcb341a139082b2a04639332e7242212eea27273d882683c5a97d0c91ae0036a906bbeade865ec06296b492b9773aaf3a4890515aa2706c322427872d5ff3dac1124ddcf35bf278a119657f86d148987d6117808f40a3cae17bdea73f103774a78f0c60f49cc241946385b1f77a452c5eddef1c924676a014b8029e8d4d8fdb4ca9a6bab1b6539bdc34bb3d7be2a5ad5527cdac0b8249cee00b48c23010a34e58731d68cbbb7d5efd3448c78681e9fecffe60fd16d45bc9adda925dce3c77e0d7e5c36d618de4d4e6c17be3d4331135a496bf5e42ea0872fc334b1ea2aab73ec23dd0d3439bcc330324ddc5b7484e0e97d5f02be9b5adcc374f8056039d5197eb0ce742fbee783ad431f4924016ee5a1db4df5b597e23a60d1a8fcba5a9fa0d464f7a1d0e469210ced77f1ddeaeaf44c7a97dfb7e8ce1750aee56ba0d368c121ccea9bb401777ccca43674dee2f64a84839a56d07d51eea24e239938610eb36ff1b12478634e70e6d96cbe745740acc460bd7ab61d87a0570041ae988542a2ffe6326e5eab5c148bbd180977697da4855f0843353f8ab15883caa0fa9b68b133f29a81ceba7150a0ca2b476e4e7baa92746e15df147bf73fc224180283bb1ec1435035d67fe781e2ef2d31645151253e3653082182954303a7977d786169c25b223121e21203a0f166c1e80f74b0de361d2c598f30cab9dcdda422e01d5ff54468393fc346b6a65ba237f82dbc3080c1ba643fa2ddba126f21ea817e668eef1cefafb26d8a8d8ea68f0993bfbf7dfa98537797658961683d22e254a7047bca8f10f55630ccb3396f1e4cf2b1a8726837f17ae9bb1bedb475c8787db2a0c7499b0dd9f3ad700f44be17ec92db82a350cdc3e68eaed8c0d495e40f1f688d1176fe1b7ece6526255a56eb5a5d7fa1e4b8e4d43b53785e290f2fa8454a1722a44c5d13be78548bffb22b4dab6a0ba8ba6ef9938ddba4ec9da1a630f524384ee23e75da65d960b408efc6e60219323e8c7d138e946cb07a6c451b86d754179877c050da88e1aff1bb830c52b234cccbc71caae6db778971bb640ce9c634198e1b971ef9d80fef02f78a24ea94dc3b69144655f5db1e53546e3611e61e0481c9ad7dc45094f7df49e141f4f66858e949f148e88d8c0b181c18d1a00b37b3d93e022546e0d964a88e6badab16da94167e61e08bae463e3d11bcf6d48869e042896984f96afe5e7d1af453f95ab7f97798d80a07bb25f657571f59767e8fd023bf01b9600d8fededc09cd73f3e68977d5284fc8544486eda117930ecf2df105691d3c23fb7d5c4dbbab9d9e707b5fbe353806d043c48b117965831b1e12d14c53849e59399d568557d729949109ac7b9d80558c3e4508f69953fc2a3fd2279c88b68afde3ad6ed82ac8a9a9367e8e9fe023df2182376ccecaa7a54d3a6eef209fd5808ccf2ecb2fa270ffc3bfb1c6ccd963eb74ec33ec84c7fa2f33bb20b69fbb6bbec4ad5da7628908701a9c87e4c70f41a85db9e733671dd8211e511c6dcfc03e894874c971594340e8e08a23cfdb65389ed42e373e2ae6320a7b3ad5a791d0d589a6d913d95bf22020b95b35a4a157738dbf20fac98d21baec64ae2f18e52ceac2682be2f07b0b30e34191e22afbece9864d268f602ead43a605f46df5312c4a557d2087e3b409895a286d7ecaf122846828cacfc293fa58fd6904fa10f066842b436246417b8697f52759008e588428b36a04a86daa76f531461bed9187a554f367a390c13769fde900769d4f9de6a503cbe3708214dd57898ffe077e88a529bc011d8fd30ce3f3971d87830ca443a7e9dc195a1b7844ac2cefcd27a4b8f3261e511e80d2706dc56242434744b99f8d99a905726f699e5a5653952fdb9f7fd3ff84c2cfcb512eb8c3393731e5ce68cc8c2de3d9e2df975518cae24ff95167c76d18831e78564fe30c20cb314a688faf01d1d85d1266a96a562162dba2299c69f953ba84d4679e1aa6039d1e6cadbad14451115ebdcffe8a89b50e64045496090e2f9e87ac48cb4496d8853b2c74637bf2c83bd790b66728c2c09d74075441b8580ddfcc5e264a78e5644c52c6f5854588123d6e0a291b1fc92edd3f8c2374e83528d62f8594e29f074c29ee0b1565bb3855fb3fc8071c35ba7dfc6bf41d0ab095040a88a4cff1e70e11098eac1c5da0a9acbb7c5a8aeff10516b5997201d2b446cf8b487449d534ebcfd503d992bd4b3a726fa72e9c5733bf9a3ed27256541086059cec3ece1134e257ec510eb8b04ef46d624d85bbf030b59e0379008bb9a89e0b7a9210becd5bec7b45696ba5d54da18d0cbf81308154c70cf862c48ecc367e3967c789b84513305bad2aee560549067e4de06ba9f1b340aeea89e909d1c1dac27efb970b43e9b97d91ae412d861e4bc57eccf01b6c8c51cfd1c8c1fe52378af756fbe8906cefb9ca02cb7f0da2ef78380e26f0a1b962cc3b48893586cb089893bc2a6390ce7f2c0b6707c34f104d691b5241306bd822843cfb946f05fa3b9a095aa0b1c1ad6c1a93501bb7f200966b9ebb796d11fa0a0c42558f6aa9d996f474cd425f8849798bd27c12564d22b36ccfc40e438ad59109a415375d78de314ff216adb0f32952f5c4c30cfc2708cf684d182a7e88dda606ba39b7e21d3bd371f5526de0ef15cb90dc092695f34ceffc11741c8cb988aca284fa4be162ed3655209e1d7fb37e31578bfb13fec1ca79cced93d45fa5b08905fa582f2a4a16d7a5f827e395b083275069811be1b83be1bced2f0f4a4ecb7de8d2935512500d0949eb8d260903b6c50afbabc534b8d9a06a7b5f42a38bb8bca3bb7ebd96b90ec8210503e0d2a4445a8cbc2e5bf23c466c4e65533dd19c5775dafccd9d676db9fcee482c26005bbd0c1b79fbfc47774a57e48c771959e82bbdfe8430188924827d6baf542968369e2e2f9a068ec10793ca7dd113e54e53a3b91e7f6f20be62764422a48e4ca2ff78b7b93fa4d1bdab994190daba935fb11300778abd12708681de163998146ce23ac5cf30bedf3674d131abc694a479a7f6781bbb41de7668530da6a4c67618856dbb853f29fdfd8b21b74c26ada5999437f6e0a0e8b380f769a089eebceed9baf70cc23a97b64ec312f13df5a139705f827ec427ab94b530b5d0f375efe4d71aa0efc605236c2ae55cdf9624078fa45c6675103e022e0f9712664a801fb009ec149f7d78c59ff7a9fd022ffd7aea97aca733304fa6727a63f040edad6f5be3e8cabc5651de2331bb700d688317476bc5df0f5de7af700bc93be0e3276f8d7b8aba44b38e04d300f5c1b629ad43ab6b2ae8ef7c5b42d96f919a0ed78cfd7a099fbed214f555424d4ae0dac32b824643f806ade7638893bc66f08f811ee80d4a0eb74d8074039b65f6b3bb3644b3a3d1af55eb17fe5ed79e7a8b414cb983b92fe487285b1873dc773a3305485a429433cc1bcef9f20430232bf91a933d0937a82faa086c6cec628d2d74f4c8a4ca2c8e86ed9fafc51e7330c5b917c44edfd4daea8ab9153fab1d8d67478c8c139c61f0268dc6c8edb11b839eec4dba1853b075655ec58e09813c00b8b7ad74c9f5771a50c858815d413fc1ef3298559ca41d53b5d879b5d89e17279de050d5e9ac4b0d15b57a446abaf6b376cb7df7a4a8efdac29ee892c8f23db77b46c2523e899dd877b33209903cdd65097f6eb2b4144fef9464e564284007cef6eac87b661b0e1cb01939056b5944a4f5756519c7682937bdc7791b20eeb3b40202e099e53e91fb82ca367212d8a54c54a1f5e048a74040dac627e46dafbae539b7c2efc6e815caa85e530b7b14376437a422255ea50c6e26c4321079a66dadf39aff7cf12550236367417be251ef7203fa6a887e8b2afd3582846350fd60c974370ddca0dd62faf8f7b2bcf0031d2dc4b145b984a6ad81527337e67301f1308ae72253e23adc1bf7915be1813c54d0095615e73eb835a0882e974beacd864a336c14ce311aa2887222371a03c27493c7b81336f525c56716350c57a76fa67f42d741fd0244b74f475655e37d446a8de2090966212fb6c98e1f969ca0373e99b73b5f738412fc212e9ca39b791f7bf24796745e6ac32c0e9b1a66a7eabe716bf30424864b674f351488c33513194c43003814de561db89cfbc386941f8a4d5c012d820526c5b17590a747ee4a60335b9bd0bda5b9a249bb068288f0a35e039e18206d44e3c8866c8066756c3725e73918f939b564f232f4e4a4b1f58b0cd01250e089b65c706dadaa18b634204bae2b4640d9799654bf68797cc67f277599b2cfa8cec3386715fc98f5c85ffd49e79d1e0dc7b359f8f71c50ead9273d4cdf98b6cae6109d803bdb5f1954bf21f7c7d892abbfd43d8b24df2ade0c529d09997f465cf6fabbd36b515f2fce7476997e7d08029194cb3d3b07aace13453686664e7baff731cb711863749cae7664c7d40ff3dff5894e5e85341f32e5d4ae4596f5bdd7bc66c705b4d907e35795240373b1130678458bcf363f193ffe08832f22914f074fa39db8261da4dc7166fadd61022e75176b26ce3069daf21177d5f0f2a12aa536f32b61420b1c8130a6771ae670fa39f1e719e65397f14381223b3b268264253a096b7fa4d392ea6e0bd9f086ad1f48639c11efd9b187d3b255b5883148e5e82be78835d09d05520963f313ed1a59fb29b6f5f50dadde5a0aa9da1ea674248e3b66520204d15332b09d90582ae3485e0ea657124d6bfb28c87b6738813bf53c3ad59d051b11f8be8ea03aea6ef19936ce728043a7d07bfc1ed960fc1f4127fabecefd6513b10729f4f3ca21ea52c413746b4cc516d213ff732317b2d1e3f2ab5d453e2e31c598105bd8b5f2f817794cc527f4bd23c75951f0b81ad1ceec4488c552ec3f02262ee5dd167ffd35162cd0ebefa86d43a142ee0deaaa88e8a7843df39da49729c375f22b49319dd78afe3dab95d170a12c24f2c943b0131c6a104647511001bbe8c2f7673011d62c807c618f142f05a9973bdebbae8423c2e832f423b9f2c53be7f67a62346b0a12712fd2facd4c76e2e99993dbb3bbb5d58583aef1f93d9de5f069ede8485946c4c226e535018176c67da039c0a41c777cfeff5ba4780afa6b98874ffe983804dac8f3845c9933969e9b3a968c05a6f1fe65daf4414abac237a733c03c5f4341b1f3d05ca2ba52f4e285850cbe97cd27b4411250429c024222e50af2f38f4c4b8f634477da595d28e7d045a9d88df249ac6caa29352db9c3cc5db7526bc9a7318a3a426fd178f681bef4cd27f8257106c1ff9b42392a3c43b829837e69a1cd17736ee6991d8b8977ba40de10e6687932b729d6c11e31e5a6e757c6339b0c8bd86093681b4ce8d394884b46c98c7d0098d44ce65d7dba0cfc8ccd4f007ff79e89fa18eb772dc877cc8d5a1a76ef7298a7c99991ed8030ba41520f9c2a8464ffb9fde17aecf8e1ebbaf5e9377b363a3dcc213fc6edb5d8db6c61aabab4216ed0645422805ab1aa725c89b211e28ae190a53e0de61b0a07bc8687a320476d7a7b3e0c91520bde76ce7d50875fa58d77d207815de555ecd90d86f45cbaf2fca7062e82beaca8e67305f7cc2854576cad7575e94c65a279b4bc0f3a7d69ab1973749c5435ff014bf9a61c4517495fa3eb914fce61dda9c7e93487c4b0f1ee39196d2047b470ff611a8e6ffd3b79a5dd61a2f9019be941f76b009bd71999ba296f30d6e371940fde6c8eaa6916862f18cb6a3e6c1a50ac2d3d6c770721171e6b5f2c4ff6e75d49d335481742663f8ab7c336ecd4c8be31b91a88c8a39f93d2ceda8f02ff6eaac68807c385f8444be10be9fb0c26bb2d2ea71de0c424251110ff6c8611e2f48a33558fe3b34c01883903ad792d7e1fff62ce3d6278424430f2756b79a350b3df663dea73d13a399ccfa2cc05342f0b31d3ed5542a102d3e10189bf9cf1f2257d0435b56af1e4f15bf743009d2deb8d37e120daf8bcd648bb286a85beab1993a57b82736e71cc0b9834f9b73b02adab23ec91e5de73efd062d28d297ddc8f2fedd0deb5fe8cfbf89ce678f17f18735f48566a7130253d2d8f5e108ac4b565431886dd8c1828d8956c3e420436605f670c44119d170111d4e736583781ca794ec2f68af30e1b2eafac599109b91a76a0f8faf34b57e9f53ca380d4cb5afa9eb945cb9806795915ec498724ae0a7020f685e71be98d2f0e61b687ac4b3a6e1b1c85c93d4701c05e2b42b4b2f72438c8652aeff8644bb13cff9017aca957013e0184573e58697e9fdffdd8007a8dbc9f91d05abc4f979462c716c60f94e438695782f0081a872b7d51a1e8c9e3a15dcf6c49a91d408374754dfc1ad0ccfbbe54b3007b519eb50a7277f4ac5b2628915a85b590e813656271fe40e49bc857f98f9e71d26d3b4024f0c84a9540f0d673ac19d1fff71a40dfd56d5ec0e18cf78998c9ca38362688f2dbf478a066161d50c34216295b74bb5dc46fb83756bf8bc522ed8a5f57fc36b2048f0b4d00eaa56a9067a465eafed915df84f9f58ebb03b284517959ae51581277161263586080c2b6bb0fae648644c98b9fde2339d933afe3551a64a95d6dd6a603648445b8b295c51c204513929f5a2338392950dff59b6fe1bbb08dcc81b4bb3b6d5a201d634075fa06974bb314693dc9a24abc6e5a63e60cf5e38c54cc3f48563a832dc3ca76ec084b501fc10d054ea619fb25dc091d0bd3edaeb3f91d3dc62cf5ee62a5cb2e02c2f99b3af4f8530769eacf1148981404a8317634bb2855835c82854432ef47df9f8ff7d457900acc9c55cdb5dcffccfbfd6d474480a42fe8fd0cd6a7d7e20cb36cae3a1e98826dc8430ec6060145ad3691cb5d52a09a019f44617f67724568d271e5297fbe7e5ddce0ac88383c82b45ee7d5974ca62b1eed45c34199922ac891b48708c5582db3eae8b10c1ae34ff2ed9bfb3e9d67f90d6d9ec918afb20f31dcc1142bc6909b7d37a4d6fe0339f43b49bbd6f8a7b5d5f852c7fb3320915ef0bdbd92b5de8e6472098ea568b8fc209029f89161988a562adb32962e47e8868c9743ffbbfe9a51b2c4ff8ac98a1923daaf2f66700be2edd0b68b575393bb093f349d7f2f17991ad5ddce335743503447902dafc3b342cd04bf15c223544eeb8378f15f17791248ef705fc330b94aa3d7409aaa3c24f7f2878642f8ffe53eaf830757b12b1b208eda8e439a3d125c129afdbbfed5a59d40264e3f9e1d4f39347c01a028b6ca0e4065de9dfff876a08fffa0a31c8fefed49d33ec85f842f7d0228c18a971922dd5c4aea0a3f08f3da015c06ec87abf87cebab97cde04a8ea23fe61a6ab1eb071f0e204390a10d9e7ebc4a53a0f587ed9fc36f73c3b986f5e7553c85d2ede59a546f42b7afaf5c4259a1e2f75def5341dc0d82ca4c3b4ef3042d77459df933310f87aeed65597f25e2694413434262ddbd04a7eb8f4f6e90904122b468b3a9295e4e9eabec3e136c5e80d2a5dbf71e270b9b6b8aece1b9607ae7a731ea15e147572b5df708441f4584b9db6bd371686297069ca3314cac942f16986fcdae9e9b57d416c28baf78b0a2315fa5db5976e9a7535a81345a34094e5ff72ba033fd91c5aef60d8c98c1b7ed86557fd105a0624423a51cbb0d01207f36fb453c67d1e27aea7320e5a95e590ca8aa414df1c3dfcc3562190d75d473afe80dbbb68edaf08c0f8ffeb8ab939baedd049971c0f7cf41787621788560b7db910806e963d7099d93ae15427ce5816154d49b872b5641a28a519dba8cdaafafc0b2ebccc8feff66d1f75d320a5f3adbd4b3476a9942aaf2b6554946feefeca46e5f79563f65789af4bdfcef49e2726ad88ddb6f6c15f21c9674992cbebf7058f5f3d889a9c5556ae3a74e81b688f9551f2686f3bfdd5cc93390ff2d552019311bdd9e6c3e149d74d52eb0f05efaab091074f9a3ad885de73674885ab9c8efee60dfbe1144529149a8ac667fa927f148b6166e112816c8d3cc1f2a9ce682f366765a5810db264fab6551189d5206f863d9585668a06b72a3365c42a8d55855546a9846c53ee8bf41a5d5a3563f5a4ee1d8fd1fde5ec8c349831bb114c07fa020f044ee6cb7e7ae3c88260020460ba404782e23ed9a0ffd66ccbdb40894e8016cf91741d341d4193b1f89a5038de70dfe60a60d30ce303337d8a0d38459d699dfbc9a2af97837cf0959c343a53cde3b0bc34a372cf55bde8a882e8e4b96a1bd5790c1184f5d9e431ab611d59b20a50930417be792ead5122c2511dfda13421740e2069b9a3bd60f9e63d03eb45958bcf9dd552fd08f858361b93fa0d6347cde407930062ed6062719560f1f263138fad3f2220d38799b5e63fb64e224d1faebb7d4464920cdfef2e9cfe0458360e2477cc201911d9246f7fe327672f9204e905601e7cc76b31abbfde9c2990110acb9cad6116f87bbbef4384fc433532b86ea7f229c9c77891c840951bc3b860ff84f0f4e1daa6eeebc830b8593048ff122dd1fd403347e0237b4c733ef20d38b02cb06eb40a243235ce720c3fda5b1d13a93f3c9693dcc3bfc65c7696fe9429f9deb1ecce62412830b3e86cadb4ecd824853f08d324e4bf3866d0ebf5bf2b9fa95f2961ef4abab489d56e959597ef05a48dea159774c1b7dd7efc7dad39587740c5c0fd27e43cd8c7dbe4bb2bf55ae6bd5758f622ecb0606e6ca4b6e7b145dc27ab6a54d8e920cb32fba387c120a04fe473ac488a4e2adb6f17dddeb601b0522df7bbbf890c44203f926ed3b8a83dac116c95fcad00829bdfcb18d8ababdc2ae6e37c69b1abab40180378cc0d1118b66b20d61860e1b5cf504c2a026d9daddb17ad1acd895ed709fe697c88400a16ed9de8990aa5f65b2143dcd07ca9799d408719675ac530ad5900d4e59d3091b31eab7488ba09113b123f0ce62bdbb2d39be398e1c1502494140b06266e89cb7191e9181d7687ad1a9f90d6614c8e3de7658f55407ac7a39610d5018d48e2a54752521414366de9db8fc7490594e22c05a970f3d3ee9efd3edb28fa9e0a2d7b95a2abe135cb13d0858b3d16e0f585e53b5ed62857d6a420e1da950228f3f1db5dcfa3f6505887d44abc5f03c16f74ae2cebcfba81dffbd117fd29b61f33efe3da190a85a1180ab9d051dd670364593c2d0ddaacaf7191e549c351ad984c26c8015bfb50c406e8d4eddf6d3409dcb07bde14b7f9078c9a28b2b00e06118cb171cc9846f9cde4381bc987d7207641838d64d9792b6088183e45891cca790f2bae6606931e0d52b8d96937d2adc0cd78e5048f968c42579dc43fe22e60b2aba36889a83e8636dff5a4d6be47cd19155aea6561f788054cddb3f253d362c6311e980fd8ee8e597476f0b543854e3b8eec33bc7e68f25fb8bd954ba1fe4f41dc5ac8efb78b5a630b3b2cecf2c132f4d0b83e47b982c49412acbde5f6e2cc831a2a8f84577cc031deccd5666e9c6799d3c70f7fdd0308bb4c6c4c5007dc23e41d0c1007a921c1853f5da57aa2d7654a2d67fbc53f7f537570276a6915773763ec276e91c6593611582a5ea206d3914352dc50c476e0d06b87f4d3c9e0d4937778f7026bd3632edf29a1146dc9c7bc8bf1170bd3d3c2b5515c4a7dafa3b3290683592db8639f09a09e8f37d49d9d181e54161f532b65f8d507343d2143b2f7d0a5a9ad331b979c9ad6ce4a6ef7e66fec563617bcb6ec5da94e283a4f206f54b87bb4f264735e6d27984366e7aa97f65e598a0e23edba20f7c65e53c1a31a95b8db7fc3c0bfdea37d6582a36fd7029c24b20f6de9e67b529d705b3e53d7a188c0da7e31555a77fbe04a893aa89cb4507559b732adeb977325ba0a8ae9cd0ff486222c1c580dc63e1c7088167290e5fc4adcdd74fb99b936ddae02de953e5be383837199e07d868fe26138ac8da787220659ff6d4cd82fcab4dc196a8fd7554369f0977d73676904c801f68d72f64d50bdd44cae89b586d263300843062fbbd7cdb5014e8a50da527cb9806f611b0e0c010037766208bc8165471f758313415ce79a76ff2d6b569b953f8aacffceccbb043d7de829852f43f59d59295ca77f66190d0baddbf81761e682afe9e4fa0eed9f52cd096f55cf9aa57e6cd463f212ca3ba7f5d452cbd9c421a7ed1689b5bfaaf7b399053af0015867f31145a1b3755f339d645fa702ad700fb9da9a2be47d0d3cf65c7d110fb94c8974ddd563ee9eb2de6c65528b76baa255db2cb71b20f6f4164cda7b152fd3c3635b05d7146e38b4e190fb1e57e42b1aa13af2b418228421a9be408ba45cf31e320a286c106f8cc9556db10a0d09dc5f6b54b13461cde8ec1ebfeec911caba145600cbf6e331c780142be7b72bac3e7e666a7de8ad61f745ed085cd6c115d1938d3572349bf832e8f49bf33672a1dc929189df7513d31ffacfc8c40bf8e27a61e0be9d2550706d949daf56094bbd0fc7bb4a6469943d05d89f11ed8766d955995a1728ca5943960cf52afb13c6d5336813997eb06da3dcbfd1a41d58b2b5350780e3d09dbbceb90e7b2095eefbea1297d868c42fbefc2dee016028442ec56497f4a125bbea15c294bc2e80398477cd248c6921710075d62993afcd05eb933928135746f5c7ff524874dbafb70e6b9243df10189236a48894e630b20b99788a77dd0b40607db6ee1eeb9f045c2c7d9e891833208680cde7d43530ba608882ff9f3afffeefaab76447fe708a9502d7d930c3756cda1bd7ae1078f71bb7b86c0ae4fe501747a53f680032cebebfb565ab5e38da924045431e4d912e5a6fe8761c4d4f99ac1c2c4babda493166c3647c1a675d932511a0083029ed922bd4b2b4454cf455e2cab6c5f1d0322d0736bca9350b00bc5c2069033cef12ecf18d636982778b2c2bf22d61103b7355a5989ceae9c0d45e1d7061b565c0f2ce1a6ab42edf66595385158b8ec82878d65824e0a9f8b1f57204ac354d763dba71180627250e91300b20a28b2eaa2c7c42294241563980ca339f0a7b68a78b5208d06567aef03b4f5152f9c5094f778af16f76a8596e3997e8d76a9955deb9e7ff4e12b6c8ffd21186604aeeaa8b669853dc6748c697abc7410bbed8899a8d9b45943752e4112c920b58cba5809d1c35d454edd9f3ded710e3173ef5578630e920266dbab7f483f87c9fcf6de61693a03ab3f41293baffd26a28b6c708576a1e853d0451201b4d7fc0528017e5f4a357c15000c217e823c77adf4d2aae0fcf6b1df1f67c51ee7d8398bcc4810189f3c95b933aeef870423c97df2625bfc9dfb6dd3c5271ad9038a8ccd6f1374c0b83b47b3fb08fb571d89a55c4dc851aee4f9a2f2cc11e133d66e5db09d93b730bc17ea769e84a9ae49d652885fe1273a662751a2cf2cbf791fa028a6086b305c221532142942d927ec073d9b7f75c8e42fdf55d6b36c8ce0c4ade5330a732d1e3498b9b20b6ffcf5beaedbc07c38267649c49ee0a45d17adb4a17ceda681936e7294b9fc04fa0adec164ff899d0df8c29d1cb53f86ffd2960420ca2fdecfdbf7256bbb794a05bc8ff924a55c3eef0645314e404c56ec649ed284197354c343a8111485b71e8aba07a59fb4c9f74f1f99aa1bee1e9c8192007f71407864e4c757aa6d4bbce0a335e564fbe4bc9a5d4e31b858a50383977a477dda3d52e7c09ab6b4e61226e6908e3a3587de18b7a466997cc9f5e8df6cbe636af3ce69822d40c4de05b2fd3c6a04a33e178ecba0af91aa6d404c6d5ffd9d8a8772d4c8709d2e626b5718aa38e7dac5b54e72739da898a4311319eb2d1ce3ce71e119e89c3a6d820b9d2d2ff7e7c0fd79f8a9e7754caeb0310be35333ae6419663e89fce4841145468d5bc04bcedbb6b4dec872f24c2f2dea73ff969884b0c28561efd2beccd50f8665883427fb6ef26f01c649d54ae9d23416a154471ef6b5a37324b55cd40671a01d424f38e4d44e99a07d7e1703c7b8d81e527de04532c7734f5596654b3b3d78dc495bcff885322f11f32ed70282def6f946c9e7092c4e487e640c9ecd73aa096439d181955599174e9514b64f2ac5d02f51fb549e3e29e3311a87eb8dd3b3fd93eefd4bd68440bbbe55c4da8a2bad1ff8fbddd29f90e1def49631f3a054ceebb67658c85e8af331a50935c9c760f29f091fe83a515022fc049c2398173c5206185a21f54add4690802b535129d6541abe104ac3e28cc6342a9869b3707ecbb1121a25b24f0b6e689f61fab54223c2ba2c7005cc157f264bc08d82de1699350c2a2942774dc4835a36275cfa03b992d7efb17e898e69962069c7e96588c25f34aa05f907e50656a6462973e1a48acbb3945b88ca5be03a641827b77741977bf1608ecda4920d6bf80076e22b24609f8e755791f7375a75c91bdb00db64f543d7f3107c8766788990958769c263534b452f2e137c732e24c779acd1612d31c564d11f66666f0f8164268084726241e80f5d310c0ed91c2b4805a84c1c0d70cb07900ad7fb7bc7525a1b82e1510c3cce93420845232abe635e6dffc26d47eef6552b98e76e736c07b373b0618633a661dd2f5dc302852e8e90998d970de2607c28f7fb0e8d3672311c958deac1d0b54e13fcc6aafc6b69ddf9f1c0993ece8973cc5639b00a7d6b3cf783a5eb05d137d6d65abf8e8b61d77868af2a3b2dd154640ee8d58687e01761b048a4135360f203d5c1b8e8bc0d4dd805ffc79acde86950c398c804f3f368fdf5beef64cdaa491288673e87ae7fa6b8d57a94f78f994f46bec4b7182f38b8fe843b0d587abaf61e302e7ec8e8cf7cdbd0dcee0b7a383cc70eb27408d09cf45e058cf7d4b4cfd12729f0fafb7045a55cb0fe3df9d3ea343f31c125c4ba2ed5426f37c8e94f42201a582b0389ca6f77932bf96aa7511913b64de8806b5b6c111e203f7a108c7dbfddfef75b8adbda781802dbcc18da78678449a19af44037f14f89a54e64cbf5fccade6540693e0d1b97d6138ef48b8915794c2cdb74b7722608f140c0b022758a27089996e447b1244fe5da13a827b02f75441ddcd1ceb785eaed7cb2314d21f5e6d5f7199e37d0918a39db89e163a9ed0558c0b5bb962b748b4aae33ad76f2e2ad40f29402390a7e7b57d386800703fa596c607afba057b7780d80a2ac4384e29cb9c064cee5c7044bdded83d811570f622519d72cca178550b5000cbe1b756f1ef216d3061e65b1ced5340d7b55dedc590328ac5e96b2ec357ef7bd9c5de42a6ef1b25b7e3370321040afe837b39c0e2d97fd310941fda0b6b57938c36134c231ebc7c70ff9e29833260e23c742d2b23807b52c456921c81b35251af41bd5a6bfda88768a2a8a57f095e57c1adbd74c1d4b545c36dafe8cb173bda0360c38e2dfe484e601f8aece5b52ad59c4dd12f09273018767b385454e5296889a771d556a4378db3ad431fcde7d34868a24100f9b29d8d247f4ed927dd2fe9fcef8ef1056f0cf95d44be743dddbf704495fa5087e41b44fdf0eb4feff6a97b0c59827f72f826de1379f957db0c0affe7095fcf4615270edbb821075f830542b5478bf9b80dbd7352f26118d976ba14529f10191d203a7e86b29aca2dc6bc5879e6c5dd1a5b20b9b8da81b96283544f547f32303e7e9dc747a2ff08f91e030a50144f809d5090623720d1c250b746dd105d7f2f5a146fe1c5999d9a5e6df155729fcd73a2cb36c5ff496698f77d4ea1300f43a9c59afc62f03cf92f3626819efb6570f58b9e3727b3ead9fa98032dfd1a2fb3af2ca097e3f6d57c6f02971752474d2a4a10adb9f827cce64496b1dd9a31732c5df5b88cde68ff4286ec329078bfb032dcb21eb5a3433f25626243371eeda0a263b2b57fcb2ea83e8afa646e3ed153e1ff9c0354689886129a759d4bda5f55e86ed60f9e02cde68d95f263cbcd418d517bd75fa4fc20b9e6cb214f002f35410d157049094221f79e5885a24f79cd6ab1082c5e6b1c519e667c05bc6c5d5312592ea759b54b83582ab5f3b303c7ce06950a6ec136b74dda7b1742f4d1dc4667ae2839beaf523c9eb3bf63fed1c2ad8551518653dfc11065613624930ed29a34325f0ec53781f7ed29369f1507ce85aa1f729a12d2e14daefc33cc2b196677f82de1263f0b73b11c645f845a209b139073f5a98b339b605e77be4789128d45266c47e9e84aa593a6a8c238b41d8649a7c836f0773176926fd4b2da365b4614243b6e9418602fa2ab05378aa9b46c69d79420203df50af088a4c68300183de0a6b06613fd8d0ee9910145c236ff627ee7a9e47158e526c3b95ea412fe593a8abef7ef6cce9840937a4d955d1e80777f161d784b5c70ebf6b7791ef67ac41bd912a01a29549a1ba2eb04a5e887a17904cf1aaeff5bc82c87a0d4570ee609aef50fb33e7a97a0b905a5b1b2007e4c671bc31ffdba6484c879ba3ecd9e6e7743b395af58b6ece5dcaf195f2981b7407a555394176684f72e6733ca0bed8472fd2905737468ed7f71872a6d0e6c5000191bb66d6522ccd83413ec7e5c9ce29f2c6271f1678429e7887bd374f63f5a5968aa27a655f7482dc7f462dd82d960b48ba9cc94e4ecde910fffa68ba6fa0bf3439052bc03cf49c0df55227df265bc381017a9b3a5c24c7beded5635add34b16a3709a746b96c505bc234794c4497041a06c731e89f9f29f68539c62694757e5dea50e6fbbaa12861fbb2abb18e7e4e450b963877759efa275dcd30a67b330b68f6e04647856b09b1310cc9e69919f8f67dc0599c6d73dee1fb170829ec1e889ced9151b8f870026b8b76d6a8befdcc6d4765ebe0612924d0881e7332db2c57f5c73966673ed2200848690f2a2748b0a100bb94a101077058aa917417d6a182f19ed1db72d15558e3231201922376fcc95e215cdb34108b1dfd072cae648e3c2baf5f78b475b19ab4b6807e18598542ad4015307ac0a66bb0c80c08288e0549da012e828db00a2289bbb6ce93b18b8a7fa8c7ea0ebc620bb7b058353e01785d0cda8712517273b0ddd0b8a25d518fddce8d93a41dbb2b1b5d50e0051f924ddc564dd114ed8c1afa1f54f4f31600c281e190bb2e66f10d9214f879f925a8e7eb6dbfa36c819fb944f6663ce8d384d78397999872c40cb84c54e98e73107216960a55e1cb7d82b0767a872ad89088b7508f784d7eb4187d83e7d5904b282437274c7301744d6e96a4874b9b300ae1c2f6433acfce3ddb0dd6e849edafb49cd45bf816a7524f9930d897e3387fee6c7eca43e0e73dd3397de2ad1e96a5d9a324eff0d0f14ede94286b467105ec942c449f8e5f791bbf2308c3f7400c361ac3f72e28a220f95c1c35b1abf24925e21c07dc73e2f2284a8acd38206b3513edc90cf6b1f64e3546e3bd5361fa24428e21f1e1b211e5ad7d3c4750d5f2d904d9f15a1cff53a06515cbb12389d771e7b7f2ff9218cfb1af801d085cc15e2e2a8aac5553265b39aa743dda5f476f565b581ab6796fb6203d9ffb649bfff084a18e77cfc8aaf9f860eb51bdac370e811cd0e7fd50afaf660c8c4fc0473128be7bdb8955650cc7bb8845858ddb3d8f7709a275d2fca475e3b5944ae65f9b138d8e7023834159d5c7fb1f953e4160918ec73c5319895f53d59de07411fbbe97e27e8fbd5c39457df608e03b06c1236b03b327d4eb6482de0b6af61e384fddca6ad4f96724c2848021c3cd5adaabbe3d0ec07b0fbad706c1311c6f67dd99346c37288d5f412849fc4cede39733aa92b186e8495bb5af30a322c76df73ae50c17681027d9ff433448588f53fe4cdbcb75970e51fc0818aa15a3176b444b8ae1ec38ebbf0aa4dea489221fab91eee9ed8416fa26c2f5a7c79ffb3c79ca81e5df6d5d1889bb2546decbe01e245f2a4607229d111f11f4a01010b74d15f90a4ea57b7ca1c774604596de18e666825d0b753d3f860902bb0bc1b28f68a316658fac3775b9bdac420e9d0964ee05f3b8e68f34e0c22c40269a3a38fc69e17c84605fc9373d5807e2a51481a433ba7a6d9f1fceffa1918b25683cd1c93725e9882b6d499ea0ee9fed57f75f9eaaa0545975b320eb10da64e8a659d5f04d76d4cb622d0c00d09b8e11516222663d851f8c648bfb50acafb10ebd96a6a50dccc52c3dcda26d98127acc74e56f89e50e96d2f8fa0d3df5e20c8182934d7b92a4fb50afb7ea0cc9a39eaa355304b2ad1eee03bee0c0e0629850ead1cba3370fed3c8529d43d37119c74ba8257985eaa7970cbde3db5457d7fe8dda9b4cae6c1c51d926a1129930b231be0158e2503920cffad9d35a43138606bd905d4be283876534ec69545c3184f047e100a4ed361d0b26e7ae74159898ef7b74e30c0a28cca8b37b3734bd3a7cdd9acfcf5868205ca350ea2cc462178e31b24ae3608e3f1592ed14c05833438dc9f0528e4f8f5e5835e1bbbad5d1d040dc2bba3bad4d0c5b99244968be527957600dd065f09a53717ad97bedd8cb686b2b8a3cf3173ecc9bfe9f8ff9cb9bed67e1efd6c593cc706b63ac8ad500d5db0463dad24e79b927adcfc63cb47b67e11ac23e7212046490ece810f5450a5e8c6008c9c63b183f1c07b29778c4de5dc6990b7227247d4aaee1c67b02d1adce438491982f7cc0e374158a1c42be84a22bc89f2cc93813c0520f222c4efc8c427dda806d457d665905e4788a2d7bd31f20487d16fc271bfd62659dae3634739984ee8e38880453aaa3cdaf1a6442eebfd866696a34e0794ad546c85b79ca14c4ff1d5bb87f4b9e0814e9c286c7446a96bc058c310725668f480dd77cd7f30463c9900a9ddea063763a8a7b50069fb2c47b156194f531da06c3a297a627d54dfd23a5c97ed639fc42a902ca81c35b64f87be6ad5b89c776c87fe276ae2cbec4a5ca813df36eea881f6ac6da8935133ffeccbdee0248852200bfe049c26563623322145204b14ef27197d8c85421e1e2383550b11c96b7a78da38f44faa4550f4a840fe0c51599f6ab1d4979593fbc8444e40d60582f313a526ccf91e2fcfd3f99530a5526404e712eea3ec456ebb81139563a9ea2022f12f81fe94fb97b92ce1a700d21bb1608bff3156b0941c7c76b31eaa122c6464c4305c94b1b06746e576bc9fb55e2b7e8109954073f07b431c5060351761f32cc53e8ade21de83ed4df9c83919a48be91c5723c78a4b8302c4209ba38303406981aea6ae2271deb70065d135c2ded6fa24a47dad594e7d84739e551ee8202224003e537d48424be8d98698172f953c2dcf44e3bf5a1bdf55f4d88f7d2da4fd87c7a0a0e58603d17081df3c057846dca9338981b47bef28b1f9bc2969f3fe40d49859a9d585d1beccdae4482360a296a5701f66d399812671fee5761fe691f7c009bd5884babb682253dc7743fea85e1c493f924d11743edf858fd4d806a4d72b43682ec7336bc5f1d252bf7b08bbf94564ae4568f8cfacf0bbea2c30283eeab846cb239ad7c8ab1f488c7b34b266c222ff1ab2beb7a90740f60652fb9b32e52cd0da7a209305baef22f4d0899351b04049f3bbadc55817ade633048855f310131e91422e76124159163ee2fe1017a80e3c5bf3bdceec37764137598815cfebcfa0ef672a3efc6a2fd8a4f9a1a5d51465ec4f1e0d9ffab5529e926d09e01cea39245a52a285ee1489346a65fd203580422048463d210b65599e9957fee36825229253c02b82d02c206fdee81688ce4ef93468632899cfaa2f71cfb90b18a4ed180ead01b1b9e4a1b4132eec3dba118dcee8435f71baf5bc1bf2d51b11aecf9ff2b0c62545fbe40dcbdd8d1907a6f2835cf7d012299dc4d42f027e6acee4fc666497b7da54634a568d7d46b1d379f141f3d55fff393e516ed75b57860464f825e8db3418c73757126a62b53bd41e91bca3eb9871723688cf0caf9769d3e36a2ea883c40b2ee187be399b0c875ab9a01ca12a4c3ac75c1f87a3e9af66c29945d3da55292901c42d61c56cd2bd1f7716856389ec82287b55eb437f6c561d33021c13a73eddbee98e038abfdb5024fe75b996545a1d2ed69f1c511d0108773f2e2e399703c63ff55392c5a5876cc44796490b82f3effb52009b4ca86495cee5b9743ff072563920c9156b2a34d39a0583526da8645ef64eb4e04819cb00d245548359cea8ca58e44038daaa9cf7e37bce0f7bd5d7a426e098d0a31e049036fbfb130509f0fce0a4689d908c1a185dacbd1b81683f9a9a4f3a2bbce12ec14c548a1426a932ada43d4bdebf480a3c4df2b629402d030e1052ae8673ee5b7b890c74ff5f694604e9d74f6d93c1bb03826fd777f0f93be7543b96906e470c52b951a8195ee51226ff659f635b9631dca5a59db2bece4eb6c3e2080e59ba05f92a55bc925468019ee08a5503b4a4b11b39d4631affb2c3a4f2dd53b4cb228c9e288c2ec60b8cb7977204aa74bd80435ca861a50ed906db503d2efe982616db4f35605ec04ba6ee431ada35570a626fa17b179967f193378d2babbcd9b2abf3db046228b32cb661eeae1090b2ec41ac3c30a75c117a83b9431e96ae09e0f3b65518ea3ab637bbdaba35311ff09b9fbd89729743232fc2738b735ddb31df3630f17e0c8635b221d56411e711adab995197cca9d94163f5e38afb687ff7adb78fb5b4d922183c3b2e73eb75bf0d94b92ccbd7b97ba9b98a58e55ad3bfdcbad4adc0a48d19f6eac38e081e79b14db249410b50016c5cae990a0eb2d74866edcd5be2c6036f9298a74d3808e35d177841a11ed17d217b4a2cf3e5d9c49e5bede3cf644f4072f35273d37d78a7b8037a08512ff7b132ebaf200f065c8ecb65ea6dbbf9d202224978b9ef8ddda282cb455c04f05f9513c5b9bfb7c3c7466f75696ed87c6eece278e718273604d4c727f4712998b3209a6cfe05340a1defee30e0dd337c6e1c05f8763f2a8953fe530d202a1973cefe450bc9aa38fddcb6fcfc1a9dc35fbf31c6870479f2e0454c51c3861c950cb08be511734b482d11b0dd45169675a3f266c36391161d572e5b6040d67347bcd395693b1849d50454556eec3f4d5957160cd0027a5acaf9790e6aaf04b01f9cb33cfe5f0f939e3e81c13c06bba37caac83de01ec83bb7ea7571f7c9ad6aa57692b0e33e475f2cca64232e8adeab7a55ac77f172302517eb3ec77c079a769be66b9ca350818d9b27bdd0b648a5edfaeca72eb968096ce031d2c951bce01164a4b356e6b4095a16435ab2b0d293b52706443cd6ff68a84e3e0f07bb1625684a638ec61af883fbf5e7e69946c4837ae0031dfb38bcc24b665a3821c7714dacff417be3eed4fcb88b57298e094c64fcbe8725f58a09ea16fe5f06530d6324451ea084e67baec5703e19fe42bdf1b050ec3141e8c9d48f695a6e0a302003c5635b6d3093294e7c596e9ec78e579a14daa49430b4609cb4b1f597a41c38dc269257063eff10c50c43cdb7ac2d2ea47f61c81a38dd519c2635cdedc2d4d2dbc1d77c7c9b4864d4d4c69c9586f78ff0aef29e51daaed34f0c7d8ba7919b3496e98d8159fc309099d9937a3bcdd927644231c84fb4441b75d5dd262d7e1c36690a22aab55aff559dc54a007d07f286234edadccd1943e527f855189ef3c718772b15aec70d0538f587ee773b7690f7ecb625c26ff96fbd8fcdddc45b782e41555360e6578d0e8d07f5b4610c0cd875cb5858557b2fb936e5e9cf4e7201f4550344a4fdf4d77d140a14254d53b792c995ac4def89288406e2d52cde13d885303302b4abe06b30021634d9dfda1e266d338f9b427f6b9589ae396144e969c784c670a0fdf199fbafabb4382f707f4345c1d83a39cacb6f23471f5522393f068fecb7bf7c5a2985470260a030c6c803747f6672a1f4f8c76459a74a72095e4703f5e7d1f27ff4bc43be7f228bca6fcc700c60a35fb814bb33f522939b87a3843bb63e495fbc2e43dbb676f55d99d511963cd696793162efa25a176bb5f48078f0821e1b981241fcad883522b1eb6b4f4925d23c43b4ab737411c0f970d742038650f532e81c89d23e7a5fb0fa4031582ab861b4967fde312c374f207e605a624fb7bf2845cb5db0e236b841a18a5682f12a07ce09122ce91d3219ff9a5fa0397297fa7fe5a01063ae011d081a89d73cc283bb16cb31e5fb0c09457e6045f597c04f8dbd0ec3b6506b8a1c46557bec0ef79a9305e5f9f283be49a7d17a13cb4ad30755f7faf5db99d96032ea5bbc2062fe197e89343fb1360017ed005189eba63d37f09d19ba3dea6ab0a372e6e785cd6231f8ccb47046a42edd7cd32d033a4a7c77e0e15e74feea8b429f36844299f8ad448429a9ff0fee4f21a6be77624ae7a1b9b76d57a1fbf88037252420589c3029134d7ea4a2ab93427bf44fdcae409b71b9abafad3c912840dc0f8d5961813b0f087277c926fb8a07c4cea30243813fe2c7b27354ba380dae364374493aefcfb85a5fbf7a81456a36e4ad61099e55bb2151b076d87a51293e9e419e3574b8270b30ecfe7cddd5c614264a311ae85865b18f38f3c15a9b467f8e5f65cbfb952c6fd04a0b3997005478319bea0d23dc1592b3c59bf3e3b057ef4822ed87727e78906e2c552fbaa1944d628b7aff8b3f96c0d9bdbeaeb348a8f4d94583f1a43b7492d14d87daadd6f58b98a24ba6d11879cd816ac4274378bfadfeee90b454e56e5aea193c564cabd3203c4f7953cc631b9fa8ac17befeeb7eed4a32ec01a80824aea14c25cfbc3a98bcf04564b622c410627b4a143fd3d12c53450b0c14ed763b113a1afd2bdca274078ed2bf885da97e45c43f367dbc56a734303d6224c40033c7cc4c041ca4e085ce6864c2032ec2a5064006359b3aa127de5e6ac383277db45ee7d8a86d9c09588788949e7b2885b3ee88309ea177896c4a91aba7bd8b23fa127b216e8f57e4892f9508af16e2b574e07ebde07af8900fb79fd24783d274d3b157a7d2b2cc945597fa3b84f50ac45404d4083594d486bca07c0e4f5909f2fd7d148f981ef364bc64bb66b0fddbed8088c4c2f42b0ec390b3018fedd976a126524a0f0529494b3c9f52e98d92f66cf3542934652b1149ee6f1df64dfef6bc66f56281a034be48b6791aff61e9d882f7b67ff58a96d50bdb3a8a769beb4ace2f7f3d650f999eb511384a79f00180f66f1cee6f0dabe73154a4c662d900cb50356946a1b3a14628a5b001cc48536895b3c06061f1f2cd9d822a6efb19f7bdca0c2cc45d20238903ac49343b16edcd2a5323d88ba9f033831b9fd239e88333281666460eda472fb95822f19037d9f7ea6746cb14b98b07dd9a3540e7fb5ccff193141af347330fc490638daad254715c8b64ecba58eecf2fc4dad42256cf38387acbd5809fb516ea7013513f6866e01df16a75931b481e7770877a7196f74fadebc9ab0406c446b558104329f2e3fe37636c5c37e22f81f12dd449db4e6cb49bfd4d69c441d9b929f812d27d1f3ebe1937497a4301dccf1d1c813cd8fc567551612533063a63274e97596848cac8e6313b05a964f16587c083e713cd101d476655cdded05bd7a81a3631bf144cdb3c657f57246d721458ea6a26c730df5cf52869a7579d29d54aa97ea05b21ce58fe6ecfd53ed47db322494bc6490eb988e50557b77ec817b3e691121574c7c4df5a58bc218cebe2186dfcaa5b349ced94b7c01864fbe61e9b3519edb222aea299d012d773acc6d79e8ac210f1410be62179dfeea3151cc6960f5eb10b6d6f2fde5ba4894bcf36f75e4ebda12e6bbbf90e552c4162fdb5e66f715d11dcbf2c860eb6037b90578e8eb53ef4a9d8a140a47785665eb207a3fb647181231140883e969a1d66ee8b65153840b31761d251c2efa2aaa1a30c0d7ea944eabb7c80f47d1e6417d86bf7980017d5613e834dd19876d0db059e59c15f424d5dd2e6f1320178f09b8f150af6cdc2c1a9fb868e2e1ee15ebeb8ffae51fc3ceb57006ddae7ae8aeae5899facb4fba962373dcd4be9059acd271b00e87c47b368e3bd12865e9f21999da56178c0dc4ef6067eb6de4026a092e191968ff8725c68764c33f39692c40caf6f1049034fe499a0d3ba26857dfd3e121577384247894175d4687246db79e995191d417581e22c4ae0daeaefc01e2e7a1278a9260e193ebf511b977096434be883cc0c98d351065cd11c49541ec2b0d241398b97b5117742e4681343c024b42d9b3e176c4f5ee7e21cccd569549a8e2ecb0a6e888934d46268196a8ee7018f5ee61dd72548976378962e02b69c6434b637ec9103aa71cb94844639d956decc04c7626009b66aac47aa57e742ed9fe16f58dd665fc05d680a2f5f9a40729e15dd44f8ef473f955a7f372eae432b39d098c67265a0ad547e4fd4cec221c7c736e4256f105885a072a46ddf8fec10573296ac556ec3690d40b0bdb6753731f2fd9117cf77dbe8a1b73a3149b6763481d162dae96a64524712bfd520469580bd7470395be181772e4e9b888b16fe0e28ac3a9e6b9b51aeea1a0ee0dac5922e3acc3e1b8eac748c2c33cbd78b773d0ba41bc2c414754e86f85fbc846df221f018d203b18f098b480c97db17ce070a0acd71196a819502706a6d9f784bd3d673ef30ec143675e0be8f9294089e819f4727da2360dda2d40666ae4b8bdeb83e00509b1f45559beabdbb6786f7f97f419be64938075734aac73c2843f159422b477377924ca5aace892092fc017ebf449675d65f55b4977707972dbf4ad5f66e9904da0815c19a772fd126c8f3b51b1ca174c961d20ba267fd1ec8661cc6b850ea8a5cc6ceb16472d85121516d34336c303d7852b160108446708efde4af3650ea7d0a5029f7bfabfd112a960f706a625cbc1fc0d7b6955204a2a17c4a6a86455d8b436bc37abc97296283f6c115062c1af8065bce17a4f5a8b7de210e7a7ab6d244d382a60440e2bf908d74c769978e2533b9c0dcd5e96b2f388d09b1ea82a371374bc61cabc288a9d5bcbceda2deb72562a1ad96bc3e54ead5f1c0c45e79c41f7ce3a044f6a487491183ea00abceeabfb33db19bf667420d780b5fd7e3531f4fc772b2da86f1a1176da2fc6b85c9772426e067d4ffed702d36f69b621723504fe6e34d10013147b6b52858e02c0df229d084583063165ec83eecc8953acb6dae35cb3af0d47c491d71dc14fdd0c88237d0e2feac7b1e456aadc188af083f1afef169eda521ac1d4c9abf625ab11b74f1dca26a02260deec459d8b884d7f4ec11cf56428bfa4ad737179f71e7484569d7bfb1084067afd440b4fb69324994ff395c45cf43290c692283c9dbf23b1e0b161d973eabc71949c0a3eba7ca1c4fce2894a7e8d4fe3c1077252f57f849dd3e114b4d44df350dae04913565713aa4530123717a604bda4f4993046306947cefc806f16c96c39dfa6e6853b4a5eac4c6b3c3ec4173a37a7ed1c420cdfc86761830c06f26bc161bb57606e3440766507a3b755e17c3d4ef1882ec97ef7301a70c88cd283c8fe86ea11241d12f0122c1484a8974959a41b20c3befdf24c6912c0d3235678476c403d371ae3c03be1dca50eb01f6b84608af99387e73c869a8168b47bfcbfe358b0db5c41399b6681fd7d5786987dbc441263a1e4dea270b177705439f433d22f370f7876b5a7eddc17384cc248d5f1722b3fa88d11f46e6b4924269f1cfe512d97ed6f93adecc968d724418f91478fc02017b27c2a29a514fbe206bd1646173eb0de6daa933d69fcbc9e5d9c526e04f475f041435fd2f99788d75d70de84c920cf7f127092e3fb853bb53b494384c99a9cfde4ea309826438669f3fb0ebf5320064d784fd1099d646a0ff34d785d06f39a9344391a305ade2413b1f3ab86b5bd4e972a80314c29176add30389502c17a0852c000aada3f4ee8d799dbf0095e6f09584b404adf7440943f3c0ccc61f50da583d2c9db9d0401a9ee8571f6a3b572cfad1e96129805b40ab21b519ffd70d63e3044b116c2ff091201970105da6226b272b74f1ca894a3a7a606e96efb46b9ba4bce0fd05747c191ef5602e2ee918b07a5ad322d6b07ee6159972eb110d21a15653d36546e4776756408bb7b115d71d981f7edd8e8b2cc54b5a49ca9f14317ee29fd6c0e17787f11519bf43c898c151339be2f366944bd4d45b993c80357fe015d610ede4ef240e7abec1db4273430cf28b2203d438946819dcf734475a31c3454fbd22df2ae45a48722a4d7436b59dc96d4095cc4d9539737c8656e713527bf76961d94641bf8d73d2f0473ede225f14b0bb38b0858b6f6a178585fc8625059ed34d9a4261ea4ee8377f843af6830ac9b7e2edca0bf381e83c0f423e3bf35557ec024f61bae39885705cff65da21f1d1686606955a35e1f69b27e0c8e334badd1784d1f6285abe5f53925196b4fe2add06515e57ae37f57ee948d69e934d5ef0ad95c8429202de6f3531eaff26b890abf1d10cff83cf8f01ec5f35668b20eb9431b163952f754bd0bb8e3bd75588db317e6cda9b258185e9e7cbabe9a904c2cc8997e26e0b656998ab831ef637b17dcc467346ad34e6105a47ba6103fe02469d262f7844f4bccafed59e5e881d4f6f72da501ed86c2b4c14f9d1b186e8dfc8c30235c472f58addc5bff34541c5bd17e25cc68cfc915b5a50f1fb1633282dae9086796f568df502ccf016e1c32d33eb0f8fd29a3eb0b69d4b3f96c384b5d189191c5d21a5b29a9d868eab61a8adfa08275d29481819e1c734a32d51d85fe40bf4ccd69880d6d25f248b91934620a234b92fc4abb77eb71490c54b5c0c7f26dfced0160d0e7a6509a4b2eebea3f751b647d1b325936087eb6b861a7da60225794b797985802c30979c5a8e397b3259857d93f5662c00674e29c33b3c25ea513bba914fd8d2d4df95d02c65439247ec6fc4d388ff42efc1f5f4a240b6f2434647db7813fbf9026394c57900e1e2a96d01649a0e2d310f90793815334b4a2f11de8d0c3284b6ce125aef81f833b4f5b3b0ebe04d3c6d444098be53540512f348dba343dff46e62e4896adbe49cc26e76a384db0ceb0a38d06b5c0b538498d6b45259cdbaec92d9b31036916ca3d78f1ece42bceb27d78a1c56c2c44f74d77344263f5e975f361fb3bc6b3e76e7f3419d512867722dbcc6b30f3b147fb1eef886fc41ba37fa7f00aa314d27fe1c3db360797b942cc20b2ed9498db045637a5ef5e31677a38239233617928b48b612f85d735027f07b479f3ab5a418cb32621fe6aff52b91a87d421a64c5a630b65c9c014b99f1ad849671d3ab2a10d0d6d100de41a730c5ecff8b21951ddbd9926fe7845ad381e9356266163497e3e168a2082b08dd59a4a986b3a147e75f7b1bd94e319c050e954231128fb710d75fafa09e7ce01a8120755e90a735a5638414a7c3a5323c92ca94d845cd3cc9939c1ad60fbfec3aeb161b4c884ddbb4723e47cadc620bd2ecc35812385d447a078de9927d9483b76d1b8d0ff96c0ff7a9d1366f6e4955539f5c82c89644c91eac7198fb4ec7bdf339bc4f66c94e8d48dc244c35705b03d8917e9dcf143af8fd3d9dd9581a3bd0520fd325785f4be62faa7ff210e9b1b45ef6452971446e8d87f460007d32ed35176490cb16ff560a733e2be3276da6eb79fbbb714ee9d9767b13dfa638226ab404f8a2f9dcb2fd3f2b40d16ebb980bc570bbb180da0ab825ce43d897c41d070cb32cbfb0cf8a458ac0bbb766b07af196e5719f4d3c84a65b7b032785ccd8ef3304ce74af11a8edf98c84dd4858ec3f6c74458a7075ed602602cc0f3ab4434b8efc597e93bd9b345e2a51c042aa77816ddfbd7ed6110fe8ff3a47619447596d1d189e381353e0299ebbe58af369766feac5f3c7e2cd86e80acf8463d851650a26f27c95b01e37abbcfdc61d8a8f32c39804d0fb337601c8a47957b29606589e5ced9b41267349812b04e8637653c3acfdbe72cc599de70c34443ad5a078fa54a50e8840e4874fc758ffc439e0488c5b2d12489caeb3af1ea6c3ababadad530aebb807cd733c73539307831f985681acc9e3419ef5f05da6bf81e96d4039d7dc656aafc4a3bdb5522d50f8bd71323ad5781345c47b9739abf92be5c3153343dfbd2f7841bc0e3b76c1d8419dd2e0a45e4e47650f0383d6c7333db529f0e39c20878b53dffa5f74385222d9db53a59c9f94539d4df904c1b6d73a2bd4e0e4f3f39666a3d9ef8708bc81ec1efea4a7173bea6184250cf8639d99cab0ba9aa241cd794a319f50c7c7cf410d7c4524bff469c94b7174802a76f368943dcbdeaf1cb8f6d5387c5ef9eae83aa57b3db36293060e70dc57f464c539f3e00cbdb04b8d19a6bdce56f1b66b805bcd50b787f90e12bfc3acfa194ab25e0376aa4bae1e32ff456c1c2e15eb6cf9eab387c237c4e2e83ccdb6ab1fe008329943953ac0dd32cbd5dd95b3c8a9c633cea5e4774c6ee44c2c0e3e656d011224a0b1c359719f51ebe6ade467d00f2940ddb33aff6413dce27bc14afc3e275b2c085a7bdc87baca3120011d27913931df412d6582a43d4e67297535a56e156f240d144c821dd91350db7bbfe2c08a303e37d9180116429f19730d49ec732a2a1fd74d8da30e2d6ab5f0b275f0d85e60a6ad40c90d65920944b9f1889d5964f53159820029043c5e87af7430acec017a7fe45db8a8b1d83f915a66a322e3f3ff6e784b8bee411cb00ed71ad2411b384d966d363f2f6bc08dd46368515083d4f6f6fffc2f0f2d3f38daaad8580725af052468d0d3f1f8662557851a08f650487228ebc6f6e2e0d30348d84f9a04f842312f93f0b85da10e0ed42e94c3c664972db5fce0f817e19604e3b516ec6b3f1cb4037b3a95beb0840e7f7bfbde944ce275ae0f59a5fd44a5c7cb877283323d85a606ab278e3761a899a1b358aaa10e43b2db591432edabbb9df46058f6c68c240ac1d6a1c2fbfdf581113a549be7e26b67166ac8ca3f3dc574bf5a01b415b2e1a1296e63ea8a1f6ecc756effc9e81b42327088abaf1d80742616b8f1db45e9368f95dc728cc9658362c36ab72cf62d399ba7e18e8cb995a4eb0249aac47a6ff71e78d377073a0b7357f1a90dda6192ffe7b21f4e84cc87faa1b5ffbfe7d47db68501cf1a0ff778e9760a51e652fc7daeefa82bed337c7cf1d97519d9d2b4564319678bbaddfe8a31a418aa3585ffed030f643bfb4d7fd0331c3ee78177f48f7674f31481831024ad19f0fb120e57c5cdea6c53a0c10be8db581c6ea5a024a7444e92e536be5eb5ece10c6cdfbdf79989af8807d39ed46c10f737584a313aa129199646e4457f994b70fc80e7dd3e9529239e3db1ecb437adaa0befb12ac24405e7eb7da3f230f27ee6a35afe6751b4b8e97b42777f823ffb3f87ffd9e61da3971786b09628cd6c0b148c1684bf335874a3019ad35e1214a3fc16d94b9cd7607c9eef95ca3e03defe2053e1489e8fd79b7dc0896a5f8522faa421336653da88cfee796a07cfe29d561e78db466b668dae3e0381c5305d34e0af1f6e83cf71ff89df92f752a1891dec08c3c2be8cabcebf135bf96c21620d6c2cd7c64c075f23b892fae3aa3cc93c2f00495d4ce39c7d0ec286932cec7cceb630baba7ce855f7d59b2b19abeec68c1463f66bfc61a4a8fa62627fd4b88047ebb16369d5712c2e211d5d951f884d76629c999c671cbe7420f93ab755e6f53ac1153f88b1efaa2fa20dc3c832e5270d65bffdd378810a5a60ccfbca82758f521baaf1f09abed27a444ed8a126ae697eacf0b8807d8d849b59d878cd24b54557c75ad46532f935a1ce1a58f2a463f8d4fe5e1ab552e75c2dfa6f46cd9a4fe7626f93f86d57a9ccaf291bdfe6b866c28d3e6419042bd9c0bdf0724d494008e41c70b3ca1c182c1ef2d267dcd8c738756583061e708ff20fe49414d60986331cf3bcbd097b450c27c7ebae9e8f334e5e447b74039ba0f35f0ca7ee3b48fdc9e273b9f891bc71070903aed4f112a886c3a7ea94a3cba9df8742f043717be0fe18605ee364d278d2c3841be86586fcd5556cc3e2b4489424f638ba5ae1ee15ff9de1e86e15c13e5fe49ea1e6ff09a7ec3f4fc3d3fb885a407e115b28bde7ab6b5f5ff39ae0993f5f4edc204a62fd0949af0dcf7fbb361e3ede3fe23f9f1bd82dbcbb563829181f69e1d1ddff20aa25a148a2d8a77cf3e17900d30ad3ef43576fa186fa41b08491365dd1717e2daff06440effd49bb9cef631bc4cfc2ab53bbb570a4a69371ac345cb03d6cddd841f349f9ee242b765489aa7fc731bae1fac4b5381747e0ca3b716b3a1eb8a633432fc11051e6014cf08b17714e4abe6efc1c37c2cf47232a1b839f062210ef4ed3a63d0e180b7ddd6c13959b0473ca36f8c8ed28a482c99259dde80fdf32817c827ef486dc4d1026f98cc2de54bdedf828fdfca0dbafe16803f5818eb98d9d44681a5a74139ebdddb3bdeeb4fdf2c76884efceb01c599835ef0a3fac06f680294ce8bb6765ab84c84f659d17df6464868b63a5330b67be40fbed362d4589bd1fecca5933d802bf089d7059752497f1bc120039c6ce7bfcf383810c26856ecc45d4f9149b493b327e308cb0b13127e2f85dc84d0141c1cc7faf239f5e1378e1559b8a8f005c12895a790a44b3f5b98dd0f6dbf983cac1f89823061e2669964fa09fdb187ecc8ee695f5ae6c7b367b8303e3157d35c9a670febdc7481eb265f546b938f769ce8b63c2059e94ac52342dc42a4aa2ac6b9424433a433cb83a24a228c367f8cbc21c173fb2c22b22460d9231b31cbb42f0d899cb52021a5c1ac3883809201e7307884d83693d3207a873cfe6094ac73ced1e5ecd71f637896f995467840a2fde79ebd81c65c92d8e8a72688e01475b294a0bff4fa2fbd0fc027926c97dbd781262ea1bce685f931ee66b7bcf3588e3d5b9c5558027e9c55d4f99bb1e11c8082a4d1e49a096a2635edafbc16c7a207bf06968449ad6fe17e99f276689b2532c30beef49fe84ee454bd96512f7ce1ed4ff8be74526580673b94fedafd23bdd9550628ae5da7f71ae06d66623aef5365880ceaa005757c17e4e059d03a37eb046d5d511564fd615092e39cb2ff7d1bba428d80700cd8adfdcf616179f6b6d6f7c68ae6348e35d01f5071eb8e0c411fcca48bfbe2cccea72d475cd3641d9b945b50aa7e8f90a0c3d2f856d40bd652131e45313eeee8e086b94fb337f55822816643e0f9e5567a53891d2089e6cbd15a83e4ff3f53b9b6788fd0fd6600ed25c60af5e520c4e89f0534dbec4917fa2f14bb8d7e99f3ee0f93b86d62fa0ca0e743295b317b70556339a022ddf13d58ae3ce97fa8bb31b2a410e87ee6cda2d0bb61f6a07fe75390181262faef34a1e33ce25e297f2b189f0c17f34f84e7d477722765da2ebdb594bc7f6407f3e10870dc192e117e1da2ef87564ec850a456ca9110b9175f2d2f2a45e3b91e4217475e83029edf889a9d64fd38a035468ca8b7538e4e69e853da4a21b4dab66c41742dd5f173db390e32223151484253bb264b1634f923060af9d78d3fa9c85ba14224fe70f6e52c718d48007226dcab158f111e648b28232ee245a07051e529ace930e6a6d03d9daecdaa615b6e2d1c4f1894d76b51f5b8f6f3bbe9817feb63f95b7dab821b16b91ca47cf9cd1837eb059214de67e365b102979d6870a363796e70ed3103b774d2f6da3098059104bec1d1cbb6892334f8b28f2c0d4524a516b6d1e5d4868bf35b99b4482d1efcb416a444941ff3f1aa76706f63e244bd72fca0ed24e945e471c2f5550fa3c27e47d1e85ab71c279639de28a54cc55d26afa98b8b32335594da7ceea4c055cdac7d750553f5febef841232e40872f9d1075f9fa97864a121b508dd80a259a25eaba44585003278026470a86a227f93a03a3fa403a230ab2bd485eaf1ffab2b78cc3c5253062dd071d88f211de2a273da08e21a61b154d6dd494f9fdcc2481bd91943f2dbd79880e0bf045725a14b7c7ca4f159e574f20b8672eea11ad33c14cabbc079bcea4825391551183b06c63a407bf0748fc0d59f92eb7fdc719d73e421ee5032694eb311799e8ab748a9e6a049f879e02b9d32cba71b1f880bafc86106c1c52f6414662c06e3a1362cb33945bf822cb91ec312a7d6e7010f0fd746745170a8658a8499145876f9f65a0f1e70138360844ae5052919a7416b89dc7346e49196af70daf60cc9fc77a943c92e56a5eaefcff0b514e3875a67ab2e2c501a3e4e00a6bcbe3faf796fa66ba47837e8cd46d9328a8aeca626f1e27ea9b291275a3e46f33337a0ba797d610684cf8d24129f488d103bfdbfe2c9f9857f8cda5ff68993db2f59c9228df14306bc4cee6b7b2bd34a0399c499afed5c237b4882459471f1d11691b1527fb2e213d6cd6f298ce2f0e66dba7e7cf8c168aca1914a62e915a1b3365d7bdbf1a39d7f7ee185e95681e84a65504e16040d3f2066bda6738bbb6903d0c61bffa8d646600500d5707a3c1b41f7212c87b27281eee9379c6b16a4ad3325a31736455a35ba3505b6c0c13f31ec7487d84c5d78be05b516d6cc801f77b26a2f80ae307345b7b8e9c3a066e6c619d8a953e195b86799099a38d3d95eaa977184d75858fcede0f89f3ec0329353f1a572e94304f7ab85580f489e2a8092115cf4c9687ccb3b0ab6be89bb95e33b74cb7df4da1e0e9014db4481f4d4d6732b80b74750e57e9f67d73e0488f6a66e3674a1230248f417a150171c96d60bc25356d0069c91dc29ce98e7d3eee3367962911a075d9acec5cca13a17a5e4cb0f1a35b7c70f83763661e3ed6b6c35e3a7a0f85f9a116b98c4a506c08f40adeef7e53222a83fdff2ea6ab0ece221cb487d79877d6c9a3de6376c9394f12d833f4f14a41eb9a3cc75e627a72251e8b94b5b69d09520644e76271e5b4b9c4f72912f79635866defd04d38056da5e916c9e06be1e6aa438304de561aa2a8ad8825feb430edf9f1c9f329c07a9201763d1b284f8248daf7ffd1f4bd534a384c4ebab9248223b4447b9774757c34e06d8e570aa66ff5dac0a2ffec224330fb5074640ab6465cab0c37d5d0697447c5603b3586ca3b2afaa4b13edf8d9e2d52e107eecec9b875894a979b0479c230e49319aded4e43ef66bd310822e8ad862d761bcaa2c7470393869487c1d148ef1d4de7abcc625c23285b1090e4e2eab2a691cf5d51e7708e33eafd2ded9cced2a48a8f331049231e7df4e7c5d6fd0cb8492b724acae81e7afcfb3a3e2064b52f630e0e07a4b3b7321244234069e1136a60e60ac509325adcba82a1e25a2196f6a8d67df5482ea4a5161b009f6b1410f96e156531f9510ba8888d1ee52b7a215aafbdb290972312b0df16e4dca4aa0297015d00c37b0ceb823d1a71bc7b396e06cc06f36537a331d2e7bdbe6b39ed9041ef9d26d4e80c2132bba9196f6fd2b2d3ef5e3e3a5618e4ce8ca86b046e1cb785d5d30a6b967b5888458cd946754acf94bbb475639d94216ccdcdf588c3cd005799b8d34c8cdbc12b4c77d1ff6b2d12eb058ed5de9940bf6529f01e373f323e914ff08f4916ee0d5349d9c347b1b7ab3537dfadd997dd7bba20a1406e4173d8dfd0a05a0b205e7e8ab9a0d7d14ff551934beb003c4fb5c87aad22bd06a6ec5333618cd0090d080a5948f8c5c55247b911a46db4d2e1fb390924c589897f38d78b5d3f7d0cf4433eabd47466bcffb06308e49d516bdeca1a4cf16580bdb466900dfdfe118e67ceec75a873764c2a5ebdcd4e24cfc46b131bc3d01d2c6c57158e8dcdc0cebaeff172f03bd961913b65b186574fd54a9f9d8c2da2fabc5741d9d8688f215b1de3cec237e0d114e8c98f15274a78a7f0dc0c66e782149a93a47e96be736175c6db575ec7ed9881832a83792b906bdb727cd55168ed456484cb885efbb4a9ee93178b93bfec5e884005680f1434be47f864b9eedafb44c48313ac2f70258200c2bf382d0c2ede032f5e2cf620a0194abc133fc4b1b1dc79a6867a283c545645860e95854a30ff91a79dd724e496789d6a20968436b8b6f9350cde0ac4fedc663466a2ee3e4e57682dbfe29f747af06f7f0639336cda41b7aea7aad4ddbf6d7a85790b656ce615e8d96bb159ecc1d27d43ca3cbdd66478fbb05bb60a5cb84c5f369cb65d8e8ccb43de30c2bdbaa01f5caf2843a2fd3e3b0b87843eafa6a0f008f26b094b83003b9210bf7e01e464e015b1f69650b13bb1ff61c7b7e23e187216a2ebc3b89b8ba9a7c8c310fc77b2b5f194e8167ba35a769d940e6a31fc61b8181a395781e864c3f2cfa6f11bfb815ba92ce96cd13d4bdf40816afbcfa7059050285a642ced095506f9efea40b26d3bfdae5479cf018389795b0be1f4b8f80de0eec4c79bed7300983a9b1fba856059519992c309672598df962f34d8f3ea48bef447973001991e63471c1c4b29512746d8d07805558875c8334e944dd46012cc1bec090c3a0e909d4b0a8e18de55a868ae32581a86ef175fd8e55f2cbdf6585611a6c14c9f42f8310751796296dfb0ae9828924ff7f735fa30e8320e5629ab6160610e46fa1e69cdd1c4437148c1a8228a66cb46d334649bd8f884f35e3a27dd5a06b2b88f8200e073d21481733d957a5513f5270e30fbe9d77ec38bc7a5037c941d53e9eb9a3a5e09686b6840f5bec7955dc1f89ee33e982ba8757f033453dcd50cdd7fdd5de60b63528d8e1694c92ce6fa55541441e9fa86bf2d11ab2709c6056a85d1cf634f3805c7b0a4afbd4c7480bb860ed2bbc5e9b7aecf5117c639087364e309abec392499cc74b97635f78926a6b48aa6285b0d813fe8e5168424a86392659cc46a2f5eed29ecebae84c9c65e430cc11c590b10ddaab04def38b6bc3212a4e7ba8cc3a2f3403187802a2d330dd966aadbb9aaff06e23eb16ece6441aabbd668efc1360b3041d1e8959cf0b81952b04c7f399deab062eccd62ccd04f1f3411b4a6f6f0c4791d79cca416128ddce73f13038923701dd16c4c98589576d6a8fc776c191ad2a97229795576f95f6fb8cff972df5e3374b327f9788827bd1421c0fb894ff82613d4118eb71348aeaab8eb7252af5df5b79a325e904f588af7dfd57841dd5556019d83be830f5617dbc27afe4d4c8747fcc29530a9b1fac0f027ae7b9dbc59cb742a68f366f781166237b53d71f6d48626b9b52de62280c4596d4f75b4c5d2084e8a4ee1840f18c44cd25bba66bfc0734987f590a92b56f5ee77fa4b86cb019ebff94cf869586807549dc573979dbe8dca9d45559935b07b18817eac81b9ce7d407a05231eb7dc9638d6e3ac53dacca606556001990c98e3bf35d4745b6e1950f36b0b868d96247b8d4c6ed1a42392236ca899b8179e294c02f8930a5d5ac7ff125ea2c35ac5ac56a4a73ef81d8fa19d6d7c90e9711d1a2c4589b30a30c64ce713120c6cb3841cc40f6f7f4a9d0b70e553709c2a2349d0f83b9076201572beed30c5cafb9b859d773fd57af7660f90a23ff40d81dc53791ef36f1aaee411b81e91e8c223c6e150d9a67187dde1abc1c754f7b79f9aa8b7bcd46ecc45c93d4af84a27db7ac5172731d875ac8aeba00b941cfc5c4d1e226230c06a432127c6f70c42fe61aa8e48a501d573f89bd5e264b09940c300b91ec489e1694d4e97095c60aa21fc21dec4711f15cbf3ddd9905a5547c20fb6fcfb960b0e9d7e21550f548622662dd288b12b8853a3378612a8eac52ee8f746927b8c1a7076e03feb06b131e661e4eba3560ae7641b280535eda9dd37b6d3b66897eaf85b25f5940b95f6941a118a2a2ce3b11411630dc929629675853d8300ef117ca960435574232b1167c085b543f27589c8eaeee1d032bc8b631e8557ce277cc79d04531c1fcb8a4ea322f78213b7e2f61d893a3deb1e77be274a9a4980e1d6d68a2a9c20ec7d5031eb37185a1146f8305840c90008296c7c23c26d35c4885eacba9a2dceecef29dd8a4240ea5056132931efd5fda663b3435efc2ef4ee722c617d2212d3393c261d050e12057dcf7cba55ae081ecdd7836099532ee1d32f980f265438db3588dd0a81d265a407830eabdbf8a653571aa81df3a8be6631e860f2b6021813a5f49c8a56d57be2724f269fa654cb8ffa873dddd99c00c468ca5f02b74ff221438134137530813d984f09421fd2beb2ae9541ccd5bd7449c72518735b8e81fbe42b6be2dfb03fb5188e9479bb92d3c434f0e9b7e6d12866bdb302599e9e880b597ad0bbc7cfdcd5b2fab8c9e00d2202421ab5b394d433d9300a4d52cf2cb6c8854aa14b98f992174cd76667194f63712941236338eb2100fc6a4e6d88cd2d474dca39784953a9c5877f7a7d37eaf8f83aa4fbfeaf56a243a89a6877048204bd3e7740a733f42d7b3b5456af7b805e8c697c4774ef7c19985f8658beec39978a67a43fcfd81adff3acbdf5e0b444d14cc0f85fddf101f6870e931a10d6096a21f70bcf684e23ba8fee53db85557667995bbd91576f1843c40cce45bc2587f958120bf4526385739ac7a8cc44cea2b970c712fb93c6cd975a4061a972263d7a25b800754826b1b9ec337a22d4ac0ccea607f0433d4a9d56b93c5e0a7368f08ccfb4249ac0a95f6b90ac1a512175e0af10d725abfb6adf2787c5f6ff17d1f743d2b8180917dff3efc4431b671f7d139895ebda1cd4a8027f8f969e0e57cf7de51e0162e4ca278cad208ea13380c5dd27ce13b30c098ca62bedd860d108e1de6e7baba05b2007655363f8d81a9688e615a6b428191e124c7cf3d69cda5410093b460ebfc0a525f6794ef844c86f16862cf6cda1793109b4cf34b8dc7eebbc47956dd8f1a11e7bb89fdfdfc7699598f25e1d4d87a064f3d789881df5e0ceceeaca91bcc14209cba0f1959a7faa01e9a9641b14fa33933dc6fb98b78c14356ff92e205b84a0bdab4ab7c1c9ab6ef14e505746512fa61f477a2dc8e17dd3de90394a9c16de796355033aa346f8e4c3d78e5eead2179396a48899ccb7b84fa38da54cd88874df46b7b1338aca522934220d9a1ba72f8d1c9348bb66707021833c0dda937d0d6040ee3fa2f188a412ed35286c55ac32e6d0052b7cf59cccf5937f69745578fae51190d100921d07638f14ac44c69e21772f4036463e0dec2410bcbf9d3b6fdcfee1c0dfc03a2be21649ee53017cf66185c82e81fcd206b4a381ce1368b6da3cb9eb1788975144a0df84285623806b41c936fea463f632df26cecf9476f3ad7b57070c79c1810408d40963d28e1fd5b1b99fbe62fc5c55f5c722ed96b47afae7065f63338d5fd8c36a6921fcf99117f31912ffe4bd297f050f7bde748288621d661fb4c629e92b9e720ad6acbb4442409ccc597aceee7adb615da867bda1130808cda9a76579ba950ac2b38f621aab5ad40dc12a7785a6dde706fcd382498ec22a4dfd7a5a61ffa1cb7b5e54e38e29b9b45d0ecc57a4c58948686d6930ed2bba91128559a71d6ed2b8b1c18269ab044db8268820c16b3bd357ede488952261f64bc2f20e46e0d49c757a6f394d3f0f9854cb6c73cb374eab4485aaaa0849a792d19cc68b2eb38888c23b74dc03e62411d973e47764a2b77fc552679c46cedca685d9a719c58a4793deefad7c8d15d619cc8eed13e707f2df7e0d20a509a38c4fd6f8c4335ccc83697519e7384cb58b18ab9e688d9afcfa1d18d9111a8c5f72fa9e180036932c152a1b7918b099508db5a4dd27e69d77c45f6f3a1047a64112c704e0f1b5493b2e1e4e3615dceae4b8a8e218765ad81e409fe22f8cbf93dd2ebba27e0e4fd3b2c393762fdde3a274a5956f43255b3865f2d8553a8d2501ff29426d2caace1d3da86aaf13bbad4d82ea7d80fe29fe627499ee9a4be2b457f3293871c300b5c551a94a6678ad669c7be42fb97b76ccfeb2146065578c7a40460774a0af68bc59db4f4993e030ed51c8c27d225029fe65aee9df9226ccb8fa4a8d411c043a47480ecdf403405ad627c422d10fd6741b2d442e2cab8c9fd8d532bbee719db5dab2ed06e040f7b6424e5f62bde93eda18281feec0dfcb46c5646d2cca296182d2add14d20191e987e42b6a1e14a45aadf926670e6068854f6f6846b2d2471aa8b9feae03b30b500900184c9ddb8fd1bb01f737b88a5a755665e5a16ca7bbe9d3c40bb5d8022d5d39d35ab725d062329df77ed91d110b7da20bab3294c9ad52e0609738b807f0e9f23c54880e3bb8732e48f6e205389e3814ce5de8308a426db2611b1b319abd20bc4fdb833acd9f77da3dadbffe90aee9c11f3768b71641281716c91c3e1d1f6c1687d6ac19d4238b3f561eefa2d22d3190481c14c682a3c443209f1c7a1e0fb2ebc8a999ffe1e45a5b8df5540e5b89ea413de654feccf1a91813ff78d7859bf8d4e94584c6bb25a57d880c4503d076c83598a5b090cfae40752c683fa9598e9c1febcb42377bc3ea129986c493bdbb0119b207ed1f6ef7e28a4f034b8dfe0f29a79f28b45bd97dff31b9741b21639f44100e89de0f30ad05b8215cbeceea3c05c216caf0565a04a1c121fc6ad58599a62b713d032d3a9d54f46fb8f3c9e37df0ca379416e286544d12d16715b7bcb1af3e3facf22fe7836d33a9dc23444e2814878d3fc2021572cc7405c16f06fd1226e6e69f30a6955f0e5743a22413a4b37b57c13063f9eac2b0d24007d78e1217849ff25cef912c9232afa4ea208a1d82e9c9d36b99f95aad33fc6cdc261c63e7c0ee5ae243673c66feea9e376f5c25c5761d9de017849b47b080bce6b32dcd9fa7d87270abd98d3932cc80d5d6b696076ed7e89db5b46fe934221535a641a285e1d4ca665e30fdd48ee4d66ef96716f3eb9900ebbcb04240224591f6b8f88a16211949283e1499a8e2ac5807e30585125c4d55d31c31196056e035547271a6e192690562a0ac8036b2c2e37ccc172a9c888cba23b3ff2b3e1cc727e9c33d30859812a0fd65080730f59a898ac0e74c2bddfc97679e377f07cf92439dbf727e73712329711384ddb8dc7115e857122668591485d31590bd74226dcb6a819e8ea979069397520a6879358302af590359b8524e2e33d6ba54dfa7285906405423c079eb0d154eeb50a30e6c04b3a95b48dd92df2a24563362a6528a47f2a2771a93053cb10302552717e79787ffda26eecd764c9a7596a50da7d4165ac9aee91d0e51e5f75bfb821c0fc3bb2f500756de55e77db93aa47ba5a601a7531c587effd8cfa4c3d4e0023d2350d8512bad690b8d55d37cc88563e7d585b19a04ff2258f315d1b4c78d962597ca79b3d0a4b61239b53f9e08b5580a3193f5600fc9c332f1c905fc81552e7d9df1484f08f382ac187a7af4eb749a4297fa05a943f1a675c2a0603231f53b380f0c8aaea34605e6eb6b648f55aa1fdaeb9af7a9ce0c70d63e7cccf27236debe8158f17780878902e164e3d530e9731ffae7420044b9514241c39c1ea795c4e159c23cf40cf91d2575e88400173992f9caebcb4022a8b32f395a8ea85153edb4d0d7da72ccd38372926386d13f0614bfdee646de50caca7dcd50083ead0a556a507dbe6349543212b2f37f562524661d8cedecd879ac4612aaf03e0b517cc15eef0d3ff0198749ac92b20dcaf9a32a246df2a4c904a1e873f6906ea51244a60520dc8b83730ff1dcda4891de886079d550bf5ebc7bd0366bca8c8ea6d6fb49c3a2c3242c9ad6b83ea29b42af099a1f63f0cc436613d29ae3dcbac3932e3f1b4bcf94f80e97727c97b641d91f9a0e2e1087b6d7410e0732974b57ec7de91183785986ac152f84d024a1a763a2633cc803138c4665f4d971c8a7d11ff96316f081f64fba0e3e7408e3c24f918f5fbffa4866fc4a6e88d23b8b969e5f94152e93bd44bf4e42922621d1601fca07f505d149c575e9b70e75c2f4ee6510ba2123ea42feb1225288e473ead88e52ebea3e374f0eb68ac5104b2ff82c7b269542e08ec9f173b2964c928e85b9de405f74e9ef4304d989b47fa55dbb761c18d19bf0176b54808845842b6d459d06c0ace3bed7fed737214e9aeb16e1c81e58edb3b2f7c9a2d05473132cfa7d264a71b2fea5392660a2ba24632ee5a80d9205249061edb9648915e12722b7428860391c84ee2350b8004638b21a83267d81886eb636487e8f65fb4ea1094d70ef57110f462795e3137e61b0c32d4acee6533e9a4fa055f15ba45a2ba1ff0e6a519b16d1cd7f44e2c8e7ae4cf5a8f6dd558db878c1e47b82ccb0a3fb8e78b5a668aacddd9867d03bccc75266a8f9d7d62d98e0c41a59f6ddf3c2833d49120ae58117c66dc34d109292b3f16ea7f62056196685072a677b70c18ee3079ecf2de3c47d0b6592ab78b2dda9a7e1e7cf8f5184ea55d53202b91fadbed7c0e4f7e2c3887786eb903022b34b030ed3912dbb717680b22af8181cc6b8e8da9a24e65803b18ec1c076ab2efdf049ba414c91f03392e21dcea06374158a4b04a093438218c13ad061a7d66fd8dc9c5649a8737c3f1d714f981fbbbb5a0e56f6fb8d02a651806a0f63972b833ef53cec79e1b7ded53103b3f66675b40b451d2256d4026de5bc6a0265dab3ef8f28768b4540f3da5ca8a1ed2d9c6bd52e35106917dc395d8e4d4d5345fde6daccb322f6ca9a3e878fe616885bd323f4e940db770aea188f683e049bd71bb3c768dd3c47b7d31fdfe6996c01456aa313e2f389373acfeb85f60b32e693ebb693cc500d541c846435f7c4fc30a08ff4e07b2cb8623a368503ece9d552c91b8a156814ea842dd499041def2b2f587c606fd7af8e48063bdeb9da12ec168928717f33609735b39823024145acc39f1631e5ae11915fdb536ea3ca5753255c6980b07cd541469ad424d181448c33cc66164853aaf273ce268e3a4c4c8a2450f41af202a13ea5275884ce4532e8f25c50871b3ce42cde044fb438a002f271ff6170f0359f9ad80422bde10fad49afba1d758b161ee1ecb7f71a66a7c21f9906c0d35a41db3b0106b9acb6dc541fa66fab238a5ab8912ed7b4ffb9c53140874bda1567c6a83b13b047febdcbb30422974fe6c4c06f166647085ce1520d099efabf18afd7aa910eb01f2b15a43d59dc5bcf80cec201a55bde66e0631c7d1920981d8565318013f30f7203d6b7151f92359d8a9f8ea7ae8c3106aaee63dd6afec04c3a4228fce1d0490d171bfb20ce9a47e6845927505a001074ef48ddc21affe8df13d5e6814c9cdd28ec01917fb74b9ff43a662889b7a008529f09788de9e85992f515b2674674a0917df9f7f8a43394e048f98511f4b1a7a0938d426b31d163e0c18fe1e14e7394ee574f14ee10c42a038617ccc9567986ba923a87e2cea53210e1f251278c2f4610f4b4ed8ad5ce67977451012bc3b22950bbc6d3747c811a9c9fd667fbd3e97c6499bf55baa681c4029f2ecfa3ab3828a3d12afdcbe86aa20074cf2aa626749fbc3d5defbd5117f40a7e20f17fef730d7da8c4800032786cfeeb1832448510aaf4ba322f1b2af6b4d81cd0911fc05489dc4f0496fcc632c5074f4f3fb54ee893b6c7aca793578b468952538b446d742fa1fad2e22fa2856ac2e914615e3f4f0b4e30291b52bc71adc0fc0ea753bcfef8091939e396eda358086e48a876cdc64fb7637b8e1ec64817b3c72a3fb1777ecbe27b872b9fc0fef6a706af7962d268c8c00a19116f0fcdcb5aef2f7db4ac03a04dc203d40dde33be9bc94114bdf257b5578674800135a95052837baca3ae4000bf42256c9036d181e02f74c471e2070be7f63abe5dbfa86349c84338f11a59062aa874c94ebf625c9466165863b16df9bf857cec611222695620543efc32b872e1350326fa23f0f64bba0519ff46d3c038abf37946e1dbae18836249f6613ad7a6314c3907e5751c20f77f143dd4d18347d5e3f030afbe855372c1e4654861af4b25fbbeb0e65d18c4f3e895e9a9842027ca4d3b38fbf313340ed41ba8519aa01b215f7c3ebef3ce717060476d216d5063a6aac365230cbdc6d799a15c5fd0fa3cd2cb6e4001eb5c56c6746f14ca30a78be507b3f09e33d0d896a6a653ac0e9e1b9d034c6091000bb125e762bfb316ac93c81f2eaf08a7ebb475536db033bdae4c22f5615ed305fddec7587d39b5d34f4e84fd11f460eaf9d8269349068142490d07b40ce3c45a507a46ae926556df8c64adad613180042ad0b5708058606160fb570c406e940228aebaa4293c35f68166e4e5ba7f33d950cfde01789d9ec5403d604ecef2b8bd2a9e6e2821068c654478988b2fd556261316169b62a9fcfec3225daf15a465683c15fd573b162612b7fb318fd5c12c3706c01b3f5a7891b488771165b8bef36644bf998227fe1750e31b04fe8dc85521a3d14422f2b02bbea854272347af9805e758f7c518177591031de668c620ce81d7ddebaee3290916cf967e4e76f4c833a5cdfabf5a35f11c2d2bc3422a2e8a7e78cf894b686ac02c83c84c8b0f72e9eb8cf2924b2b7a2c4dbcba761609fd635779abbe23ef97296fcc19761d4b7de812021376b43b8bf7f675d0cf67a16050c550f3842927980a0e2459b31fbb46105f7f6db0f4be16c269f4f30f35f1272cfc2e54cd0b0554045fe4d5a127235b34dbeeb8236e21b4cf1ffd004917717d62e4c6710a8a1c898a39ece157e5107b7a8f92848c3c80972103d3f0c3f96a975c8152fd66197c95a857f13a4d0bc5b103042ef4d10ac4d1d96e4cbf88e85c3478e9299bc0986cee1e6b5b047792dfef82da3014843ee49463d70b6131ef48a387e4af309c7c1673a0ae2abd66fe22557542dff866bd8cd4cc12c5a4143e5c940716062d8cba7ea057bc18ad6aaf2966ea46fc04200b6baecb72428bebe858fbed571715e45470b374bc673f6ccc4edc972a51694a136a28027cee76453288d582adbc0f250e25c742cb65be57778f07a70451c3fa49fb1ceb4643444b389d8da81343c41feb0b1cb1c1faa04fb682c77e2b8760ef6c41e693882e4981c7afae25dba9c8ff010215331e53172e72553b95413f93499aec06c90332f533f278e4dd86069994c53a555b5819afa18455d7e9b0862689b9b1a08eaabcd79d889ee63b89f106d2256c664cee2c2433663bde903a422bc71fb8538198221c29a5c1634daa3d0c3a0f2df43cfbdf086b81aeee945ba6a00740e7e0ca7e982e5d16b77f4101a9b016fa2d53feb50047e94a8e5185cffcb68691dc989cd8d6601f6f1c903b1954cb607f3a86c3fe448ed6a6341b88d0999c880ce7f3be0c6f395a46f555191409d6c4bf138fe12ca0ace0671900e90f7349b6b8fa76ced5df3a1cd0043e8f1a37850365f5a9815d70656ecaea527f5fbc9c4a01aa4e06913789662930a1e536f0afb03cd4369bb5b02ae336b8893ac6b655d3ded32e5232d177d7840c92984d52fca688b290881a5c21c3ff968b2ea8ba30ade5d37c0fc8cfa0cf4df54897935e9655483bb093a7eccdd95dc36f48e602577bbd27c9db3b365a00373c6c82cd5627799ec73de5157a53f9e7034f97c2f7f10b6bd2e438860c80d82db94da875f7b3f4eb60d066618ebde944d0773845108dfdf13fd353ce8840f72b0437e5910aff7dfc32f4cf67356de7ec151fbcc029803cc757d70cc7d5d46ecd29b9c63b6515503f2bc3dd58685b4e6df487a42c736806fd4ce7b7dfc52be44a4a909044b8b7657b5e28ce782b8bb3e4cdd3f301fe006be293a4241593450cd3fd3d05bb2edc9523821adb6c63504aab68961af8ae6bf6399b4cacc447864ce556d62d4b685da4af49b2525b94c1821356a741d2e6687c49fbf4a01927c1737ade6b632cff9907870f92ce933292b060dfd1e44fc548f84f79712031463e766774bcfab770642e6a5b2e914385b712daa6946ba869bdc68ae415c31404f1fe17de9004bd26db5333f6a6a686c45a7338f0926f60bed0d1ba0dc16bf70d65fe802a86031ae67861eb8d61c658cf756018f0237ff83cb972efbc548757ca806d9f922963b60eded634bc7bb2cc104e17466adcd5845dc19ac68541dcaf031a930ab13063e8a162341f8bc4b6e31188428a0654f645755b2f849ad5437f504daae7e56fb924d107dddcfed09f49919a2e5dba235d68661de84c792317b3a7c1f898c142fe8cac0ea97d36c9c457e017445dd2690572ea20ff7c19b4bd9351dc6c23d7393dcdff43fc8442be77ed920e2ea3eaad78ec840edeb6edc248bb77f42941005a58043f54ae2e12c0a335b3de9adea9f1741084389668cf8ba2d628f2583ea7aa735df0749d0906e7db536371b1264ac448b1d618e92f9e84dd8479ec0caa1666b265f57fb1f62032c1bc46cadc8cdbea1e2dcd30af5d28f6fa6de9d2bf6ae964e21bcfe0353e74bd273706c99cd135a80b0fb9b85dc176d2337ecc42d6aab32d002a03baa64f1bd18da249adeeff18452da8d8ae338331eafe768ebfa8f43096d08869ee9e16e8c8c103be27073d3034e7df5b0f3cd22136cae200cb3602b3489ad95a1bdc3a27e483e8f2bb9336069fe03fd39059ac8b224289637189c2bc1c124ced20ef6862296314a07e1bcc8a64e107af78b74bd923ec99efc10bcf653b551884d53d48e26165660cec70779f756c91ffdf9fa74ab1acc657adc7a5ebaacc840bbd8464e9d7a415af4f9e20ed2b431dfe763aa86d0fa8a9b94255326a68355f5fd53472e5826b5bbdf1ab8e4a3b9145b592e520dd70f24d98d78b86bd57032a8ee691606fce7be8656c24010456a31a9fe5f67acdca2c837335b1f8e1c2da748727e714ea2317ef243a393f0d262f90c2e3f83f20f2b8ea5d8c355fffdc8d639184c30d506118273c0e065ef0ebccae0bfa559f8394c4afcd40408ccd657f4aa1d6d1f02ecf90d00be2649aeb5af5edc3a69680d099a88676a2a07145b4d03207c788458743d9d051e689b5a26221a659006164f77bda6c1a3a12297ff358712800772ae24fdac123fdb7a70f96636c7c9f5915bf30b5e032c1bd804ff6bccff0b4e9a1fa701b9d70dfb6240f134af4682f0b172a34266b39b9b7eb9039aabe39a1bdb094d4aaf14ad4201466c18b40ab41678ec31d6ab75b5fc3f1ceedc0c8071820db70b3308f9c60f5da535cb54492ef30f3b4d71eb39e3eb69f940547da3de27bd7dbfff44c4eb332299ac5f7774fa39f0d95d6f162055c21d9ecb0b7668a23ab7c0e4dc223a15d0a9f7b8c7596356e06b794280cf7dbd98bd0bdddfc8f8ffd218ad59598746862a50f8e1e5418c68d390dd0e32e95e1a0d4957a8fcfb496617bc8a3dbde41872ab5a09a284ccc093c07713f2d8925ed7bb6314d4c81a7b18434ea3cb53f772c76e8d91df3d731752bb34188b20216a83cad84f81d08d21c50de73fd10f92216c5c374db9e9630138db2a44346a61fc37ef6aad3f54d2e3ea1178457f048d8586dc9f03f87831a2cc19b6d912c2406bd2fdc49119526a9d346d33b55164816ae9f348f2ff95df9b25f972d23aeb47dfa4377b1c82d8087183e52352c2809d9b5a146e3b5dc5c883d6e6782b7381657a080d0294ad67578b481ebfde605a91067b3650cc1f5cf6f4826f4e104bbe1f0ec8cb58bd4d08d09588ee72547e5a90ad7401da3ae37c2e5837cf3f4cc54335d090a3700045b973212e1335da9e27d30eb34c9ae0feb99adc0afd75232163308c7d8014f638216d6e9dd76f3e66290db05ba19485ec8f38557c6e33f73cf7a348ecd6b80f1bbf36df9a4a46d91fa9174d3b95bf068e35026237803184d2afea869dbf0f4bc79f00b3acc6548d814d91b3d8c4ecb60fddaea494cd1875fb801efaf38d6d33f9675c6d2e6f65b84703d83709d0961acce255d6e968dfbb3fc0edf0b49598e179b92def9afa3ab54f88331486512fa4ffe37f397b05f6040daa0b0fbc02766549ae5f977abac215e60f6922431808d133359537d8abc5995a282a70232d53a61d81dfad26fd207689cad6f57b9f77b434828cfacdb86eecb2086a03849e8af5ad174cd54e862a93791e8c5d2f1bf3e8d3f3f853b34adb2b49952e52f844f4408379ef5aaf4b7e5bd99f5b526b958b22cf3747ca7ff311bc801e10be7f4d92af3e2801c1a591ea81db019a0423248c41a5b2ead8707d1e9004c9f674262224e54f4f0db66cdd8565e478432e48f7b0f12ea2e2bcdf55e64842c425d55e289942406aaa46b82921496b5696fa4df1e1c0b547522890ff7475350e49dd9246c0c8dd9c72a17979c0a6639ef582802c7f6940e434331771bab83833475f510527e58894d72c1bfbe7fb2922d6047f15c9f558beff59b60bf733ae38fea78c269269ff453ab593e5370b187cc1dbf7a71e0d131447a5fc518fcae91baf9e4ebcf31efda31be32fa0c90ec235ab4d2d003b83f0f8948aaa5e133a1a1c71cf9d270d1345b11da9c13b4da1de80d02d2f7d24325428914c66552077738847cae0bd3767f4cc7b10a403399d7acc3a9ab00c10720dec17500bba7bc64c9a699edba2a2e55b701e5d43e23824850c104fae30f308226a4da2cd76c934a09fe48e8e9c9a4ca252d4981f718e6d4a8831092e2f3a50a7273b9eb724161c0329e8ca90b364b7049bb0d7e05e0263e1ba6d14ac64652953367e1870c2a585cfec655b25f3aa0fe7cbeb191cbbf4352b8365cf781ddc28abec4b362b31b2a8917c143721fa9dee3ea905ca3b0597a51f7992373c029f17f3ce1460b2a450b2dc66cd4e6a379c4153c8897adbcafbf52835cf892e98fea3dfcbca7058948de89fa3d2a5639132c912d8005a96d29a97734db389eadf8f4f781eb0a9fa3fabda1980d57d90fa0bb46209b67ade4c3e3f7f0b421e855bb545b4e3055bc0ce8d04b930f2dd57cbafb1d020f77c71ef1d4a637cba7ece44dea1a3bac5ebe8f1d8a31fb6ee2e7d585b5365445a8752205f3b902a9b38b37d6d3d25acc5338b07f7e965a0c716d0d9ec915aa35610447ed41fed90d46b286b0c70102884509329b02aa55fec12920b7dac82c048733d121cb2b8362b65475f38a6f3551e0b17a4b94104d89c2dc8402ac9b8c1e024e7403649d292cfc0778935e7e110bc3c72a1c7e38b7ad6ecb08372dc11e35e193c69490ee46b3ba4ecec53afef828daa6846dacb80690a619e45712bd7368df7ded19308b07e80885eee03c8df0bd9c38cad07cfbcc1b6977ec4ba2733297ad541ac4cbc28aefc5c9d372b89bf3704ac355b58d6a4ca4ff72b61d5e2e0143d9e8f2fc800e99913984c53212230b492dceb98d34ea175c45802f2ea3abcb3d0276241bafd48ed98b327e700e0ac24bca9b98eb10eb6f2b988ba38a7474673acbd88d320e7ae223650c792cfe7877bfe6bef43d42c8c4c9690e013e4540090742c8f80b05489c9bf8da40a9a1c80e27684f3d3d9535f5bbad07fdcc945602f80c7f2476620ab282369de6f0c358fc779001e974b92f945e832e79c33f709ba5117acb2ce7e8693d442082b285af16994ba74f67130215d0d6c23e5a85ab01294c444ad3b119ecda9db5c563ea3be7a7635dc4bcb388e36c2ef5f9966f161dbd24b2f6db364df4639c49e00b875bc85d8b49534957d6f73a37172e3225af2ee3aab9b5999416921635fbf2e52f7cce8cce7dc8a81fd5a98b2902b7582ea618efd02317e44945ef19cd8c62d9476a819f6b471f60bf1ffee0fb257d9cc6424d1dc8c36b61b04ab87724207c4c36fc628041766b680da44c631df99dab18993651949443f3fde61769bc175240ceae4a1275183ca62176e19d84310efa0c4ec5c100db9ea05d91c51f9a57f4f8333df6739836a300ae594ed140479100857c24be9c698d44b5c8e6eb08c4e26bf691b813512fb67a9e4d487e30147c7e2245d269838425e4b5d193dd69defa5e6334bec961fdb96195c3120ad92b03bfae497d6d9dae24948fae5b7960bec1bcc8cd37727a701e6549d5669d9c6e9d08b348441cf75d5f75ca184e0498b56f63f25764be45217140cef36e75d2b27195f30cc21dbe6ae63f724b7e44352d580cd116d690ebf613ccb41e083a48467d22b096489ee0a9c60</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">å¯†ç 1111!</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">æ•°æ®åº“äº‹åŠ¡æ¦‚è¿°ã€å¦‚ä½•ä½¿ç”¨äº‹åŠ¡ã€‚äº‹åŠ¡éš”ç¦»çº§åˆ«ã€äº‹åŠ¡å¸¸è§çš„åˆ†ç±»</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“å…¶ä»–è°ƒä¼˜ç­–ç•¥</title>
    <link href="https://wuwawawa.github.io/posts/acde6505.html"/>
    <id>https://wuwawawa.github.io/posts/acde6505.html</id>
    <published>2023-04-14T00:00:38.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-æ•°æ®åº“è°ƒä¼˜çš„æªæ–½">1. æ•°æ®åº“è°ƒä¼˜çš„æªæ–½</h2><h3 id="1-1-è°ƒä¼˜çš„ç›®æ ‡">1.1 è°ƒä¼˜çš„ç›®æ ‡</h3><ul><li>å°½å¯èƒ½èŠ‚çœç³»ç»Ÿèµ„æº ï¼Œä»¥ä¾¿ç³»ç»Ÿå¯ä»¥æä¾›æ›´å¤§è´Ÿè·çš„æœåŠ¡ã€‚ï¼ˆååé‡æ›´å¤§ï¼‰</li><li>åˆç†çš„ç»“æ„è®¾è®¡å’Œå‚æ•°è°ƒæ•´ï¼Œä»¥æé«˜ç”¨æˆ·æ“ä½œå“åº”çš„é€Ÿåº¦ ã€‚ï¼ˆå“åº”é€Ÿåº¦æ›´å¿«ï¼‰</li><li>å‡å°‘ç³»ç»Ÿçš„ç“¶é¢ˆï¼Œæé«˜MySQLæ•°æ®åº“æ•´ä½“çš„æ€§èƒ½ã€‚</li></ul><h3 id="1-2-å¦‚ä½•å®šä½è°ƒä¼˜é—®é¢˜">1.2 å¦‚ä½•å®šä½è°ƒä¼˜é—®é¢˜</h3><p>ä¸è¿‡éšç€ç”¨æˆ·é‡çš„ä¸æ–­å¢åŠ ï¼Œä»¥åŠåº”ç”¨ç¨‹åºå¤æ‚åº¦çš„æå‡ï¼Œæˆ‘ä»¬å¾ˆéš¾ç”¨<code>â€œæ›´å¿«â€</code>å»å®šä¹‰æ•°æ®åº“è°ƒä¼˜çš„ç›®æ ‡ï¼Œå› ä¸ºç”¨æˆ·åœ¨ä¸åŒæ—¶é—´æ®µè®¿é—®æœåŠ¡å™¨é‡åˆ°çš„ç“¶é¢ˆä¸åŒï¼Œæ¯”å¦‚åŒåä¸€ä¿ƒé”€çš„æ—¶å€™ä¼šå¸¦æ¥å¤§è§„æ¨¡çš„<code>å¹¶å‘è®¿é—®</code>ï¼›è¿˜æœ‰ç”¨æˆ·åœ¨è¿›è¡Œä¸åŒä¸šåŠ¡æ“ä½œçš„æ—¶å€™ï¼Œæ•°æ®åº“çš„<code>äº‹åŠ¡å¤„ç†</code>å’Œ<code>SQLæŸ¥è¯¢</code>éƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚å› æ­¤æˆ‘ä»¬è¿˜éœ€è¦æ›´åŠ ç²¾ç»†çš„å®šä½ï¼Œå»ç¡®å®šè°ƒä¼˜çš„ç›®æ ‡ã€‚</p><p>å¦‚ä½•ç¡®å®šå‘¢ï¼Ÿä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ul><li><span class='p red'>ç”¨æˆ·çš„åé¦ˆï¼ˆä¸»è¦ï¼‰</span><p>ç”¨æˆ·æ˜¯æˆ‘ä»¬çš„æœåŠ¡å¯¹è±¡ï¼Œå› æ­¤ä»–ä»¬çš„åé¦ˆæ˜¯æœ€ç›´æ¥çš„ã€‚è™½ç„¶ä»–ä»¬ä¸ä¼šç›´æ¥æå‡ºæŠ€æœ¯å»ºè®®ï¼Œä½†æ˜¯æœ‰äº›é—®é¢˜å¾€å¾€æ˜¯ç”¨æˆ·ç¬¬ä¸€æ—¶é—´å‘ç°çš„ã€‚æˆ‘ä»¬è¦é‡è§†ç”¨æˆ·çš„åé¦ˆï¼Œæ‰¾åˆ°å’Œæ•°æ®ç›¸å…³çš„é—®é¢˜ã€‚</p></li><li><span class='p red'>æ—¥å¿—åˆ†æï¼ˆä¸»è¦ï¼‰</span><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—å’Œæ“ä½œç³»ç»Ÿæ—¥å¿—ç­‰æ–¹å¼æ‰¾å‡ºå¼‚å¸¸æƒ…å†µï¼Œé€šè¿‡å®ƒä»¬æ¥å®šä½é‡åˆ°çš„é—®é¢˜ã€‚</p></li><li><span class='p red'>æœåŠ¡å™¨èµ„æºä½¿ç”¨ç›‘æ§</span><p>é€šè¿‡ç›‘æ§æœåŠ¡å™¨çš„ CPUã€å†…å­˜ã€V/0 ç­‰ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥å®æ—¶äº†è§£æœåŠ¡å™¨çš„æ€§èƒ½ä½¿ç”¨ï¼Œä¸å†å²æƒ…å†µè¿›è¡Œå¯¹æ¯”ã€‚</p></li><li><span class='p red'>æ•°æ®åº“å†…éƒ¨çŠ¶å†µç›‘æ§</span><p>åœ¨æ•°æ®åº“çš„ç›‘æ§ä¸­ï¼Œæ´»åŠ¨ä¼šè¯ (Active Sessionï¼‰ç›‘æ§æ˜¯ä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥æ¸…æ¥šåœ°äº†è§£æ•°æ®åº“å½“å‰æ˜¯å¦å¤„äºéå¸¸ç¹å¿™çš„çŠ¶æ€ï¼Œæ˜¯å¦å­˜åœ¨ SQL å †ç§¯ç­‰ã€‚</p></li><li><p>å…¶å®ƒ</p><p>é™¤äº†æ´»åŠ¨ä¼šè¯ç›‘æ§ä»¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹äº‹åŠ¡ã€é”ç­‰å¾…ç­‰è¿›è¡Œç›‘æ§ï¼Œè¿™äº›éƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹æ•°æ®åº“çš„è¿è¡ŒçŠ¶æ€æœ‰æ›´å…¨é¢çš„è®¤è¯†ã€‚</p></li></ul><hr><h3 id="1-3-è°ƒä¼˜çš„ç»´åº¦å’Œæ­¥éª¤">1.3 è°ƒä¼˜çš„ç»´åº¦å’Œæ­¥éª¤</h3><p>æˆ‘ä»¬éœ€è¦è°ƒä¼˜çš„å¯¹è±¡æ˜¯æ•´ä¸ªæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå®ƒä¸ä»…åŒ…æ‹¬ SQL æŸ¥è¯¢ï¼Œè¿˜åŒ…æ‹¬æ•°æ®åº“çš„éƒ¨ç½²é…ç½®ã€æ¶æ„ ç­‰ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬æ€è€ƒçš„ç»´åº¦å°±ä¸ä»…ä»…å±€é™åœ¨ SQL ä¼˜åŒ–ä¸Šäº†ã€‚é€šè¿‡å¦‚ä¸‹çš„æ­¥éª¤æˆ‘ä»¬è¿›è¡Œæ¢³ç†ï¼š</p><div class="tabs" id="6631c936-75d9-471b-8fe1-72604ed5d199"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#6631c936-75d9-471b-8fe1-72604ed5d199-1"><i class="fas fa-atom"></i>1</button></li><li class="tab"><button type="button" data-href="#6631c936-75d9-471b-8fe1-72604ed5d199-2"><i class="far fa-sun"></i>2</button></li><li class="tab"><button type="button" data-href="#6631c936-75d9-471b-8fe1-72604ed5d199-3"><i class="fas fa-wind"></i>3</button></li><li class="tab"><button type="button" data-href="#6631c936-75d9-471b-8fe1-72604ed5d199-4"><i class="fas fa-fire-alt"></i>4</button></li><li class="tab"><button type="button" data-href="#6631c936-75d9-471b-8fe1-72604ed5d199-5"><i class="fas fa-heartbeat"></i>5</button></li><li class="tab"><button type="button" data-href="#6631c936-75d9-471b-8fe1-72604ed5d199-6"><i class="fas fa-cookie-bite"></i>6</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="6631c936-75d9-471b-8fe1-72604ed5d199-1"><blockquote><p>ç¬¬1æ­¥ï¼šé€‰æ‹©é€‚åˆçš„ DBMS</p></blockquote><p>å¦‚æœå¯¹<code>äº‹åŠ¡æ€§å¤„ç†</code>ä»¥åŠ<code>å®‰å…¨æ€§è¦æ±‚é«˜</code>çš„è¯ï¼Œå¯ä»¥é€‰æ‹©å•†ä¸šçš„æ•°æ®åº“äº§å“ã€‚è¿™äº›æ•°æ®åº“åœ¨äº‹åŠ¡å¤„ç†å’ŒæŸ¥è¯¢æ€§èƒ½ä¸Šéƒ½æ¯”è¾ƒå¼ºï¼Œæ¯”å¦‚é‡‡ç”¨ SQL Serverã€ Oracleï¼Œé‚£ä¹ˆ<code>å•è¡¨å­˜å‚¨ä¸Šäº¿æ¡æ•°æ®</code>æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚å¦‚æœæ•°æ®è¡¨è®¾è®¡å¾—å¥½ï¼Œå³ä½¿ä¸é‡‡ç”¨<code>åˆ†åº“åˆ†è¡¨</code>çš„æ–¹å¼ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¹Ÿä¸å·®ã€‚</p><p>é™¤æ­¤ä»¥å¤–ï¼Œä½ ä¹Ÿå¯ä»¥é‡‡ç”¨å¼€æºçš„ MySQL è¿›è¡Œå­˜å‚¨ï¼Œå®ƒæœ‰å¾ˆå¤šå­˜å‚¨å¼•æ“å¯ä»¥é€‰æ‹©ï¼Œå¦‚æœè¿›è¡Œäº‹åŠ¡å¤„ç†çš„è¯å¯ä»¥é€‰æ‹© InnoDBï¼Œéäº‹åŠ¡å¤„ç†å¯ä»¥é€‰æ‹© MyISAMã€‚</p><p>NoSQLé˜µè¥åŒ…æ‹¬<code>é”®å€¼å‹æ•°æ®åº“</code>ã€<code>æ–‡æ¡£å‹æ•°æ®åº“</code>ã€<code>æœç´¢å¼•æ“</code>ã€<code>åˆ—å¼å­˜å‚¨</code>å’Œ<code>å›¾å½¢æ•°æ®åº“</code>ã€‚è¿™äº›æ•°æ®åº“çš„ä¼˜ç¼ºç‚¹å’Œä½¿ç”¨åœºæ™¯å„æœ‰ä¸åŒï¼Œæ¯”å¦‚åˆ—å¼å­˜å‚¨æ•°æ®åº“å¯ä»¥å¤§å¹…åº¦é™ä½ç³»ç»Ÿçš„V/0ï¼Œé€‚åˆäºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œä½†å¦‚æœæ•°æ®éœ€è¦é¢‘ç¹åœ°å¢åˆ æ”¹ï¼Œé‚£ä¹ˆåˆ—å¼å­˜å‚¨å°±ä¸å¤ªé€‚ç”¨äº†ã€‚</p><p><span class='p red'>DBMS çš„é€‰æ‹©å…³ç³»åˆ°äº†åé¢çš„æ•´ä¸ªè®¾è®¡è¿‡ç¨‹ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å°±æ˜¯è¦é€‰æ‹©é€‚åˆçš„ DBMSã€‚</span>å¦‚æœå·²ç»ç¡®å®šå¥½äº† DBMSï¼Œé‚£ä¹ˆè¿™æ­¥å¯ä»¥è·³è¿‡ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6631c936-75d9-471b-8fe1-72604ed5d199-2"><blockquote><p>ç¬¬2æ­¥ï¼šä¼˜åŒ–è¡¨è®¾è®¡</p></blockquote><p>é€‰æ‹©äº† DBMS ä¹‹åï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè¡¨è®¾è®¡äº†ã€‚è€Œæ•°æ®è¡¨çš„è®¾è®¡æ–¹å¼ä¹Ÿç›´æ¥å½±å“äº†åç»­çš„ SQL æŸ¥è¯¢è¯­å¥ã€‚RDBMS ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å®šä¹‰ä¸ºä¸€å¼ è¡¨ï¼Œè¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»ä»£è¡¨äº†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚å¦‚æœç”¨çš„æ˜¯ MysQLï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®ä¸åŒè¡¨çš„ä½¿ç”¨éœ€æ±‚ï¼Œé€‰æ‹©ä¸åŒçš„å­˜å‚¨å¼•|æ“ã€‚é™¤æ­¤ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¼˜åŒ–çš„åŸåˆ™å¯ä»¥å‚è€ƒï¼š</p><ol><li><p>è¡¨ç»“æ„è¦å°½é‡<code>éµå¾ªä¸‰èŒƒå¼çš„åŸåˆ™</code>ã€‚è¿™æ ·å¯ä»¥è®©æ•°æ®ç»“æ„æ›´åŠ æ¸…æ™°è§„èŒƒï¼Œå‡å°‘å†—ä½™å­—æ®µï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†åœ¨æ›´æ–°ï¼Œæ’å…¥å’Œåˆ é™¤æ•°æ®æ—¶ç­‰å¼‚å¸¸æƒ…å†µçš„å‘ç”Ÿã€‚</p></li><li><p>å¦‚æœ<code>æŸ¥è¯¢</code>åº”ç”¨æ¯”è¾ƒå¤šï¼Œå°¤å…¶æ˜¯éœ€è¦è¿›è¡Œ<code>å¤šè¡¨è”æŸ¥</code>çš„æ—¶å€™ï¼Œå¯ä»¥é‡‡ç”¨<code>åèŒƒå¼</code>è¿›è¡Œä¼˜åŒ–ã€‚åèŒƒå¼é‡‡ç”¨<code>ç©ºé—´æ¢æ—¶é—´</code>çš„æ–¹å¼ï¼Œé€šè¿‡å¢åŠ å†—ä½™å­—æ®µæé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚<br>3.<code>è¡¨å­—æ®µçš„æ•°æ®ç±»å‹é€‰æ‹©</code>ï¼Œå…³ç³»åˆ°äº†æŸ¥è¯¢æ•ˆç‡çš„é«˜ä½ä»¥åŠå­˜å‚¨ç©ºé—´çš„å¤§å°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå­—æ®µå¯ä»¥é‡‡ç”¨æ•°å€¼ç±»å‹å°±ä¸è¦é‡‡ç”¨å®ç¬¦ç±»å‹ï¼›å®ç¬¦é•¿åº¦è¦å°½å¯èƒ½è®¾è®¡å¾—çŸ­ä¸€äº›ã€‚é’ˆå¯¹å­—ç¬¦ç±»å‹æ¥è¯´ï¼Œå½“ç¡®å®šå­—ç¬¦é•¿åº¦å›ºå®šæ—¶ï¼Œ å°±å¯ä»¥é‡‡ç”¨ CHAR ç±»å‹ï¼›å½“é•¿åº¦ä¸å›ºå®šæ—¶ï¼Œé€šå¸¸é‡‡ç”¨VARCHARç±»å‹ã€‚</p></li></ol><p>æ•°æ®è¡¨çš„ç»“æ„è®¾è®¡å¾ˆåŸºç¡€ï¼Œä¹Ÿå¾ˆå…³é”®ã€‚<span class='p red'>å¥½çš„è¡¨ç»“æ„å¯ä»¥åœ¨ä¸šåŠ¡å‘å±•å’Œç”¨æˆ·é‡å¢åŠ çš„æƒ…å†µä¸‹ä¾ç„¶å‘æŒ¥ä½œç”¨ï¼Œä¸å¥½çš„è¡¨ç»“æ„è®¾è®¡ä¼šè®©æ•°æ®è¡¨å˜å¾—éå¸¸è‡ƒè‚¿ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¹Ÿä¼šé™ä½ã€‚</span></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6631c936-75d9-471b-8fe1-72604ed5d199-3"><blockquote><p>ç¬¬3æ­¥ï¼šä¼˜åŒ–é€»è¾‘æŸ¥è¯¢</p></blockquote><p>å½“æˆ‘ä»¬å»ºç«‹å¥½æ•°æ®è¡¨ä¹‹åï¼Œå°±å¯ä»¥å¯¹æ•°æ®è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ“ä½œäº†ã€‚è¿™æ—¶æˆ‘ä»¬é¦–å…ˆéœ€è¦è€ƒè™‘çš„æ˜¯é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–ã€‚</p><p>SQL æŸ¥è¯¢ä¼˜åŒ–ï¼Œå¯ä»¥åˆ†ä¸º<code>é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–</code>å’Œ<code>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–</code>ã€‚é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–å°±æ˜¯é€šè¿‡æ”¹å˜ SQLè¯­å¥çš„å†…å®¹è®© SQLæ‰§è¡Œæ•ˆç‡æ›´é«˜æ•ˆï¼Œé‡‡ç”¨çš„æ–¹å¼æ˜¯å¯¹ SQLè¯­å¥è¿›è¡Œç­‰ä»·å˜æ¢ï¼Œå¯¹æŸ¥è¯¢è¿›è¡Œé‡å†™ã€‚</p><p><span class='p red'>SQLçš„æŸ¥è¯¢é‡å†™åŒ…æ‹¬äº†å­æŸ¥è¯¢ä¼˜åŒ–ã€ç­‰ä»·è°“è¯é‡å†™ã€è§†å›¾é‡å†™ã€æ¡ä»¶ç®€åŒ–ã€è¿æ¥æ¶ˆé™¤å’ŒåµŒå¥—è¿æ¥æ¶ˆé™¤ç­‰.</span></p><p>æ¯”å¦‚æˆ‘ä»¬åœ¨è®²è§£ EXISTS å­æŸ¥è¯¢å’ŒINå­æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šæ ¹æ®<code>å°è¡¨é©±åŠ¨å¤§è¡¨</code>çš„åŸåˆ™é€‰æ‹©é€‚åˆçš„å­æŸ¥è¯¢ã€‚åœ¨ WHERE å­å¥ä¸­ä¼šå°½é‡é¿å…å¯¹å­—æ®µè¿›è¡Œå‡½æ•°è¿ç®—ï¼Œå®ƒä»¬ä¼šè®©å­—æ®µçš„ç´¢å¼•å¤±æ•ˆã€‚</p><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢è¯„è®ºå†…å®¹å¼€å¤´ä¸º abc çš„å†…å®¹éƒ½æœ‰å“ªäº›ï¼Œå¦‚æœåœ¨ WHERE å­å¥ä¸­ä½¿ç”¨äº†å‡½æ•°ï¼Œè¯­å¥å°±ä¼šå†™æˆä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  comment_id,comment.text,comment_time</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  product_comment</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  <span class="built_in">SUBSTRING</span>(comment.text,<span class="number">1</span>,<span class="number">3</span>)<span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure><p>é‡‡ç”¨æŸ¥è¯¢é‡å†™çš„æ–¹å¼è¿›è¡Œç­‰ä»·æ›¿æ¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  comment_id,comment_text,comment_time </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  product_comment </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  comment_text <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6631c936-75d9-471b-8fe1-72604ed5d199-4"><blockquote><p>ç¬¬4æ­¥ï¼šä¼˜åŒ–ç‰©ç†æŸ¥è¯¢</p></blockquote><p>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–æ˜¯åœ¨ç¡®å®šäº†é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–ä¹‹åï¼Œé‡‡ç”¨ç‰©ç†ä¼˜åŒ–æŠ€æœ¯ï¼ˆæ¯”å¦‚ç´¢å¼•ç­‰ï¼‰ï¼Œé€šè¿‡è®¡ç®—ä»£ä»·æ¨¡å‹å¯¹ å„ç§å¯èƒ½çš„è®¿é—®è·¯å¾„è¿›è¡Œä¼°ç®—ï¼Œä»è€Œæ‰¾åˆ°æ‰§è¡Œæ–¹å¼ä¸­ä»£ä»·æœ€å°çš„ä½œä¸ºæ‰§è¡Œè®¡åˆ’ã€‚<strong>åœ¨è¿™ä¸ªéƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŒæ¡çš„é‡ç‚¹æ˜¯å¯¹ç´¢å¼•çš„åˆ›å»ºå’Œä½¿ç”¨ã€‚</strong></p><p>ä½†ç´¢å¼•ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥åˆ›å»ºç´¢å¼•ã€‚é‚£ä¹ˆéƒ½æœ‰å“ªäº›æƒ…å†µéœ€è¦è€ƒè™‘å‘¢ï¼Ÿæˆ‘ä»¬åœ¨å‰é¢å‡ ç« ä¸­å·²ç»è¿›è¡Œäº†ç»†è‡´çš„å‰–æã€‚</p><p>SQL æŸ¥è¯¢æ—¶éœ€è¦å¯¹ä¸åŒçš„æ•°æ®è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œå› æ­¤åœ¨ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–é˜¶æ®µä¹Ÿéœ€è¦ç¡®å®šè¿™äº›æŸ¥è¯¢æ‰€é‡‡ç”¨çš„è·¯å¾„ï¼Œå…·ä½“çš„æƒ…å†µåŒ…æ‹¬ï¼š</p><ol><li><p>å•è¡¨æ‰«æï¼šå¯¹äºå•è¡¨æ‰«ææ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å…¨è¡¨æ‰«ææ‰€æœ‰çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥å±€éƒ¨æ‰«æã€‚</p></li><li><p>ä¸¤å¼ è¡¨çš„è¿æ¥ï¼šå¸¸ç”¨çš„è¿æ¥æ–¹å¼åŒ…æ‹¬äº†åµŒå¥—å¾ªç¯è¿æ¥ã€HASH è¿æ¥å’Œåˆå¹¶è¿æ¥ã€‚</p></li><li><p>å¤šå¼ è¡¨çš„è¿æ¥ï¼šå¤šå¼ æ•°æ®è¡¨è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼Œé¡ºåºå¾ˆé‡è¦ï¼Œå› ä¸ºä¸åŒçš„è¿æ¥è·¯å¾„æŸ¥è¯¢çš„æ•ˆç‡ä¸åŒï¼Œæœç´¢ç©ºé—´ä¹Ÿä¼šä¸åŒã€‚æˆ‘ä»¬åœ¨è¿›è¡Œå¤šè¡¨è¿æ¥çš„æ—¶å€™ï¼Œæœç´¢ç©ºé—´å¯èƒ½ä¼šè¾¾åˆ°å¾ˆé«˜çš„æ•°æ®é‡çº§ï¼Œå·¨å¤§çš„æœç´¢ç©ºé—´æ˜¾ç„¶ä¼šå ç”¨æ›´å¤šçš„èµ„æºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡è°ƒæ•´è¿æ¥é¡ºåºï¼Œå°†æœç´¢ç©ºé—´è°ƒæ•´åœ¨ä¸€ä¸ªå¯æ¥å—çš„èŒƒå›´å†…ã€‚</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6631c936-75d9-471b-8fe1-72604ed5d199-5"><blockquote><p>ç¬¬5æ­¥ï¼šä½¿ç”¨ Redis æˆ– Memcached ä½œä¸ºç¼“å­˜</p></blockquote><p>é™¤äº†å¯ä»¥å¯¹ SQL æœ¬èº«è¿›è¡Œä¼˜åŒ–ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¯·å¤–æ´æå‡æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p><p>å› ä¸ºæ•°æ®éƒ½æ˜¯å­˜æ”¾åˆ°æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä»æ•°æ®åº“å±‚ä¸­å–å‡ºæ•°æ®æ”¾åˆ°å†…å­˜ä¸­è¿›è¡Œä¸šåŠ¡é€»è¾‘çš„æ“ä½œï¼Œå½“ç”¨ æˆ·é‡å¢å¤§çš„æ—¶å€™ï¼Œå¦‚æœé¢‘ç¹åœ°è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œä¼šæ¶ˆè€—æ•°æ®åº“çš„å¾ˆå¤šèµ„æºã€‚å¦‚æœæˆ‘ä»¬å°†å¸¸ç”¨çš„æ•°æ®ç›´æ¥æ”¾ åˆ°å†…å­˜ä¸­ï¼Œå°±ä¼šå¤§å¹…æå‡æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p><p>é”®å€¼å­˜å‚¨æ•°æ®åº“å¯ä»¥å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>å¸¸ç”¨çš„é”®å€¼å­˜å‚¨æ•°æ®åº“æœ‰ Redis å’Œ Memcachedï¼Œå®ƒä»¬éƒ½å¯ä»¥å°†æ•°æ®å­˜æ”¾åˆ°å†…å­˜ä¸­ã€‚</p><p>ä»å¯é æ€§æ¥è¯´ï¼ŒRedis æ”¯æŒæŒä¹…åŒ–ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„æ•°æ®ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œä¸è¿‡è¿™æ ·ä¸€æ¥æ€§èƒ½æ¶ˆè€—ä¹Ÿä¼šæ¯”è¾ƒå¤§ã€‚è€Œ Memcached ä»…ä»…æ˜¯å†…å­˜å­˜å‚¨ï¼Œä¸æ”¯æŒæŒä¹…åŒ–ã€‚</p><p>ä»æ”¯æŒçš„æ•°æ®ç±»å‹æ¥è¯´ï¼ŒRedis æ¯” Memcached è¦å¤šï¼Œå®ƒä¸ä»…æ”¯æŒ key-value ç±»å‹çš„æ•°æ®ï¼Œè¿˜æ”¯æŒ List, Set, Hash ç­‰æ•°æ®ç»“æ„ã€‚å½“æˆ‘ä»¬æœ‰æŒä¹…åŒ–éœ€æ±‚æˆ–è€…æ˜¯æ›´é«˜çº§çš„æ•°æ®å¤„ç†éœ€æ±‚çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨ Redisã€‚å¦‚æœæ˜¯ç®€å•çš„ key value å­˜å‚¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ Memcachedã€‚</p><p><span class='p red'>é€šå¸¸æˆ‘ä»¬å¯¹äºæŸ¥è¯¢å“åº”è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå“åº”æ—¶é—´çŸ­ï¼Œååé‡å¤§ï¼‰ï¼Œå¯ä»¥è€ƒè™‘å†…å­˜æ•°æ®åº“ï¼Œæ¯•ç«Ÿæœ¯ä¸šæœ‰ä¸“æ”»ã€‚</span>ä¼ ç»Ÿçš„ RDBMS éƒ½æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œè€Œå†…å­˜æ•°æ®åº“åˆ™å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼ŒæŸ¥è¯¢èµ·æ¥è¦å¿«å¾—å¤šã€‚ä¸è¿‡ä½¿ç”¨ä¸åŒçš„å·¥å…·ï¼Œä¹Ÿå¢åŠ äº†å¼€å‘äººå‘˜çš„ä½¿ç”¨æˆæœ¬ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6631c936-75d9-471b-8fe1-72604ed5d199-6"><blockquote><p>ç¬¬6æ­¥ï¼šåº“çº§ä¼˜åŒ–</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707202732911.png" alt="image-20220707202732911"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707203538155.png" alt="image-20220707203538155"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707203607993.png" alt="image-20220707203607993"  /><blockquote><p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ†æ‹†åœ¨æå‡æ•°æ®åº“æ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¢åŠ ç»´æŠ¤å’Œä½¿ç”¨æˆæœ¬ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h2 id="2-ä¼˜åŒ–MySQLæœåŠ¡å™¨">2. ä¼˜åŒ–MySQLæœåŠ¡å™¨</h2><p>ä¼˜åŒ–MySQLæœåŠ¡å™¨ä¸»è¦ä»ä¸¤ä¸ªæ–¹é¢æ¥ä¼˜åŒ–ï¼Œä¸€æ–¹é¢æ˜¯å¯¹ç¡¬ä»¶è¿›è¡Œä¼˜åŒ–ï¼›å¦ä¸€æ–¹é¢æ˜¯å¯¹MySQL æœåŠ¡çš„å‚æ•°è¿›è¡Œä¼˜åŒ–ã€‚è¿™éƒ¨åˆ†çš„å†…å®¹éœ€è¦è¾ƒå…¨é¢çš„çŸ¥è¯†ï¼Œä¸€èˆ¬åªæœ‰ä¸“ä¸šçš„æ•°æ®åº“ç®¡ç†å‘˜æ‰èƒ½è¿›è¡Œè¿™ä¸€ç±»çš„ä¼˜åŒ–ã€‚å¯¹äºå¯ä»¥å®šåˆ¶å‚æ•°çš„æ“ä½œç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹MySQLè¿›è¡Œæ“ä½œç³»ç»Ÿä¼˜åŒ–ã€‚</p><h3 id="2-1-ä¼˜åŒ–æœåŠ¡å™¨ç¡¬ä»¶">2.1 ä¼˜åŒ–æœåŠ¡å™¨ç¡¬ä»¶</h3><p>æœåŠ¡å™¨çš„ç¡¬ä»¶æ€§èƒ½ç›´æ¥å†³å®šç€MySQLæ•°æ®åº“çš„æ€§èƒ½ã€‚ç¡¬ä»¶çš„æ€§èƒ½ç“¶é¢ˆç›´æ¥å†³å®šMySQLæ•°æ®åº“çš„è¿è¡Œé€Ÿåº¦ å’Œæ•ˆç‡ã€‚é’ˆå¯¹æ€§èƒ½ç“¶é¢ˆæé«˜ç¡¬ä»¶é…ç½®ï¼Œå¯ä»¥æé«˜MySQLæ•°æ®åº“æŸ¥è¯¢ã€æ›´æ–°çš„é€Ÿåº¦ã€‚</p><p>ï¼ˆ1ï¼‰<code>é…ç½®è¾ƒå¤§çš„å†…å­˜</code>ã€‚è¶³å¤Ÿå¤§çš„æ˜¾å­˜æ˜¯æé«˜MySQLæ•°æ®åº“æ€§èƒ½çš„æ–¹æ³•ä¹‹ä¸€ã€‚å†…å­˜çš„é€Ÿåº¦æ¯”ç£ç›˜I/Oå¿«å¾—å¤šï¼Œå¯ä»¥é€šè¿‡å¢åŠ ç³»ç»Ÿçš„<code>ç¼“å†²åŒºå®¹é‡</code>ä½¿æ•°æ®åœ¨å†…å­˜ä¸­åœç•™çš„æ—¶é—´æ›´é•¿ï¼Œä»¥<code>å‡å°‘ç£ç›˜I/O</code>ã€‚</p><p>ï¼ˆ2ï¼‰<code>é…ç½®é«˜é€Ÿç£ç›˜ç³»ç»Ÿ</code>ï¼Œä»¥å‡å°‘è¯»ç›˜çš„ç­‰å¾…æ—¶é—´ï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚ç£ç›˜çš„I/Oèƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„å¯»é“èƒ½åŠ›ï¼Œç›®å‰çš„SCSIé«˜é€Ÿæ—‹è½¬çš„æ˜¯7200è½¬/åˆ†é’Ÿï¼Œè¿™æ ·çš„é€Ÿåº¦ï¼Œä¸€æ—¦è®¿é—®çš„ç”¨æˆ·é‡ä¸Šå»ï¼Œç£ç›˜çš„å‹åŠ›å°±ä¼šè¿‡å¤§ï¼Œå¦‚æœæ˜¯æ¯å¤©çš„ç½‘ç«™pv (page view) åœ¨150wï¼Œè¿™æ ·çš„ä¸€èˆ¬çš„é…ç½®å°±æ— æ³•æ»¡è¶³è¿™æ ·çš„éœ€æ±‚äº†ã€‚ç°åœ¨SSDç››è¡Œï¼Œåœ¨SSDä¸Šéšæœºè®¿é—®å’Œé¡ºåºè®¿é—®æ€§èƒ½å·®ä¸å¤šï¼Œä½¿ç”¨SSDå¯ä»¥å‡å°‘éšæœºIOå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p><p>ï¼ˆ3ï¼‰<code>åˆç†åˆ†å¸ƒç£ç›˜I/O</code>ï¼ŒæŠŠç£ç›˜I/Oåˆ†æ•£åœ¨å¤šä¸ªè®¾å¤‡ï¼Œä»¥å‡å°‘èµ„æºç«äº‰ï¼Œæé«˜å†°ç®±æ“ä½œèƒ½åŠ›ã€‚</p><p>ï¼ˆ4ï¼‰<code>é…ç½®å¤šå¤„ç†å™¨</code>, MySQLæ˜¯å¤šçº¿ç¨‹çš„æ•°æ®åº“ï¼Œå¤šå¤„ç†å™¨å¯åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ã€‚</p><h3 id="2-2-ä¼˜åŒ–MySQLçš„å‚æ•°">2.2 ä¼˜åŒ–MySQLçš„å‚æ•°</h3><p>é€šè¿‡ä¼˜åŒ–MySQLçš„å‚æ•°å¯ä»¥æé«˜èµ„æºåˆ©ç”¨ç‡ï¼Œä»è€Œè¾¾åˆ°æé«˜MySQLæœåŠ¡å™¨æ€§èƒ½çš„ç›®çš„ã€‚</p><p>MySQLæœåŠ¡çš„é…ç½®å‚æ•°éƒ½åœ¨my.cnf æˆ–è€…my.ini æ–‡ä»¶çš„[mysqldç»„ä¸­ã€‚é…ç½®å®Œå‚æ•°ä»¥åï¼Œéœ€è¦é‡æ–°å¯åŠ¨MySQLæœåŠ¡æ‰ä¼šç”Ÿæ•ˆã€‚</p><p>ä¸‹é¢å¯¹å‡ ä¸ªå¯¹æ€§èƒ½å½±å“æ¯”è¾ƒå¤§çš„å‚æ•°è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p><ul><li><p>innodb_buffer_pool_size ï¼šè¿™ä¸ªå‚æ•°æ˜¯Mysqlæ•°æ®åº“æœ€é‡è¦çš„å‚æ•°ä¹‹ä¸€ï¼Œè¡¨ç¤ºInnoDBç±»å‹çš„ è¡¨ å’Œç´¢å¼•çš„æœ€å¤§ç¼“å­˜ ã€‚å®ƒä¸ä»…ä»…ç¼“å­˜ ç´¢å¼•æ•°æ® ï¼Œè¿˜ä¼šç¼“å­˜ è¡¨çš„æ•°æ® ã€‚è¿™ä¸ªå€¼è¶Šå¤§ï¼ŒæŸ¥è¯¢çš„é€Ÿåº¦å°±ä¼šè¶Š å¿«ã€‚ä½†æ˜¯è¿™ä¸ªå€¼å¤ªå¤§ä¼šå½±å“æ“ä½œç³»ç»Ÿçš„æ€§èƒ½ã€‚</p></li><li><p>key_buffer_size ï¼šè¡¨ç¤º ç´¢å¼•ç¼“å†²åŒºçš„å¤§å° ã€‚ç´¢å¼•ç¼“å†²åŒºæ˜¯æ‰€æœ‰çš„ çº¿ç¨‹å…±äº« ã€‚å¢åŠ ç´¢å¼•ç¼“å†²åŒºå¯ ä»¥å¾—åˆ°æ›´å¥½å¤„ç†çš„ç´¢å¼•ï¼ˆå¯¹æ‰€æœ‰è¯»å’Œå¤šé‡å†™ï¼‰ã€‚å½“ç„¶ï¼Œè¿™ä¸ªå€¼ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå®ƒçš„å¤§å°å–å†³äºå†…å­˜ çš„å¤§å°ã€‚å¦‚æœè¿™ä¸ªå€¼å¤ªå¤§ï¼Œå°±ä¼šå¯¼è‡´æ“ä½œç³»ç»Ÿé¢‘ç¹æ¢é¡µï¼Œä¹Ÿä¼šé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚å¯¹äºå†…å­˜åœ¨ 4GB å·¦å³ çš„æœåŠ¡å™¨è¯¥å‚æ•°å¯è®¾ç½®ä¸º 256M æˆ– 384M ã€‚</p></li><li><p>table_cache ï¼šè¡¨ç¤º åŒæ—¶æ‰“å¼€çš„è¡¨çš„ä¸ªæ•° ã€‚è¿™ä¸ªå€¼è¶Šå¤§ï¼Œèƒ½å¤ŸåŒæ—¶æ‰“å¼€çš„è¡¨çš„ä¸ªæ•°è¶Šå¤šã€‚ç‰©ç†å†… å­˜è¶Šå¤§ï¼Œè®¾ç½®å°±è¶Šå¤§ã€‚é»˜è®¤ä¸º2402ï¼Œè°ƒåˆ°512-1024æœ€ä½³ã€‚è¿™ä¸ªå€¼ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå› ä¸ºåŒæ—¶æ‰“å¼€çš„è¡¨ å¤ªå¤šä¼šå½±å“æ“ä½œç³»ç»Ÿçš„æ€§èƒ½ã€‚</p></li><li><p>query_cache_size ï¼šè¡¨ç¤º æŸ¥è¯¢ç¼“å†²åŒºçš„å¤§å° ã€‚å¯ä»¥é€šè¿‡åœ¨MySQLæ§åˆ¶å°è§‚å¯Ÿï¼Œå¦‚æœ Qcache_lowmem_prunesçš„å€¼éå¸¸å¤§ï¼Œåˆ™è¡¨æ˜ç»å¸¸å‡ºç°ç¼“å†²ä¸å¤Ÿçš„æƒ…å†µï¼Œå°±è¦å¢åŠ Query_cache_size çš„å€¼ï¼›å¦‚æœQcache_hitsçš„å€¼éå¸¸å¤§ï¼Œåˆ™è¡¨æ˜æŸ¥è¯¢ç¼“å†²ä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œå¦‚æœè¯¥å€¼è¾ƒå°åè€Œä¼šå½±å“æ•ˆ ç‡ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä¸ç”¨æŸ¥è¯¢ç¼“å­˜ï¼›Qcache_free_blocksï¼Œå¦‚æœè¯¥å€¼éå¸¸å¤§ï¼Œåˆ™è¡¨æ˜ç¼“å†²åŒºä¸­ç¢ç‰‡å¾ˆ å¤šã€‚MySQL8.0ä¹‹åå¤±æ•ˆã€‚è¯¥å‚æ•°éœ€è¦å’Œquery_cache_typeé…åˆä½¿ç”¨ã€‚</p></li><li><p>query_cache_type çš„å€¼æ˜¯0æ—¶ï¼Œæ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜åŒºã€‚ä½†æ˜¯query_cache_type=0å¹¶ä¸ ä¼šå¯¼è‡´MySQLé‡Šæ”¾query_cache_sizeæ‰€é…ç½®çš„ç¼“å­˜åŒºå†…å­˜ã€‚</p><ul><li>å½“query_cache_type=1æ—¶ï¼Œæ‰€æœ‰çš„æŸ¥è¯¢éƒ½å°†ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜åŒºï¼Œé™¤éåœ¨æŸ¥è¯¢è¯­å¥ä¸­æŒ‡å®š SQL_NO_CACHE ï¼Œå¦‚SELECT SQL_NO_CACHE * FROM tbl_nameã€‚</li><li>å½“query_cache_type=2æ—¶ï¼Œåªæœ‰åœ¨æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨ SQL_CACHE å…³é”®å­—ï¼ŒæŸ¥è¯¢æ‰ä¼šä½¿ç”¨æŸ¥è¯¢ç¼“ å­˜åŒºã€‚ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜åŒºå¯ä»¥æé«˜æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œè¿™ç§æ–¹å¼åªé€‚ç”¨äºä¿®æ”¹æ“ä½œå°‘ä¸”ç»å¸¸æ‰§è¡Œç›¸åŒçš„ æŸ¥è¯¢æ“ä½œçš„æƒ…å†µã€‚</li></ul></li><li><p>sort_buffer_size ï¼šè¡¨ç¤ºæ¯ä¸ª éœ€è¦è¿›è¡Œæ’åºçš„çº¿ç¨‹åˆ†é…çš„ç¼“å†²åŒºçš„å¤§å° ã€‚å¢åŠ è¿™ä¸ªå‚æ•°çš„å€¼å¯ä»¥ æé«˜ ORDER BY æˆ– GROUP BY æ“ä½œçš„é€Ÿåº¦ã€‚é»˜è®¤æ•°å€¼æ˜¯2 097 144å­—èŠ‚ï¼ˆçº¦2MBï¼‰ã€‚å¯¹äºå†…å­˜åœ¨4GB å·¦å³çš„æœåŠ¡å™¨æ¨èè®¾ç½®ä¸º6-8Mï¼Œå¦‚æœæœ‰100ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå®é™…åˆ†é…çš„æ€»å…±æ’åºç¼“å†²åŒºå¤§å°ä¸º100 Ã— 6 ï¼ 600MBã€‚</p></li><li><p>join_buffer_size = 8M ï¼šè¡¨ç¤º è”åˆæŸ¥è¯¢æ“ä½œæ‰€èƒ½ä½¿ç”¨çš„ç¼“å†²åŒºå¤§å° ï¼Œå’Œsort_buffer_sizeä¸€æ ·ï¼Œ è¯¥å‚æ•°å¯¹åº”çš„åˆ†é…å†…å­˜ä¹Ÿæ˜¯æ¯ä¸ªè¿æ¥ç‹¬äº«ã€‚</p></li><li><p>read_buffer_size ï¼šè¡¨ç¤º æ¯ä¸ªçº¿ç¨‹è¿ç»­æ‰«ææ—¶ä¸ºæ‰«æçš„æ¯ä¸ªè¡¨åˆ†é…çš„ç¼“å†²åŒºçš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ ã€‚å½“çº¿ ç¨‹ä»è¡¨ä¸­è¿ç»­è¯»å–è®°å½•æ—¶éœ€è¦ç”¨åˆ°è¿™ä¸ªç¼“å†²åŒºã€‚SET SESSION read_buffer_size=nå¯ä»¥ä¸´æ—¶è®¾ç½®è¯¥å‚ æ•°çš„å€¼ã€‚é»˜è®¤ä¸º64Kï¼Œå¯ä»¥è®¾ç½®ä¸º4Mã€‚</p></li><li><p>innodb_flush_log_at_trx_commit ï¼šè¡¨ç¤º ä½•æ—¶å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶ ï¼Œå¹¶ä¸”å°†æ—¥å¿—æ–‡ä»¶ å†™å…¥ç£ç›˜ä¸­ã€‚è¯¥å‚æ•°å¯¹äºinnoDBå¼•æ“éå¸¸é‡è¦ã€‚è¯¥å‚æ•°æœ‰3ä¸ªå€¼ï¼Œåˆ†åˆ«ä¸º0ã€1å’Œ2ã€‚è¯¥å‚æ•°çš„é»˜è®¤å€¼ ä¸º1ã€‚</p><ul><li>å€¼ä¸º 0 æ—¶ï¼Œè¡¨ç¤º æ¯ç§’1æ¬¡ çš„é¢‘ç‡å°†æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶å¹¶å°†æ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜ã€‚æ¯ä¸ªäº‹åŠ¡çš„ commitå¹¶ä¸ä¼šè§¦å‘å‰é¢çš„ä»»ä½•æ“ä½œã€‚è¯¥æ¨¡å¼é€Ÿåº¦æœ€å¿«ï¼Œä½†ä¸å¤ªå®‰å…¨ï¼Œmysqldè¿›ç¨‹çš„å´©æºƒä¼šå¯¼ è‡´ä¸Šä¸€ç§’é’Ÿæ‰€æœ‰äº‹åŠ¡æ•°æ®çš„ä¸¢å¤±ã€‚</li><li>å€¼ä¸º 1 æ—¶ï¼Œè¡¨ç¤º æ¯æ¬¡æäº¤äº‹åŠ¡æ—¶ å°†æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶å¹¶å°†æ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜è¿›è¡ŒåŒæ­¥ã€‚è¯¥æ¨¡ å¼æ˜¯æœ€å®‰å…¨çš„ï¼Œä½†ä¹Ÿæ˜¯æœ€æ…¢çš„ä¸€ç§æ–¹å¼ã€‚å› ä¸ºæ¯æ¬¡äº‹åŠ¡æäº¤æˆ–äº‹åŠ¡å¤–çš„æŒ‡ä»¤éƒ½éœ€è¦æŠŠæ—¥å¿—å†™å…¥ ï¼ˆflushï¼‰ç¡¬ç›˜ã€‚</li><li>å€¼ä¸º 2 æ—¶ï¼Œè¡¨ç¤º æ¯æ¬¡æäº¤äº‹åŠ¡æ—¶ å°†æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œ æ¯éš”1ç§’ å°†æ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜ã€‚è¯¥æ¨¡ å¼é€Ÿåº¦è¾ƒå¿«ï¼Œä¹Ÿæ¯”0å®‰å…¨ï¼Œåªæœ‰åœ¨æ“ä½œç³»ç»Ÿå´©æºƒæˆ–è€…ç³»ç»Ÿæ–­ç”µçš„æƒ…å†µä¸‹ï¼Œä¸Šä¸€ç§’é’Ÿæ‰€æœ‰äº‹åŠ¡æ•° æ®æ‰å¯èƒ½ä¸¢å¤±ã€‚</li></ul></li><li><p>innodb_log_buffer_size ï¼šè¿™æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„ äº‹åŠ¡æ—¥å¿—æ‰€ä½¿ç”¨çš„ç¼“å†²åŒº ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œ ä¹Ÿæ˜¯å…ˆå°†ä¿¡æ¯å†™å…¥ Innodb Log Buffer ä¸­ï¼Œå½“æ»¡è¶³ innodb_flush_log_trx_commit å‚æ•°æ‰€è®¾ç½®çš„ç›¸åº”æ¡ ä»¶ï¼ˆæˆ–è€…æ—¥å¿—ç¼“å†²åŒºå†™æ»¡ï¼‰ä¹‹åï¼Œæ‰ä¼šå°†æ—¥å¿—å†™åˆ°æ–‡ä»¶ï¼ˆæˆ–è€…åŒæ­¥åˆ°ç£ç›˜ï¼‰ä¸­ã€‚</p></li><li><p>max_connections ï¼šè¡¨ç¤º å…è®¸è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æœ€å¤§æ•°é‡ ï¼Œé»˜è®¤å€¼æ˜¯ 151 ã€‚å¦‚æœçŠ¶æ€å˜é‡ connection_errors_max_connections ä¸ä¸ºé›¶ï¼Œå¹¶ä¸”ä¸€ç›´å¢é•¿ï¼Œåˆ™è¯´æ˜ä¸æ–­æœ‰è¿æ¥è¯·æ±‚å› æ•°æ®åº“è¿æ¥ æ•°å·²è¾¾åˆ°å…è®¸æœ€å¤§å€¼è€Œå¤±è´¥ï¼Œè¿™æ˜¯å¯ä»¥è€ƒè™‘å¢å¤§max_connections çš„å€¼ã€‚åœ¨Linux å¹³å°ä¸‹ï¼Œæ€§èƒ½å¥½çš„ æœåŠ¡å™¨ï¼Œæ”¯æŒ 500-1000 ä¸ªè¿æ¥ä¸æ˜¯éš¾äº‹ï¼Œéœ€è¦æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è¿›è¡Œè¯„ä¼°è®¾å®šã€‚è¿™ä¸ªè¿æ¥æ•° ä¸æ˜¯è¶Šå¤§ è¶Šå¥½ ï¼Œå› ä¸ºè¿™äº›è¿æ¥ä¼šæµªè´¹å†…å­˜çš„èµ„æºã€‚è¿‡å¤šçš„è¿æ¥å¯èƒ½ä¼šå¯¼è‡´MySQLæœåŠ¡å™¨åƒµæ­»ã€‚</p></li><li><p>back_log ï¼šç”¨äº æ§åˆ¶MySQLç›‘å¬TCPç«¯å£æ—¶è®¾ç½®çš„ç§¯å‹è¯·æ±‚æ ˆå¤§å° ã€‚å¦‚æœMySqlçš„è¿æ¥æ•°è¾¾åˆ° max_connectionsæ—¶ï¼Œæ–°æ¥çš„è¯·æ±‚å°†ä¼šè¢«å­˜åœ¨å †æ ˆä¸­ï¼Œä»¥ç­‰å¾…æŸä¸€è¿æ¥é‡Šæ”¾èµ„æºï¼Œè¯¥å †æ ˆçš„æ•°é‡å³ back_logï¼Œå¦‚æœç­‰å¾…è¿æ¥çš„æ•°é‡è¶…è¿‡back_logï¼Œå°†ä¸è¢«æˆäºˆè¿æ¥èµ„æºï¼Œå°†ä¼šæŠ¥é”™ã€‚5.6.6 ç‰ˆæœ¬ä¹‹å‰é»˜ è®¤å€¼ä¸º 50 ï¼Œ ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤ä¸º 50 + ï¼ˆmax_connections / 5ï¼‰ï¼Œ å¯¹äºLinuxç³»ç»Ÿæ¨èè®¾ç½®ä¸ºå°äº512 çš„æ•´æ•°ï¼Œä½†æœ€å¤§ä¸è¶…è¿‡900ã€‚</p><p>å¦‚æœéœ€è¦æ•°æ®åº“åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å¤„ç†å¤§é‡è¿æ¥è¯·æ±‚ï¼Œ å¯ä»¥è€ƒè™‘é€‚å½“å¢å¤§back_log çš„å€¼ã€‚</p></li><li><p>thread_cache_size ï¼š çº¿ç¨‹æ± ç¼“å­˜çº¿ç¨‹æ•°é‡çš„å¤§å° ï¼Œå½“å®¢æˆ·ç«¯æ–­å¼€è¿æ¥åå°†å½“å‰çº¿ç¨‹ç¼“å­˜èµ·æ¥ï¼Œ å½“åœ¨æ¥åˆ°æ–°çš„è¿æ¥è¯·æ±‚æ—¶å¿«é€Ÿå“åº”æ— éœ€åˆ›å»ºæ–°çš„çº¿ç¨‹ ã€‚è¿™å°¤å…¶å¯¹é‚£äº›ä½¿ç”¨çŸ­è¿æ¥çš„åº”ç”¨ç¨‹åºæ¥è¯´å¯ ä»¥æå¤§çš„æé«˜åˆ›å»ºè¿æ¥çš„æ•ˆç‡ã€‚é‚£ä¹ˆä¸ºäº†æé«˜æ€§èƒ½å¯ä»¥å¢å¤§è¯¥å‚æ•°çš„å€¼ã€‚é»˜è®¤ä¸º60ï¼Œå¯ä»¥è®¾ç½®ä¸º 120ã€‚</p><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‡ ä¸ªMySQLçŠ¶æ€å€¼æ¥é€‚å½“è°ƒæ•´çº¿ç¨‹æ± çš„å¤§å°ï¼š</p></li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Thread%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Threads_cached <span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Threads_connected <span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Threads_created <span class="operator">|</span> <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Threads_running <span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+-------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>å½“ Threads_cached è¶Šæ¥è¶Šå°‘ï¼Œä½† Threads_connected å§‹ç»ˆä¸é™ï¼Œä¸” Threads_created æŒç»­å‡é«˜ï¼Œå¯ é€‚å½“å¢åŠ  thread_cache_size çš„å¤§å°ã€‚</p><ul><li><p>wait_timeout ï¼šæŒ‡å®š ä¸€ä¸ªè¯·æ±‚çš„æœ€å¤§è¿æ¥æ—¶é—´ ï¼Œå¯¹äº4GBå·¦å³å†…å­˜çš„æœåŠ¡å™¨å¯ä»¥è®¾ç½®ä¸º5-10ã€‚</p></li><li><p>interactive_timeout ï¼šè¡¨ç¤ºæœåŠ¡å™¨åœ¨å…³é—­è¿æ¥å‰ç­‰å¾…è¡ŒåŠ¨çš„ç§’æ•°ã€‚</p></li></ul><p>è¿™é‡Œç»™å‡ºä¸€ä»½my.cnfçš„å‚è€ƒé…ç½®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mysqld]</span><br><span class="line">port <span class="operator">=</span> <span class="number">3306</span> </span><br><span class="line">serverid <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line">socket <span class="operator">=</span> <span class="operator">/</span>tmp<span class="operator">/</span>mysql.sock </span><br><span class="line"><span class="keyword">skip</span><span class="operator">-</span>locking #é¿å…MySQLçš„å¤–éƒ¨é”å®šï¼Œå‡å°‘å‡ºé”™å‡ ç‡å¢å¼ºç¨³å®šæ€§ã€‚ </span><br><span class="line"><span class="keyword">skip</span><span class="operator">-</span>name<span class="operator">-</span>resolve #ç¦æ­¢MySQLå¯¹å¤–éƒ¨è¿æ¥è¿›è¡ŒDNSè§£æï¼Œä½¿ç”¨è¿™ä¸€é€‰é¡¹å¯ä»¥æ¶ˆé™¤MySQLè¿›è¡ŒDNSè§£æçš„æ—¶é—´ã€‚ä½†éœ€è¦æ³¨æ„ï¼Œå¦‚æœå¼€å¯è¯¥é€‰é¡¹ï¼Œåˆ™æ‰€æœ‰è¿œç¨‹ä¸»æœºè¿æ¥æˆæƒéƒ½è¦ä½¿ç”¨IPåœ°å€æ–¹å¼ï¼Œå¦åˆ™MySQLå°†æ— æ³•æ­£å¸¸å¤„ç†è¿æ¥è¯·æ±‚ï¼ </span><br><span class="line">back_log <span class="operator">=</span> <span class="number">384</span></span><br><span class="line">key_buffer_size <span class="operator">=</span> <span class="number">256</span>M </span><br><span class="line">max_allowed_packet <span class="operator">=</span> <span class="number">4</span>M </span><br><span class="line">thread_stack <span class="operator">=</span> <span class="number">256</span>K</span><br><span class="line">table_cache <span class="operator">=</span> <span class="number">128</span>K </span><br><span class="line">sort_buffer_size <span class="operator">=</span> <span class="number">6</span>M </span><br><span class="line">read_buffer_size <span class="operator">=</span> <span class="number">4</span>M</span><br><span class="line">read_rnd_buffer_size<span class="operator">=</span><span class="number">16</span>M </span><br><span class="line">join_buffer_size <span class="operator">=</span> <span class="number">8</span>M </span><br><span class="line">myisam_sort_buffer_size <span class="operator">=</span><span class="number">64</span>M </span><br><span class="line">table_cache <span class="operator">=</span> <span class="number">512</span> </span><br><span class="line">thread_cache_size <span class="operator">=</span> <span class="number">64</span> </span><br><span class="line">query_cache_size <span class="operator">=</span> <span class="number">64</span>M</span><br><span class="line">tmp_table_size <span class="operator">=</span> <span class="number">256</span>M </span><br><span class="line">max_connections <span class="operator">=</span> <span class="number">768</span> </span><br><span class="line">max_connect_errors <span class="operator">=</span> <span class="number">10000000</span></span><br><span class="line">wait_timeout <span class="operator">=</span> <span class="number">10</span> </span><br><span class="line">thread_concurrency <span class="operator">=</span> <span class="number">8</span> #è¯¥å‚æ•°å–å€¼ä¸ºæœåŠ¡å™¨é€»è¾‘CPUæ•°é‡<span class="operator">*</span><span class="number">2</span>ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼ŒæœåŠ¡å™¨æœ‰<span class="number">2</span>é¢—ç‰©ç†CPUï¼Œè€Œæ¯é¢—ç‰©ç†CPUåˆæ”¯æŒH.Tè¶…çº¿ç¨‹ï¼Œæ‰€ä»¥å®é™…å–å€¼ä¸º<span class="number">4</span><span class="operator">*</span><span class="number">2</span><span class="operator">=</span><span class="number">8</span></span><br><span class="line"><span class="keyword">skip</span><span class="operator">-</span>networking #å¼€å¯è¯¥é€‰é¡¹å¯ä»¥å½»åº•å…³é—­MySQLçš„TCP<span class="operator">/</span>IPè¿æ¥æ–¹å¼ï¼Œå¦‚æœWEBæœåŠ¡å™¨æ˜¯ä»¥è¿œç¨‹è¿æ¥çš„æ–¹å¼è®¿é—®MySQLæ•°æ®åº“æœåŠ¡å™¨åˆ™ä¸è¦å¼€å¯è¯¥é€‰é¡¹ï¼å¦åˆ™å°†æ— æ³•æ­£å¸¸è¿æ¥ï¼ </span><br><span class="line">table_cache<span class="operator">=</span><span class="number">1024</span></span><br><span class="line">innodb_additional_mem_pool_size<span class="operator">=</span><span class="number">4</span>M #é»˜è®¤ä¸º<span class="number">2</span>M </span><br><span class="line">innodb_flush_log_at_trx_commit<span class="operator">=</span><span class="number">1</span></span><br><span class="line">innodb_log_buffer_size<span class="operator">=</span><span class="number">2</span>M #é»˜è®¤ä¸º<span class="number">1</span>M </span><br><span class="line">innodb_thread_concurrency<span class="operator">=</span><span class="number">8</span> #ä½ çš„æœåŠ¡å™¨CPUæœ‰å‡ ä¸ªå°±è®¾ç½®ä¸ºå‡ ã€‚å»ºè®®ç”¨é»˜è®¤ä¸€èˆ¬ä¸º<span class="number">8</span> </span><br><span class="line">tmp_table_size<span class="operator">=</span><span class="number">64</span>M #é»˜è®¤ä¸º<span class="number">16</span>Mï¼Œè°ƒåˆ°<span class="number">64</span><span class="number">-256</span>æœ€æŒ‚</span><br><span class="line">thread_cache_size<span class="operator">=</span><span class="number">120</span> </span><br><span class="line">query_cache_size<span class="operator">=</span><span class="number">32</span>M</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šæƒ…å†µè¿˜éœ€è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼</p><p><strong>ä¸¾ä¾‹ï¼š</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707210351452.png" alt="image-20220707210351452"  /><p><strong>(1) è°ƒæ•´ç³»ç»Ÿå‚æ•° InnoDB_flush_log_at_trx_commit</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707210447501.png" alt="image-20220707210447501"  /><p><strong>(2)  è°ƒæ•´ç³»ç»Ÿå‚æ•° InnoDB_buffer_pool_size</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707210555848.png" alt="image-20220707210555848"  /><p><strong>(3) è°ƒæ•´ç³»ç»Ÿå‚æ•° InnoDB_buffer_pool_instances</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707210720394.png" alt="image-20220707210720394"  /><h2 id="3-ä¼˜åŒ–æ•°æ®åº“ç»“æ„">3. ä¼˜åŒ–æ•°æ®åº“ç»“æ„</h2><p>ä¸€ä¸ªå¥½çš„æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆå¯¹äºæ•°æ®åº“çš„æ€§èƒ½å¸¸å¸¸ä¼šèµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœï¼åˆç†çš„æ•°æ®åº“ç»“æ„ä¸ä»…å¯ä»¥ä½¿æ•°æ®åº“å ç”¨æ›´å°çš„ç£ç›˜ç©ºé—´ï¼Œè€Œä¸”èƒ½å¤Ÿä½¿æŸ¥è¯¢é€Ÿåº¦æ›´å¿«ã€‚æ•°æ®åº“ç»“æ„çš„è®¾è®¡éœ€è¦è€ƒè™‘<code>æ•°æ®å†—ä½™</code>ã€<code>æŸ¥è¯¢å’Œæ›´æ–°çš„é€Ÿåº¦</code>ã€<code>å­—æ®µçš„æ•°æ®ç±»å‹</code>æ˜¯å¦åˆç†ç­‰å¤šæ–¹é¢çš„å†…å®¹ã€‚</p><hr><h3 id="3-1-æ‹†åˆ†è¡¨ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»">3.1 æ‹†åˆ†è¡¨ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»</h3><p>æ‹†åˆ†è¡¨çš„æ€è·¯æ˜¯ï¼ŒæŠŠ1ä¸ªåŒ…å«å¾ˆå¤šå­—æ®µçš„è¡¨æ‹†åˆ†æˆ2ä¸ªæˆ–è€…å¤šä¸ªç›¸å¯¹è¾ƒå°çš„è¡¨ã€‚è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œè¿™äº›è¡¨ä¸­æŸäº›å­—æ®µçš„æ“ä½œé¢‘ç‡å¾ˆé«˜ï¼ˆ<code>çƒ­æ•°æ®</code>ï¼‰ï¼Œç»å¸¸è¦è¿›è¡ŒæŸ¥è¯¢æˆ–è€…æ›´æ–°æ“ä½œï¼Œè€Œå¦å¤–ä¸€äº›å­—æ®µçš„ä½¿ç”¨é¢‘ç‡å´å¾ˆä½ï¼ˆ<code>å†·æ•°æ®</code>ï¼‰ï¼Œ<code>å†·çƒ­æ•°æ®åˆ†ç¦»</code>ï¼Œå¯ä»¥å‡å°è¡¨çš„å®½åº¦ã€‚å¦‚æœæ”¾åœ¨ä¸€ä¸ªè¡¨é‡Œé¢ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½è¦è¯»å–å¤§è®°å½•ï¼Œä¼šæ¶ˆè€—è¾ƒå¤šçš„èµ„æºã€‚</p><p>MySQLé™åˆ¶æ¯ä¸ªè¡¨æœ€å¤šå­˜å‚¨<code>4096åˆ—</code>ï¼Œå¹¶ä¸”æ¯ä¸€è¡Œæ•°æ®çš„å¤§å°ä¸èƒ½è¶…è¿‡<code>65535å­—èŠ‚</code>ã€‚è¡¨è¶Šå®½ï¼ŒæŠŠè¡¨è£…è½½è¿›å†…å­˜ç¼“å†²æ± æ—¶æ‰€å ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ï¼Œä¹Ÿä¼šæ¶ˆè€—æ›´å¤šçš„10ã€‚<code>å†·çƒ­æ•°æ®åˆ†ç¦»çš„ç›®çš„</code>æ˜¯ï¼šâ‘ å‡å°‘ç£ç›˜IOï¼Œä¿è¯çƒ­æ•°æ®çš„å†…å­˜ç¼“å­˜å‘½ä¸­ç‡ã€‚â‘¡æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç¼“å­˜ï¼Œé¿å…è¯»å…¥æ— ç”¨çš„å†·æ•°æ®ã€‚</p><p>ä¸¾ä¾‹1ï¼š**<code>ä¼šå‘˜membersè¡¨</code>å­˜å‚¨ä¼šå‘˜ç™»å½•è®¤è¯ä¿¡æ¯ï¼Œè¯¥è¡¨ä¸­æœ‰å¾ˆå¤šå­—æ®µï¼Œå¦‚idã€å§“åã€å¯†ç ã€åœ°å€ã€ç”µ è¯ã€ä¸ªäººæè¿°å­—æ®µã€‚å…¶ä¸­åœ°å€ã€ç”µè¯ã€ä¸ªäººæè¿°ç­‰å­—æ®µå¹¶ä¸å¸¸ç”¨ï¼Œå¯ä»¥å°†è¿™äº›ä¸å¸¸ç”¨çš„å­—æ®µåˆ†è§£å‡ºå¦ä¸€ ä¸ªè¡¨ã€‚å°†è¿™ä¸ªè¡¨å–åå«members_detailï¼Œè¡¨ä¸­æœ‰member_idã€addressã€telephoneã€descriptionç­‰å­—æ®µã€‚ è¿™æ ·å°±æŠŠä¼šå‘˜è¡¨åˆ†æˆäº†ä¸¤ä¸ªè¡¨ï¼Œåˆ†åˆ«ä¸º<code>membersè¡¨</code>å’Œ<code>members_detailè¡¨</code>ã€‚</p><p>åˆ›å»ºè¿™ä¸¤ä¸ªè¡¨çš„SQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> members (</span><br><span class="line">    id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    password <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    last_login_time datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    last_login_ip <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(Id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> members_detail (</span><br><span class="line">    Member_id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    address <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    telephone <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    description text</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦æŸ¥è¯¢ä¼šå‘˜çš„åŸºæœ¬ä¿¡æ¯æˆ–è¯¦ç»†ä¿¡æ¯ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¼šå‘˜çš„idæ¥æŸ¥è¯¢ã€‚å¦‚æœéœ€è¦å°†ä¼šå‘˜çš„åŸºæœ¬ä¿¡æ¯å’Œ è¯¦ç»†ä¿¡æ¯åŒæ—¶æ˜¾ç¤ºï¼Œé‚£ä¹ˆå¯ä»¥å°†membersè¡¨å’Œmembers_detailè¡¨è¿›è¡Œè”åˆæŸ¥è¯¢ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> members <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> members_detail <span class="keyword">on</span> members.id <span class="operator">=</span></span><br><span class="line">members_detail.member_id;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§åˆ†è§£å¯ä»¥æé«˜è¡¨çš„æŸ¥è¯¢æ•ˆç‡ã€‚å¯¹äºå­—æ®µå¾ˆå¤šä¸”æœ‰äº›å­—æ®µä½¿ç”¨ä¸é¢‘ç¹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡è¿™ç§åˆ†è§£çš„æ–¹å¼æ¥ä¼˜åŒ–æ•°æ®åº“çš„æ€§èƒ½ã€‚</p><h3 id="3-2-å¢åŠ ä¸­é—´è¡¨">3.2 å¢åŠ ä¸­é—´è¡¨</h3><p>å¯¹äºéœ€è¦ç»å¸¸è”åˆæŸ¥è¯¢çš„è¡¨ï¼Œå¯ä»¥å»ºç«‹ä¸­é—´è¡¨ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚é€šè¿‡å»ºç«‹ä¸­é—´è¡¨ï¼Œ<span class='p red'>æŠŠéœ€è¦ç»å¸¸è”åˆæŸ¥è¯¢çš„æ•°æ®æ’å…¥ä¸­é—´è¡¨ä¸­ï¼Œç„¶åå°†åŸæ¥çš„è”åˆæŸ¥è¯¢æ”¹ä¸ºå¯¹ä¸­é—´è¡¨çš„æŸ¥è¯¢ï¼Œä»¥æ­¤æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</span></p><p>é¦–å…ˆï¼Œåˆ†æç»å¸¸è”åˆæŸ¥è¯¢è¡¨ä¸­çš„å­—æ®µï¼›ç„¶åï¼Œä½¿ç”¨è¿™äº›å­—æ®µå»ºç«‹ä¸€ä¸ªä¸­é—´è¡¨ï¼Œå¹¶å°†åŸæ¥è”åˆæŸ¥è¯¢çš„è¡¨çš„æ•°æ®æ’å…¥ä¸­é—´è¡¨ä¸­ï¼›æœ€åï¼Œä½¿ç”¨ä¸­é—´è¡¨æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>ä¸¾ä¾‹1ï¼š å­¦ç”Ÿä¿¡æ¯è¡¨ å’Œ ç­çº§è¡¨ çš„SQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`class`(</span><br><span class="line">`id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`className`<span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`address`<span class="type">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`monitor`<span class="type">INT</span> <span class="keyword">NULL</span> ,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`student`(</span><br><span class="line">`id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`stuno`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">`name`<span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`age`<span class="type">INT</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`classId`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æœ‰ä¸€ä¸ªæ¨¡å—éœ€è¦ç»å¸¸æŸ¥è¯¢å¸¦æœ‰å­¦ç”Ÿåç§°ï¼ˆnameï¼‰ã€å­¦ç”Ÿæ‰€åœ¨ç­çº§åç§°ï¼ˆclassNameï¼‰ã€å­¦ç”Ÿç­çº§ç­ é•¿ï¼ˆmonitorï¼‰çš„å­¦ç”Ÿä¿¡æ¯ã€‚æ ¹æ®è¿™ç§æƒ…å†µå¯ä»¥åˆ›å»ºä¸€ä¸ª temp_student è¡¨ã€‚temp_studentè¡¨ä¸­å­˜å‚¨å­¦ç”Ÿåç§°ï¼ˆstu_nameï¼‰ã€å­¦ç”Ÿæ‰€åœ¨ç­çº§åç§°ï¼ˆclassNameï¼‰å’Œå­¦ç”Ÿç­çº§ç­é•¿ï¼ˆmonitorï¼‰ä¿¡æ¯ã€‚åˆ›å»ºè¡¨çš„è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`temp_student`(</span><br><span class="line">`id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`stu_name`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">`className`<span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`monitor`<span class="type">INT</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œä»å­¦ç”Ÿä¿¡æ¯è¡¨å’Œç­çº§è¡¨ä¸­æŸ¥è¯¢ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> temp_student(stu_name,className,monitor)</span><br><span class="line">            <span class="keyword">select</span> s.name,c.className,c.monitor</span><br><span class="line">            <span class="keyword">from</span> student <span class="keyword">as</span> s,class <span class="keyword">as</span> c</span><br><span class="line">            <span class="keyword">where</span> s.classId <span class="operator">=</span> c.id</span><br></pre></td></tr></table></figure><p>ä»¥åï¼Œå¯ä»¥ç›´æ¥ä»temp_studentè¡¨ä¸­æŸ¥è¯¢å­¦ç”Ÿåç§°ã€ç­çº§åç§°å’Œç­çº§ç­é•¿ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½è¿›è¡Œè”åˆæŸ¥ è¯¢ã€‚è¿™æ ·å¯ä»¥æé«˜æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p><h3 id="3-3-å¢åŠ å†—ä½™å­—æ®µ">3.3 å¢åŠ å†—ä½™å­—æ®µ</h3><p>è®¾è®¡æ•°æ®åº“è¡¨æ—¶åº”å°½é‡éµå¾ªèŒƒå¼ç†è®ºçš„è§„çº¦ï¼Œå°½å¯èƒ½å‡å°‘å†—ä½™å­—æ®µï¼Œè®©æ•°æ®åº“è®¾è®¡çœ‹èµ·æ¥ç²¾è‡´ã€ä¼˜é›…ã€‚ ä½†æ˜¯ï¼Œåˆç†åœ°åŠ å…¥å†—ä½™å­—æ®µå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>è¡¨çš„è§„èŒƒåŒ–ç¨‹åº¦è¶Šé«˜ï¼Œè¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»å°±è¶Šå¤šï¼Œéœ€è¦è¿æ¥æŸ¥è¯¢çš„æƒ…å†µä¹Ÿå°±è¶Šå¤šã€‚å°¤å…¶åœ¨æ•°æ®é‡å¤§ï¼Œè€Œ ä¸”éœ€è¦é¢‘ç¹è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼Œä¸ºäº†æå‡æ•ˆç‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘å¢åŠ å†—ä½™å­—æ®µæ¥å‡å°‘è¿æ¥ã€‚</p><p>è¿™éƒ¨åˆ†å†…å®¹åœ¨ã€Šæ•°æ®åº“çš„è®¾è®¡è§„èŒƒã€‹ç« èŠ‚ä¸­ åèŒƒå¼åŒ–å°èŠ‚ ä¸­å…·ä½“å±•å¼€è®²è§£äº†ã€‚è¿™é‡Œçœç•¥ã€‚</p><h3 id="3-4-ä¼˜åŒ–æ•°æ®ç±»å‹">3.4 ä¼˜åŒ–æ•°æ®ç±»å‹</h3><p>æ”¹è¿›è¡¨çš„è®¾è®¡æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä¼˜åŒ–å­—æ®µçš„æ•°æ®ç±»å‹ã€‚è¿™ä¸ªé—®é¢˜åœ¨å¤§å®¶åˆšä»äº‹å¼€å‘æ—¶åŸºæœ¬ä¸ç®—æ˜¯é—®é¢˜ã€‚ä½†æ˜¯ï¼Œéšç€ä½ çš„ç»éªŒè¶Šæ¥è¶Šä¸°å¯Œï¼Œå‚ä¸çš„é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œæ•°æ®é‡ä¹Ÿè¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œä½ å°±ä¸èƒ½åªä»ç³»ç»Ÿç¨³å®šæ€§çš„è§’åº¦æ¥æ€è€ƒé—®é¢˜äº†ï¼Œè¿˜è¦è€ƒè™‘åˆ°ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§å’Œæ•ˆç‡ã€‚æ­¤æ—¶ï¼Œ<span class='p red'>ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹ã€‚</span></p><p>åˆ—çš„å­—æ®µè¶Šå¤§ï¼Œå»ºç«‹ç´¢å¼•æ—¶æ‰€éœ€è¦çš„ç©ºé—´ä¹Ÿå°±è¶Šå¤§ï¼Œè¿™æ ·ä¸€é¡µä¸­æ‰€èƒ½å­˜å‚¨çš„ç´¢å¼•èŠ‚ç‚¹çš„æ•°é‡ä¹Ÿå°±è¶Šå°‘ï¼Œåœ¨éå†æ—¶æ‰€éœ€è¦çš„IOæ¬¡æ•°ä¹Ÿå°±è¶Šå¤šï¼Œ ç´ å¼•çš„æ€§èƒ½ä¹Ÿå°±è¶Šå·®ã€‚</p><p><strong>æƒ…å†µ1ï¼šå¯¹æ•´æ•°ç±»å‹æ•°æ®è¿›è¡Œä¼˜åŒ–ã€‚</strong></p><p>é‡åˆ°æ•´æ•°ç±»å‹çš„å­—æ®µå¯ä»¥ç”¨ INT å‹ ã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯ï¼ŒINT å‹æ•°æ®æœ‰è¶³å¤Ÿå¤§çš„å–å€¼èŒƒå›´ï¼Œä¸ç”¨æ‹…å¿ƒæ•° æ®è¶…å‡ºå–å€¼èŒƒå›´çš„é—®é¢˜ã€‚åˆšå¼€å§‹åšé¡¹ç›®çš„æ—¶å€™ï¼Œé¦–å…ˆè¦ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œè¿™æ ·è®¾è®¡å­—æ®µç±»å‹æ˜¯å¯ä»¥ çš„ã€‚ä½†åœ¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œæ•°æ®ç±»å‹çš„å®šä¹‰ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¼šå½±å“åˆ°ç³»ç»Ÿæ•´ä½“çš„æ‰§è¡Œæ•ˆç‡ã€‚</p><p>å¯¹äº éè´Ÿå‹ çš„æ•°æ®ï¼ˆå¦‚è‡ªå¢IDã€æ•´å‹IPï¼‰æ¥è¯´ï¼Œè¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹ UNSIGNED æ¥å­˜å‚¨ã€‚å› ä¸ºæ— ç¬¦å· ç›¸å¯¹äºæœ‰ç¬¦å·ï¼ŒåŒæ ·çš„å­—èŠ‚æ•°ï¼Œå­˜å‚¨çš„æ•°å€¼èŒƒå›´æ›´å¤§ã€‚å¦‚tinyintæœ‰ç¬¦å·ä¸º-128-127ï¼Œæ— ç¬¦å·ä¸º0-255ï¼Œå¤š å‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´ã€‚</p><p><strong>æƒ…å†µ2ï¼šæ—¢å¯ä»¥ä½¿ç”¨æ–‡æœ¬ç±»å‹ä¹Ÿå¯ä»¥ä½¿ç”¨æ•´æ•°ç±»å‹çš„å­—æ®µï¼Œè¦é€‰æ‹©ä½¿ç”¨æ•´æ•°ç±»å‹ã€‚</strong></p><p>è·Ÿæ–‡æœ¬ç±»å‹æ•°æ®ç›¸æ¯”ï¼Œå¤§æ•´æ•°å¾€å¾€å ç”¨æ›´å°‘çš„å­˜å‚¨ç©ºé—´ ï¼Œå› æ­¤ï¼Œåœ¨å­˜å–å’Œæ¯”å¯¹çš„æ—¶å€™ï¼Œå¯ä»¥å ç”¨æ›´å°‘çš„ å†…å­˜ç©ºé—´ã€‚æ‰€ä»¥ï¼Œåœ¨äºŒè€…çš†å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨æ•´æ•°ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚å¦‚ï¼šå°†IPåœ° å€è½¬æ¢æˆæ•´å‹æ•°æ®ã€‚</p><p><strong>æƒ…å†µ3ï¼šé¿å…ä½¿ç”¨TEXTã€BLOBæ•°æ®ç±»å‹</strong></p><p>MySQL<code>å†…å­˜ä¸´æ—¶è¡¨</code>ä¸æ”¯æŒTEXTã€BLOBè¿™æ ·çš„å¤§æ•°æ®ç±»å‹ï¼Œå¦‚æœæŸ¥è¯¢ä¸­åŒ…å«è¿™æ ·çš„æ•°æ®ï¼Œåœ¨æ’åºç­‰æ“ä½œæ—¶ï¼Œå°±ä¸èƒ½ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œå¿…é¡»ä½¿ç”¨<code>ç£ç›˜ä¸´æ—¶è¡¨</code>è¿›è¡Œã€‚å¹¶ä¸”å¯¹äºè¿™ç§æ•°æ®ï¼ŒMySQLè¿˜æ˜¯è¦è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ï¼Œä¼šä½¿SQLæ€§èƒ½å˜å¾—å¾ˆå·®ï¼Œä½†æ˜¯ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ä½¿ç”¨è¿™æ ·çš„æ•°æ®ç±»å‹ã€‚</p><p>å¦‚æœä¸€å®šè¦ä½¿ç”¨ï¼Œå»ºè®®æŠŠBLOBæˆ–æ˜¯TEXTåˆ—<code>åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨</code>ä¸­ï¼ŒæŸ¥è¯¢æ—¶ä¸€å®šä¸è¦ä½¿ç”¨select*ï¼Œè€Œåªéœ€è¦å–å‡ºå¿…è¦çš„åˆ—ï¼Œä¸éœ€è¦TEXTåˆ—çš„æ•°æ®æ—¶ä¸è¦å¯¹è¯¥åˆ—è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p><strong>æƒ…å†µ4ï¼šé¿å…ä½¿ç”¨ENUMç±»å‹</strong></p><p>ä¿®æ”¹ENUMå€¼éœ€è¦ä½¿ç”¨ALTERè¯­å¥ã€‚</p><p>ENUMç±»å‹çš„ORDER BY æ“ä½œæ•ˆç‡ä½ï¼Œéœ€è¦é¢å¤–æ“ä½œã€‚ä½¿ç”¨TINYINTæ¥ä»£æ›¿ENUMç±»å‹ã€‚</p><p><strong>æƒ…å†µ5ï¼šä½¿ç”¨TIMESTAMPå­˜å‚¨æ—¶é—´</strong></p><p>TIMESTAMPå­˜å‚¨çš„æ—¶é—´èŒƒå›´1970-01-01 00:00:01 ~ 2038-01_19-03:14:07ã€‚TIMESTAMPä½¿ç”¨4å­—èŠ‚ï¼ŒDATETIMEä½¿ç”¨8ä¸ªå­—èŠ‚ï¼ŒåŒæ—¶TIMESTAMPå…·æœ‰è‡ªåŠ¨èµ‹å€¼ä»¥åŠè‡ªåŠ¨æ›´æ–°çš„ç‰¹æ€§ã€‚</p><p><strong>æƒ…å†µ6ï¼šç”¨DECIMALä»£æ›¿FLOATå’ŒDOUBLEå­˜å‚¨ç²¾ç¡®æµ®ç‚¹æ•°</strong></p><ol><li>éç²¾å‡†æµ®ç‚¹ï¼š float, double</li><li>ç²¾å‡†æµ®ç‚¹ï¼šdecimal</li></ol><p>Decimalç±»å‹ä¸ºç²¾å‡†æµ®ç‚¹æ•°ï¼Œåœ¨è®¡ç®—æ—¶ä¸ä¼šä¸¢å¤±ç²¾åº¦ï¼Œå°¤å…¶æ˜¯è´¢åŠ¡ç›¸å…³çš„é‡‘èç±»æ•°æ®ã€‚å ç”¨ç©ºé—´ç”±å®šä¹‰çš„å®½åº¦å†³å®šï¼Œæ¯4ä¸ªå­—èŠ‚å¯ä»¥å­˜å‚¨9ä½æ•°å­—ï¼Œå¹¶ä¸”å°æ•°ç‚¹è¦å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚å¯ç”¨äºå­˜å‚¨æ¯”bigintæ›´å¤§çš„æ•´å‹æ•°æ®ã€‚</p><p><strong>æ€»ä¹‹ï¼Œé‡åˆ°æ•°æ®é‡å¤§çš„é¡¹ç›®æ—¶ï¼Œä¸€å®šè¦åœ¨å……åˆ†äº†è§£ä¸šåŠ¡éœ€æ±‚çš„å‰æä¸‹ï¼Œåˆç†ä¼˜åŒ–æ•°æ®ç±»å‹ï¼Œè¿™æ ·æ‰èƒ½å…… åˆ†å‘æŒ¥èµ„æºçš„æ•ˆç‡ï¼Œä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ä¼˜ã€‚</strong></p><h3 id="3-5-ä¼˜åŒ–æ’å…¥è®°å½•çš„é€Ÿåº¦">3.5 ä¼˜åŒ–æ’å…¥è®°å½•çš„é€Ÿåº¦</h3><p>æ’å…¥è®°å½•æ—¶ï¼Œå½±å“æ’å…¥é€Ÿåº¦çš„ä¸»è¦æ˜¯ç´¢å¼•ã€å”¯ä¸€æ€§æ ¡éªŒã€ä¸€æ¬¡æ’å…¥è®°å½•æ¡æ•°ç­‰ã€‚æ ¹æ®è¿™äº›æƒ…å†µå¯ä»¥åˆ†åˆ«è¿›è¡Œä¼˜åŒ–ã€‚è¿™é‡Œæˆ‘ä»¬åˆ†ä¸ºMyISAMå¼•æ“å’ŒInnoDBå¼•æ“æ¥è®²ã€‚</p><p><strong>1. MyISAMå¼•æ“çš„è¡¨ï¼š</strong></p><p><strong>â‘  ç¦ç”¨ç´¢å¼•</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707215305640.png" alt="image-20220707215305640"  /><p><strong>â‘¡ ç¦ç”¨å”¯ä¸€æ€§æ£€æŸ¥</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707215356893.png" alt="image-20220707215356893"  /><p><strong>â‘¢ ä½¿ç”¨æ‰¹é‡æ’å…¥</strong></p><p>æ’å…¥å¤šæ¡è®°å½•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€æ¡INSERTè¯­å¥æ’å…¥ä¸€æ¡æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€æ¡INSERTè¯­å¥æ’å…¥å¤šæ¡æ•°æ®ã€‚æ’å…¥ä¸€æ¡è®°å½•çš„INSERTè¯­å¥æƒ…å½¢å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="number">18</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="number">17</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="number">17</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;zhaoliu&#x27;</span>,<span class="number">19</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸€æ¡INSERTè¯­å¥æ’å…¥å¤šæ¡è®°å½•çš„æƒ…å½¢å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span></span><br><span class="line">(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="number">18</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="number">17</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="number">17</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="string">&#x27;zhaoliu&#x27;</span>,<span class="number">19</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>ç¬¬2ç§æƒ…å½¢çš„æ’å…¥é€Ÿåº¦è¦æ¯”ç¬¬1ç§æƒ…å½¢å¿«ã€‚</p><p><strong>â‘£ ä½¿ç”¨LOAD DATA INFILE æ‰¹é‡å¯¼å…¥</strong></p><p>å½“éœ€è¦æ‰¹é‡å¯¼å…¥æ•°æ®æ—¶ï¼Œå¦‚æœèƒ½ç”¨LOAD DATA INFILEè¯­å¥ï¼Œå°±å°½é‡ä½¿ç”¨ã€‚å› ä¸ºLOAD DATA INFILEè¯­å¥å¯¼å…¥æ•°æ®çš„é€Ÿåº¦æ¯”INSERTè¯­å¥å—ã€‚</p><p><strong>2. InnoDBå¼•æ“çš„è¡¨ï¼š</strong></p><p><strong>â‘  ç¦ç”¨å”¯ä¸€æ€§æ£€æŸ¥</strong></p><p>æ’å…¥æ•°æ®ä¹‹å‰æ‰§è¡Œ<code>set unique_checks=0</code>æ¥ç¦æ­¢å¯¹å”¯ä¸€ç´¢å¼•çš„æ£€æŸ¥ï¼Œæ•°æ®å¯¼å…¥å®Œæˆä¹‹åå†è¿è¡Œ<code>set unique_check=1</code>ã€‚è¿™ä¸ªå’ŒMyISAMå¼•æ“çš„ä½¿ç”¨æ–¹æ³•ä¸€æ ·ã€‚</p><p><strong>â‘¡ ç¦ç”¨å¤–é”®æ£€æŸ¥</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707220034534.png" alt="image-20220707220034534"  /><p><strong>â‘¢ ç¦æ­¢è‡ªåŠ¨æäº¤</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707220131891.png" alt="image-20220707220131891"  /><h3 id="3-6-ä½¿ç”¨éç©ºçº¦æŸ">3.6 ä½¿ç”¨éç©ºçº¦æŸ</h3><span class='p red'>åœ¨è®¾è®¡å­—æ®µçš„æ—¶å€™ï¼Œå¦‚æœä¸šåŠ¡å…è®¸ï¼Œå»ºè®®å°½é‡ä½¿ç”¨éç©ºçº¦æŸã€‚</span>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š<p>â‘ è¿›è¡Œæ¯”è¾ƒå’Œè®¡ç®—æ—¶ï¼Œçœå»è¦å¯¹NULLå€¼çš„å­—æ®µåˆ¤æ–­æ˜¯å¦ä¸ºç©ºçš„å¼€é”€ï¼Œæé«˜å­˜å‚¨æ•ˆç‡ã€‚</p><p>â‘¡éç©ºå­—æ®µä¹Ÿå®¹æ˜“åˆ›å»ºç´¢å¼•ã€‚å› ä¸ºç´¢å¼•NULLåˆ—éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜ï¼Œæ‰€ä»¥è¦å ç”¨æ›´å¤šçš„ç©ºé—´ã€‚ä½¿ç”¨éç©ºçº¦æŸï¼Œå°±å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼ˆæ¯ä¸ªå­—æ®µ1 ä¸ªbit)</p><h3 id="3-7-åˆ†æè¡¨ã€æ£€æŸ¥è¡¨ä¸ä¼˜åŒ–è¡¨">3.7 åˆ†æè¡¨ã€æ£€æŸ¥è¡¨ä¸ä¼˜åŒ–è¡¨</h3><p>MySQLæä¾›äº†åˆ†æè¡¨ã€æ£€æŸ¥è¡¨å’Œä¼˜åŒ–è¡¨çš„è¯­å¥ã€‚<code>åˆ†æè¡¨</code>ä¸»è¦æ˜¯åˆ†æå…³é”®å­—çš„åˆ†å¸ƒï¼Œ<code>æ£€æŸ¥è¡¨</code>ä¸»è¦æ˜¯æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨é”™è¯¯ï¼Œ<code>ä¼˜åŒ–è¡¨</code>ä¸»è¦æ˜¯æ¶ˆé™¤åˆ é™¤æˆ–è€…æ›´æ–°é€ æˆçš„ç©ºé—´æµªè´¹ã€‚</p><h4 id="1-åˆ†æè¡¨">1. åˆ†æè¡¨</h4><p>MySQLä¸­æä¾›äº†ANALYZE TABLEè¯­å¥åˆ†æè¡¨ï¼ŒANALYZE TABLEè¯­å¥çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ANALYZE [<span class="keyword">LOCAL</span> <span class="operator">|</span> NO_WRITE_TO_BINLOG] <span class="keyword">TABLE</span> tbl_name[,tbl_name]â€¦</span><br></pre></td></tr></table></figure><p>é»˜è®¤çš„ï¼ŒMySQLæœåŠ¡ä¼šå°† ANALYZE TABLEè¯­å¥å†™åˆ°binlogä¸­ï¼Œä»¥ä¾¿åœ¨ä¸»ä»æ¶æ„ä¸­ï¼Œä»æœåŠ¡èƒ½å¤ŸåŒæ­¥æ•°æ®ã€‚ å¯ä»¥æ·»åŠ å‚æ•°LOCAL æˆ–è€… NO_WRITE_TO_BINLOGå–æ¶ˆå°†è¯­å¥å†™åˆ°binlogä¸­ã€‚</p><p>ä½¿ç”¨<code>ANALYZE TABLE</code>åˆ†æè¡¨çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šè‡ªåŠ¨å¯¹è¡¨åŠ ä¸€ä¸ª<code>åªè¯»é”</code>ã€‚åœ¨åˆ†ææœŸé—´ï¼Œåªèƒ½è¯»å– è¡¨ä¸­çš„è®°å½•ï¼Œä¸èƒ½æ›´æ–°å’Œæ’å…¥è®°å½•ã€‚ANALYZE TABLEè¯­å¥èƒ½å¤Ÿåˆ†æInnoDBå’ŒMyISAMç±»å‹çš„è¡¨ï¼Œä½†æ˜¯ä¸èƒ½ä½œç”¨äºè§†å›¾ã€‚</p><p>ANALYZE TABLEåˆ†æåçš„ç»Ÿè®¡ç»“æœä¼šååº”åˆ°<code>cardinality</code>çš„å€¼ï¼Œè¯¥å€¼ç»Ÿè®¡äº†è¡¨ä¸­æŸä¸€é”®æ‰€åœ¨çš„åˆ—ä¸é‡å¤ çš„å€¼çš„ä¸ªæ•°ã€‚<strong>è¯¥å€¼è¶Šæ¥è¿‘è¡¨ä¸­çš„æ€»è¡Œæ•°ï¼Œåˆ™åœ¨è¡¨è¿æ¥æŸ¥è¯¢æˆ–è€…ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œå°±è¶Šä¼˜å…ˆè¢«ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨</strong>ã€‚ä¹Ÿå°±æ˜¯ç´¢å¼•åˆ—çš„cardinalityçš„å€¼ä¸è¡¨ä¸­æ•°æ®çš„æ€»æ¡æ•°å·®è·è¶Šå¤§ï¼Œå³ä½¿æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨äº†è¯¥ç´¢å¼•ä½œä¸ºæŸ¥ è¯¢æ¡ä»¶ï¼Œå­˜å‚¨å¼•æ“å®é™…æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨çš„æ¦‚ç‡å°±è¶Šå°ã€‚ä¸‹é¢é€šè¿‡ä¾‹å­æ¥éªŒè¯ä¸‹ã€‚cardinalityå¯ä»¥é€šè¿‡ SHOW INDEX FROM è¡¨åæŸ¥çœ‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> ANALYZE <span class="keyword">TABLE</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+----------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span>        <span class="operator">|</span> Op      <span class="operator">|</span> Msg_type <span class="operator">|</span>Msg_text <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+----------+---------+</span></span><br><span class="line"><span class="operator">|</span> atguigu.user <span class="operator">|</span> analyze <span class="operator">|</span> status   <span class="operator">|</span> Ok      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+----------+---------+---------+</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç»“æœæ˜¾ç¤ºçš„ä¿¡æ¯è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>Table: è¡¨ç¤ºåˆ†æçš„è¡¨çš„åç§°ã€‚</li><li>Op: è¡¨ç¤ºæ‰§è¡Œçš„æ“ä½œã€‚analyzeè¡¨ç¤ºè¿›è¡Œåˆ†ææ“ä½œã€‚</li><li>Msg_type: è¡¨ç¤ºä¿¡æ¯ç±»å‹ï¼Œå…¶å€¼é€šå¸¸æ˜¯çŠ¶æ€ (status) ã€ä¿¡æ¯ (info) ã€æ³¨æ„ (note) ã€è­¦å‘Š (warning) å’Œ é”™è¯¯ (error) ä¹‹ä¸€ã€‚</li><li>Msg_text: æ˜¾ç¤ºä¿¡æ¯ã€‚</li></ul><h4 id="2-æ£€æŸ¥è¡¨">2. æ£€æŸ¥è¡¨</h4><p>MySQLä¸­å¯ä»¥ä½¿ç”¨<code>CHECK TABLE</code>è¯­å¥æ¥æ£€æŸ¥è¡¨ã€‚CHECK TABLEè¯­å¥èƒ½å¤Ÿæ£€æŸ¥InnoDBå’ŒMyISAMç±»å‹çš„è¡¨ æ˜¯å¦å­˜åœ¨é”™è¯¯ã€‚CHECK TABLEè¯­å¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šç»™è¡¨åŠ ä¸Š<code>åªè¯»é”</code>ã€‚</p><p>å¯¹äºMyISAMç±»å‹çš„è¡¨ï¼ŒCHECK TABLEè¯­å¥è¿˜ä¼šæ›´æ–°å…³é”®å­—ç»Ÿè®¡æ•°æ®ã€‚è€Œä¸”ï¼ŒCHECK TABLEä¹Ÿå¯ä»¥æ£€æŸ¥è§† å›¾æ˜¯å¦æœ‰é”™è¯¯ï¼Œæ¯”å¦‚åœ¨è§†å›¾å®šä¹‰ä¸­è¢«å¼•ç”¨çš„è¡¨å·²ä¸å­˜åœ¨ã€‚è¯¥è¯­å¥çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CHECK</span> <span class="keyword">TABLE</span> tbl_name [, tbl_name] ... [option] ...</span><br><span class="line">option <span class="operator">=</span> &#123;QUICK <span class="operator">|</span> FAST <span class="operator">|</span> MEDIUM <span class="operator">|</span> EXTENDED <span class="operator">|</span> CHANGED&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œtbl_nameæ˜¯è¡¨åï¼›optionå‚æ•°æœ‰5ä¸ªå–å€¼ï¼Œåˆ†åˆ«æ˜¯QUICKã€FASTã€MEDIUMã€EXTENDEDå’Œ CHANGEDã€‚å„ä¸ªé€‰é¡¹çš„æ„ä¹‰åˆ†åˆ«æ˜¯ï¼š</p><ul><li>QUICK ï¼šä¸æ‰«æè¡Œï¼Œä¸æ£€æŸ¥é”™è¯¯çš„è¿æ¥ã€‚</li><li>FAST ï¼šåªæ£€æŸ¥æ²¡æœ‰è¢«æ­£ç¡®å…³é—­çš„è¡¨ã€‚</li><li>CHANGED ï¼šåªæ£€æŸ¥ä¸Šæ¬¡æ£€æŸ¥åè¢«æ›´æ”¹çš„è¡¨å’Œæ²¡æœ‰è¢«æ­£ç¡®å…³é—­çš„è¡¨ã€‚</li><li>MEDIUM ï¼šæ‰«æè¡Œï¼Œä»¥éªŒè¯è¢«åˆ é™¤çš„è¿æ¥æ˜¯æœ‰æ•ˆçš„ã€‚ä¹Ÿå¯ä»¥è®¡ç®—å„è¡Œçš„å…³é”®å­—æ ¡éªŒå’Œï¼Œå¹¶ä½¿ç”¨è®¡ç®—å‡ºçš„æ ¡éªŒå’ŒéªŒè¯è¿™ä¸€ç‚¹ã€‚</li><li>EXTENDED ï¼šå¯¹æ¯è¡Œçš„æ‰€æœ‰å…³é”®å­—è¿›è¡Œä¸€ä¸ªå…¨é¢çš„å…³é”®å­—æŸ¥æ‰¾ã€‚è¿™å¯ä»¥ç¡®ä¿è¡¨æ˜¯100%ä¸€è‡´çš„ï¼Œä½† æ˜¯èŠ±çš„æ—¶é—´è¾ƒé•¿ã€‚</li></ul><p>optionåªå¯¹MyISAMç±»å‹çš„è¡¨æœ‰æ•ˆï¼Œå¯¹InnoDBç±»å‹çš„è¡¨æ— æ•ˆã€‚æ¯”å¦‚ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707221707254.png" alt="image-20220707221707254"></p><p>è¯¥è¯­å¥å¯¹äºæ£€æŸ¥çš„è¡¨å¯èƒ½ä¼šäº§ç”Ÿå¤šè¡Œä¿¡æ¯ã€‚æœ€åä¸€è¡Œæœ‰ä¸€ä¸ªçŠ¶æ€çš„ Msg_type å€¼ï¼ŒMsg_text é€šå¸¸ä¸º OKã€‚ å¦‚æœå¾—åˆ°çš„ä¸æ˜¯ OKï¼Œé€šå¸¸è¦å¯¹å…¶è¿›è¡Œä¿®å¤ï¼›æ˜¯ OK è¯´æ˜è¡¨å·²ç»æ˜¯æœ€æ–°çš„äº†ã€‚è¡¨å·²ç»æ˜¯æœ€æ–°çš„ï¼Œæ„å‘³ç€å­˜ å‚¨å¼•æ“å¯¹è¿™å¼ è¡¨ä¸å¿…è¿›è¡Œæ£€æŸ¥ã€‚</p><h4 id="3-ä¼˜åŒ–è¡¨">3. ä¼˜åŒ–è¡¨</h4><p><strong>æ–¹å¼1ï¼šOPTIMIZE TABLE</strong></p><p>MySQLä¸­ä½¿ç”¨<code>OPTIMIZE TABLE</code>è¯­å¥æ¥ä¼˜åŒ–è¡¨ã€‚ä½†æ˜¯ï¼ŒOPTILMIZE TABLEè¯­å¥åªèƒ½ä¼˜åŒ–è¡¨ä¸­çš„<code>VARCHAR</code>ã€<code>BLOB</code>æˆ–<code>TEXT</code>ç±»å‹çš„å­—æ®µã€‚ä¸€ä¸ªè¡¨ä½¿ç”¨äº†è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹ï¼Œè‹¥å·²ç»<code>åˆ é™¤</code>äº†è¡¨çš„ä¸€å¤§éƒ¨ åˆ†æ•°æ®ï¼Œæˆ–è€…å·²ç»å¯¹å«æœ‰å¯å˜é•¿åº¦è¡Œçš„è¡¨ï¼ˆå«æœ‰VARCHARã€BLOBæˆ–TEXTåˆ—çš„è¡¨ï¼‰è¿›è¡Œäº†å¾ˆå¤š<code>æ›´æ–°</code>ï¼Œåˆ™ åº”ä½¿ç”¨OPTIMIZE TABLEæ¥é‡æ–°åˆ©ç”¨æœªä½¿ç”¨çš„ç©ºé—´ï¼Œå¹¶æ•´ç†æ•°æ®æ–‡ä»¶çš„<code>ç¢ç‰‡</code>ã€‚</p><p>OPTIMIZE TABLE è¯­å¥å¯¹InnoDBå’ŒMyISAMç±»å‹çš„è¡¨éƒ½æœ‰æ•ˆã€‚è¯¥è¯­å¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šç»™è¡¨åŠ ä¸Š<code>åªè¯»é”</code>ã€‚</p><p>OPTILMIZE TABLEè¯­å¥çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPTIMIZE [<span class="keyword">LOCAL</span> <span class="operator">|</span> NO_WRITE_TO_BINLOG] <span class="keyword">TABLE</span> tbl_name [, tbl_name] ...</span><br></pre></td></tr></table></figure><p>LOCAL | NO_WRITE_TO_BINLOGå…³é”®å­—çš„æ„ä¹‰å’Œåˆ†æè¡¨ç›¸åŒï¼Œéƒ½æ˜¯æŒ‡å®šä¸å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707221901664.png" alt="image-20220707221901664"></p><p>æ‰§è¡Œå®Œæ¯•ï¼ŒMsg_textæ˜¾ç¤º</p><blockquote><p>â€˜numysql.SYS_APP_USERâ€™, â€˜optimizeâ€™, â€˜noteâ€™, â€˜Table does not support optimize, doing recreate + analyze insteadâ€™</p></blockquote><p>åŸå› æ˜¯æˆ‘æœåŠ¡å™¨ä¸Šçš„MySQLæ˜¯InnoDBå­˜å‚¨å¼•æ“ã€‚</p><p>åˆ°åº•ä¼˜åŒ–äº†æ²¡æœ‰å‘¢ï¼Ÿçœ‹å®˜ç½‘ï¼</p><p><a><a href="https://dev.mysql.com/doc/refman/8.0/en/optimize-table.html">MySQL :: MySQL 8.0 Reference Manual :: 13.7.3.4 OPTIMIZE TABLE Statement</a></a></p><p>åœ¨MyISAMä¸­ï¼Œæ˜¯å…ˆåˆ†æè¿™å¼ è¡¨ï¼Œç„¶åä¼šæ•´ç†ç›¸å…³çš„MySQL datafileï¼Œä¹‹åå›æ”¶æœªä½¿ç”¨çš„ç©ºé—´ï¼›åœ¨InnoDB ä¸­ï¼Œå›æ”¶ç©ºé—´æ˜¯ç®€å•é€šè¿‡Alter tableè¿›è¡Œæ•´ç†ç©ºé—´ã€‚åœ¨ä¼˜åŒ–æœŸé—´ï¼ŒMySQLä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œä¼˜åŒ–å®Œæˆä¹‹ åä¼šåˆ é™¤åŸå§‹è¡¨ï¼Œç„¶åä¼šå°†ä¸´æ—¶è¡¨renameæˆä¸ºåŸå§‹è¡¨ã€‚</p><blockquote><p>è¯´æ˜ï¼š åœ¨å¤šæ•°çš„è®¾ç½®ä¸­ï¼Œæ ¹æœ¬ä¸éœ€è¦è¿è¡ŒOPTIMIZE TABLEã€‚å³ä½¿å¯¹å¯å˜é•¿åº¦çš„è¡Œè¿›è¡Œäº†å¤§é‡çš„æ›´ æ–°ï¼Œä¹Ÿä¸éœ€è¦ç»å¸¸è¿è¡Œï¼Œ<code>æ¯å‘¨ä¸€æ¬¡</code>æˆ–<code>æ¯æœˆä¸€æ¬¡</code>å³å¯ï¼Œå¹¶ä¸”åªéœ€è¦å¯¹<code>ç‰¹å®šçš„è¡¨</code>è¿è¡Œã€‚</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707222156765.png" alt="image-20220707222156765"  /><p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨mysqlcheckå‘½ä»¤</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707222305302.png" alt="image-20220707222305302"  /><p>å°ç»“</p><p>ä¸Šè¿°è¿™äº›æ–¹æ³•éƒ½æ˜¯æœ‰åˆ©æœ‰å¼Šçš„ã€‚æ¯”å¦‚ï¼š</p><ul><li>ä¿®æ”¹æ•°æ®ç±»å‹ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´çš„åŒæ—¶ï¼Œä½ è¦è€ƒè™‘åˆ°æ•°æ®ä¸èƒ½è¶…è¿‡å–å€¼èŒƒå›´ï¼›</li><li>å¢åŠ å†—ä½™å­—æ®µçš„æ—¶å€™ï¼Œä¸è¦å¿˜äº†ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼›</li><li>æŠŠå¤§è¡¨æ‹†åˆ†ï¼Œä¹Ÿæ„å‘³ç€ä½ çš„æŸ¥è¯¢ä¼šå¢åŠ æ–°çš„è¿æ¥ï¼Œä»è€Œå¢åŠ é¢å¤–çš„å¼€é”€å’Œè¿ç»´çš„æˆæœ¬ã€‚</li></ul><p>å› æ­¤ï¼Œä½ ä¸€å®šè¦ç»“åˆå®é™…çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œæƒè¡¡ã€‚</p><hr><h2 id="4-å¤§è¡¨ä¼˜åŒ–">4. å¤§è¡¨ä¼˜åŒ–</h2><p>å½“MySQLå•è¡¨è®°å½•æ•°è¿‡å¤§æ—¶ï¼Œæ•°æ®åº“çš„CRUDæ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ï¼Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–æªæ–½å¦‚ä¸‹ï¼š</p><h3 id="4-1-é™å®šæŸ¥è¯¢çš„èŒƒå›´">4.1 é™å®šæŸ¥è¯¢çš„èŒƒå›´</h3><p>ç¦æ­¢ä¸å¸¦ä»»ä½•é™åˆ¶æ•°æ®èŒƒå›´æ¡ä»¶çš„æŸ¥è¯¢è¯­å¥ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬å½“ç”¨æˆ·åœ¨æŸ¥è¯¢è®¢å•å†å²çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ åœ¨ä¸€ä¸ªæœˆçš„èŒƒå›´å†…ï¼›</p><h3 id="4-2-è¯»-å†™åˆ†ç¦»">4.2 è¯»/å†™åˆ†ç¦»</h3><p>ç»å…¸çš„æ•°æ®åº“æ‹†åˆ†æ–¹æ¡ˆï¼Œä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ã€‚</p><ul><li>ä¸€ä¸»ä¸€ä»æ¨¡å¼ï¼š</li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707222606097.png" alt="image-20220707222606097"></p><ul><li>åŒä¸»åŒä»æ¨¡å¼ï¼š</li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707222623485.png" alt="image-20220707222623485"></p><h3 id="4-3-å‚ç›´æ‹†åˆ†">4.3 å‚ç›´æ‹†åˆ†</h3><p>å½“æ•°æ®é‡çº§è¾¾åˆ°<code>åƒä¸‡çº§</code>ä»¥ä¸Šæ—¶ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠä¸€ä¸ªæ•°æ®åº“åˆ‡æˆå¤šä»½ï¼Œæ”¾åˆ°ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œ å‡å°‘å¯¹å•ä¸€æ•°æ®åº“æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707222648112.png" alt="image-20220707222648112"></p><ul><li>å¦‚æœæ•°æ®åº“çš„æ•°æ®è¡¨è¿‡å¤šï¼Œå¯ä»¥é‡‡ç”¨<code>å‚ç›´åˆ†åº“</code>çš„æ–¹å¼ï¼Œå°†å…³è”çš„æ•°æ®åº“éƒ¨ç½²åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸Šã€‚</li><li>å¦‚æœæ•°æ®åº“ä¸­çš„åˆ—è¿‡å¤šï¼Œå¯ä»¥é‡‡ç”¨<code>å‚ç›´åˆ†è¡¨</code>çš„æ–¹å¼ï¼Œå°†ä¸€å¼ æ•°æ®è¡¨åˆ†æ‹†æˆå¤šå¼ æ•°æ®è¡¨ï¼ŒæŠŠç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åœ¨åŒä¸€å¼ è¡¨é‡Œã€‚</li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707222910740.png" alt="image-20220707222910740"></p><p><code>å‚ç›´æ‹†åˆ†çš„ä¼˜ç‚¹</code>ï¼š å¯ä»¥ä½¿å¾—åˆ—æ•°æ®å˜å°ï¼Œåœ¨æŸ¥è¯¢æ—¶å‡å°‘è¯»å–çš„Blockæ•°ï¼Œå‡å°‘I/Oæ¬¡æ•°ã€‚æ­¤å¤–ï¼Œå‚ç›´åˆ†åŒºå¯ä»¥ç®€åŒ–è¡¨çš„ç»“æ„ï¼Œæ˜“äºç»´æŠ¤ã€‚</p><p><code>å‚ç›´æ‹†åˆ†çš„ç¼ºç‚¹</code>ï¼š ä¸»é”®ä¼šå‡ºç°å†—ä½™ï¼Œéœ€è¦ç®¡ç†å†—ä½™åˆ—ï¼Œå¹¶ä¼šå¼•èµ· JOIN æ“ä½œã€‚æ­¤å¤–ï¼Œå‚ç›´æ‹†åˆ†ä¼šè®©äº‹åŠ¡å˜å¾—æ›´åŠ å¤æ‚ã€‚</p><h3 id="4-4-æ°´å¹³æ‹†åˆ†">4.4 æ°´å¹³æ‹†åˆ†</h3><ul><li><p>å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨1000ä¸‡ä»¥å†…ã€‚1000ä¸‡å¹¶ä¸æ˜¯MySQLæ•°æ®åº“çš„é™åˆ¶ï¼Œè¿‡å¤§ä¼šé€ æˆä¿®æ”¹è¡¨ç»“æ„ã€å¤‡ä»½ã€æ¢å¤éƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚æ­¤æ—¶å¯ä»¥ç”¨<code>å†å²æ•°æ®å½’æ¡£</code>ï¼ˆåº”ç”¨äºæ—¥å¿—æ•°æ®ï¼‰ï¼Œ<code>æ°´å¹³åˆ†è¡¨</code>ï¼ˆåº”ç”¨äºä¸šåŠ¡æ•°æ®ï¼‰ç­‰æ‰‹æ®µæ¥æ§åˆ¶æ•°æ®é‡å¤§å°ã€‚</p></li><li><p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦è€ƒè™‘ä¸šåŠ¡æ•°æ®çš„æ°´å¹³åˆ†è¡¨ç­–ç•¥ã€‚å°†å¤§çš„æ•°æ®è¡¨æŒ‰ç…§<code>æŸä¸ªå±æ€§ç»´åº¦</code>åˆ†æ‹†æˆä¸åŒçš„å°è¡¨ï¼Œæ¯å¼ å°è¡¨ä¿æŒç›¸åŒçš„è¡¨ç»“æ„ã€‚æ¯”å¦‚ä½ å¯ä»¥æŒ‰ç…§å¹´ä»½æ¥åˆ’åˆ†ï¼ŒæŠŠä¸åŒå¹´ä»½çš„æ•°æ®æ”¾åˆ°ä¸åŒçš„æ•°æ®è¡¨ä¸­ã€‚2017 å¹´ã€2018 å¹´å’Œ2019 å¹´çš„æ•°æ®å°±å¯ä»¥åˆ†åˆ«æ”¾åˆ°ä¸‰å¼ æ•°æ®è¡¨ä¸­ã€‚</p></li><li><p>4.4 æ°´å¹³æ‹†åˆ†æ°´å¹³åˆ†è¡¨ä»…æ˜¯è§£å†³äº†å•ä¸€è¡¨æ•°æ®è¿‡å¤§çš„é—®é¢˜ï¼Œä½†ç”±äºè¡¨çš„æ•°æ®è¿˜æ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå…¶å®å¯¹äºæå‡MySQLå¹¶å‘èƒ½åŠ›æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œæ‰€ä»¥<code>æ°´å¹³æ‹†åˆ†æœ€å¥½åˆ†åº“</code>ï¼Œä»è€Œè¾¾åˆ°åˆ†å¸ƒå¼çš„ç›®çš„ã€‚</p></li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707222739120.png" alt="image-20220707222739120"></p><p>æ°´å¹³æ‹†åˆ†èƒ½å¤Ÿæ”¯æŒéå¸¸å¤§çš„æ•°æ®é‡å­˜åº”ç”¨ç«¯æ”¹é€ ä¹Ÿå°‘ï¼Œä½†<code>åˆ†ç‰‡äº‹åŠ¡éš¾ä»¥è§£å†³ï¼Œè·¨èŠ‚ç‚¹Joinæ€§èƒ½è¾ƒå·®</code>ï¼Œé€»è¾‘å¤æ‚ã€‚ã€ŠJavaå·¥ç¨‹å¸ˆä¿®ç‚¼ä¹‹é“ã€‹çš„ä½œè€…æ¨è<span class='p red'>å°½é‡ä¸è¦å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå› ä¸ºæ‹†åˆ†ä¼šå¸¦æ¥é€»è¾‘ã€éƒ¨ç½²ã€è¿ç»´çš„å„ç§å¤æ‚åº¦</span>ï¼Œä¸€èˆ¬çš„æ•°æ®è¡¨åœ¨ä¼˜åŒ–å¾—å½“çš„æƒ…å†µä¸‹æ”¯æ’‘å¹²ä¸‡ä»¥ä¸‹çš„æ•°æ®é‡æ˜¯æ²¡æœ‰å¤ªå¤§é—®é¢˜çš„ã€‚å¦‚æœå®åœ¨è¦åˆ†ç‰‡ï¼Œå°½é‡é€‰æ‹©å®¢æˆ·ç«¯åˆ†ç‰‡æ¶æ„ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸€æ¬¡å’Œä¸­é—´ä»¶çš„ç½‘ç»œI/0ã€‚</p><p>ä¸‹é¢è¡¥å……ä¸€ä¸‹æ•°æ®åº“åˆ†ç‰‡çš„ä¸¤ç§å¸¸è§æ–¹æ¡ˆï¼š</p><ul><li><strong>å®¢æˆ·ç«¯ä»£ç†ï¼š åˆ†ç‰‡é€»è¾‘åœ¨åº”ç”¨ç«¯ï¼Œå°è£…åœ¨jaråŒ…ä¸­ï¼Œé€šè¿‡ä¿®æ”¹æˆ–è€…å°è£…JDBCå±‚æ¥å®ç°ã€‚</strong> å½“å½“ç½‘çš„ Sharding-JDBC ã€é˜¿é‡Œçš„TDDLæ˜¯ä¸¤ç§æ¯”è¾ƒå¸¸ç”¨çš„å®ç°ã€‚</li><li>**ä¸­é—´ä»¶ä»£ç†ï¼š åœ¨åº”ç”¨å’Œæ•°æ®ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åˆ†ç‰‡é€»è¾‘ç»Ÿä¸€ç»´æŠ¤åœ¨ä¸­é—´ä»¶æœåŠ¡ä¸­ã€‚**æˆ‘ä»¬ç°åœ¨ è°ˆçš„ Mycat ã€360çš„Atlasã€ç½‘æ˜“çš„DDBç­‰ç­‰éƒ½æ˜¯è¿™ç§æ¶æ„çš„å®ç°ã€‚</li></ul><h2 id="5-å…¶å®ƒè°ƒä¼˜ç­–ç•¥">5. å…¶å®ƒè°ƒä¼˜ç­–ç•¥</h2><h3 id="5-1-æœåŠ¡å™¨è¯­å¥è¶…æ—¶å¤„ç†">5.1 æœåŠ¡å™¨è¯­å¥è¶…æ—¶å¤„ç†</h3><p>åœ¨MySQL 8.0ä¸­å¯ä»¥è®¾ç½® æœåŠ¡å™¨è¯­å¥è¶…æ—¶çš„é™åˆ¶ ï¼Œå•ä½å¯ä»¥è¾¾åˆ° æ¯«ç§’çº§åˆ« ã€‚å½“ä¸­æ–­çš„æ‰§è¡Œè¯­å¥è¶…è¿‡è®¾ç½®çš„ æ¯«ç§’æ•°åï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢æŸ¥è¯¢å½±å“ä¸å¤§çš„äº‹åŠ¡æˆ–è¿æ¥ï¼Œç„¶åå°†é”™è¯¯æŠ¥ç»™å®¢æˆ·ç«¯ã€‚</p><p>è®¾ç½®æœåŠ¡å™¨è¯­å¥è¶…æ—¶çš„é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç³»ç»Ÿå˜é‡ MAX_EXECUTION_TIME æ¥å®ç°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ MAX_EXECUTION_TIMEçš„å€¼ä¸º0ï¼Œä»£è¡¨æ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> MAX_EXECUTION_TIME<span class="operator">=</span><span class="number">2000</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> SESSION MAX_EXECUTION_TIME<span class="operator">=</span><span class="number">2000</span>; #æŒ‡å®šè¯¥ä¼šè¯ä¸­<span class="keyword">SELECT</span>è¯­å¥çš„è¶…æ—¶æ—¶é—´</span><br></pre></td></tr></table></figure><h3 id="5-2-åˆ›å»ºå…¨å±€é€šç”¨è¡¨ç©ºé—´">5.2 åˆ›å»ºå…¨å±€é€šç”¨è¡¨ç©ºé—´</h3><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707223246684.png" alt="image-20220707223246684"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707223349879.png" alt="image-20220707223349879"  /><h3 id="5-3-MySQL-8-0æ–°ç‰¹æ€§ï¼šéšè—ç´¢å¼•å¯¹è°ƒä¼˜çš„å¸®åŠ©">5.3 MySQL 8.0æ–°ç‰¹æ€§ï¼šéšè—ç´¢å¼•å¯¹è°ƒä¼˜çš„å¸®åŠ©</h3><p>ä¸å¯è§ç´¢å¼•çš„ç‰¹æ€§å¯¹äºæ€§èƒ½è°ƒè¯•éå¸¸æœ‰ç”¨ã€‚åœ¨MySQL 8.0ä¸­ï¼Œç´¢å¼•å¯ä»¥è¢«â€éšè—â€å’Œâ€œæ˜¾ç¤ºâ€ï¼Œ<span class='p red'>å½“ä¸€ä¸ªç´¢å¼•è¢«éšè—æ—¶ï¼Œ å®ƒä¸ä¼šè¢«æŸ¥è¯¢ä¼˜åŒ–å™¨æ‰€ä½¿ç”¨ã€‚</span>ä¹Ÿå°±æ˜¯è¯´ï¼Œç®¡ç†å‘˜å¯ä»¥éšè—ä¸€ä¸ªç´¢å¼•ï¼Œç„¶åè§‚å¯Ÿå¯¹æ•°æ®åº“çš„å½±å“ã€‚å¦‚æœæ•°æ®åº“æ€§èƒ½æœ‰æ‰€ä¸‹é™ï¼Œå°±è¯´æ˜è¿™ä¸ªç´¢å¼•æ˜¯æœ‰ç”¨çš„ï¼Œäºæ˜¯å°†å…¶æ¢å¤æ˜¾ç¤º&quot;å³å¯ï¼›å¦‚æœæ•°æ®åº“æ€§èƒ½çœ‹ä¸å‡ºå˜åŒ–ï¼Œå°±è¯´æ˜è¿™ä¸ªç´¢å¼•æ˜¯å¤šä½™çš„ï¼Œå¯ä»¥åˆ æ‰äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å½“ç´¢å¼•è¢«éšè—æ—¶ï¼Œå®ƒçš„å†…å®¹ä»ç„¶æ˜¯å’Œæ­£å¸¸ç´¢å¼•ä¸€æ ·<code>å®æ—¶æ›´æ–°</code>çš„ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•éœ€è¦é•¿æœŸè¢«éšè—ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶åˆ é™¤ï¼Œå› ä¸ºç´¢å¼•çš„å­˜åœ¨ä¼šå½±å“æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤çš„æ€§èƒ½ã€‚</p><p>æ•°æ®è¡¨ä¸­çš„ä¸»é”®ä¸èƒ½è¢«è®¾ç½®ä¸ºinvisibleã€‚</p>]]></content>
    
    
    <summary type="html">æ‹†åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»ã€å‚ç›´æ‹†åˆ†ã€æ°´å¹³æ‹†åˆ†</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“è®¾è®¡è§„èŒƒ</title>
    <link href="https://wuwawawa.github.io/posts/95870c9e.html"/>
    <id>https://wuwawawa.github.io/posts/95870c9e.html</id>
    <published>2023-04-13T00:00:58.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<span class='p red'>æˆ‘ä»¬åœ¨è®¾è®¡æ•°æ®è¡¨çš„æ—¶å€™ï¼Œè¦è€ƒè™‘å¾ˆå¤šé—®é¢˜ã€‚</span>æ¯”å¦‚ï¼š<ul><li><p>ç”¨æˆ·éƒ½éœ€è¦ä»€ä¹ˆæ•°æ®ï¼Ÿéœ€è¦åœ¨æ•°æ®è¡¨ä¸­ä¿å­˜å“ªäº›æ•°æ®ï¼Ÿ</p></li><li><p>å¦‚ä½•ä¿è¯æ•°æ®è¡¨ä¸­æ•°æ®çš„<code>æ­£ç¡®æ€§</code>ï¼Œå½“æ’å…¥ã€åˆ é™¤ã€æ›´æ–°çš„æ—¶å€™è¯¥è¿›è¡Œæ€æ ·çš„çº¦æŸæ£€æŸ¥ï¼Ÿ</p></li><li><p>å¦‚ä½•é™ä½æ•°æ®è¡¨çš„<code>æ•°æ®å†—ä½™åº¦</code>ï¼Œä¿è¯æ•°æ®è¡¨ä¸ä¼šå› ä¸ºç”¨æˆ·é‡çš„å¢é•¿è€Œè¿…é€Ÿæ‰©å¼ ï¼Ÿ</p></li><li><p>å¦‚ä½•è®©è´Ÿè´£æ•°æ®åº“ç»´æŠ¤çš„äººå‘˜æ›´æ–¹ä¾¿åœ°ä½¿ç”¨æ•°æ®åº“ï¼Ÿ</p></li><li><p>ä½¿ç”¨æ•°æ®åº“çš„åº”ç”¨åœºæ™¯ä¹Ÿå„ä¸ç›¸åŒï¼Œå¯ä»¥è¯´é’ˆå¯¹ä¸åŒçš„æƒ…å†µï¼Œè®¾è®¡å‡ºæ¥çš„æ•°æ®è¡¨å¯èƒ½<code>åƒå·®ä¸‡åˆ«</code>ã€‚</p></li></ul><span class='p red'>ç°å®æƒ…å†µä¸­ï¼Œé¢ä¸´çš„åœºæ™¯ï¼š</span><p>å½“æ•°æ®åº“è¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæˆ‘ä»¬æ‰å‘ç°æ•°æ®è¡¨è®¾è®¡çš„æœ‰é—®é¢˜ã€‚é‡æ–°è°ƒæ•´æ•°æ®è¡¨çš„ç»“æ„ï¼Œå°±éœ€è¦åšæ•°æ®è¿ç§»ï¼Œè¿˜æœ‰å¯èƒ½å½±å“ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ï¼Œä»¥åŠç½‘ç«™æ­£å¸¸çš„è®¿é—®ã€‚</p><span class='p red'>å¦‚æœæ˜¯ç³Ÿç³•çš„æ•°æ®åº“è®¾è®¡å¯èƒ½ä¼šé€ æˆä»¥ä¸‹é—®é¢˜ï¼š</span><ul><li><p>æ•°æ®å†—ä½™ã€ä¿¡æ¯é‡å¤ï¼Œå­˜å‚¨ç©ºé—´æµªè´¹</p></li><li><p>æ•°æ®æ›´æ–°ã€æ’å…¥ã€åˆ é™¤çš„å¼‚å¸¸</p></li><li><p>æ— æ³•æ­£ç¡®è¡¨ç¤ºä¿¡æ¯</p></li><li><p>ä¸¢å¤±æœ‰æ•ˆä¿¡æ¯</p></li><li><p>ç¨‹åºæ€§èƒ½å·®</p></li></ul><span class='p red'>è‰¯å¥½çš„æ•°æ®åº“è®¾è®¡åˆ™æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</span><ul><li><p>èŠ‚çœæ•°æ®çš„å­˜å‚¨ç©ºé—´</p></li><li><p>èƒ½å¤Ÿä¿è¯æ•°æ®çš„å®Œæ•´æ€§</p></li><li><p>æ–¹ä¾¿è¿›è¡Œæ•°æ®åº“åº”ç”¨ç³»ç»Ÿçš„å¼€å‘</p></li></ul><p>æ€»ä¹‹ï¼Œå¼€å§‹è®¾ç½®æ•°æ®åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡è§†æ•°æ®è¡¨çš„è®¾è®¡ã€‚ä¸ºäº†å»ºç«‹<code>å†—ä½™è¾ƒå°ã€ç»“æ„åˆç†</code>çš„æ•°æ®åº“ï¼Œè®¾è®¡æ•°æ®åº“æ—¶å¿…é¡»éµå¾ªä¸€å®šçš„è§„åˆ™ã€‚</p><hr><h2 id="1-èŒƒå¼">1. èŒƒå¼</h2><span class='p red'>åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå…³äºæ•°æ®è¡¨è®¾è®¡çš„åŸºæœ¬åŸåˆ™ã€è§„åˆ™å°±ç§°ä¸ºèŒƒå¼ã€‚</span>å¯ä»¥ç†è§£ä¸ºï¼Œä¸€å¼ æ•°æ®è¡¨çš„è®¾è®¡ç»“æ„éœ€è¦æ»¡è¶³çš„æŸç§è®¾è®¡æ ‡å‡†çº§åˆ« ã€‚è¦æƒ³è®¾è®¡ä¸€ä¸ªç»“æ„åˆç†çš„å…³ç³»å‹æ•°æ®åº“ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„èŒƒå¼ã€‚<p>èŒƒå¼çš„è‹±æ–‡åç§°æ˜¯<code>Normal Form</code>ï¼Œç®€ç§°<code>NF</code>ã€‚å®ƒæ˜¯è‹±å›½äºº E.F.Codd åœ¨ä¸Šä¸ªä¸–çºª70å¹´ä»£æå‡ºå…³ç³»æ•°æ®åº“æ¨¡å‹åæ€»ç»“å‡ºæ¥çš„ã€‚èŒƒå¼æ˜¯å…³ç³»æ•°æ®åº“ç†è®ºçš„åŸºç¡€ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è®¾è®¡æ•°æ®åº“ç»“æ„è¿‡ç¨‹ä¸­æ‰€è¦éµå¾ªçš„<code>è§„åˆ™</code>å’Œ<code>æŒ‡å¯¼æ–¹æ³•</code>ã€‚</p><p>ç›®å‰å…³ç³»å‹æ•°æ®åº“æœ‰å…­ç§å¸¸è§èŒƒå¼ï¼ŒæŒ‰ç…§èŒƒå¼çº§åˆ«ï¼Œä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯ï¼š<span class='p red'>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ã€ç¬¬äºŒèŒƒå¼ ï¼ˆ2NFï¼‰ã€ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ã€å·´æ–¯-ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰ã€ç¬¬å››èŒƒå¼(4NFï¼‰å’Œç¬¬äº”èŒƒå¼ï¼ˆ5NFï¼Œåˆç§°å®Œç¾èŒƒå¼ï¼‰ã€‚</span></p><p>æ•°æ®åº“çš„èŒƒå¼è®¾è®¡è¶Šé«˜é˜¶ï¼Œå†—ä½™åº¦å°±è¶Šä½ï¼ŒåŒæ—¶é«˜é˜¶çš„èŒƒå¼ä¸€å®šç¬¦åˆä½é˜¶èŒƒå¼çš„è¦æ±‚ï¼Œæ»¡è¶³æœ€ä½è¦æ±‚çš„èŒƒå¼æ˜¯ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ã€‚åœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ»¡è¶³æ›´å¤šè§„èŒƒçš„è¦æ±‚ç§°ä¸ºç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼Œå…¶ä½™èŒƒå¼ä»¥æ­¤ç±»æ¨ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å…³ç³»å‹æ•°æ®åº“è®¾è®¡ä¸­ï¼Œæœ€é«˜ä¹Ÿå°±éµå¾ªåˆ°<code>BCNF</code>, æ™®éè¿˜æ˜¯<code>3NF</code>ã€‚ä½†ä¹Ÿä¸ç»å¯¹ï¼Œæœ‰æ—¶å€™ä¸ºäº†æé«˜æŸäº›æŸ¥è¯¢æ€§èƒ½ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç ´åèŒƒå¼è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯<code>åè§„èŒƒåŒ–</code>ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706165020939.png" alt="image-20220706165020939" style="zoom:67%;" /><p>èŒƒå¼çš„å®šä¹‰ä¼šä½¿ç”¨åˆ°ä¸»é”®å’Œå€™é€‰é”®ï¼Œæ•°æ®åº“ä¸­çš„é”®(Key)ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªå±æ€§ç»„æˆã€‚æ•°æ®è¡¨ä¸­å¸¸ç”¨çš„å‡ ç§é”®å’Œå±æ€§çš„å®šä¹‰ï¼š</p><p>-<code>è¶…é”®</code>ï¼šèƒ½å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†å«åšè¶…é”®ã€‚</p><p>-<code>å€™é€‰é”®</code>ï¼šå¦‚æœè¶…é”®ä¸åŒ…æ‹¬å¤šä½™çš„å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªè¶…é”®å°±æ˜¯å€™é€‰é”®ã€‚</p><p>-<code>ä¸»é”®</code>ï¼šç”¨æˆ·å¯ä»¥ä»å€™é€‰é”®ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºä¸»é”®ã€‚</p><p>-<code>å¤–é”®</code>ï¼šå¦‚æœæ•°æ®è¡¨ R1ä¸­çš„æŸå±æ€§é›†ä¸æ˜¯ R1 çš„ä¸»é”®ï¼Œè€Œæ˜¯å¦ä¸€ä¸ªæ•°æ®è¡¨ R2 çš„ä¸»é”®ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§é›†å°±æ˜¯æ•°æ®è¡¨ R1çš„å¤–é”®ã€‚</p><p>-<code>ä¸»å±æ€§</code>ï¼šåŒ…å«åœ¨ä»»ä¸€å€™é€‰é”®ä¸­çš„å±æ€§ç§°ä¸ºä¸»å±æ€§ã€‚</p><p>-<code>éä¸»å±æ€§</code>ï¼šä¸ä¸»å±æ€§ç›¸å¯¹ï¼ŒæŒ‡çš„æ˜¯ä¸åŒ…å«åœ¨ä»»ä½•ä¸€ä¸ªå€™é€‰é”®ä¸­çš„å±æ€§ã€‚</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¹Ÿå°†å€™é€‰é”®ç§°ä¹‹ä¸ºâ€œç â€ï¼ŒæŠŠä¸»é”®ä¹Ÿç§°ä¸ºâ€œä¸»ç â€ã€‚å› ä¸ºé”®å¯èƒ½æ˜¯ç”±å¤šä¸ªå±æ€§ç»„æˆçš„ï¼Œé’ˆå¯¹å•ä¸ªå±æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ä¸»å±æ€§å’Œéä¸»å±æ€§æ¥è¿›è¡ŒåŒºåˆ†ã€‚</p><p><strong>ä¸¾ä¾‹:</strong></p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªè¡¨ï¼š</p><p><code>çƒå‘˜è¡¨(player)</code>ï¼šçƒå‘˜ç¼–å· | å§“å | èº«ä»½è¯å· | å¹´é¾„ | çƒé˜Ÿç¼–å·</p><p><code>çƒé˜Ÿè¡¨(team)</code>ï¼šçƒé˜Ÿç¼–å· | ä¸»æ•™ç»ƒ | çƒé˜Ÿæ‰€åœ¨åœ°</p><ul><li>è¶…é”® ï¼šå¯¹äºçƒå‘˜è¡¨æ¥è¯´ï¼Œè¶…é”®å°±æ˜¯åŒ…æ‹¬çƒå‘˜ç¼–å·æˆ–è€…èº«ä»½è¯å·çš„ä»»æ„ç»„åˆï¼Œæ¯”å¦‚ï¼ˆçƒå‘˜ç¼–å·ï¼‰ ï¼ˆçƒå‘˜ç¼–å·ï¼Œå§“åï¼‰ï¼ˆèº«ä»½è¯å·ï¼Œå¹´é¾„ï¼‰ç­‰ã€‚</li><li>å€™é€‰é”® ï¼šå°±æ˜¯æœ€å°çš„è¶…é”®ï¼Œå¯¹äºçƒå‘˜è¡¨æ¥è¯´ï¼Œå€™é€‰é”®å°±æ˜¯ï¼ˆçƒå‘˜ç¼–å·ï¼‰æˆ–è€…ï¼ˆèº«ä»½è¯å·ï¼‰ã€‚</li><li>ä¸»é”® ï¼šæˆ‘ä»¬è‡ªå·±é€‰å®šï¼Œä¹Ÿå°±æ˜¯ä»å€™é€‰é”®ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œæ¯”å¦‚ï¼ˆçƒå‘˜ç¼–å·ï¼‰ã€‚</li><li>å¤–é”® ï¼šçƒå‘˜è¡¨ä¸­çš„çƒé˜Ÿç¼–å·ã€‚</li><li>ä¸»å±æ€§ ã€ éä¸»å±æ€§ ï¼šåœ¨çƒå‘˜è¡¨ä¸­ï¼Œä¸»å±æ€§æ˜¯ï¼ˆçƒå‘˜ç¼–å·ï¼‰ï¼ˆèº«ä»½è¯å·ï¼‰ï¼Œå…¶ä»–çš„å±æ€§ï¼ˆå§“åï¼‰ ï¼ˆå¹´é¾„ï¼‰ï¼ˆçƒé˜Ÿç¼–å·ï¼‰éƒ½æ˜¯éä¸»å±æ€§ã€‚</li></ul><hr><h3 id="1-1-ç¬¬ä¸€èŒƒå¼-1st-NF">1.1 ç¬¬ä¸€èŒƒå¼(1st NF)</h3><p>ç¬¬ä¸€èŒƒå¼ä¸»è¦ç¡®ä¿æ•°æ®åº“ä¸­æ¯ä¸ªå­—æ®µçš„å€¼å¿…é¡»å…·æœ‰<code>åŸå­æ€§</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®è¡¨ä¸­æ¯ä¸ªå­—æ®µçš„å€¼ä¸º<code>ä¸å¯å†æ¬¡æ‹†åˆ†</code>çš„æœ€å°æ•°æ®å•å…ƒã€‚</p><p>æˆ‘ä»¬åœ¨è®¾è®¡æŸä¸ªå­—æ®µçš„æ—¶å€™ï¼Œå¯¹äºå­—æ®µXæ¥è¯´ï¼Œä¸èƒ½æŠŠå­—æ®µXæ‹†åˆ†æˆå­—æ®µX-1å’Œå­—æ®µX-2ã€‚äº‹å®ä¸Šï¼Œä»»ä½•çš„DBMSéƒ½ä¼šæ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„è¦æ±‚ï¼Œä¸ä¼šå°†å­—æ®µè¿›è¡Œæ‹†åˆ†ã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p>å‡è®¾ä¸€å®¶å…¬å¸è¦å­˜å‚¨å‘˜å·¥çš„å§“åå’Œè”ç³»æ–¹å¼ã€‚å®ƒåˆ›å»ºä¸€ä¸ªå¦‚ä¸‹è¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706171057270.png" alt="image-20220706171057270"></p><p>è¯¥è¡¨ä¸ç¬¦åˆ 1NF ï¼Œå› ä¸ºè§„åˆ™è¯´â€œè¡¨çš„æ¯ä¸ªå±æ€§å¿…é¡»å…·æœ‰åŸå­ï¼ˆå•ä¸ªï¼‰å€¼â€ï¼Œlisiå’Œzhaoliuå‘˜å·¥çš„ emp_mobile å€¼è¿åäº†è¯¥è§„åˆ™ã€‚ä¸ºäº†ä½¿è¡¨ç¬¦åˆ 1NF ï¼Œæˆ‘ä»¬åº”è¯¥æœ‰å¦‚ä¸‹è¡¨æ•°æ®ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706171130851.png" alt="image-20220706171130851"></p><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p>user è¡¨çš„è®¾è®¡ä¸ç¬¦åˆç¬¬ä¸€èŒƒå¼</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706171225292.png" alt="image-20220706171225292"></p><p>å…¶ä¸­ï¼Œuser_infoå­—æ®µä¸ºç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ‹†åˆ†æˆæ›´å°ç²’åº¦çš„å­—æ®µï¼Œä¸ç¬¦åˆæ•°æ®åº“è®¾è®¡å¯¹ç¬¬ä¸€èŒƒå¼çš„ è¦æ±‚ã€‚å°†user_infoæ‹†åˆ†åå¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706171242455.png" alt="image-20220706171242455"></p><p><strong>ä¸¾ä¾‹3ï¼š</strong></p><p>å±æ€§çš„åŸå­æ€§æ˜¯ä¸»è§‚çš„ ã€‚ä¾‹å¦‚ï¼ŒEmployeeså…³ç³»ä¸­é›‡å‘˜å§“ååº”å½“ä½¿ç”¨1ä¸ªï¼ˆfullnameï¼‰ã€2ä¸ªï¼ˆfirstname å’Œlastnameï¼‰è¿˜æ˜¯3ä¸ªï¼ˆfirstnameã€middlenameå’Œlastnameï¼‰å±æ€§è¡¨ç¤ºå‘¢ï¼Ÿç­”æ¡ˆå–å†³äºåº”ç”¨ç¨‹åºã€‚å¦‚æœåº” ç”¨ç¨‹åºéœ€è¦åˆ†åˆ«å¤„ç†é›‡å‘˜çš„å§“åéƒ¨åˆ†ï¼ˆå¦‚ï¼šç”¨äºæœç´¢ç›®çš„ï¼‰ï¼Œåˆ™æœ‰å¿…è¦æŠŠå®ƒä»¬åˆ†å¼€ã€‚å¦åˆ™ï¼Œä¸éœ€è¦ã€‚</p><p>è¡¨1ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706171442919.png" alt="image-20220706171442919"></p><p>è¡¨2ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706171456873.png" alt="image-20220706171456873"></p><hr><h3 id="1-2-ç¬¬äºŒèŒƒå¼-2nd-NF">1.2 ç¬¬äºŒèŒƒå¼(2nd NF)</h3><p>ç¬¬äºŒèŒƒå¼è¦æ±‚ï¼Œåœ¨æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œ<span class='p red'>è¿˜è¦æ»¡è¶³æ•°æ®åº“é‡Œçš„æ¯ä¸€æ¡æ•°æ®è®°å½•ï¼Œéƒ½æ˜¯å¯å”¯ä¸€æ ‡è¯†çš„ã€‚è€Œä¸”æ‰€æœ‰éä¸»é”®å­—æ®µï¼Œéƒ½å¿…é¡»å®Œå…¨ä¾èµ–ä¸»é”®ï¼Œä¸èƒ½åªä¾èµ–ä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚</span>å¦‚æœçŸ¥é“ä¸»é”®çš„æ‰€æœ‰å±æ€§çš„å€¼ï¼Œå°±å¯ä»¥æ£€ç´¢åˆ°ä»»ä½•å…ƒç»„ï¼ˆè¡Œï¼‰çš„ä»»ä½•å±æ€§çš„ä»»ä½•å€¼ã€‚ï¼ˆè¦æ±‚ä¸­çš„ä¸»é”®ï¼Œå…¶å®å¯ä»¥æ‰©å±•æ›¿æ¢ä¸ºå€™é€‰é”®ï¼‰ã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p><code>æˆç»©è¡¨</code>ï¼ˆå­¦å·ï¼Œè¯¾ç¨‹å·ï¼Œæˆç»©ï¼‰å…³ç³»ä¸­ï¼Œï¼ˆå­¦å·ï¼Œè¯¾ç¨‹å·ï¼‰å¯ä»¥å†³å®šæˆç»©ï¼Œä½†æ˜¯å­¦å·ä¸èƒ½å†³å®šæˆç»©ï¼Œè¯¾ç¨‹å·ä¹Ÿä¸èƒ½å†³å®šæˆç»©ï¼Œæ‰€ä»¥â€œï¼ˆå­¦å·ï¼Œè¯¾ç¨‹å·ï¼‰â†’æˆç»©â€å°±æ˜¯<code>å®Œå…¨ä¾èµ–å…³ç³»</code>ã€‚</p><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p><code>æ¯”èµ›è¡¨ player_game</code>ï¼Œé‡Œé¢åŒ…å«çƒå‘˜ç¼–å·ã€å§“åã€å¹´é¾„ã€æ¯”èµ›ç¼–å·ã€æ¯”èµ›æ—¶é—´å’Œæ¯”èµ›åœºåœ°ç­‰å±æ€§ï¼Œè¿™é‡Œå€™é€‰é”®å’Œä¸»é”®éƒ½ä¸ºï¼ˆçƒå‘˜ç¼–å·ï¼Œæ¯”èµ›ç¼–å·ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å€™é€‰é”®ï¼ˆæˆ–ä¸»é”®ï¼‰æ¥å†³å®šå¦‚ä¸‹çš„å…³ç³»ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(çƒå‘˜ç¼–å·, æ¯”èµ›ç¼–å·) â†’ (å§“å, å¹´é¾„, æ¯”èµ›æ—¶é—´, æ¯”èµ›åœºåœ°ï¼Œå¾—åˆ†)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªæ•°æ®è¡¨ä¸æ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼Œå› ä¸ºæ•°æ®è¡¨ä¸­çš„å­—æ®µä¹‹é—´è¿˜å­˜åœ¨ç€å¦‚ä¸‹çš„éƒ¨åˆ†ä¾èµ–å…³ç³»ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(çƒå‘˜ç¼–å·) â†’ (å§“åï¼Œå¹´é¾„)</span><br><span class="line"></span><br><span class="line">(æ¯”èµ›ç¼–å·) â†’ (æ¯”èµ›æ—¶é—´, æ¯”èµ›åœºåœ°)</span><br></pre></td></tr></table></figure><p>å¯¹äºéä¸»å±æ€§æ¥è¯´ï¼Œå¹¶éå®Œå…¨ä¾èµ–å€™é€‰é”®ã€‚è¿™æ ·ä¼šäº§ç”Ÿæ€æ ·çš„é—®é¢˜å‘¢ï¼Ÿ</p><p>1.<code>æ•°æ®å†—ä½™</code>ï¼šå¦‚æœä¸€ä¸ªçƒå‘˜å¯ä»¥å‚åŠ  m åœºæ¯”èµ›ï¼Œé‚£ä¹ˆçƒå‘˜çš„å§“åå’Œå¹´é¾„å°±é‡å¤äº† m-1 æ¬¡ã€‚ä¸€ä¸ªæ¯”èµ› ä¹Ÿå¯èƒ½ä¼šæœ‰ n ä¸ªçƒå‘˜å‚åŠ ï¼Œæ¯”èµ›çš„æ—¶é—´å’Œåœ°ç‚¹å°±é‡å¤äº† n-1 æ¬¡ã€‚<br>2.<code>æ’å…¥å¼‚å¸¸</code>ï¼šå¦‚æœæˆ‘ä»¬æƒ³è¦æ·»åŠ ä¸€åœºæ–°çš„æ¯”èµ›ï¼Œä½†æ˜¯è¿™æ—¶è¿˜æ²¡æœ‰ç¡®å®šå‚åŠ çš„çƒå‘˜éƒ½æœ‰è°ï¼Œé‚£ä¹ˆå°±æ²¡æ³•æ’å…¥ã€‚<br>3.<code>åˆ é™¤å¼‚å¸¸</code>ï¼šå¦‚æœæˆ‘è¦åˆ é™¤æŸä¸ªçƒå‘˜ç¼–å·ï¼Œå¦‚æœæ²¡æœ‰å•ç‹¬ä¿å­˜æ¯”èµ›è¡¨çš„è¯ï¼Œå°±ä¼šåŒæ—¶æŠŠæ¯”èµ›ä¿¡æ¯åˆ é™¤æ‰ã€‚<br>4.<code>æ›´æ–°å¼‚å¸¸</code>ï¼šå¦‚æœæˆ‘ä»¬è°ƒæ•´äº†æŸä¸ªæ¯”èµ›çš„æ—¶é—´ï¼Œé‚£ä¹ˆæ•°æ®è¡¨ä¸­æ‰€æœ‰è¿™ä¸ªæ¯”èµ›çš„æ—¶é—´éƒ½éœ€è¦è¿›è¡Œè°ƒ æ•´ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸€åœºæ¯”èµ›æ—¶é—´ä¸åŒçš„æƒ…å†µã€‚</p><p>ä¸ºäº†é¿å…å‡ºç°ä¸Šè¿°çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠçƒå‘˜æ¯”èµ›è¡¨è®¾è®¡ä¸ºä¸‹é¢çš„ä¸‰å¼ è¡¨ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707122639894.png" alt="image-20220707122639894"></p><p>è¿™æ ·çš„è¯ï¼Œæ¯å¼ æ•°æ®è¡¨éƒ½ç¬¦åˆç¬¬äºŒèŒƒå¼ï¼Œä¹Ÿå°±é¿å…äº†å¼‚å¸¸æƒ…å†µçš„å‘ç”Ÿã€‚</p><blockquote><p>1NF å‘Šè¯‰æˆ‘ä»¬å­—æ®µå±æ€§éœ€è¦æ˜¯åŸå­æ€§çš„ï¼Œè€Œ2NFå‘Šè¯‰æˆ‘ä»¬ä¸€å¼ è¡¨å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œä¸€å¼ è¡¨åªè¡¨è¾¾ä¸€ä¸ªæ„æ€ã€‚</p></blockquote><p><strong>ä¸¾ä¾‹3ï¼š</strong></p><p>å®šä¹‰äº†ä¸€ä¸ªåä¸º Orders çš„å…³ç³»ï¼Œè¡¨ç¤ºè®¢å•å’Œè®¢å•è¡Œçš„ä¿¡æ¯ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707123038469.png" alt="image-20220707123038469"></p><p>è¿åäº†ç¬¬äºŒèŒƒå¼ï¼Œå› ä¸ºæœ‰éä¸»é”®å±æ€§ä»…ä¾èµ–äºå€™é€‰é”®ï¼ˆæˆ–ä¸»é”®ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä»…é€šè¿‡orderidæ‰¾ åˆ°è®¢å•çš„ orderdateï¼Œä»¥åŠ customerid å’Œ companynameï¼Œè€Œæ²¡æœ‰å¿…è¦å†å»ä½¿ç”¨productidã€‚</p><p>ä¿®æ”¹ï¼š</p><p>Ordersè¡¨å’ŒOrderDetailsè¡¨å¦‚ä¸‹ï¼Œæ­¤æ—¶ç¬¦åˆç¬¬äºŒèŒƒå¼ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707123104009.png" alt="image-20220707123104009"></p><blockquote><p>å°ç»“ï¼šç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰è¦æ±‚å®ä½“çš„å±æ€§å®Œå…¨ä¾èµ–ä¸»å…³é”®å­—ã€‚å¦‚æœå­˜åœ¨ä¸å®Œå…¨ä¾èµ–ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§å’Œä¸»å…³é”®å­—çš„è¿™ä¸€éƒ¨åˆ†åº”è¯¥åˆ†ç¦»å‡ºæ¥å½¢æˆä¸€ä¸ªæ–°çš„å®ä½“ï¼Œæ–°å®ä½“ä¸å…ƒå®ä½“ä¹‹é—´æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚</p></blockquote><hr><h3 id="1-3-ç¬¬ä¸‰èŒƒå¼-3rd-NF">1.3 ç¬¬ä¸‰èŒƒå¼(3rd NF)</h3><p>ç¬¬ä¸‰èŒƒå¼æ˜¯åœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œç¡®ä¿æ•°æ®è¡¨ä¸­çš„æ¯ä¸€ä¸ªéä¸»é”®å­—æ®µéƒ½å’Œä¸»é”®å­—æ®µç›´æ¥ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class='p red'>è¦æ±‚æ•°æ®è¡¨ä¸­çš„æ‰€æœ‰éä¸»é”®å­—æ®µä¸èƒ½ä¾èµ–äºå…¶ä»–éä¸»é”®å­—æ®µã€‚</span>ï¼ˆå³ï¼Œä¸èƒ½å­˜åœ¨éä¸»å±æ€§Aä¾èµ–äºéä¸»å±æ€§Bï¼Œéä¸»å±æ€§Bä¾èµ–äºä¸»é”®Cçš„æƒ…å†µï¼Œå³å­˜åœ¨â€œA-&gt;B-&gt;C&quot;çš„å†³å®šå…³ç³»ï¼‰é€šä¿—åœ°è®²ï¼Œè¯¥è§„åˆ™çš„æ„æ€æ˜¯æ‰€æœ‰<code>éä¸»é”®å±æ€§</code>ä¹‹é—´ä¸èƒ½ç”±ä¾èµ–å…³ç³»ï¼Œå¿…é¡»<code>ç›¸äº’ç‹¬ç«‹</code>ã€‚</p><p>è¿™é‡Œçš„ä¸»é”®å¯ä»¥æ‰©å±•ä¸ºå€™é€‰é”®ã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p><code>éƒ¨é—¨ä¿¡æ¯è¡¨</code>ï¼šæ¯ä¸ªéƒ¨é—¨æœ‰éƒ¨é—¨ç¼–å·ï¼ˆdept_idï¼‰ã€éƒ¨é—¨åç§°ã€éƒ¨é—¨ç®€ä»‹ç­‰ä¿¡æ¯ã€‚</p><p><code>å‘˜å·¥ä¿¡æ¯è¡¨</code>ï¼šæ¯ä¸ªå‘˜å·¥æœ‰å‘˜å·¥ç¼–å·ã€å§“åã€éƒ¨é—¨ç¼–å·ã€‚åˆ—å‡ºéƒ¨é—¨ç¼–å·åå°±ä¸èƒ½å†å°†éƒ¨é—¨åç§°ã€éƒ¨é—¨ç®€ä»‹ ç­‰ä¸éƒ¨é—¨æœ‰å…³çš„ä¿¡æ¯å†åŠ å…¥å‘˜å·¥ä¿¡æ¯è¡¨ä¸­ã€‚</p><p>å¦‚æœä¸å­˜åœ¨éƒ¨é—¨ä¿¡æ¯è¡¨ï¼Œåˆ™æ ¹æ®ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ä¹Ÿåº”è¯¥æ„å»ºå®ƒï¼Œå¦åˆ™å°±ä¼šæœ‰å¤§é‡çš„æ•°æ®å†—ä½™ã€‚</p><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707124011654.png" alt="image-20220707124011654"></p><p>å•†å“ç±»åˆ«åç§°ä¾èµ–äºå•†å“ç±»åˆ«ç¼–å·ï¼Œä¸ç¬¦åˆç¬¬ä¸‰èŒƒå¼ã€‚</p><p>ä¿®æ”¹ï¼š</p><p>è¡¨1ï¼šç¬¦åˆç¬¬ä¸‰èŒƒå¼çš„<code>å•†å“ç±»åˆ«è¡¨</code>çš„è®¾è®¡</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707124040899.png" alt="image-20220707124040899"></p><p>è¡¨2ï¼šç¬¦åˆç¬¬ä¸‰èŒƒå¼çš„<code>å•†å“è¡¨</code>çš„è®¾è®¡</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707124058174.png" alt="image-20220707124058174"></p><p>å•†å“è¡¨goodsé€šè¿‡å•†å“ç±»åˆ«idå­—æ®µï¼ˆcategory_idï¼‰ä¸å•†å“ç±»åˆ«è¡¨goods_categoryè¿›è¡Œå…³è”ã€‚</p><p><strong>ä¸¾ä¾‹3ï¼š</strong></p><p><code>çƒå‘˜playerè¡¨</code>ï¼šçƒå‘˜ç¼–å·ã€å§“åã€çƒé˜Ÿåç§°å’Œçƒé˜Ÿä¸»æ•™ç»ƒã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠå±æ€§ä¹‹é—´çš„ä¾èµ–å…³ç³»ç”»å‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707124136228.png" alt="image-20220707124136228"></p><p>ä½ èƒ½çœ‹åˆ°çƒå‘˜ç¼–å·å†³å®šäº†çƒé˜Ÿåç§°ï¼ŒåŒæ—¶çƒé˜Ÿåç§°å†³å®šäº†çƒé˜Ÿä¸»æ•™ç»ƒï¼Œéä¸»å±æ€§çƒé˜Ÿä¸»æ•™ç»ƒå°±ä¼šä¼ é€’ä¾ èµ–äºçƒå‘˜ç¼–å·ï¼Œå› æ­¤ä¸ç¬¦åˆ 3NF çš„è¦æ±‚ã€‚</p><p>å¦‚æœè¦è¾¾åˆ° 3NF çš„è¦æ±‚ï¼Œéœ€è¦æŠŠæ•°æ®è¡¨æ‹†æˆä¸‹é¢è¿™æ ·ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707124152312.png" alt="image-20220707124152312"></p><p><strong>ä¸¾ä¾‹4ï¼š</strong></p><p>ä¿®æ”¹ç¬¬äºŒèŒƒå¼ä¸­çš„ä¸¾ä¾‹3ã€‚</p><p>æ­¤æ—¶çš„Orderså…³ç³»åŒ…å« orderidã€orderdateã€customerid å’Œ companyname å±æ€§ï¼Œä¸»é”®å®šä¹‰ä¸º orderidã€‚ customerid å’Œcompanynameå‡ä¾èµ–äºä¸»é”®â€”â€”orderidã€‚ä¾‹å¦‚ï¼Œä½ éœ€è¦é€šè¿‡orderidä¸»é”®æ¥æŸ¥æ‰¾ä»£è¡¨è®¢å•ä¸­ å®¢æˆ·çš„customeridï¼ŒåŒæ ·ï¼Œä½ éœ€è¦é€šè¿‡ orderid ä¸»é”®æŸ¥æ‰¾è®¢å•ä¸­å®¢æˆ·çš„å…¬å¸åç§°ï¼ˆcompanynameï¼‰ã€‚ç„¶ è€Œï¼Œ customeridå’Œcompanynameä¹Ÿæ˜¯äº’ç›¸ä¾é çš„ã€‚ä¸ºæ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œå¯ä»¥æ”¹å†™å¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707124212114.png" alt="image-20220707124212114"></p><blockquote><p>ç¬¦åˆ3NFåçš„æ•°æ®æ¨¡å‹é€šä¿—åœ°è®²ï¼Œ2NFå’Œ3NFé€šå¸¸ä»¥è¿™å¥è¯æ¦‚æ‹¬ï¼šâ€œæ¯ä¸ªéé”®å±æ€§ä¾èµ–äºé”®ï¼Œä¾èµ–äº æ•´ä¸ªé”®ï¼Œå¹¶ä¸”é™¤äº†é”®åˆ«æ— ä»–ç‰©â€ã€‚</p></blockquote><hr><h3 id="1-4-å°ç»“">1.4 å°ç»“</h3><p>å…³äºæ•°æ®è¡¨çš„è®¾è®¡ï¼Œæœ‰ä¸‰ä¸ªèŒƒå¼è¦éµå¾ªã€‚</p><ol><li><p>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NF)ï¼Œç¡®ä¿æ¯åˆ—ä¿æŒ<code>åŸå­æ€§</code></p><p>æ•°æ®åº“çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ï¼Œä¸å¯å†åˆ†çš„æœ€å°æ•°æ®å•å…ƒï¼Œè€Œä¸èƒ½æ˜¯é›†åˆã€æ•°ç»„ã€è®°å½•ç­‰éåŸå­æ•°æ®é¡¹ã€‚</p></li><li><p>ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ç¡®ä¿æ¯åˆ—éƒ½å’Œä¸»é”®<code>å®Œå…¨ä¾èµ–</code></p><p>å°¤å…¶åœ¨å¤åˆä¸»é”®çš„æƒ…å†µä¸‹ï¼Œéä¸»é”®éƒ¨åˆ†ä¸åº”è¯¥ä¾èµ–äºéƒ¨åˆ†ä¸»é”®ã€‚</p></li><li><p>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ç¡®ä¿æ¯åˆ—éƒ½å’Œä¸»é”®åˆ—<code>ç›´æ¥ç›¸å…³</code>ï¼Œè€Œä¸æ˜¯é—´æ¥ç›¸å…³</p></li></ol><span class='p red'>èŒƒå¼çš„ä¼˜ç‚¹</span>ï¼šæ•°æ®çš„æ ‡å‡†åŒ–æœ‰åŠ©äºæ¶ˆé™¤æ•°æ®åº“ä¸­çš„æ•°æ®å†—ä½™ï¼Œç¬¬ä¸‰èŒƒå¼(3NFï¼‰é€šå¸¸è¢«è®¤ä¸ºåœ¨æ€§èƒ½ã€æ‰©å±•æ€§å’Œæ•°æ®å®Œæ•´æ€§æ–¹é¢è¾¾åˆ°äº†æœ€å¥½çš„å¹³è¡¡ã€‚<br/><span class='p red'>èŒƒå¼çš„ç¼ºç‚¹</span>ï¼šèŒƒå¼çš„ä½¿ç”¨ï¼Œå¯èƒ½é™ä½æŸ¥è¯¢çš„æ•ˆç‡ã€‚å› ä¸ºèŒƒå¼ç­‰çº§è¶Šé«˜ï¼Œè®¾è®¡å‡ºæ¥çš„æ•°æ®è¡¨å°±è¶Šå¤šã€è¶Šç²¾ç»†ï¼Œæ•°æ®çš„å†—ä½™åº¦å°±è¶Šä½ï¼Œè¿›è¡Œæ•°æ®æŸ¥è¯¢çš„æ—¶å€™å°±å¯èƒ½éœ€è¦å…³è”å¤šå¼ è¡¨ï¼Œè¿™ä¸ä½†ä»£ä»·æ˜‚è´µï¼Œä¹Ÿå¯èƒ½ä½¿ä¸€äº›ç´¢å¼•ç­–ç•¥æ— æ•ˆã€‚<p><br/>èŒƒå¼åªæ˜¯æå‡ºäº†è®¾è®¡çš„æ ‡å‡†ï¼Œå®é™…ä¸Šè®¾è®¡æ•°æ®è¡¨æ—¶ï¼Œæœªå¿…ä¸€å®šè¦ç¬¦åˆè¿™äº›æ ‡å‡†ã€‚å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šå‡ºç°ä¸ºäº†æ€§èƒ½å’Œè¯»å–æ•ˆç‡è¿åèŒƒå¼åŒ–çš„åŸåˆ™ï¼Œé€šè¿‡<code>å¢åŠ å°‘é‡çš„å†—ä½™</code>æˆ–é‡å¤çš„æ•°æ®æ¥æé«˜æ•°æ®åº“çš„<code>è¯»æ€§èƒ½</code>ï¼Œå‡å°‘å…³è”æŸ¥è¯¢ï¼Œjoin è¡¨çš„æ¬¡æ•°ï¼Œå®ç°<code>ç©ºé—´æ¢å–æ—¶é—´</code>çš„ç›®çš„ã€‚å› æ­¤åœ¨å®é™…çš„è®¾è®¡è¿‡ç¨‹ä¸­è¦ç†è®ºç»“åˆå®é™…ï¼Œçµæ´»è¿ç”¨ã€‚</p><blockquote><p>èŒƒå¼æœ¬èº«æ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œåªæœ‰é€‚ç”¨åœºæ™¯ä¸åŒã€‚æ²¡æœ‰å®Œç¾çš„è®¾è®¡ï¼Œåªæœ‰åˆé€‚çš„è®¾è®¡ï¼Œæˆ‘ä»¬åœ¨æ•°æ®è¡¨çš„è®¾è®¡ä¸­ï¼Œ è¿˜éœ€è¦æ ¹æ®éœ€æ±‚å°†èŒƒå¼å’ŒåèŒƒå¼æ··åˆä½¿ç”¨ã€‚</p></blockquote><hr><h2 id="2-åèŒƒå¼">2. åèŒƒå¼</h2><p>æœ‰çš„æ—¶å€™ä¸èƒ½ç®€å•æŒ‰ç…§è§„èŒƒè¦æ±‚è®¾è®¡æ•°æ®è¡¨ï¼Œå› ä¸ºæœ‰çš„æ•°æ®çœ‹ä¼¼å†—ä½™ï¼Œå…¶å®å¯¹ä¸šåŠ¡æ¥è¯´ååˆ†é‡è¦ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦éµå¾ª<code>ä¸šåŠ¡ä¼˜å…ˆ</code>çš„åŸåˆ™ï¼Œé¦–å…ˆæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œå†å°½é‡å‡å°‘å†—ä½™ã€‚</p><p>å¦‚æœæ•°æ®åº“ä¸­çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œç³»ç»Ÿçš„UVå’ŒPVè®¿é—®é¢‘æ¬¡æ¯”è¾ƒé«˜ï¼Œåˆ™å®Œå…¨æŒ‰ç…§MySQLçš„ä¸‰å¤§èŒƒå¼è®¾è®¡æ•°æ®è¡¨ï¼Œè¯»æ•°æ®æ—¶ä¼šäº§ç”Ÿå¤§é‡çš„å…³è”æŸ¥è¯¢ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“æ•°æ®åº“çš„è¯»æ€§èƒ½ã€‚å¦‚æœæˆ‘ä»¬æƒ³å¯¹æŸ¥è¯¢æ•ˆç‡è¿›è¡Œä¼˜åŒ–ï¼Œ<code>åèŒƒå¼ä¼˜åŒ–</code>ä¹Ÿæ˜¯ä¸€ç§ä¼˜åŒ–æ€è·¯ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡åœ¨æ•°æ®è¡¨ä¸­<code>å¢åŠ å†—ä½™å­—æ®µ</code>æ¥æé«˜æ•°æ®åº“çš„è¯»æ€§èƒ½ã€‚</p><p><strong>è§„èŒƒåŒ– vs æ€§èƒ½</strong></p><blockquote><ol><li>ä¸ºæ»¡è¶³æŸç§å•†ä¸šç›®æ ‡ , æ•°æ®åº“æ€§èƒ½æ¯”è§„èŒƒåŒ–æ•°æ®åº“æ›´é‡è¦</li><li>åœ¨æ•°æ®è§„èŒƒåŒ–çš„åŒæ—¶ , è¦ç»¼åˆè€ƒè™‘æ•°æ®åº“çš„æ€§èƒ½</li><li>é€šè¿‡åœ¨ç»™å®šçš„è¡¨ä¸­æ·»åŠ é¢å¤–çš„å­—æ®µï¼Œä»¥å¤§é‡å‡å°‘éœ€è¦ä»ä¸­æœç´¢ä¿¡æ¯æ‰€éœ€çš„æ—¶é—´</li><li>é€šè¿‡åœ¨ç»™å®šçš„è¡¨ä¸­æ’å…¥è®¡ç®—åˆ—ï¼Œä»¥æ–¹ä¾¿æŸ¥è¯¢</li></ol></blockquote><hr><h3 id="2-1-åº”ç”¨ä¸¾ä¾‹">2.1 åº”ç”¨ä¸¾ä¾‹</h3><div class="tabs" id="041f1c1d-0ba6-4483-89f6-cee4dc2da113"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#041f1c1d-0ba6-4483-89f6-cee4dc2da113-1"><i class="fas fa-bug"></i>ä¸¾ä¾‹1ï¼š</button></li><li class="tab"><button type="button" data-href="#041f1c1d-0ba6-4483-89f6-cee4dc2da113-2"><i class="fas fa-cannabis"></i>ä¸¾ä¾‹2</button></li><li class="tab"><button type="button" data-href="#041f1c1d-0ba6-4483-89f6-cee4dc2da113-3"><i class="fas fa-candy-cane"></i>ä¸¾ä¾‹3</button></li><li class="tab"><button type="button" data-href="#041f1c1d-0ba6-4483-89f6-cee4dc2da113-4"><i class="fas fa-child"></i>ä¸¾ä¾‹4</button></li><li class="tab"><button type="button" data-href="#041f1c1d-0ba6-4483-89f6-cee4dc2da113-5"><i class="fas fa-cookie-bite"></i>å®éªŒéªŒè¯</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="041f1c1d-0ba6-4483-89f6-cee4dc2da113-1"><p>å‘˜å·¥çš„ä¿¡æ¯å­˜å‚¨åœ¨<code>employees è¡¨</code>ä¸­ï¼Œéƒ¨é—¨ä¿¡æ¯å­˜å‚¨åœ¨<code>departments è¡¨</code>ä¸­ã€‚é€šè¿‡ employees è¡¨ä¸­çš„ department_idå­—æ®µä¸ departments è¡¨å»ºç«‹å…³è”å…³ç³»ã€‚å¦‚æœè¦æŸ¥è¯¢ä¸€ä¸ªå‘˜å·¥æ‰€åœ¨éƒ¨é—¨çš„åç§°ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id,department_name</span><br><span class="line"><span class="keyword">from</span> employees e <span class="keyword">join</span> departments d</span><br><span class="line"><span class="keyword">on</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure><p>å¦‚æœç»å¸¸éœ€è¦è¿›è¡Œè¿™ä¸ªæ“ä½œï¼Œè¿æ¥æŸ¥è¯¢å°±ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ã€‚å¯ä»¥åœ¨ employees è¡¨ä¸­å¢åŠ ä¸€ä¸ªå†—ä½™å­—æ®µ department_nameï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡éƒ½è¿›è¡Œè¿æ¥æ“ä½œäº†ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="041f1c1d-0ba6-4483-89f6-cee4dc2da113-2"><p>åèŒƒå¼åŒ–çš„<code>goodså•†å“ä¿¡æ¯è¡¨</code>è®¾è®¡å¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707125118808.png" alt="image-20220707125118808"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="041f1c1d-0ba6-4483-89f6-cee4dc2da113-3"><p>æˆ‘ä»¬æœ‰ 2 ä¸ªè¡¨ï¼Œåˆ†åˆ«æ˜¯<code>å•†å“æµæ°´è¡¨ï¼ˆatguigu.trans ï¼‰</code>å’Œ<code>å•†å“ä¿¡æ¯è¡¨ ï¼ˆatguigu.goodsinfoï¼‰</code>ã€‚å•†å“æµæ°´è¡¨é‡Œæœ‰ 400 ä¸‡æ¡æµæ°´è®°å½•ï¼Œå•†å“ä¿¡æ¯è¡¨é‡Œæœ‰ 2000 æ¡å•†å“è®°å½•ã€‚</p><p>å•†å“æµæ°´è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707125401029.png" alt="image-20220707125401029" style="zoom: 50%;" /><p>å•†å“ä¿¡æ¯è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707125447317.png" alt="image-20220707125447317" style="zoom:50%;" /><p>æ–°çš„å•†å“æµæ°´è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707125500378.png" alt="image-20220707125500378" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="041f1c1d-0ba6-4483-89f6-cee4dc2da113-4"><p><code>è¯¾ç¨‹è¯„è®ºè¡¨ class_comment</code>ï¼Œå¯¹åº”çš„å­—æ®µåç§°åŠå«ä¹‰å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707125531172.png" alt="image-20220707125531172" style="zoom:50%;" /><p><code>å­¦ç”Ÿè¡¨ student</code>ï¼Œå¯¹åº”çš„å­—æ®µåç§°åŠå«ä¹‰å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707125545891.png" alt="image-20220707125545891" style="zoom: 50%;" /><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åœ¨æ˜¾ç¤ºè¯¾ç¨‹è¯„è®ºçš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºè¿™ä¸ªå­¦ç”Ÿçš„æ˜µç§°ï¼Œè€Œä¸æ˜¯å­¦ç”Ÿ IDï¼Œå› æ­¤å½“æˆ‘ä»¬ æƒ³è¦æŸ¥è¯¢æŸä¸ªè¯¾ç¨‹çš„å‰ 1000 æ¡è¯„è®ºæ—¶ï¼Œéœ€è¦å…³è” class_comment å’Œ studentè¿™ä¸¤å¼ è¡¨æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="041f1c1d-0ba6-4483-89f6-cee4dc2da113-5"><p><strong>å®éªŒæ•°æ®ï¼šæ¨¡æ‹Ÿä¸¤å¼ ç™¾ä¸‡é‡çº§çš„æ•°æ®è¡¨</strong></p><p>ä¸ºäº†æ›´å¥½åœ°è¿›è¡Œ SQL ä¼˜åŒ–å®éªŒï¼Œæˆ‘ä»¬éœ€è¦ç»™å­¦ç”Ÿè¡¨å’Œè¯¾ç¨‹è¯„è®ºè¡¨éšæœºæ¨¡æ‹Ÿå‡ºç™¾ä¸‡é‡çº§çš„æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ é€šè¿‡å­˜å‚¨è¿‡ç¨‹æ¥å®ç°æ¨¡æ‹Ÿæ•°æ®ã€‚</p><p><strong>åèŒƒå¼ä¼˜åŒ–å®éªŒå¯¹æ¯”</strong></p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢è¯¾ç¨‹ ID ä¸º 10001 çš„å‰ 1000 æ¡è¯„è®ºï¼Œéœ€è¦å†™æˆä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> p.comment_text, p.comment_time, stu.stu_name</span><br><span class="line"><span class="keyword">FROM</span> class_comment <span class="keyword">AS</span> p <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> student <span class="keyword">AS</span> stu</span><br><span class="line"><span class="keyword">ON</span> p.stu_id <span class="operator">=</span> stu.stu_id</span><br><span class="line"><span class="keyword">WHERE</span> p.class_id <span class="operator">=</span> <span class="number">10001</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> p.comment_id <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ˆ1000 æ¡æ•°æ®è¡Œï¼‰ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707125642908.png" alt="image-20220707125642908" style="zoom: 50%;" /><p>è¿è¡Œæ—¶é•¿ä¸º 0.395 ç§’ï¼Œå¯¹äºç½‘ç«™çš„å“åº”æ¥è¯´ï¼Œè¿™å·²ç»å¾ˆæ…¢äº†ï¼Œç”¨æˆ·ä½“éªŒä¼šéå¸¸å·®ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æå‡æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå¯ä»¥å…è®¸é€‚å½“çš„æ•°æ®å†—ä½™ï¼Œä¹Ÿå°±æ˜¯åœ¨å•†å“è¯„è®ºè¡¨ä¸­å¢åŠ ç”¨æˆ·æ˜µç§°å­—æ®µï¼Œ åœ¨ class_comment æ•°æ®è¡¨çš„åŸºç¡€ä¸Šå¢åŠ  stu_name å­—æ®µï¼Œå°±å¾—åˆ°äº† class_comment2 æ•°æ®è¡¨ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œåªéœ€å•è¡¨æŸ¥è¯¢å°±å¯ä»¥å¾—åˆ°æ•°æ®é›†ç»“æœï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> comment_text, comment_time, stu_name</span><br><span class="line"><span class="keyword">FROM</span> class_comment2</span><br><span class="line"><span class="keyword">WHERE</span> class_id <span class="operator">=</span> <span class="number">10001</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> class_id <span class="keyword">DESC</span> LIMIT <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ˆ1000 æ¡æ•°æ®ï¼‰ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707125718469.png" alt="image-20220707125718469" style="zoom:80%;" /><p>ä¼˜åŒ–ä¹‹ååªéœ€è¦æ‰«æä¸€æ¬¡èšé›†ç´¢å¼•å³å¯ï¼Œè¿è¡Œæ—¶é—´ä¸º 0.039 ç§’ï¼ŒæŸ¥è¯¢æ—¶é—´æ˜¯ä¹‹å‰çš„ 1/10ã€‚ ä½ èƒ½çœ‹åˆ°ï¼Œ åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šæœ‰æ˜¾è‘—çš„æå‡ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="2-2-åèŒƒå¼çš„æ–°é—®é¢˜">2.2 åèŒƒå¼çš„æ–°é—®é¢˜</h3><ul><li>å­˜å‚¨ç©ºé—´å˜å¤§äº†</li><li>ä¸€ä¸ªè¡¨ä¸­å­—æ®µåšäº†ä¿®æ”¹ï¼Œå¦ä¸€ä¸ªè¡¨ä¸­å†—ä½™çš„å­—æ®µä¹Ÿéœ€è¦åšåŒæ­¥ä¿®æ”¹ï¼Œå¦åˆ™ æ•°æ®ä¸ä¸€è‡´</li><li>è‹¥é‡‡ç”¨å­˜å‚¨è¿‡ç¨‹æ¥æ”¯æŒæ•°æ®çš„æ›´æ–°ã€åˆ é™¤ç­‰é¢å¤–æ“ä½œï¼Œå¦‚æœæ›´æ–°é¢‘ç¹ï¼Œä¼šéå¸¸æ¶ˆè€—ç³»ç»Ÿèµ„æº</li><li>åœ¨ æ•°æ®é‡å°çš„æƒ…å†µä¸‹ï¼ŒåèŒƒå¼ä¸èƒ½ä½“ç°æ€§èƒ½çš„ä¼˜åŠ¿ï¼Œå¯èƒ½è¿˜ä¼šè®©æ•°æ®åº“çš„è®¾è®¡æ›´åŠ å¤æ‚</li></ul><h3 id="2-3-åèŒƒå¼çš„é€‚ç”¨åœºæ™¯">2.3 åèŒƒå¼çš„é€‚ç”¨åœºæ™¯</h3><p>å½“å†—ä½™ä¿¡æ¯æœ‰ä»·å€¼æˆ–è€…èƒ½<code>å¤§å¹…åº¦æé«˜æŸ¥è¯¢æ•ˆç‡</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰ä¼šé‡‡å–åèŒƒå¼çš„ä¼˜åŒ–ã€‚</p><blockquote><p>å¢åŠ å†—ä½™å­—æ®µçš„å»ºè®®</p></blockquote><p>å¢åŠ å†—ä½™å­—æ®µä¸€å®šè¦ç¬¦åˆå¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ã€‚åªè¦æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰å¯ä»¥è€ƒè™‘å¢åŠ å¤¯ä½™å­—æ®µã€‚</p><p>1ï¼‰è¿™ä¸ªå†—ä½™å­—æ®µ<code>ä¸éœ€è¦ç»å¸¸è¿›è¡Œä¿®æ”¹</code>ã€‚</p><p>2ï¼‰è¿™ä¸ªå†—ä½™å­—æ®µ<code>æŸ¥è¯¢çš„æ—¶å€™ä¸å¯æˆ–ç¼º</code>ã€‚</p><blockquote><p>å†å²å¿«ç…§ã€å†å²æ•°æ®çš„éœ€è¦</p></blockquote><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¸€äº›å†—ä½™ä¿¡æ¯ï¼Œæ¯”å¦‚è®¢å•ä¸­çš„æ”¶è´§äººä¿¡æ¯ï¼ŒåŒ…æ‹¬å§“åã€ç”µè¯å’Œåœ°å€ç­‰ã€‚æ¯ æ¬¡å‘ç”Ÿçš„<code>è®¢å•æ”¶è´§ä¿¡æ¯</code>éƒ½å±äº<code>å†å²å¿«ç…§</code>ï¼Œéœ€è¦è¿›è¡Œä¿å­˜ï¼Œä½†ç”¨æˆ·å¯ä»¥éšæ—¶ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯ï¼Œè¿™æ—¶ä¿å­˜è¿™ äº›å†—ä½™ä¿¡æ¯æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p><p>åèŒƒå¼ä¼˜åŒ–ä¹Ÿå¸¸ç”¨åœ¨<code>æ•°æ®ä»“åº“</code>çš„è®¾è®¡ä¸­ï¼Œå› ä¸ºæ•°æ®ä»“åº“é€šå¸¸<code>å­˜å‚¨å†å²æ•°æ®</code>ï¼Œå¯¹å¢åˆ æ”¹çš„å®æ—¶æ€§è¦æ±‚ä¸ å¼ºï¼Œå¯¹å†å²æ•°æ®çš„åˆ†æéœ€æ±‚å¼ºã€‚è¿™æ—¶é€‚å½“å…è®¸æ•°æ®çš„å†—ä½™åº¦ï¼Œæ›´æ–¹ä¾¿è¿›è¡Œæ•°æ®åˆ†æã€‚</p><p>æˆ‘ç®€å•æ€»ç»“ä¸‹æ•°æ®ä»“åº“å’Œæ•°æ®åº“åœ¨ä½¿ç”¨ä¸Šçš„åŒºåˆ«ï¼š</p><ol><li>æ•°æ®åº“è®¾è®¡çš„ç›®çš„åœ¨äº<code>æ•æ‰æ•°æ®</code>ï¼Œè€Œæ•°æ®ä»“åº“è®¾è®¡çš„ç›®çš„åœ¨äº<code>åˆ†ææ•°æ®</code>ã€‚</li><li>æ•°æ®åº“å¯¹æ•°æ®çš„<code>å¢åˆ æ”¹å®æ—¶æ€§</code>è¦æ±‚å¼ºï¼Œéœ€è¦å­˜å‚¨åœ¨çº¿çš„ç”¨æˆ·æ•°æ®ï¼Œè€Œæ•°æ®ä»“åº“å­˜å‚¨çš„ä¸€èˆ¬æ˜¯<code>å†å²æ•°æ®</code>ã€‚</li><li>æ•°æ®åº“è®¾è®¡éœ€è¦<code>å°½é‡é¿å…å†—ä½™</code>ï¼Œä½†ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ä¹Ÿå…è®¸ä¸€å®šçš„<code>å†—ä½™åº¦</code>ï¼Œè€Œæ•°æ®ä»“åº“åœ¨è®¾è®¡ä¸Šæ›´åå‘é‡‡ç”¨åèŒƒå¼è®¾è®¡ï¼Œ</li></ol><hr><h2 id="3-BCNF-å·´æ–¯èŒƒå¼">3. BCNF(å·´æ–¯èŒƒå¼)</h2><p>äººä»¬åœ¨3NFçš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹è¿›ï¼Œæå‡ºäº†å·´æ–¯èŒƒå¼ï¼ˆBCNFï¼‰ï¼Œé¡µè„šå·´æ–¯ - ç§‘å¾·èŒƒå¼ï¼ˆBoyce - Codd Normal Formï¼‰ã€‚BCNFè¢«è®¤ä¸ºæ²¡æœ‰æ–°çš„è®¾è®¡è§„èŒƒåŠ å…¥ï¼Œåªæ˜¯å¯¹ç¬¬ä¸‰èŒƒå¼ä¸­è®¾è®¡è§„èŒƒè¦æ±‚æ›´å¼ºï¼Œä½¿å¾—æ•°æ®åº“å†—ä½™åº¦æ›´å°ã€‚æ‰€ä»¥ï¼Œç§°ä¸ºæ˜¯<code>ä¿®æ­£çš„ç¬¬ä¸‰èŒƒå¼</code>ï¼Œæˆ–<code>æ‰©å……çš„ç¬¬ä¸‰èŒƒå¼</code>ï¼ŒBCNFä¸è¢«ç§°ä¸ºç¬¬å››èŒƒå¼ã€‚</p><p>è‹¥ä¸€ä¸ªå…³ç³»è¾¾åˆ°äº†ç¬¬ä¸‰èŒƒå¼ï¼Œå¹¶ä¸”å®ƒåªæœ‰ä¸€ä¸ªå€™é€‰é”®ï¼Œæˆ–è€…å®ƒçš„æ¯ä¸ªå€™é€‰é”®éƒ½æ˜¯å•å±æ€§ï¼Œåˆ™è¯¥å…³ç³»è‡ªç„¶è¾¾åˆ°BCèŒƒå¼ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªæ•°æ®åº“è®¾ç¬¦åˆ3NFæˆ–è€…BCNFå°±å¯ä»¥äº†ã€‚</p><p><strong>1. æ¡ˆä¾‹</strong></p><p>æˆ‘ä»¬åˆ†æå¦‚ä¸‹è¡¨çš„èŒƒå¼æƒ…å†µï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707131428597.png" alt="image-20220707131428597" style="zoom: 50%;" /><p>åœ¨è¿™ä¸ªè¡¨ä¸­ï¼Œä¸€ä¸ªä»“åº“åªæœ‰ä¸€ä¸ªç®¡ç†å‘˜ï¼ŒåŒæ—¶ä¸€ä¸ªç®¡ç†å‘˜ä¹Ÿåªç®¡ç†ä¸€ä¸ªä»“åº“ã€‚æˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸‹è¿™äº›å±æ€§ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p>ä»“åº“åå†³å®šäº†ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜ä¹Ÿå†³å®šäº†ä»“åº“åï¼ŒåŒæ—¶ï¼ˆä»“åº“åï¼Œç‰©å“åï¼‰çš„å±æ€§é›†åˆå¯ä»¥å†³å®šæ•°é‡è¿™ä¸ª å±æ€§ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°æ•°æ®è¡¨çš„å€™é€‰é”®ã€‚</p><p><code>å€™é€‰é”®</code>ï¼šæ˜¯ï¼ˆç®¡ç†å‘˜ï¼Œç‰©å“åï¼‰å’Œï¼ˆä»“åº“åï¼Œç‰©å“åï¼‰ï¼Œç„¶åæˆ‘ä»¬ä»å€™é€‰é”®ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºä¸»é”® ï¼Œæ¯” å¦‚ï¼ˆä»“åº“åï¼Œç‰©å“åï¼‰ã€‚</p><p><code>ä¸»å±æ€§</code>ï¼šåŒ…å«åœ¨ä»»ä¸€å€™é€‰é”®ä¸­çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯ä»“åº“åï¼Œç®¡ç†å‘˜å’Œç‰©å“åã€‚</p><p><code>éä¸»å±æ€§</code>ï¼šæ•°é‡è¿™ä¸ªå±æ€§ã€‚</p><p><strong>2. æ˜¯å¦ç¬¦åˆä¸‰èŒƒå¼</strong></p><p>å¦‚ä½•åˆ¤æ–­ä¸€å¼ è¡¨çš„èŒƒå¼å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦æ ¹æ®èŒƒå¼çš„ç­‰çº§ï¼Œä»ä½åˆ°é«˜æ¥è¿›è¡Œåˆ¤æ–­ã€‚</p><p>é¦–å…ˆï¼Œæ•°æ®è¡¨æ¯ä¸ªå±æ€§éƒ½æ˜¯åŸå­æ€§çš„ï¼Œç¬¦åˆ 1NF çš„è¦æ±‚ï¼›</p><p>å…¶æ¬¡ï¼Œæ•°æ®è¡¨ä¸­éä¸»å±æ€§â€æ•°é‡â€œéƒ½ä¸å€™é€‰é”®å…¨éƒ¨ä¾èµ–ï¼Œï¼ˆä»“åº“åï¼Œç‰©å“åï¼‰å†³å®šæ•°é‡ï¼Œï¼ˆç®¡ç†å‘˜ï¼Œç‰©å“åï¼‰å†³å®šæ•°é‡ã€‚å› æ­¤ï¼Œæ•°æ®è¡¨ç¬¦åˆ 2NF çš„è¦æ±‚ï¼›</p><p>æœ€åï¼Œæ•°æ®è¡¨ä¸­çš„éä¸»å±æ€§ï¼Œä¸ä¼ é€’ä¾èµ–äºå€™é€‰é”®ã€‚å› æ­¤ç¬¦åˆ 3NF çš„è¦æ±‚ã€‚</p><p><strong>3. å­˜åœ¨çš„é—®é¢˜</strong></p><p>æ—¢ç„¶æ•°æ®è¡¨å·²ç»ç¬¦åˆäº† 3NF çš„è¦æ±‚ï¼Œæ˜¯ä¸æ˜¯å°±ä¸å­˜åœ¨é—®é¢˜äº†å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„æƒ…å†µï¼š</p><ol><li>å¢åŠ ä¸€ä¸ªä»“åº“ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å­˜æ”¾ä»»ä½•ç‰©å“ã€‚æ ¹æ®æ•°æ®è¡¨å®ä½“å®Œæ•´æ€§çš„è¦æ±‚ï¼Œä¸»é”®ä¸èƒ½æœ‰ç©ºå€¼ï¼Œå› æ­¤ä¼šå‡ºç°æ’å…¥å¼‚å¸¸ ï¼›</li><li>å¦‚æœä»“åº“æ›´æ¢äº†ç®¡ç†å‘˜ï¼Œæˆ‘ä»¬å°±å¯èƒ½ä¼šä¿®æ”¹æ•°æ®è¡¨ä¸­çš„å¤šæ¡è®°å½• ï¼›</li><li>å¦‚æœä»“åº“é‡Œçš„å•†å“éƒ½å–ç©ºäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶ä»“åº“åç§°å’Œç›¸åº”çš„ç®¡ç†å‘˜åç§°ä¹Ÿä¼šéšä¹‹è¢«åˆ é™¤ã€‚</li></ol><p>ä½ èƒ½çœ‹åˆ°ï¼Œå³ä¾¿æ•°æ®è¡¨ç¬¦åˆ 3NF çš„è¦æ±‚ï¼ŒåŒæ ·å¯èƒ½å­˜åœ¨æ’å…¥ï¼Œæ›´æ–°å’Œåˆ é™¤æ•°æ®çš„å¼‚å¸¸æƒ…å†µã€‚</p><p><strong>4. é—®é¢˜è§£å†³</strong></p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®è®¤é€ æˆå¼‚å¸¸çš„åŸå› ï¼šä¸»å±æ€§ä»“åº“åå¯¹äºå€™é€‰é”®ï¼ˆç®¡ç†å‘˜ï¼Œç‰©å“åï¼‰æ˜¯éƒ¨åˆ†ä¾èµ–çš„å…³ç³»ï¼Œ è¿™æ ·å°±æœ‰å¯èƒ½å¯¼è‡´ä¸Šé¢çš„å¼‚å¸¸æƒ…å†µã€‚å› æ­¤å¼•å…¥BCNFï¼Œ<span class='p red'>å®ƒåœ¨ 3NF çš„åŸºç¡€ä¸Šæ¶ˆé™¤äº†ä¸»å±æ€§å¯¹å€™é€‰é”®çš„éƒ¨åˆ†ä¾èµ–æˆ–è€…ä¼ é€’ä¾èµ–å…³ç³»ã€‚</span></p><ul><li>å¦‚æœåœ¨å…³ç³»Rä¸­ï¼ŒUä¸ºä¸»é”®ï¼ŒAå±æ€§æ˜¯ä¸»é”®çš„ä¸€ä¸ªå±æ€§ï¼Œè‹¥å­˜åœ¨A-&gt;Yï¼ŒYä¸ºä¸»å±æ€§ï¼Œåˆ™è¯¥å…³ç³»ä¸å±äº BCNFã€‚</li></ul><p>æ ¹æ® BCNF çš„è¦æ±‚ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»“åº“ç®¡ç†å…³ç³» warehouse_keeper è¡¨æ‹†åˆ†æˆä¸‹é¢è¿™æ ·ï¼š</p><p><code>ä»“åº“è¡¨</code>ï¼šï¼ˆä»“åº“åï¼Œç®¡ç†å‘˜ï¼‰</p><p><code>åº“å­˜è¡¨</code>ï¼šï¼ˆä»“åº“åï¼Œç‰©å“åï¼Œæ•°é‡ï¼‰</p><p>è¿™æ ·å°±ä¸å­˜åœ¨ä¸»å±æ€§å¯¹äºå€™é€‰é”®çš„éƒ¨åˆ†ä¾èµ–æˆ–ä¼ é€’ä¾èµ–ï¼Œä¸Šé¢æ•°æ®è¡¨çš„è®¾è®¡å°±ç¬¦åˆ BCNFã€‚</p><p>å†ä¸¾ä¾‹ï¼š</p><p>æœ‰ä¸€ä¸ª<code>å­¦ç”Ÿå¯¼å¸ˆè¡¨</code>ï¼Œå…¶ä¸­åŒ…å«å­—æ®µï¼šå­¦ç”ŸIDï¼Œä¸“ä¸šï¼Œå¯¼å¸ˆï¼Œä¸“ä¸šGPAï¼Œè¿™å…¶ä¸­å­¦ç”ŸIDå’Œä¸“ä¸šæ˜¯è”åˆä¸»é”®ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707132038425.png" alt="image-20220707132038425"></p><p>è¿™ä¸ªè¡¨çš„è®¾è®¡æ»¡è¶³ä¸‰èŒƒå¼ï¼Œä½†æ˜¯è¿™é‡Œå­˜åœ¨å¦ä¸€ä¸ªä¾èµ–å…³ç³»ï¼Œâ€œä¸“ä¸šâ€ä¾èµ–äºâ€œå¯¼å¸ˆâ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªå¯¼å¸ˆåªåšä¸€ä¸ªä¸“ä¸šæ–¹é¢çš„å¯¼å¸ˆï¼Œåªè¦çŸ¥é“äº†æ˜¯å“ªä¸ªå¯¼å¸ˆï¼Œæˆ‘ä»¬è‡ªç„¶å°±çŸ¥é“æ˜¯å“ªä¸ªä¸“ä¸šçš„äº†ã€‚</p><p>æ‰€ä»¥è¿™ä¸ªè¡¨çš„éƒ¨åˆ†ä¸»é”®Majorä¾èµ–äºéä¸»é”®å±æ€§Advisorï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œä»¥ä¸‹çš„è°ƒæ•´ï¼Œæ‹†åˆ†æˆ2ä¸ªè¡¨ï¼š</p><p>å­¦ç”Ÿå¯¼å¸ˆè¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707132344634.png" alt="image-20220707132344634"></p><p>å¯¼å¸ˆè¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707132355841.png" alt="image-20220707132355841"></p><h2 id="4-ç¬¬å››èŒƒå¼">4. ç¬¬å››èŒƒå¼</h2><p>å¤šå€¼ä¾èµ–çš„æ¦‚å¿µï¼š</p><p>*<code>å¤šå€¼ä¾èµ–</code>å³å±æ€§ä¹‹é—´çš„ä¸€å¯¹å¤šå…³ç³»ï¼Œè®°ä¸ºKâ€”&gt;â€”&gt;Aã€‚<br>*<code>å‡½æ•°ä¾èµ–</code>äº‹å®ä¸Šæ˜¯å•å€¼ä¾èµ–ï¼Œæ‰€ä»¥ä¸èƒ½è¡¨è¾¾å±æ€§å€¼ä¹‹é—´çš„ä¸€å¯¹å¤šå…³ç³»ã€‚<br>*<code>å¹³å‡¡çš„å¤šå€¼ä¾èµ–</code>ï¼šå…¨é›†U=K+Aï¼Œä¸€ä¸ªKå¯ä»¥å¯¹åº”äºå¤šä¸ªAï¼Œå³Kâ€”&gt;â€”&gt;Aã€‚æ­¤æ—¶æ•´ä¸ªè¡¨å°±æ˜¯ä¸€ç»„ä¸€å¯¹å¤šå…³ç³»ã€‚<br>*<code>éå¹³å‡¡çš„å¤šå€¼ä¾èµ–</code>ï¼šå…¨é›†U=K+A+Bï¼Œä¸€ä¸ªKå¯ä»¥å¯¹åº”äºå¤šä¸ªAï¼Œä¹Ÿå¯ä»¥å¯¹åº”äºå¤šä¸ªBï¼ŒAä¸Bç›¸äº’ç‹¬ç«‹ï¼Œå³Kâ€”&gt;â€”&gt;Aï¼ŒKâ€”&gt;â€”&gt;Bã€‚æ•´ä¸ªè¡¨æœ‰å¤šç»„ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸”æœ‰ï¼š&quot;ä¸€&quot;éƒ¨åˆ†æ˜¯ç›¸åŒçš„å±æ€§é›†åˆï¼Œâ€œå¤šâ€éƒ¨åˆ†æ˜¯ç›¸äº’ç‹¬ç«‹çš„å±æ€§é›†åˆã€‚</p><p>ç¬¬å››èŒƒå¼å³åœ¨æ»¡è¶³å·´æ–¯ - ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰çš„åŸºç¡€ä¸Šï¼Œæ¶ˆé™¤éå¹³å‡¡ä¸”éå‡½æ•°ä¾èµ–çš„å¤šå€¼ä¾èµ–ï¼ˆå³æŠŠåŒä¸€è¡¨çš„å¤šå¯¹å¤šå…³ç³»åˆ é™¤ï¼‰ã€‚</p><p>**ä¸¾ä¾‹1ï¼š**èŒå·¥è¡¨(èŒå·¥ç¼–å·ï¼ŒèŒå·¥å­©å­å§“åï¼ŒèŒå·¥é€‰ä¿®è¯¾ç¨‹)ã€‚</p><p>åœ¨è¿™ä¸ªè¡¨ä¸­ï¼ŒåŒä¸€ä¸ªèŒå·¥å¯èƒ½ä¼šæœ‰å¤šä¸ªèŒå·¥å­©å­å§“åã€‚åŒæ ·ï¼ŒåŒä¸€ä¸ªèŒå·¥ä¹Ÿå¯èƒ½ä¼šæœ‰å¤šä¸ªèŒå·¥é€‰ä¿®è¯¾ç¨‹ï¼Œå³è¿™é‡Œå­˜åœ¨ç€å¤šå€¼äº‹å®ï¼Œä¸ç¬¦åˆç¬¬å››èŒƒå¼ã€‚</p><p>å¦‚æœè¦ç¬¦åˆç¬¬å››èŒƒå¼ï¼Œåªéœ€è¦å°†ä¸Šè¡¨åˆ†ä¸ºä¸¤ä¸ªè¡¨ï¼Œä½¿å®ƒä»¬åªæœ‰ä¸€ä¸ªå¤šå€¼äº‹å®ï¼Œä¾‹å¦‚ï¼š<code>èŒå·¥è¡¨ä¸€</code>(èŒå·¥ç¼– å·ï¼ŒèŒå·¥å­©å­å§“å)ï¼Œ<code>èŒå·¥è¡¨äºŒ</code>(èŒå·¥ç¼–å·ï¼ŒèŒå·¥é€‰ä¿®è¯¾ç¨‹)ï¼Œä¸¤ä¸ªè¡¨éƒ½åªæœ‰ä¸€ä¸ªå¤šå€¼äº‹å®ï¼Œæ‰€ä»¥ç¬¦åˆç¬¬å››èŒƒå¼ã€‚</p><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p>æ¯”å¦‚æˆ‘ä»¬å»ºç«‹è¯¾ç¨‹ã€æ•™å¸ˆã€æ•™æçš„æ¨¡å‹ã€‚æˆ‘ä»¬è§„å®šï¼Œæ¯é—¨è¯¾ç¨‹æœ‰å¯¹åº”çš„ä¸€ç»„æ•™å¸ˆï¼Œæ¯é—¨è¯¾ç¨‹ä¹Ÿæœ‰å¯¹åº”çš„ä¸€ç»„æ•™æï¼Œä¸€é—¨è¯¾ç¨‹ä½¿ç”¨çš„æ•™æå’Œæ•™å¸ˆæ²¡æœ‰å…³ç³»ã€‚æˆ‘ä»¬å»ºç«‹çš„å…³ç³»è¡¨å¦‚ä¸‹ï¼š</p><p>è¯¾ç¨‹IDï¼Œæ•™å¸ˆIDï¼Œæ•™æIDï¼›è¿™ä¸‰åˆ—ä½œä¸ºè”åˆä¸»é”®ã€‚</p><p>ä¸ºäº†è¡¨è¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç”¨Nameä»£æ›¿IDï¼Œè¿™æ ·æ›´å®¹æ˜“çœ‹æ‡‚ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707133830721.png" alt="image-20220707133830721"></p><p>è¿™ä¸ªè¡¨é™¤äº†ä¸»é”®ï¼Œå°±æ²¡æœ‰å…¶ä»–å­—æ®µäº†ï¼Œæ‰€ä»¥è‚¯å®šæ»¡è¶³BCèŒƒå¼ï¼Œä½†æ˜¯å´å­˜åœ¨<code>å¤šå€¼ä¾èµ–</code>å¯¼è‡´çš„å¼‚å¸¸ã€‚</p><p>å‡å¦‚æˆ‘ä»¬ä¸‹å­¦æœŸæƒ³é‡‡ç”¨ä¸€æœ¬æ–°çš„è‹±ç‰ˆé«˜æ•°æ•™æï¼Œä½†æ˜¯è¿˜æ²¡ç¡®å®šå…·ä½“å“ªä¸ªè€å¸ˆæ¥æ•™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•åœ¨è¿™ ä¸ªè¡¨ä¸­ç»´æŠ¤Courseé«˜æ•°å’ŒBookè‹±ç‰ˆé«˜æ•°æ•™æçš„çš„å…³ç³»ã€‚</p><p>è§£å†³åŠæ³•æ˜¯æˆ‘ä»¬æŠŠè¿™ä¸ªå¤šå€¼ä¾èµ–çš„è¡¨æ‹†è§£æˆ2ä¸ªè¡¨ï¼Œåˆ†åˆ«å»ºç«‹å…³ç³»ã€‚è¿™æ˜¯æˆ‘ä»¬æ‹†åˆ†åçš„è¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707134028730.png" alt="image-20220707134028730"></p><p>ä»¥åŠ</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707134220820.png" alt="image-20220707134220820"></p><h2 id="5-ç¬¬äº”èŒƒå¼ã€åŸŸé”®èŒƒå¼">5. ç¬¬äº”èŒƒå¼ã€åŸŸé”®èŒƒå¼</h2><p>é™¤äº†ç¬¬å››èŒƒå¼å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰æ›´é«˜çº§çš„ç¬¬äº”èŒƒå¼ï¼ˆåˆç§°å®Œç¾èŒƒå¼ï¼‰å’ŒåŸŸé”®èŒƒå¼ï¼ˆDKNFï¼‰ã€‚</p><p>åœ¨æ»¡è¶³ç¬¬å››èŒƒå¼ï¼ˆ4NFï¼‰çš„åŸºç¡€ä¸Šï¼Œæ¶ˆé™¤ä¸æ˜¯ç”±å€™é€‰é”®æ‰€è•´å«çš„è¿æ¥ä¾èµ–ã€‚<strong>å¦‚æœå…³ç³»æ¨¡å¼Rä¸­çš„æ¯ä¸€ä¸ªè¿ æ¥ä¾èµ–å‡ç”±Rçš„å€™é€‰é”®æ‰€éšå«</strong>ï¼Œåˆ™ç§°æ­¤å…³ç³»æ¨¡å¼ç¬¦åˆç¬¬äº”èŒƒå¼ã€‚</p><p>å‡½æ•°ä¾èµ–æ˜¯å¤šå€¼ä¾èµ–çš„ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µï¼Œè€Œå¤šå€¼ä¾èµ–å®é™…ä¸Šæ˜¯è¿æ¥ä¾èµ–çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚ä½†è¿æ¥ä¾èµ–ä¸ åƒå‡½æ•°ä¾èµ–å’Œå¤šå€¼ä¾èµ–å¯ä»¥ç”±<code>è¯­ä¹‰ç›´æ¥å¯¼å‡º</code>ï¼Œè€Œæ˜¯åœ¨<code>å…³ç³»è¿æ¥è¿ç®—</code>æ—¶æ‰åæ˜ å‡ºæ¥ã€‚å­˜åœ¨è¿æ¥ä¾èµ–çš„å…³ç³» æ¨¡å¼ä»å¯èƒ½é‡åˆ°æ•°æ®å†—ä½™åŠæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤å¼‚å¸¸ç­‰é—®é¢˜ã€‚</p><p>ç¬¬äº”èŒƒå¼å¤„ç†çš„æ˜¯<code>æ— æŸè¿æ¥é—®é¢˜</code>ï¼Œè¿™ä¸ªèŒƒå¼åŸºæœ¬<code>æ²¡æœ‰å®é™…æ„ä¹‰</code>ï¼Œå› ä¸ºæ— æŸè¿æ¥å¾ˆå°‘å‡ºç°ï¼Œè€Œä¸”éš¾ä»¥å¯Ÿè§‰ã€‚è€ŒåŸŸé”®èŒƒå¼è¯•å›¾å®šä¹‰ä¸€ä¸ª<code>ç»ˆæèŒƒå¼</code>ï¼Œè¯¥èŒƒå¼è€ƒè™‘æ‰€æœ‰çš„ä¾èµ–å’Œçº¦æŸç±»å‹ï¼Œä½†æ˜¯å®ç”¨ä»·å€¼ä¹Ÿæ˜¯æœ€å°çš„ï¼Œåªå­˜åœ¨ç†è®ºç ”ç©¶ä¸­ã€‚</p><h2 id="6-å®æˆ˜æ¡ˆä¾‹">6. å®æˆ˜æ¡ˆä¾‹</h2><p>å•†è¶…è¿›è´§ç³»ç»Ÿä¸­çš„<code>è¿›è´§å•è¡¨</code>è¿›è¡Œå‰–æï¼š</p><p>è¿›è´§å•è¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707134636225.png" alt="image-20220707134636225"></p><p>è¿™ä¸ªè¡¨ä¸­çš„å­—æ®µå¾ˆå¤šï¼Œè¡¨é‡Œçš„æ•°æ®é‡ä¹Ÿå¾ˆæƒŠäººã€‚å¤§é‡é‡å¤å¯¼è‡´è¡¨å˜å¾—åºå¤§ï¼Œæ•ˆç‡æä½ã€‚å¦‚ä½•æ”¹é€ ï¼Ÿ</p><blockquote><p>åœ¨å®é™…å·¥ä½œåœºæ™¯ä¸­ï¼Œè¿™ç§ç”±äºæ•°æ®è¡¨ç»“æ„è®¾è®¡ä¸åˆç†ï¼Œè€Œå¯¼è‡´çš„æ•°æ®é‡å¤çš„ç°è±¡å¹¶ä¸å°‘è§ã€‚å¾€å¾€æ˜¯ç³»ç»Ÿè™½ç„¶èƒ½å¤Ÿè¿è¡Œï¼Œæ‰¿è½½èƒ½åŠ›å´å¾ˆå·®ï¼Œç¨å¾®æœ‰ç‚¹æµé‡ï¼Œå°±ä¼šå‡ºç°å†…å­˜ä¸è¶³ã€CPUä½¿ç”¨ç‡é£™å‡çš„æƒ…å†µï¼Œç”šè‡³ä¼šå¯¼è‡´æ•´ä¸ªé¡¹ç›®å¤±è´¥ã€‚</p></blockquote><h3 id="6-1-è¿­ä»£1æ¬¡ï¼šè€ƒè™‘1NF">6.1 è¿­ä»£1æ¬¡ï¼šè€ƒè™‘1NF</h3><p>ç¬¬ä¸€èŒƒå¼è¦æ±‚ï¼š<span class='p red'>æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¸å¯è¿›è¡Œæ‹†åˆ†ã€‚</span>è¿™é‡Œéœ€è¦ç¡®è®¤ï¼Œæ‰€æœ‰çš„åˆ—ä¸­ï¼Œæ¯ä¸ªå­—æ®µåªåŒ…å«ä¸€ç§æ•°æ®ã€‚</p><p>è¿™å¼ è¡¨é‡Œï¼Œæˆ‘ä»¬æŠŠâ€œproperty&quot;è¿™ä¸€å­—æ®µï¼Œæ‹†åˆ†æˆâ€specification (è§„æ ¼)&quot; å’Œ â€œunit (å•ä½)â€ï¼Œè¿™ä¸¤ä¸ªå­—æ®µå¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707154400580.png" alt="image-20220707154400580"></p><h3 id="6-2-è¿­ä»£2æ¬¡ï¼šè€ƒè™‘2NF">6.2 è¿­ä»£2æ¬¡ï¼šè€ƒè™‘2NF</h3><p>ç¬¬äºŒèŒƒå¼è¦æ±‚ï¼Œåœ¨æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œ<span class='p red'>è¿˜è¦æ»¡è¶³æ•°æ®è¡¨é‡Œçš„æ¯ä¸€æ¡æ•°æ®è®°å½•ï¼Œéƒ½æ˜¯å¯å”¯ä¸€æ ‡è¯†çš„ã€‚è€Œä¸”æ‰€æœ‰å­—æ®µï¼Œéƒ½å¿…é¡»å®Œå…¨ä¾èµ–ä¸»é”®ï¼Œä¸èƒ½åªä¾èµ–ä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚</span></p><p>ç¬¬1æ­¥ï¼Œå°±æ˜¯è¦ç¡®å®šè¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚é€šè¿‡è§‚å¯Ÿå‘ç°ï¼Œå­—æ®µâ€œlistnumberï¼ˆå•å·ï¼‰&quot;+&quot;barcodeï¼ˆæ¡ç ï¼‰&quot;å¯ä»¥å”¯ä¸€æ ‡è¯†æ¯ä¸€æ¡è®°å½•ï¼Œå¯ä»¥ä½œä¸ºä¸»é”®ã€‚</p><p>ç¬¬2æ­¥ï¼Œç¡®å®šå¥½äº†ä¸»é”®ä»¥åï¼Œåˆ¤æ–­å“ªäº›å­—æ®µå®Œå…¨ä¾èµ–ä¸»é”®ï¼Œå“ªäº›å­—æ®µåªä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚æŠŠåªä¾èµ–äºä¸»é”®ä¸€éƒ¨åˆ†çš„å­—æ®µæ‹†å‡ºå»ï¼Œå½¢æˆæ–°çš„æ•°æ®è¡¨ã€‚</p><p>é¦–å…ˆï¼Œè¿›è´§å•æ˜ç»†è¡¨é‡Œé¢çš„&quot;goodsname(åç§°)â€œâ€œspecification(è§„æ ¼)â€â€œunit(å•ä½)â€œè¿™äº›ä¿¡æ¯æ˜¯å•†å“çš„å±æ€§ï¼Œåªä¾èµ–äº&quot;batcode(æ¡ç )â€ï¼Œä¸å®Œå…¨ä¾èµ–ä¸»é”®ï¼Œå¯ä»¥æ‹†åˆ†å‡ºå»ã€‚æˆ‘ä»¬æŠŠè¿™3ä¸ªå­—æ®µåŠ ä¸Šå®ƒä»¬æ‰€ä¾èµ–çš„å­—æ®µ&quot;barcode(æ¡ç )â€ï¼Œæ‹†åˆ†å½¢æˆæ–°çš„æ•°æ®è¡¨&quot;å•†å“ä¿¡æ¯è¡¨â€ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼ŒåŸæ¥çš„æ•°æ®è¡¨å°±è¢«æ‹†åˆ†æˆäº†ä¸¤ä¸ªè¡¨ã€‚</p><p>å•†å“ä¿¡æ¯è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707163807205.png" alt="image-20220707163807205"  /><p>è¿›è´§å•è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707163828614.png" alt="image-20220707163828614"  /><p>æ­¤å¤–ï¼Œå­—æ®µ&quot;supplierid(ä¾›åº”å•†ç¼–å·)â€œâ€œsuppliername(ä¾›åº”å•†åç§°)â€â€œstock(ä»“åº“)â€œåªä¾èµ–äº&quot;listnumber(å•å·)â€ï¼Œä¸å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ&quot;supplieridâ€â€œsuppliernameâ€â€œstock&quot;è¿™3ä¸ªå­—æ®µæ‹†å‡ºå»ï¼Œå†åŠ ä¸Šå®ƒä»¬ä¾èµ–çš„å­—æ®µ&quot;listnumber(å•å·)â€ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªæ–°çš„è¡¨&quot;è¿›è´§å•å¤´è¡¨&quot;ã€‚å‰©ä¸‹çš„å­—æ®µï¼Œä¼šç»„æˆæ–°çš„è¡¨ï¼Œæˆ‘ä»¬å«å®ƒ&quot;è¿›è´§å•æ˜ç»†è¡¨&quot;ã€‚</p><p>åŸæ¥çš„æ•°æ®è¡¨å°±æ‹†åˆ†æˆäº†3ä¸ªè¡¨ã€‚</p><p>è¿›è´§å•å¤´è¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707164128704.png" alt="image-20220707164128704"></p><p>è¿›è´§å•æ˜ç»†è¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707164146216.png" alt="image-20220707164146216"></p><p>å•†å“ä¿¡æ¯è¡¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707164227845.png" alt="image-20220707164227845"></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹æ‹†åˆ†åçš„3ä¸ªè¡¨ï¼Œä¿è¯è¿™3ä¸ªè¡¨éƒ½æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„è¦æ±‚ã€‚</p><p>ç¬¬3æ­¥ï¼Œåœ¨â€œå•†å“ä¿¡æ¯è¡¨â€ä¸­ï¼Œå­—æ®µâ€œbarcode&quot;æ˜¯æœ‰<code>å¯èƒ½å­˜åœ¨é‡å¤</code>çš„ï¼Œæ¯”å¦‚ï¼Œç”¨æˆ·é—¨åº—å¯èƒ½æœ‰æ•£è£…ç§°é‡å•†å“å’Œè‡ªäº§å•†å“ï¼Œä¼šå­˜åœ¨æ¡ç å…±ç”¨çš„æƒ…å†µã€‚æ‰€ä»¥ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½ä¸èƒ½å”¯ä¸€æ ‡è¯†è¡¨é‡Œçš„è®°å½•ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»ç»™è¿™ä¸ªè¡¨åŠ ä¸Šä¸€ä¸ªä¸»é”®ï¼Œæ¯”å¦‚è¯´æ˜¯<code>è‡ªå¢å­—æ®µ&quot;itemnumber&quot;</code>ã€‚</p><h3 id="6-3-è¿­ä»£3æ¬¡ï¼šè€ƒè™‘3NF">6.3 è¿­ä»£3æ¬¡ï¼šè€ƒè™‘3NF</h3><p>æˆ‘ä»¬çš„è¿›è´§å•å¤´è¡¨ï¼Œè¿˜æœ‰æ•°æ®å†—ä½™çš„å¯èƒ½ã€‚å› ä¸º&quot;suppliername&quot;ä¾èµ–&quot;supplierid&quot;ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‰ç…§ç¬¬ä¸‰èŒƒå¼çš„åŸåˆ™è¿›è¡Œæ‹†åˆ†äº†ã€‚æˆ‘ä»¬å°±è¿›ä¸€æ­¥æ‹†åˆ†è¿›è´§å•å¤´è¡¨ï¼ŒæŠŠå®ƒæ‹†è§£é™ˆä¾›è´§å•†è¡¨å’Œè¿›è´§å•å¤´è¡¨ã€‚</p><p>ä¾›è´§å•†è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707165011050.png" alt="image-20220707165011050"  /><p>è¿›è´§å•å¤´è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707165038108.png" alt="image-20220707165038108"  /><p>è¿™2ä¸ªè¡¨éƒ½æ»¡è¶³ç¬¬ä¸‰èŒƒå¼çš„è¦æ±‚äº†ã€‚</p><h3 id="6-4-åèŒƒå¼åŒ–ï¼šä¸šåŠ¡ä¼˜å…ˆçš„åŸåˆ™">6.4 åèŒƒå¼åŒ–ï¼šä¸šåŠ¡ä¼˜å…ˆçš„åŸåˆ™</h3><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707165459547.png" alt="image-20220707165459547" style="zoom:80%;float:right" /><p>å› æ­¤ï¼Œæœ€åæˆ‘ä»¬å¯ä»¥æŠŠè¿›è´§å•è¡¨æ‹†åˆ†æˆä¸‹é¢çš„4ä¸ªè¡¨ï¼š</p><p>ä¾›è´§å•†è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707165011050.png" alt="image-20220707165011050"  /><p>è¿›è´§å•å¤´è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707165038108.png" alt="image-20220707165038108"  /><p>è¿›è´§å•æ˜ç»†è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707164146216.png" alt="image-20220707164146216" style="zoom:80%;" /><p>å•†å“ä¿¡æ¯è¡¨ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707164227845.png" alt="image-20220707164227845" style="zoom:80%;" /><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±é¿å…äº†å†—ä½™æ•°æ®ï¼Œè€Œä¸”è¿˜èƒ½å¤Ÿæ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œè¿™æ ·çš„æ•°æ®åº“è®¾è®¡ï¼Œæ‰æ˜¯åˆæ ¼çš„è®¾è®¡ã€‚</p><hr><h2 id="7-ERæ¨¡å‹">7. ERæ¨¡å‹</h2><p>æ•°æ®åº“è®¾è®¡æ˜¯ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„ã€‚é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•æå‰çœ‹åˆ°æ•°æ®åº“çš„å…¨è²Œå‘¢ï¼Ÿæ¯”å¦‚éœ€è¦å“ªäº›æ•°æ®è¡¨ã€æ•°æ®è¡¨ä¸­åº”è¯¥æœ‰å“ªäº›å­—æ®µï¼Œæ•°æ®è¡¨ä¸æ•°æ®è¡¨ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ã€é€šè¿‡ä»€ä¹ˆå­—æ®µè¿›è¡Œè¿æ¥ï¼Œç­‰ç­‰ã€‚è¿™æ ·æˆ‘ä»¬æ‰èƒ½è¿›è¡Œæ•´ä½“çš„æ¢³ç†å’Œè®¾è®¡ã€‚</p><p>å…¶å®ï¼ŒER æ¨¡å‹å°±æ˜¯ä¸€ä¸ªè¿™æ ·çš„å·¥å…·ã€‚ERæ¨¡å‹ä¹Ÿå«ä½œ<code>å®ä½“å…³ç³»æ¨¡å‹</code>ï¼Œæ˜¯ç”¨æ¥æè¿°ç°å®ç”Ÿæ´»ä¸­å®¢è§‚å­˜åœ¨çš„äº‹ç‰©ã€äº‹ç‰©çš„å±æ€§ï¼Œä»¥åŠäº‹ç‰©ä¹‹é—´å…³ç³»çš„ä¸€ç§æ•°æ®æ¨¡å‹ã€‚<span class='p red'>åœ¨å¼€å‘åŸºäºæ•°æ®åº“çš„ä¿¡æ¯ç³»ç»Ÿçš„è®¾è®¡é˜¶æ®µï¼Œé€šå¸¸ä½¿ç”¨ ER æ¨¡å‹æ¥æè¿°ä¿¡æ¯éœ€æ±‚å’Œä¿¡æ¯ç‰¹æ€§ï¼Œå¸®åŠ©æˆ‘ä»¬ç†æ¸…ä¸šåŠ¡é€»è¾‘ï¼Œä»è€Œè®¾è®¡å‡ºä¼˜ç§€çš„æ•°æ®åº“ã€‚</span></p><span class='p green'>ER æ¨¡å‹ä¸­æœ‰ä¸‰ä¸ªè¦ç´ ï¼Œåˆ†åˆ«æ˜¯å®ä½“ã€å±æ€§å’Œå…³ç³»ã€‚</span><p><code>å®ä½“</code>ï¼Œå¯ä»¥çœ‹åšæ˜¯æ•°æ®å¯¹è±¡ï¼Œå¾€å¾€å¯¹åº”äºç°å®ç”Ÿæ´»ä¸­çš„çœŸå®å­˜åœ¨çš„ä¸ªä½“ã€‚åœ¨ ER æ¨¡å‹ä¸­ï¼Œç”¨ çŸ©å½¢ æ¥è¡¨ ç¤ºã€‚å®ä½“åˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯ å¼ºå®ä½“ å’Œ å¼±å®ä½“ ã€‚å¼ºå®ä½“æ˜¯æŒ‡ä¸ä¾èµ–äºå…¶ä»–å®ä½“çš„å®ä½“ï¼›å¼±å®ä½“æ˜¯æŒ‡å¯¹å¦ ä¸€ä¸ªå®ä½“æœ‰å¾ˆå¼ºçš„ä¾èµ–å…³ç³»çš„å®ä½“ã€‚</p><p><code>å±æ€§</code>ï¼Œåˆ™æ˜¯æŒ‡å®ä½“çš„ç‰¹æ€§ã€‚æ¯”å¦‚è¶…å¸‚çš„åœ°å€ã€è”ç³»ç”µè¯ã€å‘˜å·¥æ•°ç­‰ã€‚åœ¨ ER æ¨¡å‹ä¸­ç”¨ æ¤­åœ†å½¢ æ¥è¡¨ç¤ºã€‚</p><p><code>å…³ç³»</code>ï¼Œåˆ™æ˜¯æŒ‡å®ä½“ä¹‹é—´çš„è”ç³»ã€‚æ¯”å¦‚è¶…å¸‚æŠŠå•†å“å–ç»™é¡¾å®¢ï¼Œå°±æ˜¯ä¸€ç§è¶…å¸‚ä¸é¡¾å®¢ä¹‹é—´çš„è”ç³»ã€‚åœ¨ ER æ¨¡ å‹ä¸­ç”¨ è±å½¢ æ¥è¡¨ç¤ºã€‚</p><p>æ³¨æ„ï¼šå®ä½“å’Œå±æ€§ä¸å®¹æ˜“åŒºåˆ†ã€‚è¿™é‡Œæä¾›ä¸€ä¸ªåŸåˆ™ï¼šæˆ‘ä»¬è¦ä»ç³»ç»Ÿæ•´ä½“çš„è§’åº¦å‡ºå‘å»çœ‹ï¼Œ<strong>å¯ä»¥ç‹¬ç«‹å­˜åœ¨çš„æ˜¯å®ä½“ï¼Œä¸å¯å†åˆ†çš„æ˜¯å±æ€§</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå±æ€§ä¸èƒ½åŒ…å«å…¶ä»–å±æ€§ã€‚</p><span class='p blue'>åœ¨ ER æ¨¡å‹çš„ 3 ä¸ªè¦ç´ ä¸­ï¼Œå…³ç³»åˆå¯ä»¥åˆ†ä¸º 3 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€‚</span><p><code>ä¸€å¯¹ä¸€</code>ï¼šæŒ‡å®ä½“ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ¯”å¦‚ä¸ªäººä¸èº«ä»½è¯ä¿¡æ¯ä¹‹é—´çš„å…³ç³»å°±æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ä¸€ä¸ªäººåªèƒ½æœ‰ä¸€ä¸ªèº«ä»½è¯ä¿¡æ¯ï¼Œä¸€ä¸ªèº«ä»½è¯ä¿¡æ¯ä¹Ÿåªå±äºä¸€ä¸ªäººã€‚</p><p><code>ä¸€å¯¹å¤š</code>ï¼šæŒ‡ä¸€è¾¹çš„å®ä½“é€šè¿‡å…³ç³»ï¼Œå¯ä»¥å¯¹åº”å¤šä¸ªå¦å¤–ä¸€è¾¹çš„å®ä½“ã€‚ç›¸åï¼Œå¦å¤–ä¸€è¾¹çš„å®ä½“é€šè¿‡è¿™ä¸ªå…³ç³»ï¼Œåˆ™åªèƒ½å¯¹åº”å”¯ä¸€çš„ä¸€è¾¹çš„å®ä½“ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªç­çº§è¡¨ï¼Œè€Œæ¯ä¸ªç­çº§éƒ½æœ‰å¤šä¸ªå­¦ç”Ÿï¼Œæ¯ä¸ªå­¦ ç”Ÿåˆ™å¯¹åº”ä¸€ä¸ªç­çº§ï¼Œç­çº§å¯¹å­¦ç”Ÿå°±æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚</p><p><code>å¤šå¯¹å¤š</code>ï¼šæŒ‡å…³ç³»ä¸¤è¾¹çš„å®ä½“éƒ½å¯ä»¥é€šè¿‡å…³ç³»å¯¹åº”å¤šä¸ªå¯¹æ–¹çš„å®ä½“ã€‚æ¯”å¦‚åœ¨è¿›è´§æ¨¡å—ä¸­ï¼Œä¾›è´§å•†ä¸è¶…å¸‚ä¹‹ é—´çš„å…³ç³»å°±æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œä¸€ä¸ªä¾›è´§å•†å¯ä»¥ç»™å¤šä¸ªè¶…å¸‚ä¾›è´§ï¼Œä¸€ä¸ªè¶…å¸‚ä¹Ÿå¯ä»¥ä»å¤šä¸ªä¾›è´§å•†é‚£é‡Œé‡‡è´­ å•†å“ã€‚å†æ¯”å¦‚ä¸€ä¸ªé€‰è¯¾è¡¨ï¼Œæœ‰è®¸å¤šç§‘ç›®ï¼Œæ¯ä¸ªç§‘ç›®æœ‰å¾ˆå¤šå­¦ç”Ÿé€‰ï¼Œè€Œæ¯ä¸ªå­¦ç”Ÿåˆå¯ä»¥é€‰æ‹©å¤šä¸ªç§‘ç›®ï¼Œè¿™ å°±æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚</p><h3 id="7-1-å»ºæ¨¡åˆ†æ">7.1 å»ºæ¨¡åˆ†æ</h3><p>ER æ¨¡å‹çœ‹èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬æŠŠæ§é¡¹ç›®æ•´ä½“éå¸¸é‡è¦ã€‚å¦‚æœä½ åªæ˜¯å¼€å‘ä¸€ä¸ªå°åº”ç”¨ï¼Œæˆ–è®¸ç®€å•è®¾ è®¡å‡ ä¸ªè¡¨å¤Ÿç”¨äº†ï¼Œä¸€æ—¦è¦è®¾è®¡æœ‰ä¸€å®šè§„æ¨¡çš„åº”ç”¨ï¼Œåœ¨é¡¹ç›®çš„åˆå§‹é˜¶æ®µï¼Œå»ºç«‹å®Œæ•´çš„ ER æ¨¡å‹å°±éå¸¸å…³é”® äº†ã€‚å¼€å‘åº”ç”¨é¡¹ç›®çš„å®è´¨ï¼Œå…¶å®å°±æ˜¯ å»ºæ¨¡ ã€‚</p><p>æˆ‘ä»¬è®¾è®¡çš„æ¡ˆä¾‹æ˜¯ ç”µå•†ä¸šåŠ¡ ï¼Œç”±äºç”µå•†ä¸šåŠ¡å¤ªè¿‡åºå¤§ä¸”å¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åšäº†ä¸šåŠ¡ç®€åŒ–ï¼Œæ¯”å¦‚é’ˆå¯¹ SKUï¼ˆStockKeepingUnitï¼Œåº“å­˜é‡å•ä½ï¼‰å’ŒSPUï¼ˆStandard Product Unitï¼Œæ ‡å‡†åŒ–äº§å“å•å…ƒï¼‰çš„å«ä¹‰ä¸Šï¼Œæˆ‘ ä»¬ç›´æ¥ä½¿ç”¨äº†SKUï¼Œå¹¶æ²¡æœ‰æåŠSPUçš„æ¦‚å¿µã€‚æœ¬æ¬¡ç”µå•†ä¸šåŠ¡è®¾è®¡æ€»å…±æœ‰8ä¸ªå®ä½“ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><ul><li>åœ°å€å®ä½“</li><li>ç”¨æˆ·å®ä½“</li><li>è´­ç‰©è½¦å®ä½“</li><li>è¯„è®ºå®ä½“</li><li>å•†å“å®ä½“</li><li>å•†å“åˆ†ç±»å®ä½“</li><li>è®¢å•å®ä½“</li><li>è®¢å•è¯¦æƒ…å®ä½“</li></ul><p>å…¶ä¸­ï¼Œ ç”¨æˆ· å’Œ å•†å“åˆ†ç±» æ˜¯å¼ºå®ä½“ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦ä¾èµ–å…¶ä»–ä»»ä½•å®ä½“ã€‚è€Œå…¶ä»–å±äºå¼±å®ä½“ï¼Œå› ä¸ºå®ƒä»¬ è™½ç„¶éƒ½å¯ä»¥ç‹¬ç«‹å­˜åœ¨ï¼Œä½†æ˜¯å®ƒä»¬éƒ½ä¾èµ–ç”¨æˆ·è¿™ä¸ªå®ä½“ï¼Œå› æ­¤éƒ½æ˜¯å¼±å®ä½“ã€‚çŸ¥é“äº†è¿™äº›è¦ç´ ï¼Œæˆ‘ä»¬å°±å¯ä»¥ ç»™ç”µå•†ä¸šåŠ¡åˆ›å»º ER æ¨¡å‹äº†ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707170608782.png" alt="image-20220707170608782"></p><p>åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œåœ°å€å’Œç”¨æˆ·ä¹‹é—´çš„æ·»åŠ å…³ç³»ï¼Œæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè€Œå•†å“å’Œå•†å“è¯¦æƒ…ç¤ºä¸€å¯¹1çš„å…³ç³»ï¼Œå•†å“å’Œ è®¢å•æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ è¿™ä¸ª ER æ¨¡å‹ï¼ŒåŒ…æ‹¬äº† 8ä¸ªå®ä½“ä¹‹é—´çš„ 8ç§å…³ç³»ã€‚</p><p>ï¼ˆ1ï¼‰ç”¨æˆ·å¯ä»¥åœ¨ç”µå•†å¹³å°æ·»åŠ å¤šä¸ªåœ°å€ï¼›</p><p>ï¼ˆ2ï¼‰ç”¨æˆ·åªèƒ½æ‹¥æœ‰ä¸€ä¸ªè´­ç‰©è½¦ï¼›</p><p>ï¼ˆ3ï¼‰ç”¨æˆ·å¯ä»¥ç”Ÿæˆå¤šä¸ªè®¢å•ï¼›</p><p>ï¼ˆ4ï¼‰ç”¨æˆ·å¯ä»¥å‘è¡¨å¤šæ¡è¯„è®ºï¼›</p><p>ï¼ˆ5ï¼‰ä¸€ä»¶å•†å“å¯ä»¥æœ‰å¤šæ¡è¯„è®ºï¼›</p><p>ï¼ˆ6ï¼‰æ¯ä¸€ä¸ªå•†å“åˆ†ç±»åŒ…å«å¤šç§å•†å“ï¼›</p><p>ï¼ˆ7ï¼‰ä¸€ä¸ªè®¢å•å¯ä»¥åŒ…å«å¤šä¸ªå•†å“ï¼Œä¸€ä¸ªå•†å“å¯ä»¥åœ¨å¤šä¸ªè®¢å•é‡Œã€‚</p><p>ï¼ˆ8ï¼‰è®¢å•ä¸­åˆåŒ…å«å¤šä¸ªè®¢å•è¯¦æƒ…ï¼Œå› ä¸ºä¸€ä¸ªè®¢å•ä¸­å¯èƒ½åŒ…å«ä¸åŒç§ç±»çš„å•†å“</p><h3 id="7-2-ER-æ¨¡å‹çš„ç»†åŒ–">7.2 ER æ¨¡å‹çš„ç»†åŒ–</h3><p>æœ‰äº†è¿™ä¸ª ER æ¨¡å‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»æ•´ä½“ä¸Š ç†è§£ ç”µå•†çš„ä¸šåŠ¡äº†ã€‚åˆšåˆšçš„ ER æ¨¡å‹å±•ç¤ºäº†ç”µå•†ä¸šåŠ¡çš„æ¡†æ¶ï¼Œ ä½†æ˜¯åªåŒ…æ‹¬äº†è®¢å•ï¼Œåœ°å€ï¼Œç”¨æˆ·ï¼Œè´­ç‰©è½¦ï¼Œè¯„è®ºï¼Œå•†å“ï¼Œå•†å“åˆ†ç±»å’Œè®¢å•è¯¦æƒ…è¿™å…«ä¸ªå®ä½“ï¼Œä»¥åŠå®ƒä»¬ä¹‹ é—´çš„å…³ç³»ï¼Œè¿˜ä¸èƒ½å¯¹åº”åˆ°å…·ä½“çš„è¡¨ï¼Œä»¥åŠè¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”ã€‚æˆ‘ä»¬éœ€è¦æŠŠ å±æ€§åŠ ä¸Š ï¼Œç”¨ æ¤­åœ† æ¥è¡¨ç¤ºï¼Œ è¿™æ ·æˆ‘ä»¬å¾—åˆ°çš„ ER æ¨¡å‹å°±æ›´åŠ å®Œæ•´äº†ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥å»è®¾è®¡ä¸€ä¸‹è¿™ä¸ª ER æ¨¡å‹çš„å„ä¸ªå±€éƒ¨ï¼Œä¹Ÿå°±æ˜¯ç»†åŒ–ä¸‹ç”µå•†çš„å…·ä½“ä¸šåŠ¡æµç¨‹ï¼Œç„¶åæŠŠ å®ƒä»¬ç»¼åˆåˆ°ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„ ER æ¨¡å‹ã€‚è¿™æ ·å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†æ¸…æ•°æ®åº“çš„è®¾è®¡æ€è·¯ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†åˆ†æä¸€ä¸‹å„ä¸ªå®ä½“éƒ½æœ‰å“ªäº›å±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p>ï¼ˆ1ï¼‰<code>åœ°å€å®ä½“</code>åŒ…æ‹¬ç”¨æˆ·ç¼–å·ã€çœã€å¸‚ã€åœ°åŒºã€æ”¶ä»¶äººã€è”ç³»ç”µè¯ã€æ˜¯å¦æ˜¯é»˜è®¤åœ°å€ã€‚</p><p>ï¼ˆ2ï¼‰<code>ç”¨æˆ·å®ä½“</code>åŒ…æ‹¬ç”¨æˆ·ç¼–å·ã€ç”¨æˆ·åç§°ã€æ˜µç§°ã€ç”¨æˆ·å¯†ç ã€æ‰‹æœºå·ã€é‚®ç®±ã€å¤´åƒã€ç”¨æˆ·çº§åˆ«ã€‚</p><p>ï¼ˆ3ï¼‰<code>è´­ç‰©è½¦å®ä½“</code>åŒ…æ‹¬è´­ç‰©è½¦ç¼–å·ã€ç”¨æˆ·ç¼–å·ã€å•†å“ç¼–å·ã€å•†å“æ•°é‡ã€å›¾ç‰‡æ–‡ä»¶urlã€‚</p><p>ï¼ˆ4ï¼‰<code>è®¢å•å®ä½“</code>åŒ…æ‹¬è®¢å•ç¼–å·ã€æ”¶è´§äººã€æ”¶ä»¶äººç”µè¯ã€æ€»é‡‘é¢ã€ç”¨æˆ·ç¼–å·ã€ä»˜æ¬¾æ–¹å¼ã€é€è´§åœ°å€ã€ä¸‹å• æ—¶é—´ã€‚</p><p>ï¼ˆ5ï¼‰<code>è®¢å•è¯¦æƒ…å®ä½“</code>åŒ…æ‹¬è®¢å•è¯¦æƒ…ç¼–å·ã€è®¢å•ç¼–å·ã€å•†å“åç§°ã€å•†å“ç¼–å·ã€å•†å“æ•°é‡ã€‚</p><p>ï¼ˆ6ï¼‰<code>å•†å“å®ä½“</code>åŒ…æ‹¬å•†å“ç¼–å·ã€ä»·æ ¼ã€å•†å“åç§°ã€åˆ†ç±»ç¼–å·ã€æ˜¯å¦é”€å”®ï¼Œè§„æ ¼ã€é¢œè‰²ã€‚</p><p>ï¼ˆ7ï¼‰<code>è¯„è®ºå®ä½“</code>åŒ…æ‹¬è¯„è®ºidã€è¯„è®ºå†…å®¹ã€è¯„è®ºæ—¶é—´ã€ç”¨æˆ·ç¼–å·ã€å•†å“ç¼–å·</p><p>ï¼ˆ8ï¼‰<code>å•†å“åˆ†ç±»å®ä½“</code>åŒ…æ‹¬ç±»åˆ«ç¼–å·ã€ç±»åˆ«åç§°ã€çˆ¶ç±»åˆ«ç¼–å·</p><p>è¿™æ ·ç»†åˆ†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡æ–°è®¾è®¡ç”µå•†ä¸šåŠ¡äº†ï¼ŒER æ¨¡å‹å¦‚å›¾ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707171022246.png" alt="image-20220707171022246"></p><h3 id="7-3-ER-æ¨¡å‹å›¾è½¬æ¢æˆæ•°æ®è¡¨">7.3 ER æ¨¡å‹å›¾è½¬æ¢æˆæ•°æ®è¡¨</h3><p>é€šè¿‡ç»˜åˆ¶ ER æ¨¡å‹ï¼Œæˆ‘ä»¬å·²ç»ç†æ¸…äº†ä¸šåŠ¡é€»è¾‘ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å°±è¦è¿›è¡Œéå¸¸é‡è¦çš„ä¸€æ­¥äº†ï¼šæŠŠç»˜åˆ¶å¥½çš„ ER æ¨¡å‹ï¼Œè½¬æ¢æˆå…·ä½“çš„æ•°æ®è¡¨ï¼Œä¸‹é¢ä»‹ç»ä¸‹è½¬æ¢çš„åŸåˆ™ï¼š</p><p>ï¼ˆ1ï¼‰ä¸€ä¸ª å®ä½“é€šå¸¸è½¬æ¢æˆä¸€ä¸ªæ•°æ®è¡¨ ï¼›</p><p>ï¼ˆ2ï¼‰ä¸€ä¸ª å¤šå¯¹å¤šçš„å…³ç³» ï¼Œé€šå¸¸ä¹Ÿè½¬æ¢æˆä¸€ä¸ªæ•°æ®è¡¨ ï¼›</p><p>ï¼ˆ3ï¼‰ä¸€ä¸ª 1 å¯¹ 1 ï¼Œæˆ–è€… 1 å¯¹å¤š çš„å…³ç³»ï¼Œå¾€å¾€é€šè¿‡è¡¨çš„å¤–é”® æ¥è¡¨è¾¾ï¼Œè€Œä¸æ˜¯è®¾è®¡ä¸€ä¸ªæ–°çš„æ•°æ®è¡¨ï¼›</p><p>ï¼ˆ4ï¼‰å±æ€§è½¬æ¢æˆè¡¨çš„å­—æ®µ ã€‚</p><p>ä¸‹é¢ç»“åˆå‰é¢çš„ERæ¨¡å‹ï¼Œå…·ä½“è®²è§£ä¸€ä¸‹æ€ä¹ˆè¿ç”¨è¿™äº›è½¬æ¢çš„åŸåˆ™ï¼ŒæŠŠ ER æ¨¡å‹è½¬æ¢æˆå…·ä½“çš„æ•°æ®è¡¨ï¼Œä»è€ŒæŠŠæŠ½è±¡å‡ºæ¥çš„æ•°æ®æ¨¡å‹ï¼Œè½å®åˆ°å…·ä½“çš„æ•°æ®åº“è®¾è®¡å½“ä¸­ã€‚</p><div class="tabs" id="cf8e7d91-4e7d-43b9-8e90-47521cc91ee1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#cf8e7d91-4e7d-43b9-8e90-47521cc91ee1-1"><i class="fas fa-award"></i>ä¸€ä¸ªå®ä½“è½¬æ¢æˆä¸€ä¸ªæ•°æ®åº“</button></li><li class="tab"><button type="button" data-href="#cf8e7d91-4e7d-43b9-8e90-47521cc91ee1-2"><i class="fas fa-baseball-ball"></i>ä¸€ä¸ªå¤šå¯¹å¤šçš„å…³ç³»è½¬æ¢æˆä¸€ä¸ªæ•°æ®è¡¨</button></li><li class="tab"><button type="button" data-href="#cf8e7d91-4e7d-43b9-8e90-47521cc91ee1-3"><i class="fas fa-bone"></i>é€šè¿‡å¤–é”®æ¥è¡¨è¾¾ä¸€å¯¹å¤šçš„å…³ç³»</button></li><li class="tab"><button type="button" data-href="#cf8e7d91-4e7d-43b9-8e90-47521cc91ee1-4"><i class="fas fa-anchor"></i>æŠŠå±æ€§è½¬æ¢æˆè¡¨çš„å­—æ®µ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="cf8e7d91-4e7d-43b9-8e90-47521cc91ee1-1"><p><strong>å…ˆæ¥çœ‹ä¸€ä¸‹å¼ºå®ä½“è½¬æ¢æˆæ•°æ®è¡¨:</strong></p><p><code>ç”¨æˆ·å®ä½“</code>è½¬æ¢æˆç”¨æˆ·è¡¨(user_info)çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707171335255.png" alt="image-20220707171335255"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707171412363.png" alt="image-20220707171412363"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707171915637.png" alt="image-20220707171915637"  /><p><strong>ä¸‹é¢æˆ‘ä»¬å†æŠŠå¼±å®ä½“è½¬æ¢æˆæ•°æ®è¡¨ï¼š</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172033399.png" alt="image-20220707172033399"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172052236.png" alt="image-20220707172052236"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172143793.png" alt="image-20220707172143793"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172217772.png" alt="image-20220707172217772"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172236606.png" alt="image-20220707172236606"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172259143.png" alt="image-20220707172259143"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cf8e7d91-4e7d-43b9-8e90-47521cc91ee1-2"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172350226.png" alt="image-20220707172350226"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cf8e7d91-4e7d-43b9-8e90-47521cc91ee1-3"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172609833.png" alt="image-20220707172609833"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cf8e7d91-4e7d-43b9-8e90-47521cc91ee1-4"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172819174.png" alt="image-20220707172819174"  /><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707172918017.png" alt="image-20220707172918017"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h2 id="8-æ•°æ®è¡¨çš„è®¾è®¡åŸåˆ™">8. æ•°æ®è¡¨çš„è®¾è®¡åŸåˆ™</h2><p>ç»¼åˆä»¥ä¸Šå†…å®¹ï¼Œæ€»ç»“å‡ºæ•°æ®è¡¨è®¾è®¡çš„ä¸€èˆ¬åŸåˆ™ï¼šâ€œä¸‰å°‘ä¸€å¤šâ€</p><p><strong>1. æ•°æ®è¡¨çš„ä¸ªæ•°è¶Šå°‘è¶Šå¥½</strong></p><p>RDBMS çš„æ ¸å¿ƒåœ¨äºå¯¹å®ä½“å’Œè”ç³»çš„å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯E-Rå›¾ï¼ˆEntity Relationship Diagram)ï¼Œæ•°æ®è¡¨è¶Šå°‘ï¼Œè¯æ˜å®ä½“å’Œè”ç³»è®¾è®¡å¾—è¶Šç®€æ´ï¼Œæ—¢æ–¹ä¾¿ç†è§£åˆæ–¹ä¾¿æ“ä½œã€‚</p><p><strong>2. æ•°æ®è¡¨ä¸­çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½</strong></p><p>å­—æ®µä¸ªæ•°è¶Šå¤šï¼Œæ•°æ®å†—ä½™çš„å¯èƒ½æ€§è¶Šå¤§ã€‚è®¾ç½®å­—æ®µä¸ªæ•°å°‘çš„å‰ææ˜¯å„ä¸ªå­—æ®µç›¸äº’ç‹¬ç«‹ï¼Œè€Œä¸æ˜¯æŸä¸ªå­—æ®µçš„å–å€¼å¯ä»¥ç”±å…¶ä»–å­—æ®µè®¡ç®—å‡ºæ¥ã€‚å½“ç„¶å­—æ®µä¸ªæ•°å°‘æ˜¯ç›¸å¯¹çš„ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨æ•°æ®å†—ä½™å’Œæ£€ç´¢æ•ˆç‡,ä¸­è¿›è¡Œå¹³è¡¡ã€‚</p><p><strong>3. æ•°æ®è¡¨ä¸­è”åˆä¸»é”®çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½</strong></p><p>è®¾ç½®ä¸»é”®æ˜¯ä¸ºäº†ç¡®å®šå”¯ä¸€æ€§ï¼Œå½“ä¸€ä¸ªå­—æ®µæ— æ³•ç¡®å®šå”¯ä¸€æ€§çš„æ—¶å€™ï¼Œå°±éœ€è¦é‡‡ç”¨è”åˆä¸»é”®çš„æ–¹å¼ï¼ˆä¹Ÿå°±æ˜¯ç”¨å¤šä¸ªå­—æ®µæ¥å®šä¹‰ä¸€ä¸ªä¸»é”®ï¼‰ã€‚è”åˆä¸»é”®ä¸­çš„å­—æ®µè¶Šå¤šï¼Œå ç”¨çš„å´‡å¼•ç©ºé—´è¶Šå¤§ï¼Œä¸ä»…ä¼šåŠ å¤§ç†è§£éš¾åº¦ï¼Œè¿˜ä¼šå¢åŠ è¿è¡Œæ—¶é—´å’Œç´¢å¼•ç©ºé—´ï¼Œå› æ­¤è”åˆä¸»é”®çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½ã€‚</p><p><strong>4. ä½¿ç”¨ä¸»é”®å’Œå¤–é”®è¶Šå¤šè¶Šå¥½</strong></p><p>æ•°æ®åº“çš„è®¾è®¡å®é™…ä¸Šå°±æ˜¯å®šä¹‰å„ç§è¡¨ï¼Œä»¥åŠå„ç§å­—æ®µä¹‹é—´çš„å…³ç³»ã€‚è¿™äº›å…³ç³»è¶Šå¤šï¼Œè¯æ˜è¿™äº›å®ä½“ä¹‹é—´çš„å‡ ä½™åº¦è¶Šä½ï¼Œåˆ©ç”¨åº¦è¶Šå•†ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºä¸ä»…ä¿è¯äº†æ•°æ®è¡¨ä¹‹é—´çš„ç‹¬ç«‹æ€§ï¼Œè¿˜èƒ½æå‡ç›¸äº’ä¹‹é—´çš„å…³è”ä½¿ç”¨ç‡ã€‚</p><p>â€œä¸‰å°‘ä¸€å¤šâ€åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯ç®€å•å¯å¤ç”¨ã€‚ç®€å•æŒ‡çš„æ˜¯ç”¨æ›´å°‘çš„è¡¨ã€æ›´å°‘çš„å­—æ®µã€æ›´å°‘çš„è”åˆä¸»å¥å­—æ®µæ¥å®Œæˆæ•°æ®è¡¨çš„è®¾è®¡ã€‚å¯å¤ç”¨åˆ™æ˜¯é€šè¿‡ä¸»é”®ã€å¤–é”®çš„ä½¿ç”¨æ¥å¢å¼ºæ•°æ®è¡¨ä¹‹é—´çš„å¤ç”¨ç‡ã€‚å› ä¸ºä¸€ä¸ªä¸»é”®å¯ä»¥ç†è§£æ˜¯ä¸€å¼ è¡¨çš„ä»£è¡¨ã€‚é”®è®¾è®¡å¾—è¶Šå¤šï¼Œè¯æ˜å®ƒä»¬ä¹‹é—´çš„åˆ©ç”¨ç‡è¶Šé«˜ã€‚</p><p>æ³¨æ„ï¼šè¿™ä¸ªåŸåˆ™å¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç‰ºç‰²æ•°æ®çš„å†—ä½™åº¦æ¥æ¢å–æ•°æ®å¤„ç†çš„æ•ˆç‡ã€‚</p><hr><h2 id="9-æ•°æ®åº“å¯¹è±¡ç¼–å†™å»ºè®®">9. æ•°æ®åº“å¯¹è±¡ç¼–å†™å»ºè®®</h2><h3 id="9-1-å…³äºåº“">9.1 å…³äºåº“</h3><ol><li>ã€å¼ºåˆ¶ã€‘åº“çš„åç§°å¿…é¡»æ§åˆ¶åœ¨32ä¸ªå­—ç¬¦ä»¥å†…ï¼Œåªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå»ºè®®ä»¥è‹±æ–‡å­— æ¯å¼€å¤´ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åº“åä¸­è‹±æ–‡ ä¸€å¾‹å°å†™ ï¼Œä¸åŒå•è¯é‡‡ç”¨ ä¸‹åˆ’çº¿ åˆ†å‰²ã€‚é¡»è§åçŸ¥æ„ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åº“çš„åç§°æ ¼å¼ï¼šä¸šåŠ¡ç³»ç»Ÿåç§°_å­ç³»ç»Ÿåã€‚</li><li>ã€å¼ºåˆ¶ã€‘åº“åç¦æ­¢ä½¿ç”¨å…³é”®å­—ï¼ˆå¦‚type,orderç­‰ï¼‰ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åˆ›å»ºæ•°æ®åº“æ—¶å¿…é¡» æ˜¾å¼æŒ‡å®šå­—ç¬¦é›† ï¼Œå¹¶ä¸”å­—ç¬¦é›†åªèƒ½æ˜¯utf8æˆ–è€…utf8mb4ã€‚ åˆ›å»ºæ•°æ®åº“SQLä¸¾ä¾‹ï¼šCREATE DATABASE crm_fund DEFAULT CHARACTER SET â€˜utf8â€™ ;</li><li>ã€å»ºè®®ã€‘å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·ï¼Œéµå¾ª æƒé™æœ€å°åŸåˆ™ ä½¿ç”¨æ•°æ®åº“è´¦å·åªèƒ½åœ¨ä¸€ä¸ªDBä¸‹ä½¿ç”¨ï¼Œä¸å‡†è·¨åº“ã€‚ç¨‹åºä½¿ç”¨çš„è´¦å· åŸåˆ™ä¸Šä¸å‡†æœ‰dropæƒé™ ã€‚</li><li>ã€å»ºè®®ã€‘ä¸´æ—¶åº“ä»¥ tmp_ ä¸ºå‰ç¼€ï¼Œå¹¶ä»¥æ—¥æœŸä¸ºåç¼€ï¼› å¤‡ä»½åº“ä»¥ bak_ ä¸ºå‰ç¼€ï¼Œå¹¶ä»¥æ—¥æœŸä¸ºåç¼€ã€‚</li></ol><h3 id="9-2-å…³äºè¡¨ã€åˆ—">9.2 å…³äºè¡¨ã€åˆ—</h3><ol><li><p>ã€å¼ºåˆ¶ã€‘è¡¨å’Œåˆ—çš„åç§°å¿…é¡»æ§åˆ¶åœ¨32ä¸ªå­—ç¬¦ä»¥å†…ï¼Œè¡¨ååªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå»ºè®® ä»¥ è‹±æ–‡å­—æ¯å¼€å¤´ ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘ è¡¨åã€åˆ—åä¸€å¾‹å°å†™ ï¼Œä¸åŒå•è¯é‡‡ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ã€‚é¡»è§åçŸ¥æ„ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘è¡¨åè¦æ±‚æœ‰æ¨¡å—åå¼ºç›¸å…³ï¼ŒåŒä¸€æ¨¡å—çš„è¡¨åå°½é‡ä½¿ç”¨ ç»Ÿä¸€å‰ç¼€ ã€‚æ¯”å¦‚ï¼šcrm_fund_item</p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡» æ˜¾å¼æŒ‡å®šå­—ç¬¦é›† ä¸ºutf8æˆ–utf8mb4ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘è¡¨åã€åˆ—åç¦æ­¢ä½¿ç”¨å…³é”®å­—ï¼ˆå¦‚type,orderç­‰ï¼‰ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡» æ˜¾å¼æŒ‡å®šè¡¨å­˜å‚¨å¼•æ“ ç±»å‹ã€‚å¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€å¾‹ä¸ºInnoDBã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘å»ºè¡¨å¿…é¡»æœ‰commentã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘å­—æ®µå‘½ååº”å°½å¯èƒ½ä½¿ç”¨è¡¨è¾¾å®é™…å«ä¹‰çš„è‹±æ–‡å•è¯æˆ– ç¼©å†™ ã€‚å¦‚ï¼šå…¬å¸ IDï¼Œä¸è¦ä½¿ç”¨ corporation_id, è€Œç”¨corp_id å³å¯ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘å¸ƒå°”å€¼ç±»å‹çš„å­—æ®µå‘½åä¸º is_æè¿° ã€‚å¦‚memberè¡¨ä¸Šè¡¨ç¤ºæ˜¯å¦ä¸ºenabledçš„ä¼šå‘˜çš„å­—æ®µå‘½ åä¸º is_enabledã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡ã€æ–‡ä»¶ç­‰å¤§çš„äºŒè¿›åˆ¶æ•°æ® é€šå¸¸æ–‡ä»¶å¾ˆå¤§ï¼ŒçŸ­æ—¶é—´å†…é€ æˆæ•°æ®é‡å¿«é€Ÿå¢é•¿ï¼Œæ•°æ®åº“è¿›è¡Œæ•°æ®åº“è¯»å–æ—¶ï¼Œé€šå¸¸ä¼šè¿›è¡Œå¤§é‡çš„éš æœºIOæ“ä½œï¼Œæ–‡ä»¶å¾ˆå¤§æ—¶ï¼ŒIOæ“ä½œå¾ˆè€—æ—¶ã€‚é€šå¸¸å­˜å‚¨äºæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å»ºè¡¨æ—¶å…³äºä¸»é”®ï¼š è¡¨å¿…é¡»æœ‰ä¸»é”®</p><p>(1)å¼ºåˆ¶è¦æ±‚ä¸»é”®ä¸ºidï¼Œç±»å‹ä¸ºintæˆ–bigintï¼Œä¸”ä¸º auto_increment å»ºè®®ä½¿ç”¨unsignedæ— ç¬¦å·å‹ã€‚</p><p>(2)æ ‡è¯†è¡¨é‡Œæ¯ä¸€è¡Œä¸»ä½“çš„å­—æ®µä¸è¦è®¾ä¸ºä¸»é”®ï¼Œå»ºè®® è®¾ä¸ºå…¶ä»–å­—æ®µå¦‚user_idï¼Œorder_idç­‰ï¼Œå¹¶å»ºç«‹unique keyç´¢å¼•ã€‚å› ä¸ºå¦‚æœè®¾ä¸ºä¸»é”®ä¸”ä¸»é”®å€¼ä¸ºéšæœº æ’å…¥ï¼Œåˆ™ä¼šå¯¼è‡´innodbå†…éƒ¨é¡µåˆ†è£‚å’Œå¤§é‡éšæœºI/Oï¼Œæ€§èƒ½ä¸‹é™ã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ ¸å¿ƒè¡¨ï¼ˆå¦‚ç”¨æˆ·è¡¨ï¼‰å¿…é¡»æœ‰è¡Œæ•°æ®çš„ åˆ›å»ºæ—¶é—´å­—æ®µ ï¼ˆcreate_timeï¼‰å’Œ æœ€åæ›´æ–°æ—¶é—´å­—æ®µ ï¼ˆupdate_timeï¼‰ï¼Œä¾¿äºæŸ¥é—®é¢˜ã€‚</p></li><li><p>ã€å»ºè®®ã€‘è¡¨ä¸­æ‰€æœ‰å­—æ®µå°½é‡éƒ½æ˜¯ NOT NULL å±æ€§ï¼Œä¸šåŠ¡å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰ DEFAULTå€¼ ã€‚ å› ä¸ºä½¿ç”¨ NULLå€¼ä¼šå­˜åœ¨æ¯ä¸€è¡Œéƒ½ä¼šå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ã€æ•°æ®è¿ç§»å®¹æ˜“å‡ºé”™ã€èšåˆå‡½æ•°è®¡ç®—ç»“æœåå·®ç­‰é—® é¢˜ã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„ åˆ—åå’Œåˆ—ç±»å‹å¿…é¡»ä¸€è‡´ ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»å‹ ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼‰ã€‚</p></li><li><p>ã€å»ºè®®ã€‘ä¸­é—´è¡¨ï¼ˆæˆ–ä¸´æ—¶è¡¨ï¼‰ç”¨äºä¿ç•™ä¸­é—´ç»“æœé›†ï¼Œåç§°ä»¥ tmp_ å¼€å¤´ã€‚ å¤‡ä»½è¡¨ç”¨äºå¤‡ä»½æˆ–æŠ“å–æºè¡¨å¿«ç…§ï¼Œåç§°ä»¥ bak_ å¼€å¤´ã€‚ä¸­é—´è¡¨å’Œå¤‡ä»½è¡¨å®šæœŸæ¸…ç†ã€‚ 1</p></li><li><p>ã€ç¤ºèŒƒã€‘ä¸€ä¸ªè¾ƒä¸ºè§„èŒƒçš„å»ºè¡¨è¯­å¥ï¼š</p></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_info (</span><br><span class="line">`id`<span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;è‡ªå¢ä¸»é”®&#x27;</span>,</span><br><span class="line">`user_id`<span class="type">bigint</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">`username`<span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;çœŸå®å§“å&#x27;</span>,</span><br><span class="line">`email`<span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·é‚®ç®±&#x27;</span>,</span><br><span class="line">`nickname`<span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ˜µç§°&#x27;</span>,</span><br><span class="line">`birthday`<span class="type">date</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”Ÿæ—¥&#x27;</span>,</span><br><span class="line">`sex`tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æ€§åˆ«&#x27;</span>,</span><br><span class="line">`short_introduce`<span class="type">varchar</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸€å¥è¯ä»‹ç»è‡ªå·±ï¼Œæœ€å¤š50ä¸ªæ±‰å­—&#x27;</span>,</span><br><span class="line">`user_resume`<span class="type">varchar</span>(<span class="number">300</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·æäº¤çš„ç®€å†å­˜æ”¾åœ°å€&#x27;</span>,</span><br><span class="line">`user_register_ip`<span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·æ³¨å†Œæ—¶çš„æºip&#x27;</span>,</span><br><span class="line">`create_time`<span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">`update_time`<span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span></span><br><span class="line"><span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">`user_review_status`tinyint <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·èµ„æ–™å®¡æ ¸çŠ¶æ€ï¼Œ1ä¸ºé€šè¿‡ï¼Œ2ä¸ºå®¡æ ¸ä¸­ï¼Œ3ä¸ºæœª</span></span><br><span class="line"><span class="string">é€šè¿‡ï¼Œ4ä¸ºè¿˜æœªæäº¤å®¡æ ¸&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY`uniq_user_id`(`user_id`),</span><br><span class="line">KEY`idx_username`(`username`),</span><br><span class="line">KEY`idx_create_time_status`(`create_time`,`user_review_status`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;ç½‘ç«™ç”¨æˆ·åŸºæœ¬ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><ol start="17"><li>ã€å»ºè®®ã€‘åˆ›å»ºè¡¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¯è§†åŒ–å·¥å…·ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è¡¨ã€å­—æ®µç›¸å…³çš„çº¦å®šéƒ½èƒ½è®¾ç½®ä¸Šã€‚</li></ol><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬é€šå¸¸å¾ˆå°‘è‡ªå·±å†™ DDL è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å¯è§†åŒ–å·¥å…·æ¥åˆ›å»ºå’Œæ“ä½œæ•°æ®åº“å’Œæ•°æ®è¡¨ã€‚</p><p>å¯è§†åŒ–å·¥å…·é™¤äº†æ–¹ä¾¿ï¼Œè¿˜èƒ½ç›´æ¥å¸®æˆ‘ä»¬å°†æ•°æ®åº“çš„ç»“æ„å®šä¹‰è½¬åŒ–æˆ SQL è¯­è¨€ï¼Œæ–¹ä¾¿æ•°æ®åº“å’Œæ•°æ®è¡¨ç»“æ„çš„å¯¼å‡ºå’Œå¯¼å…¥ã€‚</p><h3 id="9-3-å…³äºç´¢å¼•">9.3 å…³äºç´¢å¼•</h3><ol><li>ã€å¼ºåˆ¶ã€‘InnoDBè¡¨å¿…é¡»ä¸»é”®ä¸ºid int/bigint auto_incrementï¼Œä¸”ä¸»é”®å€¼ ç¦æ­¢è¢«æ›´æ–° ã€‚</li><li>ã€å¼ºåˆ¶ã€‘InnoDBå’ŒMyISAMå­˜å‚¨å¼•æ“è¡¨ï¼Œç´¢å¼•ç±»å‹å¿…é¡»ä¸º BTREE ã€‚</li><li>ã€å»ºè®®ã€‘ä¸»é”®çš„åç§°ä»¥ pk_ å¼€å¤´ï¼Œå”¯ä¸€é”®ä»¥ uni_ æˆ– uk_ å¼€å¤´ï¼Œæ™®é€šç´¢å¼•ä»¥ idx_ å¼€å¤´ï¼Œä¸€å¾‹ä½¿ç”¨å°å†™æ ¼å¼ï¼Œä»¥å­—æ®µçš„åç§°æˆ–ç¼©å†™ä½œä¸ºåç¼€ã€‚</li><li>ã€å»ºè®®ã€‘å¤šå•è¯ç»„æˆçš„columnnameï¼Œå–å‰å‡ ä¸ªå•è¯é¦–å­—æ¯ï¼ŒåŠ æœ«å•è¯ç»„æˆcolumn_nameã€‚å¦‚: sample è¡¨ member_id ä¸Šçš„ç´¢å¼•ï¼šidx_sample_midã€‚</li><li>ã€å»ºè®®ã€‘å•ä¸ªè¡¨ä¸Šçš„ç´¢å¼•ä¸ªæ•° ä¸èƒ½è¶…è¿‡6ä¸ª ã€‚</li><li>ã€å»ºè®®ã€‘åœ¨å»ºç«‹ç´¢å¼•æ—¶ï¼Œå¤šè€ƒè™‘å»ºç«‹ è”åˆç´¢å¼• ï¼Œå¹¶æŠŠåŒºåˆ†åº¦æœ€é«˜çš„å­—æ®µæ”¾åœ¨æœ€å‰é¢ã€‚</li><li>ã€å»ºè®®ã€‘åœ¨å¤šè¡¨ JOIN çš„SQLé‡Œï¼Œä¿è¯è¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œè¿™æ ·JOIN æ‰§è¡Œæ•ˆç‡æœ€é«˜ã€‚</li><li>ã€å»ºè®®ã€‘å»ºè¡¨æˆ–åŠ ç´¢å¼•æ—¶ï¼Œä¿è¯è¡¨é‡Œäº’ç›¸ä¸å­˜åœ¨ å†—ä½™ç´¢å¼• ã€‚ æ¯”å¦‚ï¼šå¦‚æœè¡¨é‡Œå·²ç»å­˜åœ¨key(a,b)ï¼Œ åˆ™key(a)ä¸ºå†—ä½™ç´¢å¼•ï¼Œéœ€è¦åˆ é™¤ã€‚</li></ol><h3 id="9-4-SQLç¼–å†™">9.4 SQLç¼–å†™</h3><ol><li><p>ã€å¼ºåˆ¶ã€‘ç¨‹åºç«¯SELECTè¯­å¥å¿…é¡»æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œç¦æ­¢å†™æˆ *ã€‚</p></li><li><p>ã€å»ºè®®ã€‘ç¨‹åºç«¯insertè¯­å¥æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œä¸è¦å†™æˆINSERT INTO t1 VALUES(â€¦)ã€‚</p></li><li><p>ã€å»ºè®®ã€‘é™¤é™æ€è¡¨æˆ–å°è¡¨ï¼ˆ100è¡Œä»¥å†…ï¼‰ï¼ŒDMLè¯­å¥å¿…é¡»æœ‰WHEREæ¡ä»¶ï¼Œä¸”ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚</p></li><li><p>ã€å»ºè®®ã€‘INSERT INTOâ€¦VALUES(XX),(XX),(XX)â€¦ è¿™é‡ŒXXçš„å€¼ä¸è¦è¶…è¿‡5000ä¸ªã€‚ å€¼è¿‡å¤šè™½ç„¶ä¸Šçº¿å¾ˆ å¿«ï¼Œä½†ä¼šå¼•èµ·ä¸»ä»åŒæ­¥å»¶è¿Ÿã€‚</p></li><li><p>ã€å»ºè®®ã€‘SELECTè¯­å¥ä¸è¦ä½¿ç”¨UNIONï¼Œæ¨èä½¿ç”¨UNION ALLï¼Œå¹¶ä¸”UNIONå­å¥ä¸ªæ•°é™åˆ¶åœ¨5ä¸ªä»¥ å†…ã€‚</p></li><li><p>ã€å»ºè®®ã€‘çº¿ä¸Šç¯å¢ƒï¼Œå¤šè¡¨ JOIN ä¸è¦è¶…è¿‡5ä¸ªè¡¨ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å‡å°‘ä½¿ç”¨ORDER BYï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚ORDER BYã€GROUP BYã€DISTINCT è¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹CPUï¼Œæ•°æ®åº“çš„CPUèµ„æºæ˜¯æå…¶å®è´µçš„ã€‚</p></li><li><p>ã€å»ºè®®ã€‘åŒ…å«äº†ORDER BYã€GROUP BYã€DISTINCT è¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼ŒWHERE æ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœ é›†è¯·ä¿æŒåœ¨1000è¡Œä»¥å†…ï¼Œå¦åˆ™SQLä¼šå¾ˆæ…¢ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å¯¹å•è¡¨çš„å¤šæ¬¡alteræ“ä½œå¿…é¡»åˆå¹¶ä¸ºä¸€æ¬¡ å¯¹äºè¶…è¿‡100Wè¡Œçš„å¤§è¡¨è¿›è¡Œalter tableï¼Œå¿…é¡»ç»è¿‡DBAå®¡æ ¸ï¼Œå¹¶åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œï¼Œå¤šä¸ªalteréœ€æ•´åˆåœ¨ä¸€èµ·ã€‚ å› ä¸ºalter tableä¼šäº§ç”Ÿè¡¨é” ï¼ŒæœŸé—´é˜»å¡å¯¹äºè¯¥è¡¨çš„æ‰€æœ‰å†™å…¥ï¼Œå¯¹äºä¸šåŠ¡å¯èƒ½ä¼šäº§ç”Ÿæ å¤§å½±å“ã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ‰¹é‡æ“ä½œæ•°æ®æ—¶ï¼Œéœ€è¦æ§åˆ¶äº‹åŠ¡å¤„ç†é—´éš”æ—¶é—´ï¼Œè¿›è¡Œå¿…è¦çš„sleepã€‚</p></li><li><p>ã€å»ºè®®ã€‘äº‹åŠ¡é‡ŒåŒ…å«SQLä¸è¶…è¿‡5ä¸ªã€‚ å› ä¸ºè¿‡é•¿çš„äº‹åŠ¡ä¼šå¯¼è‡´é”æ•°æ®è¾ƒä¹…ï¼ŒMySQLå†…éƒ¨ç¼“å­˜ã€è¿æ¥æ¶ˆè€—è¿‡å¤šç­‰é—®é¢˜ã€‚</p></li><li><p>ã€å»ºè®®ã€‘äº‹åŠ¡é‡Œæ›´æ–°è¯­å¥å°½é‡åŸºäºä¸»é”®æˆ–UNIQUE KEYï¼Œå¦‚UPDATEâ€¦ WHERE id=XX; å¦åˆ™ä¼šäº§ç”Ÿé—´éš™é”ï¼Œå†…éƒ¨æ‰©å¤§é”å®šèŒƒå›´ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œäº§ç”Ÿæ­»é”ã€‚</p></li></ol><hr><h2 id="10-PowerDesignerçš„ä½¿ç”¨">10. PowerDesignerçš„ä½¿ç”¨</h2><p>PowerDesigneræ˜¯ä¸€æ¬¾å¼€å‘äººå‘˜å¸¸ç”¨çš„æ•°æ®åº“å»ºæ¨¡å·¥å…·ï¼Œç”¨æˆ·åˆ©ç”¨è¯¥è½¯ä»¶å¯ä»¥æ–¹ä¾¿åœ°åˆ¶ä½œ<code>æ•°æ®æµç¨‹å›¾</code>ã€<code>æ¦‚å¿µæ•°æ®æ¨¡å‹</code>ã€<code>ç‰©ç†æ•°æ®æ¨¡å‹</code>ï¼Œå®ƒå‡ ä¹åŒ…æ‹¬äº†æ•°æ®åº“æ¨¡å‹è®¾è®¡çš„å…¨è¿‡ç¨‹ï¼Œæ˜¯Sybaseå…¬å¸ä¸ºä¼ä¸šå»ºæ¨¡å’Œè®¾ è®¡æä¾›çš„ä¸€å¥—å®Œæ•´çš„é›†æˆåŒ–ä¼ä¸šçº§å»ºæ¨¡è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="10-1-å¼€å§‹ç•Œé¢">10.1 å¼€å§‹ç•Œé¢</h3><p>å½“å‰ä½¿ç”¨çš„PowerDesignerç‰ˆæœ¬æ˜¯16.5çš„ã€‚æ‰“å¼€è½¯ä»¶å³æ˜¯æ­¤é¡µé¢ï¼Œå¯é€‰æ‹©Create Model,ä¹Ÿå¯ä»¥é€‰æ‹©Do Not Show page Again,è‡ªè¡Œåœ¨æ‰“å¼€è½¯ä»¶ååˆ›å»ºä¹Ÿå¯ä»¥ï¼å®Œå…¨çœ‹ä¸ªäººçš„å–œå¥½ï¼Œåœ¨æ­¤æˆ‘åœ¨åé¢çš„å­¦ä¹ ä¸­ä¸åœ¨æ˜¾ç¤ºæ­¤é¡µé¢ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175250944.png" alt="image-20220707175250944" style="zoom:80%;" /><p>â€œCreate Modelâ€çš„ä½œç”¨ç±»ä¼¼äºæ™®é€šçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥å•ç‹¬å­˜æ”¾ä¹Ÿå¯ä»¥å½’ç±»å­˜æ”¾ã€‚</p><p>â€œCreate Projectâ€çš„ä½œç”¨ç±»ä¼¼äºæ–‡ä»¶å¤¹ï¼Œè´Ÿè´£æŠŠæœ‰å…³è”å…³ç³»çš„æ–‡ä»¶é›†ä¸­å½’ç±»å­˜æ”¾ã€‚</p><h3 id="10-2-æ¦‚å¿µæ•°æ®æ¨¡å‹">10.2 æ¦‚å¿µæ•°æ®æ¨¡å‹</h3><p>å¸¸ç”¨çš„æ¨¡å‹æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯<code>æ¦‚å¿µæ¨¡å‹(CDM Conceptual Data Model)</code>ï¼Œ<code>ç‰©ç†æ¨¡å‹ï¼ˆPDM,Physical Data Modelï¼‰</code>ï¼Œ<code>é¢å‘å¯¹è±¡çš„æ¨¡å‹ï¼ˆOOM Objcet Oriented Modelï¼‰</code>å’Œ<code>ä¸šåŠ¡æ¨¡å‹ï¼ˆBPM Business Process Modelï¼‰</code>ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºæ¦‚å¿µæ•°æ®æ¨¡å‹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175350250.png" alt="image-20220707175350250"  /><p>ç‚¹å‡»ä¸Šé¢çš„okï¼Œå³å¯å‡ºç°ä¸‹å›¾å·¦è¾¹çš„æ¦‚å¿µæ¨¡å‹1ï¼Œå¯ä»¥è‡ªå®šä¹‰æ¦‚å¿µæ¨¡å‹çš„åå­—ï¼Œåœ¨æ¦‚å¿µæ¨¡å‹ä¸­ä½¿ç”¨æœ€å¤šçš„ å°±æ˜¯å¦‚å›¾æ‰€ç¤ºçš„Entity(å®ä½“),Relationship(å…³ç³»)</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175604026.png" alt="image-20220707175604026"  /><p><strong>Entityå®ä½“</strong></p><p>é€‰ä¸­å³è¾¹æ¡†ä¸­Entityè¿™ä¸ªåŠŸèƒ½ï¼Œå³å¯å‡ºç°ä¸‹é¢è¿™ä¸ªæ–¹æ¡†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¹¦å†™nameçš„æ—¶å€™ï¼Œcodeè‡ªè¡Œè¡¥å…¨ï¼Œnameå¯ä»¥æ˜¯è‹±æ–‡çš„ä¹Ÿå¯ä»¥æ˜¯ä¸­æ–‡çš„ï¼Œä½†æ˜¯codeå¿…é¡»æ˜¯è‹±æ–‡çš„ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175653689.png" alt="image-20220707175653689"  /><p><strong>å¡«å……å®ä½“å­—æ®µ</strong></p><p>Generalä¸­çš„nameå’Œcodeå¡«å¥½åï¼Œå°±å¯ä»¥ç‚¹å‡»Attributesï¼ˆå±æ€§ï¼‰æ¥è®¾ç½®nameï¼ˆåå­—ï¼‰ï¼Œcode(åœ¨æ•°æ®åº“ä¸­ çš„å­—æ®µå)ï¼ŒData Type(æ•°æ®ç±»å‹) ï¼Œlength(æ•°æ®ç±»å‹çš„é•¿åº¦)</p><ul><li>Name: å®ä½“åå­—ä¸€èˆ¬ä¸ºä¸­æ–‡ï¼Œå¦‚è®ºå›ç”¨æˆ·</li><li>Code: å®ä½“ä»£å·ï¼Œä¸€èˆ¬ç”¨è‹±æ–‡ï¼Œå¦‚XXXUser</li><li>Comment:æ³¨é‡Šï¼Œå¯¹æ­¤å®ä½“è¯¦ç»†è¯´æ˜</li><li>Codeå±æ€§ï¼šä»£å·ï¼Œä¸€èˆ¬ç”¨è‹±æ–‡UID DataType</li><li>DomainåŸŸï¼Œè¡¨ç¤ºå±æ€§å–å€¼èŒƒå›´å¦‚å¯ä»¥åˆ›å»º10ä¸ªå­—ç¬¦çš„åœ°å€åŸŸ</li><li>M:Mandatoryå¼ºåˆ¶å±æ€§ï¼Œè¡¨ç¤ºè¯¥å±æ€§å¿…å¡«ã€‚ä¸èƒ½ä¸ºç©º</li><li>P:Primary Identiferæ˜¯å¦æ˜¯ä¸»æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºå®ä½“å”¯ä¸€æ ‡è¯†ç¬¦</li><li>D:Displayedæ˜¾ç¤ºå‡ºæ¥ï¼Œé»˜è®¤å…¨éƒ¨å‹¾é€‰</li></ul><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175805226.png" alt="image-20220707175805226"  /><p>åœ¨æ­¤ä¸Šå›¾è¯´æ˜nameå’Œcodeçš„èµ·åæ–¹æ³•</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175827417.png" alt="image-20220707175827417"  /><p><strong>è®¾ç½®ä¸»æ ‡è¯†ç¬¦</strong></p><p>å¦‚æœä¸å¸Œæœ›ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆæ ‡è¯†ç¬¦è€Œæ˜¯æ‰‹åŠ¨è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆåˆ‡æ¢åˆ°Identifiersé€‰é¡¹å¡ï¼Œæ·»åŠ ä¸€è¡ŒIdentifierï¼Œ ç„¶åå•å‡»å·¦ä¸Šè§’çš„â€œå±æ€§â€æŒ‰é’®ï¼Œç„¶åå¼¹å‡ºçš„æ ‡è¯†å±æ€§è®¾ç½®å¯¹è¯æ¡†ä¸­å•å‡»â€œæ·»åŠ è¡Œâ€æŒ‰é’®ï¼Œé€‰æ‹©è¯¥æ ‡è¯†ä¸­ä½¿ç”¨çš„å±æ€§ã€‚ä¾‹å¦‚å°†å­¦å·è®¾ç½®ä¸ºå­¦ç”Ÿå®ä½“çš„æ ‡è¯†ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175858031.png" alt="image-20220707175858031"  /><p><strong>æ”¾å¤§æ¨¡å‹</strong></p><p>åˆ›å»ºå¥½æ¦‚å¿µæ•°æ®æ¨¡å‹å¦‚å›¾æ‰€ç¤ºï¼Œä½†æ˜¯åˆ›å»ºå¥½çš„å­—ä½“å¾ˆå°ï¼Œè¯»è€…å¯ä»¥æŒ‰ç€ctrlé”®åŒæ—¶æ»‘åŠ¨é¼ æ ‡çš„å¯æ»‘åŠ¨æŒ‰é’® å³å¯æ”¾å¤§ç¼©å†™å­—ä½“ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸»æ ‡è¯†ç¬¦æœ‰ä¸€ä¸ª*å·çš„æ ‡å¿—ï¼ŒåŒæ—¶ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº†ï¼Œname,Data typeå’Œ lengthè¿™äº›å¯è§çš„å±æ€§</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175925155.png" alt="image-20220707175925155"  /><p><strong>å®ä½“å…³ç³»</strong></p><p>åŒç†åˆ›å»ºä¸€ä¸ªç­çº§çš„å®ä½“ï¼ˆéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œç‚¹å‡»å®Œå³è¾¹åŠŸèƒ½çš„æŒ‰é’®åéœ€è¦ç‚¹å‡»é¼ æ ‡æŒ‡é’ˆçŠ¶æ€çš„æŒ‰é’® æˆ–è€…å³å‡»é¼ æ ‡å³å¯ï¼Œä¸ç„¶å¾ˆå®¹æ˜“ä¹±æ“ä½œï¼Œè¿™ç‚¹æ³¨æ„ä¸€ä¸‹å°±å¯ä»¥äº†ï¼‰ï¼Œç„¶åä½¿ç”¨Relationshipï¼ˆå…³ç³»ï¼‰è¿™ä¸ª æŒ‰é’®å¯ä»¥è¿æ¥å­¦ç”Ÿå’Œç­çº§ä¹‹é—´çš„å…³ç³»ï¼Œå‘ç”Ÿä¸€å¯¹å¤šï¼ˆç­çº§å¯¹å­¦ç”Ÿï¼‰æˆ–è€…å¤šå¯¹ä¸€ï¼ˆå­¦ç”Ÿå¯¹ç­çº§ï¼‰çš„å…³ç³»ã€‚</p><p>å¦‚å›¾æ‰€ç¤º</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707175954634.png" alt="image-20220707175954634"  /><p>éœ€è¦æ³¨æ„çš„æ˜¯ç‚¹å‡»Relationshipè¿™ä¸ªæŒ‰é’®ï¼Œå°±æŠŠç­çº§å’Œå­¦ç”Ÿè”ç³»èµ·æ¥äº†ï¼Œå°±æ˜¯ä¸€æ¡çº¿ï¼Œç„¶ååŒå‡»è¿™æ¡çº¿è¿› è¡Œç¼–è¾‘ï¼Œåœ¨Generalè¿™å—èµ·nameå’Œcode</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180021612.png" alt="image-20220707180021612"  /><p>ä¸Šé¢çš„nameå’Œcodeèµ·å¥½åå°±å¯ä»¥åœ¨Cardinalitiesè¿™å—æŸ¥çœ‹ç­çº§å’Œå­¦ç”Ÿçš„å…³ç³»ï¼Œå¯ä»¥çœ‹åˆ°ç­çº§çš„ä¸€ç«¯æ˜¯ä¸€ æ¡çº¿ï¼Œå­¦ç”Ÿçš„ä¸€ç«¯æ˜¯ä¸‰æ¡ï¼Œä»£è¡¨ç­çº§å¯¹å­¦ç”Ÿæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»å³oneå¯¹manyçš„å…³ç³»ï¼Œç‚¹å‡»åº”ç”¨ï¼Œç„¶åç¡®å®š å³å¯</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180044291.png" alt="image-20220707180044291"  /><p>ä¸€å¯¹å¤šå’Œå¤šå¯¹ä¸€ç»ƒä¹ å®Œè¿˜æœ‰å¤šå¯¹å¤šçš„ç»ƒä¹ ï¼Œå¦‚ä¸‹å›¾æ“ä½œæ‰€ç¤ºï¼Œè€å¸ˆå®ä½“å’Œä¸Šé¢ä»‹ç»çš„ä¸€æ ·ï¼Œè‡ªå·±å°† nameï¼Œdata typeç­‰ç­‰ä¿®æ”¹æˆè‡ªå·±éœ€è¦çš„å³å¯ï¼Œæ»¡è¶³é¡¹ç›®å¼€å‘éœ€æ±‚å³å¯ã€‚ï¼ˆcommentæ˜¯è§£é‡Šè¯´æ˜ï¼Œè‡ªå·±å¯ä»¥å†™ç›¸å…³çš„ä»‹ç»å’Œè¯´æ˜ï¼‰</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180113532.png" alt="image-20220707180113532"  /><p>å¤šå¯¹å¤šéœ€è¦æ³¨æ„çš„æ˜¯è‡ªå·±å¯ä»¥æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®å°†å…³ç³»è°ƒæ•´ç§°ä¸ºå¤šå¯¹å¤šçš„å…³ç³»manyå¯¹manyçš„å…³ç³»ï¼Œç„¶åç‚¹å‡»åº”ç”¨å’Œç¡®å®šå³å¯</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180159184.png" alt="image-20220707180159184"  /><p>ç»¼ä¸Šå³å¯å®Œæˆæœ€ç®€å•çš„å­¦ç”Ÿï¼Œç­çº§ï¼Œæ•™å¸ˆè¿™ç§æ¦‚å¿µæ•°æ®æ¨¡å‹çš„è®¾è®¡ï¼Œéœ€è¦è€ƒè™‘æ•°æ®çš„ç±»å‹å’Œä¸»æ ‡è¯†ç ï¼Œ æ˜¯å¦ä¸ºç©ºã€‚å…³ç³»æ˜¯ä¸€å¯¹ä¸€è¿˜æ˜¯ä¸€å¯¹å¤šè¿˜æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œè‡ªå·±éœ€è¦å…ˆè§„åˆ’å¥½å†è®¾è®¡ï¼Œç„¶åå°±okäº†ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180254510.png" alt="image-20220707180254510"></p><h3 id="10-3-ç‰©ç†æ•°æ®æ¨¡å‹">10.3 ç‰©ç†æ•°æ®æ¨¡å‹</h3><p>ä¸Šé¢æ˜¯æ¦‚å¿µæ•°æ®æ¨¡å‹ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹ç‰©ç†æ•°æ®æ¨¡å‹ï¼Œä»¥å ç»å¸¸ä½¿ç”¨ çš„å°±æ˜¯ç‰©ç†æ•°æ®æ¨¡å‹ã€‚æ‰“å¼€ PowerDesignerï¼Œç„¶åç‚¹å‡»Fileâ€“&gt;New Modelç„¶åé€‰æ‹©å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç‰©ç†æ•°æ®æ¨¡å‹ï¼Œç‰©ç†æ•°æ®æ¨¡å‹çš„åå­—è‡ªå·±èµ·ï¼Œç„¶åé€‰æ‹©è‡ªå·±æ‰€ä½¿ç”¨çš„æ•°æ®åº“å³å¯ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180327712.png" alt="image-20220707180327712"  /><p>åˆ›å»ºå¥½ä¸»é¡µé¢å¦‚å›¾æ‰€ç¤ºï¼Œä½†æ˜¯å³è¾¹çš„æŒ‰é’®å’Œæ¦‚å¿µæ¨¡å‹ç•¥æœ‰å·®åˆ«ï¼Œç‰©ç†æ¨¡å‹æœ€å¸¸ç”¨çš„ä¸‰ä¸ªæ˜¯<code>table(è¡¨)</code>ï¼Œ<code>view(è§†å›¾)</code>ï¼Œ<code>reference(å…³ç³»)</code>ï¼›</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180418090.png" alt="image-20220707180418090"  /><p>é¼ æ ‡å…ˆç‚¹å‡»å³è¾¹tableè¿™ä¸ªæŒ‰é’®ç„¶ååœ¨æ–°å»ºçš„ç‰©ç†æ¨¡å‹ç‚¹ä¸€ä¸‹ï¼Œå³å¯æ–°å»ºä¸€ä¸ªè¡¨ï¼Œç„¶ååŒå‡»æ–°å»ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨Generalçš„nameå’Œcodeå¡«ä¸Šè‡ªå·±éœ€è¦çš„ï¼Œç‚¹å‡»åº”ç”¨å³å¯ï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180449212.png" alt="image-20220707180449212"  /><p>ç„¶åç‚¹å‡»Columns,å¦‚ä¸‹å›¾è®¾ç½®ï¼Œéå¸¸ç®€å•ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯Pï¼ˆprimaryä¸»é”®ï¼‰ , F ï¼ˆforeign keyå¤–é”®ï¼‰ , Mï¼ˆmandatoryå¼ºåˆ¶æ€§çš„ï¼Œä»£è¡¨ä¸å¯ä¸ºç©ºï¼‰ è¿™ä¸‰ä¸ªã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180537251.png" alt="image-20220707180537251"  /><p>åœ¨æ­¤è®¾ç½®å­¦å·çš„è‡ªå¢ï¼ˆMYSQLé‡Œé¢çš„è‡ªå¢æ˜¯è¿™ä¸ªAUTO_INCREMENTï¼‰ï¼Œç­çº§ç¼–å·åŒç†ï¼Œä¸å¤šèµ˜è¿°ï¼</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180556645.png" alt="image-20220707180556645"  /><p>åœ¨ä¸‹é¢çš„è¿™ä¸ªç‚¹ä¸Šå¯¹å·å³å¯ï¼Œå°±è®¾ç½®å¥½äº†è‡ªå¢</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180619440.png" alt="image-20220707180619440"  /><p>å…¨éƒ¨å®Œæˆåå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180643107.png" alt="image-20220707180643107"  /><p>ç­çº§ç‰©ç†æ¨¡å‹åŒç†å¦‚ä¸‹å›¾æ‰€ç¤ºåˆ›å»ºå³å¯</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180723698.png" alt="image-20220707180723698"  /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180744600.png" alt="image-20220707180744600"  /><p>å®Œæˆåå¦‚ä¸‹å›¾æ‰€ç¤º</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180806150.png" alt="image-20220707180806150"  /><p>ä¸Šé¢çš„è®¾ç½®å¥½å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç„¶åä¸‹é¢æ˜¯å…³é”®çš„åœ°æ–¹ï¼Œç‚¹å‡»å³è¾¹æŒ‰é’®Referenceè¿™ä¸ªæŒ‰é’®ï¼Œå› ä¸ºæ˜¯ç­çº§å¯¹å­¦ ç”Ÿæ˜¯ä¸€å¯¹å¤šçš„ï¼Œæ‰€ä»¥é¼ æ ‡ä»å­¦ç”Ÿæ‹‰åˆ°ç­çº§å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå­¦ç”Ÿè¡¨å°†å‘ç”Ÿå˜åŒ–ï¼Œå­¦ç”Ÿè¡¨é‡Œé¢å¢åŠ äº†ä¸€è¡Œï¼Œè¿™ è¡Œæ˜¯ç­çº§è¡¨çš„ä¸»é”®ä½œä¸ºå­¦ç”Ÿè¡¨çš„å¤–é”®ï¼Œå°†ç­çº§è¡¨å’Œå­¦ç”Ÿè¡¨è”ç³»èµ·æ¥ã€‚ï¼ˆä»”ç»†è§‚å¯Ÿå³å¯çœ‹åˆ°åŒºåˆ«ã€‚ï¼‰</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707180828164.png" alt="image-20220707180828164"  /><p>åšå®Œä¸Šé¢çš„æ“ä½œï¼Œå°±å¯ä»¥åŒå‡»ä¸­é—´çš„ä¸€æ¡çº¿ï¼Œæ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼Œä¿®æ”¹nameå’Œcodeå³å¯</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707183743297.png" alt="image-20220707183743297"  /><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¿®æ”¹å®Œæ¯•åæ˜¾ç¤ºçš„ç»“æœå´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¹¶æ²¡æœ‰åŠæ³•ç›´æ¥åƒæ¦‚å¿µæ¨¡å‹é‚£æ ·ï¼Œä¿®æ”¹è¿‡å æ˜¾ç¤ºåœ¨ä¸­é—´çš„é‚£æ¡çº¿ä¸Šé¢ï¼Œè‡ªå·±æ˜ç™½å³å¯ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707193816176.png" alt="image-20220707193816176"  /><p>å­¦ä¹ äº†å¤šå¯¹ä¸€æˆ–è€…ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæ¥ä¸‹æ¥å­¦ä¹ å¤šå¯¹å¯¹çš„å…³ç³»ï¼ŒåŒç†è‡ªå·±å»ºå¥½è€å¸ˆè¡¨ï¼Œè¿™é‡Œä¸åœ¨å™è¿°ï¼Œè®°å¾—è€å¸ˆç¼–å·è‡ªå¢ï¼Œå»ºå¥½å¦‚ä¸‹å›¾æ‰€ç¤º</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707193932694.png" alt="image-20220707193932694"  /><p>ä¸‹é¢æ˜¯å¤šå¯¹å¤šå…³ç³»çš„å…³é”®ï¼Œç”±äºç‰©ç†æ¨¡å‹å¤šå¯¹å¤šçš„å…³ç³»éœ€è¦ä¸€ä¸ªä¸­é—´è¡¨æ¥è¿æ¥ï¼Œå¦‚ä¸‹å›¾ï¼Œåªè®¾ç½®ä¸€ä¸ªå­— æ®µï¼Œä¸»é”®ï¼Œè‡ªå¢</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707193957629.png" alt="image-20220707193957629"  /><p>ç‚¹å‡»åº”ç”¨ï¼Œç„¶åè®¾ç½®Columnsï¼Œåªæ·»åŠ ä¸€ä¸ªå­—æ®µ</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194048843.png" alt="image-20220707194048843"  /><p>è¿™æ˜¯è®¾ç½®å­—æ®µé€’å¢ï¼Œå‰é¢å·²ç»å™è¿°è¿‡å¥½å‡ æ¬¡</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194111885.png" alt="image-20220707194111885"  /><p>è®¾ç½®å¥½åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æœ‰ç®­å¤´çš„ä¸€æ–¹æ˜¯ä¸€ï¼Œæ— ç®­å¤´çš„ä¸€æ–¹æ˜¯å¤šï¼Œå³ä¸€å¯¹å¤šçš„å¤šå¯¹ä¸€çš„å…³ç³» éœ€è¦ææ¸…æ¥šï¼Œå­¦ç”Ÿä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šè€å¸ˆï¼Œè€å¸ˆä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šå­¦ç”Ÿï¼Œæ‰€ä»¥å­¦ç”Ÿå’Œè€å¸ˆéƒ½å¯ä»¥æ˜¯ä¸»ä½“ï¼›</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194138137.png" alt="image-20220707194138137"  /><p>å¯ä»¥çœ‹åˆ°æ·»åŠ å…³ç³»ä»¥åå­¦ç”Ÿå’Œæ•™å¸ˆçš„å…³ç³»è¡¨å‰åå‘ç”Ÿçš„å˜åŒ–</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194158936.png" alt="image-20220707194158936"  /><h3 id="10-4-æ¦‚å¿µæ¨¡å‹è½¬ä¸ºç‰©ç†æ¨¡å‹">10.4 æ¦‚å¿µæ¨¡å‹è½¬ä¸ºç‰©ç†æ¨¡å‹</h3><p>1ï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºå…ˆæ‰“å¼€æ¦‚å¿µæ¨¡å‹å›¾ï¼Œç„¶åç‚¹å‡»Tool,å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194228064.png" alt="image-20220707194228064"></p><p>ç‚¹å¼€çš„é¡µé¢å¦‚ä¸‹æ‰€ç¤ºï¼Œnameå’Œcodeå·²ç»ä»æ¦‚å¿µæ¨¡å‹1æ”¹æˆç‰©ç†æ¨¡å‹1äº†</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194248236.png" alt="image-20220707194248236"></p><p>å®Œæˆåå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°†è‡ªè¡Œæ‰“å¼€ä¿®æ”¹çš„ç‰©ç†æ¨¡å‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™äº›è¡¨çš„æ•°æ®ç±»å‹å·²ç»è‡ªè¡Œæ”¹å˜äº†ï¼Œè€Œ ä¸”ä¸­é—´è¡¨å‡ºç°ä¸¤ä¸ªä¸»é”®ï¼Œå³åŒä¸»é”®</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194308595.png" alt="image-20220707194308595"></p><h3 id="10-5-ç‰©ç†æ¨¡å‹è½¬ä¸ºæ¦‚å¿µæ¨¡å‹">10.5 ç‰©ç†æ¨¡å‹è½¬ä¸ºæ¦‚å¿µæ¨¡å‹</h3><p>ä¸Šé¢ä»‹ç»äº†æ¦‚å¿µæ¨¡å‹è½¬ç‰©ç†æ¨¡å‹ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹ç‰©ç†æ¨¡å‹è½¬æ¦‚å¿µæ¨¡å‹ï¼ˆå¦‚ä¸‹å›¾ç‚¹å‡»æ“ä½œå³å¯ï¼‰</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194405358.png" alt="image-20220707194405358"></p><p>ç„¶åå‡ºç°å¦‚ä¸‹å›¾æ‰€ç¤ºç•Œé¢ï¼Œç„¶åå°†ç‰©ç†ä¿®æ”¹ä¸ºæ¦‚å¿µ ï¼Œç‚¹å‡»åº”ç”¨ç¡®è®¤å³å¯</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194419360.png" alt="image-20220707194419360"></p><p>ç‚¹å‡»ç¡®è®¤åå°†è‡ªè¡Œæ‰“å¼€å¦‚ä¸‹å›¾æ‰€ç¤ºçš„é¡µé¢ï¼Œè‡ªå·±è§‚å¯Ÿæœ‰ä½•å˜åŒ–ï¼Œå¦‚æœè½¬æ¢ä¸ºoracleçš„ï¼Œæ•°æ®ç±»å‹ä¼šå‘ç”Ÿå˜ åŒ–ï¼Œæ¯”å¦‚Varchar2ç­‰ç­‰ï¼‰ï¼›</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194433407.png" alt="image-20220707194433407"></p><h3 id="10-6-ç‰©ç†æ¨¡å‹å¯¼å‡ºSQLè¯­å¥">10.6 ç‰©ç†æ¨¡å‹å¯¼å‡ºSQLè¯­å¥</h3><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194544714.png" alt="image-20220707194544714"></p><p>æ‰“å¼€ä¹‹åå¦‚å›¾æ‰€ç¤ºï¼Œä¿®æ”¹å¥½å­˜åœ¨sqlè¯­å¥çš„ä½ç½®å’Œç”Ÿæˆæ–‡ä»¶çš„åç§°å³å¯</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194557554.png" alt="image-20220707194557554"></p><p>åœ¨Selectionä¸­é€‰æ‹©éœ€è¦å¯¼å‡ºçš„è¡¨ï¼Œç„¶åç‚¹å‡»åº”ç”¨å’Œç¡®è®¤å³å¯</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194637242.png" alt="image-20220707194637242"></p><p>å®Œæˆä»¥åå‡ºç°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥ç‚¹å‡»Editæˆ–è€…closeæŒ‰é’®</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220707194727849.png" alt="image-20220707194727849"></p><p>è‡ªæ­¤ï¼Œå°±å®Œæˆäº†å¯¼å‡ºsqlè¯­å¥ï¼Œå°±å¯ä»¥åˆ°è‡ªå·±æŒ‡å®šçš„ä½ç½®æŸ¥çœ‹å¯¼å‡ºçš„sqlè¯­å¥äº†ï¼›PowerDesigneråœ¨ä»¥ååœ¨ é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ç”¨æ¥åšéœ€æ±‚åˆ†æå’Œæ•°æ®åº“çš„è®¾è®¡éå¸¸çš„æ–¹ä¾¿å’Œå¿«æ·ã€‚</p>]]></content>
    
    
    <summary type="html">èŒƒå¼ã€åèŒƒå¼ã€ERæ¨¡å‹ã€æ•°æ®åº“è®¾è®¡åŸåˆ™</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>ç´¢å¼•å¤±æ•ˆä¸æŸ¥è¯¢ä¼˜åŒ–</title>
    <link href="https://wuwawawa.github.io/posts/ec3a9a87.html"/>
    <id>https://wuwawawa.github.io/posts/ec3a9a87.html</id>
    <published>2023-04-12T00:00:00.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<p>éƒ½æœ‰å“ªäº›ç»´åº¦å¯ä»¥è¿›è¡Œæ•°æ®åº“è°ƒä¼˜ï¼Ÿç®€è¨€ä¹‹ï¼š</p><ul><li>ç´¢å¼•å¤±æ•ˆã€æ²¡æœ‰å……åˆ†åˆ©ç”¨åˆ°ç´¢å¼•â€”â€”å»ºç«‹ç´¢å¼•</li><li>å…³è”æŸ¥è¯¢å¤ªå¤šJOINï¼ˆè®¾è®¡ç¼ºé™·æˆ–ä¸å¾—å·²çš„éœ€æ±‚ï¼‰â€”â€”SQLä¼˜åŒ–</li><li>æœåŠ¡å™¨è°ƒä¼˜åŠå„ä¸ªå‚æ•°è®¾ç½®ï¼ˆç¼“å†²ã€çº¿ç¨‹æ•°ç­‰ï¼‰â€”â€”è°ƒæ•´my.cnf</li><li>æ•°æ®è¿‡å¤šâ€”â€”åˆ†åº“åˆ†è¡¨</li></ul><p>å…³äºæ•°æ®åº“è°ƒä¼˜çš„çŸ¥è¯†éå¸¸åˆ†æ•£ã€‚ä¸åŒçš„DBMSï¼Œä¸åŒçš„å…¬å¸ï¼Œä¸åŒçš„èŒä½ï¼Œä¸åŒçš„é¡¹ç›®é‡åˆ°çš„é—®é¢˜éƒ½ä¸å°½ç›¸åŒã€‚è¿™é‡Œæˆ‘ä»¬åˆ†ä¸ºä¸‰ä¸ªç« èŠ‚è¿›è¡Œç»†è‡´è®²è§£ã€‚</p><p>è™½ç„¶SQLæŸ¥è¯¢ä¼˜åŒ–çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å¤§æ–¹å‘ä¸Šå®Œå…¨å¯ä»¥åˆ†æˆ<code>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–</code>å’Œ<code>é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–</code>ä¸¤å¤§å—ã€‚</p><ul><li>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–æ˜¯é€šè¿‡<code>ç´¢å¼•</code>å’Œ<code>è¡¨è¿æ¥æ–¹å¼</code>ç­‰æŠ€æœ¯æ¥è¿›è¡Œä¼˜åŒ–ï¼Œè¿™é‡Œé‡ç‚¹éœ€è¦æŒæ¡ç´¢å¼•çš„ä½¿ç”¨ã€‚</li><li>é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–å°±æ˜¯é€šè¿‡SQL<code>ç­‰ä»·å˜æ¢</code>æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œç›´ç™½ä¸€ç‚¹å°±æ˜¯è¯´ï¼Œæ¢ä¸€ç§æŸ¥è¯¢å†™æ³•æ•ˆç‡å¯èƒ½æ›´é«˜ã€‚</li></ul><hr><h2 id="1-æ•°æ®å‡†å¤‡">1. æ•°æ®å‡†å¤‡</h2><div class="tabs" id="06aba016-1b98-4fdf-aa5a-0362d8823a19"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#06aba016-1b98-4fdf-aa5a-0362d8823a19-1"><i class="fas fa-bug"></i>æ­¥éª¤1</button></li><li class="tab"><button type="button" data-href="#06aba016-1b98-4fdf-aa5a-0362d8823a19-2"><i class="fas fa-cannabis"></i>æ­¥éª¤2</button></li><li class="tab"><button type="button" data-href="#06aba016-1b98-4fdf-aa5a-0362d8823a19-3"><i class="fas fa-candy-cane"></i>æ­¥éª¤3</button></li><li class="tab"><button type="button" data-href="#06aba016-1b98-4fdf-aa5a-0362d8823a19-4"><i class="fas fa-child"></i>æ­¥éª¤4</button></li><li class="tab"><button type="button" data-href="#06aba016-1b98-4fdf-aa5a-0362d8823a19-5"><i class="fas fa-cat"></i>æ­¥éª¤5</button></li><li class="tab"><button type="button" data-href="#06aba016-1b98-4fdf-aa5a-0362d8823a19-6"><i class="fas fa-horse"></i>æ­¥éª¤6</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="06aba016-1b98-4fdf-aa5a-0362d8823a19-1"><blockquote><p>å»ºè¡¨</p></blockquote><p><code>å­¦å‘˜è¡¨</code>æ’<code>50ä¸‡</code>æ¡ï¼Œ<code>ç­çº§è¡¨</code>æ’<code>1ä¸‡</code>æ¡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE atguigudb2;</span><br><span class="line">USE atguigudb2;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`class`(</span><br><span class="line">  `id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `className`<span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `address`<span class="type">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `monitor`<span class="type">INT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`student`(</span><br><span class="line">  `id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `stuno`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">  `name`<span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age`<span class="type">INT</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `classId`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">    #<span class="keyword">CONSTRAINT</span>`fk_class_id`<span class="keyword">FOREIGN</span> KEY (`classId`) <span class="keyword">REFERENCES</span>`t_class`(`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="06aba016-1b98-4fdf-aa5a-0362d8823a19-2"><blockquote><p>è®¾ç½®å‚æ•°</p></blockquote><ul><li>å‘½ä»¤å¼€å¯ï¼šå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>; # ä¸åŠ <span class="keyword">global</span>åªæ˜¯å½“å‰çª—å£æœ‰æ•ˆã€‚</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="06aba016-1b98-4fdf-aa5a-0362d8823a19-3"><blockquote><p>åˆ›å»ºå‡½æ•°</p></blockquote><p>ä¿è¯æ¯æ¡æ•°æ®éƒ½ä¸åŒã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#éšæœºäº§ç”Ÿå­—ç¬¦ä¸²</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_string(n <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span></span><br><span class="line"><span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> return_str <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">WHILE i <span class="operator">&lt;</span> n DO</span><br><span class="line"><span class="keyword">SET</span> return_str <span class="operator">=</span>CONCAT(return_str,<span class="built_in">SUBSTRING</span>(chars_str,<span class="built_in">FLOOR</span>(<span class="number">1</span><span class="operator">+</span>RAND()<span class="operator">*</span><span class="number">52</span>),<span class="number">1</span>));</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line">#å‡å¦‚è¦åˆ é™¤</span><br><span class="line">#<span class="keyword">drop</span> <span class="keyword">function</span> rand_string;</span><br></pre></td></tr></table></figure><p>éšæœºäº§ç”Ÿç­çº§ç¼–å·</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#ç”¨äºéšæœºäº§ç”Ÿå¤šå°‘åˆ°å¤šå°‘çš„ç¼–å·</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_num (from_num <span class="type">INT</span> ,to_num <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">INT</span>(<span class="number">11</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> <span class="built_in">FLOOR</span>(from_num <span class="operator">+</span>RAND()<span class="operator">*</span>(to_num <span class="operator">-</span> from_num<span class="operator">+</span><span class="number">1</span>)) ;</span><br><span class="line"><span class="keyword">RETURN</span> i;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line">#å‡å¦‚è¦åˆ é™¤</span><br><span class="line">#<span class="keyword">drop</span> <span class="keyword">function</span> rand_num;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="06aba016-1b98-4fdf-aa5a-0362d8823a19-4"><blockquote><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºå¾€stuè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_stu( <span class="keyword">START</span> <span class="type">INT</span> , max_num <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">REPEAT #å¾ªç¯</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; #èµ‹å€¼</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student (stuno, name ,age ,classId ) <span class="keyword">VALUES</span></span><br><span class="line">((<span class="keyword">START</span><span class="operator">+</span>i),rand_string(<span class="number">6</span>),rand_num(<span class="number">1</span>,<span class="number">50</span>),rand_num(<span class="number">1</span>,<span class="number">1000</span>));</span><br><span class="line">UNTIL i <span class="operator">=</span> max_num</span><br><span class="line"><span class="keyword">END</span> REPEAT;</span><br><span class="line"><span class="keyword">COMMIT</span>; #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line">#å‡å¦‚è¦åˆ é™¤</span><br><span class="line">#<span class="keyword">drop</span> <span class="keyword">PROCEDURE</span> insert_stu;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¾€classè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€classè¡¨æ·»åŠ éšæœºæ•°æ®</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span>`insert_class`( max_num <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">REPEAT</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> class ( classname,address,monitor ) <span class="keyword">VALUES</span></span><br><span class="line">(rand_string(<span class="number">8</span>),rand_string(<span class="number">10</span>),rand_num(<span class="number">1</span>,<span class="number">100000</span>));</span><br><span class="line">UNTIL i <span class="operator">=</span> max_num</span><br><span class="line"><span class="keyword">END</span> REPEAT;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line">#å‡å¦‚è¦åˆ é™¤</span><br><span class="line">#<span class="keyword">drop</span> <span class="keyword">PROCEDURE</span> insert_class;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="06aba016-1b98-4fdf-aa5a-0362d8823a19-5"><blockquote><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</p></blockquote><p>class</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€classè¡¨æ·»åŠ <span class="number">1</span>ä¸‡æ¡æ•°æ®</span><br><span class="line"><span class="keyword">CALL</span> insert_class(<span class="number">10000</span>);</span><br></pre></td></tr></table></figure><p>stu</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€stuè¡¨æ·»åŠ <span class="number">50</span>ä¸‡æ¡æ•°æ®</span><br><span class="line"><span class="keyword">CALL</span> insert_stu(<span class="number">100000</span>,<span class="number">500000</span>);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="06aba016-1b98-4fdf-aa5a-0362d8823a19-6"><blockquote><p>åˆ é™¤æŸè¡¨ä¸Šçš„ç´¢å¼• åç»­æ¼”ç¤ºè¿‡ç¨‹ä¸­å¯èƒ½ä¼šé¢‘ç¹åˆ é™¤ç´¢å¼• æ‰€ä»¥å®šä¹‰æ­¤å‡½æ•°</p></blockquote><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span>`proc_drop_index`(dbname <span class="type">VARCHAR</span>(<span class="number">200</span>),tablename <span class="type">VARCHAR</span>(<span class="number">200</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> ct <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> _index <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> _cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> index_name <span class="keyword">FROM</span></span><br><span class="line">information_schema.STATISTICS <span class="keyword">WHERE</span> table_schema<span class="operator">=</span>dbname <span class="keyword">AND</span> table_name<span class="operator">=</span>tablename <span class="keyword">AND</span></span><br><span class="line">seq_in_index<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> index_name <span class="operator">&lt;&gt;</span><span class="string">&#x27;PRIMARY&#x27;</span> ;</span><br><span class="line">#æ¯ä¸ªæ¸¸æ ‡å¿…é¡»ä½¿ç”¨ä¸åŒçš„<span class="keyword">declare</span> continue handler <span class="keyword">for</span> <span class="keyword">not</span> found <span class="keyword">set</span> done<span class="operator">=</span><span class="number">1</span>æ¥æ§åˆ¶æ¸¸æ ‡çš„ç»“æŸ</span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">set</span> done<span class="operator">=</span><span class="number">2</span> ;</span><br><span class="line">#è‹¥æ²¡æœ‰æ•°æ®è¿”å›,ç¨‹åºç»§ç»­,å¹¶å°†å˜é‡doneè®¾ä¸º<span class="number">2</span></span><br><span class="line">        <span class="keyword">OPEN</span> _cur;</span><br><span class="line">        <span class="keyword">FETCH</span> _cur <span class="keyword">INTO</span> _index;</span><br><span class="line">        WHILE _index<span class="operator">&lt;&gt;</span><span class="string">&#x27;&#x27;</span> DO</span><br><span class="line">            <span class="keyword">SET</span> <span class="variable">@str</span> <span class="operator">=</span> CONCAT(&quot;drop index &quot; , _index , &quot; on &quot; , tablename );</span><br><span class="line">            <span class="keyword">PREPARE</span> sql_str <span class="keyword">FROM</span> <span class="variable">@str</span> ;</span><br><span class="line">            <span class="keyword">EXECUTE</span> sql_str;</span><br><span class="line">            <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> sql_str;</span><br><span class="line">            <span class="keyword">SET</span> _index<span class="operator">=</span><span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">FETCH</span> _cur <span class="keyword">INTO</span> _index;</span><br><span class="line">        <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">CLOSE</span> _cur;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> proc_drop_index(&quot;dbname&quot;,&quot;tablename&quot;);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="2-ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹">2. ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹</h2><p>MySQLä¸­<code>æé«˜æ€§èƒ½</code>çš„ä¸€ä¸ªæœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯å¯¹æ•°æ®è¡¨<code>è®¾è®¡åˆç†çš„ç´¢å¼•</code>ã€‚ç´¢å¼•æä¾›äº†é«˜æ•ˆè®¿é—®æ•°æ®çš„æ–¹æ³•ï¼Œå¹¶ä¸”åŠ å¿«æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œå› æ­¤ç´¢å¼•å¯¹æŸ¥è¯¢çš„é€Ÿåº¦æœ‰ç€è‡³å…³é‡è¦çš„å½±å“ã€‚</p><ul><li><p>ä½¿ç”¨ç´¢å¼•å¯ä»¥<code>å¿«é€Ÿåœ°å®šä½</code>è¡¨ä¸­çš„æŸæ¡è®°å½•ï¼Œä»è€Œæé«˜æ•°æ®åº“æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œæé«˜æ•°æ®åº“çš„æ€§èƒ½ã€‚</p></li><li><p>å¦‚æœæŸ¥è¯¢æ—¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼ŒæŸ¥è¯¢è¯­å¥å°±ä¼š<code>æ‰«æè¡¨ä¸­çš„æ‰€æœ‰è®°å½•</code>ã€‚åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·æŸ¥è¯¢çš„é€Ÿåº¦ä¼šå¾ˆæ…¢ã€‚</p></li></ul><p>å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ï¼ˆé»˜è®¤ï¼‰é‡‡ç”¨<code>B+æ ‘</code>æ¥æ„å»ºç´¢å¼•ã€‚åªæ˜¯ç©ºé—´åˆ—ç±»å‹çš„ç´¢å¼•ä½¿ç”¨<code>R-</code>æ ‘ï¼Œå¹¶ä¸”MEMORYè¡¨è¿˜æ”¯æŒ<code>hash ç´¢å¼•</code>ã€‚</p><p>å…¶å®ï¼Œç”¨ä¸ç”¨ç´¢å¼•ï¼Œæœ€ç»ˆéƒ½æ˜¯ä¼˜åŒ–å™¨è¯´äº†ç®—ã€‚ä¼˜åŒ–å™¨æ˜¯åŸºäºä»€ä¹ˆçš„ä¼˜åŒ–å™¨ï¼ŸåŸºäº<code>costå¼€é”€ (CostBaseOptimizer)</code>ï¼Œå®ƒä¸æ˜¯åŸºäº<code>è§„åˆ™(Rule-Basedoptimizerï¼‰</code>ï¼Œä¹Ÿä¸æ˜¯åŸºäº<code>è¯­ä¹‰</code>ã€‚æ€ä¹ˆæ ·å¼€é”€å°å°±æ€ä¹ˆæ¥ã€‚å¦å¤–ï¼Œ<span class='p red'>SQLè¯­å¥æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œè·Ÿæ•°æ®åº“ç‰ˆæœ¬ã€æ•°æ®é‡ã€æ•°æ®é€‰æ‹©åº¦éƒ½æœ‰å…³ç³»ã€‚</span></p><div class="tabs" id="e9211a91-00fa-43d6-9499-a527e5d5888d"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-1"><i class="fas fa-atom"></i>1.å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-2"><i class="far fa-sun"></i>2.æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-3"><i class="fas fa-wind"></i>3.ä¸»é”®æ’å…¥é¡ºåº</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-4"><i class="fas fa-fire-alt"></i>è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-5"><i class="fas fa-award"></i>ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-6"><i class="fas fa-baseball-ball"></i>èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-7"><i class="fas fa-bone"></i>ä¸ç­‰äºç´¢å¼•å¤±æ•ˆ</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-8"><i class="fas fa-dragon"></i>is nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis not nullæ— æ³•ä½¿ç”¨ç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-9"><i class="fas fa-dove"></i>likeä»¥é€šé…ç¬¦%å¼€å¤´ç´¢å¼•å¤±æ•ˆ</button></li><li class="tab"><button type="button" data-href="#e9211a91-00fa-43d6-9499-a527e5d5888d-10"><i class="fas fa-horse"></i>ORå‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ç´¢å¼•å¤±æ•ˆ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="e9211a91-00fa-43d6-9499-a527e5d5888d-1"><p>ç³»ç»Ÿä¸­ç»å¸¸å‡ºç°çš„sqlè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span>;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span>;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å»ºç«‹ç´¢å¼•å‰æ‰§è¡Œï¼šï¼ˆå…³æ³¨æ‰§è¡Œæ—¶é—´ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.28</span> sec)</span><br></pre></td></tr></table></figure><p><strong>å»ºç«‹ç´¢å¼•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_age <span class="keyword">ON</span> student(age);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_classid <span class="keyword">ON</span> student(age,classId);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_classid_name <span class="keyword">ON</span> student(age,classId,name);</span><br></pre></td></tr></table></figure><p>å»ºç«‹ç´¢å¼•åæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºç´¢å¼•å‰çš„æŸ¥è¯¢æ—¶é—´æ˜¯ 0.28ç§’ï¼Œåˆ›å»ºç´¢å¼•åçš„æŸ¥è¯¢æ—¶é—´æ˜¯0.01 ç§’ï¼Œç´¢å¼•å¸®åŠ©æˆ‘ä»¬æå¤§çš„æé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-2"><p>åœ¨MySQLå»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€ä½³å·¦å‰ç¼€åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚</p><p>ä¸¾ä¾‹1ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> student.name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹2ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.classId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> student.name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹3ï¼šç´¢å¼•<code>idx_age_classid_name</code>è¿˜èƒ½å¦æ­£å¸¸ä½¿ç”¨ï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> student.age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> student.name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚<span class='p green'>ä¸SQLä¸­ANDé¡ºåºæ— å…³ï¼Œä¼˜åŒ–å™¨ä¼šä¼˜åŒ–ã€‚</span></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> student.name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704211116351.png" alt="image-20220704211116351"></p><p>è™½ç„¶å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯åªæœ‰éƒ¨åˆ†è¢«ä½¿ç”¨åˆ°äº†ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.classId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> student.name <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704211254581.png" alt="image-20220704211254581"></p><p>å®Œå…¨æ²¡æœ‰ä½¿ç”¨ä¸Šç´¢å¼•ã€‚</p><p>ç»“è®ºï¼šMySQLå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•å¯ä»¥åŒ…å«16ä¸ªå­—æ®µã€‚å¯¹äºå¤šåˆ—ç´¢å¼•ï¼Œ<span class='p red'>è¿‡æ»¤æ¡ä»¶è¦ä½¿ç”¨ç´¢å¼•å¿…é¡»æŒ‰ç…§ç´¢å¼•å»ºç«‹æ—¶çš„é¡ºåºï¼Œä¾æ¬¡æ»¡è¶³ï¼Œä¸€æ—¦è·³è¿‡æŸä¸ªå­—æ®µï¼Œç´¢å¼•åé¢çš„å­—æ®µéƒ½æ— æ³•è¢«ä½¿ç”¨ã€‚</span>å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰ç”¨è¿™äº›å­—æ®µä¸­ç¬¬ä¸€ä¸ªå­—æ®µæ—¶ï¼Œå¤šåˆ—ï¼ˆæˆ–è”åˆï¼‰ç´¢å¼•ä¸ä¼šè¢«ä½¿ç”¨ã€‚</p><blockquote><p>æ‹“å±•ï¼šAlibabaã€ŠJavaå¼€å‘æ‰‹å†Œã€‹</p><p>ç´¢å¼•æ–‡ä»¶å…·æœ‰ B-Tree çš„æœ€å·¦å‰ç¼€åŒ¹é…ç‰¹æ€§ï¼Œå¦‚æœå·¦è¾¹çš„å€¼æœªç¡®å®šï¼Œé‚£ä¹ˆæ— æ³•ä½¿ç”¨æ­¤ç´¢å¼•ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-3"><p>å¯¹äºä¸€ä¸ªä½¿ç”¨<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„åˆ›å»ºç´¢å¼•æ—¶ï¼Œè¡¨ä¸­çš„æ•°æ®å®é™…ä¸Šéƒ½æ˜¯å­˜å‚¨åœ¨<code>èšç°‡ç´¢å¼•</code>çš„å¶å­èŠ‚ç‚¹çš„ã€‚è€Œè®°å½•åˆæ˜¯å­˜å‚¨åœ¨æ•°æ®é¡µä¸­çš„ï¼Œæ•°æ®é¡µå’Œè®°å½•åˆæ˜¯æŒ‰ç…§è®°å½•<code>ä¸»é”®å€¼ä»å°åˆ°å¤§</code>çš„é¡ºåºè¿›è¡Œæ’åºï¼Œ æ‰€ä»¥å¦‚æœæˆ‘ä»¬æ’å…¥çš„è®°å½•çš„<code>ä¸»é”®å€¼æ˜¯ä¾æ¬¡å¢å¤§</code>çš„è¯ï¼Œé‚£æˆ‘ä»¬æ¯æ’æ»¡ä¸€ä¸ªæ•°æ®é¡µå°±æ¢åˆ°ä¸‹ä¸€ä¸ªæ•°æ®é¡µç»§ç»­æ’ï¼Œè€Œå¦‚æœæˆ‘ä»¬æ’å…¥çš„ä¸»é”®å€¼å¿½å¤§å¿½å°çš„è¯ï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œå‡è®¾æŸä¸ªæ•°æ®é¡µå­˜å‚¨çš„è®°å½•å·²ç»æ»¡äº†ï¼Œå®ƒå­˜å‚¨çš„ä¸»é”®å€¼åœ¨ 1~100ä¹‹é—´ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230411123722529.png" alt="image-20230411123722529"></p><p>å¦‚æœæ­¤æ—¶å†æ’å…¥ä¸€æ¡ä¸»é”®å€¼ä¸º 9 çš„è®°å½•ï¼Œé‚£å®ƒæ’å…¥çš„ä½ç½®å°±å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704212428607.png" alt="image-20220704212428607"></p><p>å¯è¿™ä¸ªæ•°æ®é¡µå·²ç»æ»¡äº†ï¼Œå†æ’è¿›æ¥å’‹åŠå‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦æŠŠå½“å‰<code>é¡µé¢åˆ†è£‚</code>æˆä¸¤ä¸ªé¡µé¢ï¼ŒæŠŠæœ¬é¡µä¸­çš„ä¸€äº›è®°å½•ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„è¿™ä¸ªé¡µä¸­ã€‚é¡µé¢åˆ†è£‚å’Œè®°å½•ç§»ä½æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ„å‘³ç€ï¼š<code>æ€§èƒ½æŸè€—</code>ï¼æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³å°½é‡é¿å…è¿™æ ·æ— è°“çš„æ€§èƒ½æŸè€—ï¼Œæœ€å¥½è®©æ’å…¥çš„è®°å½•çš„<code>ä¸»é”®å€¼ä¾æ¬¡é€’å¢</code>ï¼Œè¿™æ ·å°±ä¸ä¼šå‘ç”Ÿè¿™æ ·çš„æ€§èƒ½æŸè€—äº†ã€‚ æ‰€ä»¥æˆ‘ä»¬å»ºè®®ï¼šè®©ä¸»é”®å…·æœ‰<code>AUTO_INCREMENT</code>ï¼Œè®©å­˜å‚¨å¼•æ“è‡ªå·±ä¸ºè¡¨ç”Ÿæˆä¸»é”®ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ’å…¥ ï¼Œ æ¯”å¦‚ï¼š<code>person_info</code>è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person_info(</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    birthday <span class="type">DATE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    phone_number <span class="type">CHAR</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    country <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    KEY idx_name_birthday_phone_number (name(<span class="number">10</span>), birthday, phone_number)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸»é”®åˆ—<code>id</code>æ‹¥æœ‰<code>AUTO_INCREMENT</code>å±æ€§ï¼Œåœ¨æ’å…¥è®°å½•æ—¶å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬å¡«å…¥è‡ªå¢çš„ä¸»é”®å€¼ã€‚è¿™æ ·çš„ä¸»é”®å ç”¨ç©ºé—´å°ï¼Œé¡ºåºå†™å…¥ï¼Œå‡å°‘é¡µåˆ†è£‚ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-4"><ol><li>è¿™ä¸¤æ¡sqlå“ªç§å†™æ³•æ›´å¥½</li></ol>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span>;</span><br></pre></td></tr></table></figure>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(student.name,<span class="number">3</span>) <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»ºç´¢å¼•</li></ol>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> student(NAME);</span><br></pre></td></tr></table></figure><div class="tabs" id="5f71e3f3-b819-4070-a29c-d6d9664e2d12"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#5f71e3f3-b819-4070-a29c-d6d9664e2d12-1"><i class="fas fa-seedling"></i>ç¬¬ä¸€ç§ï¼šç´¢å¼•ä¼˜åŒ–ç”Ÿæ•ˆ</button></li><li class="tab"><button type="button" data-href="#5f71e3f3-b819-4070-a29c-d6d9664e2d12-2"><i class="fas fa-leaf"></i>ç¬¬äºŒç§ï¼šç´¢å¼•ä¼˜åŒ–å¤±æ•ˆ</button></li><li class="tab"><button type="button" data-href="#5f71e3f3-b819-4070-a29c-d6d9664e2d12-3"><i class="fab fa-apple"></i>å†ä¸¾ä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="5f71e3f3-b819-4070-a29c-d6d9664e2d12-1"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> stuno   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5301379</span> <span class="operator">|</span> <span class="number">1233401</span> <span class="operator">|</span> AbCHEa <span class="operator">|</span> <span class="number">164</span>  <span class="operator">|</span> <span class="number">259</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">7170042</span> <span class="operator">|</span> <span class="number">3102064</span> <span class="operator">|</span> ABcHeB <span class="operator">|</span> <span class="number">199</span>  <span class="operator">|</span> <span class="number">161</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1901614</span> <span class="operator">|</span> <span class="number">1833636</span> <span class="operator">|</span> ABcHeC <span class="operator">|</span> <span class="number">226</span>  <span class="operator">|</span> <span class="number">275</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5195021</span> <span class="operator">|</span> <span class="number">1127043</span> <span class="operator">|</span> abchEC <span class="operator">|</span> <span class="number">486</span>  <span class="operator">|</span> <span class="number">72</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4047089</span> <span class="operator">|</span> <span class="number">3810031</span> <span class="operator">|</span> AbCHFd <span class="operator">|</span> <span class="number">268</span>  <span class="operator">|</span> <span class="number">210</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4917074</span> <span class="operator">|</span> <span class="number">849096</span>  <span class="operator">|</span> ABcHfD <span class="operator">|</span> <span class="number">264</span>  <span class="operator">|</span> <span class="number">442</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1540859</span> <span class="operator">|</span> <span class="number">141979</span>  <span class="operator">|</span> abchFF <span class="operator">|</span> <span class="number">119</span>  <span class="operator">|</span> <span class="number">140</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5121801</span> <span class="operator">|</span> <span class="number">1053823</span> <span class="operator">|</span> AbCHFg <span class="operator">|</span> <span class="number">412</span>  <span class="operator">|</span> <span class="number">327</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2441254</span> <span class="operator">|</span> <span class="number">2373276</span> <span class="operator">|</span> abchFJ <span class="operator">|</span> <span class="number">170</span>  <span class="operator">|</span> <span class="number">362</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">7039146</span> <span class="operator">|</span> <span class="number">2971168</span> <span class="operator">|</span> ABcHgI <span class="operator">|</span> <span class="number">502</span>  <span class="operator">|</span> <span class="number">465</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1636826</span> <span class="operator">|</span> <span class="number">1580286</span> <span class="operator">|</span> ABcHgK <span class="operator">|</span> <span class="number">71</span>   <span class="operator">|</span> <span class="number">262</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">374344</span>  <span class="operator">|</span> <span class="number">474345</span>  <span class="operator">|</span> abchHL <span class="operator">|</span> <span class="number">367</span>  <span class="operator">|</span> <span class="number">212</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1596534</span> <span class="operator">|</span> <span class="number">169191</span>  <span class="operator">|</span> AbCHHl <span class="operator">|</span> <span class="number">102</span>  <span class="operator">|</span> <span class="number">146</span> <span class="operator">|</span></span><br><span class="line">...</span><br><span class="line"><span class="operator">|</span> <span class="number">5266837</span> <span class="operator">|</span> <span class="number">1198859</span> <span class="operator">|</span> abclXe <span class="operator">|</span> <span class="number">292</span> <span class="operator">|</span> <span class="number">298</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">8126968</span> <span class="operator">|</span> <span class="number">4058990</span> <span class="operator">|</span> aBClxE <span class="operator">|</span> <span class="number">316</span> <span class="operator">|</span> <span class="number">150</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4298305</span> <span class="operator">|</span> <span class="number">399962</span>  <span class="operator">|</span> AbCLXF <span class="operator">|</span> <span class="number">72</span>  <span class="operator">|</span> <span class="number">423</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5813628</span> <span class="operator">|</span> <span class="number">1745650</span> <span class="operator">|</span> aBClxF <span class="operator">|</span> <span class="number">356</span> <span class="operator">|</span> <span class="number">323</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6980448</span> <span class="operator">|</span> <span class="number">2912470</span> <span class="operator">|</span> AbCLXF <span class="operator">|</span> <span class="number">107</span> <span class="operator">|</span> <span class="number">78</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">7881979</span> <span class="operator">|</span> <span class="number">3814001</span> <span class="operator">|</span> AbCLXF <span class="operator">|</span> <span class="number">89</span>  <span class="operator">|</span> <span class="number">497</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4955576</span> <span class="operator">|</span> <span class="number">887598</span>  <span class="operator">|</span> ABcLxg <span class="operator">|</span> <span class="number">121</span> <span class="operator">|</span> <span class="number">385</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3653460</span> <span class="operator">|</span> <span class="number">3585482</span> <span class="operator">|</span> AbCLXJ <span class="operator">|</span> <span class="number">130</span> <span class="operator">|</span> <span class="number">174</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1231990</span> <span class="operator">|</span> <span class="number">1283439</span> <span class="operator">|</span> AbCLYH <span class="operator">|</span> <span class="number">189</span> <span class="operator">|</span> <span class="number">429</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6110615</span> <span class="operator">|</span> <span class="number">2042637</span> <span class="operator">|</span> ABcLyh <span class="operator">|</span> <span class="number">157</span> <span class="operator">|</span> <span class="number">40</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="number">401</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5f71e3f3-b819-4070-a29c-d6d9664e2d12-2"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(student.name,<span class="number">3</span>) <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704214905412.png" alt="image-20220704214905412"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(student.name,<span class="number">3</span>) <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> stuno   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5301379</span> <span class="operator">|</span> <span class="number">1233401</span> <span class="operator">|</span> AbCHEa <span class="operator">|</span> <span class="number">164</span> <span class="operator">|</span> <span class="number">259</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">7170042</span> <span class="operator">|</span> <span class="number">3102064</span> <span class="operator">|</span> ABcHeB <span class="operator">|</span> <span class="number">199</span> <span class="operator">|</span> <span class="number">161</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1901614</span> <span class="operator">|</span> <span class="number">1833636</span> <span class="operator">|</span> ABcHeC <span class="operator">|</span> <span class="number">226</span> <span class="operator">|</span> <span class="number">275</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5195021</span> <span class="operator">|</span> <span class="number">1127043</span> <span class="operator">|</span> abchEC <span class="operator">|</span> <span class="number">486</span> <span class="operator">|</span> <span class="number">72</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4047089</span> <span class="operator">|</span> <span class="number">3810031</span> <span class="operator">|</span> AbCHFd <span class="operator">|</span> <span class="number">268</span> <span class="operator">|</span> <span class="number">210</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4917074</span> <span class="operator">|</span> <span class="number">849096</span>  <span class="operator">|</span> ABcHfD <span class="operator">|</span> <span class="number">264</span> <span class="operator">|</span> <span class="number">442</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1540859</span> <span class="operator">|</span> <span class="number">141979</span>  <span class="operator">|</span> abchFF <span class="operator">|</span> <span class="number">119</span> <span class="operator">|</span> <span class="number">140</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5121801</span> <span class="operator">|</span> <span class="number">1053823</span> <span class="operator">|</span> AbCHFg <span class="operator">|</span> <span class="number">412</span> <span class="operator">|</span> <span class="number">327</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2441254</span> <span class="operator">|</span> <span class="number">2373276</span> <span class="operator">|</span> abchFJ <span class="operator">|</span> <span class="number">170</span> <span class="operator">|</span> <span class="number">362</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">7039146</span> <span class="operator">|</span> <span class="number">2971168</span> <span class="operator">|</span> ABcHgI <span class="operator">|</span> <span class="number">502</span> <span class="operator">|</span> <span class="number">465</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1636826</span> <span class="operator">|</span> <span class="number">1580286</span> <span class="operator">|</span> ABcHgK <span class="operator">|</span> <span class="number">71</span>  <span class="operator">|</span> <span class="number">262</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">374344</span>  <span class="operator">|</span> <span class="number">474345</span>  <span class="operator">|</span> abchHL <span class="operator">|</span> <span class="number">367</span> <span class="operator">|</span> <span class="number">212</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1596534</span> <span class="operator">|</span> <span class="number">169191</span>  <span class="operator">|</span> AbCHHl <span class="operator">|</span> <span class="number">102</span> <span class="operator">|</span> <span class="number">146</span> <span class="operator">|</span></span><br><span class="line">...</span><br><span class="line"><span class="operator">|</span> <span class="number">5266837</span> <span class="operator">|</span> <span class="number">1198859</span> <span class="operator">|</span> abclXe <span class="operator">|</span> <span class="number">292</span> <span class="operator">|</span> <span class="number">298</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">8126968</span> <span class="operator">|</span> <span class="number">4058990</span> <span class="operator">|</span> aBClxE <span class="operator">|</span> <span class="number">316</span> <span class="operator">|</span> <span class="number">150</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4298305</span> <span class="operator">|</span> <span class="number">399962</span>  <span class="operator">|</span> AbCLXF <span class="operator">|</span> <span class="number">72</span>  <span class="operator">|</span> <span class="number">423</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5813628</span> <span class="operator">|</span> <span class="number">1745650</span> <span class="operator">|</span> aBClxF <span class="operator">|</span> <span class="number">356</span> <span class="operator">|</span> <span class="number">323</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6980448</span> <span class="operator">|</span> <span class="number">2912470</span> <span class="operator">|</span> AbCLXF <span class="operator">|</span> <span class="number">107</span> <span class="operator">|</span> <span class="number">78</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">7881979</span> <span class="operator">|</span> <span class="number">3814001</span> <span class="operator">|</span> AbCLXF <span class="operator">|</span> <span class="number">89</span>  <span class="operator">|</span> <span class="number">497</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4955576</span> <span class="operator">|</span> <span class="number">887598</span>  <span class="operator">|</span> ABcLxg <span class="operator">|</span> <span class="number">121</span> <span class="operator">|</span> <span class="number">385</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3653460</span> <span class="operator">|</span> <span class="number">3585482</span> <span class="operator">|</span> AbCLXJ <span class="operator">|</span> <span class="number">130</span> <span class="operator">|</span> <span class="number">174</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1231990</span> <span class="operator">|</span> <span class="number">1283439</span> <span class="operator">|</span> AbCLYH <span class="operator">|</span> <span class="number">189</span> <span class="operator">|</span> <span class="number">429</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6110615</span> <span class="operator">|</span> <span class="number">2042637</span> <span class="operator">|</span> ABcLyh <span class="operator">|</span> <span class="number">157</span> <span class="operator">|</span> <span class="number">40</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="number">401</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">3.62</span> sec)</span><br></pre></td></tr></table></figure><p>typeä¸ºâ€œALLâ€ï¼Œè¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶é—´ä¸º 3.62 ç§’ï¼ŒæŸ¥è¯¢æ•ˆç‡è¾ƒä¹‹å‰ä½å¾ˆå¤šã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5f71e3f3-b819-4070-a29c-d6d9664e2d12-3"><ul><li>studentè¡¨çš„å­—æ®µstunoä¸Šè®¾ç½®æœ‰ç´¢å¼•</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_sno <span class="keyword">ON</span> student(stuno);</span><br></pre></td></tr></table></figure><ul><li>ç´¢å¼•ä¼˜åŒ–å¤±æ•ˆï¼šï¼ˆå‡è®¾ï¼šstudentè¡¨çš„å­—æ®µstunoä¸Šè®¾ç½®æœ‰ç´¢å¼•ï¼‰</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE id, stuno, NAME <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno<span class="operator">+</span><span class="number">1</span> <span class="operator">=</span> <span class="number">900001</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704215159768.png" alt="image-20220704215159768"></p><ul><li>ç´¢å¼•ä¼˜åŒ–ç”Ÿæ•ˆï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE id, stuno, NAME <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> <span class="number">900000</span>;</span><br></pre></td></tr></table></figure><p><strong>å†ä¸¾ä¾‹ï¼š</strong></p><ul><li>studentè¡¨çš„å­—æ®µnameä¸Šè®¾ç½®æœ‰ç´¢å¼•</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> student(NAME);</span><br></pre></td></tr></table></figure> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> id, stuno, name <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="built_in">SUBSTRING</span>(name, <span class="number">1</span>,<span class="number">3</span>)<span class="operator">=</span><span class="string">&#x27;abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704215533871.png" alt="image-20220704215533871"></p><ul><li>ç´¢å¼•ä¼˜åŒ–ç”Ÿæ•ˆ</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> id, stuno, NAME <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704215600507.png" alt="image-20220704215600507"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-5"><p>ä¸‹åˆ—å“ªä¸ªsqlè¯­å¥å¯ä»¥ç”¨åˆ°ç´¢å¼•ã€‚ï¼ˆå‡è®¾nameå­—æ®µä¸Šè®¾ç½®æœ‰ç´¢å¼•ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æœªä½¿ç”¨åˆ°ç´¢å¼•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="number">123</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704215658526.png" alt="image-20220704215658526"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨åˆ°ç´¢å¼•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704215721216.png" alt="image-20220704215721216"></p><p>name=123å‘ç”Ÿç±»å‹è½¬æ¢ï¼Œç´¢å¼•å¤±æ•ˆã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-6"><ol><li>ç³»ç»Ÿç»å¸¸å‡ºç°çš„sqlå¦‚ä¸‹ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">DROP</span> INDEX idx_name;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">DROP</span> INDEX idx_age;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">DROP</span> INDEX idx_age_classid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_classid_name <span class="keyword">ON</span> student (age, classId, NAME);</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> student.classId<span class="operator">&gt;</span><span class="number">20</span> <span class="keyword">AND</span> student.name <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span> ;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20190704220123647.png" alt="image-20220704220123647"></p><p>key_len=10 åªç”¨ä¸Šäº†ä¸¤ä¸ªint+2NULL  ageå’Œclassidï¼Œnameå¤±æ•ˆ</p><blockquote><p>è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆèŒƒå›´æŸ¥è¯¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼š</p><p>ä¾‹å¦‚ï¼ša_b_cè¿™ä¸ªç´¢å¼•ï¼Œä½ æ ¹æ®bèŒƒå›´æŸ¥æ‰¾&gt;2çš„</p><p>å› ä¸ºæ ¹æ®èŒƒå›´æŸ¥æ‰¾ç­›é€‰åçš„æ•°æ®ï¼Œæ— æ³•ä¿è¯èŒƒå›´æŸ¥æ‰¾åé¢çš„å­—æ®µæ˜¯æœ‰åºçš„</p></blockquote><ol start="2"><li>é‚£ä¹ˆç´¢å¼• idx_age_classId_name è¿™ä¸ªç´¢å¼•è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ä¹ˆï¼Ÿ</li></ol><ul><li>ä¸èƒ½ï¼ŒèŒƒå›´å³è¾¹çš„åˆ—ä¸èƒ½ä½¿ç”¨ã€‚æ¯”å¦‚ï¼š(&lt;) (&lt;=) (&gt;) (&gt;=) å’Œ between ç­‰</li><li>å¦‚æœè¿™ç§sqlå‡ºç°è¾ƒå¤šï¼Œåº”è¯¥å»ºç«‹ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_age_name_classId <span class="keyword">on</span> student(age,name,classId);</span><br></pre></td></tr></table></figure><ul><li>å°†èŒƒå›´æŸ¥è¯¢æ¡ä»¶æ”¾ç½®è¯­å¥æœ€åï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> student.name <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">AND</span> student.classId<span class="operator">&gt;</span><span class="number">20</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åº”ç”¨å¼€å‘ä¸­èŒƒå›´æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼šé‡‘é¢æŸ¥è¯¢ï¼Œæ—¥æœŸæŸ¥è¯¢å¾€å¾€éƒ½æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚ï¼ˆåˆ›å»ºçš„è”åˆç´¢å¼•ä¸­ï¼ŒåŠ¡å¿…æŠŠèŒƒå›´æ¶‰åŠåˆ°çš„å­—æ®µå†™åœ¨æœ€åï¼‰</p></blockquote><ol start="3"><li>æ•ˆæœ</li></ol><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704223211981.png" alt="image-20220704223211981"></p><p>name varchar(20)   60+2+1</p><p>int  4+1</p><p>int  4+1</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-7"><ul><li>ä¸ºnameå­—æ®µåˆ›å»ºç´¢å¼•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> student(NAME);</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç´¢å¼•æ˜¯å¦å¤±æ•ˆ</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="operator">&lt;&gt;</span> <span class="string">&#x27;abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704224552374.png" alt="image-20220704224552374"></p><p>æˆ–è€…</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="operator">!=</span> <span class="string">&#x27;abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704224916117.png" alt="image-20220704224916117"></p><p>åœºæ™¯ä¸¾ä¾‹ï¼šç”¨æˆ·æå‡ºéœ€æ±‚ï¼Œå°†è´¢åŠ¡æ•°æ®ï¼Œäº§å“åˆ©æ¶¦é‡‘é¢ä¸ç­‰äº0çš„éƒ½ç»Ÿè®¡å‡ºæ¥ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-8"><ul><li>IS NULL: å¯ä»¥è§¦å‘ç´¢å¼•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><ul><li>IS NOT NULL: æ— æ³•è§¦å‘ç´¢å¼•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704225333199.png" alt="image-20220704225333199"></p><blockquote><p>ç»“è®ºï¼šæœ€å¥½åœ¨è®¾è®¡æ•°æ®åº“çš„æ—¶å€™å°±å°†<code>å­—æ®µè®¾ç½®ä¸º NOT NULL çº¦æŸ</code>ï¼Œæ¯”å¦‚ä½ å¯ä»¥å°† INT ç±»å‹çš„å­—æ®µï¼Œé»˜è®¤å€¼è®¾ç½®ä¸º0ã€‚å°†å­—ç¬¦ç±»å‹çš„é»˜è®¤å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²(â€˜â€™)ã€‚</p><p>æ‰©å±•ï¼šåŒç†ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨<code>not like</code>ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œå¯¼è‡´å…¨è¡¨æ‰«æã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-9"><p>åœ¨ä½¿ç”¨LIKEå…³é”®å­—è¿›è¡ŒæŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¦‚æœåŒ¹é…å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºâ€™%â€˜ï¼Œç´¢å¼•å°±ä¸ä¼šèµ·ä½œç”¨ã€‚åªæœ‰â€™%'ä¸åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œç´¢å¼•æ‰ä¼šèµ·ä½œç”¨ã€‚</p><ul><li>ä½¿ç”¨åˆ°ç´¢å¼•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;ab%&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705131643304.png" alt="image-20220705131643304"></p><ul><li>æœªä½¿ç”¨åˆ°ç´¢å¼•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%ab%&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705131717329.png" alt="image-20220705131717329"></p><blockquote><p>æ‹“å±•ï¼šAlibabaã€ŠJavaå¼€å‘æ‰‹å†Œã€‹</p><p>ã€å¼ºåˆ¶ã€‘é¡µé¢æœç´¢ä¸¥ç¦å·¦æ¨¡ç³Šæˆ–è€…å…¨æ¨¡ç³Šï¼Œå¦‚æœéœ€è¦è¯·èµ°æœç´¢å¼•æ“æ¥è§£å†³ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e9211a91-00fa-43d6-9499-a527e5d5888d-10"><p>åœ¨WHEREå­å¥ä¸­ï¼Œå¦‚æœåœ¨ORå‰çš„æ¡ä»¶åˆ—è¿›è¡Œäº†ç´¢å¼•ï¼Œè€Œåœ¨ORåçš„æ¡ä»¶åˆ—æ²¡æœ‰è¿›è¡Œç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ORå‰åçš„ä¸¤ä¸ªæ¡ä»¶ä¸­çš„åˆ—éƒ½æ˜¯ç´¢å¼•æ—¶ï¼ŒæŸ¥è¯¢ä¸­æ‰ä½¿ç”¨ç´¢å¼•ã€‚</strong></p><p>å› ä¸ºORçš„å«ä¹‰å°±æ˜¯ä¸¤ä¸ªåªè¦æ»¡è¶³ä¸€ä¸ªå³å¯ï¼Œå› æ­¤<code>åªæœ‰ä¸€ä¸ªæ¡ä»¶åˆ—è¿›è¡Œäº†ç´¢å¼•æ˜¯æ²¡æœ‰æ„ä¹‰çš„</code>ï¼Œåªè¦æœ‰æ¡ä»¶åˆ—æ²¡æœ‰è¿›è¡Œç´¢å¼•ï¼Œå°±ä¼šè¿›è¡Œ<code>å…¨è¡¨æ‰«æ</code>ï¼Œå› æ­¤æ‰€ä»¥çš„æ¡ä»¶åˆ—ä¹Ÿä¼šå¤±æ•ˆã€‚</p><p>æŸ¥è¯¢è¯­å¥ä½¿ç”¨ORå…³é”®å­—çš„æƒ…å†µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æœªä½¿ç”¨åˆ°ç´¢å¼•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> classid <span class="operator">=</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705132221045.png" alt="image-20220705132221045"></p><p>å› ä¸ºclassIdå­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¸Šè¿°æŸ¥è¯¢è¯­å¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ä½¿ç”¨åˆ°ç´¢å¼•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705132239232.png" alt="image-20220705132239232"></p><p>å› ä¸ºageå­—æ®µå’Œnameå­—æ®µä¸Šéƒ½æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¸­ä½¿ç”¨äº†ç´¢å¼•ã€‚ä½ èƒ½çœ‹åˆ°è¿™é‡Œä½¿ç”¨åˆ°äº†<code>index_merge</code>ï¼Œç®€å•æ¥è¯´index_mergeå°±æ˜¯å¯¹ageå’Œnameåˆ†åˆ«è¿›è¡Œäº†æ‰«æï¼Œç„¶åå°†è¿™ä¸¤ä¸ªç»“æœé›†è¿›è¡Œäº†åˆå¹¶ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯<code>é¿å…äº†å…¨è¡¨æ‰«æ</code>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <blockquote><p>æ³¨æ„ï¼šæ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4</p><p>ç»Ÿä¸€ä½¿ç”¨utf8mb4( 5.5.3ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒ)å…¼å®¹æ€§æ›´å¥½ï¼Œç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ã€‚ä¸ åŒçš„<code>å­—ç¬¦é›†</code>è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œ<code>è½¬æ¢</code>ä¼šé€ æˆç´¢å¼•å¤±æ•ˆã€‚</p></blockquote><p>ç»ƒä¹ ï¼šå‡è®¾å­˜åœ¨ç´¢å¼•index(a,b,c)</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705145225852.png" alt="image-20220705145225852"></p><p><strong>ä¸€èˆ¬æ€§å»ºè®®</strong></p><ul><li>å¯¹äºå•åˆ—ç´¢å¼•ï¼Œå°½é‡é€‰æ‹©é’ˆå¯¹å½“å‰queryè¿‡æ»¤æ€§æ›´å¥½çš„ç´¢å¼•</li><li>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå½“å‰queryä¸­è¿‡æ»¤æ€§æœ€å¥½çš„å­—æ®µåœ¨ç´¢å¼•å­—æ®µé¡ºåºä¸­ï¼Œä½ç½®è¶Šé å‰è¶Šå¥½ã€‚</li><li>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå°½é‡é€‰æ‹©èƒ½å¤Ÿå½“å‰queryä¸­whereå­å¥ä¸­æ›´å¤šçš„ç´¢å¼•ã€‚</li><li>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå¦‚æœæŸä¸ªå­—æ®µå¯èƒ½å‡ºç°èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œå°½é‡æŠŠè¿™ä¸ªå­—æ®µæ”¾åœ¨ç´¢å¼•æ¬¡åºçš„æœ€åé¢ã€‚</li></ul><p><strong>æ€»ä¹‹ï¼Œä¹¦å†™SQLè¯­å¥æ—¶ï¼Œå°½é‡é¿å…é€ æˆç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ</strong></p><hr><h2 id="3-å…³è”æŸ¥è¯¢ä¼˜åŒ–">3. å…³è”æŸ¥è¯¢ä¼˜åŒ–</h2><h3 id="1-æ•°æ®å‡†å¤‡-2">1 æ•°æ®å‡†å¤‡</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"># åˆ†ç±»</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>`type`(</span><br><span class="line">`id`<span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`card`<span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">);</span><br><span class="line">#å›¾ä¹¦</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>`book`(</span><br><span class="line">`bookid`<span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`card`<span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`bookid`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#å‘åˆ†ç±»è¡¨ä¸­æ·»åŠ <span class="number">20</span>æ¡è®°å½•</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>`type`(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"></span><br><span class="line">#å‘å›¾ä¹¦è¡¨ä¸­æ·»åŠ <span class="number">20</span>æ¡è®°å½•</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br></pre></td></tr></table></figure><hr><h3 id="3-2-é‡‡ç”¨å·¦å¤–è¿æ¥">3.2 é‡‡ç”¨å·¦å¤–è¿æ¥</h3><p>ä¸‹é¢å¼€å§‹ EXPLAIN åˆ†æ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span>`type`<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705160504018.png" alt="image-20220705160504018"></p><p>ç»“è®ºï¼štype æœ‰All</p><p>æ·»åŠ ç´¢å¼•ä¼˜åŒ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">ADD</span> INDEX Y (card); #ã€è¢«é©±åŠ¨è¡¨ã€‘ï¼Œå¯ä»¥é¿å…å…¨è¡¨æ‰«æ</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span>`type`<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705160935109.png" alt="image-20220705160935109"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬äºŒè¡Œçš„ type å˜ä¸ºäº† refï¼Œrows ä¹Ÿå˜æˆäº†ä¼˜åŒ–æ¯”è¾ƒæ˜æ˜¾ã€‚è¿™æ˜¯ç”±å·¦è¿æ¥ç‰¹æ€§å†³å®šçš„ã€‚LEFT JOIN æ¡ä»¶ç”¨äºç¡®å®šå¦‚ä½•ä»å³è¡¨æœç´¢è¡Œï¼Œå·¦è¾¹ä¸€å®šéƒ½æœ‰ï¼Œæ‰€ä»¥<code>å³è¾¹æ˜¯æˆ‘ä»¬çš„å…³é”®ç‚¹,ä¸€å®šéœ€è¦å»ºç«‹ç´¢å¼•</code>ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span>`type`<span class="keyword">ADD</span> INDEX X (card); #ã€é©±åŠ¨è¡¨ã€‘ï¼Œæ— æ³•é¿å…å…¨è¡¨æ‰«æ</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span>`type`<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705161243838.png" alt="image-20220705161243838"></p><p>æ¥ç€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX Y <span class="keyword">ON</span> book;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span>`type`<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705161515545.png" alt="image-20220705161515545"></p><hr><h3 id="3-3-é‡‡ç”¨å†…è¿æ¥">3.3 é‡‡ç”¨å†…è¿æ¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> index X <span class="keyword">on</span> type;</span><br><span class="line"><span class="keyword">drop</span> index Y <span class="keyword">on</span> book;ï¼ˆå¦‚æœå·²ç»åˆ é™¤äº†å¯ä»¥ä¸ç”¨å†æ‰§è¡Œè¯¥æ“ä½œï¼‰</span><br></pre></td></tr></table></figure><p>æ¢æˆ inner joinï¼ˆMySQLè‡ªåŠ¨é€‰æ‹©é©±åŠ¨è¡¨ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> type <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705161602362.png" alt="image-20220705161602362"></p><p>æ·»åŠ ç´¢å¼•ä¼˜åŒ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">ADD</span> INDEX Y (card);</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> type <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705161746184.png" alt="image-20220705161746184"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> type <span class="keyword">ADD</span> INDEX X (card);</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> type <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705161843558.png" alt="image-20220705161843558"></p><p>å¯¹äºå†…è¿æ¥æ¥è¯´ï¼Œ</p><ol><li><p>æŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥å†³å®šè°ä½œä¸ºé©±åŠ¨è¡¨ï¼Œè°ä½œä¸ºè¢«é©±åŠ¨è¡¨å‡ºç°çš„</p></li><li><span class='p green'>å¦‚æœè¡¨çš„è¿æ¥æ¡ä»¶ä¸­åªèƒ½æœ‰ä¸€ä¸ªå­—æ®µæœ‰ç´¢å¼•ï¼Œåˆ™æœ‰ç´¢å¼•çš„å­—æ®µæ‰€åœ¨çš„è¡¨ä¼šè¢«ä½œä¸ºè¢«é©±åŠ¨è¡¨ã€‚</span></li><li><p>åœ¨ä¸¤ä¸ªè¡¨çš„é“¾æ¥æ¡ä»¶éƒ½å­˜åœ¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¼šé€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ã€‚ â€œå°è¡¨é©±åŠ¨å¤§è¡¨â€</p></li></ol><p>æ¼”ç¤ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX X <span class="keyword">ON</span>`type`;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> TYPE <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure><p>äº¤æ¢äº†ä½ç½®</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705161929544.png" alt="image-20220705161929544"></p><p>æ¥ç€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span>`type`<span class="keyword">ADD</span> INDEX X (card);</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span>`type`<span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705162009145.png" alt="image-20220705162009145"></p><p>æ¥ç€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#å‘å›¾ä¹¦è¡¨ä¸­æ·»åŠ <span class="number">20</span>æ¡è®°å½•</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> (RAND() <span class="operator">*</span> <span class="number">20</span>)));</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">ADD</span> INDEX Y (card);</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span>`type`<span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span>`type`.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure><p>å‘ç°ï¼Œç”±äºbookè¡¨æ•°æ®å¤§äºtypeè¡¨æ•°æ®ï¼ŒMySQLé€‰æ‹©å°†bookä½œä¸ºè¢«é©±åŠ¨è¡¨ã€‚</p><hr><h3 id="3-4-joinè¯­å¥åŸç†">3.4 joinè¯­å¥åŸç†</h3><p>joinæ–¹å¼è¿æ¥å¤šä¸ªè¡¨ï¼Œæœ¬è´¨å°±æ˜¯å„ä¸ªè¡¨ä¹‹é—´æ•°æ®çš„å¾ªç¯åŒ¹é…ã€‚MySQL5.5ç‰ˆæœ¬ä¹‹å‰ï¼ŒMySQLåªæ”¯æŒä¸€ç§è¡¨é—´å…³è”æ–¹å¼ï¼Œå°±æ˜¯åµŒå¥—å¾ªç¯(Nested Loop Join)ã€‚å¦‚æœå…³è”è¡¨çš„æ•°æ®é‡å¾ˆå¤§ï¼Œåˆ™joinå…³è”çš„æ‰§è¡Œæ—¶é—´ä¼šå¾ˆé•¿ã€‚åœ¨MySQL5.5ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼ŒMySQLé€šè¿‡å¼•å…¥BNLJç®—æ³•æ¥ä¼˜åŒ–åµŒå¥—æ‰§è¡Œã€‚</p><div class="tabs" id="9fba7784-d8d4-46ae-8707-b7612bc1d72f"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#9fba7784-d8d4-46ae-8707-b7612bc1d72f-1"><i class="fas fa-cat"></i>é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨</button></li><li class="tab"><button type="button" data-href="#9fba7784-d8d4-46ae-8707-b7612bc1d72f-2"><i class="fas fa-horse"></i>ç®€å•åµŒå¥—å¾ªç¯è¿æ¥</button></li><li class="tab"><button type="button" data-href="#9fba7784-d8d4-46ae-8707-b7612bc1d72f-3"><i class="fas fa-dove"></i>ç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥</button></li><li class="tab"><button type="button" data-href="#9fba7784-d8d4-46ae-8707-b7612bc1d72f-4"><i class="fas fa-dragon"></i>å—åµŒå¥—å¾ªç¯è¿æ¥</button></li><li class="tab"><button type="button" data-href="#9fba7784-d8d4-46ae-8707-b7612bc1d72f-5"><i class="fas fa-tree"></i>Joinå°ç»“</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="9fba7784-d8d4-46ae-8707-b7612bc1d72f-1"><p>é©±åŠ¨è¡¨å°±æ˜¯ä¸»è¡¨ï¼Œè¢«é©±åŠ¨è¡¨å°±æ˜¯ä»è¡¨ã€éé©±åŠ¨è¡¨ã€‚</p><ul><li>å¯¹äºå†…è¿æ¥æ¥è¯´ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> A <span class="keyword">JOIN</span> B <span class="keyword">ON</span> ...</span><br></pre></td></tr></table></figure><p>Aä¸€å®šæ˜¯é©±åŠ¨è¡¨å—ï¼Ÿä¸ä¸€å®šï¼Œä¼˜åŒ–å™¨ä¼šæ ¹æ®ä½ æŸ¥è¯¢è¯­å¥åšä¼˜åŒ–ï¼Œå†³å®šå…ˆæŸ¥å“ªå¼ è¡¨ã€‚å…ˆæŸ¥è¯¢çš„é‚£å¼ è¡¨å°±æ˜¯é©±åŠ¨è¡¨ï¼Œåä¹‹å°±æ˜¯è¢«é©±åŠ¨è¡¨ã€‚é€šè¿‡explainå…³é”®å­—å¯ä»¥æŸ¥çœ‹ã€‚</p><ul><li>å¯¹äºå¤–è¿æ¥æ¥è¯´ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> A <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> B <span class="keyword">ON</span> ...</span><br><span class="line"># æˆ–</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> B <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> A <span class="keyword">ON</span> ... </span><br></pre></td></tr></table></figure><p>é€šå¸¸ï¼Œå¤§å®¶ä¼šè®¤ä¸ºAå°±æ˜¯é©±åŠ¨è¡¨ï¼ŒBå°±æ˜¯è¢«é©±åŠ¨è¡¨ã€‚ä½†ä¹Ÿæœªå¿…ã€‚æµ‹è¯•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> a(f1 <span class="type">INT</span>, f2 <span class="type">INT</span>, INDEX(f1)) ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> b(f1 <span class="type">INT</span>, f2 <span class="type">INT</span>) ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> a <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">4</span>),(<span class="number">5</span>,<span class="number">5</span>),(<span class="number">6</span>,<span class="number">6</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> b <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">4</span>),(<span class="number">5</span>,<span class="number">5</span>),(<span class="number">6</span>,<span class="number">6</span>),(<span class="number">7</span>,<span class="number">7</span>),(<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> b;</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> b <span class="keyword">ON</span>(a.f1<span class="operator">=</span>b.f1) <span class="keyword">WHERE</span> (a.f2<span class="operator">=</span>b.f2);</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230412102452266.png" alt="image-20230412102452266"></p><p>ä¼˜åŒ–å™¨æŠŠå¤–è¿æ¥ä¼˜åŒ–æˆä¸ºå†…è¿æ¥ï¼Œä¹‹åå°±ä¼˜åŒ–å™¨å¸®ä½ é€‰æ‹©å“ªä¸ªã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9fba7784-d8d4-46ae-8707-b7612bc1d72f-2"><p><span class='p green'>Simple Nested-Loop Join</span></p><p>ç®—æ³•ç›¸å½“ç®€å•ï¼Œä»è¡¨Aä¸­å–å‡ºä¸€æ¡æ•°æ®1ï¼Œéå†è¡¨Bï¼Œå°†åŒ¹é…åˆ°çš„æ•°æ®æ”¾åˆ°resultâ€¦ ä»¥æ­¤ç±»æ¨ï¼Œé©±åŠ¨è¡¨Aä¸­çš„æ¯ä¸€æ¡è®°å½•ä¸è¢«é©±åŠ¨è¡¨Bçš„è®°å½•è¿›è¡Œåˆ¤æ–­ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705165559127.png" alt="image-20220705165559127"></p><p>å¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œä»¥ä¸Šè¿°è¡¨Aæ•°æ®100æ¡ï¼Œè¡¨Bæ•°æ®1000æ¡è®¡ç®—ï¼Œåˆ™A*B=10ä¸‡æ¬¡ã€‚å¼€é”€ç»Ÿè®¡å¦‚ä¸‹:</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705165646252.png" alt="image-20220705165646252"></p><p>å½“ç„¶mysqlè‚¯å®šä¸ä¼šè¿™ä¹ˆç²—æš´çš„å»è¿›è¡Œè¡¨çš„è¿æ¥ï¼Œæ‰€ä»¥å°±å‡ºç°äº†åé¢çš„ä¸¤ç§å¯¹Nested-Loop Joinä¼˜åŒ–ç®—æ³•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9fba7784-d8d4-46ae-8707-b7612bc1d72f-3"><p><span class='p green'>Index Nested-Loop Join</span></p><p>Index Nested-Loop Joinå…¶ä¼˜åŒ–çš„æ€è·¯ä¸»è¦æ˜¯ä¸ºäº†<code>å‡å°‘å†…å­˜è¡¨æ•°æ®çš„åŒ¹é…æ¬¡æ•°</code>ï¼Œæ‰€ä»¥è¦æ±‚è¢«é©±åŠ¨è¡¨ä¸Šå¿…é¡»<code>æœ‰ç´¢å¼•</code>æ‰è¡Œã€‚é€šè¿‡å¤–å±‚è¡¨åŒ¹é…æ¡ä»¶ç›´æ¥ä¸å†…å±‚è¡¨ç´¢å¼•è¿›è¡ŒåŒ¹é…ï¼Œé¿å…å’Œå†…å­˜è¡¨çš„æ¯æ¡è®°å½•å»è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·æå¤§çš„å‡å°‘äº†å¯¹å†…å­˜è¡¨çš„åŒ¹é…æ¬¡æ•°ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705172315554.png" alt="image-20220705172315554"></p><p>é©±åŠ¨è¡¨ä¸­çš„æ¯æ¡è®°å½•é€šè¿‡è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•è¿›è¡Œè®¿é—®ï¼Œå› ä¸ºç´¢å¼•æŸ¥è¯¢çš„æˆæœ¬æ˜¯æ¯”è¾ƒå›ºå®šçš„ï¼Œæ•…mysqlä¼˜åŒ–å™¨éƒ½å€¾å‘äºä½¿ç”¨è®°å½•æ•°å°‘çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼ˆå¤–è¡¨ï¼‰ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705172650749.png" alt="image-20220705172650749"></p><p>å¦‚æœè¢«é©±åŠ¨è¡¨åŠ ç´¢å¼•ï¼Œæ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œä½†å¦‚æœç´¢å¼•ä¸æ˜¯ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥è¿˜å¾—è¿›è¡Œä¸€æ¬¡å›è¡¨æŸ¥è¯¢ã€‚ç›¸æ¯”ï¼Œè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•æ˜¯ä¸»é”®ç´¢å¼•ï¼Œæ•ˆç‡ä¼šæ›´é«˜ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9fba7784-d8d4-46ae-8707-b7612bc1d72f-4"><p><span class='p green'>Block Nested-Loop Join</span></p><p>å¦‚æœå­˜åœ¨ç´¢å¼•ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨indexçš„æ–¹å¼è¿›è¡Œjoinï¼Œå¦‚æœjoinçš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œè¢«é©±åŠ¨è¡¨è¦æ‰«æçš„æ¬¡æ•°å¤ªå¤šäº†ã€‚æ¯æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨ï¼Œå…¶è¡¨ä¸­çš„è®°å½•éƒ½ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†ä»é©±åŠ¨è¡¨ä¸­å–ä¸€æ¡ä¸å…¶åŒ¹é…ï¼ŒåŒ¹é…ç»“æŸåæ¸…é™¤å†…å­˜ï¼Œç„¶åå†ä»é©±åŠ¨è¡¨ä¸­åŠ è½½ä¸€æ¡è®°å½•ï¼Œç„¶åæŠŠè¢«é©±åŠ¨è¡¨çš„è®°å½•åœ¨åŠ è½½åˆ°å†…å­˜åŒ¹é…ï¼Œè¿™æ ·å‘¨è€Œå¤å§‹ï¼Œå¤§å¤§å¢åŠ äº†10çš„æ¬¡æ•°ã€‚ä¸ºäº†å‡å°‘è¢«é©±åŠ¨è¡¨çš„10æ¬¡æ•°ï¼Œå°±å‡ºç°äº†Block Nested-Loop Joinçš„æ–¹å¼ã€‚</p><p>ä¸å†æ˜¯é€æ¡è·å–é©±åŠ¨è¡¨çš„æ•°æ®ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—çš„è·å–ï¼Œå¼•å…¥äº†<code>join bufferç¼“å†²åŒº</code>ï¼Œå°†é©±åŠ¨è¡¨joinç›¸å…³çš„éƒ¨åˆ†æ•°æ®åˆ—(å¤§å°å—join bufferçš„é™åˆ¶ç¼“å­˜åˆ°join buferä¸­ï¼Œç„¶åå…¨è¡¨æ‰«æè¢«é©±åŠ¨è¡¨ï¼Œè¢«é©±åŠ¨è¡¨çš„æ¯ä¸€æ¡è®°å½•ä¸€æ¬¡æ€§å’Œjoin bufferä¸­çš„æ‰€æœ‰é©±åŠ¨è¡¨è®°å½•è¿›è¡ŒåŒ¹é…ï¼ˆå†…å­˜ä¸­æ“ä½œï¼‰ï¼Œå°†ç®€å•åµŒå¥—å¾ªç¯ä¸­çš„å¤šæ¬¡æ¯”è¾ƒåˆå¹¶æˆä¸€æ¬¡ï¼Œé™ä½äº†è¢«é©±åŠ¨è¡¨çš„è®¿é—®é¢‘ç‡ã€‚</p><blockquote><p>æ³¨æ„ï¼š</p><p>è¿™é‡Œç¼“å­˜çš„ä¸åªæ˜¯å…³è”è¡¨çš„åˆ—ï¼Œselectåé¢çš„åˆ—ä¹Ÿä¼šç¼“å­˜èµ·æ¥ã€‚</p><p>åœ¨ä¸€ä¸ªæœ‰Nä¸ªjoinå…³è”çš„sqlä¸­ä¼šåˆ†é…N-1ä¸ªjoin bufferã€‚æ‰€ä»¥æŸ¥è¯¢çš„æ—¶å€™å°½é‡å‡å°‘ä¸å¿…è¦çš„å­—æ®µï¼Œå¯ä»¥è®©join bufferä¸­å¯ä»¥å­˜æ”¾æ›´å¤šçš„åˆ—ã€‚</p></blockquote><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705174005280.png" alt="image-20220705174005280"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705174250551.png" alt="image-20220705174250551"></p><p>å‚æ•°è®¾ç½®ï¼š</p><ul><li>block_nested_loop</li></ul><p>é€šè¿‡<code>show variables like '%optimizer_switch%</code>æŸ¥çœ‹<code>block_nested_loop</code>çŠ¶æ€ã€‚é»˜è®¤æ˜¯å¼€å¯çš„ã€‚</p><ul><li>join_buffer_size</li></ul><p>é©±åŠ¨è¡¨èƒ½ä¸èƒ½ä¸€æ¬¡åŠ è½½å®Œï¼Œè¦çœ‹join bufferèƒ½ä¸èƒ½å­˜å‚¨æ‰€æœ‰çš„æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹<code>join_buffer_size=256k</code>ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%join_buffer%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>join_buffer_sizeçš„æœ€å¤§å€¼åœ¨32ä½æ“ä½œç³»ç»Ÿå¯ä»¥ç”³è¯·4Gï¼Œè€Œåœ¨64ä½æ“ä½œç³»ç»Ÿä¸‹å¯ä»¥ç”³è¯·å¤§äº4Gçš„Join Bufferç©ºé—´ï¼ˆ64ä½Windowsé™¤å¤–ï¼Œå…¶å¤§å€¼ä¼šè¢«æˆªæ–­ä¸º4GBå¹¶å‘å‡ºè­¦å‘Šï¼‰ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9fba7784-d8d4-46ae-8707-b7612bc1d72f-5"><p>1ã€<strong>æ•´ä½“æ•ˆç‡æ¯”è¾ƒï¼šINLJ &gt; BNLJ &gt; SNLJ</strong></p><p>2ã€æ°¸è¿œç”¨å°ç»“æœé›†é©±åŠ¨å¤§ç»“æœé›†ï¼ˆå…¶æœ¬è´¨å°±æ˜¯å‡å°‘å¤–å±‚å¾ªç¯çš„æ•°æ®æ•°é‡ï¼‰ï¼ˆå°çš„åº¦é‡å•ä½æŒ‡çš„æ˜¯è¡¨è¡Œæ•° * æ¯è¡Œå¤§å°ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t1.b,t2.<span class="operator">*</span> <span class="keyword">from</span> t1 straight_join t2 <span class="keyword">on</span> (t1.b<span class="operator">=</span>t2.b) <span class="keyword">where</span> t2.id<span class="operator">&lt;=</span><span class="number">100</span>; # æ¨è</span><br><span class="line"><span class="keyword">select</span> t1.b,t2.<span class="operator">*</span> <span class="keyword">from</span> t2 straight_join t1 <span class="keyword">on</span> (t1.b<span class="operator">=</span>t2.b) <span class="keyword">where</span> t2.id<span class="operator">&lt;=</span><span class="number">100</span>; # ä¸æ¨è</span><br></pre></td></tr></table></figure><p>3ã€ä¸ºè¢«é©±åŠ¨è¡¨åŒ¹é…çš„æ¡ä»¶å¢åŠ ç´¢å¼•(å‡å°‘å†…å­˜è¡¨çš„å¾ªç¯åŒ¹é…æ¬¡æ•°)</p><p>4ã€å¢å¤§join buffer sizeçš„å¤§å°ï¼ˆä¸€æ¬¡ç´¢å¼•çš„æ•°æ®è¶Šå¤šï¼Œé‚£ä¹ˆå†…å±‚åŒ…çš„æ‰«ææ¬¡æ•°å°±è¶Šå°‘ï¼‰</p><p>5ã€å‡å°‘é©±åŠ¨è¡¨ä¸å¿…è¦çš„å­—æ®µæŸ¥è¯¢ï¼ˆå­—æ®µè¶Šå°‘ï¼Œjoin bufferæ‰€ç¼“å­˜çš„æ•°æ®å°±è¶Šå¤šï¼‰</p><blockquote><p>Hash Join</p></blockquote><p><strong>ä»MySQLçš„8.0.20ç‰ˆæœ¬å¼€å§‹å°†åºŸå¼ƒBNLJï¼Œå› ä¸ºä»MySQL8.0.18ç‰ˆæœ¬å¼€å§‹å°±åŠ å…¥äº†hash joiné»˜è®¤éƒ½ä¼šä½¿ç”¨hash join</strong></p><ul><li><p>Nested Loop:</p><p>å¯¹äºè¢«è¿æ¥çš„æ•°æ®å­é›†è¾ƒå°çš„æƒ…å†µï¼ŒNested Loopæ˜¯ä¸ªè¾ƒå¥½çš„é€‰æ‹©ã€‚</p></li><li><p>Hash Joinæ˜¯åš<code>å¤§æ•°æ®é›†è¿æ¥</code>æ—¶çš„å¸¸ç”¨æ–¹å¼ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨ä¸¤ä¸ªè¡¨ä¸­è¾ƒå°ï¼ˆç›¸å¯¹è¾ƒå°ï¼‰çš„è¡¨åˆ©ç”¨Join Keyåœ¨å†…å­˜ä¸­å»ºç«‹<code>æ•£åˆ—è¡¨</code>ï¼Œç„¶åæ‰«æè¾ƒå¤§çš„è¡¨å¹¶æ¢æµ‹æ•£åˆ—è¡¨ï¼Œæ‰¾å‡ºä¸Hashè¡¨åŒ¹é…çš„è¡Œã€‚</p><ul><li>è¿™ç§æ–¹å¼é€‚åˆäºè¾ƒå°çš„è¡¨å®Œå…¨å¯ä»¥æ”¾äºå†…å­˜ä¸­çš„æƒ…å†µï¼Œè¿™æ ·æ€»æˆæœ¬å°±æ˜¯è®¿é—®ä¸¤ä¸ªè¡¨çš„æˆæœ¬ä¹‹å’Œã€‚</li><li>åœ¨è¡¨å¾ˆå¤§çš„æƒ…å†µä¸‹å¹¶ä¸èƒ½å®Œå…¨æ”¾å…¥å†…å­˜ï¼Œè¿™æ—¶ä¼˜åŒ–å™¨ä¼šå°†å®ƒåˆ†å‰²æˆ<code>è‹¥å¹²ä¸åŒçš„åˆ†åŒº</code>ï¼Œä¸èƒ½æ”¾å…¥å†…å­˜çš„éƒ¨åˆ†å°±æŠŠè¯¥åˆ†åŒºå†™å…¥ç£ç›˜çš„ä¸´æ—¶æ®µï¼Œæ­¤æ—¶è¦æ±‚æœ‰è¾ƒå¤§çš„ä¸´æ—¶æ®µä»è€Œå°½é‡æé«˜I/Oçš„æ€§èƒ½ã€‚</li><li>å®ƒèƒ½å¤Ÿå¾ˆå¥½çš„å·¥ä½œäºæ²¡æœ‰ç´¢å¼•çš„å¤§è¡¨å’Œå¹¶è¡ŒæŸ¥è¯¢çš„ç¯å¢ƒä¸­ï¼Œå¹¶æä¾›æœ€å¥½çš„æ€§èƒ½ã€‚å¤§å¤šæ•°äººéƒ½è¯´å®ƒæ˜¯Joinçš„é‡å‹å‡é™æœºã€‚Hash Joinåªèƒ½åº”ç”¨äºç­‰å€¼è¿æ¥ï¼ˆå¦‚WHERE A.COL1 = B.COL2ï¼‰ï¼Œè¿™æ˜¯ç”±Hashçš„ç‰¹ç‚¹å†³å®šçš„ã€‚</li></ul></li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705205050280.png" alt="image-20220705205050280"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="3-5-å°ç»“">3.5 å°ç»“</h3><ul><li>ä¿è¯è¢«é©±åŠ¨è¡¨çš„JOINå­—æ®µå·²ç»åˆ›å»ºäº†ç´¢å¼•</li><li>éœ€è¦JOIN çš„å­—æ®µï¼Œæ•°æ®ç±»å‹ä¿æŒç»å¯¹ä¸€è‡´ã€‚</li><li>LEFT JOIN æ—¶ï¼Œé€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œ å¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨ ã€‚å‡å°‘å¤–å±‚å¾ªç¯çš„æ¬¡æ•°ã€‚</li><li>INNER JOIN æ—¶ï¼ŒMySQLä¼šè‡ªåŠ¨å°† å°ç»“æœé›†çš„è¡¨é€‰ä¸ºé©±åŠ¨è¡¨ ã€‚é€‰æ‹©ç›¸ä¿¡MySQLä¼˜åŒ–ç­–ç•¥ã€‚</li><li>èƒ½å¤Ÿç›´æ¥å¤šè¡¨å…³è”çš„å°½é‡ç›´æ¥å…³è”ï¼Œä¸ç”¨å­æŸ¥è¯¢ã€‚(å‡å°‘æŸ¥è¯¢çš„è¶Ÿæ•°)</li><li>ä¸å»ºè®®ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå»ºè®®å°†å­æŸ¥è¯¢SQLæ‹†å¼€ç»“åˆç¨‹åºå¤šæ¬¡æŸ¥è¯¢ï¼Œæˆ–ä½¿ç”¨ JOIN æ¥ä»£æ›¿å­æŸ¥è¯¢ã€‚</li><li>è¡ç”Ÿè¡¨å»ºä¸äº†ç´¢å¼•</li></ul><hr><h2 id="4-å­æŸ¥è¯¢ä¼˜åŒ–">4. å­æŸ¥è¯¢ä¼˜åŒ–</h2><p>MySQLä»4.1ç‰ˆæœ¬å¼€å§‹æ”¯æŒå­æŸ¥è¯¢ï¼Œä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥è¿›è¡ŒSELECTè¯­å¥çš„åµŒå¥—æŸ¥è¯¢ï¼Œå³ä¸€ä¸ªSELECTæŸ¥è¯¢çš„ç»“ æœä½œä¸ºå¦ä¸€ä¸ªSELECTè¯­å¥çš„æ¡ä»¶ã€‚<code>å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„SQLæ“ä½œ</code>ã€‚</p><span class='p red'>å­æŸ¥è¯¢æ˜¯ MySQL çš„ä¸€é¡¹é‡è¦çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª SQL è¯­å¥å®ç°æ¯”è¾ƒå¤æ‚çš„æŸ¥è¯¢ã€‚ä½†æ˜¯ï¼Œå­æŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡ä¸é«˜ã€‚</span>åŸå› ï¼š<p>â‘  æ‰§è¡Œå­æŸ¥è¯¢æ—¶ï¼ŒMySQLéœ€è¦ä¸ºå†…å±‚æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ç»“æœ<code>å»ºç«‹ä¸€ä¸ªä¸´æ—¶è¡¨</code>ï¼Œç„¶åå¤–å±‚æŸ¥è¯¢è¯­å¥ä»ä¸´æ—¶è¡¨ ä¸­æŸ¥è¯¢è®°å½•ã€‚æŸ¥è¯¢å®Œæ¯•åï¼Œå†<code>æ’¤é”€è¿™äº›ä¸´æ—¶è¡¨</code>ã€‚è¿™æ ·ä¼šæ¶ˆè€—è¿‡å¤šçš„CPUå’ŒIOèµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚</p><p>â‘¡ å­æŸ¥è¯¢çš„ç»“æœé›†å­˜å‚¨çš„ä¸´æ—¶è¡¨ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½<code>ä¸ä¼šå­˜åœ¨ç´¢å¼•</code>ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚</p><p>â‘¢ å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚</p><span class='p red'>åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æŸ¥è¯¢æ¥æ›¿ä»£å­æŸ¥è¯¢ã€‚</span> è¿æ¥æŸ¥è¯¢ä¸éœ€è¦å»ºç«‹ä¸´æ—¶ï¼Œå…¶é€Ÿåº¦æ¯”å­æŸ¥è¯¢è¦å¿« ï¼Œå¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•çš„è¯ï¼Œæ€§èƒ½å°±ä¼šæ›´å¥½ã€‚<p>ä¸¾ä¾‹1ï¼šæŸ¥è¯¢å­¦ç”Ÿè¡¨ä¸­æ˜¯ç­é•¿çš„å­¦ç”Ÿä¿¡æ¯</p><ul><li>ä½¿ç”¨å­æŸ¥è¯¢</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºç­çº§è¡¨ä¸­ç­é•¿çš„ç´¢å¼•</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_monitor <span class="keyword">ON</span> class(monitor);</span><br><span class="line"># æŸ¥è¯¢ç­é•¿ä¿¡æ¯</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student stu1</span><br><span class="line"><span class="keyword">WHERE</span> stu1.`stuno`<span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> monitor</span><br><span class="line"><span class="keyword">FROM</span> class c</span><br><span class="line"><span class="keyword">WHERE</span> monitor <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230412113820338.png" alt="image-20230412113820338"></p><ul><li>æ¨èä½¿ç”¨å¤šè¡¨æŸ¥è¯¢</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> stu1.<span class="operator">*</span> <span class="keyword">FROM</span> student stu1 <span class="keyword">JOIN</span> class c</span><br><span class="line"><span class="keyword">ON</span> stu1.`stuno`<span class="operator">=</span> c.`monitor`</span><br><span class="line"><span class="keyword">WHERE</span> c.`monitor`<span class="keyword">is</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230412113950052.png" alt="image-20230412113950052"></p><p>ä¸¾ä¾‹2ï¼šå–æ‰€æœ‰ä¸ä¸ºç­é•¿çš„åŒå­¦</p><ul><li>ä¸æ¨è</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE a.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student a</span><br><span class="line"><span class="keyword">WHERE</span> a.stuno <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> monitor <span class="keyword">FROM</span> class b</span><br><span class="line">    <span class="keyword">WHERE</span> monitor <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705210708343.png" alt="image-20220705210708343"></p><ul><li>æ¨èï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE a.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student a <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> class b</span><br><span class="line"><span class="keyword">ON</span> a.stuno <span class="operator">=</span> b.monitor</span><br><span class="line"><span class="keyword">WHERE</span> b.monitor <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705210839437.png" alt="image-20220705210839437"></p><blockquote><p>ç»“è®ºï¼šå°½é‡ä¸è¦ä½¿ç”¨NOT INæˆ–è€…NOT EXISTSï¼Œç”¨LEFT JOIN xxx ON xx WHERE xx IS NULLæ›¿ä»£</p></blockquote><hr><h2 id="5-æ’åºä¼˜åŒ–">5. æ’åºä¼˜åŒ–</h2><h3 id="5-1-æ’åºä¼˜åŒ–">5.1 æ’åºä¼˜åŒ–</h3><p><strong>é—®é¢˜</strong>ï¼šåœ¨ WHERE æ¡ä»¶å­—æ®µä¸ŠåŠ ç´¢å¼•ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåœ¨ ORDER BY å­—æ®µä¸Šè¿˜è¦åŠ ç´¢å¼•å‘¢ï¼Ÿ</p><p><strong>å›ç­”ï¼š</strong></p><p>åœ¨MySQLä¸­ï¼Œæ”¯æŒä¸¤ç§æ’åºæ–¹å¼ï¼Œåˆ†åˆ«æ˜¯<code>FileSort</code>å’Œ<code>Index</code>æ’åºã€‚</p><ul><li>Index æ’åºä¸­ï¼Œç´¢å¼•å¯ä»¥ä¿è¯æ•°æ®çš„æœ‰åºæ€§ï¼Œä¸éœ€è¦å†è¿›è¡Œæ’åºï¼Œ<code>æ•ˆç‡æ›´é«˜</code>ã€‚</li><li>FileSort æ’åºåˆ™ä¸€èˆ¬åœ¨<code>å†…å­˜ä¸­</code>è¿›è¡Œæ’åºï¼Œå ç”¨<code>CPUè¾ƒå¤š</code>ã€‚å¦‚æœå¾…æ’ç»“æœè¾ƒå¤§ï¼Œä¼šäº§ç”Ÿä¸´æ—¶æ–‡ä»¶ I/O åˆ°ç£ç›˜è¿›è¡Œæ’åºçš„æƒ…å†µï¼Œæ•ˆç‡è¾ƒä½ã€‚</li></ul><p><strong>ä¼˜åŒ–å»ºè®®ï¼š</strong></p><ol><li>SQL ä¸­ï¼Œå¯ä»¥åœ¨ WHERE å­å¥å’Œ ORDER BY å­å¥ä¸­ä½¿ç”¨ç´¢å¼•ï¼Œç›®çš„æ˜¯åœ¨ WHERE å­å¥ä¸­<code>é¿å…å…¨è¡¨æ‰«æ</code>ï¼Œåœ¨ ORDER BY å­å¥<code>é¿å…ä½¿ç”¨ FileSort æ’åº</code>ã€‚å½“ç„¶ï¼ŒæŸäº›æƒ…å†µä¸‹å…¨è¡¨æ‰«æï¼Œæˆ–è€… FileSort æ’åºä¸ä¸€å®šæ¯”ç´¢å¼•æ…¢ã€‚ä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦é¿å…ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>å°½é‡ä½¿ç”¨ Index å®Œæˆ ORDER BY æ’åºã€‚å¦‚æœ WHERE å’Œ ORDER BY åé¢æ˜¯ç›¸åŒçš„åˆ—å°±ä½¿ç”¨å•ç´¢å¼•åˆ—ï¼› å¦‚æœä¸åŒå°±ä½¿ç”¨è”åˆç´¢å¼•ã€‚</li><li>æ— æ³•ä½¿ç”¨ Index æ—¶ï¼Œéœ€è¦å¯¹ FileSort æ–¹å¼è¿›è¡Œè°ƒä¼˜ã€‚</li></ol><h3 id="5-2-æµ‹è¯•">5.2 æµ‹è¯•</h3><p>åˆ é™¤studentè¡¨å’Œclassè¡¨ä¸­å·²åˆ›å»ºçš„ç´¢å¼•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># æ–¹å¼<span class="number">1</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_monitor <span class="keyword">ON</span> class;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_cid <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_name <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_name_classId <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_classId_name <span class="keyword">ON</span> student;</span><br><span class="line"></span><br><span class="line"># æ–¹å¼<span class="number">2</span></span><br><span class="line"><span class="keyword">call</span> proc_drop_index(<span class="string">&#x27;atguigudb2&#x27;</span>,<span class="string">&#x27;student&#x27;</span>;)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯å¦èƒ½ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œ<code>èƒ½å¦å»æ‰using filesort</code></p><p><strong>è¿‡ç¨‹ä¸€ï¼š</strong></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705215436102.png" alt="image-20220705215436102"></p><p><strong>è¿‡ç¨‹äºŒï¼š order by æ—¶ä¸limit,ç´¢å¼•å¤±æ•ˆ</strong></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705215909350.png" alt="image-20220705215909350"></p><p><strong>è¿‡ç¨‹ä¸‰ï¼šorder by æ—¶é¡ºåºé”™è¯¯ï¼Œç´¢å¼•å¤±æ•ˆ</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705220033520.png" alt="image-20220705220033520" style="zoom:80%;" /><p><strong>è¿‡ç¨‹å››ï¼šorder by æ—¶è§„åˆ™ä¸ä¸€è‡´ï¼Œç´¢å¼•å¤±æ•ˆï¼ˆé¡ºåºé”™ï¼Œä¸ç´¢å¼•ï¼›æ–¹å‘åï¼Œä¸ç´¢å¼•ï¼‰</strong></p><p>ç¬¬å››ä¸ªåè€Œèƒ½ç´¢å¼•éƒ½å€’äº†</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705220404802.png" alt="image-20220705220404802" style="zoom:80%;" /><blockquote><p>ç»“è®ºï¼šORDER BY å­å¥ï¼Œå°½é‡ä½¿ç”¨ Index æ–¹å¼æ’åºï¼Œé¿å…ä½¿ç”¨ FileSort æ–¹å¼æ’åº</p></blockquote><p><strong>è¿‡ç¨‹äº”ï¼šæ— è¿‡æ»¤ï¼Œä¸ç´¢å¼•</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705221212879.png" alt="image-20220705221212879" style="zoom:80%;" /><p><strong>å°ç»“</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">INDEX a_b_c(a,b,c)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> èƒ½ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰ç¼€</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a,b</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a,b,c</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a <span class="keyword">DESC</span>,b <span class="keyword">DESC</span>,c <span class="keyword">DESC</span></span><br><span class="line">å¦‚æœ<span class="keyword">WHERE</span>ä½¿ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€å®šä¹‰ä¸ºå¸¸é‡ï¼Œåˆ™<span class="keyword">order</span> <span class="keyword">by</span> èƒ½ä½¿ç”¨ç´¢å¼•</span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c</span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">AND</span> b <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> c</span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c</span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">AND</span> b <span class="operator">&gt;</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c</span><br><span class="line">ä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a <span class="keyword">ASC</span>,b <span class="keyword">DESC</span>,c <span class="keyword">DESC</span> <span class="comment">/* æ’åºä¸ä¸€è‡´ */</span></span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> g <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c <span class="comment">/*ä¸¢å¤±aç´¢å¼•*/</span></span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> c <span class="comment">/*ä¸¢å¤±bç´¢å¼•*/</span></span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> a,d <span class="comment">/*dä¸æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†*/</span></span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="keyword">in</span> (...) <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c <span class="comment">/*å¯¹äºæ’åºæ¥è¯´ï¼Œå¤šä¸ªç›¸ç­‰æ¡ä»¶ä¹Ÿæ˜¯èŒƒå›´æŸ¥è¯¢*/</span></span><br></pre></td></tr></table></figure><h3 id="5-3-æ¡ˆä¾‹å®æˆ˜">5.3 æ¡ˆä¾‹å®æˆ˜</h3><p>ORDER BYå­å¥ï¼Œå°½é‡ä½¿ç”¨Indexæ–¹å¼æ’åºï¼Œé¿å…ä½¿ç”¨FileSortæ–¹å¼æ’åºã€‚</p><p>æ‰§è¡Œæ¡ˆä¾‹å‰å…ˆæ¸…é™¤studentä¸Šçš„ç´¢å¼•ï¼Œåªç•™ä¸»é”®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX idx_age <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_classid_stuno <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_classid_name <span class="keyword">ON</span> student;</span><br><span class="line"></span><br><span class="line">#æˆ–è€…</span><br><span class="line"><span class="keyword">call</span> proc_drop_index(<span class="string">&#x27;atguigudb2&#x27;</span>,<span class="string">&#x27;student&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>åœºæ™¯:æŸ¥è¯¢å¹´é¾„ä¸º30å²çš„ï¼Œä¸”å­¦ç”Ÿç¼–å·å°äº101000çš„å­¦ç”Ÿï¼ŒæŒ‰ç”¨æˆ·åç§°æ’åº</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> stuno <span class="operator">&lt;</span><span class="number">101000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> NAME ;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705222027812.png" alt="image-20220705222027812"></p><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> stuno <span class="operator">&lt;</span><span class="number">101000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> NAME;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> stuno  <span class="operator">|</span>  name  <span class="operator">|</span> age  <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">922</span>     <span class="operator">|</span> <span class="number">100923</span> <span class="operator">|</span> elTLXD <span class="operator">|</span> <span class="number">30</span>   <span class="operator">|</span> <span class="number">249</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3723263</span> <span class="operator">|</span> <span class="number">100412</span> <span class="operator">|</span> hKcjLb <span class="operator">|</span> <span class="number">30</span>   <span class="operator">|</span> <span class="number">59</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3724152</span> <span class="operator">|</span> <span class="number">100827</span> <span class="operator">|</span> iHLJmh <span class="operator">|</span> <span class="number">30</span>   <span class="operator">|</span> <span class="number">387</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3724030</span> <span class="operator">|</span> <span class="number">100776</span> <span class="operator">|</span> LgxWoD <span class="operator">|</span> <span class="number">30</span>   <span class="operator">|</span> <span class="number">253</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">30</span>      <span class="operator">|</span> <span class="number">100031</span> <span class="operator">|</span> LZMOIa <span class="operator">|</span> <span class="number">30</span>   <span class="operator">|</span> <span class="number">97</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3722887</span> <span class="operator">|</span> <span class="number">100237</span> <span class="operator">|</span> QzbJdx <span class="operator">|</span> <span class="number">30</span>   <span class="operator">|</span> <span class="number">440</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">609</span>     <span class="operator">|</span> <span class="number">100610</span> <span class="operator">|</span> vbRimN <span class="operator">|</span> <span class="number">30</span>   <span class="operator">|</span> <span class="number">481</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">139</span>     <span class="operator">|</span> <span class="number">100140</span> <span class="operator">|</span> ZqFbuR <span class="operator">|</span> <span class="number">30</span>   <span class="operator">|</span> <span class="number">351</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------+--------+------+---------+</span></span><br><span class="line"><span class="number">8</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">3.16</span> sec)</span><br></pre></td></tr></table></figure><blockquote><p>ç»“è®ºï¼štype æ˜¯ ALLï¼Œå³æœ€åçš„æƒ…å†µã€‚Extra é‡Œè¿˜å‡ºç°äº† Using filesort,ä¹Ÿæ˜¯æœ€åçš„æƒ…å†µã€‚ä¼˜åŒ–æ˜¯å¿…é¡»çš„ã€‚</p></blockquote><p><strong>æ–¹æ¡ˆä¸€: ä¸ºäº†å»æ‰filesortæˆ‘ä»¬å¯ä»¥æŠŠç´¢å¼•å»ºæˆ</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºæ–°ç´¢å¼•</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_name <span class="keyword">ON</span> student(age,NAME);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> stuno <span class="operator">&lt;</span><span class="number">101000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> NAME;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705222912521.png" alt="image-20220705222912521"></p><p>è¿™æ ·æˆ‘ä»¬ä¼˜åŒ–æ‰äº† using filesort</p><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705222954971.png" alt="image-20220705222954971"  /><p><strong>æ–¹æ¡ˆäºŒï¼šå°½é‡è®©whereçš„è¿‡æ»¤æ¡ä»¶å’Œæ’åºä½¿ç”¨ä¸Šç´¢å¼•</strong></p><p>å»ºä¸€ä¸ªä¸‰ä¸ªå­—æ®µçš„ç»„åˆç´¢å¼•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX idx_age_name <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_stuno_name <span class="keyword">ON</span> student (age,stuno,NAME);</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> stuno <span class="operator">&lt;</span><span class="number">101000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> NAME;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705223111883.png" alt="image-20220705223111883"></p><p>æˆ‘ä»¬å‘ç°using filesortä¾ç„¶å­˜åœ¨ï¼Œæ‰€ä»¥nameå¹¶æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œè€Œä¸”typeè¿˜æ˜¯rangeå…‰çœ‹åå­—å…¶å®å¹¶ä¸ç¾å¥½ã€‚åŸå› æ˜¯ï¼Œå› ä¸º<code>stunoæ˜¯ä¸€ä¸ªèŒƒå›´è¿‡æ»¤</code>ï¼Œæ‰€ä»¥ç´¢å¼•åé¢çš„å­—æ®µä¸ä¼šåœ¨ä½¿ç”¨ç´¢å¼•äº† ã€‚</p><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> stuno <span class="operator">&lt;</span><span class="number">101000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> NAME ;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> stuno <span class="operator">|</span> name <span class="operator">|</span> age <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">167</span> <span class="operator">|</span> <span class="number">100168</span> <span class="operator">|</span> AClxEF <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">319</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">323</span> <span class="operator">|</span> <span class="number">100324</span> <span class="operator">|</span> bwbTpQ <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">654</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">651</span> <span class="operator">|</span> <span class="number">100652</span> <span class="operator">|</span> DRwIac <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">997</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">517</span> <span class="operator">|</span> <span class="number">100518</span> <span class="operator">|</span> HNSYqJ <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">256</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">344</span> <span class="operator">|</span> <span class="number">100345</span> <span class="operator">|</span> JuepiX <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">329</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">905</span> <span class="operator">|</span> <span class="number">100906</span> <span class="operator">|</span> JuWALd <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">892</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">574</span> <span class="operator">|</span> <span class="number">100575</span> <span class="operator">|</span> kbyqjX <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">260</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">703</span> <span class="operator">|</span> <span class="number">100704</span> <span class="operator">|</span> KJbprS <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">594</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">723</span> <span class="operator">|</span> <span class="number">100724</span> <span class="operator">|</span> OTdJkY <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">236</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">656</span> <span class="operator">|</span> <span class="number">100657</span> <span class="operator">|</span> Pfgqmj <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">600</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">982</span> <span class="operator">|</span> <span class="number">100983</span> <span class="operator">|</span> qywLqw <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">837</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">468</span> <span class="operator">|</span> <span class="number">100469</span> <span class="operator">|</span> sLEKQW <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">346</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">988</span> <span class="operator">|</span> <span class="number">100989</span> <span class="operator">|</span> UBYqJl <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">457</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">173</span> <span class="operator">|</span> <span class="number">100174</span> <span class="operator">|</span> UltkTN <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">830</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">332</span> <span class="operator">|</span> <span class="number">100333</span> <span class="operator">|</span> YjWiZw <span class="operator">|</span> <span class="number">30</span> <span class="operator">|</span> <span class="number">824</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+--------+------+---------+</span></span><br><span class="line"><span class="number">15</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ç»“æœç«Ÿç„¶æœ‰ filesortçš„ sql è¿è¡Œé€Ÿåº¦ï¼Œ è¶…è¿‡äº†å·²ç»ä¼˜åŒ–æ‰ filesortçš„ sql ï¼Œè€Œä¸”å¿«äº†å¾ˆå¤šï¼Œå‡ ä¹ä¸€ç¬é—´å°±å‡ºç°äº†ç»“æœã€‚</p><p>åŸå› ï¼š</p><p>æ‰€æœ‰çš„æ’åºéƒ½æ˜¯åœ¨æ¡ä»¶è¿‡æ»¤ä¹‹åæ‰æ‰§è¡Œçš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ¡ä»¶è¿‡æ»¤æ‰å¤§éƒ¨åˆ†æ•°æ®çš„è¯ï¼Œå‰©ä¸‹å‡ ç™¾å‡ å¹²æ¡æ•°æ®è¿›è¡Œæ’åºå…¶å®å¹¶ä¸æ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½ï¼Œå³ä½¿ç´¢å¼•ä¼˜åŒ–äº†æ’åºï¼Œä½†å®é™…æå‡æ€§èƒ½å¾ˆæœ‰é™ã€‚ç›¸å¯¹çš„ stuno&lt;101000 è¿™ä¸ªæ¡ä»¶ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°ç´¢å¼•çš„è¯ï¼Œè¦å¯¹å‡ ä¸‡æ¡çš„æ•°æ®è¿›è¡Œæ‰«æï¼Œè¿™æ˜¯éå¸¸æ¶ˆè€—æ€§èƒ½çš„ï¼Œæ‰€ä»¥ç´¢å¼•æ”¾åœ¨è¿™ä¸ªå­—æ®µä¸Šæ€§ä»·æ¯”æœ€é«˜ï¼Œæ˜¯æœ€ä¼˜é€‰æ‹©ã€‚</p><blockquote><p>ç»“è®ºï¼š</p><ol><li>ä¸¤ä¸ªç´¢å¼•åŒæ—¶å­˜åœ¨ï¼Œmysqlè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„æ–¹æ¡ˆã€‚ï¼ˆå¯¹äºè¿™ä¸ªä¾‹å­ï¼Œmysqlé€‰æ‹© idx_age_stuno_nameï¼‰ã€‚ä½†æ˜¯ï¼Œ<code>éšç€æ•°æ®é‡çš„å˜åŒ–ï¼Œé€‰æ‹©çš„ç´¢å¼•ä¹Ÿä¼šéšä¹‹å˜åŒ–çš„</code>ã€‚</li><li><strong>å½“ã€èŒƒå›´æ¡ä»¶ã€‘å’Œã€group by æˆ–è€… order byã€‘çš„å­—æ®µå‡ºç°äºŒé€‰ä¸€æ—¶ï¼Œä¼˜å…ˆè§‚å¯Ÿæ¡ä»¶å­—æ®µçš„è¿‡ æ»¤æ•°é‡ï¼Œå¦‚æœè¿‡æ»¤çš„æ•°æ®è¶³å¤Ÿå¤šï¼Œè€Œéœ€è¦æ’åºçš„æ•°æ®å¹¶ä¸å¤šæ—¶ï¼Œä¼˜å…ˆæŠŠç´¢å¼•æ”¾åœ¨èŒƒå›´å­—æ®µä¸Šã€‚åä¹‹ï¼Œäº¦ç„¶ã€‚</strong></li></ol></blockquote><p>æ€è€ƒï¼šè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ç´¢å¼•ï¼Œæ˜¯å¦å¯è¡Œï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX idx_age_stuno_name <span class="keyword">ON</span> student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_stuno <span class="keyword">ON</span> student(age,stuno);</span><br></pre></td></tr></table></figure><p>å½“ç„¶å¯ä»¥ã€‚</p><h3 id="5-4-filesortç®—æ³•ï¼šåŒè·¯æ’åºå’Œå•è·¯æ’åº">5.4 filesortç®—æ³•ï¼šåŒè·¯æ’åºå’Œå•è·¯æ’åº</h3><p>æ’åºçš„å­—æ®µè‹¥ä¸åœ¨ç´¢å¼•åˆ—ä¸Šï¼Œåˆ™filesortä¼šæœ‰ä¸¤ç§ç®—æ³•ï¼šåŒè·¯æ’åºå’Œå•è·¯æ’åº</p><p><strong>åŒè·¯æ’åº ï¼ˆæ…¢ï¼‰</strong></p><ul><li>MySQL 4.1ä¹‹å‰æ˜¯ä½¿ç”¨åŒè·¯æ’åº ï¼Œå­—é¢æ„æ€å°±æ˜¯ä¸¤æ¬¡æ‰«æç£ç›˜ï¼Œæœ€ç»ˆå¾—åˆ°æ•°æ®ï¼Œ è¯»å–è¡ŒæŒ‡é’ˆå’Œ order byåˆ— ï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«æå·²ç»æ’åºå¥½çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§åˆ—è¡¨ä¸­çš„å€¼é‡æ–°ä»åˆ—è¡¨ä¸­è¯»å–å¯¹åº”çš„æ•°æ®è¾“å‡º</li><li>ä»ç£ç›˜å–æ’åºå­—æ®µï¼Œåœ¨bufferè¿›è¡Œæ’åºï¼Œå†ä»ç£ç›˜å–å…¶ä»–å­—æ®µ ã€‚</li></ul><p>å–ä¸€æ‰¹æ•°æ®ï¼Œè¦å¯¹ç£ç›˜è¿›è¡Œä¸¤æ¬¡æ‰«æï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒIOæ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥åœ¨mysql4.1ä¹‹åï¼Œå‡ºç°äº†ç¬¬äºŒç§ æ”¹è¿›çš„ç®—æ³•ï¼Œå°±æ˜¯å•è·¯æ’åºã€‚</p><p><strong>å•è·¯æ’åº ï¼ˆå¿«ï¼‰</strong></p><p>ä»ç£ç›˜è¯»å–æŸ¥è¯¢éœ€è¦çš„ æ‰€æœ‰åˆ— ï¼ŒæŒ‰ç…§order byåˆ—åœ¨bufferå¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºï¼Œ å®ƒçš„æ•ˆç‡æ›´å¿«ä¸€äº›ï¼Œé¿å…äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚å¹¶ä¸”æŠŠéšæœºIOå˜æˆäº†é¡ºåºIOï¼Œä½†æ˜¯å®ƒä¼šä½¿ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œ å› ä¸ºå®ƒæŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­äº†ã€‚</p><p><strong>ç»“è®ºåŠå¼•ç”³å‡ºçš„é—®é¢˜</strong></p><ul><li>ç”±äºå•è·¯æ˜¯åå‡ºçš„ï¼Œæ€»ä½“è€Œè¨€å¥½è¿‡åŒè·¯</li><li>ä½†æ˜¯ç”¨å•è·¯æœ‰é—®é¢˜<ul><li>åœ¨sort_bufferä¸­ï¼Œå•è·¯è¦æ¯”å¤šè·¯å¤šå ç”¨å¾ˆå¤šç©ºé—´ï¼Œå› ä¸ºå•è·¯æ˜¯æŠŠæ‰€æœ‰å­—æ®µéƒ½å–å‡ºï¼Œæ‰€ä»¥æœ‰å¯èƒ½å–å‡ºçš„æ•°æ®çš„æ€»å¤§å°è¶…å‡ºäº†<code>sort_buffer</code>çš„å®¹é‡ï¼Œå¯¼è‡´æ¯æ¬¡åªèƒ½å–<code>sort_buffer</code>å®¹é‡å¤§å°çš„æ•°æ®ï¼Œè¿›è¡Œæ’åºï¼ˆåˆ›å»ºtmpæ–‡ä»¶ï¼Œå¤šè·¯åˆå¹¶ï¼‰ï¼Œæ’å®Œå†å–sort_bufferå®¹é‡å¤§å°ï¼Œå†æ’â€¦ä»è€Œå¤šæ¬¡I/Oã€‚</li><li>å•è·¯æœ¬æ¥æƒ³çœä¸€æ¬¡I/Oæ“ä½œï¼Œåè€Œå¯¼è‡´äº†å¤§é‡çš„I/Oæ“ä½œï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚</li></ul></li></ul><p><strong>ä¼˜åŒ–ç­–ç•¥</strong></p><p><strong>1. å°è¯•æé«˜ sort_buffer_size</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705224410340.png" alt="image-20220705224410340" style="zoom:80%;" /><p><strong>2. å°è¯•æé«˜ max_length_for_sort_data</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705224505668.png" alt="image-20220705224505668" style="zoom:80%;" /><p><strong>3. Order by æ—¶select * æ˜¯ä¸€ä¸ªå¤§å¿Œã€‚æœ€å¥½åªQueryéœ€è¦çš„å­—æ®µã€‚</strong></p><ul><li><p>å½“Queryçš„å­—æ®µå¤§å°æ€»å’Œå°äº<code>max_length_for-sort_data</code>ï¼Œè€Œä¸”æ’åºå­—æ®µä¸æ˜¯TEXT | BLOB ç±»å‹æ—¶ï¼Œä¼šç”¨æ”¹è¿›åçš„ç®—æ³•ä¸€ä¸€å•è·¯æ’åºï¼Œå¦åˆ™ç”¨è€ç®—æ³•ä¸€ä¸€å¤šè·¯æ’åºã€‚</p></li><li><p>ä¸¤ç§ç®—æ³•çš„æ•°æ®éƒ½æœ‰å¯èƒ½è¶…å‡ºsort_buffer_sizeçš„å®¹é‡ï¼Œè¶…å‡ºä¹‹åï¼Œä¼šåˆ›å»ºtmpæ–‡ä»¶è¿›è¡Œåˆå¹¶æ’åºï¼Œå¯¼è‡´å¤šæ¬¡ I/Oï¼Œä½†æ˜¯ç”¨å•è·¯æ’åºç®—æ³•çš„é£é™©ä¼šæ›´å¤§ä¸€äº›ï¼Œæ‰€ä»¥è¦æé«˜<code>sort_buffer-size</code>ã€‚</p></li></ul><hr><h2 id="6-GROUP-BYä¼˜åŒ–">6. GROUP BYä¼˜åŒ–</h2><ul><li>group by ä½¿ç”¨ç´¢å¼•çš„åŸåˆ™å‡ ä¹è·Ÿorder byä¸€è‡´ ï¼Œgroup by å³ä½¿æ²¡æœ‰è¿‡æ»¤æ¡ä»¶ç”¨åˆ°ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç´¢å¼•ã€‚</li><li>group by å…ˆæ’åºå†åˆ†ç»„ï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</li><li>å½“æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—ï¼Œå¢å¤§ max_length_for_sort_data å’Œ sort_buffer_size å‚æ•°çš„è®¾ç½®</li><li>whereæ•ˆç‡é«˜äºhavingï¼Œèƒ½å†™åœ¨whereé™å®šçš„æ¡ä»¶å°±ä¸è¦å†™åœ¨havingä¸­äº†</li><li>å‡å°‘ä½¿ç”¨order byï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚Order byã€group byã€distinctè¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹CPUï¼Œæ•°æ®åº“çš„CPUèµ„æºæ˜¯æå…¶å®è´µçš„ã€‚</li><li>åŒ…å«äº†order byã€group byã€distinctè¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼Œwhereæ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨1000è¡Œ ä»¥å†…ï¼Œå¦åˆ™SQLä¼šå¾ˆæ…¢ã€‚</li></ul><hr><h2 id="7-ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢">7. ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢</h2><p>ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ã€‚ä¸€ä¸ªå¸¸è§åˆéå¸¸å¤´ç–¼çš„é—®é¢˜å°±æ˜¯ limit 2000000,10 æ­¤æ—¶éœ€è¦MySQLæ’åºå‰2000010è®°å½•ï¼Œä»…ä»…è¿”å›2000000-2000010çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§ã€‚</p><p><code>EXPLAIN SELECT * FROM student LIMIT 2000000,10</code>;</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230411140225812.png" alt="image-20230411140225812"></p><p><strong>ä¼˜åŒ–æ€è·¯ä¸€</strong></p><p>åœ¨ç´¢å¼•ä¸Šå®Œæˆæ’åºåˆ†é¡µæ“ä½œï¼Œæœ€åæ ¹æ®ä¸»é”®å…³è”å›åŸè¡¨æŸ¥è¯¢æ‰€éœ€è¦çš„å…¶ä»–åˆ—å†…å®¹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student t,(<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">2000000</span>,<span class="number">10</span>) a <span class="keyword">WHERE</span> t.id <span class="operator">=</span> a.id;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705225625166.png" alt="image-20220705225625166"></p><p><strong>ä¼˜åŒ–æ€è·¯äºŒ</strong></p><p>è¯¥æ–¹æ¡ˆé€‚ç”¨äºä¸»é”®è‡ªå¢çš„è¡¨ï¼Œå¯ä»¥æŠŠLimit æŸ¥è¯¢è½¬æ¢æˆæŸä¸ªä½ç½®çš„æŸ¥è¯¢ ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">2000000</span> LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220705225654124.png" alt="image-20220705225654124"></p><hr><h2 id="8-ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•">8. ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•</h2><h3 id="8-1-ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ">8.1 ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ</h3><p><strong>ç†è§£æ–¹å¼ä¸€</strong>ï¼šç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®ï¼›å½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚<strong>ä¸€ä¸ªç´¢å¼•åŒ…å«äº†æ»¡è¶³æŸ¥è¯¢ç»“æœçš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼•</strong>ã€‚</p><p><strong>ç†è§£æ–¹å¼äºŒ</strong>ï¼šéèšç°‡å¤åˆç´¢å¼•çš„ä¸€ç§å½¢å¼ï¼Œå®ƒåŒ…æ‹¬åœ¨æŸ¥è¯¢é‡Œçš„SELECTã€JOINå’ŒWHEREå­å¥ç”¨åˆ°çš„æ‰€æœ‰åˆ— ï¼ˆå³å»ºç´¢å¼•çš„å­—æ®µæ­£å¥½æ˜¯è¦†ç›–æŸ¥è¯¢æ¡ä»¶ä¸­æ‰€æ¶‰åŠçš„å­—æ®µï¼‰ã€‚</p><p>ç®€å•è¯´å°±æ˜¯ï¼Œ<code>ç´¢å¼•åˆ—+ä¸»é”®</code>åŒ…å«<code>SELECT åˆ° FROMä¹‹é—´æŸ¥è¯¢çš„åˆ—</code>ã€‚</p><p><strong>ä¸¾ä¾‹ä¸€ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># åˆ é™¤ä¹‹å‰çš„ç´¢å¼•</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_stuno <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_name <span class="keyword">ON</span> student(age, NAME);</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&lt;&gt;</span> <span class="number">20</span>;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> age,name <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&lt;&gt;</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706124528680.png" alt="image-20220706124528680"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230412144559891.png" alt="image-20230412144559891"></p><p>æœ¬æ¥ç”±äºä¸ç­‰å·ç´¢å¼•å¤±æ•ˆ ï¼Œä½†æ˜¯è¦†ç›–ç´¢å¼•</p><p><strong>ä¸¾ä¾‹äºŒï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706124612180.png" alt="image-20220706124612180"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_name <span class="keyword">ON</span> student(age, NAME);</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> id,age,NAME <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706125113658.png" alt="image-20220706125113658"></p><p>ä½¿ç”¨ä¸Šäº†ç´¢å¼•ï¼Œå³ä½¿æ˜¯å·¦æ¨¡ç³ŠæŸ¥è¯¢</p><p>åŠ ä¸Šäº†ç´¢å¼•ä¸åœ¨çš„åˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> id,age,NAME,classId <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706125351116.png" alt="image-20220706125351116"></p><h3 id="8-2-è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š">8.2 è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š</h3><p>å¥½å¤„ï¼š</p><ol><li><p>é¿å…Innodbè¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ï¼ˆå›è¡¨ï¼‰</p><p>Innodbæ˜¯ä»¥èšé›†ç´¢å¼•çš„é¡ºåºæ¥å­˜å‚¨çš„ï¼Œå¯¹äºInnodbæ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®ï¼Œåœ¨æŸ¥æ‰¾åˆ°ç›¸åº”çš„é”®å€¼åï¼Œè¿˜éœ€é€šè¿‡ä¸»é”®è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢æ‰èƒ½è·å–æˆ‘ä»¬çœŸå®æ‰€éœ€è¦çš„æ•°æ®ã€‚</p><p>åœ¨è¦†ç›–ç´¢å¼•ä¸­ï¼ŒäºŒçº§ç´¢å¼•çš„é”®å€¼ä¸­å¯ä»¥è·å–æ‰€è¦çš„æ•°æ®ï¼Œ<code>é¿å…äº†å¯¹ä¸»é”®çš„äºŒæ¬¡æŸ¥è¯¢ï¼Œå‡å°‘äº†I0æ“ä½œ</code>ï¼Œæå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚</p></li><li><p>å¯ä»¥æŠŠéšæœºIOå˜æˆé¡ºåºIOåŠ å¿«æŸ¥è¯¢æ•ˆç‡</p><p>ç”±äºè¦†ç›–ç´¢å¼•æ˜¯æŒ‰é”®å€¼çš„é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äºI0å¯†é›†å‹çš„èŒƒå›´æŸ¥æ‰¾æ¥è¯´ï¼Œå¯¹æ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œçš„æ•°æ®IOè¦å°‘çš„å¤šï¼Œå› æ­¤åˆ©ç”¨è¦†ç›–ç´¢å¼•åœ¨è®¿é—®æ—¶ä¹Ÿå¯ä»¥æŠŠç£ç›˜çš„<code>éšæœºè¯»å–çš„IO</code>è½¬å˜æˆç´¢å¼•æŸ¥æ‰¾çš„<code>é¡ºåºIO</code>ã€‚</p><span class='p green'>ç”±äºè¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚</span></li></ol><p>å¼Šç«¯ï¼š</p><p><code>ç´¢å¼•å­—æ®µçš„ç»´æŠ¤</code>æ€»æ˜¯æœ‰ä»£ä»·çš„ã€‚å› æ­¤ï¼Œåœ¨å»ºç«‹å†—ä½™ç´¢å¼•æ¥æ”¯æŒè¦†ç›–ç´¢å¼•æ—¶å°±éœ€è¦æƒè¡¡è€ƒè™‘äº†ã€‚è¿™æ˜¯ä¸šåŠ¡DBAï¼Œæˆ–è€…ç§°ä¸ºä¸šåŠ¡æ•°æ®æ¶æ„å¸ˆçš„å·¥ä½œã€‚</p><hr><h2 id="9-å¦‚ä½•ç»™å­—ç¬¦ä¸²æ·»åŠ ç´¢å¼•">9. å¦‚ä½•ç»™å­—ç¬¦ä¸²æ·»åŠ ç´¢å¼•</h2><p>æœ‰ä¸€å¼ æ•™å¸ˆè¡¨ï¼Œè¡¨å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher(</span><br><span class="line">ID <span class="type">bigint</span> unsigned <span class="keyword">primary</span> key,</span><br><span class="line">email <span class="type">varchar</span>(<span class="number">64</span>),</span><br><span class="line">...</span><br><span class="line">)engine<span class="operator">=</span>innodb;</span><br></pre></td></tr></table></figure><p>è®²å¸ˆè¦ä½¿ç”¨é‚®ç®±ç™»å½•ï¼Œæ‰€ä»¥ä¸šåŠ¡ä»£ç ä¸­ä¸€å®šä¼šå‡ºç°ç±»ä¼¼äºè¿™æ ·çš„è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> col1, col2 <span class="keyword">from</span> teacher <span class="keyword">where</span> email<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœemailè¿™ä¸ªå­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯­å¥å°±åªèƒ½åš<code>å…¨è¡¨æ‰«æ</code>ã€‚</p><h3 id="9-1-å‰ç¼€ç´¢å¼•">9.1 å‰ç¼€ç´¢å¼•</h3><p>MySQLæ˜¯æ”¯æŒå‰ç¼€ç´¢å¼•çš„ã€‚é»˜è®¤åœ°ï¼Œå¦‚æœä½ åˆ›å»ºç´¢å¼•çš„è¯­å¥ä¸æŒ‡å®šå‰ç¼€é•¿åº¦ï¼Œé‚£ä¹ˆç´¢å¼•å°±ä¼šåŒ…å«æ•´ä¸ªå­— ç¬¦ä¸²ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">add</span> index index1(email);</span><br><span class="line">#æˆ–</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">add</span> index index2(email(<span class="number">6</span>));</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§ä¸åŒçš„å®šä¹‰åœ¨æ•°æ®ç»“æ„å’Œå­˜å‚¨ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä¸‹å›¾å°±æ˜¯è¿™ä¸¤ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706130901307.png" alt="image-20220706130901307" style="zoom:50%;" /><p>ä»¥åŠ</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706130921934.png" alt="image-20220706130921934" style="zoom: 50%;" /><p><strong>å¦‚æœä½¿ç”¨çš„æ˜¯index1</strong>ï¼ˆå³emailæ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æ„ï¼‰ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ä»index1ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™ <a href="mailto:zhangssxyz@xxx.com">zhangssxyz@xxx.com</a>â€™çš„è¿™æ¡è®°å½•ï¼Œå–å¾—ID2çš„å€¼ï¼›</li><li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ID2çš„è¡Œï¼Œåˆ¤æ–­emailçš„å€¼æ˜¯æ­£ç¡®çš„ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†ï¼›</li><li>å–index1ç´¢å¼•æ ‘ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°å·²ç»ä¸æ»¡è¶³email=â€™ <a href="mailto:zhangssxyz@xxx.com">zhangssxyz@xxx.com</a> â€™çš„ æ¡ä»¶äº†ï¼Œå¾ªç¯ç»“æŸã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦å›ä¸»é”®ç´¢å¼•å–ä¸€æ¬¡æ•°æ®ï¼Œæ‰€ä»¥ç³»ç»Ÿè®¤ä¸ºåªæ‰«æäº†ä¸€è¡Œã€‚</p><p><strong>å¦‚æœä½¿ç”¨çš„æ˜¯index2</strong>ï¼ˆå³email(6)ç´¢å¼•ç»“æ„ï¼‰ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ä»index2ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™zhangsâ€™çš„è®°å½•ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ˜¯ID1ï¼›</li><li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ID1çš„è¡Œï¼Œåˆ¤æ–­å‡ºemailçš„å€¼ä¸æ˜¯â€™ <a href="mailto:zhangssxyz@xxx.com">zhangssxyz@xxx.com</a> â€™ï¼Œè¿™è¡Œè®°å½•ä¸¢å¼ƒï¼›</li><li>å–index2ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°ä»ç„¶æ˜¯â€™zhangsâ€™ï¼Œå–å‡ºID2ï¼Œå†åˆ°IDç´¢å¼•ä¸Šå–æ•´è¡Œç„¶ ååˆ¤æ–­ï¼Œè¿™æ¬¡å€¼å¯¹äº†ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†ï¼›</li><li>é‡å¤ä¸Šä¸€æ­¥ï¼Œç›´åˆ°åœ¨idxe2ä¸Šå–åˆ°çš„å€¼ä¸æ˜¯â€™zhangsâ€™æ—¶ï¼Œå¾ªç¯ç»“æŸã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´**ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå®šä¹‰å¥½é•¿åº¦ï¼Œå°±å¯ä»¥åšåˆ°æ—¢èŠ‚çœç©ºé—´ï¼Œåˆä¸ç”¨é¢å¤–å¢åŠ å¤ªå¤šçš„æŸ¥è¯¢æˆæœ¬ã€‚**å‰é¢ å·²ç»è®²è¿‡åŒºåˆ†åº¦ï¼ŒåŒºåˆ†åº¦è¶Šé«˜è¶Šå¥½ã€‚å› ä¸ºåŒºåˆ†åº¦è¶Šé«˜ï¼Œæ„å‘³ç€é‡å¤çš„é”®å€¼è¶Šå°‘ã€‚</p><h3 id="9-2-å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“">9.2 å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“</h3><blockquote><p>ç»“è®ºï¼š ä½¿ç”¨å‰ç¼€ç´¢å¼•å°±ç”¨ä¸ä¸Šè¦†ç›–ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„ä¼˜åŒ–äº†ï¼Œè¿™ä¹Ÿæ˜¯ä½ åœ¨é€‰æ‹©æ˜¯å¦ä½¿ç”¨å‰ç¼€ç´¢å¼•æ—¶éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªå› ç´ ã€‚</p></blockquote><hr><h2 id="10-ç´¢å¼•ä¸‹æ¨">10. ç´¢å¼•ä¸‹æ¨</h2><h3 id="10-1-ä½¿ç”¨å‰åå¯¹æ¯”">10.1 ä½¿ç”¨å‰åå¯¹æ¯”</h3><p>Index Condition Pushdown(ICP)æ˜¯MySQL 5.6ä¸­æ–°ç‰¹æ€§ï¼Œæ˜¯ä¸€ç§åœ¨å­˜å‚¨å¼•æ“å±‚ä½¿ç”¨ç´¢å¼•è¿‡æ»¤æ•°æ®çš„ä¸€ç§ä¼˜åŒ–æ–¹å¼ã€‚æŠŠæœ¬åº”è¯¥åœ¨ server å±‚è¿›è¡Œç­›é€‰çš„æ¡ä»¶ï¼Œä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚æ¥è¿›è¡Œç­›é€‰åˆ¤æ–­ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆå‡å°‘å›è¡¨IOæ¬¡æ•°ã€‚</p><ul><li><p>å¦‚æœæ²¡æœ‰ICPï¼Œå­˜å‚¨å¼•æ“ä¼šéå†ç´¢å¼•ä»¥å®šä½åŸºè¡¨ä¸­çš„è¡Œï¼Œå¹¶å°†å®ƒä»¬è¿”å›ç»™ MySQLæœåŠ¡å™¨ï¼Œç”± MysQLæœåŠ¡å™¨è¯„ä¼°<code>WHERE</code>åé¢çš„æ¡ä»¶æ˜¯å¦ä¿ç•™è¡Œã€‚</p></li><li><p>å¯ç”¨ICP åï¼Œå¦‚æœéƒ¨åˆ†<code>WHERE</code>æ¡ä»¶å¯ä»¥ä»…ä½¿ç”¨ç´¢å¼•ä¸­çš„åˆ—è¿›è¡Œç­›é€‰ï¼Œåˆ™ MySQLæœåŠ¡å™¨ä¼šæŠŠè¿™éƒ¨åˆ†<code>WHERE</code>æ¡ä»¶æ”¾åˆ°å­˜å‚¨å¼•æ“ç­›é€‰ã€‚ç„¶åï¼Œå­˜å‚¨å¼•æ“é€šè¿‡ä½¿ç”¨ç´¢å¼•æ¡ç›®æ¥ç­›é€‰æ•°æ®ï¼Œå¹¶ä¸”åªæœ‰åœ¨æ»¡è¶³è¿™ä¸€æ¡ä»¶æ—¶æ‰ä»è¡¨ä¸­è¯»å–è¡Œã€‚</p><ul><li>å¥½å¤„ï¼šICPå¯ä»¥å‡å°‘å­˜å‚¨å¼•æ“å¿…é¡»è®¿é—®åŸºè¡¨çš„æ¬¡æ•°å’ŒMySQLæœåŠ¡å™¨å¿…é¡»è®¿é—®å­˜å‚¨å¼•æ“çš„æ¬¡æ•°ã€‚</li><li>ä½†æ˜¯ï¼ŒICPçš„<code>åŠ é€Ÿæ•ˆæœ</code>å–å†³äºåœ¨å­˜å‚¨å¼•æ“å†…é€šè¿‡<code>ICPç­›é€‰</code>æ‰çš„æ•°æ®çš„æ¯”ä¾‹ã€‚</li></ul></li></ul><h3 id="10-2-ICPçš„å¼€å¯-å…³é—­">10.2 ICPçš„å¼€å¯/å…³é—­</h3><ul><li>é»˜è®¤æƒ…å†µä¸‹å¯åŠ¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨ã€‚å¯ä»¥é€šè¿‡è®¾ç½®ç³»ç»Ÿå˜é‡<code>optimizer_switch</code>æ§åˆ¶ï¼š<code>index_condition_pushdown</code></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æ‰“å¼€ç´¢å¼•ä¸‹æ¨</span><br><span class="line"><span class="keyword">SET</span> optimizer_switch <span class="operator">=</span> <span class="string">&#x27;index_condition_pushdown=on&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># å…³é—­ç´¢å¼•ä¸‹æ¨</span><br><span class="line"><span class="keyword">SET</span> optimizer_switch <span class="operator">=</span> <span class="string">&#x27;index_condition_pushdown=off&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>å½“ä½¿ç”¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨æ˜¯ï¼Œ<code>EXPLAIN</code>è¯­å¥è¾“å‡ºç»“æœä¸­<code>Extra</code>åˆ—å†…å®¹æ˜¾ç¤ºä¸º<code>Using index condition</code>ã€‚</li></ul><hr><h3 id="10-3-ICPä½¿ç”¨æ¡ˆä¾‹">10.3 ICPä½¿ç”¨æ¡ˆä¾‹</h3><p>å‡è®¾ä¸€ä¸ªè¡¨åŒ…å«æœ‰å…³äººå‘˜åŠå…¶åœ°å€çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥è¡¨çš„ç´¢å¼•å®šä¹‰ä¸º<code>INDEX (zipcode, lastname, firstname)</code>ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªäººçš„<code>zipcode</code>ä½†ä¸ç¡®å®šå§“æ°ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æœç´¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> people</span><br><span class="line">  <span class="keyword">WHERE</span> zipcode<span class="operator">=</span><span class="string">&#x27;95054&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> lastname <span class="keyword">LIKE</span> <span class="string">&#x27;%etrunia%&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> address <span class="keyword">LIKE</span> <span class="string">&#x27;%Main Street%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>MySQLå¯ä»¥ä½¿ç”¨ç´¢å¼•æ‰«æzipcode='95054â€™çš„ç”¨æˆ·ï¼Œç¬¬äºŒéƒ¨åˆ†å§“æ°ä¸èƒ½ä½¿ç”¨ç´¢å¼•ã€‚å› æ­¤å¦‚æœæ²¡æœ‰ç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼Œåˆ™æ­¤æŸ¥è¯¢å¿…é¡»ä¸ºæ‰€æœ‰é‚®æ”¿ç¼–ç ä¸ºâ€œ95054â€çš„äººæ£€ç´¢å®Œæ•´çš„è¡Œã€‚</p><p>ä½¿ç”¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼ŒMySQLåœ¨è¯»å–æ•´ä¸ªè¡¨è¡Œä¹‹å‰ï¼Œåœ¨ç´¢å¼•ä¸­æ£€æŸ¥å§“æ°LIKEâ€œ%etrunia%â€éƒ¨åˆ†ã€‚è¿™æ ·å¯ä»¥é¿å…è¯»å–ä¸zipcodeæ¡ä»¶åŒ¹é…ä½†ä¸lastnameæ¡ä»¶ä¸åŒ¹é…çš„ç´¢å¼•å…ƒç»„å¯¹åº”çš„å®Œæ•´è¡Œã€‚</p><h3 id="10-4-IPçš„ä½¿ç”¨æ¡ä»¶">10.4 IPçš„ä½¿ç”¨æ¡ä»¶</h3><ol><li>å¦‚æœè¡¨çš„è®¿é—®ç±»å‹ä¸º range ã€ ref ã€ eq_ref æˆ–è€… ref_or_null å¯ä»¥ä½¿ç”¨ICPã€‚</li><li>ICPå¯ä»¥ä½¿ç”¨<code>InnDB</code>å’Œ<code>MyISAM</code>è¡¨ï¼ŒåŒ…æ‹¬åˆ†åŒºè¡¨<code>InnoDB</code>å’Œ<code>MyISAM</code>è¡¨</li><li>å¯¹äº<code>InnoDB</code>è¡¨ï¼ŒICPä»…ç”¨äº<code>äºŒçº§ç´¢å¼•</code>ã€‚ICPçš„ç›®æ ‡æ˜¯å‡å°‘å…¨è¡Œè¯»å–æ¬¡æ•°ï¼Œä»è€Œå‡å°‘I/Oæ“ä½œã€‚</li><li>å½“SQLä½¿ç”¨è¦†ç›–ç´¢å¼•æ—¶ï¼Œä¸æ”¯æŒICPä¼˜åŒ–æ–¹æ³•ã€‚å› ä¸ºè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ICPä¸ä¼šå‡å°‘I/Oã€‚</li><li>ç›¸å…³å­æŸ¥è¯¢çš„æ¡ä»¶ä¸èƒ½ä½¿ç”¨ICP</li></ol><hr><h2 id="11-æ™®é€šç´¢å¼•-vs-å”¯ä¸€ç´¢å¼•">11. æ™®é€šç´¢å¼• vs å”¯ä¸€ç´¢å¼•</h2><p>ä»æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œä½ é€‰æ‹©å”¯ä¸€ç´¢å¼•è¿˜æ˜¯æ™®é€šç´¢å¼•å‘¢ï¼Ÿé€‰æ‹©çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å‡è®¾ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸»é”®åˆ—ä¸ºIDçš„è¡¨ï¼Œè¡¨ä¸­æœ‰å­—æ®µkï¼Œå¹¶ä¸”åœ¨kä¸Šæœ‰ç´¢å¼•ï¼Œå‡è®¾å­—æ®µ k ä¸Šçš„å€¼éƒ½ä¸é‡å¤ã€‚</p><p>è¿™ä¸ªè¡¨çš„å»ºè¡¨è¯­å¥æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> test(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">k <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">16</span>),</span><br><span class="line">index (k)</span><br><span class="line">)engine<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure><p>è¡¨ä¸­R1~R5çš„(ID,k)å€¼åˆ†åˆ«ä¸º(100,1)ã€(200,2)ã€(300,3)ã€(500,5)å’Œ(600,6)ã€‚</p><h3 id="11-1-æŸ¥è¯¢è¿‡ç¨‹">11.1 æŸ¥è¯¢è¿‡ç¨‹</h3><p>å‡è®¾ï¼Œæ‰§è¡ŒæŸ¥è¯¢çš„è¯­å¥æ˜¯ select id from test where k=5ã€‚</p><ul><li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼ŒæŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½•(5,500)åï¼Œéœ€è¦æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•ï¼Œç›´åˆ°ç¢°åˆ°ç¬¬ä¸€ ä¸ªä¸æ»¡è¶³k=5æ¡ä»¶çš„è®°å½•ã€‚</li><li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œç”±äºç´¢å¼•å®šä¹‰äº†å”¯ä¸€æ€§ï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•åï¼Œå°±ä¼šåœæ­¢ç»§ç»­æ£€ ç´¢ã€‚</li></ul><p>é‚£ä¹ˆï¼Œè¿™ä¸ªä¸åŒå¸¦æ¥çš„æ€§èƒ½å·®è·ä¼šæœ‰å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œ å¾®ä¹å…¶å¾® ã€‚</p><h3 id="11-2-æ›´æ–°è¿‡ç¨‹">11.2 æ›´æ–°è¿‡ç¨‹</h3><p>ä¸ºäº†è¯´æ˜æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½çš„å½±å“è¿™ä¸ªé—®é¢˜ï¼Œä»‹ç»ä¸€ä¸‹change bufferã€‚</p><p>å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯ï¼Œ åœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œ<code>InooDBä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨change bufferä¸­</code>ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œchange bufferä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚</p><p>å°†change bufferä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸º merge ã€‚é™¤äº†<code>è®¿é—®è¿™ä¸ªæ•°æ®é¡µ</code>ä¼šè§¦ å‘mergeå¤–ï¼Œç³»ç»Ÿæœ‰<code>åå°çº¿ç¨‹ä¼šå®šæœŸ</code>mergeã€‚åœ¨<code>æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰</code>çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œmerge æ“ä½œã€‚</p><p>å¦‚æœèƒ½å¤Ÿå°†æ›´æ–°æ“ä½œå…ˆè®°å½•åœ¨change bufferï¼Œ<code>å‡å°‘è¯»ç£ç›˜</code>ï¼Œè¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ä¼šå¾—åˆ°æ˜æ˜¾çš„æå‡ã€‚è€Œä¸”ï¼Œ æ•°æ®è¯»å…¥å†…å­˜æ˜¯éœ€è¦å ç”¨ buffer pool çš„ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼è¿˜èƒ½å¤Ÿ<code>é¿å…å ç”¨å†…å­˜</code>ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚</p><p><code>å”¯ä¸€ç´¢å¼•çš„æ›´æ–°å°±ä¸èƒ½ä½¿ç”¨change buffer</code>ï¼Œå®é™…ä¸Šä¹Ÿåªæœ‰æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨ã€‚</p><p>å¦‚æœè¦åœ¨è¿™å¼ è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°è®°å½•(4,400)çš„è¯ï¼ŒInnoDBçš„å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</p><h3 id="11-3-change-bufferçš„ä½¿ç”¨åœºæ™¯">11.3 change bufferçš„ä½¿ç”¨åœºæ™¯</h3><ol><li>æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿå…¶å®ï¼Œè¿™ä¸¤ç±»ç´¢å¼•åœ¨æŸ¥è¯¢èƒ½åŠ›ä¸Šæ˜¯æ²¡å·®åˆ«çš„ï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯ å¯¹ æ›´æ–°æ€§èƒ½ çš„å½±å“ã€‚æ‰€ä»¥ï¼Œå»ºè®®ä½  å°½é‡é€‰æ‹©æ™®é€šç´¢å¼• ã€‚</li><li>åœ¨å®é™…ä½¿ç”¨ä¸­ä¼šå‘ç°ï¼Œ æ™®é€šç´¢å¼• å’Œ change buffer çš„é…åˆä½¿ç”¨ï¼Œå¯¹äº æ•°æ®é‡å¤§ çš„è¡¨çš„æ›´æ–°ä¼˜åŒ– è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</li><li>å¦‚æœæ‰€æœ‰çš„æ›´æ–°åé¢ï¼Œéƒ½é©¬ä¸Š ä¼´éšç€å¯¹è¿™ä¸ªè®°å½•çš„æŸ¥è¯¢ ï¼Œé‚£ä¹ˆä½ åº”è¯¥ å…³é—­change buffer ã€‚è€Œåœ¨ å…¶ä»–æƒ…å†µä¸‹ï¼Œchange bufferéƒ½èƒ½æå‡æ›´æ–°æ€§èƒ½ã€‚</li><li>ç”±äºå”¯ä¸€ç´¢å¼•ç”¨ä¸ä¸Šchange bufferçš„ä¼˜åŒ–æœºåˆ¶ï¼Œå› æ­¤å¦‚æœ ä¸šåŠ¡å¯ä»¥æ¥å— ï¼Œä»æ€§èƒ½è§’åº¦å‡ºå‘å»ºè®®ä¼˜ å…ˆè€ƒè™‘éå”¯ä¸€ç´¢å¼•ã€‚ä½†æ˜¯å¦‚æœ&quot;ä¸šåŠ¡å¯èƒ½æ— æ³•ç¡®ä¿&quot;çš„æƒ…å†µä¸‹ï¼Œæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ<ul><li>é¦–å…ˆï¼Œ ä¸šåŠ¡æ­£ç¡®æ€§ä¼˜å…ˆ ã€‚æˆ‘ä»¬çš„å‰ææ˜¯â€œä¸šåŠ¡ä»£ç å·²ç»ä¿è¯ä¸ä¼šå†™å…¥é‡å¤æ•°æ®â€çš„æƒ…å†µä¸‹ï¼Œè®¨è®ºæ€§èƒ½ é—®é¢˜ã€‚å¦‚æœä¸šåŠ¡ä¸èƒ½ä¿è¯ï¼Œæˆ–è€…ä¸šåŠ¡å°±æ˜¯è¦æ±‚æ•°æ®åº“æ¥åšçº¦æŸï¼Œé‚£ä¹ˆæ²¡å¾—é€‰ï¼Œå¿…é¡»åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œæœ¬èŠ‚çš„æ„ä¹‰åœ¨äºï¼Œå¦‚æœç¢°ä¸Šäº†å¤§é‡æ’å…¥æ•°æ®æ…¢ã€å†…å­˜å‘½ä¸­ç‡ä½çš„æ—¶å€™ï¼Œç»™ä½ å¤šæä¾›ä¸€ ä¸ªæ’æŸ¥æ€è·¯ã€‚</li><li>ç„¶åï¼Œåœ¨ä¸€äº›â€œ å½’æ¡£åº“ â€çš„åœºæ™¯ï¼Œä½ æ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨å”¯ä¸€ç´¢å¼•çš„ã€‚æ¯”å¦‚ï¼Œçº¿ä¸Šæ•°æ®åªéœ€è¦ä¿ç•™åŠå¹´ï¼Œ ç„¶åå†å²æ•°æ®ä¿å­˜åœ¨å½’æ¡£åº“ã€‚è¿™æ—¶å€™ï¼Œå½’æ¡£æ•°æ®å·²ç»æ˜¯ç¡®ä¿æ²¡æœ‰å”¯ä¸€é”®å†²çªäº†ã€‚è¦æé«˜å½’æ¡£æ•ˆç‡ï¼Œ å¯ä»¥è€ƒè™‘æŠŠè¡¨é‡Œé¢çš„å”¯ä¸€ç´¢å¼•æ”¹æˆæ™®é€šç´¢å¼•ã€‚</li></ul></li></ol><hr><h2 id="12-å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥">12. å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥</h2><h3 id="1-EXISTS-å’Œ-IN-çš„åŒºåˆ†">.1 EXISTS å’Œ IN çš„åŒºåˆ†</h3><p><strong>é—®é¢˜ï¼š</strong></p><p>ä¸å¤ªç†è§£å“ªç§æƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨ EXISTSï¼Œå“ªç§æƒ…å†µåº”è¯¥ç”¨ INã€‚é€‰æ‹©çš„æ ‡å‡†æ˜¯çœ‹èƒ½å¦ä½¿ç”¨è¡¨çš„ç´¢å¼•å—ï¼Ÿ</p><p><strong>å›ç­”ï¼š</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706141957185.png" alt="image-20220706141957185" style="zoom:80%;float:right" /><h3 id="12-2-COUNT-ä¸COUNT-å…·ä½“å­—æ®µ-æ•ˆç‡">12.2 COUNT(*)ä¸COUNT(å…·ä½“å­—æ®µ)æ•ˆç‡</h3><p>é—®ï¼šåœ¨ MySQL ä¸­ç»Ÿè®¡æ•°æ®è¡¨çš„è¡Œæ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¸‰ç§æ–¹å¼ï¼š SELECT COUNT(*) ã€ SELECT COUNT(1) å’Œ SELECT COUNT(å…·ä½“å­—æ®µ) ï¼Œä½¿ç”¨è¿™ä¸‰è€…ä¹‹é—´çš„æŸ¥è¯¢æ•ˆç‡æ˜¯æ€æ ·çš„ï¼Ÿ</p><p>ç­”ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706142648452.png" alt="image-20220706142648452" style="zoom:80%;float:right" /><h3 id="12-3-å…³äºSELECT">12.3 å…³äºSELECT(*)</h3><p>åœ¨è¡¨æŸ¥è¯¢ä¸­ï¼Œå»ºè®®æ˜ç¡®å­—æ®µï¼Œä¸è¦ä½¿ç”¨ * ä½œä¸ºæŸ¥è¯¢çš„å­—æ®µåˆ—è¡¨ï¼Œæ¨èä½¿ç”¨SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢ã€‚åŸå› ï¼š</p><p>â‘  MySQL åœ¨è§£æçš„è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡æŸ¥è¯¢æ•°æ®å­—å…¸ å°†&quot;*&quot;æŒ‰åºè½¬æ¢æˆæ‰€æœ‰åˆ—åï¼Œè¿™ä¼šå¤§å¤§çš„è€—è´¹èµ„æºå’Œæ—¶é—´ã€‚</p><p>â‘¡ æ— æ³•ä½¿ç”¨ è¦†ç›–ç´¢å¼•</p><h3 id="12-4-LIMIT-1-å¯¹ä¼˜åŒ–çš„å½±å“">12.4 LIMIT 1 å¯¹ä¼˜åŒ–çš„å½±å“</h3><p>é’ˆå¯¹çš„æ˜¯ä¼šæ‰«æå…¨è¡¨çš„ SQL è¯­å¥ï¼Œå¦‚æœä½ å¯ä»¥ç¡®å®šç»“æœé›†åªæœ‰ä¸€æ¡ï¼Œé‚£ä¹ˆåŠ ä¸Š LIMIT 1 çš„æ—¶å€™ï¼Œå½“æ‰¾åˆ°ä¸€æ¡ç»“æœçš„æ—¶å€™å°±ä¸ä¼šç»§ç»­æ‰«æäº†ï¼Œè¿™æ ·ä¼šåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>å¦‚æœæ•°æ®è¡¨å·²ç»å¯¹å­—æ®µå»ºç«‹äº†å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸ä¼šå…¨è¡¨æ‰«æçš„è¯ï¼Œå°±ä¸éœ€è¦åŠ ä¸Š LIMIT 1 äº†ã€‚</p><h3 id="12-5-å¤šä½¿ç”¨COMMIT">12.5 å¤šä½¿ç”¨COMMIT</h3><p>åªè¦æœ‰å¯èƒ½ï¼Œåœ¨ç¨‹åºä¸­å°½é‡å¤šä½¿ç”¨ COMMITï¼Œè¿™æ ·ç¨‹åºçš„æ€§èƒ½å¾—åˆ°æé«˜ï¼Œéœ€æ±‚ä¹Ÿä¼šå› ä¸º COMMIT æ‰€é‡Šæ”¾ çš„èµ„æºè€Œå‡å°‘ã€‚</p><p>COMMIT æ‰€é‡Šæ”¾çš„èµ„æºï¼š</p><ul><li>å›æ»šæ®µä¸Šç”¨äºæ¢å¤æ•°æ®çš„ä¿¡æ¯</li><li>è¢«ç¨‹åºè¯­å¥è·å¾—çš„é”</li><li>redo / undo log buffer ä¸­çš„ç©ºé—´</li><li>ç®¡ç†ä¸Šè¿° 3 ç§èµ„æºä¸­çš„å†…éƒ¨èŠ±è´¹</li></ul><hr><h2 id="13-æ·˜å®æ•°æ®åº“ä¸»é”®å¦‚ä½•è®¾è®¡ï¼Ÿ">13. æ·˜å®æ•°æ®åº“ä¸»é”®å¦‚ä½•è®¾è®¡ï¼Ÿ</h2><p>èŠä¸€ä¸ªå®é™…é—®é¢˜ï¼šæ·˜å®çš„æ•°æ®åº“ï¼Œä¸»é”®æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</p><p>æŸäº›é”™çš„ç¦»è°±çš„ç­”æ¡ˆè¿˜åœ¨ç½‘ä¸Šå¹´å¤ä¸€å¹´çš„æµä¼ ç€ï¼Œç”šè‡³è¿˜æˆä¸ºäº†æ‰€è°“çš„MySQLå†›è§„ã€‚å…¶ä¸­ï¼Œä¸€ä¸ªæœ€æ˜æ˜¾çš„é”™è¯¯å°±æ˜¯å…³äºMySQLçš„ä¸»é”®è®¾è®¡ã€‚</p><p>å¤§éƒ¨åˆ†äººçš„å›ç­”å¦‚æ­¤è‡ªä¿¡ï¼šç”¨8å­—èŠ‚çš„ BIGINT åšä¸»é”®ï¼Œè€Œä¸è¦ç”¨INTã€‚<code>é”™</code>ï¼</p><p>è¿™æ ·çš„å›ç­”ï¼Œåªç«™åœ¨äº†æ•°æ®åº“è¿™ä¸€å±‚ï¼Œè€Œæ²¡æœ‰<code>ä»ä¸šåŠ¡çš„è§’åº¦</code>æ€è€ƒä¸»é”®ã€‚ä¸»é”®å°±æ˜¯ä¸€ä¸ªè‡ªå¢IDå—ï¼Ÿç«™åœ¨ 2022å¹´çš„æ–°å¹´æ¡£å£ï¼Œç”¨è‡ªå¢åšä¸»é”®ï¼Œæ¶æ„è®¾è®¡ä¸Šå¯èƒ½<code>è¿åŠæ ¼éƒ½æ‹¿ä¸åˆ°</code>ã€‚</p><h3 id="13-1-è‡ªå¢IDçš„é—®é¢˜">13.1 è‡ªå¢IDçš„é—®é¢˜</h3><p>è‡ªå¢IDåšä¸»é”®ï¼Œç®€å•æ˜“æ‡‚ï¼Œå‡ ä¹æ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒè‡ªå¢ç±»å‹ï¼Œåªæ˜¯å®ç°ä¸Šå„è‡ªæœ‰æ‰€ä¸åŒè€Œå·²ã€‚è‡ªå¢IDé™¤ äº†ç®€å•ï¼Œå…¶ä»–éƒ½æ˜¯ç¼ºç‚¹ï¼Œæ€»ä½“æ¥çœ‹å­˜åœ¨ä»¥ä¸‹å‡ æ–¹é¢çš„é—®é¢˜ï¼š</p><ol><li><p><strong>å¯é æ€§ä¸é«˜</strong></p><p>å­˜åœ¨è‡ªå¢IDå›æº¯çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜ç›´åˆ°æœ€æ–°ç‰ˆæœ¬çš„MySQL 8.0æ‰ä¿®å¤ã€‚</p></li><li><p>**å®‰å…¨æ€§ä¸é«˜ **</p><p>å¯¹å¤–æš´éœ²çš„æ¥å£å¯ä»¥éå¸¸å®¹æ˜“çŒœæµ‹å¯¹åº”çš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š/User/1/è¿™æ ·çš„æ¥å£ï¼Œå¯ä»¥éå¸¸å®¹æ˜“çŒœæµ‹ç”¨æˆ·IDçš„ å€¼ä¸ºå¤šå°‘ï¼Œæ€»ç”¨æˆ·æ•°é‡æœ‰å¤šå°‘ï¼Œä¹Ÿå¯ä»¥éå¸¸å®¹æ˜“åœ°é€šè¿‡æ¥å£è¿›è¡Œæ•°æ®çš„çˆ¬å–ã€‚</p></li><li><p><strong>æ€§èƒ½å·®</strong></p><p>è‡ªå¢IDçš„æ€§èƒ½è¾ƒå·®ï¼Œéœ€è¦åœ¨æ•°æ®åº“æœåŠ¡å™¨ç«¯ç”Ÿæˆã€‚</p></li><li><p><strong>äº¤äº’å¤š</strong></p><p>ä¸šåŠ¡è¿˜éœ€è¦é¢å¤–æ‰§è¡Œä¸€æ¬¡ç±»ä¼¼ last_insert_id() çš„å‡½æ•°æ‰èƒ½çŸ¥é“åˆšæ‰æ’å…¥çš„è‡ªå¢å€¼ï¼Œè¿™éœ€è¦å¤šä¸€æ¬¡çš„ ç½‘ç»œäº¤äº’ã€‚åœ¨æµ·é‡å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œå¤š1æ¡SQLï¼Œå°±å¤šä¸€æ¬¡æ€§èƒ½ä¸Šçš„å¼€é”€ã€‚</p></li><li><p>**å±€éƒ¨å”¯ä¸€æ€§ **</p><p>æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œè‡ªå¢IDæ˜¯å±€éƒ¨å”¯ä¸€ï¼Œåªåœ¨å½“å‰æ•°æ®åº“å®ä¾‹ä¸­å”¯ä¸€ï¼Œè€Œä¸æ˜¯å…¨å±€å”¯ä¸€ï¼Œåœ¨ä»»æ„æœåŠ¡å™¨é—´éƒ½ æ˜¯å”¯ä¸€çš„ã€‚å¯¹äºç›®å‰åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ç®€ç›´å°±æ˜¯å™©æ¢¦ã€‚</p></li></ol><h3 id="13-2-ä¸šåŠ¡å­—æ®µåšä¸»é”®">13.2 ä¸šåŠ¡å­—æ®µåšä¸»é”®</h3><p>ä¸ºäº†èƒ½å¤Ÿå”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªä¼šå‘˜çš„ä¿¡æ¯ï¼Œéœ€è¦ä¸º ä¼šå‘˜ä¿¡æ¯è¡¨ è®¾ç½®ä¸€ä¸ªä¸»é”®ã€‚é‚£ä¹ˆï¼Œæ€ä¹ˆä¸ºè¿™ä¸ªè¡¨è®¾ç½®ä¸» é”®ï¼Œæ‰èƒ½è¾¾åˆ°æˆ‘ä»¬ç†æƒ³çš„ç›®æ ‡å‘¢ï¼Ÿ è¿™é‡Œæˆ‘ä»¬è€ƒè™‘ä¸šåŠ¡å­—æ®µåšä¸»é”®ã€‚</p><p>è¡¨æ•°æ®å¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706151506580.png" alt="image-20220706151506580"></p><p>åœ¨è¿™ä¸ªè¡¨é‡Œï¼Œå“ªä¸ªå­—æ®µæ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿ</p><ul><li><strong>é€‰æ‹©å¡å·ï¼ˆcardnoï¼‰</strong></li></ul><p>ä¼šå‘˜å¡å·ï¼ˆcardnoï¼‰çœ‹èµ·æ¥æ¯”è¾ƒåˆé€‚ï¼Œå› ä¸ºä¼šå‘˜å¡å·ä¸èƒ½ä¸ºç©ºï¼Œè€Œä¸”æœ‰å”¯ä¸€æ€§ï¼Œå¯ä»¥ç”¨æ¥æ ‡è¯†ä¸€æ¡ä¼šå‘˜ è®°å½•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> demo.membermaster</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> (</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> cardno <span class="type">CHAR</span>(<span class="number">8</span>) <span class="keyword">PRIMARY</span> KEY, <span class="comment">-- ä¼šå‘˜å¡å·ä¸ºä¸»é”®</span></span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> membername TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> memberphone TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> memberpid TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> memberaddress TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> sex TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> birthday DATETIME</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> );</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.06</span> sec)</span><br></pre></td></tr></table></figure><p>ä¸åŒçš„ä¼šå‘˜å¡å·å¯¹åº”ä¸åŒçš„ä¼šå‘˜ï¼Œå­—æ®µâ€œcardnoâ€å”¯ä¸€åœ°æ ‡è¯†æŸä¸€ä¸ªä¼šå‘˜ã€‚å¦‚æœéƒ½æ˜¯è¿™æ ·ï¼Œä¼šå‘˜å¡å·ä¸ä¼šå‘˜ä¸€ä¸€å¯¹åº”ï¼Œç³»ç»Ÿæ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ã€‚</p><p>ä½†å®é™…æƒ…å†µæ˜¯ï¼Œ ä¼šå‘˜å¡å·å¯èƒ½å­˜åœ¨é‡å¤ä½¿ç”¨çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œå¼ ä¸‰å› ä¸ºå·¥ä½œå˜åŠ¨æ¬ç¦»äº†åŸæ¥çš„åœ°å€ï¼Œä¸å† åˆ°å•†å®¶çš„é—¨åº—æ¶ˆè´¹äº† ï¼ˆé€€è¿˜äº†ä¼šå‘˜å¡ï¼‰ï¼Œäºæ˜¯å¼ ä¸‰å°±ä¸å†æ˜¯è¿™ä¸ªå•†å®¶é—¨åº—çš„ä¼šå‘˜äº†ã€‚ä½†æ˜¯ï¼Œå•†å®¶ä¸æƒ³è®© è¿™ä¸ªä¼š å‘˜å¡ç©ºç€ï¼Œå°±æŠŠå¡å·æ˜¯â€œ10000001â€çš„ä¼šå‘˜å¡å‘ç»™äº†ç‹äº”ã€‚</p><p>ä»ç³»ç»Ÿè®¾è®¡çš„è§’åº¦çœ‹ï¼Œè¿™ä¸ªå˜åŒ–åªæ˜¯ä¿®æ”¹äº†ä¼šå‘˜ä¿¡æ¯è¡¨ä¸­çš„å¡å·æ˜¯â€œ10000001â€è¿™ä¸ªä¼šå‘˜ ä¿¡æ¯ï¼Œå¹¶ä¸ä¼šå½± å“åˆ°æ•°æ®ä¸€è‡´æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®æ”¹ä¼šå‘˜å¡å·æ˜¯â€œ10000001â€çš„ä¼šå‘˜ä¿¡æ¯ï¼Œ ç³»ç»Ÿçš„å„ä¸ªæ¨¡å—ï¼Œéƒ½ä¼šè·å–åˆ°ä¿® æ”¹åçš„ä¼šå‘˜ä¿¡æ¯ï¼Œä¸ä¼šå‡ºç°â€œæœ‰çš„æ¨¡å—è·å–åˆ°ä¿®æ”¹ä¹‹å‰çš„ä¼šå‘˜ä¿¡æ¯ï¼Œæœ‰çš„æ¨¡å—è·å–åˆ°ä¿®æ”¹åçš„ä¼šå‘˜ä¿¡æ¯ï¼Œ è€Œå¯¼è‡´ç³»ç»Ÿå†…éƒ¨æ•°æ®ä¸ä¸€è‡´â€çš„æƒ…å†µã€‚å› æ­¤ï¼Œä» ä¿¡æ¯ç³»ç»Ÿå±‚é¢ ä¸Šçœ‹æ˜¯æ²¡é—®é¢˜çš„ã€‚</p><p>ä½†æ˜¯ä»ä½¿ç”¨ ç³»ç»Ÿçš„ä¸šåŠ¡å±‚é¢ æ¥çœ‹ï¼Œå°±æœ‰å¾ˆå¤§çš„é—®é¢˜ äº†ï¼Œä¼šå¯¹å•†å®¶é€ æˆå½±å“ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé”€å”®æµæ°´è¡¨ï¼ˆtransï¼‰ï¼Œè®°å½•äº†æ‰€æœ‰çš„é”€å”®æµæ°´æ˜ç»†ã€‚2020 å¹´ 12 æœˆ 01 æ—¥ï¼Œå¼ ä¸‰åœ¨é—¨åº— è´­ä¹°äº†ä¸€æœ¬ä¹¦ï¼Œæ¶ˆè´¹äº† 89 å…ƒã€‚é‚£ä¹ˆï¼Œç³»ç»Ÿä¸­å°±æœ‰äº†å¼ ä¸‰ä¹°ä¹¦çš„æµæ°´è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706151715106.png" alt="image-20220706151715106"></p><p>æ¥ç€ï¼Œæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹ 2020 å¹´ 12 æœˆ 01 æ—¥çš„ä¼šå‘˜é”€å”®è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> b.membername,c.goodsname,a.quantity,a.salesvalue,a.transdate</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> demo.trans <span class="keyword">AS</span> a</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span> demo.membermaster <span class="keyword">AS</span> b</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span> demo.goodsmaster <span class="keyword">AS</span> c</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ON</span> (a.cardno <span class="operator">=</span> b.cardno <span class="keyword">AND</span> a.itemnumber<span class="operator">=</span>c.itemnumber);</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> membername <span class="operator">|</span> goodsname <span class="operator">|</span> quantity <span class="operator">|</span> salesvalue <span class="operator">|</span> transdate <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>     å¼ ä¸‰   <span class="operator">|</span> ä¹¦         <span class="operator">|</span> <span class="number">1.000</span>    <span class="operator">|</span> <span class="number">89.00</span>      <span class="operator">|</span> <span class="number">2020</span><span class="number">-12</span><span class="number">-01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>å¦‚æœä¼šå‘˜å¡â€œ10000001â€åˆå‘ç»™äº†ç‹äº”ï¼Œæˆ‘ä»¬ä¼šæ›´æ”¹ä¼šå‘˜ä¿¡æ¯è¡¨ã€‚å¯¼è‡´æŸ¥è¯¢æ—¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> b.membername,c.goodsname,a.quantity,a.salesvalue,a.transdate</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> demo.trans <span class="keyword">AS</span> a</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span> demo.membermaster <span class="keyword">AS</span> b</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span> demo.goodsmaster <span class="keyword">AS</span> c</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ON</span> (a.cardno <span class="operator">=</span> b.cardno <span class="keyword">AND</span> a.itemnumber<span class="operator">=</span>c.itemnumber);</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> membername <span class="operator">|</span> goodsname <span class="operator">|</span> quantity <span class="operator">|</span> salesvalue <span class="operator">|</span> transdate <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> ç‹äº”        <span class="operator">|</span> ä¹¦        <span class="operator">|</span> <span class="number">1.000</span>    <span class="operator">|</span> <span class="number">89.00</span>      <span class="operator">|</span> <span class="number">2020</span><span class="number">-12</span><span class="number">-01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡å¾—åˆ°çš„ç»“æœæ˜¯ï¼šç‹äº”åœ¨ 2020 å¹´ 12 æœˆ 01 æ—¥ï¼Œä¹°äº†ä¸€æœ¬ä¹¦ï¼Œæ¶ˆè´¹ 89 å…ƒã€‚æ˜¾ç„¶æ˜¯é”™è¯¯çš„ï¼ç»“è®ºï¼šåƒä¸‡ ä¸èƒ½æŠŠä¼šå‘˜å¡å·å½“åšä¸»é”®ã€‚</p><ul><li><strong>é€‰æ‹©ä¼šå‘˜ç”µè¯ æˆ– èº«ä»½è¯å·</strong></li></ul><p>ä¼šå‘˜ç”µè¯å¯ä»¥åšä¸»é”®å—ï¼Ÿä¸è¡Œçš„ã€‚åœ¨å®é™…æ“ä½œä¸­ï¼Œæ‰‹æœºå·ä¹Ÿå­˜åœ¨ è¢«è¿è¥å•†æ”¶å› ï¼Œé‡æ–°å‘ç»™åˆ«äººç”¨çš„æƒ…å†µã€‚</p><p>é‚£èº«ä»½è¯å·è¡Œä¸è¡Œå‘¢ï¼Ÿå¥½åƒå¯ä»¥ã€‚å› ä¸ºèº«ä»½è¯å†³ä¸ä¼šé‡å¤ï¼Œèº«ä»½è¯å·ä¸ä¸€ä¸ªäººå­˜åœ¨ä¸€ä¸€å¯¹ åº”çš„å…³ç³»ã€‚å¯ é—®é¢˜æ˜¯ï¼Œèº«ä»½è¯å·å±äº ä¸ªäººéšç§ ï¼Œé¡¾å®¢ä¸ä¸€å®šæ„¿æ„ç»™ä½ ã€‚è¦æ˜¯å¼ºåˆ¶è¦æ±‚ä¼šå‘˜å¿…é¡»ç™»è®°èº«ä»½è¯å·ï¼Œä¼šæŠŠå¾ˆ å¤šå®¢äººèµ¶è·‘çš„ã€‚å…¶å®ï¼Œå®¢æˆ·ç”µè¯ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è®¾è®¡ä¼šå‘˜ä¿¡æ¯è¡¨çš„æ—¶å€™ï¼Œå…è®¸èº«ä»½è¯å·å’Œ ç”µè¯éƒ½ä¸ºç©ºçš„åŸå› ã€‚</p><p><strong>æ‰€ä»¥ï¼Œå»ºè®®å°½é‡ä¸è¦ç”¨è·Ÿä¸šåŠ¡æœ‰å…³çš„å­—æ®µåšä¸»é”®ã€‚æ¯•ç«Ÿï¼Œä½œä¸ºé¡¹ç›®è®¾è®¡çš„æŠ€æœ¯äººå‘˜ï¼Œæˆ‘ä»¬è°ä¹Ÿæ— æ³•é¢„æµ‹ åœ¨é¡¹ç›®çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå“ªä¸ªä¸šåŠ¡å­—æ®µä¼šå› ä¸ºé¡¹ç›®çš„ä¸šåŠ¡éœ€æ±‚è€Œæœ‰é‡å¤ï¼Œæˆ–è€…é‡ç”¨ä¹‹ç±»çš„æƒ…å†µå‡ºç°ã€‚</strong></p><blockquote><p>ç»éªŒï¼š åˆšå¼€å§‹ä½¿ç”¨ MySQL æ—¶ï¼Œå¾ˆå¤šäººéƒ½å¾ˆå®¹æ˜“çŠ¯çš„é”™è¯¯æ˜¯å–œæ¬¢ç”¨ä¸šåŠ¡å­—æ®µåšä¸»é”®ï¼Œæƒ³å½“ç„¶åœ°è®¤ä¸ºäº†è§£ä¸š åŠ¡éœ€æ±‚ï¼Œä½†å®é™…æƒ…å†µå¾€å¾€å‡ºä¹æ„æ–™ï¼Œè€Œæ›´æ”¹ä¸»é”®è®¾ç½®çš„æˆæœ¬éå¸¸é«˜ã€‚</p></blockquote><h3 id="13-3-æ·˜å®çš„ä¸»é”®è®¾è®¡">13.3 æ·˜å®çš„ä¸»é”®è®¾è®¡</h3><p>åœ¨æ·˜å®çš„ç”µå•†ä¸šåŠ¡ä¸­ï¼Œè®¢å•æœåŠ¡æ˜¯ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡ã€‚è¯·é—®ï¼Œè®¢å•è¡¨çš„ä¸»é”®æ·˜å®æ˜¯å¦‚ä½•è®¾è®¡çš„å‘¢ï¼Ÿæ˜¯è‡ªå¢ID å—ï¼Ÿ</p><p>æ‰“å¼€æ·˜å®ï¼Œçœ‹ä¸€ä¸‹è®¢å•ä¿¡æ¯ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706161436920.png" alt="image-20220706161436920"></p><p>ä»ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œè®¢å•å·ä¸æ˜¯è‡ªå¢IDï¼æˆ‘ä»¬è¯¦ç»†çœ‹ä¸‹ä¸Šè¿°4ä¸ªè®¢å•å·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1550672064762308113</span></span><br><span class="line"><span class="number">1481195847180308113</span></span><br><span class="line"><span class="number">1431156171142308113</span></span><br><span class="line"><span class="number">1431146631521308113</span></span><br></pre></td></tr></table></figure><p>è®¢å•å·æ˜¯19ä½çš„é•¿åº¦ï¼Œä¸”è®¢å•çš„æœ€å5ä½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯08113ã€‚ä¸”è®¢å•å·çš„å‰é¢14ä½éƒ¨åˆ†æ˜¯å•è°ƒé€’å¢çš„ã€‚</p><p>å¤§èƒ†çŒœæµ‹ï¼Œæ·˜å®çš„è®¢å•IDè®¾è®¡åº”è¯¥æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è®¢å•ID <span class="operator">=</span> æ—¶é—´ <span class="operator">+</span> å»é‡å­—æ®µ <span class="operator">+</span> ç”¨æˆ·IDå<span class="number">6</span>ä½å°¾å·</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è®¾è®¡èƒ½åšåˆ°å…¨å±€å”¯ä¸€ï¼Œä¸”å¯¹åˆ†å¸ƒå¼ç³»ç»ŸæŸ¥è¯¢åŠå…¶å‹å¥½ã€‚</p><h3 id="13-4-æ¨èçš„ä¸»é”®è®¾è®¡">13.4 æ¨èçš„ä¸»é”®è®¾è®¡</h3><p><strong>éæ ¸å¿ƒä¸šåŠ¡</strong> ï¼šå¯¹åº”è¡¨çš„ä¸»é”®è‡ªå¢IDï¼Œå¦‚å‘Šè­¦ã€æ—¥å¿—ã€ç›‘æ§ç­‰ä¿¡æ¯ã€‚</p><p><strong>æ ¸å¿ƒä¸šåŠ¡</strong> ï¼š<code>ä¸»é”®è®¾è®¡è‡³å°‘åº”è¯¥æ˜¯å…¨å±€å”¯ä¸€ä¸”æ˜¯å•è°ƒé€’å¢</code>ã€‚å…¨å±€å”¯ä¸€ä¿è¯åœ¨å„ç³»ç»Ÿä¹‹é—´éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå•è°ƒ é€’å¢æ˜¯å¸Œæœ›æ’å…¥æ—¶ä¸å½±å“æ•°æ®åº“æ€§èƒ½ã€‚</p><p>è¿™é‡Œæ¨èæœ€ç®€å•çš„ä¸€ç§ä¸»é”®è®¾è®¡ï¼šUUIDã€‚</p><p><strong>UUIDçš„ç‰¹ç‚¹ï¼š</strong></p><p>å…¨å±€å”¯ä¸€ï¼Œå ç”¨36å­—èŠ‚ï¼Œæ•°æ®æ— åºï¼Œæ’å…¥æ€§èƒ½å·®ã€‚</p><p><strong>è®¤è¯†UUIDï¼š</strong></p><ul><li>ä¸ºä»€ä¹ˆUUIDæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆUUIDå ç”¨36ä¸ªå­—èŠ‚ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆUUIDæ˜¯æ— åºçš„ï¼Ÿ</li></ul><p>MySQLæ•°æ®åº“çš„UUIDç»„æˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID <span class="operator">=</span> æ—¶é—´<span class="operator">+</span>UUIDç‰ˆæœ¬ï¼ˆ<span class="number">16</span>å­—èŠ‚ï¼‰<span class="operator">-</span> æ—¶é’Ÿåºåˆ—ï¼ˆ<span class="number">4</span>å­—èŠ‚ï¼‰ <span class="operator">-</span> MACåœ°å€ï¼ˆ<span class="number">12</span>å­—èŠ‚ï¼‰</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»¥UUIDå€¼e0ea12d4-6473-11eb-943c-00155dbaa39dä¸¾ä¾‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706162131362.png" alt="image-20220706162131362"></p><p><code>ä¸ºä»€ä¹ˆUUIDæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Ÿ</code></p><p>åœ¨UUIDä¸­æ—¶é—´éƒ¨åˆ†å ç”¨60ä½ï¼Œå­˜å‚¨çš„ç±»ä¼¼TIMESTAMPçš„æ—¶é—´æˆ³ï¼Œä½†è¡¨ç¤ºçš„æ˜¯ä»1582-10-15 00ï¼š00ï¼š00.00 åˆ°ç°åœ¨çš„100nsçš„è®¡æ•°ã€‚å¯ä»¥çœ‹åˆ°UUIDå­˜å‚¨çš„æ—¶é—´ç²¾åº¦æ¯”TIMESTAMPEæ›´é«˜ï¼Œæ—¶é—´ç»´åº¦å‘ç”Ÿé‡å¤çš„æ¦‚ç‡é™ ä½åˆ°1/100nsã€‚</p><p>æ—¶é’Ÿåºåˆ—æ˜¯ä¸ºäº†é¿å…æ—¶é’Ÿè¢«å›æ‹¨å¯¼è‡´äº§ç”Ÿæ—¶é—´é‡å¤çš„å¯èƒ½æ€§ã€‚MACåœ°å€ç”¨äºå…¨å±€å”¯ä¸€ã€‚</p><p><code>ä¸ºä»€ä¹ˆUUIDå ç”¨36ä¸ªå­—èŠ‚ï¼Ÿ</code></p><p>UUIDæ ¹æ®å­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨ï¼Œè®¾è®¡æ—¶è¿˜å¸¦æœ‰æ— ç”¨&quot;-&quot;å­—ç¬¦ä¸²ï¼Œå› æ­¤æ€»å…±éœ€è¦36ä¸ªå­—èŠ‚ã€‚</p><p><code>ä¸ºä»€ä¹ˆUUIDæ˜¯éšæœºæ— åºçš„å‘¢ï¼Ÿ</code></p><p>å› ä¸ºUUIDçš„è®¾è®¡ä¸­ï¼Œå°†æ—¶é—´ä½ä½æ”¾åœ¨æœ€å‰é¢ï¼Œè€Œè¿™éƒ¨åˆ†çš„æ•°æ®æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ï¼Œå¹¶ä¸”æ˜¯æ— åºã€‚</p><p><strong>æ”¹é€ UUID</strong></p><p>è‹¥å°†æ—¶é—´é«˜ä½ä½äº’æ¢ï¼Œåˆ™æ—¶é—´å°±æ˜¯å•è°ƒé€’å¢çš„äº†ï¼Œä¹Ÿå°±å˜å¾—å•è°ƒé€’å¢äº†ã€‚MySQL 8.0å¯ä»¥æ›´æ¢æ—¶é—´ä½ä½å’Œæ—¶é—´é«˜ä½çš„å­˜å‚¨æ–¹å¼ï¼Œè¿™æ ·UUIDå°±æ˜¯æœ‰åºçš„UUIDäº†ã€‚</p><p>MySQL 8.0è¿˜è§£å†³äº†UUIDå­˜åœ¨çš„ç©ºé—´å ç”¨çš„é—®é¢˜ï¼Œé™¤å»äº†UUIDå­—ç¬¦ä¸²ä¸­æ— æ„ä¹‰çš„&quot;-&quot;å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å°†å­—ç¬¦ä¸²ç”¨äºŒè¿›åˆ¶ç±»å‹ä¿å­˜ï¼Œè¿™æ ·å­˜å‚¨ç©ºé—´é™ä½ä¸ºäº†16å­—èŠ‚ã€‚</p><p>å¯ä»¥é€šè¿‡MySQL8.0æä¾›çš„uuid_to_binå‡½æ•°å®ç°ä¸Šè¿°åŠŸèƒ½ï¼ŒåŒæ ·çš„ï¼ŒMySQLä¹Ÿæä¾›äº†bin_to_uuidå‡½æ•°è¿›è¡Œè½¬åŒ–ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@uuid</span> <span class="operator">=</span> UUID();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@uuid</span>,uuid_to_bin(<span class="variable">@uuid</span>),uuid_to_bin(<span class="variable">@uuid</span>,<span class="literal">TRUE</span>);</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706162657448.png" alt="image-20220706162657448"></p><p><strong>é€šè¿‡å‡½æ•°uuid_to_bin(@uuid,true)å°†UUIDè½¬åŒ–ä¸ºæœ‰åºUUIDäº†</strong>ã€‚å…¨å±€å”¯ä¸€ + å•è°ƒé€’å¢ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸»é”®ï¼</p><p><strong>æœ‰åºUUIDæ€§èƒ½æµ‹è¯•</strong></p><p>16å­—èŠ‚çš„æœ‰åºUUIDï¼Œç›¸æ¯”ä¹‹å‰8å­—èŠ‚çš„è‡ªå¢IDï¼Œæ€§èƒ½å’Œå­˜å‚¨ç©ºé—´å¯¹æ¯”ç©¶ç«Ÿå¦‚ä½•å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥åšä¸€ä¸ªæµ‹è¯•ï¼Œæ’å…¥1äº¿æ¡æ•°æ®ï¼Œæ¯æ¡æ•°æ®å ç”¨500å­—èŠ‚ï¼Œå«æœ‰3ä¸ªäºŒçº§ç´¢å¼•ï¼Œæœ€ç»ˆçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220706162947613.png" alt="image-20220706162947613" style="zoom:67%;" /><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ’å…¥1äº¿æ¡æ•°æ®æœ‰åºUUIDæ˜¯æœ€å¿«çš„ï¼Œè€Œä¸”åœ¨å®é™…ä¸šåŠ¡ä½¿ç”¨ä¸­æœ‰åºUUIDåœ¨<code>ä¸šåŠ¡ç«¯å°±å¯ä»¥ç”Ÿæˆ</code>ã€‚è¿˜å¯ä»¥è¿›ä¸€æ­¥å‡å°‘SQLçš„äº¤äº’æ¬¡æ•°ã€‚</p><p>å¦å¤–ï¼Œè™½ç„¶æœ‰åºUUIDç›¸æ¯”è‡ªå¢IDå¤šäº†8ä¸ªå­—èŠ‚ï¼Œä½†å®é™…åªå¢å¤§äº†3Gçš„å­˜å‚¨ç©ºé—´ï¼Œè¿˜å¯ä»¥æ¥å—ã€‚</p><blockquote><p>åœ¨å½“ä»Šçš„äº’è”ç½‘ç¯å¢ƒä¸­ï¼Œéå¸¸ä¸æ¨èè‡ªå¢IDä½œä¸ºä¸»é”®çš„æ•°æ®åº“è®¾è®¡ã€‚æ›´æ¨èç±»ä¼¼æœ‰åºUUIDçš„å…¨å±€ å”¯ä¸€çš„å®ç°ã€‚</p><p>å¦å¤–åœ¨çœŸå®çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¸»é”®è¿˜å¯ä»¥åŠ å…¥ä¸šåŠ¡å’Œç³»ç»Ÿå±æ€§ï¼Œå¦‚ç”¨æˆ·çš„å°¾å·ï¼Œæœºæˆ¿çš„ä¿¡æ¯ç­‰ã€‚è¿™æ · çš„ä¸»é”®è®¾è®¡å°±æ›´ä¸ºè€ƒéªŒæ¶æ„å¸ˆçš„æ°´å¹³äº†ã€‚</p></blockquote><p><strong>å¦‚æœä¸æ˜¯MySQL8.0 è‚¿ä¹ˆåŠï¼Ÿ</strong></p><p>æ‰‹åŠ¨èµ‹å€¼å­—æ®µåšä¸»é”®ï¼</p><p>æ¯”å¦‚ï¼Œè®¾è®¡å„ä¸ªåˆ†åº—çš„ä¼šå‘˜è¡¨çš„ä¸»é”®ï¼Œå› ä¸ºå¦‚æœæ¯å°æœºå™¨å„è‡ªäº§ç”Ÿçš„æ•°æ®éœ€è¦åˆå¹¶ï¼Œå°±å¯èƒ½ä¼šå‡ºç°ä¸»é”®é‡å¤çš„é—®é¢˜ã€‚</p><p>å¯ä»¥åœ¨æ€»éƒ¨ MySQL æ•°æ®åº“ä¸­ï¼Œæœ‰ä¸€ä¸ªç®¡ç†ä¿¡æ¯è¡¨ï¼Œåœ¨è¿™ä¸ªè¡¨ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œä¸“é—¨ç”¨æ¥è®°å½•å½“å‰ä¼šå‘˜ç¼–å·çš„æœ€å¤§å€¼ã€‚</p><p>é—¨åº—åœ¨æ·»åŠ ä¼šå‘˜çš„æ—¶å€™ï¼Œå…ˆåˆ°æ€»éƒ¨ MySQL æ•°æ®åº“ä¸­è·å–è¿™ä¸ªæœ€å¤§å€¼ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸ŠåŠ 1ï¼Œç„¶åç”¨è¿™ä¸ªå€¼ä½œä¸ºæ–°ä¼šå‘˜çš„â€œidâ€ï¼ŒåŒæ—¶ï¼Œæ›´æ–°æ€»éƒ¨ MySQL æ•°æ®åº“ç®¡ç†ä¿¡æ¯è¡¨ä¸­çš„å½“å‰ä¼šå‘˜ç¼–å·çš„æœ€å¤§å€¼ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œå„ä¸ªé—¨åº—æ·»åŠ ä¼šå‘˜çš„æ—¶å€™ï¼Œéƒ½å¯¹åŒä¸€ä¸ªæ€»éƒ¨ MySQL æ•°æ®åº“ä¸­çš„æ•°æ®è¡¨å­—æ®µè¿›è¡Œæ“ä½œï¼Œå°±è§£å†³äº†å„é—¨åº—æ·»åŠ ä¼šå‘˜æ—¶ä¼šå‘˜ç¼–å·å†²çªçš„é—®é¢˜ã€‚</p>]]></content>
    
    
    <summary type="html">ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹åˆ†æã€æŸ¥è¯¢ä¼˜åŒ–</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>å¯»æ‰¾æŒ‡å®šä½ç½®-äºŒåˆ†æ³•</title>
    <link href="https://wuwawawa.github.io/posts/c1110203.html"/>
    <id>https://wuwawawa.github.io/posts/c1110203.html</id>
    <published>2023-04-11T06:49:12.000Z</published>
    <updated>2023-04-18T06:20:49.236Z</updated>
    
    <content type="html"><![CDATA[<h2 id="704-äºŒåˆ†æŸ¥æ‰¾">704. äºŒåˆ†æŸ¥æ‰¾</h2><div class="tag link"><a class="link-card" title="704. äºŒåˆ†æŸ¥æ‰¾" href="https://leetcode.cn/problems/binary-search/"><div class="left"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/leetcode.jpg"/></div><div class="right"><p class="text">704. äºŒåˆ†æŸ¥æ‰¾</p><p class="url">https://leetcode.cn/problems/binary-search/</p></div></a></div><p>ç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target  ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [-1,0,3,5,9,12], target = 9     </span><br><span class="line">è¾“å‡º: 4       </span><br><span class="line">è§£é‡Š: 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4     </span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [-1,0,3,5,9,12], target = 2     </span><br><span class="line">è¾“å‡º: -1        </span><br><span class="line">è§£é‡Š: 2 ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -1        </span><br></pre></td></tr></table></figure><p>æç¤ºï¼š</p><ul><li>ä½ å¯ä»¥å‡è®¾ nums ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯ä¸é‡å¤çš„ã€‚</li><li>n å°†åœ¨ [1, 10000]ä¹‹é—´ã€‚</li><li>nums çš„æ¯ä¸ªå…ƒç´ éƒ½å°†åœ¨ [-9999, 9999]ä¹‹é—´ã€‚</li></ul><hr><h3 id="æ€è·¯">æ€è·¯</h3><p>è¿™é“é¢˜ç›®çš„å‰ææ˜¯æ•°ç»„ä¸º<span class='p blue'>æœ‰åºæ•°ç»„</span>ï¼ŒåŒæ—¶é¢˜ç›®è¿˜å¼ºè°ƒæ•°ç»„ä¸­<span class='p blue'>æ— é‡å¤å…ƒç´ </span>ï¼Œ<span class='p red'>å› ä¸ºä¸€æ—¦æœ‰é‡å¤å…ƒç´ ï¼Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•è¿”å›çš„å…ƒç´ ä¸‹æ ‡å¯èƒ½ä¸æ˜¯å”¯ä¸€çš„</span>ï¼Œè¿™äº›éƒ½æ˜¯ä½¿ç”¨äºŒåˆ†æ³•çš„å‰ææ¡ä»¶ï¼Œå½“å¤§å®¶çœ‹åˆ°é¢˜ç›®æè¿°æ»¡è¶³å¦‚ä¸Šæ¡ä»¶çš„æ—¶å€™ï¼Œå¯è¦æƒ³ä¸€æƒ³æ˜¯ä¸æ˜¯å¯ä»¥ç”¨äºŒåˆ†æ³•äº†ã€‚</p><p>äºŒåˆ†æŸ¥æ‰¾æ¶‰åŠçš„å¾ˆå¤šçš„è¾¹ç•Œæ¡ä»¶ï¼Œé€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä½†å°±æ˜¯å†™ä¸å¥½ã€‚ä¾‹å¦‚åˆ°åº•æ˜¯<code>while(left &lt; right)</code>è¿˜æ˜¯<code>while(left &lt;= right)</code>ï¼Œåˆ°åº•æ˜¯<code>right = middle</code>å‘¢ï¼Œè¿˜æ˜¯è¦<code>right = middle - 1</code>å‘¢ï¼Ÿ</p><p>å¤§å®¶å†™äºŒåˆ†æ³•ç»å¸¸å†™ä¹±ï¼Œä¸»è¦æ˜¯å› ä¸ºå¯¹åŒºé—´çš„å®šä¹‰æ²¡æœ‰æƒ³æ¸…æ¥šï¼Œ<code>åŒºé—´çš„å®šä¹‰å°±æ˜¯ä¸å˜é‡</code>ã€‚è¦åœ¨äºŒåˆ†æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œ<span class='p green'>ä¿æŒä¸å˜é‡ï¼Œå°±æ˜¯åœ¨whileå¯»æ‰¾ä¸­æ¯ä¸€æ¬¡è¾¹ç•Œçš„å¤„ç†éƒ½è¦åšæŒæ ¹æ®åŒºé—´çš„å®šä¹‰æ¥æ“ä½œï¼Œè¿™å°±æ˜¯å¾ªç¯ä¸å˜é‡è§„åˆ™ã€‚</span></p><p>å†™äºŒåˆ†æ³•ï¼ŒåŒºé—´çš„å®šä¹‰ä¸€èˆ¬ä¸ºä¸¤ç§ï¼Œå·¦é—­å³é—­å³[left, right]ï¼Œæˆ–è€…å·¦é—­å³å¼€å³[left, right)ã€‚</p><p>ä¸‹é¢æˆ‘ç”¨è¿™ä¸¤ç§åŒºé—´çš„å®šä¹‰åˆ†åˆ«è®²è§£ä¸¤ç§ä¸åŒçš„äºŒåˆ†å†™æ³•ã€‚</p><hr><h3 id="ä¸¤ç§å†™æ³•">ä¸¤ç§å†™æ³•</h3><div class="tabs" id="062a674c-72e9-4da3-a22b-0dedcc400f23"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#062a674c-72e9-4da3-a22b-0dedcc400f23-1"><i class="fas fa-cat"></i>å·¦é—­å³é—­</button></li><li class="tab"><button type="button" data-href="#062a674c-72e9-4da3-a22b-0dedcc400f23-2"><i class="fas fa-horse"></i>å·¦é—­å³å¼€</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="062a674c-72e9-4da3-a22b-0dedcc400f23-1"><blockquote><p>leftï¼š0</p><p>rightï¼šnums.length - 1</p></blockquote><p>ç¬¬ä¸€ç§å†™æ³•ï¼Œæˆ‘ä»¬å®šä¹‰ target æ˜¯åœ¨ä¸€ä¸ªåœ¨å·¦é—­å³é—­çš„åŒºé—´é‡Œï¼Œä¹Ÿå°±æ˜¯[left, right] ï¼ˆè¿™ä¸ªå¾ˆé‡è¦éå¸¸é‡è¦ï¼‰ã€‚</p><p>åŒºé—´çš„å®šä¹‰è¿™å°±å†³å®šäº†äºŒåˆ†æ³•çš„ä»£ç åº”è¯¥å¦‚ä½•å†™ï¼Œå› ä¸ºå®šä¹‰targetåœ¨[left, right]åŒºé—´ï¼Œæ‰€ä»¥æœ‰å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>while (left &lt;= right) è¦ä½¿ç”¨ &lt;= ï¼Œå› ä¸ºleft == rightæ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ &lt;=</li><li>if (nums[middle] &gt; target) right è¦èµ‹å€¼ä¸º middle - 1ï¼Œå› ä¸ºå½“å‰è¿™ä¸ªnums[middle]ä¸€å®šä¸æ˜¯targetï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦æŸ¥æ‰¾çš„å·¦åŒºé—´ç»“æŸä¸‹æ ‡ä½ç½®å°±æ˜¯ middle - 1</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>; <span class="comment">// å®šä¹‰targetåœ¨å·¦é—­å³é—­çš„åŒºé—´é‡Œï¼Œ[left,right]</span></span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;     <span class="comment">//å½“left==rightï¼ŒåŒºé—´[left,right]ä¾ç„¶æœ‰æ•ˆï¼Œæ‰€ä»¥ç”¨&lt;=</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left)/<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target)</span><br><span class="line">            <span class="keyword">return</span> mid;         <span class="comment">//æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œç›´æ¥è¿”å›ä¸‹æ ‡</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target)</span><br><span class="line">            left = mid + <span class="number">1</span>;     <span class="comment">//target åœ¨å³åŒºé—´ï¼Œæ‰€ä»¥[mid+1,right]</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &gt; target)</span><br><span class="line">            right = mid - <span class="number">1</span>;   <span class="comment">//target åœ¨å·¦åŒºé—´ï¼Œæ‰€ä»¥[left,mid-1]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="062a674c-72e9-4da3-a22b-0dedcc400f23-2"><blockquote><p>leftï¼š0</p><p>rightï¼šnums.length</p></blockquote><p>å¦‚æœè¯´å®šä¹‰ target æ˜¯åœ¨ä¸€ä¸ªåœ¨å·¦é—­å³å¼€çš„åŒºé—´é‡Œï¼Œä¹Ÿå°±æ˜¯[left, right) ï¼Œé‚£ä¹ˆäºŒåˆ†æ³•çš„è¾¹ç•Œå¤„ç†æ–¹å¼åˆ™æˆªç„¶ä¸åŒã€‚</p><p>æœ‰å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>while (left &lt; right)ï¼Œè¿™é‡Œä½¿ç”¨ &lt; ,å› ä¸ºleft == rightåœ¨åŒºé—´[left, right)æ˜¯æ²¡æœ‰æ„ä¹‰çš„</li><li>if (nums[middle] &gt; target) right æ›´æ–°ä¸º middleï¼Œå› ä¸ºå½“å‰nums[middle]ä¸ç­‰äºtargetï¼Œå»å·¦åŒºé—´ç»§ç»­å¯»æ‰¾ï¼Œè€Œå¯»æ‰¾åŒºé—´æ˜¯å·¦é—­å³å¼€åŒºé—´ï¼Œæ‰€ä»¥rightæ›´æ–°ä¸ºmiddleï¼Œå³ï¼šä¸‹ä¸€ä¸ªæŸ¥è¯¢åŒºé—´ä¸ä¼šå»æ¯”è¾ƒnums[middle]</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length;   <span class="comment">// å®šä¹‰targetåœ¨å·¦é—­å³å¼€çš„åŒºé—´é‡Œï¼Œå³[left,right)</span></span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;     <span class="comment">// å› ä¸ºleft == rightçš„æ—¶å€™ï¼Œåœ¨[left,right)æ˜¯æ— æ•ˆçš„åŒºé—´</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target)</span><br><span class="line">            <span class="keyword">return</span> mid;        <span class="comment">// æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œç›´æ¥è¿”å›ä¸‹æ ‡</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target)</span><br><span class="line">            left = mid + <span class="number">1</span>;    <span class="comment">// target åœ¨å³åŒºé—´ï¼Œåœ¨[mid+1, right)ä¸­</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &gt; target)</span><br><span class="line">            right = mid;       <span class="comment">// target åœ¨å·¦åŒºé—´ï¼Œåœ¨[leftï¼Œmid)ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    
    <summary type="html">äºŒåˆ†æŸ¥æ‰¾</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://wuwawawa.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="äºŒåˆ†æŸ¥æ‰¾" scheme="https://wuwawawa.github.io/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"/>
    
  </entry>
  
  <entry>
    <title>æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</title>
    <link href="https://wuwawawa.github.io/posts/2678f2d3.html"/>
    <id>https://wuwawawa.github.io/posts/2678f2d3.html</id>
    <published>2023-04-11T00:00:00.000Z</published>
    <updated>2023-04-18T06:20:49.220Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ•°æ®åº“è°ƒä¼˜ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯<code>å“åº”æ—¶é—´æ›´å¿«, ååé‡æ›´å¤§</code>ã€‚åˆ©ç”¨å®è§‚çš„ç›‘æ§å·¥å…·å’Œå¾®è§‚çš„æ—¥å¿—åˆ†æå¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°è°ƒä¼˜çš„æ€è·¯å’Œæ–¹å¼ã€‚</p><h2 id="1-æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤">1. æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤</h2><p>å½“æˆ‘ä»¬é‡åˆ°æ•°æ®åº“è°ƒä¼˜é—®é¢˜çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•æ€è€ƒå‘¢ï¼Ÿè¿™é‡ŒæŠŠæ€è€ƒçš„æµç¨‹æ•´ç†æˆä¸‹é¢è¿™å¼ å›¾ã€‚</p><p>æ•´ä¸ªæµç¨‹åˆ’åˆ†æˆäº†<code>è§‚å¯Ÿï¼ˆShow statusï¼‰</code>å’Œ<code>è¡ŒåŠ¨ï¼ˆActionï¼‰</code>ä¸¤ä¸ªéƒ¨åˆ†ã€‚å­—æ¯ S çš„éƒ¨åˆ†ä»£è¡¨è§‚å¯Ÿï¼ˆä¼šä½¿ç”¨ç›¸åº”çš„åˆ†æå·¥å…·ï¼‰ï¼Œå­—æ¯ A ä»£è¡¨çš„éƒ¨åˆ†æ˜¯è¡ŒåŠ¨ï¼ˆå¯¹åº”åˆ†æå¯ä»¥é‡‡å–çš„è¡ŒåŠ¨ï¼‰ã€‚</p><div class="tabs" id="791ab877-575f-4606-8648-c45807e777a1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#791ab877-575f-4606-8648-c45807e777a1-1"><i class="fas fa-cat"></i>æµç¨‹å›¾</button></li><li class="tab"><button type="button" data-href="#791ab877-575f-4606-8648-c45807e777a1-2"><i class="fas fa-horse"></i>è§£æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="791ab877-575f-4606-8648-c45807e777a1-1"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/%E6%B5%81%E7%A8%8B%E5%9B%BE%20(2).jpg" alt="æµç¨‹å›¾ (2)" style="zoom:45%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="791ab877-575f-4606-8648-c45807e777a1-2"><p>é¦–å…ˆåœ¨ S1 éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦è§‚å¯ŸæœåŠ¡å™¨çš„çŠ¶æ€æ˜¯å¦<code>å­˜åœ¨å‘¨æœŸæ€§çš„æ³¢åŠ¨</code>ã€‚å¦‚æœå­˜åœ¨å‘¨æœŸæ€§æ³¢åŠ¨ï¼Œæœ‰å¯èƒ½æ˜¯å‘¨æœŸæ€§èŠ‚ç‚¹çš„åŸå› ï¼Œæ¯”å¦‚åŒåä¸€ã€ä¿ƒé”€æ´»åŠ¨ç­‰ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡A1 è¿™ä¸€æ­¥éª¤è§£å†³ï¼Œä¹Ÿå°±æ˜¯åŠ ç¼“å­˜ï¼Œæˆ–è€…æ›´æ”¹ç¼“å­˜å¤±æ•ˆç­–ç•¥ã€‚</p><p>å¦‚æœç¼“å­˜ç­–ç•¥æ²¡æœ‰è§£å†³ï¼Œæˆ–è€…ä¸æ˜¯å‘¨æœŸæ€§æ³¢åŠ¨çš„åŸå› ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›ä¸€æ­¥<code>åˆ†ææŸ¥è¯¢å»¶è¿Ÿå’Œå¡é¡¿çš„åŸå› </code>ã€‚æ¥ä¸‹æ¥è¿›å…¥ s2è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯æ…¢æŸ¥è¯¢ã€‚æ…¢æŸ¥è¯¢å¯ä»¥å¸®æˆ‘ä»¬å®šä½æ‰§è¡Œæ…¢çš„ SQLè¯­å¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®<code>long_query-time</code>å‚æ•°å®šä¹‰â€œæ…¢â€çš„é˜ˆå€¼ï¼Œå¦‚æœ SQLæ‰§è¡Œæ—¶é—´è¶…è¿‡äº† long_query_timeï¼Œåˆ™ä¼šè®¤ä¸ºæ˜¯æ…¢æŸ¥è¯¢ã€‚å½“æ”¶é›†ä¸Šæ¥è¿™äº›æ…¢æŸ¥è¯¢ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åˆ†æå·¥å…·å¯¹æ…¢æŸ¥è¯¢æ—¥å¿—è¿›è¡Œåˆ†æã€‚</p><p>åœ¨S3 è¿™ä¸€æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†æ‰§è¡Œæ…¢çš„ SQLï¼Œè¿™æ ·å°±å¯ä»¥é’ˆå¯¹æ€§åœ°ç”¨<code>EXPLAIN</code>æŸ¥çœ‹å¯¹åº” SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œæˆ–è€…ä½¿ç”¨<code>show profile</code>æŸ¥çœ‹ SQLä¸­æ¯ä¸€ä¸ªæ­¥éª¤çš„æ—¶é—´æˆæœ¬ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥äº†è§£ SQL æŸ¥è¯¢æ…¢æ˜¯å› ä¸ºæ‰§è¡Œæ—¶é—´é•¿ï¼Œè¿˜æ˜¯ç­‰å¾…æ—¶é—´é•¿ã€‚</p><p>å¦‚æœæ˜¯ SQLç­‰å¾…æ—¶é—´é•¿ï¼Œæˆ‘ä»¬è¿›å…¥A2 æ­¥éª¤ã€‚åœ¨è¿™ä¸€æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥<code>è°ƒä¼˜æœåŠ¡å™¨çš„å‚æ•°</code>ï¼Œæ¯”å¦‚é€‚å½“å¢åŠ æ•°æ®åº“ç¼“å†²æ± ç­‰ã€‚å¦‚æœæ˜¯SQLæ‰§è¡Œæ—¶é—´é•¿ï¼Œå°±è¿›å…¥A3 æ­¥éª¤ï¼Œè¿™ä¸€æ­¥ä¸­æˆ‘ä»¬éœ€è¦è€ƒè™‘æ˜¯ç´¢å¼•è®¾è®¡çš„é—®é¢˜ï¼Ÿè¿˜æ˜¯æŸ¥è¯¢å…³è”çš„æ•°æ®è¡¨è¿‡å¤šï¼Ÿè¿˜æ˜¯å› ä¸ºæ•°æ®è¡¨çš„å­—æ®µè®¾è®¡é—®é¢˜å¯¼è‡´äº†è¿™ä¸€ç°è±¡ã€‚ç„¶ååœ¨è¿™äº›ç»´åº¦ä¸Šè¿›è¡Œå¯¹åº”çš„è°ƒæ•´ã€‚</p><p>å¦‚æœ A2 å’Œ A3 éƒ½ä¸èƒ½è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ•°æ®åº“è‡ªèº«çš„ SQL æŸ¥è¯¢æ€§èƒ½æ˜¯å¦å·²ç»è¾¾åˆ°äº†ç“¶é¢ˆï¼Œå¦‚æœç¡®è®¤æ²¡æœ‰è¾¾åˆ°æ€§èƒ½ç“¶é¢ˆï¼Œå°±éœ€è¦é‡æ–°æ£€æŸ¥ï¼Œé‡å¤ä»¥ä¸Šçš„æ­¥éª¤ã€‚å¦‚æœå·²ç»è¾¾åˆ°äº†<code>æ€§èƒ½ç“¶é¢ˆ</code>ï¼Œè¿›å…¥A4 é˜¶æ®µï¼Œéœ€è¦è€ƒè™‘<code>å¢åŠ æœåŠ¡å™¨</code>ï¼Œé‡‡ç”¨<code>è¯»å†™åˆ†ç¦»</code>çš„æ¶æ„ï¼Œæˆ–è€…è€ƒè™‘å¯¹æ•°æ®åº“è¿›è¡Œ<code>åˆ†åº“åˆ†è¡¨</code>ï¼Œæ¯”å¦‚å‚ç›´åˆ†åº“ã€å‚ç›´åˆ†è¡¨å’Œæ°´å¹³åˆ†è¡¨ç­‰ï¼Œ</p><p>ä»¥ä¸Šå°±æ˜¯æ•°æ®åº“è°ƒä¼˜çš„æµç¨‹æ€è·¯ã€‚å¦‚æœæˆ‘ä»¬å‘ç°æ‰§è¡Œ SQLæ—¶å­˜åœ¨ä¸è§„åˆ™å»¶è¿Ÿæˆ–å¡é¡¿çš„æ—¶å€™ï¼Œå°±å¯ä»¥é‡‡ç”¨åˆ†æå·¥å…·å¸®æˆ‘ä»¬å®šä½æœ‰é—®é¢˜çš„ SQLï¼Œè¿™ä¸‰ç§åˆ†æå·¥å…·ä½ å¯ä»¥ç†è§£æ˜¯ SQL è°ƒä¼˜çš„ä¸‰ä¸ªæ­¥éª¤ï¼š<code>æ…¢æŸ¥è¯¢</code>ã€<code>EXPLAIN</code>å’Œ<code>SHOW PROFILING</code>ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230410153919452.png" alt="image-20230410153919452" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯Ÿäº†è§£æ•°æ®åº“æ•´ä½“çš„è¿è¡ŒçŠ¶æ€ï¼Œé€šè¿‡æ€§èƒ½åˆ†æå·¥å…·å¯ä»¥è®©æˆ‘ä»¬äº†è§£æ‰§è¡Œæ…¢çš„SQLéƒ½æœ‰å“ªäº›ï¼ŒæŸ¥çœ‹å…·ä½“çš„SQLæ‰§è¡Œè®¡åˆ’ï¼Œç”šè‡³æ˜¯SQLæ‰§è¡Œä¸­çš„æ¯ä¸€æ­¥çš„æˆæœ¬ä»£ä»·ï¼Œè¿™æ ·æ‰èƒ½å®šä½é—®é¢˜æ‰€åœ¨ï¼Œæ‰¾åˆ°äº†é—®é¢˜ï¼Œå†é‡‡å–ç›¸åº”çš„è¡ŒåŠ¨ã€‚</p><hr><h2 id="2-æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°">2. æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°</h2><p>åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>SHOW STATUS</code>è¯­å¥æŸ¥è¯¢ä¸€äº›MySQLæ•°æ®åº“æœåŠ¡å™¨çš„<code>æ€§èƒ½å‚æ•°ã€æ‰§è¡Œé¢‘ç‡</code>ã€‚</p><p>SHOW STATUSè¯­å¥è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> [<span class="keyword">GLOBAL</span><span class="operator">|</span>SESSION] STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;å‚æ•°&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¸€äº›å¸¸ç”¨çš„æ€§èƒ½å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>Connectionsï¼šè¿æ¥MySQLæœåŠ¡å™¨çš„æ¬¡æ•°ã€‚</li><li>Uptimeï¼šMySQLæœåŠ¡å™¨çš„ä¸Šçº¿æ—¶é—´ã€‚</li><li>Slow_queriesï¼šæ…¢æŸ¥è¯¢çš„æ¬¡æ•°ã€‚</li><li>Innodb_rows_readï¼šSelectæŸ¥è¯¢è¿”å›çš„è¡Œæ•°</li><li>Innodb_rows_insertedï¼šæ‰§è¡ŒINSERTæ“ä½œæ’å…¥çš„è¡Œæ•°</li><li>Innodb_rows_updatedï¼šæ‰§è¡ŒUPDATEæ“ä½œæ›´æ–°çš„ è¡Œæ•°</li><li>Innodb_rows_deletedï¼šæ‰§è¡ŒDELETEæ“ä½œåˆ é™¤çš„è¡Œæ•°</li><li>Com_selectï¼šæŸ¥è¯¢æ“ä½œçš„æ¬¡æ•°ã€‚</li><li>Com_insertï¼šæ’å…¥æ“ä½œçš„æ¬¡æ•°ã€‚å¯¹äºæ‰¹é‡æ’å…¥çš„ INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ã€‚</li><li>Com_updateï¼šæ›´æ–°æ“ä½œ çš„æ¬¡æ•°ã€‚</li><li>Com_deleteï¼šåˆ é™¤æ“ä½œçš„æ¬¡æ•°ã€‚</li></ul><p>è‹¥æŸ¥è¯¢MySQLæœåŠ¡å™¨çš„è¿æ¥æ¬¡æ•°ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Connections&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è‹¥æŸ¥è¯¢æœåŠ¡å™¨å·¥ä½œæ—¶é—´ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Uptime&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è‹¥æŸ¥è¯¢MySQLæœåŠ¡å™¨çš„æ…¢æŸ¥è¯¢æ¬¡æ•°ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Slow_queries&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ…¢æŸ¥è¯¢æ¬¡æ•°å‚æ•°å¯ä»¥ç»“åˆæ…¢æŸ¥è¯¢æ—¥å¿—æ‰¾å‡ºæ…¢æŸ¥è¯¢è¯­å¥ï¼Œç„¶åé’ˆå¯¹æ…¢æŸ¥è¯¢è¯­å¥è¿›è¡Œ<code>è¡¨ç»“æ„ä¼˜åŒ–</code>æˆ–è€…<code>æŸ¥è¯¢è¯­å¥ä¼˜åŒ–</code>ã€‚</p><p>å†æ¯”å¦‚ï¼Œå¦‚ä¸‹çš„æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„æŒ‡ä»¤æƒ…å†µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Innodb_rows_%&#x27;</span>;</span><br></pre></td></tr></table></figure><hr><h2 id="3-ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬">3. ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬</h2><p>ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥åœ¨æ‰§è¡Œå‰éœ€è¦æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœå­˜åœ¨å¤šç§æ‰§è¡Œè®¡åˆ’çš„è¯ï¼ŒMySQLä¼šè®¡ç®—æ¯ä¸ªæ‰§è¡Œè®¡åˆ’æ‰€éœ€è¦çš„æˆæœ¬ï¼Œä»ä¸­é€‰æ‹©<code>æˆæœ¬æœ€å°</code>çš„ä¸€ä¸ªä½œä¸ºæœ€ç»ˆæ‰§è¡Œçš„æ‰§è¡Œè®¡åˆ’ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹æŸæ¡SQLè¯­å¥çš„æŸ¥è¯¢æˆæœ¬ï¼Œå¯ä»¥åœ¨æ‰§è¡Œå®Œè¿™æ¡SQLè¯­å¥ä¹‹åï¼Œé€šè¿‡æŸ¥çœ‹å½“å‰ä¼šè¯ä¸­çš„<code>last_query_cost</code>å˜é‡å€¼æ¥å¾—åˆ°å½“å‰æŸ¥è¯¢çš„æˆæœ¬ã€‚å®ƒé€šå¸¸ä¹Ÿæ˜¯æˆ‘ä»¬<code>è¯„ä»·ä¸€ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡</code>çš„ä¸€ä¸ªå¸¸ç”¨æŒ‡æ ‡ã€‚è¿™ä¸ªæŸ¥è¯¢æˆæœ¬å¯¹åº”çš„æ˜¯<code>SQLè¯­å¥æ‰€éœ€è¦è¯»å–çš„è¯»é¡µçš„æ•°é‡</code>ã€‚</p><p>æˆ‘ä»¬ä¾ç„¶ä½¿ç”¨ç¬¬8ç« çš„ student_info è¡¨ä¸ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`student_info`(</span><br><span class="line">  `id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `student_id`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">  `name`<span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `course_id`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">  `class_id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `create_time`DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ id=900001 çš„è®°å½•ï¼Œç„¶åçœ‹ä¸‹æŸ¥è¯¢æˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨èšç°‡ç´¢å¼•ä¸Šè¿›è¡ŒæŸ¥æ‰¾ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student_id, class_id, NAME, create_time <span class="keyword">FROM</span> student_info <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">900001</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ˆ1 æ¡è®°å½•ï¼Œè¿è¡Œæ—¶é—´ä¸º 0.042s ï¼‰</p><p>ç„¶åå†çœ‹ä¸‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æˆæœ¬ï¼Œå®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦æ£€ç´¢ä¸€ä¸ªé¡µå³å¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;last_query_cost&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span>   <span class="keyword">Value</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Last_query_cost <span class="operator">|</span> <span class="number">1.000000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ id åœ¨ 900001 åˆ° 9000100 ä¹‹é—´çš„å­¦ç”Ÿè®°å½•å‘¢ï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student_id, class_id, NAME, create_time <span class="keyword">FROM</span> student_info <span class="keyword">WHERE</span> id <span class="keyword">BETWEEN</span> <span class="number">900001</span> <span class="keyword">AND</span> <span class="number">900100</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ˆ100 æ¡è®°å½•ï¼Œè¿è¡Œæ—¶é—´ä¸º 0.046s ï¼‰ï¼š</p><p>ç„¶åå†çœ‹ä¸‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æˆæœ¬ï¼Œè¿™æ—¶æˆ‘ä»¬å¤§æ¦‚éœ€è¦è¿›è¡Œ 20 ä¸ªé¡µçš„æŸ¥è¯¢ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;last_query_cost&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span>   <span class="keyword">Value</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Last_query_cost <span class="operator">|</span> <span class="number">21.134453</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br></pre></td></tr></table></figure><p>ä½ èƒ½çœ‹åˆ°é¡µçš„æ•°é‡æ˜¯åˆšæ‰çš„ 20 å€ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ•ˆç‡å¹¶æ²¡æœ‰æ˜æ˜¾çš„å˜åŒ–ï¼Œå®é™…ä¸Šè¿™ä¸¤ä¸ª SQL æŸ¥è¯¢çš„æ—¶é—´åŸºæœ¬ä¸Šä¸€æ ·ï¼Œå°±æ˜¯å› ä¸ºé‡‡ç”¨äº†é¡ºåºè¯»å–çš„æ–¹å¼å°†é¡µé¢ä¸€æ¬¡æ€§åŠ è½½åˆ°ç¼“å†²æ± ä¸­ï¼Œç„¶åå†è¿›è¡ŒæŸ¥æ‰¾ã€‚è™½ç„¶é¡µæ•°é‡ï¼ˆlast_query_costï¼‰å¢åŠ äº†ä¸å°‘ ï¼Œä½†æ˜¯é€šè¿‡ç¼“å†²æ± çš„æœºåˆ¶ï¼Œå¹¶æ²¡æœ‰å¢åŠ å¤šå°‘æŸ¥è¯¢æ—¶é—´ ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šå®ƒå¯¹äºæ¯”è¾ƒå¼€é”€æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬æœ‰å¥½å‡ ç§æŸ¥è¯¢æ–¹å¼å¯é€‰çš„æ—¶å€™ã€‚</p><blockquote><p>SQLæŸ¥è¯¢æ—¶ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹ï¼Œä»é¡µåŠ è½½çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¸¤ç‚¹ç»“è®ºï¼š</p><p>1.<code>ä½ç½®å†³å®šæ•ˆç‡</code>ã€‚å¦‚æœé¡µå°±åœ¨æ•°æ®åº“<code>ç¼“å†²æ± </code>ä¸­ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œå¦åˆ™è¿˜éœ€è¦ä»<code>å†…å­˜</code>æˆ–è€…<code>ç£ç›˜</code>ä¸­è¿›è¡Œè¯»å–ï¼Œå½“ç„¶é’ˆå¯¹å•ä¸ªé¡µçš„è¯»å–æ¥è¯´ï¼Œå¦‚æœé¡µå­˜åœ¨äºå†…å­˜ä¸­ï¼Œä¼šæ¯”åœ¨ç£ç›˜ä¸­è¯»å–æ•ˆç‡é«˜å¾ˆå¤šã€‚<br>2.<code>æ‰¹é‡å†³å®šæ•ˆç‡</code>ã€‚å¦‚æœæˆ‘ä»¬ä»ç£ç›˜ä¸­å¯¹å•ä¸€é¡µè¿›è¡Œéšæœºè¯»ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯å¾ˆä½çš„(å·®ä¸å¤š10ms)ï¼Œè€Œé‡‡ç”¨é¡ºåºè¯»å–çš„æ–¹å¼ï¼Œæ‰¹é‡å¯¹é¡µè¿›è¡Œè¯»å–ï¼Œå¹³å‡ä¸€é¡µçš„è¯»å–æ•ˆç‡å°±ä¼šæå‡å¾ˆå¤šï¼Œç”šè‡³è¦å¿«äºå•ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­çš„éšæœºè¯»å–ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œé‡åˆ°I/Oå¹¶ä¸ç”¨æ‹…å¿ƒï¼Œæ–¹æ³•æ‰¾å¯¹äº†ï¼Œæ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚æˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘æ•°æ®å­˜æ”¾çš„ä½ç½®ï¼Œå¦‚æœæ˜¯è¿›ç¨‹ä½¿ç”¨çš„æ•°æ®å°±è¦å°½é‡æ”¾åˆ°<code>ç¼“å†²æ± </code>ä¸­ï¼Œå…¶æ¬¡æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨ç£ç›˜çš„ååèƒ½åŠ›ï¼Œä¸€æ¬¡æ€§æ‰¹é‡è¯»å–æ•°æ®ï¼Œè¿™æ ·å•ä¸ªé¡µçš„è¯»å–æ•ˆç‡ä¹Ÿå°±å¾—åˆ°äº†æå‡ã€‚</p></blockquote><hr><h2 id="4-å®šä½æ‰§è¡Œæ…¢çš„SQL-æ…¢æŸ¥è¯¢æ—¥å¿—">4. å®šä½æ‰§è¡Œæ…¢çš„SQL:æ…¢æŸ¥è¯¢æ—¥å¿—</h2><p>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œç”¨æ¥è®°å½•åœ¨MysQLä¸­<code>å“åº”æ—¶é—´è¶…è¿‡é˜€å€¼</code>çš„è¯­å¥ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡<code>long_query_time</code>å€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚long_query_timeçš„é»˜è®¤å€¼ä¸º 10ï¼Œæ„æ€æ˜¯è¿è¡Œ10ç§’ä»¥ä¸Šï¼ˆä¸å«10ç§’ï¼‰çš„è¯­å¥ï¼Œè®¤ä¸ºæ˜¯è¶…å‡ºäº†æˆ‘ä»¬çš„æœ€å¤§å¿è€æ—¶é—´å€¼ã€‚</p><p>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼Œå¸®åŠ©æˆ‘ä»¬å‘ç°é‚£äº›æ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿çš„ SQL æŸ¥è¯¢ï¼Œå¹¶ä¸”æœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•´ä½“æ•ˆç‡ï¼Œå½“æˆ‘ä»¬çš„æ•°æ®åº“æœåŠ¡å™¨å‘ç”Ÿé˜»å¡ã€è¿è¡Œå˜æ…¢çš„æ—¶å€™ï¼Œæ£€æŸ¥ä¸€ä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ‰¾åˆ°é‚£äº›æ…¢æŸ¥è¯¢ï¼Œå¯¹è§£å†³é—®é¢˜å¾ˆæœ‰å¸®åŠ©ã€‚æ¯”å¦‚ä¸€æ¡sqlæ‰§è¡Œè¶…è¿‡5ç§’é’Ÿï¼Œæˆ‘ä»¬å°±ç®—æ…¢SQLï¼Œå¸Œæœ›èƒ½æ”¶é›†è¶…è¿‡5ç§’çš„sqlï¼Œç»“åˆexplainè¿›è¡Œå…¨é¢åˆ†æã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMysQLæ•°æ®åº“<code>æ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</code>ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚<span class='p red'>å¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œä¸€èˆ¬ä¸å»ºè®®å¯åŠ¨è¯¥å‚æ•°</span>ï¼Œå› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šæˆ–å¤šæˆ–å°‘å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚</p><p>æ…¢æŸ¥è¯¢æ—¥å¿—æ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶ã€‚</p><h3 id="4-1-å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°">4.1 å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°</h3><div class="tabs" id="32e2ffd3-dd35-4b1d-b933-c314ce9033f8"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#32e2ffd3-dd35-4b1d-b933-c314ce9033f8-1"><i class="fas fa-award"></i>1. å¼€å¯ slow_query_log</button></li><li class="tab"><button type="button" data-href="#32e2ffd3-dd35-4b1d-b933-c314ce9033f8-2"><i class="fas fa-baseball-ball"></i>2. ä¿®æ”¹ long_query_time é˜ˆå€¼</button></li><li class="tab"><button type="button" data-href="#32e2ffd3-dd35-4b1d-b933-c314ce9033f8-3"><i class="fas fa-bone"></i>è¡¥å……ï¼šé…ç½®æ–‡ä»¶ä¸­ä¸€å¹¶è®¾ç½®å‚æ•°</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="32e2ffd3-dd35-4b1d-b933-c314ce9033f8-1"><p>åœ¨ä½¿ç”¨å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŸ¥ä¸‹æ…¢æŸ¥è¯¢æ˜¯å¦å·²ç»å¼€å¯ï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤å³å¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%slow_query_log&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628173525966.png" alt="image-20220628173525966" style="zoom:67%;" /><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>slow_query_log=OFF</code>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ…¢æŸ¥è¯¢æ—¥å¿—æ‰“å¼€ï¼Œæ³¨æ„è®¾ç½®å˜é‡å€¼çš„æ—¶å€™éœ€è¦ä½¿ç”¨ globalï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> slow_query_log<span class="operator">=</span><span class="string">&#x27;ON&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å†æ¥æŸ¥çœ‹ä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œä»¥åŠæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„ä½ç½®ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628175226812.png" alt="image-20220628175226812" style="zoom:67%;" /><p>ä½ èƒ½çœ‹åˆ°è¿™æ—¶æ…¢æŸ¥è¯¢åˆ†æå·²ç»å¼€å¯ï¼ŒåŒæ—¶æ–‡ä»¶ä¿å­˜åœ¨<code>/var/lib/mysql/atguigu02-slow.log</code>æ–‡ä»¶ ä¸­ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="32e2ffd3-dd35-4b1d-b933-c314ce9033f8-2"><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹æ…¢æŸ¥è¯¢çš„æ—¶é—´é˜ˆå€¼è®¾ç½®ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628175353233.png" alt="image-20220628175353233" /><p>è¿™é‡Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠæ—¶é—´ç¼©çŸ­ï¼Œæ¯”å¦‚è®¾ç½®ä¸º 1 ç§’ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#æµ‹è¯•å‘ç°ï¼šè®¾ç½®<span class="keyword">global</span>çš„æ–¹å¼å¯¹å½“å‰sessionçš„long_query_timeå¤±æ•ˆã€‚å¯¹æ–°è¿æ¥çš„å®¢æˆ·ç«¯æœ‰æ•ˆã€‚æ‰€ä»¥å¯ä»¥ä¸€å¹¶æ‰§è¡Œä¸‹è¿°è¯­å¥</span><br><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> long_query_time <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> long_query_time<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628175425922.png" alt="image-20220628175425922"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="32e2ffd3-dd35-4b1d-b933-c314ce9033f8-3"><p>å¦‚ä¸‹çš„æ–¹å¼ç›¸è¾ƒäºå‰é¢çš„å‘½ä»¤è¡Œæ–¹å¼ï¼Œå¯ä»¥çœ‹åšæ˜¯æ°¸ä¹…è®¾ç½®çš„æ–¹å¼ã€‚</p><p>ä¿®æ”¹<code>my.cnf</code>æ–‡ä»¶ï¼Œ[mysqld] ä¸‹å¢åŠ æˆ–ä¿®æ”¹å‚æ•°<code>long_query_timeã€slow_query_log</code>å’Œ<code>slow_query_log_file</code>åï¼Œç„¶åé‡å¯ MySQL æœåŠ¡å™¨ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">slow_query_log</span>=<span class="string">ON  # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³</span></span><br><span class="line"><span class="attr">slow_query_log_file</span>=<span class="string">/var/lib/mysql/atguigu-low.log  # æ…¢æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•å’Œæ–‡ä»¶åä¿¡æ¯</span></span><br><span class="line"><span class="attr">long_query_time</span>=<span class="string">3  # è®¾ç½®æ…¢æŸ¥è¯¢çš„é˜ˆå€¼ä¸º3ç§’ï¼Œè¶…å‡ºæ­¤è®¾å®šå€¼çš„SQLå³è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line"><span class="attr">log_output</span>=<span class="string">FILE</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æŒ‡å®šå­˜å‚¨è·¯å¾„ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤å­˜å‚¨åˆ°MySQLæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å¤¹ä¸‹ã€‚å¦‚æœä¸æŒ‡å®šæ–‡ä»¶åï¼Œé»˜è®¤æ–‡ä»¶åä¸ºhostname_slow.logã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="4-2-æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®">4.2 æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®</h3><p>æŸ¥è¯¢å½“å‰ç³»ç»Ÿä¸­æœ‰å¤šå°‘æ¡æ…¢æŸ¥è¯¢è®°å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;%Slow_queries%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="4-3-æ•°æ®å‡†å¤‡">4.3 æ•°æ®å‡†å¤‡</h3><div class="tabs" id="2a49e976-417f-4a18-9661-b7964a9e92a9"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2a49e976-417f-4a18-9661-b7964a9e92a9-1"><i class="fas fa-bug"></i>æ­¥éª¤1</button></li><li class="tab"><button type="button" data-href="#2a49e976-417f-4a18-9661-b7964a9e92a9-2"><i class="fas fa-cannabis"></i>æ­¥éª¤2</button></li><li class="tab"><button type="button" data-href="#2a49e976-417f-4a18-9661-b7964a9e92a9-3"><i class="fas fa-candy-cane"></i>æ­¥éª¤3</button></li><li class="tab"><button type="button" data-href="#2a49e976-417f-4a18-9661-b7964a9e92a9-4"><i class="fas fa-child"></i>æ­¥éª¤4</button></li><li class="tab"><button type="button" data-href="#2a49e976-417f-4a18-9661-b7964a9e92a9-5"><i class="fab fa-apple"></i>æ­¥éª¤5</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2a49e976-417f-4a18-9661-b7964a9e92a9-1"><blockquote><p>å»ºè¡¨</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`student`(</span><br><span class="line">  `id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `stuno`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">  `name`<span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age`<span class="type">INT</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `classId`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2a49e976-417f-4a18-9661-b7964a9e92a9-2"><blockquote><p>è®¾ç½®å‚æ•° log_bin_trust_function_creators</p></blockquote><p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This <span class="keyword">function</span> has <span class="keyword">none</span> <span class="keyword">of</span> DETERMINISTIC......</span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤å¼€å¯ï¼šå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>; # ä¸åŠ <span class="keyword">global</span>åªæ˜¯å½“å‰çª—å£æœ‰æ•ˆã€‚</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2a49e976-417f-4a18-9661-b7964a9e92a9-3"><blockquote><p>åˆ›å»ºå‡½æ•°</p></blockquote><p>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²ï¼šï¼ˆåŒä¸Šä¸€ç« ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_string(n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>) #è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span></span><br><span class="line"><span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> return_str <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;</span> n DO</span><br><span class="line">    <span class="keyword">SET</span> return_str <span class="operator">=</span>CONCAT(return_str,<span class="built_in">SUBSTRING</span>(chars_str,<span class="built_in">FLOOR</span>(<span class="number">1</span><span class="operator">+</span>RAND()<span class="operator">*</span><span class="number">52</span>),<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•</span><br><span class="line"><span class="keyword">SELECT</span> rand_string(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>äº§ç”Ÿéšæœºæ•°å€¼ï¼šï¼ˆåŒä¸Šä¸€ç« ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_num (from_num <span class="type">INT</span> ,to_num <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">INT</span>(<span class="number">11</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> <span class="built_in">FLOOR</span>(from_num <span class="operator">+</span>RAND()<span class="operator">*</span>(to_num <span class="operator">-</span> from_num<span class="operator">+</span><span class="number">1</span>)) ;</span><br><span class="line">    <span class="keyword">RETURN</span> i;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">#æµ‹è¯•ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> rand_num(<span class="number">10</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2a49e976-417f-4a18-9661-b7964a9e92a9-4"><blockquote><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_stu1( <span class="keyword">START</span> <span class="type">INT</span> , max_num <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">    REPEAT #å¾ªç¯</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; #èµ‹å€¼</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> student (stuno, NAME ,age ,classId ) <span class="keyword">VALUES</span></span><br><span class="line">    ((<span class="keyword">START</span><span class="operator">+</span>i),rand_string(<span class="number">6</span>),rand_num(<span class="number">10</span>,<span class="number">100</span>),rand_num(<span class="number">10</span>,<span class="number">1000</span>));</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>; #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2a49e976-417f-4a18-9661-b7964a9e92a9-5"><blockquote><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#è°ƒç”¨åˆšåˆšå†™å¥½çš„å‡½æ•°, <span class="number">4000000</span>æ¡è®°å½•,ä»<span class="number">100001</span>å·å¼€å§‹</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> insert_stu1(<span class="number">100001</span>,<span class="number">4000000</span>);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="4-4-æµ‹è¯•åŠåˆ†æ">4.4 æµ‹è¯•åŠåˆ†æ</h3><div class="tabs" id="95731a00-674d-47b5-8c8e-b1b83e31e576"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#95731a00-674d-47b5-8c8e-b1b83e31e576-1"><i class="fas fa-seedling"></i>æµ‹è¯•</button></li><li class="tab"><button type="button" data-href="#95731a00-674d-47b5-8c8e-b1b83e31e576-2"><i class="fas fa-leaf"></i>åˆ†æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="95731a00-674d-47b5-8c8e-b1b83e31e576-1"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> <span class="number">3455655</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span>   id    <span class="operator">|</span>  stuno  <span class="operator">|</span>  name  <span class="operator">|</span> age  <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3523633</span> <span class="operator">|</span> <span class="number">3455655</span> <span class="operator">|</span> oQmLUr <span class="operator">|</span>  <span class="number">19</span>  <span class="operator">|</span>    <span class="number">39</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">2.09</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;oQmLUr&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span>   id    <span class="operator">|</span>  stuno  <span class="operator">|</span>  name  <span class="operator">|</span>  age <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1154002</span> <span class="operator">|</span> <span class="number">1243200</span> <span class="operator">|</span> OQMlUR <span class="operator">|</span> <span class="number">266</span>  <span class="operator">|</span>   <span class="number">28</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1405708</span> <span class="operator">|</span> <span class="number">1437740</span> <span class="operator">|</span> OQMlUR <span class="operator">|</span> <span class="number">245</span>  <span class="operator">|</span>   <span class="number">439</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1748070</span> <span class="operator">|</span> <span class="number">1680092</span> <span class="operator">|</span> OQMlUR <span class="operator">|</span> <span class="number">240</span>  <span class="operator">|</span>   <span class="number">414</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2119892</span> <span class="operator">|</span> <span class="number">2051914</span> <span class="operator">|</span> oQmLUr <span class="operator">|</span> <span class="number">17</span>   <span class="operator">|</span>   <span class="number">32</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2893154</span> <span class="operator">|</span> <span class="number">2825176</span> <span class="operator">|</span> OQMlUR <span class="operator">|</span> <span class="number">245</span>  <span class="operator">|</span>   <span class="number">435</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3523633</span> <span class="operator">|</span> <span class="number">3455655</span> <span class="operator">|</span> oQmLUr <span class="operator">|</span> <span class="number">19</span>   <span class="operator">|</span>   <span class="number">39</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">2.39</span> sec)</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼ŒæŸ¥è¯¢å­¦ç”Ÿç¼–å·ä¸ºâ€œ3455655â€çš„å­¦ç”Ÿä¿¡æ¯èŠ±è´¹æ—¶é—´ä¸º2.09ç§’ã€‚æŸ¥è¯¢å­¦ç”Ÿå§“åä¸º â€œoQmLUrâ€çš„å­¦ç”Ÿä¿¡æ¯èŠ±è´¹æ—¶é—´ä¸º2.39ç§’ã€‚å·²ç»è¾¾åˆ°äº†ç§’çš„æ•°é‡çº§ï¼Œè¯´æ˜ç›®å‰æŸ¥è¯¢æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œä¸‹é¢çš„å°èŠ‚æˆ‘ä»¬åˆ†æä¸€ä¸‹åŸå› ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="95731a00-674d-47b5-8c8e-b1b83e31e576-2"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;slow_queries&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628195650079.png" alt="image-20220628195650079" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="4-5-æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·">4.5 æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœè¦æ‰‹å·¥åˆ†ææ—¥å¿—ï¼ŒæŸ¥æ‰¾ã€åˆ†æSQLï¼Œæ˜¾ç„¶æ˜¯ä¸ªä½“åŠ›æ´»ï¼ŒMySQLæä¾›äº†æ—¥å¿—åˆ†æå·¥å…·<code>mysqldumpslow</code>ã€‚</p><p>æŸ¥çœ‹mysqldumpslowçš„å¸®åŠ©ä¿¡æ¯</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mysqldumpslow</span> <span class="string">--help</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628195821440.png" alt="image-20220628195821440"  /><p>mysqldumpslow å‘½ä»¤çš„å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>-a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS</li><li>-s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åºï¼š<ul><li>c: è®¿é—®æ¬¡æ•°</li><li>l: é”å®šæ—¶é—´</li><li>r: è¿”å›è®°å½•</li><li>t: æŸ¥è¯¢æ—¶é—´</li><li>al:å¹³å‡é”å®šæ—¶é—´</li><li>ar:å¹³å‡è¿”å›è®°å½•æ•°</li><li>at:å¹³å‡æŸ¥è¯¢æ—¶é—´ ï¼ˆé»˜è®¤æ–¹å¼ï¼‰</li><li>ac:å¹³å‡æŸ¥è¯¢æ¬¡æ•°</li></ul></li><li>-t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ®ï¼›</li><li>-g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ï¼›</li></ul><p>ä¸¾ä¾‹ï¼šæˆ‘ä»¬æƒ³è¦æŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºï¼ŒæŸ¥çœ‹å‰äº”æ¡ SQL è¯­å¥ï¼Œè¿™æ ·å†™å³å¯ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mysqldumpslow</span> <span class="string">-s t -t 5 /var/lib/mysql/atguigu01-slow.log</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@bogon</span> <span class="string">~]# mysqldumpslow -s t -t 5 /var/lib/mysql/atguigu01-slow.log</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Reading</span> <span class="string">mysql slow query log from /var/lib/mysql/atguigu01-slow.log</span></span><br><span class="line"><span class="attr">Count</span>: <span class="string">1 Time=2.39s (2s) Lock=0.00s (0s) Rows=13.0 (13), root[root]@localhost</span></span><br><span class="line"><span class="attr">SELECT</span> <span class="string">* FROM student WHERE name = &#x27;S&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Count</span>: <span class="string">1 Time=2.09s (2s) Lock=0.00s (0s) Rows=2.0 (2), root[root]@localhost</span></span><br><span class="line"><span class="attr">SELECT</span> <span class="string">* FROM student WHERE stuno = N</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Died</span> <span class="string">at /usr/bin/mysqldumpslow line 162, &lt;&gt; chunk 2.</span></span><br></pre></td></tr></table></figure><p><strong>å·¥ä½œå¸¸ç”¨å‚è€ƒï¼š</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL</span></span><br><span class="line"><span class="attr">mysqldumpslow</span> <span class="string">-s r -t 10 /var/lib/mysql/atguigu-slow.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL</span></span><br><span class="line"><span class="attr">mysqldumpslow</span> <span class="string">-s c -t 10 /var/lib/mysql/atguigu-slow.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥</span></span><br><span class="line"><span class="attr">mysqldumpslow</span> <span class="string">-s t -t 10 -g &quot;right join&quot; /var/lib/mysql/atguigu-slow.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œmore ä½¿ç”¨ ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ</span></span><br><span class="line"><span class="attr">mysqldumpslow</span> <span class="string">-s r -t 10 /var/lib/mysql/atguigu-slow.log | more</span></span><br></pre></td></tr></table></figure><h3 id="4-6-å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—">4.6 å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>MySQLæœåŠ¡å™¨åœæ­¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">slow_query_log</span>=<span class="string">OFF</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼ŒæŠŠslow_query_logä¸€é¡¹æ³¨é‡Šæ‰ æˆ– åˆ é™¤</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#slow_query_log =OFF</span></span><br></pre></td></tr></table></figure><p>é‡å¯MySQLæœåŠ¡ï¼Œæ‰§è¡Œå¦‚ä¸‹è¯­å¥æŸ¥è¯¢æ…¢æ—¥å¿—åŠŸèƒ½ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%slow%&#x27;</span>; #æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—æ‰€åœ¨ç›®å½•</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%long_query_time%&#x27;</span>; #æŸ¥è¯¢è¶…æ—¶æ—¶é•¿</span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><p>ä½¿ç”¨SETè¯­å¥æ¥è®¾ç½®ã€‚</p><p>ï¼ˆ1ï¼‰åœæ­¢MySQLæ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œå…·ä½“SQLè¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log<span class="operator">=</span>off;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰<strong>é‡å¯MySQLæœåŠ¡</strong>ï¼Œä½¿ç”¨SHOWè¯­å¥æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ä¿¡æ¯ï¼Œå…·ä½“SQLè¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%slow%&#x27;</span>;</span><br><span class="line">#ä»¥åŠ</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;</span><br></pre></td></tr></table></figure><hr><h3 id="4-7-åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—">4.7 åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>ä½¿ç”¨SHOWè¯­å¥æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ—¥å¿—ä¿¡æ¯ï¼Œå…·ä½“SQLè¯­å¥å¦‚ä¸‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span>`slow_query_log<span class="operator">%</span>`;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628203545536.png" alt="image-20220628203545536" /><p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•é»˜è®¤ä¸ºMySQLçš„æ•°æ®ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹<code>æ‰‹åŠ¨åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</code>å³å¯ã€‚</p><p>ä½¿ç”¨å‘½ä»¤<code>mysqladmin flush-logs</code>æ¥é‡æ–°ç”ŸæˆæŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼Œæ‰§è¡Œå®Œæ¯•ä¼šåœ¨æ•°æ®ç›®å½•ä¸‹é‡æ–°ç”Ÿæˆæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mysqladmin</span> <span class="string">-uroot -p flush-logs slow</span></span><br></pre></td></tr></table></figure><blockquote><p>æç¤º</p><p>æ…¢æŸ¥è¯¢æ—¥å¿—éƒ½æ˜¯ä½¿ç”¨mysqladmin flush-logså‘½ä»¤æ¥åˆ é™¤é‡å»ºçš„ã€‚ä½¿ç”¨æ—¶ä¸€å®šè¦æ³¨æ„ï¼Œä¸€æ—¦æ‰§è¡Œäº†è¿™ä¸ªå‘½ä»¤ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—éƒ½åªå­˜åœ¨æ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚æœéœ€è¦æ—§çš„æŸ¥è¯¢æ—¥å¿—ï¼Œå°±å¿…é¡»äº‹å…ˆå¤‡ä»½ã€‚</p></blockquote><hr><h2 id="5-æŸ¥çœ‹SQLæ‰§è¡Œæˆæœ¬-PROFILE">5. æŸ¥çœ‹SQLæ‰§è¡Œæˆæœ¬:PROFILE</h2><p>show profile æ˜¯ MySQL æä¾›çš„å¯ä»¥ç”¨æ¥åˆ†æå½“å‰ä¼šè¯ä¸­ SQL éƒ½åšäº†ä»€ä¹ˆã€æ‰§è¡Œçš„èµ„æºæ¶ˆè€—å·¥å…·çš„æƒ…å†µï¼Œå¯ç”¨äº sql è°ƒä¼˜çš„æµ‹é‡ã€‚<code>é»˜è®¤æƒ…å†µä¸‹å¤„äºå…³é—­çŠ¶æ€</code>ï¼Œå¹¶ä¿å­˜æœ€è¿‘15æ¬¡çš„è¿è¡Œç»“æœã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¼šè¯çº§åˆ«å¼€å¯è¿™ä¸ªåŠŸèƒ½ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;profiling&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628204922556.png" alt="image-20220628204922556"  /><p>é€šè¿‡è®¾ç½® profiling=â€˜ONâ€™ æ¥å¼€å¯ show profile:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">set</span> profiling <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628205029208.png" alt="image-20220628205029208" style="zoom:80%;" /><p>ç„¶åæ‰§è¡Œç›¸å…³çš„æŸ¥è¯¢è¯­å¥ã€‚æ¥ç€çœ‹ä¸‹å½“å‰ä¼šè¯éƒ½æœ‰å“ªäº› profilesï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">show</span> profiles;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628205243769.png" alt="image-20220628205243769" style="zoom:80%;" /><p>ä½ èƒ½çœ‹åˆ°å½“å‰ä¼šè¯ä¸€å…±æœ‰ 2 ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡æŸ¥è¯¢çš„å¼€é”€ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">show</span> profile;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628205317257.png" alt="image-20220628205317257"  /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> profile cpu,block io <span class="keyword">for</span> query <span class="number">2</span></span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628205354230.png" alt="image-20220628205354230"  /><p>show profileçš„å¸¸ç”¨æŸ¥è¯¢å‚æ•°ï¼š</p><p>â‘  ALLï¼šæ˜¾ç¤ºæ‰€æœ‰çš„å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¡ BLOCK IOï¼šæ˜¾ç¤ºå—IOå¼€é”€ã€‚</p><p>â‘¢ CONTEXT SWITCHESï¼šä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚</p><p>â‘£ CPUï¼šæ˜¾ç¤ºCPUå¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¤ IPCï¼šæ˜¾ç¤ºå‘é€å’Œæ¥æ”¶å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¥ MEMORYï¼šæ˜¾ç¤ºå†…å­˜å¼€é”€ä¿¡ æ¯ã€‚</p><p>â‘¦ PAGE FAULTSï¼šæ˜¾ç¤ºé¡µé¢é”™è¯¯å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘§ SOURCEï¼šæ˜¾ç¤ºå’ŒSource_functionï¼ŒSource_fileï¼Œ Source_lineç›¸å…³çš„å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¨ SWAPSï¼šæ˜¾ç¤ºäº¤æ¢æ¬¡æ•°å¼€é”€ä¿¡æ¯ã€‚</p><p><strong>æ—¥å¸¸å¼€å‘éœ€æ³¨æ„çš„ç»“è®ºï¼š</strong></p><p>â‘ <code>converting HEAP to MyISAM</code>: æŸ¥è¯¢ç»“æœå¤ªå¤§ï¼Œå†…å­˜ä¸å¤Ÿï¼Œæ•°æ®å¾€ç£ç›˜ä¸Šæ¬äº†ã€‚</p><p>â‘¡<code>Creating tmp table</code>ï¼šåˆ›å»ºä¸´æ—¶è¡¨ã€‚å…ˆæ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨ï¼Œç”¨å®Œåå†åˆ é™¤ä¸´æ—¶è¡¨ã€‚</p><p>â‘¢<code>Copying to tmp table on disk</code>ï¼šæŠŠå†…å­˜ä¸­ä¸´æ—¶è¡¨å¤åˆ¶åˆ°ç£ç›˜ä¸Šï¼Œè­¦æƒ•ï¼</p><p>â‘£<code>locked</code>ã€‚</p><p>å¦‚æœåœ¨show profileè¯Šæ–­ç»“æœä¸­å‡ºç°äº†ä»¥ä¸Š4æ¡ç»“æœä¸­çš„ä»»ä½•ä¸€æ¡ï¼Œåˆ™sqlè¯­å¥éœ€è¦ä¼˜åŒ–ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><p>ä¸è¿‡SHOW PROFILEå‘½ä»¤å°†è¢«å¼ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä» information_schema ä¸­çš„ profiling æ•°æ®è¡¨è¿›è¡ŒæŸ¥çœ‹ã€‚</p><hr><h2 id="6-åˆ†ææŸ¥è¯¢è¯­å¥-EXPLAIN">6. åˆ†ææŸ¥è¯¢è¯­å¥:EXPLAIN</h2><span class='p red'>å®šä½äº†æŸ¥è¯¢æ…¢çš„ SQLä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ EXPLAIN æˆ– DESCRIBE å·¥å…·åšé’ˆå¯¹æ€§çš„åˆ†ææŸ¥è¯¢è¯­å¥</span>ã€‚DESCRIBEè¯­å¥çš„ä½¿ç”¨æ–¹æ³•ä¸EXPLAINè¯­å¥æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”åˆ†æç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚<p>MySQLä¸­æœ‰ä¸“é—¨è´Ÿè´£ä¼˜åŒ–SELECTè¯­å¥çš„ä¼˜åŒ–å™¨æ¨¡å—ï¼Œä¸»è¦åŠŸèƒ½ï¼šé€šè¿‡è®¡ç®—åˆ†æç³»ç»Ÿä¸­æ”¶é›†åˆ°çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„Queryæä¾›å®ƒè®¤ä¸ºæœ€ä¼˜çš„<code>æ‰§è¡Œè®¡åˆ’</code>ï¼ˆä»–è®¤ä¸ºæœ€ä¼˜çš„æ•°æ®æ£€ç´¢æ–¹å¼ï¼Œä½†ä¸è§å¾—æ˜¯DBAè®¤ä¸ºæ˜¯æœ€ä¼˜çš„ï¼Œè¿™éƒ¨åˆ†æœ€è€—è´¹æ—¶é—´ï¼‰ã€‚</p><p>è¿™ä¸ªæ‰§è¡Œè®¡åˆ’å±•ç¤ºäº†æ¥ä¸‹æ¥å…·ä½“æ‰§è¡ŒæŸ¥è¯¢çš„æ–¹å¼ï¼Œæ¯”å¦‚å¤šè¡¨è¿æ¥çš„é¡ºåºæ˜¯ä»€ä¹ˆï¼Œå¯¹äºæ¯ä¸ªè¡¨é‡‡ç”¨ä»€ä¹ˆè®¿é—®æ–¹æ³•æ¥å…·ä½“æ‰§è¡ŒæŸ¥è¯¢ç­‰ç­‰ã€‚MySQLä¸ºæˆ‘ä»¬æä¾›äº†<code>EXPLAIN</code>è¯­å¥æ¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹æŸä¸ªæŸ¥è¯¢è¯­å¥çš„å…·ä½“æ‰§è¡Œè®¡åˆ’ï¼Œå¤§å®¶çœ‹æ‡‚<code>EXPLAIN</code>è¯­å¥çš„å„ä¸ªè¾“å‡ºé¡¹ï¼Œå¯ä»¥æœ‰é’ˆå¯¹æ€§çš„æå‡æˆ‘ä»¬æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½ã€‚</p><span class='p red'>èƒ½åšä»€ä¹ˆï¼Ÿ</span><ul><li>è¡¨çš„è¯»å–é¡ºåº</li><li>æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹</li><li>å“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨</li><li><span class='p green'>å“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨</span></li><li>è¡¨ä¹‹é—´çš„å¼•ç”¨</li><li><span class='p green'>æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢</span></li></ul><blockquote><span class='p blue'>åªæ˜¯æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¹¶æ²¡æœ‰å®é™…æ‰§è¡Œ</span></blockquote><h3 id="6-1-åŸºæœ¬è¯­æ³•">6.1 åŸºæœ¬è¯­æ³•</h3><p>EXPLAIN æˆ– DESCRIBEè¯­å¥çš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> select_options</span><br><span class="line">#æˆ–è€…</span><br><span class="line"><span class="keyword">DESCRIBE</span> <span class="keyword">SELECT</span> select_options</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³çœ‹çœ‹æŸä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’çš„è¯ï¼Œå¯ä»¥åœ¨å…·ä½“çš„æŸ¥è¯¢è¯­å¥å‰è¾¹åŠ ä¸€ä¸ª EXPLAIN ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>EXPLAIN è¯­å¥è¾“å‡ºçš„å„ä¸ªåˆ—çš„ä½œç”¨å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628212049096.png" alt="image-20220628212049096" style="zoom:67%;" /><p>åœ¨è¿™é‡ŒæŠŠå®ƒä»¬éƒ½åˆ—å‡ºæ¥çŸ¥è¯†ä¸ºäº†æè¿°ä¸€ä¸ªè½®å»“ï¼Œè®©å¤§å®¶æœ‰ä¸€ä¸ªå¤§è‡´çš„å°è±¡ã€‚</p><hr><h3 id="6-2-æ•°æ®å‡†å¤‡">6.2 æ•°æ®å‡†å¤‡</h3><div class="tabs" id="278ee7fa-8801-4ba2-9168-68be67cc58fe"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#278ee7fa-8801-4ba2-9168-68be67cc58fe-1"><i class="fas fa-atom"></i>æ­¥éª¤1</button></li><li class="tab"><button type="button" data-href="#278ee7fa-8801-4ba2-9168-68be67cc58fe-2"><i class="far fa-sun"></i>æ­¥éª¤2</button></li><li class="tab"><button type="button" data-href="#278ee7fa-8801-4ba2-9168-68be67cc58fe-3"><i class="fas fa-wind"></i>æ­¥éª¤3</button></li><li class="tab"><button type="button" data-href="#278ee7fa-8801-4ba2-9168-68be67cc58fe-4"><i class="fas fa-fire-alt"></i>æ­¥éª¤4</button></li><li class="tab"><button type="button" data-href="#278ee7fa-8801-4ba2-9168-68be67cc58fe-5"><i class="fas fa-dragon"></i>æ­¥éª¤5</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="278ee7fa-8801-4ba2-9168-68be67cc58fe-1"><blockquote><p>å»ºè¡¨</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> s1 (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">    key1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    key2 <span class="type">INT</span>,</span><br><span class="line">    key3 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    key_part1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    key_part2 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    key_part3 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    common_field <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    INDEX idx_key1 (key1),</span><br><span class="line">    <span class="keyword">UNIQUE</span> INDEX idx_key2 (key2),</span><br><span class="line">    INDEX idx_key3 (key3),</span><br><span class="line">    INDEX idx_key_part(key_part1, key_part2, key_part3)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> s2 (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">    key1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    key2 <span class="type">INT</span>,</span><br><span class="line">    key3 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    key_part1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    key_part2 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    key_part3 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    common_field <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    INDEX idx_key1 (key1),</span><br><span class="line">    <span class="keyword">UNIQUE</span> INDEX idx_key2 (key2),</span><br><span class="line">    INDEX idx_key3 (key3),</span><br><span class="line">    INDEX idx_key_part(key_part1, key_part2, key_part3)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="278ee7fa-8801-4ba2-9168-68be67cc58fe-2"><blockquote><p>è®¾ç½®å‚æ•° log_bin_trust_function_creators</p></blockquote><p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼Œéœ€å¼€å¯å¦‚ä¸‹å‘½ä»¤ï¼šå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>; # ä¸åŠ <span class="keyword">global</span>åªæ˜¯å½“å‰çª—å£æœ‰æ•ˆã€‚</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="278ee7fa-8801-4ba2-9168-68be67cc58fe-3"><blockquote><p>åˆ›å»ºå‡½æ•°</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_string1(n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>) #è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span></span><br><span class="line"><span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> return_str <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;</span> n DO</span><br><span class="line">        <span class="keyword">SET</span> return_str <span class="operator">=</span>CONCAT(return_str,<span class="built_in">SUBSTRING</span>(chars_str,<span class="built_in">FLOOR</span>(<span class="number">1</span><span class="operator">+</span>RAND()<span class="operator">*</span><span class="number">52</span>),<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="278ee7fa-8801-4ba2-9168-68be67cc58fe-4"><blockquote><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p></blockquote><p>åˆ›å»ºå¾€s1è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_s1 (<span class="keyword">IN</span> min_num <span class="type">INT</span> (<span class="number">10</span>),<span class="keyword">IN</span> max_num <span class="type">INT</span> (<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    REPEAT</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> s1 <span class="keyword">VALUES</span>(</span><br><span class="line">        (min_num <span class="operator">+</span> i),</span><br><span class="line">        rand_string1(<span class="number">6</span>),</span><br><span class="line">        (min_num <span class="operator">+</span> <span class="number">30</span> <span class="operator">*</span> i <span class="operator">+</span> <span class="number">5</span>),</span><br><span class="line">        rand_string1(<span class="number">6</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>),</span><br><span class="line">        rand_string1(<span class="number">5</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>));</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¾€s2è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_s2 (<span class="keyword">IN</span> min_num <span class="type">INT</span> (<span class="number">10</span>),<span class="keyword">IN</span> max_num <span class="type">INT</span> (<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    REPEAT</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> s2 <span class="keyword">VALUES</span>(</span><br><span class="line">        (min_num <span class="operator">+</span> i),</span><br><span class="line">        rand_string1(<span class="number">6</span>),</span><br><span class="line">        (min_num <span class="operator">+</span> <span class="number">30</span> <span class="operator">*</span> i <span class="operator">+</span> <span class="number">5</span>),</span><br><span class="line">        rand_string1(<span class="number">6</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>),</span><br><span class="line">        rand_string1(<span class="number">5</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>));</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="278ee7fa-8801-4ba2-9168-68be67cc58fe-5"><blockquote><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</p></blockquote><p>s1è¡¨æ•°æ®çš„æ·»åŠ ï¼šåŠ å…¥1ä¸‡æ¡è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> insert_s1(<span class="number">10001</span>,<span class="number">10000</span>);</span><br></pre></td></tr></table></figure><p>s2è¡¨æ•°æ®çš„æ·»åŠ ï¼šåŠ å…¥1ä¸‡æ¡è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> insert_s2(<span class="number">10001</span>,<span class="number">10000</span>);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h3 id="6-3-EXPLAINå„åˆ—ä½œç”¨">6.3 EXPLAINå„åˆ—ä½œç”¨</h3><p>ä¸ºäº†è®©å¤§å®¶æœ‰æ¯”è¾ƒå¥½çš„ä½“éªŒï¼Œæˆ‘ä»¬è°ƒæ•´äº†ä¸‹<code>EXPLAIN</code>è¾“å‡ºåˆ—çš„é¡ºåºã€‚</p><div class="tabs" id="3d8c80d0-e512-487e-8c93-0506e90c7af1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-1"><i class="fas fa-bug"></i>table</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-2"><i class="fas fa-cannabis"></i>id</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-3"><i class="fas fa-candy-cane"></i>select_type</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-4"><i class="fas fa-child"></i>partitions</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-5"><i class="fas fa-award"></i>typeâ˜†</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-6"><i class="fas fa-baseball-ball"></i>possible_keyså’Œkey</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-7"><i class="fas fa-bone"></i>key_lenâ˜†</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-8"><i class="fas fa-anchor"></i>ref</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-9"><i class="fas fa-atom"></i>rowsâ˜†</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-10"><i class="far fa-sun"></i>filtered</button></li><li class="tab"><button type="button" data-href="#3d8c80d0-e512-487e-8c93-0506e90c7af1-11"><i class="fas fa-wind"></i>Extraâ˜†</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-1"><p>ä¸è®ºæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æœ‰å¤šå¤æ‚ï¼Œé‡Œè¾¹å„¿åŒ…å«äº†å¤šå°‘ä¸ªè¡¨ ï¼Œåˆ°æœ€åä¹Ÿæ˜¯éœ€è¦å¯¹æ¯ä¸ªè¡¨è¿›è¡Œ å•è¡¨è®¿é—® çš„ï¼Œæ‰€ ä»¥MySQLè§„å®šEXPLAINè¯­å¥è¾“å‡ºçš„æ¯æ¡è®°å½•éƒ½å¯¹åº”ç€æŸä¸ªå•è¡¨çš„è®¿é—®æ–¹æ³•ï¼Œè¯¥æ¡è®°å½•çš„tableåˆ—ä»£è¡¨ç€è¯¥ è¡¨çš„è¡¨åï¼ˆæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åå­—ï¼Œå¯èƒ½æ˜¯ç®€ç§°ï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628221143339.png" alt="image-20220628221143339"></p><p>è¿™ä¸ªæŸ¥è¯¢è¯­å¥åªæ¶‰åŠå¯¹s1è¡¨çš„å•è¡¨æŸ¥è¯¢ï¼Œæ‰€ä»¥<code>EXPLAIN</code>è¾“å‡ºä¸­åªæœ‰ä¸€æ¡è®°å½•ï¼Œå…¶ä¸­çš„tableåˆ—çš„å€¼ä¸ºs1ï¼Œè¡¨æ˜è¿™æ¡è®°å½•æ˜¯ç”¨æ¥è¯´æ˜å¯¹s1è¡¨çš„å•è¡¨è®¿é—®æ–¹æ³•çš„ã€‚</p><p>ä¸‹è¾¹æˆ‘ä»¬çœ‹ä¸€ä¸ªè¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628221414097.png" alt="image-20220628221414097"></p><p>å¯ä»¥çœ‹å‡ºè¿™ä¸ªè¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­æœ‰ä¸¤æ¡è®°å½•ï¼Œè¿™ä¸¤æ¡è®°å½•çš„tableåˆ—åˆ†åˆ«æ˜¯s1å’Œs2ï¼Œè¿™ä¸¤æ¡è®°å½•ç”¨æ¥åˆ†åˆ«è¯´æ˜å¯¹s1è¡¨å’Œs2è¡¨çš„è®¿é—®æ–¹æ³•æ˜¯ä»€ä¹ˆã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-2"><p>æˆ‘ä»¬å†™çš„æŸ¥è¯¢è¯­å¥ä¸€èˆ¬éƒ½ä»¥ SELECT å…³é”®å­—å¼€å¤´ï¼Œæ¯”è¾ƒç®€å•çš„æŸ¥è¯¢è¯­å¥é‡Œåªæœ‰ä¸€ä¸ª SELECT å…³é”®å­—ï¼Œæ¯” å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç¨å¾®å¤æ‚ä¸€ç‚¹çš„è¿æ¥æŸ¥è¯¢ä¸­ä¹Ÿåªæœ‰ä¸€ä¸ª SELECT å…³é”®å­—ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2</span><br><span class="line"><span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1</span><br><span class="line"><span class="keyword">WHERE</span> s1.common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸‹è¾¹ä¸¤ç§æƒ…å†µä¸‹åœ¨ä¸€æ¡æŸ¥è¯¢è¯­å¥ä¸­ä¼šå‡ºç°å¤šä¸ªSELECTå…³é”®å­—ï¼š</p><ul><li><p><span class='p red'>æŸ¥è¯¢ä¸­åŒ…å«å­æŸ¥è¯¢çš„æƒ…å†µ</span></p><p>æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥å°±åŒ…å«ä¸¤ä¸ª<code>SELECT</code>å…³é”®å­—:</p></li></ul><p><code>SELECT * FROM s1 WHERE key1 IN (SELECT key3 FROM s2)</code></p><ul><li><p><span class='p red'>æŸ¥è¯¢ä¸­åŒ…å«<code>UNION</code>è¯­å¥çš„æƒ…å†µ</span></p><p>æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­ä¹ŸåŒ…å«2ä¸ª<code>SELECT</code>å…³é”®å­—ï¼š</p></li></ul><p><code>SELECT * FROM s1 UNION SELECT * FROM s2;</code></p><p><span class='p red'>æŸ¥è¯¢è¯­å¥ä¸­æ¯å‡ºç°ä¸€ä¸ª<code>SELECT</code>å…³é”®å­—</span>ï¼Œ<span class='p red'>MySQLå°±ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„<code>id</code>å€¼ã€‚</span>è¿™ä¸ª<code>id</code>å€¼å°±æ˜¯<code>EXPLAIN</code>è¯­å¥çš„ç¬¬ä¸€ä¸ªåˆ—ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ä¸­åªæœ‰ä¸€ä¸ª SELECT å…³é”®å­—ï¼Œæ‰€ä»¥<code>EXPLAIN</code>çš„ç»“æœä¸­ä¹Ÿå°±åªæœ‰ä¸€æ¡<code>id</code>åˆ—ä¸º<code>1</code>çš„è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628222055716.png" alt="image-20220628222055716"></p><p>å¯¹äºè¿æ¥æŸ¥è¯¢æ¥è¯´ï¼Œä¸€ä¸ªSELECTå…³é”®å­—åè¾¹çš„FROMå­—å¥ä¸­å¯ä»¥è·Ÿéšå¤šä¸ªè¡¨ï¼Œæ‰€ä»¥åœ¨è¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ªè¡¨éƒ½ä¼šå¯¹åº”ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯è¿™äº›è®°å½•çš„idå€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220628222251309.png" alt="image-20220628222251309"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°è¿æ¥æŸ¥è¯¢ä¸­å‚ä¸è¿æ¥çš„s1å’Œs2è¡¨åˆ†åˆ«å¯¹åº”ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯è¿™ä¸¤æ¡è®°å½•å¯¹åº”çš„<code>id</code>éƒ½æ˜¯1ã€‚è¿™é‡Œéœ€è¦å¤§å®¶è®°ä½çš„æ˜¯ï¼Œ<strong>åœ¨è¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ªè¡¨éƒ½ä¼šå¯¹åº”ä¸€æ¡è®°å½•ï¼Œè¿™äº›è®°å½•çš„idåˆ—çš„å€¼æ˜¯ç›¸åŒçš„</strong>ï¼Œå‡ºç°åœ¨å‰è¾¹çš„è¡¨è¡¨ç¤º<code>é©±åŠ¨è¡¨</code>ï¼Œå‡ºç°åœ¨åé¢çš„è¡¨è¡¨ç¤º<code>è¢«é©±åŠ¨è¡¨</code>ã€‚æ‰€ä»¥ä»ä¸Šè¾¹çš„EXPLAINè¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨å‡†å¤‡è®©s1è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œè®©s2è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚</p><p>å¯¹äºåŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥æ¥è¯´ï¼Œå°±å¯èƒ½æ¶‰åŠå¤šä¸ª<code>SELECT</code>å…³é”®å­—ï¼Œæ‰€ä»¥åœ¨åŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ª<code>SELECT</code>å…³é”®å­—éƒ½ä¼šå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„idå€¼ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> key1 <span class="keyword">FROM</span> s2) <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629165122837.png" alt="image-20220629165122837"></p><p>ä»è¾“å‡ºç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œs1è¡¨åœ¨å¤–å±‚æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚æŸ¥è¯¢æœ‰ä¸€ä¸ªç‹¬ç«‹çš„<code>SELECT</code>å…³é”®å­—ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¡è®°å½•çš„<code>id</code>å€¼å°±æ˜¯1ï¼Œs2è¡¨åœ¨å­æŸ¥è¯¢ä¸­ï¼Œå­æŸ¥è¯¢æœ‰ä¸€ä¸ª<code>ç‹¬ç«‹çš„SELECT</code>å…³é”®å­—ï¼Œæ‰€ä»¥ç¬¬äºŒæ¡è®°å½•çš„<code>id</code>å€¼å°±æ˜¯<code>2</code>ã€‚</p><p>ä½†æ˜¯è¿™é‡Œå¤§å®¶éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œ<span class='p red'>æŸ¥è¯¢ä¼˜åŒ–å™¨å¯èƒ½å¯¹æ¶‰åŠå­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥è¿›è¡Œé‡å†™ï¼Œä»è€Œè½¬æ¢ä¸ºè¿æ¥æŸ¥è¯¢ã€‚</span>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹æŸä¸ªåŒ…å«å­æŸ¥è¯¢çš„è¯­å¥æ˜¯å¦è¿›è¡Œäº†é‡å†™ï¼Œç›´æ¥æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’å°±å¥½äº†ï¼Œæ¯”å¦‚è¯´ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢ä¼˜åŒ–å™¨å¯èƒ½å¯¹æ¶‰åŠå­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥è¿›è¡Œé‡å†™ï¼Œè½¬å˜ä¸ºå¤šè¡¨æŸ¥è¯¢çš„æ“ä½œã€‚  </span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> key2 <span class="keyword">FROM</span> s2 <span class="keyword">WHERE</span> common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629165603072.png" alt="image-20220629165603072"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œä½†æ˜¯æ‰§è¡Œè®¡åˆ’ä¸­s1å’Œs2è¡¨å¯¹åº”çš„è®°å½•çš„<code>id</code>å€¼å…¨éƒ¨æ˜¯1ï¼Œè¿™å°±è¡¨æ˜<code>æŸ¥è¯¢ä¼˜åŒ–å™¨å°†å­æŸ¥è¯¢è½¬æ¢ä¸ºäº†è¿æ¥æŸ¥è¯¢</code>ã€‚</p><p>å¯¹äºåŒ…å«<code>UNION</code>å­å¥çš„æŸ¥è¯¢è¯­å¥æ¥è¯´ï¼Œæ¯ä¸ª<code>SELECT</code>å…³é”®å­—å¯¹åº”ä¸€ä¸ª<code>id</code>å€¼ä¹Ÿæ˜¯æ²¡é”™çš„ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰ç‚¹å„¿ç‰¹åˆ«çš„ä¸œè¥¿ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹çš„æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">Union</span>å»é‡</span><br><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629165909340.png" alt="image-20220629165909340"></p><p>è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œè®¡åˆ’çš„ç¬¬ä¸‰æ¡è®°å½•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä½•<code>id</code>å€¼æ˜¯<code>NULL</code>ï¼Œè€Œä¸”tableåˆ—ä¹Ÿå¾ˆå¥‡æ€ªï¼Ÿ<code>UNTON</code>ï¼å®ƒä¼šæŠŠå¤šä¸ªæŸ¥è¯¢çš„ç»“æœé›†åˆå¹¶èµ·æ¥å¹¶å¯¹ç»“æœé›†ä¸­çš„è®°å½•<code>è¿›è¡Œå»é‡</code>ï¼Œæ€ä¹ˆå»é‡å‘¢ï¼ŸMySQLä½¿ç”¨çš„æ˜¯å†…éƒ¨çš„<code>ä¸´æ—¶è¡¨</code>ã€‚æ­£å¦‚ä¸Šè¾¹çš„æŸ¥è¯¢è®¡åˆ’ä¸­æ‰€ç¤ºï¼ŒUNIONå­å¥æ˜¯ä¸ºäº†æŠŠidä¸º1çš„æŸ¥è¯¢å’Œidä¸º2çš„æŸ¥è¯¢çš„ç»“æœé›†åˆå¹¶èµ·æ¥å¹¶å»é‡ï¼Œæ‰€ä»¥åœ¨å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>&lt;union1,2&gt;</code>çš„ä¸´æ—¶è¡¨ï¼ˆå°±æ˜¯æ‰§è¡Œè®¡åˆ’ç¬¬ä¸‰æ¡è®°å½•çš„tableåˆ—çš„åç§°ï¼‰ï¼Œidä¸º<code>NULL</code>è¡¨æ˜è¿™ä¸ªä¸´æ—¶è¡¨æ˜¯ä¸ºäº†åˆå¹¶ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†è€Œåˆ›å»ºçš„ã€‚</p><p>è·ŸUNIONå¯¹æ¯”èµ·æ¥ï¼Œ<code>UNION ALL</code>å°±ä¸éœ€è¦ä¸ºæœ€ç»ˆçš„ç»“æœé›†è¿›è¡Œå»é‡ï¼Œå®ƒåªæ˜¯å•çº¯çš„æŠŠå¤šä¸ªæŸ¥è¯¢çš„ç»“æœé›†ä¸­çš„è®°å½•åˆå¹¶æˆä¸€ä¸ªå¹¶è¿”å›ç»™ç”¨æˆ·ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚æ‰€ä»¥åœ¨åŒ…å«<code>UNION ALL</code>å­å¥çš„æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œå°±æ²¡æœ‰é‚£ä¸ªidä¸ºNULLçš„è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629171138065.png" alt="image-20220629171138065"></p><p><strong>å°ç»“:</strong></p><ul><li>idå¦‚æœç›¸åŒï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œ</li><li>åœ¨æ‰€æœ‰ç»„ä¸­ï¼Œidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ</li><li>å…³æ³¨ç‚¹ï¼šidå·æ¯ä¸ªå·ç ï¼Œè¡¨ç¤ºä¸€è¶Ÿç‹¬ç«‹çš„æŸ¥è¯¢, ä¸€ä¸ªsqlçš„æŸ¥è¯¢è¶Ÿæ•°è¶Šå°‘è¶Šå¥½</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-3"><p>ä¸€æ¡å¤§çš„æŸ¥è¯¢è¯­å¥é‡Œè¾¹å¯ä»¥åŒ…å«è‹¥å¹²ä¸ªSELECTå…³é”®å­—ï¼Œ<code>æ¯ä¸ªSELECTå…³é”®å­—ä»£è¡¨ç€ä¸€ä¸ªå°çš„æŸ¥è¯¢è¯­å¥</code>ï¼Œè€Œæ¯ä¸ª SELECTå…³é”®å­—çš„FROMå­å¥ä¸­éƒ½å¯ä»¥åŒ…å«è‹¥å¹²å¼ è¡¨ï¼ˆè¿™äº›è¡¨ç”¨æ¥åšè¿æ¥æŸ¥è¯¢ï¼‰ï¼Œ<code>æ¯ä¸€å¼ è¡¨éƒ½å¯¹åº”è€…æ‰§è¡Œè®¡åˆ’è¾“å‡ºä¸­çš„ä¸€æ¡è®°å½•</code>ï¼Œå¯¹äºåœ¨åŒä¸€ä¸ªSELECTå…³é”®å­—ä¸­çš„è¡¨æ¥è¯´ï¼Œå®ƒä»¬çš„idå€¼æ˜¯ç›¸åŒçš„ã€‚</p><p>MySQLä¸ºæ¯â€”ä¸ªSELECTå…³é”®å­—ä»£è¡¨çš„å°æŸ¥è¯¢éƒ½å®šä¹‰äº†ä¸€ä¸ªç§°ä¹‹ä¸º<code>select_type</code>çš„å±æ€§ï¼Œæ„æ€æ˜¯æˆ‘ä»¬åªè¦çŸ¥é“äº†æŸä¸ªå°æŸ¥è¯¢çš„<code>select_type</code>å±æ€§ï¼Œå°±çŸ¥é“äº†è¿™ä¸ªå°æŸ¥è¯¢åœ¨æ•´ä¸ªå¤§æŸ¥è¯¢ä¸­æ‰®æ¼”äº†ä¸€ä¸ªä»€ä¹ˆè§’è‰²ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ select_typeéƒ½èƒ½å–å“ªäº›å€¼ï¼Œè¯·çœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230410163311883.png" alt="image-20230410163311883"></p><p>å…·ä½“åˆ†æå¦‚ä¸‹ï¼š</p><ul><li><p>SIMPLE</p><p>æŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å«<code>UNION</code>æˆ–è€…å­æŸ¥è¯¢çš„æŸ¥è¯¢éƒ½ç®—ä½œæ˜¯<code>SIMPLE</code>ç±»å‹ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªå•è¡¨æŸ¥è¯¢<code>select_type</code>çš„å€¼å°±æ˜¯<code>SIMPLE</code>:</p></li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629171840300.png" alt="image-20220629171840300"></p><p>â€‹        å½“ç„¶ï¼Œè¿æ¥æŸ¥è¯¢ä¹Ÿç®—æ˜¯ SIMPLE ç±»å‹ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629171904912.png" alt="image-20220629171904912"></p><ul><li><p>PRIMARY</p><p>å¯¹äºåŒ…å«<code>UNIONã€UNION ALL</code>æˆ–è€…å­æŸ¥è¯¢çš„å¤§æŸ¥è¯¢æ¥è¯´ï¼Œå®ƒæ˜¯ç”±å‡ ä¸ªå°æŸ¥è¯¢ç»„æˆçš„ï¼Œå…¶ä¸­æœ€å·¦è¾¹çš„é‚£ä¸ªæŸ¥è¯¢çš„<code>select_type</code>çš„å€¼å°±æ˜¯<code>PRIMARY</code>,æ¯”æ–¹è¯´ï¼š</p></li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629171929924.png" alt="image-20220629171929924"></p><p>ä»ç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ€å·¦è¾¹çš„å°æŸ¥è¯¢<code>SELECT * FROM s1</code>å¯¹åº”çš„æ˜¯æ‰§è¡Œè®¡åˆ’ä¸­çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå®ƒçš„<code>select_type</code>çš„å€¼å°±æ˜¯<code>PRIMARY</code>ã€‚</p><ul><li><p>UNION</p><p>å¯¹äºåŒ…å«<code>UNION</code>æˆ–è€…<code>UNION ALL</code>çš„å¤§æŸ¥è¯¢æ¥è¯´ï¼Œå®ƒæ˜¯ç”±å‡ ä¸ªå°æŸ¥è¯¢ç»„æˆçš„ï¼Œå…¶ä¸­é™¤äº†æœ€å·¦è¾¹çš„é‚£ä¸ªå°æŸ¥è¯¢æ„å¤–ï¼Œå…¶ä½™çš„å°æŸ¥è¯¢çš„<code>select_type</code>å€¼å°±æ˜¯UNIONï¼Œå¯ä»¥å¯¹æ¯”ä¸Šä¸€ä¸ªä¾‹å­çš„æ•ˆæœã€‚</p></li><li><p>UNION RESULT</p><p>MySQL é€‰æ‹©ä½¿ç”¨ä¸´æ—¶è¡¨æ¥å®Œæˆ<code>UNION</code>æŸ¥è¯¢çš„å»é‡å·¥ä½œï¼Œé’ˆå¯¹è¯¥ä¸´æ—¶è¡¨çš„æŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>UNION RESULT</code>, ä¾‹å­ä¸Šè¾¹æœ‰ã€‚</p></li><li><p>SUBQUERY</p><p>å¦‚æœåŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸èƒ½å¤Ÿè½¬ä¸ºå¯¹åº”çš„<code>semi-join</code>çš„å½¢å¼ï¼Œå¹¶ä¸”è¯¥å­æŸ¥è¯¢æ˜¯ä¸ç›¸å…³å­æŸ¥è¯¢ï¼Œå¹¶ä¸”æŸ¥è¯¢ä¼˜åŒ–å™¨å†³å®šé‡‡ç”¨å°†è¯¥å­æŸ¥è¯¢ç‰©åŒ–çš„æ–¹æ¡ˆæ¥æ‰§è¡Œè¯¥å­æŸ¥è¯¢æ—¶ï¼Œè¯¥å­æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ª<code>SELECT</code>å…³é”®å­—ä»£è¡¨çš„é‚£ä¸ªæŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>SUBQUERY</code>ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p></li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> key1 <span class="keyword">FROM</span> s2) <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629172449267.png" alt="image-20220629172449267"></p><ul><li>DEPENDENT SUBQUERY</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> key1 <span class="keyword">FROM</span> s2 <span class="keyword">WHERE</span> s1.key2 <span class="operator">=</span> s2.key2) <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629172525236.png" alt="image-20220629172525236"></p><ul><li>DEPENDENT UNION</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> key1 <span class="keyword">FROM</span> s2 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> key1 <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629172555603.png" alt="image-20220629172555603"></p><ul><li>DERIVED</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> key1, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c <span class="keyword">FROM</span> s1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> key1) <span class="keyword">AS</span> derived_s1 <span class="keyword">where</span> c <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629172622893.png" alt="image-20220629172622893"></p><p>ä»æ‰§è¡Œè®¡åˆ’ä¸­å¯ä»¥çœ‹å‡ºï¼Œidä¸º2çš„è®°å½•å°±ä»£è¡¨å­æŸ¥è¯¢çš„æ‰§è¡Œæ–¹å¼ï¼Œå®ƒçš„select_typeæ˜¯DERIVED, è¯´æ˜è¯¥å­æŸ¥è¯¢æ˜¯ä»¥ç‰©åŒ–çš„æ–¹å¼æ‰§è¡Œçš„ã€‚idä¸º1çš„è®°å½•ä»£è¡¨å¤–å±‚æŸ¥è¯¢ï¼Œå¤§å®¶æ³¨æ„çœ‹å®ƒçš„tableåˆ—æ˜¾ç¤ºçš„æ˜¯derived2ï¼Œè¡¨ç¤ºè¯¥æŸ¥è¯¢æ—¶é’ˆå¯¹å°†æ´¾ç”Ÿè¡¨ç‰©åŒ–ä¹‹åçš„è¡¨è¿›è¡ŒæŸ¥è¯¢çš„ã€‚</p><ul><li><p>MATERIALIZED</p><p>å½“æŸ¥è¯¢ä¼˜åŒ–å™¨åœ¨æ‰§è¡ŒåŒ…å«å­æŸ¥è¯¢çš„è¯­å¥æ—¶ï¼Œé€‰æ‹©å°†å­æŸ¥è¯¢ç‰©åŒ–ä¹‹åçš„å¤–å±‚æŸ¥è¯¢è¿›è¡Œè¿æ¥æŸ¥è¯¢æ—¶ï¼Œè¯¥å­æŸ¥è¯¢å¯¹åº”çš„<code>select_type</code>å±æ€§å°±æ˜¯DERIVEDï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p></li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> key1 <span class="keyword">FROM</span> s2);</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629172646367.png" alt="image-20220629172646367"></p><ul><li><p>UNCACHEABLE SUBQUERY</p><p>ä¸å¸¸ç”¨ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p></li><li><p>UNCACHEABLE UNION</p><p>ä¸å¸¸ç”¨ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-4"><blockquote><p>(å¯ç•¥)</p></blockquote><ul><li>ä»£è¡¨åˆ†åŒºè¡¨ä¸­çš„å‘½ä¸­æƒ…å†µï¼Œéåˆ†åŒºè¡¨ï¼Œè¯¥é¡¹ä¸º<code>NULL</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„é¢æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’çš„<code>partitions</code>åˆ—çš„å€¼ä¸º<code>NULL</code>ã€‚</li><li><a>https://dev.mysql.com/doc/refman/5.7/en/alter-table-partition-operations.html</a></li><li>å¦‚æœæƒ³è¯¦ç»†äº†è§£ï¼Œå¯ä»¥å¦‚ä¸‹æ–¹å¼æµ‹è¯•ã€‚åˆ›å»ºåˆ†åŒºè¡¨ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºåˆ†åŒºè¡¨ï¼Œ</span></span><br><span class="line"><span class="comment">-- æŒ‰ç…§idåˆ†åŒºï¼Œid&lt;100 p0åˆ†åŒºï¼Œå…¶ä»–p1åˆ†åŒº</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_partitions (id <span class="type">INT</span> auto_increment,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">12</span>),<span class="keyword">PRIMARY</span> KEY(id))</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(id)(</span><br><span class="line"><span class="keyword">PARTITION</span> p0 <span class="keyword">VALUES</span> less than(<span class="number">100</span>),</span><br><span class="line"><span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> less than MAXVALUE</span><br><span class="line">);</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629190304966.png" alt="image-20220629190304966"  /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESC</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_partitions <span class="keyword">WHERE</span> id<span class="operator">&gt;</span><span class="number">200</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢idå¤§äº200ï¼ˆ200&gt;100ï¼Œp1åˆ†åŒºï¼‰çš„è®°å½•ï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œpartitionsæ˜¯p1ï¼Œç¬¦åˆæˆ‘ä»¬çš„åˆ†åŒºè§„åˆ™</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220629190335371.png" alt="image-20220629190335371"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-5"><p>æ‰§è¡Œè®¡åˆ’çš„ä¸€æ¡è®°å½•å°±ä»£è¡¨ç€MySQLå¯¹æŸä¸ªè¡¨çš„<code>æ‰§è¡ŒæŸ¥è¯¢æ—¶çš„è®¿é—®æ–¹æ³•</code>, åˆç§°â€œè®¿é—®ç±»å‹â€ï¼Œå…¶ä¸­çš„<code>type</code>åˆ—å°±è¡¨æ˜äº†è¿™ä¸ªè®¿é—®æ–¹æ³•æ˜¯å•¥ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ã€‚æ¯”å¦‚ï¼Œçœ‹åˆ°<code>type</code>åˆ—çš„å€¼æ˜¯<code>ref</code>ï¼Œè¡¨æ˜<code>MySQL</code>å³å°†ä½¿ç”¨<code>ref</code>è®¿é—®æ–¹æ³•æ¥æ‰§è¡Œå¯¹<code>s1</code>è¡¨çš„æŸ¥è¯¢ã€‚</p><p>å®Œæ•´çš„è®¿é—®æ–¹æ³•å¦‚ä¸‹ï¼š<code>systemï¼Œconstï¼Œeq_refï¼Œrefï¼Œfulltextï¼Œref_or_nullï¼Œindex_mergeï¼Œunique_subqueryï¼Œindex_subqueryï¼Œrangeï¼Œindex ï¼ŒALL</code>ã€‚</p><p>æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p><p>*<code>system</code></p><p>å½“è¡¨ä¸­<code>åªæœ‰ä¸€æ¡è®°å½•</code>å¹¶ä¸”è¯¥è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œæ¯”å¦‚MyISAMã€Memoryï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯<code>system</code>ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æ–°å»ºä¸€ä¸ª<code>MyISAM</code>è¡¨ï¼Œå¹¶ä¸ºå…¶æ’å…¥ä¸€æ¡è®°å½•ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t(i <span class="type">int</span>) Engine<span class="operator">=</span>MyISAM;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.05</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t <span class="keyword">VALUES</span>(<span class="number">1</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹æŸ¥è¯¢è¿™ä¸ªè¡¨çš„æ‰§è¡Œè®¡åˆ’ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t;</span><br></pre></td></tr></table></figure>  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220630164434315.png" alt="image-20220630164434315"  /><p>å¯ä»¥çœ‹åˆ°<code>type</code>åˆ—çš„å€¼å°±æ˜¯<code>system</code>äº†ï¼Œ</p><blockquote><p>æµ‹è¯•ï¼Œå¯ä»¥æŠŠè¡¨æ”¹æˆä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ï¼Œè¯•è¯•çœ‹æ‰§è¡Œè®¡åˆ’çš„<code>type</code>åˆ—æ˜¯ä»€ä¹ˆã€‚ALL</p></blockquote><p>*<code>const</code></p><p>å½“æˆ‘ä»¬æ ¹æ®ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯<code>const</code>, æ¯”å¦‚ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10005</span>;</span><br></pre></td></tr></table></figure>  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220630164724548.png" alt="image-20220630164724548"  /><p>*<code>eq_ref</code></p><p>åœ¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè¢«é©±åŠ¨è¡¨æ˜¯é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ç­‰å€¼åŒ¹é…çš„æ–¹å¼è¿›è¡Œè®¿é—®çš„ï¼ˆå¦‚æœè¯¥ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•æ˜¯è”åˆç´¢å¼•çš„è¯ï¼Œæ‰€æœ‰çš„ç´¢å¼•åˆ—éƒ½å¿…é¡»è¿›è¡Œç­‰å€¼æ¯”è¾ƒï¼‰ã€‚åˆ™å¯¹è¯¥è¢«é©±åŠ¨è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯<code>eq_ref</code>ï¼Œæ¯”æ–¹è¯´ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.id <span class="operator">=</span> s2.id;</span><br></pre></td></tr></table></figure>  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220630164802559.png" alt="image-20220630164802559"  /><p>ä»æ‰§è¡Œè®¡åˆ’çš„ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼ŒMySQLæ‰“ç®—å°†s2ä½œä¸ºé©±åŠ¨è¡¨ï¼Œs1ä½œä¸ºè¢«é©±åŠ¨è¡¨ï¼Œé‡ç‚¹å…³æ³¨s1çš„è®¿é—® æ–¹æ³•æ˜¯<code>eq_ref</code>ï¼Œè¡¨æ˜åœ¨è®¿é—®s1è¡¨çš„æ—¶å€™å¯ä»¥<code>é€šè¿‡ä¸»é”®çš„ç­‰å€¼åŒ¹é…</code>æ¥è¿›è¡Œè®¿é—®ã€‚</p><p>*<code>ref</code></p><p>å½“é€šè¿‡æ™®é€šçš„äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶æ¥æŸ¥è¯¢æŸä¸ªè¡¨ï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±å¯èƒ½æ˜¯<code>ref</code>ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220630164930020.png" alt="image-20220630164930020"  /><p>*<code>fulltext</code></p><p>å…¨æ–‡ç´¢å¼•</p><p>*<code>ref_or_null</code></p><p>å½“å¯¹æ™®é€šäºŒçº§ç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹é…æŸ¥è¯¢ï¼Œè¯¥ç´¢å¼•åˆ—çš„å€¼ä¹Ÿå¯ä»¥æ˜¯<code>NULL</code>å€¼æ—¶ï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±å¯èƒ½æ˜¯<code>ref_or_null</code>ï¼Œæ¯”å¦‚è¯´ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">OR</span> key1 <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220630175133920.png" alt="image-20220630175133920"  /><p>*<code>index_merge</code></p><p>ä¸€èˆ¬æƒ…å†µä¸‹å¯¹äºæŸä¸ªè¡¨çš„æŸ¥è¯¢åªèƒ½ä½¿ç”¨åˆ°ä¸€ä¸ªç´¢å¼•ï¼Œä½†å•è¡¨è®¿é—®æ–¹æ³•æ—¶åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥ä½¿ç”¨<code>Interseationã€unionã€Sort-Union</code>è¿™ä¸‰ç§ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰§è¡Œè®¡åˆ’ä¸­æ˜¯æ€ä¹ˆä½“ç°MySQLä½¿ç”¨ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ¥å¯¹æŸä¸ªè¡¨æ‰§è¡ŒæŸ¥è¯¢çš„ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220630175511644.png" alt="image-20220630175511644"  /><p>ä»æ‰§è¡Œè®¡åˆ’çš„<code>type</code>åˆ—çš„å€¼æ˜¯<code>index_merge</code>å°±å¯ä»¥çœ‹å‡ºï¼ŒMySQL æ‰“ç®—ä½¿ç”¨ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ¥æ‰§è¡Œ å¯¹ s1 è¡¨çš„æŸ¥è¯¢ã€‚</p><p>*<code>unique_subquery</code></p><p>ç±»ä¼¼äºä¸¤è¡¨è¿æ¥ä¸­è¢«é©±åŠ¨è¡¨çš„<code>eq_ref</code>è®¿é—®æ–¹æ³•ï¼Œ<code>unique_subquery</code>æ˜¯é’ˆå¯¹åœ¨ä¸€äº›åŒ…å«<code>IN</code>å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¦‚æœæŸ¥è¯¢ä¼˜åŒ–å™¨å†³å®šå°†<code>IN</code>å­æŸ¥è¯¢è½¬æ¢ä¸º<code>EXISTS</code>å­æŸ¥è¯¢ï¼Œè€Œä¸”å­æŸ¥è¯¢å¯ä»¥ä½¿ç”¨åˆ°ä¸»é”®è¿›è¡Œç­‰å€¼åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆè¯¥å­æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’çš„<code>type</code>åˆ—çš„å€¼å°±æ˜¯<code>unique_subquery</code>ï¼Œæ¯”å¦‚ä¸‹è¾¹çš„è¿™ä¸ªæŸ¥è¯¢è¯­å¥ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key2 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> s2 <span class="keyword">where</span> s1.key1 <span class="operator">=</span> s2.key1) <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220630180123913.png" alt="image-20220630180123913"  /><p>+<code>index_subquery</code></p><p><code>index_subquery</code>ä¸<code>unique_subquery</code>ç±»ä¼¼ï¼Œåªä¸è¿‡è®¿é—®å­æŸ¥è¯¢ä¸­çš„è¡¨æ—¶ä½¿ç”¨çš„æ˜¯æ™®é€šçš„ç´¢å¼•ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> common_field <span class="keyword">IN</span> (<span class="keyword">SELECT</span> key3 <span class="keyword">FROM</span> s2 <span class="keyword">where</span> s1.key1 <span class="operator">=</span> s2.key1) <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220703214407225.png" alt="image-20220703214407225"></p><p>*<code>range</code></p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220703214633338.png" alt="image-20220703214633338"></p><p>æˆ–è€…ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">AND</span> key1 <span class="operator">&lt;</span> <span class="string">&#x27;b&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220703214657251.png" alt="image-20220703214657251"></p><p>*<code>index</code></p><p>å½“æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç´¢å¼•è¦†ç›–ï¼Œä½†éœ€è¦æ‰«æå…¨éƒ¨çš„ç´¢å¼•è®°å½•æ—¶ï¼Œè¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯<code>index</code>ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> key_part2 <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key_part3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220703214844885.png" alt="image-20220703214844885"></p><p>ä¸Šè¿°æŸ¥è¯¢ä¸­çš„æ‰€æœ‰åˆ—è¡¨ä¸­åªæœ‰key_part2 ä¸€ä¸ªåˆ—ï¼Œè€Œä¸”æœç´¢æ¡ä»¶ä¸­ä¹Ÿåªæœ‰ key_part3 ä¸€ä¸ªåˆ—ï¼Œè¿™ä¸¤ä¸ªåˆ—åˆæ°å¥½åŒ…å«åœ¨idx_key_partè¿™ä¸ªç´¢å¼•ä¸­ï¼Œå¯æ˜¯æœç´¢æ¡ä»¶key_part3ä¸èƒ½ç›´æ¥ä½¿ç”¨è¯¥ç´¢å¼•è¿›è¡Œ<code>ref</code>å’Œ<code>range</code>æ–¹å¼çš„è®¿é—®ï¼Œåªèƒ½æ‰«ææ•´ä¸ª<code>idx_key_part</code>ç´¢å¼•çš„è®°å½•ï¼Œæ‰€ä»¥æŸ¥è¯¢è®¡åˆ’çš„<code>type</code>åˆ—çš„å€¼å°±æ˜¯<code>index</code>ã€‚</p><blockquote><p>å†ä¸€æ¬¡å¼ºè°ƒï¼Œå¯¹äºä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•çš„è®°å½•åªåŒ…å«ç´¢å¼•åˆ—å’Œä¸»é”®åˆ—çš„å€¼ï¼Œè€Œèšç°‡ç´¢å¼•ä¸­åŒ…å«ç”¨æˆ·å®šä¹‰çš„å…¨éƒ¨åˆ—ä»¥åŠä¸€äº›éšè—åˆ—ï¼Œæ‰€ä»¥æ‰«æäºŒçº§ç´¢å¼•çš„ä»£ä»·æ¯”ç›´æ¥å…¨è¡¨æ‰«æï¼Œä¹Ÿå°±æ˜¯æ‰«æèšç°‡ç´¢å¼•çš„ä»£ä»·æ›´ä½ä¸€äº›ã€‚</p></blockquote><p>*<code>ALL</code></p><p>æœ€ç†Ÿæ‚‰çš„å…¨è¡¨æ‰«æï¼Œå°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥çœ‹ä¾‹å­ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220703215958374.png" alt="image-20220703215958374"></p><p>å°ç»“:</p><p>ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯ï¼š</p><p><span class='p green'>system &gt; const &gt; eq_ref &gt; ref</span>&gt;fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; <span class='p green'>range &gt; index &gt; ALL</span></p><p>å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæå–å‡ºæ¥ï¼ˆè§ä¸Šå›¾ä¸­çš„ç»¿è‰²ï¼‰ã€‚SQL æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° range çº§åˆ«ï¼Œè¦æ±‚æ˜¯ ref çº§åˆ«ï¼Œæœ€å¥½æ˜¯ constsçº§åˆ«ã€‚ï¼ˆé˜¿é‡Œå·´å·´ å¼€å‘æ‰‹å†Œè¦æ±‚ï¼‰</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-6"><p>åœ¨EXPLAINè¯­å¥è¾“å‡ºçš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œ<code>possible_keys</code>åˆ—è¡¨ç¤ºåœ¨æŸä¸ªæŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¯¹æŸä¸ªåˆ—æ‰§è¡Œ<code>å•è¡¨æŸ¥è¯¢æ—¶å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•</code>æœ‰å“ªäº›ã€‚ä¸€èˆ¬æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨ã€‚<code>key</code>åˆ—è¡¨ç¤º<code>å®é™…ç”¨åˆ°çš„ç´¢å¼•</code>æœ‰å“ªäº›ï¼Œå¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚æ¯”æ–¹è¯´ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span> <span class="keyword">AND</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220703220724964.png" alt="image-20220703220724964"></p><p>ä¸Šè¿°æ‰§è¡Œè®¡åˆ’çš„<code>possible_keys</code>åˆ—çš„å€¼æ˜¯<code>idx_key1, idx_key3</code>ï¼Œè¡¨ç¤ºè¯¥æŸ¥è¯¢å¯èƒ½ä½¿ç”¨åˆ°<code>idx_key1, idx_key3</code>ä¸¤ä¸ªç´¢å¼•ï¼Œç„¶å<code>key</code>åˆ—çš„å€¼æ˜¯<code>idx_key3</code>ï¼Œè¡¨ç¤ºç»è¿‡æŸ¥è¯¢ä¼˜åŒ–å™¨è®¡ç®—ä½¿ç”¨ä¸åŒç´¢å¼•çš„æˆæœ¬åï¼Œæœ€åå†³å®šé‡‡ç”¨<code>idx_key3</code>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-7"><p>å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•é•¿åº¦ (å³ï¼šå­—èŠ‚æ•°)</p><p>å¸®ä½ æ£€æŸ¥<code>æ˜¯å¦å……åˆ†çš„åˆ©ç”¨äº†ç´¢å¼•</code>ï¼Œ<code>å€¼è¶Šå¤§è¶Šå¥½</code>ï¼Œä¸»è¦é’ˆå¯¹äºè”åˆç´¢å¼•ï¼Œæœ‰ä¸€å®šçš„å‚è€ƒæ„ä¹‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10005</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704130030692.png" alt="image-20220704130030692"></p><blockquote><p>int å ç”¨ 4 ä¸ªå­—èŠ‚ ä¸»é”®éç©º</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key2 <span class="operator">=</span> <span class="number">10126</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704130138204.png" alt="image-20220704130138204"></p><blockquote><p>key2ä¸Šæœ‰ä¸€ä¸ªå”¯ä¸€æ€§çº¦æŸï¼Œæ˜¯å¦ä¸ºNULLå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°±æ˜¯5ä¸ªå­—èŠ‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704130214482.png" alt="image-20220704130214482"></p><blockquote><p>key1 VARCHAR(100) ä¸€ä¸ªå­—ç¬¦å 3ä¸ªå­—èŠ‚ï¼Œ100*3ï¼Œæ˜¯å¦ä¸ºNULLå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œvarcharçš„é•¿åº¦ä¿¡æ¯å ä¸¤ä¸ªå­—èŠ‚ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key_part1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704130442095.png" alt="image-20220704130442095"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key_part1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">AND</span> key_part2 <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704130515031.png" alt="image-20220704130515031"></p><blockquote><p>è”åˆç´¢å¼•ä¸­å¯ä»¥æ¯”è¾ƒï¼Œkey_len=606çš„å¥½äºkey_len=303</p></blockquote><p>ç»ƒä¹ ï¼š</p><p>key_lençš„é•¿åº¦è®¡ç®—å…¬å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">varchar</span>(<span class="number">10</span>)å˜é•¿å­—æ®µä¸”å…è®¸<span class="keyword">NULL</span> <span class="operator">=</span> <span class="number">10</span> <span class="operator">*</span> ( <span class="type">character</span> <span class="keyword">set</span>ï¼šutf8<span class="operator">=</span><span class="number">3</span>,gbk<span class="operator">=</span><span class="number">2</span>,latin1<span class="operator">=</span><span class="number">1</span>)<span class="operator">+</span><span class="number">1</span>(<span class="keyword">NULL</span>)<span class="operator">+</span><span class="number">2</span>(å˜é•¿å­—æ®µ)</span><br><span class="line"></span><br><span class="line"><span class="type">varchar</span>(<span class="number">10</span>)å˜é•¿å­—æ®µä¸”ä¸å…è®¸<span class="keyword">NULL</span> <span class="operator">=</span> <span class="number">10</span> <span class="operator">*</span> ( <span class="type">character</span> <span class="keyword">set</span>ï¼šutf8<span class="operator">=</span><span class="number">3</span>,gbk<span class="operator">=</span><span class="number">2</span>,latin1<span class="operator">=</span><span class="number">1</span>)<span class="operator">+</span><span class="number">2</span>(å˜é•¿å­—æ®µ)</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>(<span class="number">10</span>)å›ºå®šå­—æ®µä¸”å…è®¸<span class="keyword">NULL</span> <span class="operator">=</span> <span class="number">10</span> <span class="operator">*</span> ( <span class="type">character</span> <span class="keyword">set</span>ï¼šutf8<span class="operator">=</span><span class="number">3</span>,gbk<span class="operator">=</span><span class="number">2</span>,latin1<span class="operator">=</span><span class="number">1</span>)<span class="operator">+</span><span class="number">1</span>(<span class="keyword">NULL</span>)</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>(<span class="number">10</span>)å›ºå®šå­—æ®µä¸”ä¸å…è®¸<span class="keyword">NULL</span> <span class="operator">=</span> <span class="number">10</span> <span class="operator">*</span> ( <span class="type">character</span> <span class="keyword">set</span>ï¼šutf8<span class="operator">=</span><span class="number">3</span>,gbk<span class="operator">=</span><span class="number">2</span>,latin1<span class="operator">=</span><span class="number">1</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-8"><p>æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ã€‚</p><p>å½“ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼åŒ¹é…çš„æ¡ä»¶å»æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¹Ÿå°±æ˜¯åœ¨è®¿é—®æ–¹æ³•æ˜¯<code>const</code>ã€<code>eq-ref</code>ã€<code>ref</code>ã€<code>ref_or-null</code>ã€<code>unique_subquery</code>ã€<code>index_subquery</code>å…¶ä¸­ä¹‹ä¸€æ—¶ï¼Œ<code>ref</code>åˆ—å±•ç¤ºçš„å°±æ˜¯ä¸ç´¢å¼•åˆ—ä½œç­‰å€¼åŒ¹é…çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚åªæ˜¯ä¸€ä¸ªå¸¸æ•°æˆ–è€…æ˜¯æŸä¸ªåˆ—ã€‚å¤§å®¶çœ‹ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704130837498.png" alt="image-20220704130837498"></p><p>å¯ä»¥çœ‹åˆ°<code>ref</code>åˆ—çš„å€¼æ˜¯<code>const</code>ï¼Œè¡¨æ˜åœ¨ä½¿ç”¨<code>idx_key1</code>ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¸<code>key1</code>åˆ—ä½œç­‰å€¼åŒ¹é…çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œå½“ç„¶æœ‰æ—¶å€™æ›´å¤æ‚ä¸€ç‚¹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.id <span class="operator">=</span> s2.id;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704130925426.png" alt="image-20220704130925426"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s2.key1 <span class="operator">=</span> <span class="built_in">UPPER</span>(s1.key1);</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704130957359.png" alt="image-20220704130957359"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-9"><p>é¢„ä¼°çš„éœ€è¦è¯»å–çš„è®°å½•æ¡æ•°ï¼Œ<code>å€¼è¶Šå°è¶Šå¥½</code>ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704131050496.png" alt="image-20220704131050496"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-10"><p>æŸä¸ªè¡¨ç»è¿‡æœç´¢æ¡ä»¶è¿‡æ»¤åå‰©ä½™è®°å½•æ¡æ•°çš„ç™¾åˆ†æ¯”</p><p>å¦‚æœä½¿ç”¨çš„æ˜¯ç´¢å¼•æ‰§è¡Œçš„å•è¡¨æ‰«æï¼Œé‚£ä¹ˆè®¡ç®—æ—¶éœ€è¦ä¼°è®¡å‡ºæ»¡è¶³é™¤ä½¿ç”¨åˆ°å¯¹åº”ç´¢å¼•çš„æœç´¢æ¡ä»¶å¤–çš„å…¶ä»–æœç´¢æ¡ä»¶çš„è®°å½•æœ‰å¤šå°‘æ¡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span> <span class="keyword">AND</span> common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704131323242.png" alt="image-20220704131323242"></p><p>å¯¹äºå•è¡¨æŸ¥è¯¢æ¥è¯´ï¼Œè¿™ä¸ªfilteredçš„å€¼æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œæˆ‘ä»¬<code>æ›´å…³æ³¨åœ¨è¿æ¥æŸ¥è¯¢ä¸­é©±åŠ¨è¡¨å¯¹åº”çš„æ‰§è¡Œè®¡åˆ’è®°å½•çš„filteredå€¼</code>ï¼Œå®ƒå†³å®šäº†è¢«é©±åŠ¨è¡¨è¦æ‰§è¡Œçš„æ¬¡æ•° (å³: rows * filtered)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1 <span class="keyword">WHERE</span> s1.common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704131644615.png" alt="image-20220704131644615"></p><p>ä»æ‰§è¡Œè®¡åˆ’ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨æ‰“ç®—æŠŠ<code>s1</code>ä½œä¸ºé©±åŠ¨è¡¨ï¼Œ<code>s2</code>å½“åšè¢«é©±åŠ¨è¡¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é©±åŠ¨è¡¨<code>s1</code>è¡¨çš„æ‰§è¡Œè®¡åˆ’çš„<code>rows</code>åˆ—ä¸º<code>9688</code>ï¼Œfilteredåˆ—ä¸º<code>10.00</code>ï¼Œè¿™æ„å‘³ç€é©±åŠ¨è¡¨<code>s1</code>çš„æ‰‡å‡ºå€¼å°±æ˜¯<code>9688 x 10.00% = 968.8</code>ï¼Œè¿™è¯´æ˜è¿˜è¦å¯¹è¢«é©±åŠ¨è¡¨æ‰§è¡Œå¤§çº¦<code>968</code>æ¬¡æŸ¥è¯¢ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="3d8c80d0-e512-487e-8c93-0506e90c7af1-11"><p>é¡¾åæ€ä¹‰ï¼Œ<code>Extra</code>åˆ—æ˜¯ç”¨æ¥è¯´æ˜ä¸€äº›é¢å¤–ä¿¡æ¯çš„ï¼ŒåŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›é¢å¤–ä¿¡æ¯æ¥<code>æ›´å‡†ç¡®çš„ç†è§£MySQLåˆ°åº•å°†å¦‚ä½•æ‰§è¡Œç»™å®šçš„æŸ¥è¯¢è¯­å¥</code>ã€‚MySQLæä¾›çš„é¢å¤–ä¿¡æ¯æœ‰å¥½å‡ åä¸ªï¼Œæˆ‘ä»¬å°±ä¸ä¸€ä¸ªä¸€ä¸ªä»‹ç»äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæŒ‘é€‰æ¯”è¾ƒé‡è¦çš„é¢å¤–ä¿¡æ¯ä»‹ç»ç»™å¤§å®¶ã€‚</p><p>*<code>No tables used</code></p><p>å½“æŸ¥è¯¢è¯­å¥æ²¡æœ‰<code>FROM</code>å­å¥æ—¶å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704132345383.png" alt="image-20220704132345383"></p><p>*<code>Impossible WHERE</code></p><p>å½“æŸ¥è¯¢è¯­å¥çš„<code>WHERE</code>å­å¥æ°¸è¿œä¸º<code>FALSE</code>æ—¶å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">!=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704132458978.png" alt="image-20220704132458978"></p><p>-<code>Using where</code></p><p>ä¸ç”¨è¯»å–è¡¨ä¸­æ‰€æœ‰ä¿¡æ¯ï¼Œä»…é€šè¿‡ç´¢å¼•å°±å¯ä»¥è·å–æ‰€éœ€æ•°æ®ï¼Œè¿™å‘ç”Ÿåœ¨å¯¹è¡¨çš„å…¨éƒ¨çš„è¯·æ±‚åˆ—éƒ½æ˜¯åŒä¸€ä¸ªç´¢å¼•çš„éƒ¨åˆ†çš„æ—¶å€™ï¼Œè¡¨ç¤ºmysqlæœåŠ¡å™¨å°†åœ¨å­˜å‚¨å¼•æ“æ£€ç´¢è¡Œåå†è¿›è¡Œè¿‡æ»¤ã€‚è¡¨æ˜ä½¿ç”¨äº†whereè¿‡æ»¤ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨å…¨è¡¨æ‰«ææ¥æ‰§è¡Œå¯¹æŸä¸ªè¡¨çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”è¯¥è¯­å¥çš„<code>WHERE</code>å­å¥ä¸­æœ‰é’ˆå¯¹è¯¥è¡¨çš„æœç´¢æ¡ä»¶æ—¶ï¼Œåœ¨<code>Extra</code>åˆ—ä¸­ä¼šæç¤ºä¸Šè¿°é¢å¤–ä¿¡æ¯ã€‚æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704132655342.png" alt="image-20220704132655342"></p><p>å½“ä½¿ç”¨ç´¢å¼•è®¿é—®æ¥æ‰§è¡Œå¯¹æŸä¸ªè¡¨çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”è¯¥è¯­å¥çš„<code>WHERE</code>å­å¥ä¸­æœ‰é™¤äº†è¯¥ç´¢å¼•åŒ…å«çš„åˆ—ä¹‹å¤–çš„å…¶ä»–æœç´¢æ¡ä»¶æ—¶ï¼Œåœ¨<code>Extra</code>åˆ—ä¸­ä¹Ÿä¼šæç¤ºä¸Šè¿°é¢å¤–ä¿¡æ¯ã€‚æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è™½ç„¶ä½¿ç”¨<code>idx_key1</code>ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ï¼Œä½†æ˜¯æœç´¢æ¡ä»¶ä¸­é™¤äº†åŒ…å«<code>key1</code>çš„æœç´¢æ¡ä»¶<code>key1='a'</code>ï¼Œè¿˜åŒ…å«<code>common_field</code>çš„æœç´¢æ¡ä»¶ï¼Œæ‰€ä»¥<code>Extra</code>åˆ—ä¼šæ˜¾ç¤º<code>Using where</code>çš„æç¤ºï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">AND</span> common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704133130515.png" alt="image-20220704133130515"></p><p>*<code>No matching min/max row</code></p><p>å½“æŸ¥è¯¢åˆ—è¡¨å¤„æœ‰<code>MIN</code>æˆ–è€…<code>MAX</code>èšåˆå‡½æ•°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç¬¦åˆ<code>WHERE</code>å­å¥ä¸­çš„æœç´¢æ¡ä»¶çš„è®°å½•æ—¶ã€‚</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(key1) <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;abcdefg&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704134324354.png" alt="image-20220704134324354"></p><p>*<code>Using index</code></p><p>å½“æˆ‘ä»¬çš„æŸ¥è¯¢åˆ—è¡¨ä»¥åŠæœç´¢æ¡ä»¶ä¸­åªåŒ…å«å±äºæŸä¸ªç´¢å¼•çš„åˆ—ï¼Œä¹Ÿå°±æ˜¯åœ¨å¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œåœ¨<code>Extra</code>åˆ—å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯ã€‚æ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ä¸­åªéœ€è¦ç”¨åˆ°<code>idx_key1</code>è€Œä¸éœ€è¦å›è¡¨æ“ä½œ:</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> key1,id <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704134931220.png" alt="image-20220704134931220"></p><p>*<code>Using index condition</code></p><p>æœ‰äº›æœç´¢æ¡ä»¶ä¸­è™½ç„¶å‡ºç°äº†ç´¢å¼•åˆ—ï¼Œä½†å´ä¸èƒ½ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span> <span class="keyword">AND</span> key1 <span class="keyword">LIKE</span> <span class="string">&#x27;%a&#x27;</span>;</span><br></pre></td></tr></table></figure>  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704140344015.png" alt="image-20220704140344015"  />  <img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704140411033.png" alt="image-20220704140411033"  /> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span> <span class="keyword">AND</span> key1 <span class="keyword">LIKE</span> <span class="string">&#x27;%b&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704140441702.png" alt="image-20220704140441702"></p><p>*<code>Using join buffer (Block Nested Loop)</code></p><p>åœ¨è¿æ¥æŸ¥è¯¢æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“è¢«é©±åŠ¨è¡¨ä¸èƒ½æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•åŠ å¿«è®¿é—®é€Ÿåº¦ï¼ŒMySQLä¸€èˆ¬ä¼šä¸ºå…¶åˆ†é…ä¸€å—åå«<code>join buffer</code>çš„å†…å­˜å—æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è®²çš„<code>åŸºäºå—çš„åµŒå¥—å¾ªç¯ç®—æ³•</code>ã€‚</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.common_field <span class="operator">=</span> s2.common_field;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704140815955.png" alt="image-20220704140815955"></p><p>*<code>Not exists</code></p><p>å½“æˆ‘ä»¬ä½¿ç”¨å·¦(å¤–)è¿æ¥æ—¶ï¼Œå¦‚æœ<code>WHERE</code>å­å¥ä¸­åŒ…å«è¦æ±‚è¢«é©±åŠ¨è¡¨çš„æŸä¸ªåˆ—ç­‰äº<code>NULL</code>å€¼çš„æœç´¢æ¡ä»¶ï¼Œè€Œä¸”é‚£ä¸ªåˆ—æ˜¯ä¸å…è®¸å­˜å‚¨<code>NULL</code>å€¼çš„ï¼Œé‚£ä¹ˆåœ¨è¯¥è¡¨çš„æ‰§è¡Œè®¡åˆ’çš„Extraåˆ—å°±ä¼šæç¤ºè¿™ä¸ªä¿¡æ¯ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1 <span class="keyword">WHERE</span> s2.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704142059555.png" alt="image-20220704142059555"></p><p>*<code>Using intersect(...) ã€ Using union(...) å’Œ Using sort_union(...)</code></p><p>å¦‚æœæ‰§è¡Œè®¡åˆ’çš„<code>Extra</code>åˆ—å‡ºç°äº†<code>Using intersect(...)</code>æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨<code>Intersect</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ‹¬å·ä¸­çš„<code>...</code>è¡¨ç¤ºéœ€è¦è¿›è¡Œç´¢å¼•åˆå¹¶çš„ç´¢å¼•åç§°ï¼›</p><p>å¦‚æœå‡ºç°<code>Using union(...)</code>æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨<code>Union</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢;</p><p>å¦‚æœå‡ºç°<code>Using sort_union(...)</code>æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨<code>Sort-Union</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ã€‚</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704142552890.png" alt="image-20220704142552890"></p><p>*<code>Zero limit</code></p><p>å½“æˆ‘ä»¬çš„<code>LIMIT</code>å­å¥çš„å‚æ•°ä¸º<code>0</code>æ—¶ï¼Œè¡¨ç¤ºå‹æ ¹å„¿ä¸æ‰“ç®—ä»è¡¨ä¸­è¯»å–ä»»ä½•è®°å½•ï¼Œå°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 LIMIT <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704142754394.png" alt="image-20220704142754394"></p><p>*<code>Using filesort</code></p><p>æœ‰ä¸€äº›æƒ…å†µä¸‹å¯¹ç»“æœé›†ä¸­çš„è®°å½•è¿›è¡Œæ’åºæ˜¯å¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•çš„ã€‚</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> key1 LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704142901857.png" alt="image-20220704142901857"></p><p>è¿™ä¸ªæŸ¥è¯¢è¯­å¥å¯ä»¥åˆ©ç”¨<code>idx_key1</code>ç´¢å¼•ç›´æ¥å–å‡º<code>key1</code>åˆ—çš„10æ¡è®°å½•ï¼Œç„¶åå†è¿›è¡Œå›è¡¨æ“ä½œå°±å¥½äº†ã€‚ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹æ’åºæ“ä½œæ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œåªèƒ½åœ¨å†…å­˜ä¸­ï¼ˆè®°å½•è¾ƒå°‘çš„æ—¶å€™ï¼‰æˆ–è€…ç£ç›˜ä¸­ï¼ˆè®°å½•è¾ƒå¤šçš„æ—¶å€™ï¼‰è¿›è¡Œæ’åºï¼ŒMysQLæŠŠè¿™ç§åœ¨å†…å­˜ä¸­æˆ–è€…ç£ç›˜ä¸Šè¿›è¡Œæ’åºçš„æ–¹å¼ç»Ÿç§°ä¸ºæ–‡ä»¶æ’åºï¼ˆè‹±æ–‡åï¼š<code>filesort</code>ï¼‰ã€‚å¦‚æœæŸä¸ªæŸ¥è¯¢éœ€è¦ä½¿ç”¨æ–‡ä»¶æ’åºçš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ï¼Œå°±ä¼šåœ¨æ‰§è¡Œè®¡åˆ’çš„<code>Extra</code>åˆ—ä¸­æ˜¾ç¤º<code>Using filesort</code>æç¤ºï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> common_field LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704143518857.png" alt="image-20220704143518857"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæŸ¥è¯¢ä¸­éœ€è¦ä½¿ç”¨<code>filesort</code>çš„æ–¹å¼è¿›è¡Œæ’åºçš„è®°å½•éå¸¸å¤šï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆè€—è´¹æ€§èƒ½çš„ï¼Œæˆ‘ä»¬æœ€å¥½æƒ³åŠæ³•<code>å°†ä½¿ç”¨æ–‡ä»¶æ’åºçš„æ‰§è¡Œæ–¹å¼æ”¹ä¸ºç´¢å¼•è¿›è¡Œæ’åº</code>ã€‚</p><p>*<code>Using temporary</code></p><p>åœ¨è®¸å¤šæŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒMySQLå¯èƒ½ä¼šå€ŸåŠ©ä¸´æ—¶è¡¨æ¥å®Œæˆä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚å»é‡ã€æ’åºä¹‹ç±»çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨æ‰§è¡Œè®¸å¤šåŒ…å«<code>DISTINCT</code>ã€<code>GROUP BY</code>ã€<code>UNION</code>ç­‰å­å¥çš„æŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸èƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•æ¥å®ŒæˆæŸ¥è¯¢ï¼Œ MySQLå¾ˆæœ‰å¯èƒ½å¯»æ±‚é€šè¿‡å»ºç«‹å†…éƒ¨çš„ä¸´æ—¶è¡¨æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°äº†å†…éƒ¨çš„ä¸´æ—¶è¡¨ï¼Œåœ¨æ‰§è¡Œè®¡åˆ’çš„<code>Extra</code>åˆ—å°†ä¼šæ˜¾ç¤º<code>Using temporary</code>æç¤ºï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> common_field <span class="keyword">FROM</span> s1;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704150030005.png" alt="image-20220704150030005"></p><p>å†æ¯”å¦‚ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> common_field, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> amount <span class="keyword">FROM</span> s1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> common_field;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704150156416.png" alt="image-20220704150156416"></p><p>æ‰§è¡Œè®¡åˆ’ä¸­å‡ºç°<code>Using temporary</code>å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å¾å…†ï¼Œå› ä¸ºå»ºç«‹ä¸ç»´æŠ¤ä¸´æ—¶è¡¨è¦ä»˜å‡ºå¾ˆå¤§çš„æˆæœ¬çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬<code>æœ€å¥½èƒ½ä½¿ç”¨ç´¢å¼•æ¥æ›¿ä»£æ‰ä½¿ç”¨ä¸´æ—¶è¡¨</code>ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªåŒ…å«<code>GROUP BY</code>å­å¥çš„æŸ¥è¯¢å°±ä¸éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨ï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> key1, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> amount <span class="keyword">FROM</span> s1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> key1;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704150308189.png" alt="image-20220704150308189"></p><p>ä»<code>Extra</code>çš„<code>Using index</code>çš„æç¤ºé‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸Šè¿°æŸ¥è¯¢åªéœ€è¦æ‰«æ<code>idx_key1</code>ç´¢å¼•å°±å¯ä»¥æ å®šäº†ï¼Œä¸å†éœ€è¦ä¸´æ—¶è¡¨äº†ã€‚</p><ul><li><p>å…¶ä»–</p><p>å…¶å®ƒç‰¹æ®Šæƒ…å†µè¿™é‡Œçœç•¥ã€‚</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>å°ç»“</p></blockquote><ul><li>EXPLAINä¸è€ƒè™‘å„ç§Cache</li><li>EXPLAINä¸èƒ½æ˜¾ç¤ºMySQLåœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰€ä½œçš„ä¼˜åŒ–å·¥ä½œ</li><li>EXPLAINä¸ä¼šå‘Šè¯‰ä½ å…³äºè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯æˆ–ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¯¹æŸ¥è¯¢çš„å½±å“æƒ…å†µ</li><li>éƒ¨åˆ†ç»Ÿè®¡ä¿¡æ¯æ˜¯ä¼°ç®—çš„ï¼Œå¹¶éç²¾ç¡®å€¼</li></ul><hr><h2 id="7-EXPLAINçš„è¿›ä¸€æ­¥ä½¿ç”¨">7. EXPLAINçš„è¿›ä¸€æ­¥ä½¿ç”¨</h2><h3 id="7-1-EXPLAINå››ç§è¾“å‡ºæ ¼å¼">7.1 EXPLAINå››ç§è¾“å‡ºæ ¼å¼</h3><p>è¿™é‡Œè°ˆè°ˆEXPLAINçš„è¾“å‡ºæ ¼å¼ã€‚EXPLAINå¯ä»¥è¾“å‡ºå››ç§æ ¼å¼ï¼š<code>ä¼ ç»Ÿæ ¼å¼</code>ï¼Œ<code>JSONæ ¼å¼</code>ï¼Œ<code>TREEæ ¼å¼</code>ä»¥åŠ<code>å¯è§†åŒ–è¾“å‡º</code>ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©é€‚ç”¨äºè‡ªå·±çš„æ ¼å¼ã€‚</p><div class="tabs" id="b05238d9-59e2-47e4-81c0-98086ae4e45a"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#b05238d9-59e2-47e4-81c0-98086ae4e45a-1"><i class="fas fa-award"></i>ä¼ ç»Ÿæ ¼å¼</button></li><li class="tab"><button type="button" data-href="#b05238d9-59e2-47e4-81c0-98086ae4e45a-2"><i class="fas fa-baseball-ball"></i>JSONæ ¼å¼</button></li><li class="tab"><button type="button" data-href="#b05238d9-59e2-47e4-81c0-98086ae4e45a-3"><i class="fas fa-bone"></i>TREEæ ¼å¼</button></li><li class="tab"><button type="button" data-href="#b05238d9-59e2-47e4-81c0-98086ae4e45a-4"><i class="fas fa-anchor"></i>å¯è§†åŒ–è¾“å‡º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="b05238d9-59e2-47e4-81c0-98086ae4e45a-1"><p>ä¼ ç»Ÿæ ¼å¼ç®€å•æ˜äº†ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªè¡¨æ ¼å½¢å¼ï¼Œæ¦‚è¦è¯´æ˜æŸ¥è¯¢è®¡åˆ’ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> s1.key1, s2.key1 <span class="keyword">FROM</span> s1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1 <span class="keyword">WHERE</span> s2.common_field <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704161702384.png" alt="image-20220704161702384"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="b05238d9-59e2-47e4-81c0-98086ae4e45a-2"><p>ç¬¬1ç§æ ¼å¼ä¸­ä»‹ç»çš„<code>EXPLAIN</code>è¯­å¥è¾“å‡ºä¸­ç¼ºå°‘äº†ä¸€ä¸ªè¡¡é‡æ‰§è¡Œå¥½åçš„é‡è¦å±æ€§ â€”â€”<code>æˆæœ¬</code>ã€‚è€ŒJSONæ ¼å¼æ˜¯å››ç§æ ¼å¼é‡Œé¢è¾“å‡º<code>ä¿¡æ¯æœ€è¯¦å°½</code>çš„æ ¼å¼ï¼Œé‡Œé¢åŒ…å«äº†æ‰§è¡Œçš„æˆæœ¬ä¿¡æ¯ã€‚</p><ul><li>JSONæ ¼å¼ï¼šåœ¨EXPLAINå•è¯å’ŒçœŸæ­£çš„æŸ¥è¯¢è¯­å¥ä¸­é—´åŠ ä¸Š FORMAT=JSON ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN FORMAT<span class="operator">=</span>JSON <span class="keyword">SELECT</span> ....</span><br></pre></td></tr></table></figure><ul><li>EXPLAINçš„Columnä¸JSONçš„å¯¹åº”å…³ç³»ï¼š(æ¥æºäºMySQL 5.7æ–‡æ¡£)</li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704164236909.png" alt="image-20220704164236909"></p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªjsonæ ¼å¼çš„æ‰§è¡Œè®¡åˆ’ï¼Œé‡Œé¢åŒ…å«è¯¥è®¡åˆ’èŠ±è´¹çš„æˆæœ¬ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN FORMAT<span class="operator">=</span>JSON <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key2 <span class="keyword">WHERE</span> s1.common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>\G</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704172833362.png" alt="image-20220704172833362"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704172920158.png" alt="image-20220704172920158"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704173012413.png" alt="image-20220704173012413"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704173045190.png" alt="image-20220704173045190"></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704173108888.png" alt="image-20220704173108888"></p><p>æˆ‘ä»¬ä½¿ç”¨ # åè¾¹è·Ÿéšæ³¨é‡Šçš„å½¢å¼ä¸ºå¤§å®¶è§£é‡Šäº†<code>EXPLAIN FORMAT=JSON</code>è¯­å¥çš„è¾“å‡ºå†…å®¹ï¼Œä½†æ˜¯å¤§å®¶å¯èƒ½ æœ‰ç–‘é—® â€œ<code>cost_info</code>â€ é‡Œè¾¹çš„æˆæœ¬çœ‹ç€æ€ªæ€ªçš„ï¼Œå®ƒä»¬æ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥çš„ï¼Ÿå…ˆçœ‹ s1 è¡¨çš„ â€œ<code>cost_info</code>â€ éƒ¨ åˆ†ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;cost_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;read_cost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1840.84&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eval_cost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;193.76&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prefix_cost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2034.60&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data_read_per_join&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1M&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>*<code>read_cost</code>æ˜¯ç”±ä¸‹è¾¹è¿™ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼š</p><ul><li>IO æˆæœ¬</li><li>æ£€æµ‹ rows Ã— (1 - filter) æ¡è®°å½•çš„ CPU æˆæœ¬</li></ul><blockquote><p>å°è´´å£«ï¼š rowså’Œfilteréƒ½æ˜¯æˆ‘ä»¬å‰è¾¹ä»‹ç»æ‰§è¡Œè®¡åˆ’çš„è¾“å‡ºåˆ—ï¼Œåœ¨JSONæ ¼å¼çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œrows ç›¸å½“äºrows_examined_per_scanï¼Œfilteredåç§°ä¸å˜ã€‚</p></blockquote><p>+<code>eval_cost</code>æ˜¯è¿™æ ·è®¡ç®—çš„ï¼š</p><p>æ£€æµ‹ rows Ã— filter æ¡è®°å½•çš„æˆæœ¬ã€‚</p><p>+<code>prefix_cost</code>å°±æ˜¯å•ç‹¬æŸ¥è¯¢ s1 è¡¨çš„æˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><p><code>read_cost + eval_cost</code></p><p>+<code>data_read_per_join</code>è¡¨ç¤ºåœ¨æ­¤æ¬¡æŸ¥è¯¢ä¸­éœ€è¦è¯»å–çš„æ•°æ®é‡ã€‚</p><p>å¯¹äº<code>s2</code>è¡¨çš„ â€œ<code>cost_info</code>â€ éƒ¨åˆ†æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;cost_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;read_cost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;968.80&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eval_cost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;193.76&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prefix_cost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3197.16&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data_read_per_join&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1M&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç”±äº<code>s2</code>è¡¨æ˜¯è¢«é©±åŠ¨è¡¨ï¼Œæ‰€ä»¥å¯èƒ½è¢«è¯»å–å¤šæ¬¡ï¼Œè¿™é‡Œçš„<code>read_cost</code>å’Œ<code>eval_cost</code>æ˜¯è®¿é—®å¤šæ¬¡<code>s2</code>è¡¨åç´¯åŠ èµ·æ¥çš„å€¼ï¼Œå¤§å®¶ä¸»è¦å…³æ³¨é‡Œè¾¹å„¿çš„<code>prefix_cost</code>çš„å€¼ä»£è¡¨çš„æ˜¯æ•´ä¸ªè¿æ¥æŸ¥è¯¢é¢„è®¡çš„æˆæœ¬ï¼Œä¹Ÿå°±æ˜¯å•æ¬¡æŸ¥è¯¢<code>s1</code>è¡¨å’Œå¤šæ¬¡æŸ¥è¯¢<code>s2</code>è¡¨åçš„æˆæœ¬çš„å’Œï¼Œä¹Ÿå°±æ˜¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">968</span>.<span class="number">80</span> + <span class="number">193</span>.<span class="number">76</span> + <span class="number">2034</span>.<span class="number">60</span> = <span class="number">3197</span>.<span class="number">16</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="b05238d9-59e2-47e4-81c0-98086ae4e45a-3"><p>TREEæ ¼å¼æ˜¯8.0.16ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„æ–°æ ¼å¼ï¼Œä¸»è¦æ ¹æ®æŸ¥è¯¢çš„<code>å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„å…³ç³»</code>å’Œ<code>å„éƒ¨åˆ†çš„æ‰§è¡Œé¡ºåº</code>æ¥æè¿°å¦‚ä½•æŸ¥è¯¢ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN FORMAT<span class="operator">=</span>tree <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key2 <span class="keyword">WHERE</span></span><br><span class="line">s1.common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">EXPLAIN: <span class="operator">-</span><span class="operator">&gt;</span> Nested loop <span class="keyword">inner</span> <span class="keyword">join</span> (cost<span class="operator">=</span><span class="number">1360.08</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">990</span>)</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">Filter</span>: ((s1.common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>) <span class="keyword">and</span> (s1.key1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>)) (cost<span class="operator">=</span><span class="number">1013.75</span></span><br><span class="line"><span class="keyword">rows</span><span class="operator">=</span><span class="number">990</span>)</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">Table</span> scan <span class="keyword">on</span> s1 (cost<span class="operator">=</span><span class="number">1013.75</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">9895</span>)</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> Single<span class="operator">-</span><span class="type">row</span> index lookup <span class="keyword">on</span> s2 <span class="keyword">using</span> idx_key2 (key2<span class="operator">=</span>s1.key1), <span class="keyword">with</span> index</span><br><span class="line"><span class="keyword">condition</span>: (<span class="built_in">cast</span>(s1.key1 <span class="keyword">as</span> <span class="keyword">double</span>) <span class="operator">=</span> <span class="built_in">cast</span>(s2.key2 <span class="keyword">as</span> <span class="keyword">double</span>)) (cost<span class="operator">=</span><span class="number">0.25</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">1</span>)</span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="b05238d9-59e2-47e4-81c0-98086ae4e45a-4"><p>å¯è§†åŒ–è¾“å‡ºï¼Œå¯ä»¥é€šè¿‡MySQL Workbenchå¯è§†åŒ–æŸ¥çœ‹MySQLçš„æ‰§è¡Œè®¡åˆ’ã€‚é€šè¿‡ç‚¹å‡»Workbenchçš„æ”¾å¤§é•œå›¾æ ‡ï¼Œå³å¯ç”Ÿæˆå¯è§†åŒ–çš„æŸ¥è¯¢è®¡åˆ’ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704174401970.png" alt="image-20220704174401970"></p><p>ä¸Šå›¾æŒ‰ä»å·¦åˆ°å³çš„è¿æ¥é¡ºåºæ˜¾ç¤ºè¡¨ã€‚çº¢è‰²æ¡†è¡¨ç¤º<code>å…¨è¡¨æ‰«æ</code>ï¼Œè€Œç»¿è‰²æ¡†è¡¨ç¤ºä½¿ç”¨<code>ç´¢å¼•æŸ¥æ‰¾</code>ã€‚å¯¹äºæ¯ä¸ªè¡¨ï¼Œ æ˜¾ç¤ºä½¿ç”¨çš„ç´¢å¼•ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªè¡¨æ ¼çš„æ¡†ä¸Šæ–¹æ˜¯æ¯ä¸ªè¡¨è®¿é—®æ‰€å‘ç°çš„è¡Œæ•°çš„ä¼°è®¡å€¼ä»¥åŠè®¿é—®è¯¥è¡¨çš„æˆæœ¬ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="7-2-SHOW-WARNINGSçš„ä½¿ç”¨">7.2 SHOW WARNINGSçš„ä½¿ç”¨</h3><p>åœ¨æˆ‘ä»¬ä½¿ç”¨<code>EXPLAIN</code>è¯­å¥æŸ¥çœ‹äº†æŸä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’åï¼Œç´§æ¥ç€è¿˜å¯ä»¥ä½¿ç”¨<code>SHOW WARNINGS</code>è¯­å¥æŸ¥çœ‹ä¸è¿™ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’æœ‰å…³çš„ä¸€äº›æ‰©å±•ä¿¡æ¯ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> s1.key1, s2.key1 <span class="keyword">FROM</span> s1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1 <span class="keyword">WHERE</span> s2.common_field <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220704174543663.png" alt="image-20220704174543663"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> WARNINGS\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">    Level: Note</span><br><span class="line">     Code: <span class="number">1003</span></span><br><span class="line">Message: <span class="comment">/* select#1 */</span> <span class="keyword">select</span>`atguigu`.`s1`.`key1`<span class="keyword">AS</span>`key1`,`atguigu`.`s2`.`key1`</span><br><span class="line"><span class="keyword">AS</span>`key1`<span class="keyword">from</span>`atguigu`.`s1`<span class="keyword">join</span>`atguigu`.`s2`<span class="keyword">where</span> ((`atguigu`.`s1`.`key1`<span class="operator">=</span></span><br><span class="line">`atguigu`.`s2`.`key1`) <span class="keyword">and</span> (`atguigu`.`s2`.`common_field`<span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>))</span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>å¤§å®¶å¯ä»¥çœ‹åˆ°<code>SHOW WARNINGS</code>å±•ç¤ºå‡ºæ¥çš„ä¿¡æ¯æœ‰ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯<code>Levelã€Codeã€Message</code>ã€‚æˆ‘ä»¬æœ€å¸¸è§çš„å°±æ˜¯Codeä¸º1003çš„ä¿¡æ¯ï¼Œå½“Codeå€¼ä¸º1003æ—¶ï¼Œ<code>Message</code>å­—æ®µå±•ç¤ºçš„ä¿¡æ¯ç±»ä¼¼äºæŸ¥è¯¢ä¼˜åŒ–å™¨å°†æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥é‡å†™åçš„è¯­å¥ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šè¾¹çš„æŸ¥è¯¢æœ¬æ¥æ˜¯ä¸€ä¸ªå·¦(å¤–)è¿æ¥æŸ¥è¯¢ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªs2.common_field IS NOT NULLçš„æ¡ä»¶ï¼Œè¿™å°±ä¼šå¯¼è‡´æŸ¥è¯¢ä¼˜åŒ–å™¨æŠŠå·¦(å¤–)è¿æ¥æŸ¥è¯¢ä¼˜åŒ–ä¸ºå†…è¿æ¥æŸ¥è¯¢ï¼Œä»<code>SHOW WARNINGS</code>çš„<code>Message</code>å­—æ®µä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼ŒåŸæœ¬çš„LEFE JOINå·²ç»å˜æˆäº†JOINã€‚</p><p>ä½†æ˜¯å¤§å®¶ä¸€å®šè¦æ³¨æ„ï¼Œæˆ‘ä»¬è¯´<code>Message</code>å­—æ®µå±•ç¤ºçš„ä¿¡æ¯ç±»ä¼¼äºæŸ¥è¯¢ä¼˜åŒ–å™¨å°†æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥<code>é‡å†™åçš„è¯­å¥</code>ï¼Œå¹¶ä¸æ˜¯ç­‰ä»·äºï¼Œä¹Ÿå°±æ˜¯è¯´<code>Message</code>å­—æ®µå±•ç¤ºçš„ä¿¡æ¯å¹¶ä¸æ˜¯æ ‡å‡†çš„æŸ¥è¯¢è¯­å¥ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹å¹¶ä¸èƒ½ç›´æ¥æ‹¿åˆ°é»‘æ¡†æ¡†ä¸­è¿è¡Œï¼Œå®ƒåªèƒ½ä½œä¸ºå¸®åŠ©æˆ‘ä»¬ç†è§£MySQLå°†å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„ä¸€ä¸ªå‚è€ƒä¾æ®è€Œå·²ã€‚</p><hr><h2 id="8-åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’-trace">8. åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’:trace</h2><p><code>OPTIMIZER_TRACE</code>æ˜¯MysQL5.6å¼•å…¥çš„ä¸€é¡¹è·Ÿè¸ªåŠŸèƒ½ï¼Œå®ƒå¯ä»¥è·Ÿè¸ªä¼˜åŒ–å™¨åšå‡ºçš„å„ç§å†³ç­–ï¼ˆæ¯”å¦‚è®¿é—®è¡¨çš„æ–¹æ³•ã€ å„ç§å¼€é”€è®¡ç®—ã€å„ç§è½¬æ¢ç­‰ï¼‰ï¼Œå¹¶å°†è·Ÿè¸ªç»“æœè®°å½•åˆ°<code>INFORMATION_ SCHEMA.OPTIMIZER_TRACE</code>è¡¨ä¸­ã€‚</p><p>æ­¤åŠŸèƒ½é»˜è®¤å…³é—­ã€‚å¼€å¯traceï¼Œå¹¶è®¾ç½®æ ¼å¼ä¸º JSONï¼ŒåŒæ—¶è®¾ç½®traceæœ€å¤§èƒ½å¤Ÿä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œé¿å…è§£æè¿‡ç¨‹ä¸­å› ä¸ºé»˜è®¤å…§å­˜è¿‡å°è€Œä¸èƒ½å¤Ÿå®Œæ•´å±•ç¤ºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> optimizer_trace<span class="operator">=</span>&quot;enabled=on&quot;,end_markers_in_json<span class="operator">=</span><span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">set</span> optimizer_trace_max_mem_size<span class="operator">=</span><span class="number">1000000</span>;</span><br></pre></td></tr></table></figure><p>å¼€å¯åï¼Œå¯åˆ†æå¦‚ä¸‹è¯­å¥ï¼š</p><ul><li>SELECT</li><li>INSERT</li><li>REPLACE</li><li>UPDATE</li><li>DELETE</li><li>EXPLAIN</li><li>SET</li><li>DECLARE</li><li>CASE</li><li>IF</li><li>RETURN</li><li>CALL</li></ul><p>æµ‹è¯•ï¼šæ‰§è¡Œå¦‚ä¸‹SQLè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&lt;</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œ æŸ¥è¯¢ information_schema.optimizer_trace å°±å¯ä»¥çŸ¥é“MySQLæ˜¯å¦‚ä½•æ‰§è¡ŒSQLçš„ ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.optimizer_trace\G</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">#ç¬¬<span class="number">1</span>éƒ¨åˆ†ï¼šæŸ¥è¯¢è¯­å¥</span><br><span class="line">QUERY: <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&lt;</span> <span class="number">10</span></span><br><span class="line">#ç¬¬<span class="number">2</span>éƒ¨åˆ†ï¼šQUERYå­—æ®µå¯¹åº”è¯­å¥çš„è·Ÿè¸ªä¿¡æ¯</span><br><span class="line">TRACE: &#123;</span><br><span class="line">&quot;steps&quot;: [</span><br><span class="line">&#123;</span><br><span class="line">    &quot;join_preparation&quot;: &#123; #é¢„å¤‡å·¥ä½œ</span><br><span class="line">        &quot;select#&quot;: <span class="number">1</span>,</span><br><span class="line">        &quot;steps&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">            &quot;expanded_query&quot;: &quot;/* select#1 */ select`student`.`id`AS</span><br><span class="line">          `id`,`student`.`stuno`AS`stuno`,`student`.`name`AS`name`,`student`.`age`AS</span><br><span class="line">          `age`,`student`.`classId`AS`classId`from`student`where (`student`.`id`&lt; 10)&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ] <span class="comment">/* steps */</span></span><br><span class="line">    &#125; <span class="comment">/* join_preparation */</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    &quot;join_optimization&quot;: &#123; #è¿›è¡Œä¼˜åŒ–</span><br><span class="line">    &quot;select#&quot;: <span class="number">1</span>,</span><br><span class="line">    &quot;steps&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">        &quot;condition_processing&quot;: &#123; #æ¡ä»¶å¤„ç†</span><br><span class="line">        &quot;condition&quot;: &quot;WHERE&quot;,</span><br><span class="line">        &quot;original_condition&quot;: &quot;(`student`.`id`&lt; 10)&quot;,</span><br><span class="line">        &quot;steps&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;transformation&quot;: &quot;equality_propagation&quot;,</span><br><span class="line">            &quot;resulting_condition&quot;: &quot;(`student`.`id`&lt; 10)&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;transformation&quot;: &quot;constant_propagation&quot;,</span><br><span class="line">            &quot;resulting_condition&quot;: &quot;(`student`.`id`&lt; 10)&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;transformation&quot;: &quot;trivial_condition_removal&quot;,</span><br><span class="line">            &quot;resulting_condition&quot;: &quot;(`student`.`id`&lt; 10)&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        ] <span class="comment">/* steps */</span></span><br><span class="line">    &#125; <span class="comment">/* condition_processing */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;substitute_generated_columns&quot;: &#123; #æ›¿æ¢ç”Ÿæˆçš„åˆ—</span><br><span class="line">        &#125; <span class="comment">/* substitute_generated_columns */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;table_dependencies&quot;: [ #è¡¨çš„ä¾èµ–å…³ç³»</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;table&quot;: &quot;`student`&quot;,</span><br><span class="line">            &quot;row_may_be_null&quot;: <span class="literal">false</span>,</span><br><span class="line">            &quot;map_bit&quot;: <span class="number">0</span>,</span><br><span class="line">            &quot;depends_on_map_bits&quot;: [</span><br><span class="line">            ] <span class="comment">/* depends_on_map_bits */</span></span><br><span class="line">        &#125;</span><br><span class="line">    ] <span class="comment">/* table_dependencies */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    &quot;ref_optimizer_key_uses&quot;: [ #ä½¿ç”¨é”®</span><br><span class="line">        ] <span class="comment">/* ref_optimizer_key_uses */</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;rows_estimation&quot;: [ #è¡Œåˆ¤æ–­</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;table&quot;: &quot;`student`&quot;,</span><br><span class="line">            &quot;range_analysis&quot;: &#123;</span><br><span class="line">                &quot;table_scan&quot;: &#123;</span><br><span class="line">                    &quot;rows&quot;: <span class="number">3973767</span>,</span><br><span class="line">                    &quot;cost&quot;: <span class="number">408558</span></span><br><span class="line">            &#125; <span class="comment">/* table_scan */</span>, #æ‰«æè¡¨</span><br><span class="line">            &quot;potential_range_indexes&quot;: [ #æ½œåœ¨çš„èŒƒå›´ç´¢å¼•</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;index&quot;: &quot;PRIMARY&quot;,</span><br><span class="line">                    &quot;usable&quot;: <span class="literal">true</span>,</span><br><span class="line">                    &quot;key_parts&quot;: [</span><br><span class="line">                    &quot;id&quot;</span><br><span class="line">                    ] <span class="comment">/* key_parts */</span></span><br><span class="line">                &#125;</span><br><span class="line">            ] <span class="comment">/* potential_range_indexes */</span>,</span><br><span class="line">        &quot;setup_range_conditions&quot;: [ #è®¾ç½®èŒƒå›´æ¡ä»¶</span><br><span class="line">        ] <span class="comment">/* setup_range_conditions */</span>,</span><br><span class="line">        &quot;group_index_range&quot;: &#123;</span><br><span class="line">            &quot;chosen&quot;: <span class="literal">false</span>,</span><br><span class="line">            &quot;cause&quot;: &quot;not_group_by_or_distinct&quot;</span><br><span class="line">        &#125; <span class="comment">/* group_index_range */</span>,</span><br><span class="line">            &quot;skip_scan_range&quot;: &#123;</span><br><span class="line">                &quot;potential_skip_scan_indexes&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;index&quot;: &quot;PRIMARY&quot;,</span><br><span class="line">                        &quot;usable&quot;: <span class="literal">false</span>,</span><br><span class="line">                        &quot;cause&quot;: &quot;query_references_nonkey_column&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ] <span class="comment">/* potential_skip_scan_indexes */</span></span><br><span class="line">            &#125; <span class="comment">/* skip_scan_range */</span>,</span><br><span class="line">        &quot;analyzing_range_alternatives&quot;: &#123; #åˆ†æèŒƒå›´é€‰é¡¹</span><br><span class="line">            &quot;range_scan_alternatives&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                &quot;index&quot;: &quot;PRIMARY&quot;,</span><br><span class="line">                    &quot;ranges&quot;: [</span><br><span class="line">                        &quot;id &lt; 10&quot;</span><br><span class="line">                    ] <span class="comment">/* ranges */</span>,</span><br><span class="line">                &quot;index_dives_for_eq_ranges&quot;: <span class="literal">true</span>,</span><br><span class="line">                &quot;rowid_ordered&quot;: <span class="literal">true</span>,</span><br><span class="line">                &quot;using_mrr&quot;: <span class="literal">false</span>,</span><br><span class="line">                &quot;index_only&quot;: <span class="literal">false</span>,</span><br><span class="line">                &quot;rows&quot;: <span class="number">9</span>,</span><br><span class="line">                &quot;cost&quot;: <span class="number">1.91986</span>,</span><br><span class="line">                &quot;chosen&quot;: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ] <span class="comment">/* range_scan_alternatives */</span>,</span><br><span class="line">        &quot;analyzing_roworder_intersect&quot;: &#123;</span><br><span class="line">            &quot;usable&quot;: <span class="literal">false</span>,</span><br><span class="line">            &quot;cause&quot;: &quot;too_few_roworder_scans&quot;</span><br><span class="line">        &#125; <span class="comment">/* analyzing_roworder_intersect */</span></span><br><span class="line">        &#125; <span class="comment">/* analyzing_range_alternatives */</span>,</span><br><span class="line">        &quot;chosen_range_access_summary&quot;: &#123; #é€‰æ‹©èŒƒå›´è®¿é—®æ‘˜è¦</span><br><span class="line">            &quot;range_access_plan&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;range_scan&quot;,</span><br><span class="line">                &quot;index&quot;: &quot;PRIMARY&quot;,</span><br><span class="line">                &quot;rows&quot;: <span class="number">9</span>,</span><br><span class="line">                &quot;ranges&quot;: [</span><br><span class="line">                &quot;id &lt; 10&quot;</span><br><span class="line">                ] <span class="comment">/* ranges */</span></span><br><span class="line">                &#125; <span class="comment">/* range_access_plan */</span>,</span><br><span class="line">                &quot;rows_for_plan&quot;: <span class="number">9</span>,</span><br><span class="line">                &quot;cost_for_plan&quot;: <span class="number">1.91986</span>,</span><br><span class="line">                &quot;chosen&quot;: <span class="literal">true</span></span><br><span class="line">                &#125; <span class="comment">/* chosen_range_access_summary */</span></span><br><span class="line">                &#125; <span class="comment">/* range_analysis */</span></span><br><span class="line">            &#125;</span><br><span class="line">        ] <span class="comment">/* rows_estimation */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    &quot;considered_execution_plans&quot;: [ #è€ƒè™‘æ‰§è¡Œè®¡åˆ’</span><br><span class="line">    &#123;</span><br><span class="line">    &quot;plan_prefix&quot;: [</span><br><span class="line">    ] <span class="comment">/* plan_prefix */</span>,</span><br><span class="line">        &quot;table&quot;: &quot;`student`&quot;,</span><br><span class="line">        &quot;best_access_path&quot;: &#123; #æœ€ä½³è®¿é—®è·¯å¾„</span><br><span class="line">        &quot;considered_access_paths&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;rows_to_scan&quot;: <span class="number">9</span>,</span><br><span class="line">            &quot;access_type&quot;: &quot;range&quot;,</span><br><span class="line">            &quot;range_details&quot;: &#123;</span><br><span class="line">            &quot;used_index&quot;: &quot;PRIMARY&quot;</span><br><span class="line">        &#125; <span class="comment">/* range_details */</span>,</span><br><span class="line">        &quot;resulting_rows&quot;: <span class="number">9</span>,</span><br><span class="line">        &quot;cost&quot;: <span class="number">2.81986</span>,</span><br><span class="line">        &quot;chosen&quot;: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ] <span class="comment">/* considered_access_paths */</span></span><br><span class="line">    &#125; <span class="comment">/* best_access_path */</span>,</span><br><span class="line">        &quot;condition_filtering_pct&quot;: <span class="number">100</span>, #è¡Œè¿‡æ»¤ç™¾åˆ†æ¯”</span><br><span class="line">        &quot;rows_for_plan&quot;: <span class="number">9</span>,</span><br><span class="line">        &quot;cost_for_plan&quot;: <span class="number">2.81986</span>,</span><br><span class="line">        &quot;chosen&quot;: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ] <span class="comment">/* considered_execution_plans */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;attaching_conditions_to_tables&quot;: &#123; #å°†æ¡ä»¶é™„åŠ åˆ°è¡¨ä¸Š</span><br><span class="line">        &quot;original_condition&quot;: &quot;(`student`.`id`&lt; 10)&quot;,</span><br><span class="line">        &quot;attached_conditions_computation&quot;: [</span><br><span class="line">        ] <span class="comment">/* attached_conditions_computation */</span>,</span><br><span class="line">        &quot;attached_conditions_summary&quot;: [ #é™„åŠ æ¡ä»¶æ¦‚è¦</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;table&quot;: &quot;`student`&quot;,</span><br><span class="line">        &quot;attached&quot;: &quot;(`student`.`id`&lt; 10)&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    ] <span class="comment">/* attached_conditions_summary */</span></span><br><span class="line">    &#125; <span class="comment">/* attaching_conditions_to_tables */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    &quot;finalizing_table_conditions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;table&quot;: &quot;`student`&quot;,</span><br><span class="line">        &quot;original_table_condition&quot;: &quot;(`student`.`id`&lt; 10)&quot;,</span><br><span class="line">        &quot;final_table_condition &quot;: &quot;(`student`.`id`&lt; 10)&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    ] <span class="comment">/* finalizing_table_conditions */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    &quot;refine_plan&quot;: [ #ç²¾ç®€è®¡åˆ’</span><br><span class="line">    &#123;</span><br><span class="line">    &quot;table&quot;: &quot;`student`&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    ] <span class="comment">/* refine_plan */</span></span><br><span class="line">    &#125;</span><br><span class="line">    ] <span class="comment">/* steps */</span></span><br><span class="line">    &#125; <span class="comment">/* join_optimization */</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">        &quot;join_execution&quot;: &#123; #æ‰§è¡Œ</span><br><span class="line">            &quot;select#&quot;: <span class="number">1</span>,</span><br><span class="line">            &quot;steps&quot;: [</span><br><span class="line">            ] <span class="comment">/* steps */</span></span><br><span class="line">        &#125; <span class="comment">/* join_execution */</span></span><br><span class="line">        &#125;</span><br><span class="line">    ] <span class="comment">/* steps */</span></span><br><span class="line">&#125;</span><br><span class="line">#ç¬¬<span class="number">3</span>éƒ¨åˆ†ï¼šè·Ÿè¸ªä¿¡æ¯è¿‡é•¿æ—¶ï¼Œè¢«æˆªæ–­çš„è·Ÿè¸ªä¿¡æ¯çš„å­—èŠ‚æ•°ã€‚</span><br><span class="line">MISSING_BYTES_BEYOND_MAX_MEM_SIZE: <span class="number">0</span> #ä¸¢å¤±çš„è¶…å‡ºæœ€å¤§å®¹é‡çš„å­—èŠ‚</span><br><span class="line">#ç¬¬<span class="number">4</span>éƒ¨åˆ†ï¼šæ‰§è¡Œè·Ÿè¸ªè¯­å¥çš„ç”¨æˆ·æ˜¯å¦æœ‰æŸ¥çœ‹å¯¹è±¡çš„æƒé™ã€‚å½“ä¸å…·æœ‰æƒé™æ—¶ï¼Œè¯¥åˆ—ä¿¡æ¯ä¸º<span class="number">1</span>ä¸”TRACEå­—æ®µä¸ºç©ºï¼Œä¸€èˆ¬åœ¨</span><br><span class="line">#è°ƒç”¨å¸¦æœ‰<span class="keyword">SQL</span> SECURITY DEFINERçš„è§†å›¾æˆ–è€…æ˜¯å­˜å‚¨è¿‡ç¨‹çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ­¤é—®é¢˜ã€‚</span><br><span class="line">INSUFFICIENT_PRIVILEGES: <span class="number">0</span> #ç¼ºå¤±æƒé™</span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><hr><h2 id="9-ç›‘æ§åˆ†æè§†å›¾-sys-schema">9. ç›‘æ§åˆ†æè§†å›¾:sys schema</h2><p>å…³äºMySQLçš„æ€§èƒ½ç›‘æ§å’Œé—®é¢˜è¯Šæ–­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä»performance_schemaä¸­å»è·å–æƒ³è¦çš„æ•°æ®ï¼Œåœ¨MySQL5.7.7ç‰ˆæœ¬ä¸­æ–°å¢sys schemaï¼Œå®ƒå°†performance_schemaå’Œlinformation_schemaä¸­çš„æ•°æ®ä»¥æ›´å®¹æ˜“ç†è§£çš„æ–¹å¼æ€»ç»“å½’çº³ä¸ºâ€è§†å›¾&quot;ï¼Œå…¶ç›®çš„å°±æ˜¯ä¸ºäº†<code>é™ä½æŸ¥è¯¢performance_schemaçš„å¤æ‚åº¦</code>ï¼Œè®©DBAèƒ½å¤Ÿå¿«é€Ÿçš„å®šä½é—®é¢˜ã€‚ä¸‹é¢çœ‹çœ‹è¿™äº›åº“ä¸­éƒ½æœ‰å“ªäº›ç›‘æ§è¡¨å’Œè§†å›¾ï¼ŒæŒæ¡äº†è¿™äº›ï¼Œåœ¨æˆ‘ä»¬å¼€å‘å’Œè¿ç»´çš„è¿‡ç¨‹ä¸­å°±èµ·åˆ°äº†äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</p><h3 id="9-1-Sys-schemaè§†å›¾æ‘˜è¦">9.1 Sys schemaè§†å›¾æ‘˜è¦</h3><ol><li><strong>ä¸»æœºç›¸å…³</strong>ï¼šä»¥host_summaryå¼€å¤´ï¼Œä¸»è¦æ±‡æ€»äº†IOå»¶è¿Ÿçš„ä¿¡æ¯ã€‚</li><li><strong>Innodbç›¸å…³</strong>ï¼šä»¥innodbå¼€å¤´ï¼Œæ±‡æ€»äº†innodb bufferä¿¡æ¯å’Œäº‹åŠ¡ç­‰å¾…innodbé”çš„ä¿¡æ¯ã€‚</li><li><strong>I/Oç›¸å…³</strong>ï¼šä»¥ioå¼€å¤´ï¼Œæ±‡æ€»äº†ç­‰å¾…I/Oã€I/Oä½¿ç”¨é‡æƒ…å†µã€‚</li><li><strong>å†…å­˜ä½¿ç”¨æƒ…å†µ</strong>ï¼šä»¥memoryå¼€å¤´ï¼Œä»ä¸»æœºã€çº¿ç¨‹ã€äº‹ä»¶ç­‰è§’åº¦å±•ç¤ºå†…å­˜çš„ä½¿ç”¨æƒ…å†µ</li><li><strong>è¿æ¥ä¸ä¼šè¯ä¿¡æ¯</strong>ï¼šprocesslistå’Œsessionç›¸å…³è§†å›¾ï¼Œæ€»ç»“äº†ä¼šè¯ç›¸å…³ä¿¡æ¯ã€‚</li><li><strong>è¡¨ç›¸å…³</strong>ï¼šä»¥schema_tableå¼€å¤´çš„è§†å›¾ï¼Œå±•ç¤ºäº†è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li><li><strong>ç´¢å¼•ä¿¡æ¯</strong>ï¼šç»Ÿè®¡äº†ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…å«å†—ä½™ç´¢å¼•å’Œæœªä½¿ç”¨çš„ç´¢å¼•æƒ…å†µã€‚</li><li><strong>è¯­å¥ç›¸å…³</strong>ï¼šä»¥statementå¼€å¤´ï¼ŒåŒ…å«æ‰§è¡Œå…¨è¡¨æ‰«æã€ä½¿ç”¨ä¸´æ—¶è¡¨ã€æ’åºç­‰çš„è¯­å¥ä¿¡æ¯ã€‚</li><li><strong>ç”¨æˆ·ç›¸å…³</strong>ï¼šä»¥userå¼€å¤´çš„è§†å›¾ï¼Œç»Ÿè®¡äº†ç”¨æˆ·ä½¿ç”¨çš„æ–‡ä»¶I/Oã€æ‰§è¡Œè¯­å¥ç»Ÿè®¡ä¿¡æ¯ã€‚</li><li><strong>ç­‰å¾…äº‹ä»¶ç›¸å…³ä¿¡æ¯</strong>ï¼šä»¥waitå¼€å¤´ï¼Œå±•ç¤ºç­‰å¾…äº‹ä»¶çš„å»¶è¿Ÿæƒ…å†µã€‚</li></ol><h3 id="9-2-Sys-schemaè§†å›¾ä½¿ç”¨åœºæ™¯">9.2 Sys schemaè§†å›¾ä½¿ç”¨åœºæ™¯</h3><p>ç´¢å¼•æƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> æŸ¥è¯¢å†—ä½™ç´¢å¼•</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.schema_redundant_indexes;</span><br><span class="line">#<span class="number">2.</span> æŸ¥è¯¢æœªä½¿ç”¨è¿‡çš„ç´¢å¼•</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.schema_unused_indexes;</span><br><span class="line">#<span class="number">3.</span> æŸ¥è¯¢ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ</span><br><span class="line"><span class="keyword">select</span> index_name,rows_selected,rows_inserted,rows_updated,rows_deleted</span><br><span class="line"><span class="keyword">from</span> sys.schema_index_statistics <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;dbname&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¡¨ç›¸å…³</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span> æŸ¥è¯¢è¡¨çš„è®¿é—®é‡</span><br><span class="line"><span class="keyword">select</span> table_schema,table_name,<span class="built_in">sum</span>(io_read_requests<span class="operator">+</span>io_write_requests) <span class="keyword">as</span> io <span class="keyword">from</span></span><br><span class="line">sys.schema_table_statistics <span class="keyword">group</span> <span class="keyword">by</span> table_schema,table_name <span class="keyword">order</span> <span class="keyword">by</span> io <span class="keyword">desc</span>;</span><br><span class="line"># <span class="number">2.</span> æŸ¥è¯¢å ç”¨bufferpoolè¾ƒå¤šçš„è¡¨</span><br><span class="line"><span class="keyword">select</span> object_schema,object_name,allocated,data</span><br><span class="line"><span class="keyword">from</span> sys.innodb_buffer_stats_by_table <span class="keyword">order</span> <span class="keyword">by</span> allocated limit <span class="number">10</span>;</span><br><span class="line"># <span class="number">3.</span> æŸ¥çœ‹è¡¨çš„å…¨è¡¨æ‰«ææƒ…å†µ</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.statements_with_full_table_scans <span class="keyword">where</span> db<span class="operator">=</span><span class="string">&#x27;dbname&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¯­å¥ç›¸å…³</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> ç›‘æ§<span class="keyword">SQL</span>æ‰§è¡Œçš„é¢‘ç‡</span><br><span class="line"><span class="keyword">select</span> db,exec_count,query <span class="keyword">from</span> sys.statement_analysis</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> exec_count <span class="keyword">desc</span>;</span><br><span class="line">#<span class="number">2.</span> ç›‘æ§ä½¿ç”¨äº†æ’åºçš„<span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">select</span> db,exec_count,first_seen,last_seen,query</span><br><span class="line"><span class="keyword">from</span> sys.statements_with_sorting limit <span class="number">1</span>;</span><br><span class="line">#<span class="number">3.</span> ç›‘æ§ä½¿ç”¨äº†ä¸´æ—¶è¡¨æˆ–è€…ç£ç›˜ä¸´æ—¶è¡¨çš„<span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">select</span> db,exec_count,tmp_tables,tmp_disk_tables,query</span><br><span class="line"><span class="keyword">from</span> sys.statement_analysis <span class="keyword">where</span> tmp_tables<span class="operator">&gt;</span><span class="number">0</span> <span class="keyword">or</span> tmp_disk_tables <span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> (tmp_tables<span class="operator">+</span>tmp_disk_tables) <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p>IOç›¸å…³</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> æŸ¥çœ‹æ¶ˆè€—ç£ç›˜IOçš„æ–‡ä»¶</span><br><span class="line"><span class="keyword">select</span> file,avg_read,avg_write,avg_read<span class="operator">+</span>avg_write <span class="keyword">as</span> avg_io</span><br><span class="line"><span class="keyword">from</span> sys.io_global_by_file_by_bytes <span class="keyword">order</span> <span class="keyword">by</span> avg_read limit <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>Innodb ç›¸å…³</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> è¡Œé”é˜»å¡æƒ…å†µ</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.innodb_lock_waits;</span><br></pre></td></tr></table></figure><p>é£é™©æç¤ºï¼š</p><p>é€šè¿‡sysåº“å»æŸ¥è¯¢æ—¶ï¼ŒMySQLä¼š<code>æ¶ˆè€—å¤§é‡èµ„æº</code>å»æ”¶é›†ç›¸å…³ä¿¡æ¯ï¼Œä¸¥é‡çš„å¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡è¯·æ±‚è¢«é˜»å¡ï¼Œä»è€Œå¼•èµ·æ•…éšœã€‚å»ºè®®ç”Ÿäº§ä¸Š<code>ä¸è¦é¢‘ç¹</code>çš„å»æŸ¥è¯¢sysæˆ–è€…performance_schemaã€ information_schemaæ¥å®Œæˆç›‘æ§ã€å·¡æ£€ç­‰å·¥ä½œã€‚</p>]]></content>
    
    
    <summary type="html">æ…¢æŸ¥è¯¢æ—¥å¿—ã€SHOW PROFILEã€EXPLAINã€trace</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</title>
    <link href="https://wuwawawa.github.io/posts/d227e38d.html"/>
    <id>https://wuwawawa.github.io/posts/d227e38d.html</id>
    <published>2023-04-10T00:00:00.000Z</published>
    <updated>2023-04-18T06:20:49.224Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ç´¢å¼•çš„åˆ†ç±»">1. ç´¢å¼•çš„åˆ†ç±»</h2><p>MySQLçš„ç´¢å¼•åŒ…æ‹¬æ™®é€šç´¢å¼•ã€å”¯ä¸€æ€§ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€å•åˆ—ç´¢å¼•ã€å¤šåˆ—ç´¢å¼•å’Œç©ºé—´ç´¢å¼•ç­‰ã€‚</p><p>ä» åŠŸèƒ½é€»è¾‘ ä¸Šè¯´ï¼Œç´¢å¼•ä¸»è¦æœ‰ 4 ç§ï¼Œåˆ†åˆ«æ˜¯æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€ä¸»é”®ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€‚</p><p>æŒ‰ç…§ ç‰©ç†å®ç°æ–¹å¼ ï¼Œç´¢å¼•å¯ä»¥åˆ†ä¸º 2 ç§ï¼šèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€‚</p><p>æŒ‰ç…§ ä½œç”¨å­—æ®µä¸ªæ•° è¿›è¡Œåˆ’åˆ†ï¼Œåˆ†æˆå•åˆ—ç´¢å¼•å’Œè”åˆç´¢å¼•ã€‚</p><div class="tabs" id="36c85279-7f3e-4bc9-a05b-a310a56c263d"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#36c85279-7f3e-4bc9-a05b-a310a56c263d-1"><i class="fas fa-atom"></i>æ™®é€šç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc9-a05b-a310a56c263d-2"><i class="far fa-sun"></i>å”¯ä¸€æ€§ç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc9-a05b-a310a56c263d-3"><i class="fas fa-wind"></i>ä¸»é”®ç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc9-a05b-a310a56c263d-4"><i class="fas fa-fire-alt"></i>å•åˆ—ç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc9-a05b-a310a56c263d-5"><i class="fas fa-award"></i>è”åˆç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc9-a05b-a310a56c263d-6"><i class="fas fa-baseball-ball"></i>å…¨æ–‡ç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc9-a05b-a310a56c263d-7"><i class="fas fa-bone"></i>ç©ºé—´ç´¢å¼•</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="36c85279-7f3e-4bc9-a05b-a310a56c263d-1"><p>åœ¨åˆ›å»ºæ™®é€šç´ å¼•æ—¶ï¼Œä¸é™„åŠ ä»»ä½•é™åˆ¶æ¡ä»¶ï¼Œåªæ˜¯ç”¨äºæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œè¿™ç±»ç´¢å¼•å¯ä»¥åˆ›å»ºåœ¨<code>ä»»ä½•æ•°æ®ç±»å‹</code>ä¸­ï¼Œå…¶å€¼æ˜¯å¦å”¯ä¸€å’Œéç©ºï¼Œè¦ç”±å­—æ®µæœ¬èº«çš„å®Œæ•´æ€§çº¦æŸæ¡ä»¶å†³å®šã€‚å»ºç«‹ç´¢äº‹ä»¥åï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œåœ¨è¡¨ student çš„å­—æ®µname ä¸Šå»ºç«‹ä¸€ä¸ªæ™®é€šç´¢å¼•ï¼ŒæŸ¥è¯¢è®°å½•æ—¶å°±å¯ä»¥æ ¹æ®è¯¥ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc9-a05b-a310a56c263d-2"><p>ä½¿ç”¨ UNIQUEå‚æ•°å¯ä»¥è®¾ç½®ç´¢å¼•ä¸º<code>å”¯ä¸€æ€§ç´¢å¼•</code>ï¼Œåœ¨åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•æ—¶ï¼Œé™åˆ¶è¯¥ç´¢å¼•çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚åœ¨ä¸€å¼ æ•°æ®è¡¨é‡Œ<code>å¯ä»¥æœ‰å¤šä¸ª</code>å”¯ä¸€ç´¢å¼•ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨è¡¨ student çš„å­—æ®µ email ä¸­åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œé‚£ä¹ˆå­—æ®µemailçš„å€¼å°±å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚é€šè¿‡å”¯ä¸€æ€§ç´¢å¼•ï¼Œ å¯ä»¥æ›´å¿«é€Ÿåœ°ç¡®å®šæŸæ¡è®°å½•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc9-a05b-a310a56c263d-3"><p>ä¸»é”®ç´¢å¼•å°±æ˜¯ä¸€ç§<code>ç‰¹æ®Šçš„å”¯ä¸€æ€§ç´¢å¼•</code>ï¼Œåœ¨å”¯ä¸€ç´¢å¼•çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸ä¸ºç©ºçš„çº¦æŸï¼Œä¹Ÿå°±æ˜¯<code>NOT NULL+UNIQUE</code>, ä¸€å¼ è¡¨é‡Œ<code>æœ€å¤šåªæœ‰ä¸€ä¸ª</code>ä¸»é”®ç´¢å¼•ã€‚</p><p>Why?è¿™æ˜¯ç”±ä¸»é”®ç´¢å¼•çš„ç‰©ç†å®ç°æ–¹å¼å†³å®šçš„ï¼Œå› ä¸ºæ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ä¸­åªèƒ½æŒ‰ç…§ä¸€ç§é¡ºåºè¿›è¡Œå­˜å‚¨ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc9-a05b-a310a56c263d-4"><p>åœ¨è¡¨ä¸­çš„å•ä¸ªå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ã€‚å•åˆ—ç´¢å¼•åªæ ¹æ®è¯¥å­—æ®µè¿›è¡Œç´¢å¼•ã€‚å•åˆ—ç´¢å¼•å¯ä»¥æ˜¯æ™®é€šç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯å”¯ä¸€æ€§ç´¢å¼•ï¼Œè¿˜å¯ä»¥æ˜¯å…¨æ–‡ç´¢å¼•ã€‚åªè¦ä¿è¯è¯¥ç´¢å¼•åªå¯¹åº”ä¸€ä¸ªå­—æ®µå³å¯ã€‚ä¸€ä¸ªè¡¨<code>å¯ä»¥æœ‰å¤šä¸ª</code>å•åˆ—ç´¢å¼•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc9-a05b-a310a56c263d-5"><p>å¤šåˆ—ç´¢å¼•æ˜¯åœ¨è¡¨çš„<code>å¤šä¸ªå­—æ®µç»„åˆä¸Š</code>åˆ›å»ºä¸€ä¸ªç´¢å¼•ã€‚è¯¥ç´¢å¼•æŒ‡å‘åˆ›å»ºæ—¶å¯¹åº”çš„å¤šä¸ªå­—æ®µï¼Œå¯ä»¥é€šè¿‡è¿™å‡ ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œä½†æ˜¯åªæœ‰æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨äº†è¿™äº›å­—æ®µä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µæ—¶æ‰ä¼šè¢«ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨è¡¨ä¸­çš„å­—æ®µidã€ nameå’Œ genderä¸Šå»ºç«‹ä¸€ä¸ªå¤šåˆ—ç´¢å¼•<code>idx_id_name_gender</code>ï¼Œåªæœ‰åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨äº†å­—æ®µidæ—¶è¯¥ç´¢å¼•|æ‰ä¼šè¢«ä½¿ç”¨ã€‚ä½¿ç”¨ç»„åˆç´¢å¼•æ—¶éµå¾ª<code>æœ€å·¦å‰ç¼€é›†åˆ</code>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc9-a05b-a310a56c263d-6"><p>å…¨æ–‡ç´¢å¼•ï¼ˆä¹Ÿç§°å…¨æ–‡æ£€ç´¢ï¼‰æ˜¯ç›®å‰<code>æœç´¢å¼•æ“</code>ä½¿ç”¨çš„ä¸€ç§å…³é”®æŠ€æœ¯ã€‚å®ƒèƒ½å¤Ÿåˆ©ç”¨ã€<code>åˆ†è¯æŠ€æœ¯</code>ã€‘ ç­‰å¤šç§ç®—æ³•æ™ºèƒ½åˆ†æå‡ºæ–‡æœ¬æ–‡å­—ä¸­å…³é”®è¯çš„é¢‘ç‡å’Œé‡è¦æ€§ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è§„åˆ™æ™ºèƒ½åœ°ç­›é€‰å‡ºæˆ‘ä»¬æƒ³è¦çš„æœç´¢ç»“æœã€‚å…¨æ–‡ç´¢å¼•éå¸¸é€‚åˆå¤§å‹æ•°æ®é›†ï¼Œå¯¹äºå°çš„æ•°æ®é›†ï¼Œå®ƒçš„ç”¨å¤„æ¯”è¾ƒå°ã€‚</p><p>ä½¿ç”¨å‚æ•°<code>FULLTEXT</code>å¯ä»¥è®¾ç½®ç´¢å¼•ä¸ºå…¨æ–‡ç´¢å¼•ã€‚åœ¨å®šä¹‰ç´¢å¼•çš„åˆ—ä¸Šæ”¯æŒå€¼çš„å…¨æ–‡æŸ¥æ‰¾ï¼Œå…è®¸åœ¨è¿™äº›ç´¢å¼•åˆ—ä¸­æ’å…¥é‡å¤å€¼å’Œç©ºå€¼ã€‚å…¨æ–‡ç´¢å¼•åªèƒ½åˆ›å»ºåœ¨<code>CHAR</code>ã€<code>VARCHAR</code>æˆ–<code>TEXT</code>ç±»å‹åŠå…¶ç³»åˆ—ç±»å‹çš„å­—æ®µä¸Šï¼Œ<span class='p red'>æŸ¥è¯¢æ•°æ®é‡è¾ƒå¤§çš„å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µæ—¶ï¼Œä½¿ç”¨å…¨æ–‡ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</span>ä¾‹å¦‚ï¼Œè¡¨ student çš„å­—æ®µ information æ˜¯ TEXT ç±»å‹ï¼Œ è¯¥å­—æ®µåŒ…å«äº†å¾ˆå¤šæ–‡å­—ä¿¡æ¯ã€‚åœ¨å­—æ®µinformationä¸Šå»ºç«‹å…¨æ–‡ç´¢å¼•åï¼Œå¯ä»¥æé«˜æŸ¥è¯¢å­—æ®µinformationçš„é€Ÿåº¦ã€‚</p><p>å…¨æ–‡ç´¢å¼•å…¸å‹çš„æœ‰ä¸¤ç§ç±»å‹ï¼šè‡ªç„¶è¯­è¨€çš„å…¨æ–‡ç´¢å¼•å’Œå¸ƒå°”å…¨æ–‡ç´¢å¼•ã€‚</p><p>è‡ªç„¶è¯­è¨€æœç´¢å¼•æ“å°†è®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡å’ŒæŸ¥è¯¢çš„ç›¸å…³åº¦ã€‚è¿™é‡Œï¼Œç›¸å…³åº¦æ˜¯åŸºäºåŒ¹é…çš„å…³é”®è¯çš„ä¸ªæ•°ï¼Œä»¥åŠå…³é”®è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚<span class='p red'>åœ¨æ•´ä¸ªç´¢å¼•ä¸­å‡ºç°æ¬¡æ•°è¶Šå°‘çš„è¯è¯­ï¼ŒåŒ¹é…æ—¶çš„ç›¸å…³åº¦å°±è¶Šé«˜ã€‚</span>ç›¸åï¼Œéå¸¸å¸¸è§çš„å•è¯å°†ä¸ä¼šè¢«æœç´¢ï¼Œå¦‚æœä¸€ä¸ªè¯è¯­çš„åœ¨è¶…è¿‡ 50%çš„è®°å½•ä¸­éƒ½å‡ºç°äº†ï¼Œé‚£ä¹ˆè‡ªç„¶è¯­è¨€çš„æœç´¢å°†ä¸ä¼šæœç´¢è¿™ç±»è¯è¯­ã€‚</p><p>MysQLæ•°æ®åº“ä»3.23.23ç‰ˆå¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•|ï¼Œä½†MySQL5.6.4ä»¥å‰åªæœ‰Myisamæ”¯æŒï¼Œ5.6.4ç‰ˆæœ¬ä»¥å innodbæ‰æ”¯æŒï¼Œä½†æ˜¯å®˜æ–¹ç‰ˆæœ¬ä¸æ”¯æŒä¸­æ–‡åˆ†è¯ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹åˆ†è¯æ’ä»¶ã€‚åœ¨5.7.6ç‰ˆæœ¬ï¼ŒMySQLå†…ç½®äº† ngramå…¨æ–‡è§£æå™¨ï¼Œç”¨æ¥æ”¯æŒäºšæ´²è¯­ç§çš„åˆ†è¯ã€‚æµ‹è¯•æˆ–ä½¿ç”¨å…¨æ–‡ç´¢å¼•æ—¶ï¼Œè¦å…ˆçœ‹ä¸€ä¸‹è‡ªå·±çš„ MySQLç‰ˆæœ¬ã€å­˜å‚¨å¼•æ“å’Œæ•°æ®ç±»å‹æ˜¯å¦æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚</p><p>éšç€å¤§æ•°æ®æ—¶ä»£çš„åˆ°æ¥ï¼Œå…³ç³»å‹æ•°æ®åº“åº”å¯¹å…¨æ–‡ç´¢å¼•çš„éœ€æ±‚å·²åŠ›ä¸ä»å¿ƒï¼Œé€æ¸è¢«<code>solr</code>ã€<code>Elasticsearch</code>ç­‰ä¸“é—¨çš„æœç´¢å¼•æ“æ‰€æ›¿ä»£ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc9-a05b-a310a56c263d-7"><p>ä½¿ç”¨<code>å‚æ•°SPATIAL</code>å¯ä»¥è®¾ç½®ç´¢å¼•ä¸ºç©ºé—´ç´¢å¼•ã€‚ç©ºé—´ç´¢å¼•åªèƒ½å»ºç«‹åœ¨ç©ºé—´æ•°æ®ç±»å‹ä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿè·å–ç©ºé—´æ•°æ®çš„æ•ˆç‡ã€‚MysQLä¸­çš„ç©ºé—´æ•°æ®ç±»å‹åŒ…æ‹¬<code>GEOMETRY</code>ã€<code>POINT</code>ã€<code>LINESTRING</code>å’Œ<code>POLYGON</code>ç­‰ã€‚ç›®å‰åªæœ‰MyISAM å­˜å‚¨å¼•æ“æ”¯æŒç©ºé—´æ£€ç´¢ï¼Œè€Œä¸”ç´¢å¼•çš„å­—æ®µä¸èƒ½ä¸ºç©ºå€¼ã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œè¿™ç±»ç´¢å¼•å¾ˆå°‘ä¼šç”¨åˆ°ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>å°ç»“ï¼šä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒçš„ç´¢å¼•ç±»å‹ä¹Ÿä¸ä¸€æ ·</p><p>InnoDB ï¼šæ”¯æŒ B-treeã€Full-text ç­‰ç´¢å¼•ï¼Œä¸æ”¯æŒ Hash ç´¢å¼•ï¼›</p><p>MyISAM ï¼š æ”¯æŒ B-treeã€Full-text ç­‰ç´¢å¼•ï¼Œä¸æ”¯æŒ Hash ç´¢å¼•ï¼›</p><p>Memory ï¼šæ”¯æŒ B-treeã€Hash ç­‰ ç´¢å¼•ï¼Œä¸æ”¯æŒ Full-text ç´¢å¼•ï¼›</p><p>NDB ï¼šæ”¯æŒ Hash ç´¢å¼•ï¼Œä¸æ”¯æŒ B-treeã€Full-text ç­‰ç´¢å¼•ï¼›</p><p>Archive ï¼šä¸æ”¯æŒ B-treeã€Hashã€Full-text ç­‰ç´¢å¼•ï¼›</p><hr><h2 id="2-åˆ›å»ºç´¢å¼•">2. åˆ›å»ºç´¢å¼•</h2><p>MySQLæ”¯æŒå¤šç§æ–¹æ³•åœ¨å•ä¸ªæˆ–å¤šä¸ªåˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼šåœ¨åˆ›å»ºè¡¨çš„å®šä¹‰è¯­å¥<code>CREATE TABLE</code>ä¸­æŒ‡å®šç´¢å¼•åˆ—ï¼Œä½¿ç”¨<code>ALTER TABLE</code>è¯­å¥åœ¨å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•ï¼Œæˆ–è€…ä½¿ç”¨<code>CREATE INDEX</code>è¯­å¥åœ¨å·²å­˜åœ¨çš„è¡¨ä¸Šæ·»åŠ ç´¢å¼•ã€‚</p><h3 id="2-1-åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•">2.1 åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</h3><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept(</span><br><span class="line">dept_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">dept_name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"># éšå¼çš„æ–¹å¼åˆ›å»ºç´¢å¼•ã€‚åœ¨å£°æ˜æœ‰ä¸»é”®çº¦æŸã€å”¯ä¸€æ€§çº¦æŸã€å¤–é”®çº¦æŸçš„å­—æ®µä¸Šï¼Œä¼šè‡ªåŠ¨çš„æ·»åŠ ç›¸å…³çš„ç´¢å¼•</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp(</span><br><span class="line">emp_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">emp_name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">dept_id <span class="type">INT</span>,</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp_dept_id_fk <span class="keyword">FOREIGN</span> KEY(dept_id) <span class="keyword">REFERENCES</span> dept(dept_id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¾å¼åˆ›å»ºè¡¨æ—¶åˆ›å»ºç´¢å¼•çš„è¯ï¼ŒåŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name </span><br><span class="line">[col_name data_type]  [<span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT <span class="operator">|</span> SPATIAL]  [INDEX <span class="operator">|</span> KEY] [index_name] </span><br><span class="line">(col_name [length]) [<span class="keyword">ASC</span> <span class="operator">|</span><span class="keyword">DESC</span>]</span><br></pre></td></tr></table></figure><p>*<code>UNIQUE</code>ã€<code>FULLTEXT</code>å’Œ<code>SPATIAL</code>ä¸ºå¯é€‰å‚æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºå”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•å’Œç©ºé—´ç´¢å¼•ï¼›<br>*<code>INDEX</code>ä¸<code>KEY</code>ä¸ºåŒä¹‰è¯ï¼Œä¸¤è€…çš„ä½œç”¨ç›¸åŒï¼Œç”¨æ¥æŒ‡å®šåˆ›å»ºç´¢å¼•ï¼›<br>*<code>index_name</code>æŒ‡å®šç´¢å¼•çš„åç§°ï¼Œä¸ºå¯é€‰å‚æ•°ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆMySQLé»˜è®¤col_nameä¸ºç´¢å¼•åï¼›<br>*<code>col_name</code>ä¸ºéœ€è¦åˆ›å»ºç´¢å¼•çš„å­—æ®µåˆ—ï¼Œè¯¥åˆ—å¿…é¡»ä»æ•°æ®è¡¨ä¸­å®šä¹‰çš„å¤šä¸ªåˆ—ä¸­é€‰æ‹©ï¼›<br>*<code>length</code>ä¸ºå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºç´¢å¼•çš„é•¿åº¦ï¼Œåªæœ‰å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µæ‰èƒ½æŒ‡å®šç´¢å¼•é•¿åº¦ï¼›<br>*<code>ASC</code>æˆ–<code>DESC</code>æŒ‡å®šå‡åºæˆ–è€…é™åºçš„ç´¢å¼•å€¼å­˜å‚¨ã€‚</p><div class="tabs" id="36c85279-7f3e-4bc8-a05b-a310a56c263d"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#36c85279-7f3e-4bc8-a05b-a310a56c263d-1"><i class="fas fa-atom"></i>æ™®é€šç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc8-a05b-a310a56c263d-2"><i class="far fa-sun"></i>å”¯ä¸€æ€§ç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc8-a05b-a310a56c263d-3"><i class="fas fa-wind"></i>ä¸»é”®ç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc8-a05b-a310a56c263d-4"><i class="fas fa-fire-alt"></i>å•åˆ—ç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc8-a05b-a310a56c263d-5"><i class="fas fa-award"></i>è”åˆç´¢å¼•</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc8-a05b-a310a56c263d-6"><i class="fas fa-baseball-ball"></i>å…¨æ–‡æ£€ç´¢</button></li><li class="tab"><button type="button" data-href="#36c85279-7f3e-4bc8-a05b-a310a56c263d-7"><i class="fas fa-bone"></i>ç©ºé—´ç´¢å¼•</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="36c85279-7f3e-4bc8-a05b-a310a56c263d-1"><p>åœ¨bookè¡¨ä¸­çš„year_publicationå­—æ®µä¸Šå»ºç«‹æ™®é€šç´¢å¼•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book(</span><br><span class="line">  book_id <span class="type">INT</span> ,</span><br><span class="line">  book_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">  authors <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">  info <span class="type">VARCHAR</span>(<span class="number">100</span>) ,</span><br><span class="line">  comment <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">  year_publication <span class="keyword">YEAR</span>,</span><br><span class="line">  INDEX idx_bname(book_name)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#æ–¹å¼ä¸€</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book;</span><br><span class="line">#æ–¹å¼äºŒ</span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> book;</span><br><span class="line">#æ–¹å¼ä¸‰ æ€§èƒ½åˆ†æå·¥å…·EXPLAIN</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> book <span class="keyword">WHERE</span> book_name<span class="operator">=</span><span class="string">&#x27;Mysqlé«˜çº§&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc8-a05b-a310a56c263d-2"><p>å£°æ˜æœ‰å”¯ä¸€ç´¢å¼•çš„å­—æ®µï¼Œåœ¨æ·»åŠ æ•°æ®æ—¶ï¼Œè¦ä¿è¯å”¯ä¸€æ€§ï¼Œä½†æ˜¯å¯ä»¥æ·»åŠ null</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test1(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX uk_idx_id(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc8-a05b-a310a56c263d-3"><p>é€šè¿‡å®šä¹‰ä¸»é”®çº¦æŸçš„æ–¹å¼å®šä¹‰ä¸»é”®ç´¢å¼•ï¼Œinnodbä¸ºèšç°‡ç´¢å¼•ï¼Œè¯­æ³•ï¼š</p><ul><li>éšè¡¨ä¸€èµ·å»ºç´¢å¼•ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (</span><br><span class="line">id <span class="type">INT</span>(<span class="number">10</span>) UNSIGNED AUTO_INCREMENT ,</span><br><span class="line">student_no <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">student_name <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡åˆ é™¤ä¸»é”®çº¦æŸçš„æ–¹å¼åˆ é™¤ä¸»é”®ç´¢å¼•ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc8-a05b-a310a56c263d-4"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test2(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">name <span class="type">CHAR</span>(<span class="number">50</span>) <span class="keyword">NULL</span>,</span><br><span class="line">INDEX single_idx_name(name(<span class="number">20</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc8-a05b-a310a56c263d-5"><p>ä¸¾ä¾‹ï¼šåˆ›å»ºè¡¨test3ï¼Œåœ¨è¡¨ä¸­çš„idã€nameå’Œageå­—æ®µä¸Šå»ºç«‹ç»„åˆç´¢å¼•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test3(</span><br><span class="line">id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">age <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">info <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">INDEX multi_idx(id,name,age)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>åœ¨test3è¡¨ä¸­ï¼ŒæŸ¥è¯¢idå’Œnameå­—æ®µï¼Œä½¿ç”¨EXPLAINè¯­å¥æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test3 <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> name<span class="operator">=</span><span class="string">&#x27;songhongkang&#x27;</span> \G</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢idå’Œnameå­—æ®µæ—¶ï¼Œä½¿ç”¨äº†åç§°ä¸ºMultiIdxçš„ç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢ (name, age) ç»„åˆæˆ–è€…å•ç‹¬æŸ¥è¯¢nameå’Œageå­—æ®µï¼Œä¼šå‘ç°ç»“æœä¸­possible_keyså’Œkeyå€¼ä¸ºNULL, å¹¶æ²¡æœ‰ä½¿ç”¨åœ¨t3è¡¨ä¸­åˆ›å»ºçš„ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc8-a05b-a310a56c263d-6"><p>FULLTEXTå…¨æ–‡ç´¢å¼•å¯ä»¥ç”¨äºå…¨æ–‡æ£€ç´¢ï¼Œå¹¶ä¸”åªä¸º<code>CHAR</code>ã€<code>VARCHAR</code>å’Œ<code>TEXT</code>åˆ—åˆ›å»ºç´¢å¼•ã€‚ç´¢å¼•æ€»æ˜¯å¯¹æ•´ä¸ªåˆ—è¿›è¡Œï¼Œä¸æ”¯æŒå±€éƒ¨ (å‰ç¼€) ç´¢å¼•ã€‚</p><p>ä¸¾ä¾‹1ï¼šåˆ›å»ºè¡¨test4ï¼Œåœ¨è¡¨ä¸­çš„infoå­—æ®µä¸Šå»ºç«‹å…¨æ–‡ç´¢å¼•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test4(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">age <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">info <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">FULLTEXT INDEX futxt_idx_info(info)</span><br><span class="line">) ENGINE<span class="operator">=</span>MyISAM;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨MySQL5.7åŠä¹‹åç‰ˆæœ¬ä¸­å¯ä»¥ä¸æŒ‡å®šæœ€åçš„ENGINEäº†ï¼Œå› ä¸ºåœ¨æ­¤ç‰ˆæœ¬ä¸­InnoDBæ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚</p></blockquote><p>è¯­å¥æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä½¿ç”¨SHOW CREATE TABLEæŸ¥çœ‹è¡¨ç»“æ„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> test4 \G</span><br></pre></td></tr></table></figure><p>ç”±ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œinfoå­—æ®µä¸Šå·²ç»æˆåŠŸå»ºç«‹äº†ä¸€ä¸ªåä¸ºfutxt_idx_infoçš„FULLTEXTç´¢å¼•ã€‚</p><p>ä¸¾ä¾‹2ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> articles (</span><br><span class="line">id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">title <span class="type">VARCHAR</span> (<span class="number">200</span>),</span><br><span class="line">body TEXT,</span><br><span class="line">FULLTEXT index (title, body)</span><br><span class="line">) ENGINE <span class="operator">=</span> INNODB;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºäº†ä¸€ä¸ªç»™titleå’Œbodyå­—æ®µæ·»åŠ å…¨æ–‡ç´¢å¼•çš„è¡¨ã€‚</p><p>ä¸¾ä¾‹3ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`papers`(</span><br><span class="line">`id`<span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`title`<span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`content`text,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">FULLTEXT KEY`title`(`title`,`content`)</span><br><span class="line">) ENGINE<span class="operator">=</span>MyISAM <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>ä¸åŒäºlikeæ–¹å¼çš„çš„æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> papers <span class="keyword">WHERE</span> content <span class="keyword">LIKE</span> â€˜<span class="operator">%</span>æŸ¥è¯¢å­—ç¬¦ä¸²<span class="operator">%</span>â€™;</span><br></pre></td></tr></table></figure><p>å…¨æ–‡ç´¢å¼•ç”¨match+againstæ–¹å¼æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> papers <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(title,content) AGAINST (â€˜æŸ¥è¯¢å­—ç¬¦ä¸²â€™);</span><br></pre></td></tr></table></figure><p>æ˜æ˜¾çš„æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><blockquote><p>æ³¨æ„ç‚¹</p><ol><li>ä½¿ç”¨å…¨æ–‡ç´¢å¼•å‰ï¼Œææ¸…æ¥šç‰ˆæœ¬æ”¯æŒæƒ…å†µï¼›</li><li>å…¨æ–‡ç´¢å¼•æ¯” like + % å¿« N å€ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨ç²¾åº¦é—®é¢˜ï¼›</li><li>å¦‚æœéœ€è¦å…¨æ–‡ç´¢å¼•çš„æ˜¯å¤§é‡æ•°æ®ï¼Œå»ºè®®å…ˆæ·»åŠ æ•°æ®ï¼Œå†åˆ›å»ºç´¢å¼•ã€‚</li></ol></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="36c85279-7f3e-4bc8-a05b-a310a56c263d-7"><p>ç©ºé—´ç´¢å¼•åˆ›å»ºä¸­ï¼Œè¦æ±‚ç©ºé—´ç±»å‹çš„å­—æ®µå¿…é¡»ä¸º éç©º ã€‚</p><p>ä¸¾ä¾‹ï¼šåˆ›å»ºè¡¨test5ï¼Œåœ¨ç©ºé—´ç±»å‹ä¸ºGEOMETRYçš„å­—æ®µä¸Šåˆ›å»ºç©ºé—´ç´¢å¼•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test5(</span><br><span class="line">geo GEOMETRY <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">SPATIAL INDEX spa_idx_geo(geo)</span><br><span class="line">) ENGINE<span class="operator">=</span>MyISAM;</span><br></pre></td></tr></table></figure><p>è¯¥è¯­å¥æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä½¿ç”¨SHOW CREATE TABLEæŸ¥çœ‹è¡¨ç»“æ„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> test5 \G</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œtest5è¡¨çš„geoå­—æ®µä¸Šåˆ›å»ºäº†åç§°ä¸ºspa_idx_geoçš„ç©ºé—´ç´¢å¼•ã€‚æ³¨æ„åˆ›å»ºæ—¶æŒ‡å®šç©ºé—´ç±»å‹å­—æ®µå€¼çš„éç©ºçº¦æŸï¼Œå¹¶ä¸”è¡¨çš„å­˜å‚¨å¼•æ“ä¸ºMyISAMã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="2-2-åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•">2.2 åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•</h3><p>åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸­åˆ›å»ºç´¢å¼•å¯ä»¥ä½¿ç”¨ALTER TABLEè¯­å¥æˆ–è€…CREATE INDEXè¯­å¥ã€‚</p><p><strong>1. ä½¿ç”¨ALTER TABLEè¯­å¥åˆ›å»ºç´¢å¼•</strong><code>ALTER TABLE</code>è¯­å¥åˆ›å»ºç´¢å¼•çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> [<span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT <span class="operator">|</span> SPATIAL] [INDEX <span class="operator">|</span> KEY]</span><br><span class="line">[index_name] (col_name[length],...) [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]</span><br></pre></td></tr></table></figure><p><strong>2. ä½¿ç”¨CREATE INDEXåˆ›å»ºç´¢å¼•</strong><code>CREATE INDEX</code>è¯­å¥å¯ä»¥åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šæ·»åŠ ç´¢å¼•ï¼Œåœ¨MySQLä¸­ï¼Œ CREATE INDEXè¢«æ˜ å°„åˆ°ä¸€ä¸ªALTER TABLEè¯­å¥ä¸Šï¼ŒåŸºæœ¬è¯­æ³•ç»“æ„ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT <span class="operator">|</span> SPATIAL] INDEX index_name</span><br><span class="line"><span class="keyword">ON</span> table_name (col_name[length],...) [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]</span><br></pre></td></tr></table></figure><hr><h2 id="3-åˆ é™¤ç´¢å¼•">3. åˆ é™¤ç´¢å¼•</h2><p><strong>1. ä½¿ç”¨ALTER TABLEåˆ é™¤ç´¢å¼•</strong><code>ALTER TABLE</code>åˆ é™¤ç´¢å¼•çš„åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> INDEX index_name;</span><br></pre></td></tr></table></figure><p><strong>2. ä½¿ç”¨DROP INDEXè¯­å¥åˆ é™¤ç´¢å¼•</strong><code>DROP INDEX</code>åˆ é™¤ç´¢å¼•çš„åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX index_name <span class="keyword">ON</span> table_name;</span><br></pre></td></tr></table></figure><blockquote><p>æç¤º: åˆ é™¤è¡¨ä¸­çš„åˆ—æ—¶ï¼Œå¦‚æœè¦åˆ é™¤çš„åˆ—ä¸ºç´¢å¼•çš„ç»„æˆéƒ¨åˆ†ï¼Œåˆ™è¯¥åˆ—ä¹Ÿä¼šä»ç´¢å¼•ä¸­åˆ é™¤ã€‚å¦‚æœç»„æˆç´¢å¼•çš„æ‰€æœ‰åˆ—éƒ½è¢«åˆ é™¤ï¼Œåˆ™æ•´ä¸ªç´¢å¼•å°†è¢«åˆ é™¤ã€‚</p></blockquote><hr><h2 id="4-MySQL8-0ç´¢å¼•æ–°ç‰¹æ€§">4. MySQL8.0ç´¢å¼•æ–°ç‰¹æ€§</h2><h3 id="4-1-æ”¯æŒé™åºç´¢å¼•">4.1 æ”¯æŒé™åºç´¢å¼•</h3><p>é™åºç´¢å¼•ä»¥é™åºå­˜å‚¨é”®å€¼ã€‚è™½ç„¶åœ¨è¯­æ³•ä¸Šï¼Œä»MySQL 4ç‰ˆæœ¬å¼€å§‹å°±å·²ç»æ”¯æŒé™åºç´¢å¼•çš„è¯­æ³•äº†ï¼Œä½†å®é™…ä¸ŠDESCå®šä¹‰æ˜¯è¢«å¿½ç•¥çš„ï¼Œç›´åˆ°MySQL 8.xç‰ˆæœ¬æ‰å¼€å§‹çœŸæ­£æ”¯æŒé™åºç´¢å¼• (ä»…é™äºInnoDBcå­˜å‚¨å¼•æ“)ã€‚</p><p>MySQLåœ¨<span class='p red'>8.0ç‰ˆæœ¬ä¹‹å‰åˆ›å»ºçš„ä»ç„¶æ˜¯å‡åºç´¢å¼•ï¼Œä½¿ç”¨æ—¶è¿›è¡Œåå‘æ‰«æï¼Œè¿™å¤§å¤§é™ä½äº†æ•°æ®åº“çš„æ•ˆç‡ã€‚</span>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œé™åºç´¢å¼•æ„ä¹‰é‡å¤§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢ï¼Œéœ€è¦å¯¹å¤šä¸ªåˆ—è¿›è¡Œæ’åºï¼Œä¸”é¡ºåºè¦æ±‚ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆä½¿ç”¨é™åºç´¢å¼•å°†ä¼šé¿å…æ•°æ®åº“ä½¿ç”¨é¢å¤–çš„æ–‡ä»¶æ’åºæ“ä½œï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p><p>ä¸¾ä¾‹ï¼šåˆ†åˆ«åœ¨MySQL 5.7ç‰ˆæœ¬å’ŒMySQL 8.0ç‰ˆæœ¬ä¸­åˆ›å»ºæ•°æ®è¡¨ts1ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ts1(a <span class="type">int</span>,b <span class="type">int</span>,index idx_a_b(a,b <span class="keyword">desc</span>));</span><br></pre></td></tr></table></figure><p>åœ¨MySQL 5.7ç‰ˆæœ¬ä¸­æŸ¥çœ‹æ•°æ®è¡¨ts1çš„ç»“æ„ï¼Œç»“æœå¦‚ä¸‹:</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220622224124267.png" alt="image-20220622224124267" style="zoom:50%;" /><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç´¢å¼•ä»ç„¶æ˜¯é»˜è®¤çš„å‡åº</p><p>åœ¨MySQL 8.0ç‰ˆæœ¬ä¸­æŸ¥çœ‹æ•°æ®è¡¨ts1çš„ç»“æ„ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220622224205048.png" alt="image-20220622224205048" style="zoom:50%;" /><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç´¢å¼•å·²ç»æ˜¯é™åºäº†ã€‚ä¸‹é¢ç»§ç»­æµ‹è¯•é™åºç´¢å¼•åœ¨æ‰§è¡Œè®¡åˆ’ä¸­çš„è¡¨ç°ã€‚</p><p>åˆ†åˆ«åœ¨MySQL 5.7ç‰ˆæœ¬å’ŒMySQL 8.0ç‰ˆæœ¬çš„æ•°æ®è¡¨ts1ä¸­æ’å…¥800æ¡éšæœºæ•°æ®ï¼Œæ‰§è¡Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ts_insert()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">WHILE i <span class="operator">&lt;</span> <span class="number">800</span></span><br><span class="line">DO</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> ts1 <span class="keyword">select</span> rand()<span class="operator">*</span><span class="number">80000</span>, rand()<span class="operator">*</span><span class="number">80000</span>;</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER;</span><br><span class="line"></span><br><span class="line"># è°ƒç”¨</span><br><span class="line"><span class="keyword">CALL</span> ts_insert();</span><br></pre></td></tr></table></figure><p>åœ¨MySQL 5.7ç‰ˆæœ¬ä¸­æŸ¥çœ‹æ•°æ®è¡¨ts1çš„æ‰§è¡Œè®¡åˆ’ï¼Œç»“æœå¦‚ä¸‹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> ts1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> a, b <span class="keyword">DESC</span> LIMIT <span class="number">5</span>;</span><br></pre></td></tr></table></figure><p>åœ¨MySQL 8.0ç‰ˆæœ¬ä¸­æŸ¥çœ‹æ•°æ®è¡¨ ts1 çš„æ‰§è¡Œè®¡åˆ’ã€‚</p><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œä¿®æ”¹åMySQL 5.7 çš„æ‰§è¡Œè®¡åˆ’è¦æ˜æ˜¾å¥½äºMySQL 8.0ã€‚</p><hr><h3 id="4-2-éšè—ç´¢å¼•">4.2 éšè—ç´¢å¼•</h3><p>åœ¨MySQL 5.7ç‰ˆæœ¬åŠä¹‹å‰ï¼Œåªèƒ½é€šè¿‡æ˜¾å¼çš„æ–¹å¼åˆ é™¤ç´¢å¼•ã€‚æ­¤æ—¶ï¼Œå¦‚æœå‘å±•åˆ é™¤ç´¢å¼•åå‡ºç°é”™è¯¯ï¼Œåˆåªèƒ½é€šè¿‡æ˜¾å¼åˆ›å»ºç´¢å¼•çš„æ–¹å¼å°†åˆ é™¤çš„ç´¢å¼•åˆ›å»ºå›æ¥ã€‚å¦‚æœæ•°æ®è¡¨ä¸­çš„æ•°æ®é‡éå¸¸å¤§ï¼Œæˆ–è€…æ•°æ®è¡¨æœ¬èº«æ¯”è¾ƒå¤§ï¼Œè¿™ç§æ“ä½œå°±ä¼šæ¶ˆè€—ç³»ç»Ÿè¿‡å¤šçš„èµ„æºï¼Œæ“ä½œæˆæœ¬éå¸¸é«˜ã€‚</p><p>ä»MySQL 8.xå¼€å§‹æ”¯æŒ<code>éšè—ç´¢å¼•ï¼ˆinvisible indexesï¼‰</code>ï¼Œåªéœ€è¦å°†å¾…åˆ é™¤çš„ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•ï¼Œä½¿æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸å†ä½¿ç”¨è¿™ä¸ªç´¢å¼•ï¼ˆå³ä½¿ä½¿ç”¨force indexï¼ˆå¼ºåˆ¶ä½¿ç”¨ç´¢å¼•ï¼‰ï¼Œä¼˜åŒ–å™¨ä¹Ÿä¸ä¼šä½¿ç”¨è¯¥ç´¢å¼•ï¼‰ï¼Œ ç¡®è®¤å°†ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•åç³»ç»Ÿä¸å—ä»»ä½•å“åº”ï¼Œå°±å¯ä»¥å½»åº•åˆ é™¤ç´¢å¼•ã€‚ <span class='p green'>è¿™ç§é€šè¿‡å…ˆå°†ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•ï¼Œå†åˆ é™¤ç´¢å¼•çš„æ–¹å¼å°±æ˜¯è½¯åˆ é™¤ã€‚</span></p><p>åŒæ—¶ï¼Œå¦‚æœä½ æƒ³éªŒè¯æŸä¸ªç´¢å¼•åˆ é™¤ä¹‹åçš„<code>æŸ¥è¯¢æ€§èƒ½å½±å“</code>ï¼Œå°±å¯ä»¥æš‚æ—¶å…ˆéšè—è¯¥ç´¢å¼•ã€‚</p><blockquote><p>æ³¨æ„ï¼š</p><p>ä¸»é”®ä¸èƒ½è¢«è®¾ç½®ä¸ºéšè—ç´¢å¼•ã€‚å½“è¡¨ä¸­æ²¡æœ‰æ˜¾å¼ä¸»é”®æ—¶ï¼Œè¡¨ä¸­ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºç´¢å¼•ä¼šæˆä¸ºéšå¼ä¸»é”®ï¼Œä¹Ÿä¸èƒ½è®¾ç½®ä¸ºéšè—ç´¢å¼•ã€‚</p></blockquote><p>ç´¢å¼•é»˜è®¤æ˜¯å¯è§çš„ï¼Œåœ¨ä½¿ç”¨CREATE TABLE, CREATE INDEX æˆ–è€… ALTER TABLE ç­‰è¯­å¥æ—¶å¯ä»¥é€šè¿‡<code>VISIBLE</code>æˆ–è€…<code>INVISIBLE</code>å…³é”®è¯è®¾ç½®ç´¢å¼•çš„å¯è§æ€§ã€‚</p><div class="tabs" id="24d3db91-5b3b-48e6-badc-00cd6bf05142"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#24d3db91-5b3b-48e6-badc-00cd6bf05142-1"><i class="fas fa-bug"></i>åˆ›å»ºè¡¨æ—¶åˆ›å»º</button></li><li class="tab"><button type="button" data-href="#24d3db91-5b3b-48e6-badc-00cd6bf05142-2"><i class="fas fa-cannabis"></i>åœ¨å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»º</button></li><li class="tab"><button type="button" data-href="#24d3db91-5b3b-48e6-badc-00cd6bf05142-3"><i class="fas fa-candy-cane"></i>é€šè¿‡ALTER TABLEè¯­å¥åˆ›å»º</button></li><li class="tab"><button type="button" data-href="#24d3db91-5b3b-48e6-badc-00cd6bf05142-4"><i class="fas fa-child"></i>åˆ‡æ¢ç´¢å¼•å¯è§çŠ¶æ€</button></li><li class="tab"><button type="button" data-href="#24d3db91-5b3b-48e6-badc-00cd6bf05142-5"><i class="fas fa-dragon"></i>äº†è§£</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="24d3db91-5b3b-48e6-badc-00cd6bf05142-1"><p>åœ¨MySQLä¸­åˆ›å»ºéšè—ç´¢å¼•é€šè¿‡SQLè¯­å¥INVISIBLEæ¥å®ç°ï¼Œå…¶è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tablename(</span><br><span class="line">propname1 type1[CONSTRAINT1],</span><br><span class="line">propname2 type2[CONSTRAINT2],</span><br><span class="line">â€¦â€¦</span><br><span class="line">propnamen typen,</span><br><span class="line">INDEX [indexname](propname1 [(length)]) INVISIBLE</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è¯­å¥æ¯”æ™®é€šç´¢å¼•å¤šäº†ä¸€ä¸ªå…³é”®å­—INVISIBLEï¼Œç”¨æ¥æ ‡è®°ç´¢å¼•ä¸ºä¸å¯è§ç´¢å¼•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="24d3db91-5b3b-48e6-badc-00cd6bf05142-2"><p>å¯ä»¥ä¸ºå·²ç»å­˜åœ¨çš„è¡¨è®¾ç½®éšè—ç´¢å¼•ï¼Œå…¶è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX indexname</span><br><span class="line"><span class="keyword">ON</span> tablename(propname[(length)]) INVISIBLE;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="24d3db91-5b3b-48e6-badc-00cd6bf05142-3"><p>è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tablename</span><br><span class="line"><span class="keyword">ADD</span> INDEX indexname (propname [(length)]) INVISIBLE;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="24d3db91-5b3b-48e6-badc-00cd6bf05142-4"><p>å·²å­˜åœ¨çš„ç´¢å¼•å¯é€šè¿‡å¦‚ä¸‹è¯­å¥åˆ‡æ¢å¯è§çŠ¶æ€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tablename <span class="keyword">ALTER</span> INDEX index_name INVISIBLE; #åˆ‡æ¢æˆéšè—ç´¢å¼•</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tablename <span class="keyword">ALTER</span> INDEX index_name VISIBLE; #åˆ‡æ¢æˆééšè—ç´¢å¼•</span><br></pre></td></tr></table></figure><p>å¦‚æœå°†index_cnameç´¢å¼•åˆ‡æ¢æˆå¯è§çŠ¶æ€ï¼Œé€šè¿‡explainæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°ä¼˜åŒ–å™¨é€‰æ‹©äº†index_cnameç´¢å¼•ã€‚</p><blockquote><p>æ³¨æ„ å½“ç´¢å¼•è¢«éšè—æ—¶ï¼Œå®ƒçš„å†…å®¹ä»ç„¶æ˜¯å’Œæ­£å¸¸ç´¢å¼•ä¸€æ ·å®æ—¶æ›´æ–°çš„ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•éœ€è¦é•¿æœŸè¢«éšè—ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶åˆ é™¤ï¼Œå› ä¸ºç´¢å¼•çš„å­˜åœ¨ä¼šå½±å“æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤çš„æ€§èƒ½ã€‚</p></blockquote><p>é€šè¿‡è®¾ç½®éšè—ç´¢å¼•çš„å¯è§æ€§å¯ä»¥æŸ¥çœ‹ç´¢å¼•å¯¹è°ƒä¼˜çš„å¸®åŠ©ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="24d3db91-5b3b-48e6-badc-00cd6bf05142-5"><blockquote><p><span class='p blue'>ä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§(äº†è§£)</span></p></blockquote><p>åœ¨MySQL 8.xç‰ˆæœ¬ä¸­ï¼Œä¸ºç´¢å¼•æä¾›äº†ä¸€ç§æ–°çš„æµ‹è¯•æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢ä¼˜åŒ–å™¨çš„ä¸€ä¸ªå¼€å…³ (use_invisible_indexes) æ¥æ‰“å¼€æŸä¸ªè®¾ç½®ï¼Œä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§ã€‚å¦‚æœuse_invisible_indexes è®¾ç½®ä¸ºoff (é»˜è®¤)ï¼Œä¼˜åŒ–å™¨ä¼šå¿½ç•¥éšè—ç´¢å¼•ã€‚å¦‚æœè®¾ç½®ä¸ºonï¼Œå³ä½¿éšè—ç´¢å¼•ä¸å¯è§ï¼Œä¼˜åŒ–å™¨åœ¨ç”Ÿæˆæ‰§è¡Œè®¡ åˆ’æ—¶ä»ä¼šè€ƒè™‘ä½¿ç”¨éšè—ç´¢å¼•ã€‚</p><p>ï¼ˆ1ï¼‰åœ¨MySQLå‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å¼€å…³è®¾ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@optimizer</span>_switch \G</span><br></pre></td></tr></table></figure><p>åœ¨è¾“å‡ºçš„ç»“æœä¿¡æ¯ä¸­æ‰¾åˆ°å¦‚ä¸‹å±æ€§é…ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use_invisible_indexes<span class="operator">=</span>off</span><br></pre></td></tr></table></figure><p>æ­¤å±æ€§é…ç½®å€¼ä¸ºoffï¼Œè¯´æ˜éšè—ç´¢å¼•é»˜è®¤å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸å¯è§ã€‚</p><p>ï¼ˆ2ï¼‰ä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§ï¼Œéœ€è¦åœ¨MySQLå‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> session optimizer_switch<span class="operator">=</span>&quot;use_invisible_indexes=on&quot;;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>SQLè¯­å¥æ‰§è¡ŒæˆåŠŸï¼Œå†æ¬¡æŸ¥çœ‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å¼€å…³è®¾ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@optimizer</span>_switch \G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">@<span class="variable">@optimizer</span>_switch:</span><br><span class="line">index_merge<span class="operator">=</span><span class="keyword">on</span>,index_merge_union<span class="operator">=</span><span class="keyword">on</span>,index_merge_sort_union<span class="operator">=</span><span class="keyword">on</span>,index_merge_</span><br><span class="line"><span class="keyword">intersection</span><span class="operator">=</span><span class="keyword">on</span>,engine_condition_pushdown<span class="operator">=</span><span class="keyword">on</span>,index_condition_pushdown<span class="operator">=</span><span class="keyword">on</span>,mrr<span class="operator">=</span><span class="keyword">on</span>,mrr_co</span><br><span class="line">st_based<span class="operator">=</span><span class="keyword">on</span>,block_nested_loop<span class="operator">=</span><span class="keyword">on</span>,batched_key_access<span class="operator">=</span>off,materialization<span class="operator">=</span><span class="keyword">on</span>,semijoin<span class="operator">=</span><span class="keyword">on</span></span><br><span class="line">,loosescan<span class="operator">=</span><span class="keyword">on</span>,firstmatch<span class="operator">=</span><span class="keyword">on</span>,duplicateweedout<span class="operator">=</span><span class="keyword">on</span>,subquery_materialization_cost_based<span class="operator">=</span><span class="keyword">on</span></span><br><span class="line">,use_index_extensions<span class="operator">=</span><span class="keyword">on</span>,condition_fanout_filter<span class="operator">=</span><span class="keyword">on</span>,derived_merge<span class="operator">=</span><span class="keyword">on</span>,use_invisible_ind</span><br><span class="line">exes<span class="operator">=</span><span class="keyword">on</span>,skip_scan<span class="operator">=</span><span class="keyword">on</span>,hash_join<span class="operator">=</span><span class="keyword">on</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œåœ¨è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å±æ€§é…ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use_invisible_indexes<span class="operator">=</span><span class="keyword">on</span></span><br></pre></td></tr></table></figure><p>use_invisible_indexeså±æ€§çš„å€¼ä¸ºonï¼Œè¯´æ˜æ­¤æ—¶éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§ã€‚</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨EXPLAINæŸ¥çœ‹ä»¥å­—æ®µinvisible_columnä½œä¸ºæŸ¥è¯¢æ¡ä»¶æ—¶çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> classes <span class="keyword">where</span> cname <span class="operator">=</span> <span class="string">&#x27;é«˜ä¸€2ç­&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šä½¿ç”¨éšè—ç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®ã€‚</p><p>ï¼ˆ4ï¼‰å¦‚æœéœ€è¦ä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸å¯è§ï¼Œåˆ™åªéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> session optimizer_switch<span class="operator">=</span>&quot;use_invisible_indexes=off&quot;;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥çœ‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å¼€å…³è®¾ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@optimizer</span>_switch \G</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œuse_invisible_indexeså±æ€§çš„å€¼å·²ç»è¢«è®¾ç½®ä¸ºâ€œoffâ€ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="5-ç´¢å¼•çš„è®¾è®¡åŸåˆ™">5. ç´¢å¼•çš„è®¾è®¡åŸåˆ™</h2><p>ä¸ºäº†ä½¿ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡æ›´é«˜ï¼Œåœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œå¿…é¡»è€ƒè™‘åœ¨å“ªäº›å­—æ®µä¸Šåˆ›å»ºç´¢å¼•å’Œåˆ›å»ºä»€ä¹ˆç±»å‹çš„ç´¢å¼•ã€‚**ç´¢å¼•è®¾è®¡ä¸åˆç†æˆ–è€…ç¼ºå°‘ç´¢å¼•éƒ½ä¼šå¯¹æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½é€ æˆéšœç¢ã€‚**é«˜æ•ˆçš„ç´¢å¼•å¯¹äºè·å¾—è‰¯å¥½çš„æ€§èƒ½éå¸¸é‡è¦ã€‚è®¾è®¡ç´¢å¼•æ—¶ï¼Œåº”è¯¥è€ƒè™‘ç›¸åº”å‡†åˆ™ã€‚</p><h3 id="5-1-æ•°æ®å‡†å¤‡">5.1 æ•°æ®å‡†å¤‡</h3><div class="tabs" id="c29b67e3-fde9-4ad0-8300-aaf63d359cc9"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#c29b67e3-fde9-4ad0-8300-aaf63d359cc9-1"><i class="fas fa-award"></i>åˆ›å»ºæ•°æ®åº“ã€åˆ›å»ºè¡¨</button></li><li class="tab"><button type="button" data-href="#c29b67e3-fde9-4ad0-8300-aaf63d359cc9-2"><i class="fas fa-baseball-ball"></i>åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®å¿…éœ€çš„å­˜å‚¨å‡½æ•°</button></li><li class="tab"><button type="button" data-href="#c29b67e3-fde9-4ad0-8300-aaf63d359cc9-3"><i class="fas fa-bone"></i>åˆ›å»ºæ’å…¥æ¨¡æ‹Ÿæ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</button></li><li class="tab"><button type="button" data-href="#c29b67e3-fde9-4ad0-8300-aaf63d359cc9-4"><i class="fas fa-anchor"></i>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="c29b67e3-fde9-4ad0-8300-aaf63d359cc9-1"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE atguigudb1;</span><br><span class="line">USE atguigudb1;</span><br><span class="line">#<span class="number">1.</span>åˆ›å»ºå­¦ç”Ÿè¡¨å’Œè¯¾ç¨‹è¡¨</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`student_info`(</span><br><span class="line">`id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`student_id`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">`name`<span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`course_id`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">`class_id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`create_time`DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>`course`(</span><br><span class="line">`id`<span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`course_id`<span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">`course_name`<span class="type">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="c29b67e3-fde9-4ad0-8300-aaf63d359cc9-2"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#å‡½æ•°<span class="number">1</span>ï¼šåˆ›å»ºéšæœºäº§ç”Ÿå­—ç¬¦ä¸²å‡½æ•°</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_string(n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>) #è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span></span><br><span class="line"><span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> return_str <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;</span> n DO</span><br><span class="line">    <span class="keyword">SET</span> return_str <span class="operator">=</span>CONCAT(return_str,<span class="built_in">SUBSTRING</span>(chars_str,<span class="built_in">FLOOR</span>(<span class="number">1</span><span class="operator">+</span>RAND()<span class="operator">*</span><span class="number">52</span>),<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#å‡½æ•°<span class="number">2</span>ï¼šåˆ›å»ºéšæœºæ•°å‡½æ•°</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_num (from_num <span class="type">INT</span> ,to_num <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">INT</span>(<span class="number">11</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> <span class="built_in">FLOOR</span>(from_num <span class="operator">+</span>RAND()<span class="operator">*</span>(to_num <span class="operator">-</span> from_num<span class="operator">+</span><span class="number">1</span>)) ;</span><br><span class="line"><span class="keyword">RETURN</span> i;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This <span class="keyword">function</span> has <span class="keyword">none</span> <span class="keyword">of</span> DETERMINISTIC......</span><br></pre></td></tr></table></figure><p>ç”±äºå¼€å¯è¿‡æ…¢æŸ¥è¯¢æ—¥å¿—bin-log, æˆ‘ä»¬å°±å¿…é¡»ä¸ºæˆ‘ä»¬çš„functionæŒ‡å®šä¸€ä¸ªå‚æ•°ã€‚</p><p>ä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šå°†å†™æ“ä½œè®°å½•åœ¨bin-logæ—¥å¿—ä¸­ã€‚ä»æœºè¯»å–bin-logæ—¥å¿—ï¼Œæ‰§è¡Œè¯­å¥æ¥åŒæ­¥æ•°æ®ã€‚å¦‚æœä½¿ ç”¨å‡½æ•°æ¥æ“ä½œæ•°æ®ï¼Œä¼šå¯¼è‡´ä»æœºå’Œä¸»é”®æ“ä½œæ—¶é—´ä¸ä¸€è‡´ã€‚æ‰€ä»¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œmysqlä¸å¼€å¯åˆ›å»ºå‡½æ•°è®¾ç½®ã€‚</p><ul><li>æŸ¥çœ‹mysqlæ˜¯å¦å…è®¸åˆ›å»ºå‡½æ•°ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_bin_trust_function_creators&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤å¼€å¯ï¼šå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>; # ä¸åŠ <span class="keyword">global</span>åªæ˜¯å½“å‰çª—å£æœ‰æ•ˆã€‚</span><br></pre></td></tr></table></figure><ul><li><p>mysqldé‡å¯ï¼Œä¸Šè¿°å‚æ•°åˆä¼šæ¶ˆå¤±ã€‚æ°¸ä¹…æ–¹æ³•ï¼š</p><ul><li>windowsä¸‹ï¼šmy.ini[mysqld]åŠ ä¸Šï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>linuxä¸‹ï¼š/etc/my.cnfä¸‹my.cnf[mysqld]åŠ ä¸Šï¼š</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="c29b67e3-fde9-4ad0-8300-aaf63d359cc9-3"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># å­˜å‚¨è¿‡ç¨‹<span class="number">1</span>ï¼šåˆ›å»ºæ’å…¥è¯¾ç¨‹è¡¨å­˜å‚¨è¿‡ç¨‹</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_course( max_num <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">REPEAT #å¾ªç¯</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; #èµ‹å€¼</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course (course_id, course_name ) <span class="keyword">VALUES</span> (rand_num(<span class="number">10000</span>,<span class="number">10100</span>),rand_string(<span class="number">6</span>));</span><br><span class="line">UNTIL i <span class="operator">=</span> max_num</span><br><span class="line"><span class="keyword">END</span> REPEAT;</span><br><span class="line"><span class="keyword">COMMIT</span>; #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># å­˜å‚¨è¿‡ç¨‹<span class="number">2</span>ï¼šåˆ›å»ºæ’å…¥å­¦ç”Ÿä¿¡æ¯è¡¨å­˜å‚¨è¿‡ç¨‹</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_stu( max_num <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">REPEAT #å¾ªç¯</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; #èµ‹å€¼</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student_info (course_id, class_id ,student_id ,NAME ) <span class="keyword">VALUES</span></span><br><span class="line">(rand_num(<span class="number">10000</span>,<span class="number">10100</span>),rand_num(<span class="number">10000</span>,<span class="number">10200</span>),rand_num(<span class="number">1</span>,<span class="number">200000</span>),rand_string(<span class="number">6</span>));</span><br><span class="line">UNTIL i <span class="operator">=</span> max_num</span><br><span class="line"><span class="keyword">END</span> REPEAT;</span><br><span class="line"><span class="keyword">COMMIT</span>; #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="c29b67e3-fde9-4ad0-8300-aaf63d359cc9-4"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> insert_course(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">CALL</span> insert_stu(<span class="number">1000000</span>);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="5-2-å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•">5.2 å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•</h3><div class="tabs" id="001b5ebd-73a5-4b51-9870-47614b415977"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-1"><i class="fas fa-seedling"></i>1</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-2"><i class="fas fa-leaf"></i>2</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-3"><i class="fab fa-apple"></i>3</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-4"><i class="fas fa-tree"></i>4</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-5"><i class="fas fa-cat"></i>5</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-6"><i class="fas fa-horse"></i>6</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-7"><i class="fas fa-dove"></i>7</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-8"><i class="fas fa-dragon"></i>8</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-9"><i class="fas fa-atom"></i>9</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-10"><i class="far fa-sun"></i>10</button></li><li class="tab"><button type="button" data-href="#001b5ebd-73a5-4b51-9870-47614b415977-11"><i class="fas fa-wind"></i>11</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="001b5ebd-73a5-4b51-9870-47614b415977-1"><p><span class='p blue'>å­—æ®µçš„æ•°å€¼æœ‰å”¯ä¸€æ€§çš„é™åˆ¶</span></p><p>ç´¢å¼•æœ¬èº«å¯ä»¥èµ·åˆ°çº¦æŸçš„ä½œç”¨ï¼Œæ¯”å¦‚å”¯ä¸€ç´¢å¼•ã€ä¸»é”®ç´¢å¼•éƒ½æ˜¯å¯ä»¥èµ·åˆ°å”¯ä¸€æ€§çº¦æŸçš„ï¼Œå› æ­¤åœ¨æˆ‘ä»¬çš„æ•°æ®è¡¨ä¸­ï¼Œ å¦‚æœ<code>æŸä¸ªå­—æ®µæ˜¯å”¯ä¸€æ€§çš„</code>ï¼Œå°±å¯ä»¥ç›´æ¥åˆ›å»º<code>å”¯ä¸€æ€§ç´¢å¼•</code>ï¼Œæˆ–è€…<code>ä¸»é”®ç´¢å¼•</code>ã€‚è¿™æ ·å¯ä»¥æ›´å¿«é€Ÿåœ°é€šè¿‡è¯¥ç´¢å¼•æ¥ç¡®å®šæŸæ¡è®°å½•ã€‚</p><p>ä¾‹å¦‚ï¼Œå­¦ç”Ÿè¡¨ä¸­å­¦å·æ˜¯å…·æœ‰å”¯ä¸€æ€§çš„å­—æ®µï¼Œä¸ºè¯¥å­—æ®µå»ºç«‹å”¯ä¸€æ€§ç´¢å¼•å¯ä»¥å¾ˆå¿«ç¡®å®šæŸä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œå¦‚æœä½¿ç”¨å§“åçš„è¯ï¼Œå¯èƒ½å­˜åœ¨åŒåç°è±¡ï¼Œä»è€Œé™ä½æŸ¥è¯¢é€Ÿåº¦ã€‚</p><blockquote><p>ä¸šåŠ¡ä¸Šå…·æœ‰å”¯ä¸€ç‰¹æ€§çš„å­—æ®µï¼Œå³ä½¿æ˜¯ç»„åˆå­—æ®µï¼Œä¹Ÿå¿…é¡»å»ºæˆå”¯ä¸€ç´¢å¼•ã€‚ï¼ˆæ¥æºï¼šAlibabaï¼‰ è¯´æ˜ï¼šä¸è¦ä»¥ä¸ºå”¯ä¸€ç´¢å¼•å½±å“äº† insert é€Ÿåº¦ï¼Œè¿™ä¸ªé€Ÿåº¦æŸè€—å¯ä»¥å¿½ç•¥ï¼Œä½†æé«˜æŸ¥æ‰¾é€Ÿåº¦æ˜¯æ˜æ˜¾çš„ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-2"><p><span class='p green'>é¢‘ç¹ä½œä¸º WHERE æŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</span></p><p>æŸä¸ªå­—æ®µåœ¨SELECTè¯­å¥çš„ WHERE æ¡ä»¶ä¸­ç»å¸¸è¢«ä½¿ç”¨åˆ°ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»™è¿™ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•äº†ã€‚å°¤å…¶æ˜¯åœ¨ æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºæ™®é€šç´¢å¼•å°±å¯ä»¥å¤§å¹…æå‡æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p><p>æ¯”å¦‚student_infoæ•°æ®è¡¨ï¼ˆå«100ä¸‡æ¡æ•°æ®ï¼‰ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ student_id=123110 çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹student_idå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œè¿›è¡Œå¦‚ä¸‹æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  course_id,class_id,name,create_time,student_id</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  student_info</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  student_id <span class="operator">=</span> <span class="number">123110</span>;</span><br></pre></td></tr></table></figure><p>èŠ±è´¹276ms</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ç»™student_id ç´¢å¼•åæŸ¥è¯¢</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student_info <span class="keyword">ADD</span> INDEX idx_sid(student_id);</span><br></pre></td></tr></table></figure><p>èŠ±è´¹40ms</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-3"><p><span class='p red'>ç»å¸¸ GROUP BY å’Œ ORDER BY çš„åˆ—</span></p><p>ç´¢å¼•å°±æ˜¯è®©æ•°æ®æŒ‰ç…§æŸç§é¡ºåºè¿›è¡Œå­˜å‚¨æˆ–æ£€ç´¢ï¼Œå› æ­¤å½“æˆ‘ä»¬ä½¿ç”¨ GROUP BY å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„æŸ¥è¯¢ï¼Œæˆ–è€…ä½¿ç”¨ ORDER BY å¯¹æ•°æ®è¿›è¡Œæ’åºçš„æ—¶å€™ï¼Œå°±éœ€è¦<code>å¯¹åˆ†ç»„æˆ–è€…æ’åºçš„å­—æ®µè¿›è¡Œç´¢å¼•</code>ã€‚å¦‚æœå¾…æ’åºçš„åˆ—æœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¿™äº›åˆ—ä¸Šå»ºç«‹<code>ç»„åˆç´¢å¼•</code>ã€‚</p><p>æ¯”å¦‚ï¼ŒæŒ‰ç…§ student_id å¯¹å­¦ç”Ÿé€‰ä¿®çš„è¯¾ç¨‹è¿›è¡Œåˆ†ç»„ï¼Œæ˜¾ç¤ºä¸åŒçš„ student_id å’Œè¯¾ç¨‹æ•°é‡ï¼Œæ˜¾ç¤º 100 ä¸ªå³å¯ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸å¯¹ student_id åˆ›å»ºç´¢å¼•ï¼Œæ‰§è¡Œä¸‹é¢çš„ SQLè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  student_id,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> num </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  student_info</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">  student_id</span><br><span class="line">LIMIT</span><br><span class="line">  <span class="number">100</span>;</span><br></pre></td></tr></table></figure><p>èŠ±è´¹ 866ms</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ç»™student_id ç´¢å¼•åæŸ¥è¯¢</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student_info <span class="keyword">ADD</span> INDEX idx_sid(student_id);</span><br></pre></td></tr></table></figure><p>èŠ±è´¹ 40ms</p><p>åŒæ ·ï¼Œå¦‚æœæ˜¯ ORDER BYï¼Œä¹Ÿéœ€è¦å¯¹å­—æ®µåˆ›å»ºç´¢å¼•ã€‚</p><p>å¦‚æœåŒæ—¶æœ‰ GROUP BY å’Œ ORDER BY çš„æƒ…å†µï¼šæ¯”å¦‚æˆ‘ä»¬æŒ‰ç…§ student_id è¿›è¡Œåˆ†ç»„ï¼ŒåŒæ—¶æŒ‰ç…§åˆ›å»ºæ—¶é—´é™åºçš„æ–¹å¼è¿›è¡Œæ’åºï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦åŒæ—¶è¿›è¡Œ GROUP BY å’Œ ORDER BYï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯éœ€è¦å•ç‹¬åˆ›å»º student_id çš„ç´¢å¼•å’Œ create_time çš„ç´¢å¼•å‘¢ï¼Ÿ</p><p>å½“æˆ‘ä»¬å¯¹ student_id å’Œ create_time åˆ†åˆ«éƒ½<code>åˆ›å»ºç´¢å¼•</code>ï¼Œæ‰§è¡Œä¸‹é¢çš„ SQL æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  student_id,<span class="built_in">count</span>(<span class="operator">*</span>ï¼‰<span class="keyword">as</span> num </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  student_info </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">  student_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> </span><br><span class="line">  create_time <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">100</span>ï¼›</span><br></pre></td></tr></table></figure><p>å‘ç°åªèµ°äº†student_id çš„ç´¢å¼• æ‰§è¡Œæ—¶é—´ 5.212s</p><p>æ·»åŠ è”åˆç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student_info <span class="keyword">ADD</span> INDEX idx_sid_cre_time(student_id,create_time <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure><p>å†æ‰§è¡ŒæŸ¥è¯¢  èŠ±è´¹ 0.257s</p><p>å¦‚æœæˆ‘ä»¬åˆ›å»ºè”åˆç´¢å¼•çš„é¡ºåºä¸º(create_time, student_id) å‘¢ï¼Ÿè¿è¡Œæ—¶é—´ä¸º 2.164sï¼Œå› ä¸ºåœ¨è¿›è¡Œ SELECT æŸ¥è¯¢çš„æ—¶å€™ï¼Œå…ˆè¿›è¡Œ GROUP BYï¼Œå†å¯¹æ•°æ®è¿›è¡Œ ORDER BY çš„æ“ä½œï¼Œæ‰€ä»¥æŒ‰ç…§ (student_id, create_time) è¿™ä¸ªè”åˆç´¢å¼•çš„é¡ºåºæ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-4"><p><span class='p blue'>UPDATEã€DELETE çš„ WHERE æ¡ä»¶åˆ—</span></p><p>å¯¹æ•°æ®æŒ‰ç…§æŸä¸ªæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢åå†è¿›è¡Œ UPDATE æˆ– DELETE çš„æ“ä½œï¼Œå¦‚æœå¯¹ WHERE å­—æ®µåˆ›å»ºäº†ç´¢å¼•ï¼Œå°±èƒ½å¤§å¹…æå‡æ•ˆç‡ã€‚åŸç†æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å…ˆæ ¹æ® WHERE æ¡ä»¶åˆ—æ£€ç´¢å‡ºæ¥è¿™æ¡è®°å½•ï¼Œç„¶åå†å¯¹å®ƒè¿›è¡Œæ›´æ–°æˆ–åˆ é™¤ã€‚<span class='p red'>å¦‚æœè¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œæ›´æ–°çš„å­—æ®µæ˜¯éç´¢å¼•å­—æ®µï¼Œæå‡çš„æ•ˆç‡ä¼šæ›´æ˜æ˜¾ï¼Œè¿™æ˜¯å› ä¸ºéç´¢å¼•å­—æ®µæ›´æ–°ä¸éœ€è¦å¯¹ç´¢å¼•è¿›è¡Œç»´æŠ¤ã€‚</span></p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å¯¹æ•°æ®è¿›è¡Œ UPDATE çš„æƒ…å†µï¼šæˆ‘ä»¬æƒ³è¦æŠŠ name ä¸ºZDUPpf å¯¹åº”çš„ student_id ä¿®æ”¹ä¸º 10002ï¼Œå½“æˆ‘ä»¬æ²¡æœ‰å¯¹name è¿›è¡Œç´¢å¼•çš„æ—¶å€™ï¼Œæ‰§è¡Œ SQL è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> </span><br><span class="line">  student_info </span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">  student_id <span class="operator">=</span> <span class="number">10002</span></span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  name <span class="operator">=</span><span class="string">&#x27;ZDUPpf&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œæ—¶é—´ 0.84s</p><p>æ·»åŠ ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ç»™name ç´¢å¼•åæŸ¥è¯¢</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student_info <span class="keyword">ADD</span> INDEX idx_name(name);</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ—¶é—´ 0.036s</p><p>å¯¹æ•°æ®æŒ‰ç…§æŸä¸ªæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢åå†è¿›è¡Œ UPDATE æˆ– DELETE çš„æ“ä½œï¼Œå¦‚æœå¯¹ WHERE å­—æ®µåˆ›å»ºäº†ç´¢å¼•ï¼Œå°±èƒ½å¤§å¹…æå‡æ•ˆç‡ã€‚åŸç†æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å…ˆæ ¹æ® WHERE æ¡ä»¶åˆ—æ£€ç´¢å‡ºæ¥è¿™æ¡è®°å½•ï¼Œç„¶åå†å¯¹å®ƒè¿›è¡Œæ›´æ–°æˆ–åˆ é™¤ã€‚<span class='p red'>å¦‚æœè¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œæ›´æ–°çš„å­—æ®µæ˜¯éç´¢å¼•å­—æ®µï¼Œæå‡çš„æ•ˆç‡ä¼šæ›´æ˜æ˜¾ï¼Œè¿™æ˜¯å› ä¸ºéç´¢å¼•å­—æ®µæ›´æ–°ä¸éœ€è¦å¯¹ç´¢å¼•è¿›è¡Œç»´æŠ¤ã€‚</span></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-5"><p><span class='p green'>DISTINCT å­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•</span></p><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹æŸä¸ªå­—æ®µè¿›è¡Œå»é‡ï¼Œä½¿ç”¨ DISTINCTï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¹Ÿä¼šæå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢è¯¾ç¨‹è¡¨ä¸­ä¸åŒçš„ student_id éƒ½æœ‰å“ªäº›ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹ student_id åˆ›å»ºç´¢å¼•ï¼Œæ‰§è¡Œ SQL è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(student_id) <span class="keyword">FROM</span>`student_info`;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ˆ600637 æ¡è®°å½•ï¼Œè¿è¡Œæ—¶é—´ 0.683s ï¼‰</p><p>å¦‚æœæˆ‘ä»¬å¯¹ student_id åˆ›å»ºç´¢å¼•ï¼Œå†æ‰§è¡Œ SQL è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(student_id) <span class="keyword">FROM</span>`student_info`;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ˆ600637 æ¡è®°å½•ï¼Œè¿è¡Œæ—¶é—´ 0.010s ï¼‰</p><p>ä½ èƒ½çœ‹åˆ° SQL æŸ¥è¯¢æ•ˆç‡æœ‰äº†æå‡ï¼ŒåŒæ—¶æ˜¾ç¤ºå‡ºæ¥çš„ student_id è¿˜æ˜¯æŒ‰ç…§é€’å¢çš„é¡ºåº è¿›è¡Œå±•ç¤ºçš„ã€‚è¿™æ˜¯å› ä¸ºç´¢å¼•ä¼šå¯¹æ•°æ®æŒ‰ç…§æŸç§é¡ºåºè¿›è¡Œæ’åºï¼Œæ‰€ä»¥åœ¨å»é‡çš„æ—¶å€™ä¹Ÿä¼šå¿«å¾ˆå¤šã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-6"><p><span class='p red'>å¤šè¡¨ JOIN è¿æ¥æ“ä½œæ—¶ï¼Œåˆ›å»ºç´¢å¼•æ³¨æ„äº‹é¡¹</span></p><p>é¦–å…ˆï¼Œ<code>è¿æ¥è¡¨çš„æ•°é‡å°½é‡ä¸è¦è¶…è¿‡ 3 å¼ </code>ï¼Œå› ä¸ºæ¯å¢åŠ ä¸€å¼ è¡¨å°±ç›¸å½“äºå¢åŠ äº†ä¸€æ¬¡åµŒå¥—çš„å¾ªç¯ï¼Œæ•°é‡çº§å¢é•¿ä¼šéå¸¸å¿«ï¼Œä¸¥é‡å½±å“æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p><p>å…¶æ¬¡ï¼Œ<code>å¯¹ WHERE æ¡ä»¶åˆ›å»ºç´¢å¼•</code>ï¼Œå› ä¸º WHERE æ‰æ˜¯å¯¹æ•°æ®æ¡ä»¶çš„è¿‡æ»¤ã€‚å¦‚æœåœ¨æ•°æ®é‡éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œ æ²¡æœ‰ WHERE æ¡ä»¶è¿‡æ»¤æ˜¯éå¸¸å¯æ€•çš„ã€‚</p><p>æœ€åï¼Œ<code>å¯¹ç”¨äºè¿æ¥çš„å­—æ®µåˆ›å»ºç´¢å¼•</code>ï¼Œå¹¶ä¸”è¯¥å­—æ®µåœ¨å¤šå¼ è¡¨ä¸­çš„ ç±»å‹å¿…é¡»ä¸€è‡´ ã€‚æ¯”å¦‚ course_id åœ¨ student_info è¡¨å’Œ course è¡¨ä¸­éƒ½ä¸º int(11) ç±»å‹ï¼Œè€Œä¸èƒ½ä¸€ä¸ªä¸º int å¦ä¸€ä¸ªä¸º varchar ç±»å‹ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬åªå¯¹ student_id åˆ›å»ºç´¢å¼•ï¼Œæ‰§è¡Œ SQL è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s.course_id, name, s.student_id, c.course_name</span><br><span class="line"><span class="keyword">FROM</span> student_info s <span class="keyword">JOIN</span> course c</span><br><span class="line"><span class="keyword">ON</span> s.course_id <span class="operator">=</span> c.course_id</span><br><span class="line"><span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;462eed7ac6e791292a79&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ˆ1 æ¡æ•°æ®ï¼Œè¿è¡Œæ—¶é—´ 0.189s ï¼‰</p><p>è¿™é‡Œæˆ‘ä»¬å¯¹ name åˆ›å»ºç´¢å¼•ï¼Œå†æ‰§è¡Œä¸Šé¢çš„ SQL è¯­å¥ï¼Œè¿è¡Œæ—¶é—´ä¸º 0.002s ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-7"><p><span class='p blue'>ä½¿ç”¨åˆ—çš„ç±»å‹å°çš„åˆ›å»ºç´¢å¼•</span></p><p>æˆ‘ä»¬è¿™é‡Œæ‰€è¯´çš„<code>ç±»å‹å¤§å°</code>æŒ‡çš„å°±æ˜¯è¯¥ç±»å‹è¡¨ç¤ºçš„æ•°æ®èŒƒå›´çš„å¤§å°ã€‚</p><p>æˆ‘ä»¬åœ¨å®šä¹‰è¡¨ç»“æ„çš„æ—¶å€™è¦æ˜¾å¼çš„æŒ‡å®šåˆ—çš„ç±»å‹ï¼Œä»¥æ•´æ•°ç±»å‹ä¸ºä¾‹ï¼Œæœ‰<code>TINYINT</code>ã€<code>MEDTUMIN</code>Tã€<code>INT</code>ã€<code>BIGINT</code>ç­‰ï¼Œå®ƒä»¬å ç”¨çš„å­˜å‚¨ç©ºé—´ä¾æ¬¡é€’å¢ï¼Œèƒ½è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å½“ç„¶ä¹Ÿæ˜¯ä¾æ¬¡é€’å¢ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹æŸä¸ªæ•´æ•°åˆ—å»ºç«‹ç´¢å¼•çš„è¯ï¼Œåœ¨è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å…è®¸çš„æƒ…å†µä¸‹ï¼Œå°½é‡è®©ç´¢å¼•åˆ—ä½¿ç”¨è¾ƒå°çš„ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬èƒ½ä½¿ç”¨ INT å°±ä¸è¦ä½¿ç”¨ BIGINTï¼Œèƒ½ä½¿ç”¨ MEDIUMINT å°±ä¸è¦ä½¿ç”¨ INTã€‚è¿™æ˜¯å› ä¸ºï¼š</p><ul><li><p>æ•°æ®ç±»å‹è¶Šå°ï¼Œåœ¨æŸ¥è¯¢æ—¶è¿›è¡Œçš„æ¯”è¾ƒæ“ä½œè¶Šå¿«</p></li><li><p>æ•°æ®ç±»å‹è¶Šå°ï¼Œç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´å°±è¶Šå°‘ï¼Œåœ¨ä¸€ä¸ªæ•°æ®é¡µå†…å°±å¯ä»¥<code>æ”¾ä¸‹æ›´å¤šçš„è®°å½•</code>ï¼Œä»è€Œå‡å°‘ç£ç›˜I/0å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥æŠŠæ›´å¤šçš„æ•°æ®é¡µç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€ŒåŠ å¿«è¯»å†™æ•ˆç‡ã€‚</p></li></ul><p>è¿™ä¸ªå»ºè®®å¯¹äºè¡¨çš„<code>ä¸»é”®æ¥è¯´æ›´åŠ é€‚ç”¨</code>ï¼Œå› ä¸ºä¸ä»…æ˜¯èšç°‡ç´¢å¼•ä¸­ä¼šå­˜å‚¨ä¸»é”®å€¼ï¼Œå…¶ä»–æ‰€æœ‰çš„äºŒçº§ç´¢å¼•çš„èŠ‚ç‚¹å¤„éƒ½ä¼šå­˜å‚¨ä¸€ä»½è®°å½•çš„ä¸»é”®å€¼ï¼Œå¦‚æœä¸»é”®ä½¿ç”¨æ›´å°çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ„å‘³ç€èŠ‚çœæ›´å¤šçš„å­˜å‚¨ç©ºé—´å’Œæ›´é«˜æ•ˆçš„I/0ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-8"><p><span class='p green'>ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•</span></p><p>å‡è®¾æˆ‘ä»¬çš„å­—ç¬¦ä¸²å¾ˆé•¿ï¼Œé‚£å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ä¸²å°±éœ€è¦å ç”¨å¾ˆå¤§çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨æˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²åˆ—å»ºç«‹ç´¢å¼•æ—¶ï¼Œé‚£å°±æ„å‘³ç€åœ¨å¯¹åº”çš„B+æ ‘ä¸­æœ‰è¿™ä¹ˆä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li><p>B+æ ‘ç´¢å¼•ä¸­çš„è®°å½•éœ€è¦æŠŠè¯¥åˆ—çš„å®Œæ•´å­—ç¬¦ä¸²å­˜å‚¨èµ·æ¥ï¼Œæ›´è´¹æ—¶ã€‚è€Œä¸”å­—ç¬¦ä¸²è¶Šé•¿ï¼Œ<code>åœ¨ç´¢å¼•ä¸­å ç”¨çš„å­˜å‚¨ç©ºé—´è¶Šå¤§</code>ã€‚</p></li><li><p>å¦‚æœB+æ ‘ç´¢å¼•ä¸­ç´¢å¼•åˆ—å­˜å‚¨çš„å­—ç¬¦ä¸²å¾ˆé•¿ï¼Œé‚£åœ¨åšå­—ç¬¦ä¸²<code>æ¯”è¾ƒæ—¶ä¼šå ç”¨æ›´å¤šçš„æ—¶é—´</code>ã€‚</p></li></ul><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æˆªå–å­—æ®µçš„å‰é¢ä¸€éƒ¨åˆ†å†…å®¹å»ºç«‹ç´¢å¼•ï¼Œè¿™ä¸ªå°±å«<code>å‰ç¼€ç´¢å¼•</code>ã€‚è¿™æ ·åœ¨æŸ¥æ‰¾è®°å½•æ—¶è™½ç„¶ä¸èƒ½ç²¾ç¡®çš„å®šä½åˆ°è®°å½•çš„ä½ç½®ï¼Œä½†æ˜¯èƒ½å®šä½åˆ°ç›¸åº”å‰ç¼€æ‰€åœ¨çš„ä½ç½®ï¼Œç„¶åæ ¹æ®å‰ç¼€ç›¸åŒçš„è®°å½•çš„ä¸»é”®å€¼å›è¡¨æŸ¥è¯¢å®Œæ•´çš„å­—ç¬¦ä¸²å€¼ã€‚æ—¢<code>èŠ‚çº¦ç©ºé—´</code>ï¼Œåˆ<code>å‡å°‘äº†å­—ç¬¦ä¸²çš„æ¯”è¾ƒæ—¶é—´</code>ï¼Œè¿˜å¤§ä½“èƒ½è§£å†³æ’åºçš„é—®é¢˜ã€‚</p><p>ä¾‹å¦‚ï¼ŒTEXTå’ŒBL0Gç±»å‹çš„å­—æ®µï¼Œè¿›è¡Œå…¨æ–‡æ£€ç´¢ä¼šå¾ˆæµªè´¹æ—¶é—´ï¼Œå¦‚æœåªæ£€ç´¢å­—æ®µå‰é¢çš„è‹¥å¹²å­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥æé«˜æ£€ç´¢é€Ÿåº¦ã€‚</p><p>åˆ›å»ºä¸€å¼ å•†æˆ·è¡¨ï¼Œå› ä¸ºåœ°å€å­—æ®µæ¯”è¾ƒé•¿ï¼Œåœ¨åœ°å€å­—æ®µä¸Šå»ºç«‹å‰ç¼€ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> shop(address <span class="type">varchar</span>(<span class="number">120</span>) <span class="keyword">not</span> <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> shop <span class="keyword">add</span> index(address(<span class="number">12</span>));</span><br></pre></td></tr></table></figure><p>é—®é¢˜æ˜¯ï¼Œæˆªå–å¤šå°‘å‘¢ï¼Ÿæˆªå–å¾—å¤šäº†ï¼Œè¾¾ä¸åˆ°èŠ‚çœç´¢å¼•å­˜å‚¨ç©ºé—´çš„ç›®çš„ï¼›æˆªå–å¾—å°‘äº†ï¼Œé‡å¤å†…å®¹å¤ªå¤šï¼Œå­—æ®µçš„æ•£åˆ—åº¦(é€‰æ‹©æ€§)ä¼šé™ä½ã€‚æ€ä¹ˆè®¡ç®—ä¸åŒçš„é•¿åº¦çš„é€‰æ‹©æ€§å‘¢ï¼Ÿ</p><p>å…ˆçœ‹ä¸€ä¸‹å­—æ®µåœ¨å…¨éƒ¨æ•°æ®ä¸­çš„é€‰æ‹©åº¦ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> address) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> shop</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸åŒé•¿åº¦å»è®¡ç®—ï¼Œä¸å…¨è¡¨çš„é€‰æ‹©æ€§å¯¹æ¯”ï¼š</p><p>å…¬å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(åˆ—å, ç´¢å¼•é•¿åº¦))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(address,<span class="number">10</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> sub10, <span class="comment">-- æˆªå–å‰10ä¸ªå­—ç¬¦çš„é€‰æ‹©åº¦</span></span><br><span class="line"><span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(address,<span class="number">15</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> sub11, <span class="comment">-- æˆªå–å‰15ä¸ªå­—ç¬¦çš„é€‰æ‹©åº¦</span></span><br><span class="line"><span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(address,<span class="number">20</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> sub12, <span class="comment">-- æˆªå–å‰20ä¸ªå­—ç¬¦çš„é€‰æ‹©åº¦</span></span><br><span class="line"><span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(address,<span class="number">25</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> sub13 <span class="comment">-- æˆªå–å‰25ä¸ªå­—ç¬¦çš„é€‰æ‹©åº¦</span></span><br><span class="line"><span class="keyword">from</span> shop;</span><br></pre></td></tr></table></figure><blockquote><p>è¶Šæ¥è¿‘äº1è¶Šå¥½ï¼Œè¯´æ˜è¶Šæœ‰åŒºåˆ†åº¦</p></blockquote><p><strong>å¼•ç”³å¦ä¸€ä¸ªé—®é¢˜ï¼šç´¢å¼•åˆ—å‰ç¼€å¯¹æ’åºçš„å½±å“</strong></p><p>å¦‚æœä½¿ç”¨äº†ç´¢å¼•åˆ—å‰ç¼€ï¼Œæ¯”æ–¹è¯´å‰è¾¹åªæŠŠaddressåˆ—çš„<code>å‰12ä¸ªå­—ç¬¦</code>æ”¾åˆ°äº†äºŒçº§ç´¢å¼•ä¸­ï¼Œä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢å¯èƒ½å°±æœ‰ç‚¹å°´å°¬äº†ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> shop</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> address</span><br><span class="line">LIMIT <span class="number">12</span>;</span><br></pre></td></tr></table></figure><p>å› ä¸ºäºŒçº§ç´¢å¼•ä¸­ä¸åŒ…å«å®Œæ•´çš„addressåˆ—ä¿¡æ¯ï¼Œæ‰€ä»¥æ— æ³•å¯¹å‰12ä¸ªå­—ç¬¦ç›¸åŒï¼Œåè¾¹çš„å­—ç¬¦ä¸åŒçš„è®°å½•è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ç´¢å¼•åˆ—å‰ç¼€çš„æ–¹å¼<code>æ— æ³•æ”¯æŒä½¿ç”¨ç´¢å¼•æ’åº</code>ï¼Œåªèƒ½ä½¿ç”¨æ–‡ä»¶æ’åºã€‚</p><p><strong>æ‹“å±•ï¼šAlibabaã€ŠJavaå¼€å‘æ‰‹å†Œã€‹</strong></p><p>ã€ å¼ºåˆ¶ ã€‘åœ¨ varchar å­—æ®µä¸Šå»ºç«‹ç´¢å¼•æ—¶ï¼Œå¿…é¡»æŒ‡å®šç´¢å¼•é•¿åº¦ï¼Œæ²¡å¿…è¦å¯¹å…¨å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œæ ¹æ®å®é™…æ–‡æœ¬åŒºåˆ†åº¦å†³å®šç´¢å¼•é•¿åº¦ã€‚</p><p>è¯´æ˜ï¼šç´¢å¼•çš„é•¿åº¦ä¸åŒºåˆ†åº¦æ˜¯ä¸€å¯¹çŸ›ç›¾ä½“ï¼Œä¸€èˆ¬å¯¹å­—ç¬¦ä¸²ç±»å‹æ•°æ®ï¼Œé•¿åº¦ä¸º 20 çš„ç´¢å¼•ï¼ŒåŒºåˆ†åº¦ä¼šé«˜è¾¾ 90% ä»¥ä¸Š ï¼Œå¯ä»¥ä½¿ç”¨ count(distinct left(åˆ—å, ç´¢å¼•é•¿åº¦))/count(*)çš„åŒºåˆ†åº¦æ¥ç¡®å®šã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-9"><p><span class='p red'>åŒºåˆ†åº¦é«˜(æ•£åˆ—æ€§é«˜)çš„åˆ—é€‚åˆä½œä¸ºç´¢å¼•</span></p><p><code>åˆ—çš„åŸºæ•°</code>æŒ‡çš„æ˜¯æŸä¸€åˆ—ä¸­ä¸é‡å¤æ•°æ®çš„ä¸ªæ•°ï¼Œæ¯”æ–¹è¯´æŸä¸ªåˆ—åŒ…å«å€¼<code>2, 5, 8, 2, 5, 8, 2, 5, 8</code>ï¼Œè™½ç„¶æœ‰<code>9</code>æ¡è®°å½•ï¼Œä½†è¯¥åˆ—çš„åŸºæ•°å´æ˜¯3ã€‚ä¹Ÿå°±æ˜¯è¯´<code>åœ¨è®°å½•è¡Œæ•°ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œåˆ—çš„åŸºæ•°è¶Šå¤§ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šåˆ†æ•£ï¼›åˆ—çš„åŸºæ•°è¶Šå°ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šé›†ä¸­ã€‚</code>è¿™ä¸ªåˆ—çš„åŸºæ•°æŒ‡æ ‡éå¸¸é‡è¦ï¼Œç›´æ¥å½±å“æˆ‘ä»¬æ˜¯å¦èƒ½æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ã€‚æœ€å¥½ä¸ºåˆ—çš„åŸºæ•°å¤§çš„åˆ—ç®€å†ç´¢å¼•ï¼Œä¸ºåŸºæ•°å¤ªå°çš„åˆ—çš„ç®€å†ç´¢å¼•æ•ˆæœå¯èƒ½ä¸å¥½ã€‚</p><p>å¯ä»¥ä½¿ç”¨å…¬å¼<code>select count(distinct a) / count(*) from t1</code>è®¡ç®—åŒºåˆ†åº¦ï¼Œè¶Šæ¥è¿‘1è¶Šå¥½ï¼Œä¸€èˆ¬è¶…è¿‡33%å°±ç®—æ¯”è¾ƒé«˜æ•ˆçš„ç´¢å¼•äº†ã€‚</p><p>æ‰©å±•ï¼šè”åˆç´¢å¼•æŠŠåŒºåˆ†åº¦æ(æ•£åˆ—æ€§é«˜)çš„åˆ—æ”¾åœ¨å‰é¢ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-10"><p><span class='p blue'>ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§</span></p><p>è¿™æ ·ä¹Ÿå¯ä»¥è¾ƒå°‘çš„å»ºç«‹ä¸€äº›ç´¢å¼•ã€‚åŒæ—¶ï¼Œç”±äº&quot;æœ€å·¦å‰ç¼€åŸåˆ™&quot;ï¼Œå¯ä»¥å¢åŠ è”åˆç´¢å¼•çš„ä½¿ç”¨ç‡ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="001b5ebd-73a5-4b51-9870-47614b415977-11"><p><span class='p green'>åœ¨å¤šä¸ªå­—æ®µéƒ½è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•</span></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="5-3-é™åˆ¶ç´¢å¼•çš„æ•°ç›®">5.3 é™åˆ¶ç´¢å¼•çš„æ•°ç›®</h3><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ³¨æ„å¹³è¡¡ï¼Œç´¢å¼•çš„æ•°ç›®ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚æˆ‘ä»¬éœ€è¦é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼Œå»ºè®®å•å¼ è¡¨ç´¢å¼•æ•°é‡<code>ä¸è¶…è¿‡6ä¸ª</code>ã€‚åŸå› ï¼š</p><p>â— æ¯ä¸ªç´¢å¼•éƒ½éœ€è¦å ç”¨<code>ç£ç›˜ç©ºé—´</code>ï¼Œç´¢å¼•è¶Šå¤šï¼Œéœ€è¦çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§ã€‚</p><p>â‘¡ ç´¢å¼•ä¼šå½±å“<code>INSERT</code>ã€<code>DELETE</code>ã€<code>UPDATE</code>ç­‰è¯­å¥çš„æ€§èƒ½ï¼Œå› ä¸ºè¡¨ä¸­çš„æ•°æ®æ›´æ”¹çš„åŒæ—¶ï¼Œç´¢å¼•ä¹Ÿä¼šè¿›è¡Œè°ƒæ•´å’Œæ›´æ–°ï¼Œä¼šé€ æˆè´Ÿæ‹…ã€‚</p><p>â‘¢ ä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„<code>ç´¢å¼•ä¾†è¿›è¡Œè¯„ä¼°</code>ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºæŸ¥è¯¢ï¼Œä¼šå¢åŠ MySQLä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ—¶é—´ï¼Œé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</p><hr><h3 id="5-4-å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•">5.4 å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•</h3><div class="tabs" id="854de219-f278-4797-adb3-a38373cae1e9"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#854de219-f278-4797-adb3-a38373cae1e9-1"><i class="fas fa-baseball-ball"></i>2</button></li><li class="tab"><button type="button" data-href="#854de219-f278-4797-adb3-a38373cae1e9-2"><i class="fas fa-bone"></i>3</button></li><li class="tab"><button type="button" data-href="#854de219-f278-4797-adb3-a38373cae1e9-3"><i class="fas fa-anchor"></i>4</button></li><li class="tab"><button type="button" data-href="#854de219-f278-4797-adb3-a38373cae1e9-4"><i class="fas fa-fire-alt"></i>5</button></li><li class="tab"><button type="button" data-href="#854de219-f278-4797-adb3-a38373cae1e9-5"><i class="fas fa-bug"></i>6</button></li><li class="tab"><button type="button" data-href="#854de219-f278-4797-adb3-a38373cae1e9-6"><i class="fas fa-cannabis"></i>7</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="854de219-f278-4797-adb3-a38373cae1e9-1"><p><span class='p green'>æ•°æ®é‡å°çš„è¡¨æœ€å¥½ä¸è¦ä½¿ç”¨ç´¢å¼•</span></p><p>å¦‚æœè¡¨è®°å½•å¤ªå°‘ï¼Œæ¯”å¦‚å°‘äº1000ä¸ªï¼Œé‚£ä¹ˆæ˜¯ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„ã€‚è¡¨è®°å½•å¤ªå°‘ï¼Œæ˜¯å¦åˆ›å»ºç´¢å¼•<code>å¯¹æŸ¥è¯¢æ•ˆç‡çš„å½±å“å¹¶ä¸å¤§</code>ã€‚ç”šè‡³è¯´ï¼ŒæŸ¥è¯¢èŠ±è´¹çš„æ—¶é—´å¯èƒ½æ¯”éå†ç´¢å¼•çš„æ—¶é—´è¿˜è¦çŸ­ï¼Œç´¢å¼•å¯èƒ½ä¸ä¼šäº§ç”Ÿä¼˜åŒ–æ•ˆæœã€‚</p><p>ä¸¾ä¾‹ï¼šåˆ›å»ºè¡¨1ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_without_index(</span><br><span class="line">a <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">b <span class="type">INT</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æä¾›å­˜å‚¨è¿‡ç¨‹1ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> t_wout_insert()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;=</span> <span class="number">900</span></span><br><span class="line">    DO</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_without_index(b) <span class="keyword">SELECT</span> RAND()<span class="operator">*</span><span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">#è°ƒç”¨</span><br><span class="line"><span class="keyword">CALL</span> t_wout_insert()</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè¡¨2ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_with_index(</span><br><span class="line">a <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">b <span class="type">INT</span>,</span><br><span class="line">INDEX idx_b(b)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹2ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> t_with_insert()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;=</span> <span class="number">900</span></span><br><span class="line">    DO</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_with_index(b) <span class="keyword">SELECT</span> RAND()<span class="operator">*</span><span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">#è°ƒç”¨</span><br><span class="line"><span class="keyword">CALL</span> t_with_insert();</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å¯¹æ¯”ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_without_index <span class="keyword">where</span> b <span class="operator">=</span> <span class="number">9879</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="operator">|</span> a    <span class="operator">|</span> b    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1242</span> <span class="operator">|</span> <span class="number">9879</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_with_index <span class="keyword">where</span> b <span class="operator">=</span> <span class="number">9879</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+------+</span></span><br><span class="line"><span class="operator">|</span> a   <span class="operator">|</span> b    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">112</span> <span class="operator">|</span> <span class="number">9879</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ä½ èƒ½çœ‹åˆ°è¿è¡Œç»“æœç›¸åŒï¼Œä½†æ˜¯åœ¨æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œç´¢å¼•å°±å‘æŒ¥ä¸å‡ºä½œç”¨äº†ã€‚</p><blockquote><p>ç»“è®ºï¼šåœ¨æ•°æ®è¡¨ä¸­çš„æ•°æ®è¡Œæ•°æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä¸åˆ° 1000 è¡Œï¼Œæ˜¯ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="854de219-f278-4797-adb3-a38373cae1e9-2"><p><span class='p red'>æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—ä¸Šä¸è¦å»ºç«‹ç´¢å¼•</span></p><p>åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ç»å¸¸ç”¨åˆ°çš„ä¸åŒå€¼è¾ƒå¤šçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ï¼Œä½†å­—æ®µä¸­å¦‚æœæœ‰å¤§é‡é‡å¤æ•°æ®ï¼Œä¹Ÿä¸ç”¨åˆ›å»ºç´¢å¼•ã€‚æ¯”å¦‚åœ¨å­¦ç”Ÿè¡¨çš„&quot;æ€§åˆ«&quot;å­—æ®µä¸Šåªæœ‰â€œç”·â€ä¸â€œå¥³â€ä¸¤ä¸ªä¸åŒå€¼ï¼Œå› æ­¤æ— é¡»å»ºç«‹ç´¢å¼•ã€‚å¦‚æœå»ºç«‹ç´¢å¼•ï¼Œä¸ä½†ä¸ä¼šæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œåè€Œä¼š<code>ä¸¥é‡é™ä½æ•°æ®æ›´æ–°é€Ÿåº¦</code>ã€‚</p><p>ä¸¾ä¾‹1ï¼šè¦åœ¨ 100 ä¸‡è¡Œæ•°æ®ä¸­æŸ¥æ‰¾å…¶ä¸­çš„ 50 ä¸‡è¡Œï¼ˆæ¯”å¦‚æ€§åˆ«ä¸ºç”·çš„æ•°æ®ï¼‰ï¼Œä¸€æ—¦åˆ›å»ºäº†ç´¢å¼•ï¼Œä½ éœ€è¦å…ˆè®¿é—® 50 ä¸‡æ¬¡ç´¢å¼•ï¼Œç„¶åå†è®¿é—® 50 ä¸‡æ¬¡æ•°æ®è¡¨ï¼Œè¿™æ ·åŠ èµ·æ¥çš„å¼€é”€æ¯”ä¸ä½¿ç”¨ç´¢å¼•å¯èƒ½è¿˜è¦å¤§ã€‚</p><p>ä¸¾ä¾‹2ï¼šå‡è®¾æœ‰ä¸€ä¸ªå­¦ç”Ÿè¡¨ï¼Œå­¦ç”Ÿæ€»æ•°ä¸º 100 ä¸‡äººï¼Œç”·æ€§åªæœ‰ 10 ä¸ªäººï¼Œä¹Ÿå°±æ˜¯å æ€»äººå£çš„ 10 ä¸‡åˆ†ä¹‹ 1ã€‚</p><p>å­¦ç”Ÿè¡¨ student_gender ç»“æ„å¦‚ä¸‹ã€‚å…¶ä¸­æ•°æ®è¡¨ä¸­çš„ student_gender å­—æ®µå–å€¼ä¸º 0 æˆ– 1ï¼Œ0 ä»£è¡¨å¥³æ€§ï¼Œ1 ä»£è¡¨ç”·æ€§ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student_gender(</span><br><span class="line">    student_id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    student_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    student_gender TINYINT(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(student_id)</span><br><span class="line">)ENGINE <span class="operator">=</span> INNODB;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è¦ç­›é€‰å‡ºè¿™ä¸ªå­¦ç”Ÿè¡¨ä¸­çš„ç”·æ€§ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student_gender <span class="keyword">WHERE</span> student_gender <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“è®ºï¼šå½“æ•°æ®é‡å¤åº¦å¤§ï¼Œæ¯”å¦‚ é«˜äº 10% çš„æ—¶å€™ï¼Œä¹Ÿä¸éœ€è¦å¯¹è¿™ä¸ªå­—æ®µä½¿ç”¨ç´¢å¼•ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="854de219-f278-4797-adb3-a38373cae1e9-3"><p><span class='p blue'>é¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•</span></p><p>ç¬¬ä¸€å±‚å«ä¹‰ï¼šé¢‘ç¹æ›´æ–°çš„å­—æ®µä¸ä¸€å®šè¦åˆ›å»ºç´¢å¼•ã€‚å› ä¸ºæ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ›´æ–°ç´¢å¼•ï¼Œå¦‚æœç´¢å¼•å¤ªå¤šï¼Œåœ¨æ›´æ–°ç´¢å¼•çš„æ—¶å€™ä¹Ÿä¼šé€ æˆè´Ÿæ‹…ï¼Œä»è€Œå½±å“æ•ˆç‡ã€‚</p><p>ç¬¬äºŒå±‚å«ä¹‰ï¼šé¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•ï¼Œå¹¶ä¸”ç´¢å¼•ä¸­çš„åˆ—å°½å¯èƒ½å°‘ã€‚æ­¤æ—¶ï¼Œè™½ç„¶æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´é™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="854de219-f278-4797-adb3-a38373cae1e9-4"><p><span class='p green'>ä¸å»ºè®®ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼•</span></p><p>ä¾‹å¦‚èº«ä»½è¯ã€UUID(åœ¨ç´¢å¼•æ¯”è¾ƒæ—¶éœ€è¦è½¬ä¸ºASCIIï¼Œå¹¶ä¸”æ’å…¥æ—¶å¯èƒ½é€ æˆé¡µåˆ†è£‚)ã€MD5ã€HASHã€æ— åºé•¿å­—ç¬¦ä¸²ç­‰ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="854de219-f278-4797-adb3-a38373cae1e9-5"><p><span class='p red'>åˆ é™¤ä¸å†ä½¿ç”¨æˆ–è€…å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•</span></p><p>è¡¨ä¸­çš„æ•°æ®è¢«å¤§é‡æ›´æ–°ï¼Œæˆ–è€…æ•°æ®çš„ä½¿ç”¨æ–¹å¼è¢«æ”¹å˜åï¼ŒåŸæœ‰çš„ä¸€äº›ç´¢å¼•å¯èƒ½ä¸å†éœ€è¦ã€‚æ•°æ®åº“ç®¡ç†å‘˜åº”å½“å®šæœŸæ‰¾å‡ºè¿™äº›ç´¢å¼•ï¼Œå°†å®ƒä»¬åˆ é™¤ï¼Œä»è€Œå‡å°‘ç´¢å¼•å¯¹æ›´æ–°æ“ä½œçš„å½±å“ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="854de219-f278-4797-adb3-a38373cae1e9-6"><p><span class='p blue'>ä¸è¦å®šä¹‰å¤¯ä½™æˆ–é‡å¤çš„ç´¢å¼•</span></p><p>â‘  å†—ä½™ç´¢å¼•</p><p>ä¸¾ä¾‹ï¼šå»ºè¡¨è¯­å¥å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person_info(</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    birthday <span class="type">DATE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    phone_number <span class="type">CHAR</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    country <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    KEY idx_name_birthday_phone_number (name(<span class="number">10</span>), birthday, phone_number),</span><br><span class="line">    KEY idx_name (name(<span class="number">10</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡ idx_name_birthday_phone_number ç´¢å¼•å°±å¯ä»¥å¯¹ name åˆ—è¿›è¡Œå¿«é€Ÿæœç´¢ï¼Œå†åˆ›å»ºä¸€ ä¸ªä¸“é—¨é’ˆå¯¹ name åˆ—çš„ç´¢å¼•å°±ç®—æ˜¯ä¸€ä¸ªå†—ä½™ç´¢å¼• ï¼Œç»´æŠ¤è¿™ä¸ªç´¢å¼•åªä¼šå¢åŠ ç»´æŠ¤çš„æˆæœ¬ï¼Œå¹¶ä¸ä¼šå¯¹æœç´¢æœ‰ä»€ä¹ˆå¥½å¤„ã€‚</p><p>â‘¡ é‡å¤ç´¢å¼•</p><p>å¦ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¯¹æŸä¸ªåˆ— é‡å¤å»ºç«‹ç´¢å¼• ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> repeat_index_demo (</span><br><span class="line">col1 <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">col2 <span class="type">INT</span>,</span><br><span class="line"><span class="keyword">UNIQUE</span> uk_idx_c1 (col1),</span><br><span class="line">INDEX idx_c1 (col1)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œcol1 æ—¢æ˜¯ä¸»é”®ã€åˆç»™å®ƒå®šä¹‰ä¸ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œè¿˜ç»™å®ƒå®šä¹‰äº†ä¸€ä¸ªæ™®é€šç´¢å¼•ï¼Œå¯æ˜¯ä¸»é”®æœ¬èº«å°±ä¼šç”Ÿæˆèšç°‡ç´¢å¼•ï¼Œæ‰€ä»¥å®šä¹‰çš„å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•æ˜¯é‡å¤çš„ï¼Œè¿™ç§æƒ…å†µè¦é¿å…ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <blockquote><p>å°ç»“</p></blockquote><p>ç´¢å¼•æ˜¯ä¸€æŠŠ<code>åŒåˆƒå‰‘</code>ï¼Œå¯æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†ä¹Ÿä¼šé™ä½æ’å…¥æ‰£æ›´æ–°çš„é€Ÿåº¦å¹¶å ç”¨ç£ç›˜ç©ºé—´ã€‚</p><p>é€‰æ‹©ç´¢å¼•çš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†ä½¿æŸ¥è¯¢çš„é€Ÿåº¦å˜å¿«ï¼Œä¸Šé¢ç»™å‡ºçš„åŸåˆ™æ˜¯æœ€åŸºæœ¬çš„å‡†åˆ™ï¼Œä½†ä¸èƒ½æ‹˜æ³¥äºä¸Šé¢çš„å‡†åˆ™ï¼Œå¤§å®¶è¦åœ¨ä»¥åçš„å­¦ä¹ å’Œå·¥ä½œä¸­è¿›è¡Œä¸æ–­çš„å®è·µï¼Œæ ¹æ®åº”ç”¨çš„å®é™…æƒ…å†µè¿›è¡Œåˆ†æå’Œåˆ¤æ–­ï¼Œé€‰æ‹©æœ€åˆé€‚çš„ç´¢å¼•æ–¹å¼ã€‚</p>]]></content>
    
    
    <summary type="html">ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨ã€MySQL8.0ç´¢å¼•æ–°ç‰¹æ€§ã€å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•ã€å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>InnoDBæ•°æ®å­˜å‚¨ç»“æ„</title>
    <link href="https://wuwawawa.github.io/posts/de6e5e9c.html"/>
    <id>https://wuwawawa.github.io/posts/de6e5e9c.html</id>
    <published>2023-04-09T06:51:11.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-æ•°æ®åº“çš„å­˜å‚¨ç»“æ„-é¡µ">1. æ•°æ®åº“çš„å­˜å‚¨ç»“æ„:é¡µ</h2><p>ç´¢å¼•ç»“æ„ç»™æˆ‘ä»¬æä¾›äº†é«˜æ•ˆçš„ç´¢å¼•æ–¹å¼ï¼Œä¸è¿‡ç´¢å¼•ä¿¡æ¯ä»¥åŠæ•°æ®è®°å½•éƒ½æ˜¯ä¿å­˜åœ¨æ–‡ä»¶ä¸Šçš„ï¼Œç¡®åˆ‡è¯´æ˜¯å­˜å‚¨åœ¨é¡µç»“æ„ä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“ä¸­å®ç°çš„ï¼ŒMySQLæœåŠ¡å™¨ä¸Šçš„<code>å­˜å‚¨å¼•æ“</code>è´Ÿè´£å¯¹è¡¨ä¸­æ•°æ®çš„è¯»å–å’Œå†™å…¥å·¥ä½œã€‚</p><p>ä¸åŒå­˜å‚¨å¼•æ“ä¸­<code>å­˜æ”¾çš„æ ¼å¼</code>ä¸€èˆ¬æ˜¯ä¸åŒçš„ï¼Œç”šè‡³æœ‰çš„å­˜å‚¨å¼•æ“æ¯”å¦‚Memoryéƒ½ä¸ç”¨ç£ç›˜æ¥å­˜å‚¨æ•°æ®ã€‚</p><p>ç”±äº<code>InnoDB</code>æ˜¯MySQLçš„<code>é»˜è®¤å­˜å‚¨å¼•æ“</code>ï¼Œæ‰€ä»¥æœ¬ç« å‰–æInnoDBå­˜å‚¨å¼•æ“çš„æ•°æ®å­˜å‚¨ç»“æ„ã€‚</p><blockquote><span class='p green'>ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½:é¡µ</span></blockquote><p>InnoDB å°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼ŒInnoDBä¸­é¡µçš„å¤§å°é»˜è®¤ä¸º<code>16KB</code>ã€‚</p><p>ä»¥<code>é¡µ</code>ä½œä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„<code>åŸºæœ¬å•ä½</code>ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å–16KBçš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„16KBå†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class='p red'>åœ¨æ•°æ®åº“ä¸­ï¼Œä¸è®ºè¯»ä¸€è¡Œï¼Œè¿˜æ˜¯è¯»å¤šè¡Œï¼Œéƒ½æ˜¯å°†è¿™äº›è¡Œæ‰€åœ¨çš„é¡µè¿›è¡ŒåŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åº“ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼ˆPageï¼‰ï¼Œæ•°æ®åº“I/0æ“ä½œçš„æœ€å°å•ä½æ˜¯é¡µã€‚</span>ä¸€ä¸ªé¡µä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªè¡Œè®°å½•ã€‚</p><blockquote><p>è®°å½•æ˜¯æŒ‰ç…§è¡Œæ¥å­˜å‚¨çš„ï¼Œä½†æ˜¯æ•°æ®åº“çš„è¯»å–å¹¶ä¸ä»¥è¡Œä¸ºå•ä½ï¼Œå¦åˆ™ä¸€æ¬¡è¯»å–ï¼ˆä¹Ÿå°±æ˜¯ä¸€æ¬¡ I0 æ“ä½œï¼‰åªèƒ½å¤„ç†ä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡ä¼šéå¸¸ä½ã€‚</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409152821598.png" alt="image-20230409152821598" style="zoom: 67%;" /><div class="tabs" id="9c4d584f-fd53-4896-a2da-0e2d42e4d72f"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#9c4d584f-fd53-4896-a2da-0e2d42e4d72f-1"><i class="fas fa-cat"></i>é¡µç»“æ„æ¦‚è¿°</button></li><li class="tab"><button type="button" data-href="#9c4d584f-fd53-4896-a2da-0e2d42e4d72f-2"><i class="fas fa-horse"></i>é¡µçš„å¤§å°</button></li><li class="tab"><button type="button" data-href="#9c4d584f-fd53-4896-a2da-0e2d42e4d72f-3"><i class="fas fa-dove"></i>é¡µçš„ä¸Šå±‚ç»“æ„</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="9c4d584f-fd53-4896-a2da-0e2d42e4d72f-1"><p>é¡µaã€é¡µbã€é¡µcâ€¦é¡µn è¿™äº›é¡µå¯ä»¥<code>ä¸åœ¨ç‰©ç†ç»“æ„ä¸Šç›¸è¿</code>ï¼Œåªè¦é€šè¿‡<code>åŒå‘é“¾è¡¨</code>ç›¸å…³è”å³å¯ã€‚æ¯ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•ä¼šæŒ‰ç…§ä¸»é”®å€¼ä»å°åˆ°å¤§çš„é¡ºåºç»„æˆä¸€ä¸ª<code>å•å‘é“¾è¡¨</code>ï¼Œæ¯ä¸ªæ•°æ®é¡µéƒ½ä¼šä¸ºå­˜å‚¨åœ¨å®ƒé‡Œè¾¹çš„è®°å½•ç”Ÿæˆä¸€ä¸ªé¡µç›®å½•ï¼Œåœ¨é€šè¿‡ä¸»é”®æŸ¥æ‰¾æŸæ¡è®°å½•çš„æ—¶å€™å¯ä»¥åœ¨é¡µç›®å½•ä¸­<code>ä½¿ç”¨äºŒåˆ†æ³•</code>å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9c4d584f-fd53-4896-a2da-0e2d42e4d72f-2"><p>ä¸åŒçš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆç®€ç§°DBMSï¼‰çš„é¡µå¤§å°ä¸åŒã€‚æ¯”å¦‚åœ¨ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œé»˜è®¤é¡µçš„å¤§å°æ˜¯<code>16KB</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è¿›è¡ŒæŸ¥çœ‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%innodb_page_size%&#x27;</span></span><br></pre></td></tr></table></figure><p>SQL Server ä¸­é¡µçš„å¤§å°ä¸º<code>8KB</code>ï¼Œè€Œåœ¨ Oracle ä¸­æˆ‘ä»¬ç”¨æœ¯è¯­ â€œ<code>å—</code>â€ ï¼ˆBlockï¼‰æ¥è¡¨ç¤º â€œé¡µâ€ï¼ŒOracle æ”¯æŒçš„å—å¤§å°ä¸º2KB, 4KB, 8KB, 16KB, 32KB å’Œ 64KBã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="9c4d584f-fd53-4896-a2da-0e2d42e4d72f-3"><p>å¦å¤–åœ¨æ•°æ®åº“ä¸­ï¼Œè¿˜å­˜åœ¨ç€åŒºï¼ˆExtentï¼‰ã€æ®µï¼ˆSegmentï¼‰å’Œè¡¨ç©ºé—´ï¼ˆTablespaceï¼‰çš„æ¦‚å¿µã€‚è¡Œã€é¡µã€åŒºã€æ®µã€è¡¨ç©ºé—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409151428168.png" alt="image-20230409151428168" style="zoom:50%;" /><p>åŒºï¼ˆExtentï¼‰æ˜¯æ¯”é¡µå¤§ä¸€çº§çš„å­˜å‚¨ç»“æ„ï¼Œåœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œä¸€ä¸ªåŒºä¼šåˆ†é…<code>64 ä¸ªè¿ç»­çš„é¡µ</code>ã€‚å› ä¸º InnoDB ä¸­çš„é¡µå¤§å°é»˜è®¤æ˜¯ 16KBï¼Œæ‰€ä»¥ä¸€ä¸ªåŒºçš„å¤§å°æ˜¯64*16KB=<code>1MB</code>ã€‚</p><p>æ®µ(Segmentï¼‰ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒºç»„æˆï¼ŒåŒºåœ¨æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªè¿ç»­åˆ†é…çš„ç©ºé—´ï¼ˆåœ¨InnoDB ä¸­æ˜¯è¿ç»­çš„ 64ä¸ªé¡µï¼‰ï¼Œ ä¸è¿‡åœ¨æ®µä¸­ä¸è¦æ±‚åŒºä¸åŒºä¹‹é—´æ˜¯ç›¸é‚»çš„ã€‚<code>æ®µæ˜¯æ•°æ®åº“ä¸­çš„åˆ†é…å•ä½ï¼Œä¸åŒç±»å‹çš„æ•°æ®åº“å¯¹è±¡ä»¥ä¸åŒçš„æ®µå½¢å¼å­˜åœ¨</code>ã€‚å½“æˆ‘ä»¬åˆ›å»ºæ•°æ®è¡¨ã€ç´¢å¼•çš„æ—¶å€™ï¼Œå°±ä¼šç›¸åº”åˆ›å»ºå¯¹åº”çš„æ®µï¼Œæ¯”å¦‚åˆ›å»ºä¸€å¼ è¡¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªè¡¨æ®µï¼Œåˆ›å»ºä¸€ä¸ªç´¢å¼•æ—¶ä¼šåˆ›å»ºä¸€ä¸ªç´¢å¼•æ®µã€‚</p><p>è¡¨ç©ºé—´ï¼ˆTablespaceï¼‰æ˜¯ä¸€ä¸ªé€»è¾‘å®¹å™¨ï¼Œè¡¨ç©ºé—´å­˜å‚¨çš„å¯¹è±¡æ˜¯æ®µï¼Œåœ¨ä¸€ä¸ªè¡¨ç©ºé—´ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ®µï¼Œä½†æ˜¯ä¸€ä¸ªæ®µåªèƒ½å±äºä¸€ä¸ªè¡¨ç©ºé—´ã€‚æ•°æ®åº“ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ç©ºé—´ç»„æˆï¼Œè¡¨ç©ºé—´ä»ç®¡ç†ä¸Šå¯ä»¥åˆ’åˆ†ä¸º<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>ã€<code>ç”¨æˆ·è¡¨ç©ºé—´</code>ã€<code>æ’¤é”€è¡¨ç©ºé—´</code>ã€<code>ä¸´æ—¶è¡¨ç©ºé—´</code>ç­‰ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-é¡µçš„å†…éƒ¨ç»“æ„">2. é¡µçš„å†…éƒ¨ç»“æ„</h2><p>é¡µå¦‚æœæŒ‰ç±»å‹åˆ’åˆ†çš„è¯ï¼Œå¸¸è§çš„æœ‰<code>æ•°æ®é¡µï¼ˆä¿å­˜B+æ ‘èŠ‚ç‚¹ï¼‰ã€ç³»ç»Ÿè¡¨ã€Undo é¡µ å’Œ äº‹åŠ¡æ•°æ®é¡µ</code>ç­‰ã€‚æ•°æ®é¡µæ˜¯æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„é¡µã€‚</p><p>æ•°æ®é¡µçš„<code>16KB</code>å¤§å°çš„å­˜å‚¨ç©ºé—´è¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯æ–‡ä»¶å¤´ï¼ˆFile Headerï¼‰ã€é¡µå¤´ï¼ˆPage Headerï¼‰ã€æœ€å¤§æœ€å°è®°å½•ï¼ˆInfimum + supremumï¼‰ã€ç”¨æˆ·è®°å½•ï¼ˆUser Recordsï¼‰ã€ç©ºé—²ç©ºé—´ï¼ˆFree Spaceï¼‰ã€é¡µç›®å½•ï¼ˆPage Directoryï¼‰å’Œæ–‡ä»¶å°¾ï¼ˆFile Tailerï¼‰ã€‚</p><p>é¡µç»“æ„çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617195012446.png" alt="image-20220617195012446" style="float: right; zoom: 75%;margin-top:85px;" /> <table><thead><tr><th style="text-align:center">åç§°</th><th style="text-align:center">å ç”¨å¤§å°</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">File Header</td><td style="text-align:center">38å­—èŠ‚</td><td style="text-align:center">æ–‡ä»¶å¤´ï¼Œæè¿°é¡µçš„ä¿¡æ¯</td></tr><tr><td style="text-align:center">Page Header</td><td style="text-align:center">56å­—èŠ‚</td><td style="text-align:center">é¡µå¤´ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯</td></tr><tr><td style="text-align:center">Infimum + Supremum</td><td style="text-align:center">26å­—èŠ‚</td><td style="text-align:center">æœ€å¤§å’Œæœ€å°è®°å½•ï¼Œè¿™æ˜¯ä¸¤ä¸ªè™šæ‹Ÿçš„è¡Œè®°å½•</td></tr><tr><td style="text-align:center">User Records</td><td style="text-align:center">ä¸ç¡®å®š</td><td style="text-align:center">ç”¨æˆ·è®°å½•ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹</td></tr><tr><td style="text-align:center">Free Space</td><td style="text-align:center">ä¸ç¡®å®š</td><td style="text-align:center">ç©ºé—²è®°å½•ï¼Œé¡µä¸­è¿˜æ²¡æœ‰è¢«ä½¿ç”¨çš„ç©ºé—´</td></tr><tr><td style="text-align:center">Page Directory</td><td style="text-align:center">ä¸ç¡®å®š</td><td style="text-align:center">é¡µç›®å½•ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®</td></tr><tr><td style="text-align:center">File Trailer</td><td style="text-align:center">8å­—èŠ‚</td><td style="text-align:center">æ–‡ä»¶å°¾ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´</td></tr></tbody></table><p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™7ä¸ªç»“æ„åˆ†ä¸º3ä¸ªéƒ¨åˆ†ã€‚</p><h3 id="2-1-ç¬¬ä¸€éƒ¨åˆ†">2.1 ç¬¬ä¸€éƒ¨åˆ†</h3><p>é¦–å…ˆæ˜¯æ–‡ä»¶é€šç”¨éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯File Header (æ–‡ä»¶å¤´) å’Œ File Trailer (æ–‡ä»¶å°¾)ã€‚<div class="tabs" id="49833921-320e-41f6-8b41-d7d62c2cd0e3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#49833921-320e-41f6-8b41-d7d62c2cd0e3-1"><i class="fas fa-seedling"></i>File Header</button></li><li class="tab"><button type="button" data-href="#49833921-320e-41f6-8b41-d7d62c2cd0e3-2"><i class="fas fa-cannabis"></i>å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å±æ€§</button></li><li class="tab"><button type="button" data-href="#49833921-320e-41f6-8b41-d7d62c2cd0e3-3"><i class="fas fa-leaf"></i>File Trailer</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="49833921-320e-41f6-8b41-d7d62c2cd0e3-1"><p>ä½œç”¨ï¼š</p><p>æè¿°å„ç§é¡µçš„é€šç”¨ä¿¡æ¯ã€‚ï¼ˆæ¯”å¦‚é¡µçš„ç¼–å·ã€å…¶ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µæ˜¯è°ç­‰ï¼‰</p><p>å¤§å°ï¼š38å­—èŠ‚</p><p>æ„æˆï¼š</p><table><thead><tr><th style="text-align:center">åç§°</th><th style="text-align:center">å ç”¨ç©ºé—´å¤§å°</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">FIL_PAGE_SPACE_OR_CHKSUM</td><td style="text-align:center">4å­—èŠ‚</td><td style="text-align:center">é¡µçš„æ ¡éªŒå’Œ (checksumå€¼ï¼‰</td></tr><tr><td style="text-align:center">FIL_PAGE_OFFSET</td><td style="text-align:center">4å­—èŠ‚</td><td style="text-align:center">é¡µå·</td></tr><tr><td style="text-align:center">FIL_PAGE_ PREV</td><td style="text-align:center">4å­—èŠ‚</td><td style="text-align:center">ä¸Šä¸€ä¸ªé¡µçš„é¡µå·</td></tr><tr><td style="text-align:center">FIL_PAGE_NEXT</td><td style="text-align:center">4å­—èŠ‚</td><td style="text-align:center">ä¸‹ä¸€ä¸ªé¡µçš„é¡µå·</td></tr><tr><td style="text-align:center">FIL_ PAGE_ LSN</td><td style="text-align:center">8å­—èŠ‚</td><td style="text-align:center">é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®</td></tr><tr><td style="text-align:center">FIL_PAGE_TYPE</td><td style="text-align:center">2å­—èŠ‚</td><td style="text-align:center">è¯¥é¡µçš„ç±»å‹</td></tr><tr><td style="text-align:center">FIL_ PAGE_FILE_ FLUSH_LSN</td><td style="text-align:center">8å­—èŠ‚</td><td style="text-align:center">ä»…åœ¨ç³»ç»Ÿè¡¨ç©ºé—´çš„ä¸€ä¸ªé¡µä¸­å®šä¹‰ï¼Œä»£è¡¨æ–‡ä»¶è‡³å°‘è¢«åˆ·æ–°åˆ°äº†å¯¹åº”çš„LSNå€¼</td></tr><tr><td style="text-align:center">FIL_PAGE_ARCH_LOG_ NO_OR_SPACE_ID</td><td style="text-align:center">4å­—èŠ‚</td><td style="text-align:center">é¡µå±äºå“ªä¸ªè¡¨ç©ºé—´</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="49833921-320e-41f6-8b41-d7d62c2cd0e3-2"><blockquote><p>FIL_PAGE_SPACE_OR_CHKSUM</p></blockquote><p>æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ä»€ä¹ˆæ˜¯æ ¡éªŒå’Œï¼Ÿå°±æ˜¯å¯¹äºä¸€ä¸ªå¾ˆé•¿çš„å­—èŠ‚ä¸²æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æŸç§ç®—æ³•æ¥è®¡ç®—ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„å€¼æ¥ä»£è¡¨è¿™ä¸ªå¾ˆé•¿çš„å­—èŠ‚ä¸²ï¼Œè¿™ä¸ªæ¯”è¾ƒçŸ­çš„å€¼å°±ç§°ä¸ºæ ¡éªŒå’Œã€‚åœ¨æ¯”è¾ƒä¸¤ä¸ªå¾ˆé•¿çš„å­—èŠ‚ä¸²ä¹‹å‰ï¼Œå…ˆæ¯”è¾ƒè¿™ä¸¤ä¸ªé•¿å­—èŠ‚ä¸²çš„æ ¡éªŒå’Œï¼Œå¦‚æœæ ¡éªŒå’Œéƒ½ä¸ä¸€æ ·ï¼Œåˆ™ä¸¤ä¸ªé•¿å­—èŠ‚ä¸²è‚¯å®šæ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥çœå»äº†ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªæ¯”è¾ƒé•¿çš„å­—èŠ‚ä¸²çš„æ—¶é—´æŸè€—ã€‚ æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨éƒ½æœ‰å±æ€§ï¼šFIL_PAGE_SPACE_OR_CHKSUM ä½œç”¨ï¼šInnoDBå­˜å‚¨å¼•æ“ä»¥é¡µä¸ºå•ä½æŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­å¤„ç†ï¼Œå¦‚æœè¯¥é¡µä¸­çš„æ•°æ®åœ¨å†…å­˜ä¸­è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹åçš„æŸä¸ªæ—¶é—´éœ€è¦æŠŠæ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸­ã€‚ä½†æ˜¯åœ¨åŒæ­¥äº†ä¸€åŠçš„æ—¶å€™æ–­ç”µäº†ï¼Œé€ æˆäº†è¯¥é¡µä¼ è¾“çš„ä¸å®Œæ•´ã€‚ä¸ºäº†æ£€æµ‹ä¸€ä¸ªé¡µæ˜¯å¦å®Œæ•´ï¼ˆä¹Ÿå°±æ˜¯åœ¨åŒæ­¥çš„æ—¶å€™æœ‰æ²¡æœ‰å‘ç”ŸåªåŒæ­¥ä¸€åŠçš„å°´å°¬æƒ…å†µï¼‰ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡æ–‡ä»¶å°¾çš„æ ¡éªŒå’Œï¼ˆchecksum å€¼ï¼‰ä¸æ–‡ä»¶å¤´çš„æ ¡éªŒå’Œåšæ¯”å¯¹ï¼Œå¦‚æœä¸¤ä¸ªå€¼ä¸ç›¸ç­‰åˆ™è¯æ˜é¡µçš„ä¼ è¾“æœ‰é—®é¢˜ï¼Œéœ€è¦é‡æ–°è¿›è¡Œä¼ è¾“ï¼Œå¦åˆ™è®¤ä¸ºé¡µçš„ä¼ è¾“å·²ç»å®Œæˆã€‚</p><p>å…·ä½“çš„ï¼šæ¯å½“ä¸€ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­ä¿®æ”¹äº†ï¼Œåœ¨åŒæ­¥ä¹‹å‰å°±è¦æŠŠå®ƒçš„æ ¡éªŒå’Œç®—å‡ºæ¥ï¼Œå› ä¸ºFile Headeråœ¨é¡µé¢çš„å‰è¾¹ï¼Œæ‰€ä»¥æ ¡éªŒå’Œä¼šè¢«é¦–å…ˆåŒæ­¥åˆ°ç£ç›˜ï¼Œå½“å®Œå…¨å†™å®Œæ—¶ï¼Œæ ¡éªŒå’Œä¹Ÿä¼šè¢«å†™åˆ°é¡µçš„å°¾éƒ¨ï¼Œå¦‚æœå®Œå…¨åŒæ­¥æˆåŠŸï¼Œåˆ™é¡µçš„é¦–éƒ¨å’Œå°¾éƒ¨çš„æ ¡éªŒå’Œåº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœå†™äº†ä¸€åŠå„¿æ–­ç”µäº†ï¼Œé‚£ä¹ˆåœ¨File Headerä¸­çš„æ ¡éªŒå’Œå°±ä»£è¡¨ç€å·²ç»ä¿®æ”¹è¿‡çš„é¡µï¼Œè€Œåœ¨File Trailerä¸­çš„æ ¡éªŒå’Œä»£è¡¨ç€åŸå…ˆçš„é¡µï¼ŒäºŒè€…ä¸åŒåˆ™æ„å‘³ç€åŒæ­¥ä¸­é—´å‡ºäº†é”™ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚</p><blockquote><p>FIL_PAGE_TYPE</p></blockquote><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409163530049.png" alt="image-20230409163530049"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="49833921-320e-41f6-8b41-d7d62c2cd0e3-3"><p>8ä¸ªå­—èŠ‚</p><ul><li><p>å‰4ä¸ªå­—èŠ‚ä»£è¡¨é¡µçš„æ ¡éªŒå’Œï¼š</p><p>è¿™ä¸ªéƒ¨åˆ†æ˜¯å’ŒFile Headerä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚</p></li><li><p>å4ä¸ªå­—èŠ‚ä»£è¡¨é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®ï¼ˆLSN)ï¼š</p><p>è¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼Œå¦‚æœé¦–éƒ¨å’Œå°¾éƒ¨çš„LSNå€¼æ ¡éªŒä¸æˆåŠŸçš„è¯ï¼Œå°±è¯´æ˜åŒæ­¥è¿‡ç¨‹å‡ºç°äº†é—®é¢˜ã€‚</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></p><h3 id="2-2-ç¬¬äºŒéƒ¨åˆ†">2.2 ç¬¬äºŒéƒ¨åˆ†</h3><p>ç¬¬äºŒä¸ªéƒ¨åˆ†æ˜¯è®°å½•éƒ¨åˆ†ï¼Œé¡µçš„ä¸»è¦ä½œç”¨æ˜¯å­˜å‚¨è®°å½•ï¼Œæ‰€ä»¥â€œæœ€å¤§å’Œæœ€å°è®°å½•â€å’Œâ€œç”¨æˆ·è®°å½•â€éƒ¨åˆ†å äº†é¡µç»“æ„çš„ä¸»è¦ç©ºé—´ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409163754316.png" alt="image-20230409163754316" style="zoom:50%;" /><div class="tabs" id="81a654d0-8167-4513-81b1-bb54eb07e29c"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#81a654d0-8167-4513-81b1-bb54eb07e29c-1"><i class="fas fa-bug"></i>ç©ºé—²ç©ºé—´</button></li><li class="tab"><button type="button" data-href="#81a654d0-8167-4513-81b1-bb54eb07e29c-2"><i class="fas fa-cannabis"></i>ç”¨æˆ·è®°å½•</button></li><li class="tab"><button type="button" data-href="#81a654d0-8167-4513-81b1-bb54eb07e29c-3"><i class="fas fa-candy-cane"></i>æœ€å¤§æœ€å°è®°å½•</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="81a654d0-8167-4513-81b1-bb54eb07e29c-1"><p>æˆ‘ä»¬è‡ªå·±å­˜å‚¨çš„è®°å½•ä¼šæŒ‰ç…§æŒ‡å®šçš„<code>è¡Œæ ¼å¼</code>å­˜å‚¨åˆ°<code>User Records</code>éƒ¨åˆ†ã€‚ä½†æ˜¯åœ¨ä¸€å¼€å§‹ç”Ÿæˆé¡µçš„æ—¶å€™ï¼Œå…¶å®å¹¶æ²¡æœ‰User Recordsè¿™ä¸ªéƒ¨åˆ†ï¼Œ<span class='p green'>æ¯å½“æˆ‘ä»¬æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä»Free Spaceéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å°šæœªä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ä¸­ç”³è¯·ä¸€ä¸ªè®°å½•å¤§å°çš„ç©ºé—´åˆ’åˆ†åˆ°User Recordséƒ¨åˆ†</span>ï¼Œå½“Free Spaceéƒ¨åˆ†çš„ç©ºé—´å…¨éƒ¨è¢«User Recordséƒ¨åˆ†æ›¿ä»£æ‰ä¹‹åï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªé¡µä½¿ç”¨å®Œäº†ï¼Œå¦‚æœè¿˜æœ‰æ–°çš„è®°å½•æ’å…¥çš„è¯ï¼Œå°±éœ€è¦å»ç”³è¯·æ–°çš„é¡µäº†ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409164404762.png" alt="image-20230409164404762"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="81a654d0-8167-4513-81b1-bb54eb07e29c-2"><p>User Recordsä¸­çš„è¿™äº›è®°å½•æŒ‰ç…§<code>æŒ‡å®šçš„è¡Œæ ¼å¼</code>ä¸€æ¡ä¸€æ¡æ‘†åœ¨User Recordséƒ¨åˆ†ï¼Œç›¸äº’ä¹‹é—´å½¢æˆ<code>å•é“¾è¡¨</code>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="81a654d0-8167-4513-81b1-bb54eb07e29c-3"><p><span class='p red'>è®°å½•å¯ä»¥æ¯”è¾ƒå¤§å°å—ï¼Ÿ</span></p><p>æ˜¯çš„ï¼Œè®°å½•å¯ä»¥æ¯”å¤§å°ï¼Œå¯¹äºä¸€æ¡å®Œæ•´çš„è®°å½•æ¥è¯´ï¼Œæ¯”è¾ƒè®°å½•çš„å¤§å°å°±æ˜¯æ¯”è¾ƒä¸»é”®çš„å¤§å°æ¯”æ–¹è¯´æˆ‘ä»¬æ’å…¥çš„4è¡Œè®°å½•çš„ä¸»é”®å€¼åˆ†åˆ«æ˜¯ï¼š1ã€2ã€3ã€4ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™4æ¡è®°å½•æ˜¯ä»å°åˆ°å¤§ä¾æ¬¡é€’å¢ã€‚</p><p>InnoDBè§„å®šçš„æœ€å°è®°å½•ä¸æœ€å¤§è®°å½•è¿™ä¸¤æ¡è®°å½•çš„æ„é€ ååˆ†ç®€å•ï¼Œéƒ½æ˜¯ç”±5å­—èŠ‚å¤§å°çš„è®°å½•å¤´ä¿¡æ¯å’Œ8å­—èŠ‚å¤§å°çš„ä¸€ä¸ªå›ºå®šçš„éƒ¨åˆ†ç»„æˆçš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409171901669.png" alt="image-20230409171901669"></p><p>è¿™ä¸¤æ¡è®°å½•ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„è®°å½•ï¼Œæ‰€ä»¥å®ƒä»¬å¹¶ä¸å­˜æ”¾åœ¨é¡µçš„User Recordséƒ¨åˆ†ï¼Œä»–ä»¬è¢«å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç§°ä¸ºInfimum + Supremumçš„éƒ¨åˆ†</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="2-3-ç¬¬ä¸‰éƒ¨åˆ†">2.3 ç¬¬ä¸‰éƒ¨åˆ†</h3><h4 id="2-3-1-Page-Directory-é¡µç›®å½•">2.3.1 Page Directory é¡µç›®å½•</h4><p>ä¸ºä»€ä¹ˆéœ€è¦é¡µç›®å½•ï¼Ÿ</p><p>åœ¨é¡µä¸­ï¼Œè®°å½•æ˜¯ä»¥<code>å•å‘é“¾è¡¨</code>çš„å½¢å¼è¿›è¡Œå­˜å‚¨çš„ã€‚å•å‘é“¾è¡¨çš„ç‰¹ç‚¹å°±æ˜¯æ’å…¥ã€åˆ é™¤éå¸¸æ–¹ä¾¿ ï¼Œä½†æ˜¯<code>æ£€ç´¢æ•ˆç‡ä¸é«˜</code>ï¼Œæœ€å·®çš„æƒ…è®°ä¸‹éœ€è¦éå†é“¾è¡¨ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹æ‰èƒ½å®Œæˆæ£€ç´¢ã€‚å› æ­¤åœ¨é¡µç»“æ„ä¸­ä¸“é—¨è®¾è®¡äº†é¡µç›®å½•è¿™ä¸ªæ¨¡å—ï¼Œ<span class='p red'>ä¸“é—¨ç»™è®°å½•åšä¸€ä¸ªç›®å½•</span>ï¼Œé€šè¿‡<code>äºŒåˆ†æŸ¥æ‰¾æ³•</code>çš„æ–¹å¼è¿›è¡Œæ£€ç´¢ï¼Œæå‡æ•ˆç‡ã€‚</p><p>é¡µç›®å½•å¦‚ä½•å®ç°å¿«é€ŸæŸ¥æ‰¾å‘¢ï¼Ÿ</p><p><code>SELECT * FROM page_demo WHERE c1 = 3;</code></p><ol><li><p>å°†æ‰€æœ‰çš„è®°å½•åˆ†æˆå‡ ä¸ªç»„ï¼Œè¿™äº›è®°å½•åŒ…æ‹¬æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ï¼Œä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºâ€œå·²åˆ é™¤â€çš„è®°å½•ã€‚</p></li><li><p>ç¬¬1ç»„ï¼Œä¹Ÿå°±æ˜¯æœ€å°è®°å½•æ‰€åœ¨çš„åˆ†ç»„åªæœ‰ 1ä¸ªè®°å½•ï¼›<br>æœ€åä¸€ç»„ï¼Œå°±æ˜¯æœ€å¤§è®°å½•æ‰€åœ¨çš„åˆ†ç»„ï¼Œä¼šæœ‰1-8 æ¡è®°å½•ï¼š<br>å…¶ä½™çš„ç»„è®°å½•æ•°é‡åœ¨ 4-8 æ¡ä¹‹é—´ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œé™¤äº†ç¬¬ 1ç»„ï¼ˆæœ€å°è®°å½•æ‰€åœ¨ç»„ï¼‰ä»¥å¤–ï¼Œå…¶ä½™ç»„çš„è®°å½•æ•°ä¼š<span class='p blue'>å°½é‡å¹³åˆ†</span>ã€‚</p></li><li><p>åœ¨æ¯ä¸ªç»„ä¸­æœ€åä¸€æ¡è®°å½•çš„å¤´ä¿¡æ¯ä¸­ä¼šå­˜å‚¨è¯¥ç»„ä¸€å…±æœ‰å¤šå°‘æ¡è®°å½•ï¼Œä½œä¸º n_owned å­—æ®µã€‚</p></li><li><span class='p blue'>é¡µç›®å½•ç”¨æ¥å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡</span>ï¼Œè¿™äº›åœ°å€åç§»é‡ä¼šæŒ‰ç…§å…ˆåé¡ºåºå­˜å‚¨èµ·æ¥ï¼Œæ¯ç»„çš„åœ°å€åç§»é‡ä¹Ÿè¢«ç§°ä¹‹ä¸º<span class='p blue'>æ§½ï¼ˆslotï¼‰</span>ï¼Œæ¯ä¸ªæ§½ç›¸å½“äºæŒ‡é’ˆæŒ‡å‘äº†ä¸åŒç»„çš„æœ€åä¸€ä¸ªè®°å½•ã€‚</li></ol><p>ç°åœ¨å‘page_demoè¡¨ä¸­æ·»åŠ æ›´å¤šçš„æ•°æ®ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> page_demo <span class="keyword">VALUES</span>(<span class="number">5</span>, <span class="number">500</span>, <span class="string">&#x27;zhou&#x27;</span>), (<span class="number">6</span>, <span class="number">600</span>, <span class="string">&#x27;chen&#x27;</span>), (<span class="number">7</span>, <span class="number">700</span>, <span class="string">&#x27;deng&#x27;</span>), (<span class="number">8</span>, <span class="number">800</span>, <span class="string">&#x27;yang&#x27;</span>), (<span class="number">9</span>, <span class="number">900</span>, <span class="string">&#x27;wang&#x27;</span>), (<span class="number">10</span>, <span class="number">1000</span>, <span class="string">&#x27;zhao&#x27;</span>), (<span class="number">11</span>, <span class="number">1100</span>, <span class="string">&#x27;qian&#x27;</span>), (<span class="number">12</span>, <span class="number">1200</span>, <span class="string">&#x27;feng&#x27;</span>), (<span class="number">13</span>, <span class="number">1300</span>, <span class="string">&#x27;tang&#x27;</span>), (<span class="number">14</span>, <span class="number">1400</span>, <span class="string">&#x27;ding&#x27;</span>), (<span class="number">15</span>, <span class="number">1500</span>, <span class="string">&#x27;jing&#x27;</span>), (<span class="number">16</span>, <span class="number">1600</span>, <span class="string">&#x27;quan&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ·»åŠ äº†12æ¡è®°å½•ï¼Œç°åœ¨é¡µé‡Œä¸€å…±æœ‰18æ¡è®°å½•äº†ï¼ˆåŒ…æ‹¬æœ€å°å’Œæœ€å¤§è®°å½•ï¼‰ï¼Œè¿™äº›è®°å½•è¢«åˆ†æˆäº†5ä¸ªç»„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409175556862.png" alt="image-20230409175556862" style="zoom:67%;" /><p>è¿™é‡Œåªä¿ç•™äº†16æ¡è®°å½•çš„è®°å½•å¤´ä¿¡æ¯ä¸­çš„n_ownedå’Œnext_recordå±æ€§ï¼Œçœç•¥äº†å„ä¸ªè®°å½•ä¹‹é—´çš„ç®­å¤´ã€‚ç°åœ¨çœ‹æ€ä¹ˆä»è¿™ä¸ªé¡µç›®å½•ä¸­æŸ¥æ‰¾è®°å½•ã€‚</p><p>å› ä¸ºå„ä¸ªæ§½ä»£è¡¨çš„è®°å½•çš„ä¸»é”®å€¼éƒ½æ˜¯ä»å°åˆ°å¤§æ’åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•æ¥è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ã€‚5ä¸ªæ§½çš„ç¼–å·åˆ†åˆ«æ˜¯ï¼š0ã€1ã€2ã€3ã€4ï¼Œæ‰€ä»¥åˆå§‹æƒ…å†µä¸‹æœ€ä½çš„æ§½å°±æ˜¯low=0ï¼Œæœ€é«˜çš„æ§½å°±æ˜¯high=4ã€‚</p><p>æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æ‰¾ä¸»é”®å€¼ä¸º6çš„è®°å½•ï¼Œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>è®¡ç®—ä¸­é—´æ§½çš„ä½ç½®ï¼š(0+4)/2=2ï¼Œæ‰€ä»¥æŸ¥çœ‹æ§½2å¯¹åº”è®°å½•çš„ä¸»é”®å€¼ä¸º8ï¼Œåˆå› ä¸º8 &gt; 6ï¼Œæ‰€ä»¥è®¾ç½®high=2ï¼Œlowä¿æŒä¸å˜ã€‚</li><li>é‡æ–°è®¡ç®—ä¸­é—´æ§½çš„ä½ç½®ï¼š(0+2)/2=1ï¼Œæ‰€ä»¥æŸ¥çœ‹æ§½1å¯¹åº”çš„ä¸»é”®å€¼ä¸º4ï¼Œåˆå› ä¸º4 &lt; 6ï¼Œæ‰€ä»¥è®¾ç½®low=1ï¼Œhighä¿æŒä¸å˜ã€‚</li><li>å› ä¸ºhigh - lowçš„å€¼ä¸º1ï¼Œæ‰€ä»¥ç¡®å®šä¸»é”®å€¼ä¸º6çš„è®°å½•åœ¨æ§½2å¯¹åº”çš„ç»„ä¸­ã€‚æ­¤åˆ»æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ§½2ä¸­ä¸»é”®å€¼æœ€å°çš„é‚£æ¡è®°å½•ï¼Œç„¶åæ²¿ç€å•å‘é“¾è¡¨éå†æ§½2ä¸­çš„è®°å½•ã€‚</li></ol><p>ä½†æ˜¯æˆ‘ä»¬å‰è¾¹åˆè¯´è¿‡ï¼Œæ¯ä¸ªæ§½å¯¹åº”çš„è®°å½•éƒ½æ˜¯è¯¥ç»„ä¸­ä¸»é”®å€¼æœ€å¤§çš„è®°å½•ï¼Œè¿™é‡Œæ§½2å¯¹åº”çš„è®°å½•æ˜¯ä¸»é”®å€¼ä¸º8çš„è®°å½•ï¼Œæ€ä¹ˆå®šä½ä¸€ä¸ªç»„ä¸­æœ€å°çš„è®°å½•å‘¢ï¼Ÿåˆ«å¿˜äº†å„ä¸ªæ§½éƒ½æ˜¯æŒ¨ç€çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“çš„æ‹¿åˆ°æ§½1å¯¹åº”çš„è®°å½•ï¼ˆä¸»é”®å€¼ä¸º4ï¼‰ï¼Œè¯¥æ¡è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯æ§½2ä¸­ä¸»é”®å€¼æœ€å°çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ä¸»é”®å€¼ä¸º5ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»è¿™æ¡ä¸»é”®å€¼ä¸º5çš„è®°å½•å‡ºå‘ï¼Œéå†æ§½2ä¸­çš„å„æ¡è®°å½•ï¼Œç›´åˆ°æ‰¾åˆ°ä¸»é”®å€¼ä¸º6çš„é‚£æ¡è®°å½•å³å¯ã€‚ç”±äºä¸€ä¸ªç»„ä¸­åŒ…å«çš„è®°å½•æ¡æ•°åªèƒ½æ˜¯1~8æ¡ï¼Œæ‰€ä»¥éå†ä¸€ä¸ªç»„ä¸­çš„è®°å½•çš„ä»£ä»·æ˜¯å¾ˆå°çš„ã€‚</p><p>å°ç»“ï¼šåœ¨ä¸€ä¸ªæ•°æ®é¡µä¸­æŸ¥æ‰¾æŒ‡å®šä¸»é”®å€¼çš„è®°å½•çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼š1. é€šè¿‡äºŒåˆ†æ³•ç¡®å®šè¯¥è®°å½•æ‰€åœ¨çš„æ§½ï¼Œå¹¶æ‰¾åˆ°è¯¥æ§½æ‰€åœ¨åˆ†ç»„ä¸­ä¸»é”®å€¼æœ€å°çš„é‚£æ¡è®°å½•ã€‚2. é€šè¿‡è®°å½•çš„next_recordå±æ€§éå†è¯¥æ§½æ‰€åœ¨çš„ç»„ä¸­çš„å„ä¸ªè®°å½•ã€‚</p><hr><h4 id="2-3-2-Page-Header-é¡µé¢å¤´éƒ¨">2.3.2 Page Header é¡µé¢å¤´éƒ¨</h4><p>ä¸ºäº†èƒ½å¾—åˆ°ä¸€ä¸ªæ•°æ®é¡µä¸­å­˜å‚¨çš„è®°å½•çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬é¡µä¸­å·±ç»å­˜å‚¨äº†å¤šå°‘æ¡è®°å½•ï¼Œç¬¬ä¸€æ¡è®°å½•çš„åœ°å€æ˜¯ä»€ä¹ˆï¼Œé¡µç›®å½•ä¸­å­˜å‚¨äº†å¤šå°‘ä¸ªæ§½ç­‰ç­‰ï¼Œç‰¹æ„åœ¨é¡µä¸­å®šä¹‰äº†ä¸€ä¸ªå«Page Headerçš„éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†å ç”¨å›ºå®šçš„56ä¸ªå­—èŠ‚ï¼Œä¸“é—¨å­˜å‚¨å„ç§çŠ¶æ€ä¿¡æ¯ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409180014674.png" alt="image-20230409180014674" style="zoom:67%;" /><hr><h2 id="3-ä»æ•°æ®åº“é¡µè§’åº¦çœ‹B-æ ‘å¦‚ä½•æŸ¥è¯¢">3. ä»æ•°æ®åº“é¡µè§’åº¦çœ‹B+æ ‘å¦‚ä½•æŸ¥è¯¢</h2><p>ä¸€é¢—B+æ ‘æŒ‰ç…§å­—èŠ‚ç±»å‹å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li>å¶å­èŠ‚ç‚¹ï¼ŒB+ æ ‘æœ€åº•å±‚çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„é«˜åº¦ä¸º0ï¼Œå­˜å‚¨è¡Œè®°å½•ã€‚</li><li>éå¶å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„é«˜åº¦å¤§äº0ï¼Œå­˜å‚¨ç´¢å¼•é”®å’Œé¡µé¢æŒ‡é’ˆï¼Œå¹¶ä¸å­˜å‚¨è¡Œè®°å½•æœ¬èº«ã€‚</li></ol><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220620221112635.png" alt="image-20220620221112635"></p><p>å½“æˆ‘ä»¬ä»é¡µç»“æ„æ¥ç†è§£ B+ æ ‘çš„ç»“æ„çš„æ—¶å€™ï¼Œå¯ä»¥å¸®æˆ‘ä»¬ç†è§£ä¸€äº›é€šè¿‡ç´¢å¼•è¿›è¡Œæ£€ç´¢çš„åŸç†ï¼š</p><span class='p red'>1. B+ æ ‘æ˜¯å¦‚ä½•è¿›è¡Œè®°å½•æ£€ç´¢çš„ï¼Ÿ</span><p>å¦‚æœé€šè¿‡ B+ æ ‘çš„ç´¢å¼•æŸ¥è¯¢è¡Œè®°å½•ï¼Œé¦–å…ˆæ˜¯ä»B+æ ‘çš„æ ¹å¼€å§‹ï¼Œé€å±‚æ£€ç´¢ï¼Œç›´åˆ°æ‰¾åˆ°å¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°å¯¹åº”çš„æ•°æ®é¡µä¸ºæ­¢ï¼Œå°†æ•°æ®é¡µåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œé¡µç›®å½•ä¸­çš„æ§½ï¼ˆslotï¼‰é‡‡ç”¨<code>äºŒåˆ†æŸ¥æ‰¾</code>çš„æ–¹å¼å…ˆæ‰¾åˆ°ä¸€ä¸ªç²—ç•¥çš„è®°å½•åˆ†ç»„ï¼Œ ç„¶åå†åœ¨åˆ†ç»„ä¸­é€šè¿‡<code>é“¾è¡¨éå†</code>çš„æ–¹å¼æŸ¥æ‰¾è®°å½•ã€‚</p><span class='p red'>2.æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åœ¨æŸ¥è¯¢æ•ˆç‡ä¸Šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</span><p>æˆ‘ä»¬åˆ›å»ºç´¢å¼•çš„æ—¶å€™å¯ä»¥æ˜¯æ™®é€šç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç´¢å¼•åœ¨æŸ¥è¯¢æ•ˆç‡ä¸Šæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><p>å”¯ä¸€ç´¢å¼•å°±æ˜¯åœ¨æ™®é€šç´¢å¼•ä¸Šå¢åŠ äº†çº¦æŸæ€§ï¼Œä¹Ÿå°±æ˜¯å…³é”®å­—å”¯ä¸€ï¼Œæ‰¾åˆ°äº†å…³é”®å­—å°±åœæ­¢æ£€ç´¢ã€‚è€Œæ™®é€šç´¢å¼•ï¼Œå¯èƒ½ä¼šå­˜åœ¨ç”¨æˆ·è®°å½•ä¸­çš„å…³é”®å­—ç›¸åŒçš„æƒ…å†µï¼Œæ ¹æ®é¡µç»“æ„çš„åŸç†ï¼Œå½“æˆ‘ä»¬è¯»å–ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸æ˜¯å•ç‹¬å°†è¿™æ¡è®°å½•ä»ç£ç›˜ä¸­è¯»å‡ºå»ï¼Œè€Œæ˜¯å°†è¿™ä¸ªè®°å½•æ‰€åœ¨çš„é¡µåŠ è½½åˆ°å†…å­˜ä¸­è¿›è¡Œè¯»å–ã€‚InnoDB å­˜å‚¨å¼•|æ“çš„é¡µå¤§å°ä¸º 16KBï¼Œåœ¨ä¸€ä¸ªé¡µä¸­å¯èƒ½å­˜å‚¨ç€ä¸Šå¹²ä¸ªè®°å½•ï¼Œå› æ­¤åœ¨æ™®é€šç´¢å¼•çš„å­—æ®µä¸Šè¿›è¡ŒæŸ¥æ‰¾ä¹Ÿå°±æ˜¯åœ¨å†…å­˜ä¸­å¤šå‡ æ¬¡&quot;åˆ¤æ–­ä¸‹ä¸€æ¡è®°å½•â€çš„æ“ä½œï¼Œ å¯¹äº CPU æ¥è¯´ï¼Œè¿™äº›æ“ä½œæ‰€æ¶ˆè€—çš„æ—¶é—´æ˜¯å¯ä»¥å¿½è·¯ä¸è®¡çš„ã€‚æ‰€ä»¥å¯¹ä¸€ä¸ªç´¢å¼•å­—æ®µè¿›è¡Œæ£€ç´¢ï¼Œé‡‡ç”¨æ™®é€šç´¢å¼•è¿˜æ˜¯å”¯ä¸€ç´¢å¼•åœ¨æ£€ç´¢æ•ˆç‡ä¸ŠåŸºæœ¬ä¸Šæ²¡æœ‰å·®åˆ«ã€‚</p><hr><h2 id="4-InnoDBè¡Œæ ¼å¼">4. InnoDBè¡Œæ ¼å¼</h2><p>æˆ‘ä»¬å¹³æ—¶çš„æ•°æ®ä»¥è¡Œä¸ºå•ä½æ¥å‘è¡¨ä¸­æ’å…¥æ•°æ®ï¼Œè¿™äº›è®°å½•åœ¨ç£ç›˜ä¸Šçš„å­˜æ”¾æ–¹å¼ä¹Ÿè¢«ç§°ä¸ºè¡Œæ ¼å¼æˆ–è€…è®°å½•æ ¼å¼ã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“è®¾è®¡äº†4ç§ä¸åŒç±»å‹çš„è¡Œæ ¼å¼ï¼Œåˆ†åˆ«æ˜¯<code>Compact</code>ã€<code>Redundant</code>ã€<code>Dynamic</code>å’Œ<code>Compressed</code>è¡Œæ ¼å¼ã€‚</p><p>æŸ¥çœ‹MySQL8çš„é»˜è®¤è¡Œæ ¼å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> @<span class="variable">@innodb</span>_default_row_format;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@innodb</span>_default_row_format         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">dynamic</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec) </span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­æ³•æŸ¥çœ‹å…·ä½“è¡¨ä½¿ç”¨çš„è¡Œæ ¼å¼ï¼š<code>SHOW TABLE STATUS like 'è¡¨å'\G </code></p><p><span id="jump"></span></p><hr><h3 id="4-1-è®°å½•å¤´ä¿¡æ¯">4.1 è®°å½•å¤´ä¿¡æ¯</h3><blockquote><span class='p blue'>å…ˆæ¥çœ‹çœ‹å››ç§ä¸åŒç±»å‹çš„è¡Œæ ¼å¼ä¸­éƒ½å«æœ‰çš„-è®°å½•å¤´ä¿¡æ¯</span></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_demo( </span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span>     c1 <span class="type">INT</span>,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span>     c2 <span class="type">INT</span>,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span>     c3 <span class="type">VARCHAR</span>(<span class="number">10000</span>),</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">PRIMARY</span> KEY (c1))</span><br><span class="line">CHARSET<span class="operator">=</span>ascii ROW_FORMAT<span class="operator">=</span>Compact;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec) </span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¡¨ä¸­è®°å½•çš„è¡Œæ ¼å¼ç¤ºæ„å›¾ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409165644134.png" alt="image-20230409165644134" style="zoom:50%;" /><span class='p green'>ç®€åŒ–åçš„è¡Œæ ¼å¼ç¤ºæ„å›¾ï¼š</span><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409165817074.png" alt="image-20230409165817074" style="zoom:50%;" /><p>æ’å…¥æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> page_demo <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="number">100</span>, &quot;song&quot;),</span><br><span class="line">(<span class="number">2</span>, <span class="number">200</span>, &quot;tong&quot;),</span><br><span class="line">(<span class="number">3</span>, <span class="number">300</span>, &quot;zhan&quot;),</span><br><span class="line">(<span class="number">4</span>, <span class="number">400</span>, &quot;isi&quot;);</span><br></pre></td></tr></table></figure><p>å›¾ç¤ºå¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409170119841.png" alt="image-20230409170119841" style="zoom:67%;" /><p>è¿™äº›è®°å½•å¤´ä¿¡æ¯ä¸­å„ä¸ªå±æ€§å¦‚ä¸‹ï¼š</p><div class="tabs" id="ce6e463d-7384-4053-be86-c9941aac665b"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ce6e463d-7384-4053-be86-c9941aac665b-1"><i class="fas fa-award"></i>å±æ€§</button></li><li class="tab"><button type="button" data-href="#ce6e463d-7384-4053-be86-c9941aac665b-2"><i class="fas fa-baseball-ball"></i>delete_mask</button></li><li class="tab"><button type="button" data-href="#ce6e463d-7384-4053-be86-c9941aac665b-3"><i class="fas fa-bone"></i>min-rec_mask</button></li><li class="tab"><button type="button" data-href="#ce6e463d-7384-4053-be86-c9941aac665b-4"><i class="fas fa-anchor"></i>record_type</button></li><li class="tab"><button type="button" data-href="#ce6e463d-7384-4053-be86-c9941aac665b-5"><i class="fas fa-bug"></i>heap_no</button></li><li class="tab"><button type="button" data-href="#ce6e463d-7384-4053-be86-c9941aac665b-6"><i class="fas fa-cannabis"></i>next_record</button></li><li class="tab"><button type="button" data-href="#ce6e463d-7384-4053-be86-c9941aac665b-7"><i class="fas fa-seedling"></i>æ·»åŠ åˆ é™¤</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ce6e463d-7384-4053-be86-c9941aac665b-1"><table><thead><tr><th style="text-align:center">åç§°</th><th style="text-align:center">å¤§å°</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">é¢„ç•™ä½1</td><td style="text-align:center">1bit</td><td style="text-align:center">æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td style="text-align:center">é¢„ç•™ä½2</td><td style="text-align:center">1bit</td><td style="text-align:center">æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td style="text-align:center">delete_mask</td><td style="text-align:center">1bit</td><td style="text-align:center">æ ‡è®°è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤</td></tr><tr><td style="text-align:center">min-rec_mask</td><td style="text-align:center">1bit</td><td style="text-align:center">B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°</td></tr><tr><td style="text-align:center">n_owned</td><td style="text-align:center">4bits</td><td style="text-align:center">è¡¨ç¤ºå½“å‰è®°å½•æ‹¥æœ‰çš„è®°å½•æ•°</td></tr><tr><td style="text-align:center">heap_no</td><td style="text-align:center">13bits</td><td style="text-align:center">è¡¨ç¤ºå½“å‰è®°å½•åœ¨è®°å½•å †çš„ä½ç½®ä¿¡æ¯</td></tr><tr><td style="text-align:center">record_type</td><td style="text-align:center">3bits</td><td style="text-align:center">è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹</td></tr><tr><td style="text-align:center">next_record</td><td style="text-align:center">16bits</td><td style="text-align:center">è¡¨ç¤ºä¸‹ä¸€æ¡è®°å½•çš„ç›¸å¯¹ä½ç½®</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ce6e463d-7384-4053-be86-c9941aac665b-2"><p>è¿™ä¸ªå±æ€§æ ‡è®°ç€å½“å‰è®°å½•æ˜¯å¦è¢«åˆ é™¤ï¼Œå ç”¨1ä¸ªäºŒè¿›åˆ¶ä½ã€‚</p><ul><li><p>å€¼ä¸º0ï¼šä»£è¡¨è®°å½•å¹¶æ²¡æœ‰è¢«åˆ é™¤</p></li><li><p>å€¼ä¸º1ï¼šä»£è¡¨è®°å½•è¢«åˆ é™¤æ‰äº†</p></li></ul><p><span class='p red'>è¢«åˆ é™¤çš„è®°å½•ä¸ºä»€ä¹ˆè¿˜åœ¨é¡µä¸­å­˜å‚¨å‘¢ï¼Ÿ</span></p><p>ä½ ä»¥ä¸ºå®ƒåˆ é™¤äº†ï¼Œå¯å®ƒè¿˜åœ¨çœŸå®çš„ç£ç›˜ä¸Šã€‚è¿™äº›è¢«åˆ é™¤çš„è®°å½•ä¹‹æ‰€ä»¥ä¸ç«‹å³ä»ç£ç›˜ä¸Šç§»é™¤æ˜¯å› ä¸ºç§»é™¤å®ƒä»¬ä¹‹åå…¶ä»–çš„è®°å½•åœ¨ç£ç›˜ä¸Šéœ€è¦<code>é‡æ–°æ’åˆ—ï¼Œå¯¼è‡´æ€§èƒ½æ¶ˆè€—</code>ã€‚æ‰€ä»¥åªæ˜¯æ‰“ä¸€ä¸ªåˆ é™¤æ ‡è®°è€Œå·²ï¼Œæ‰€æœ‰è¢«åˆ é™¤æ‰çš„è®°å½•éƒ½ä¼šç»„æˆä¸€ä¸ªæ‰€è°“çš„<code>åƒåœ¾é“¾è¡¨</code>ï¼Œåœ¨è¿™ä¸ªé“¾è¡¨ä¸­çš„è®°å½•å ç”¨çš„ç©ºé—´ç§°ä¹‹ä¸º<code>å¯é‡ç”¨ç©ºé—´</code>ï¼Œä¹‹åå¦‚æœæœ‰æ–°è®°å½•æ’å…¥åˆ°è¡¨ä¸­çš„è¯ï¼Œå¯èƒ½æŠŠè¿™äº›è¢«åˆ é™¤çš„è®°å½•å ç”¨çš„å­˜å‚¨ç©ºé—´è¦†ç›–æ‰ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ce6e463d-7384-4053-be86-c9941aac665b-3"><p>B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°ï¼Œmin_rec_maskå€¼ä¸º1ã€‚</p><p>æˆ‘ä»¬è‡ªå·±æ’å…¥çš„å››æ¡è®°å½•çš„min_rec_maskå€¼éƒ½æ˜¯0ï¼Œæ„å‘³ç€å®ƒä»¬éƒ½ä¸æ˜¯B+æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ce6e463d-7384-4053-be86-c9941aac665b-4"><p>è¿™ä¸ªå±æ€§è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œä¸€å…±æœ‰4ç§ç±»å‹çš„è®°å½•ï¼š</p><p>0ï¼šè¡¨ç¤ºæ™®é€šè®°å½•</p><p>1ï¼šè¡¨ç¤ºB+æ ‘éå¶èŠ‚ç‚¹è®°å½•</p><p>2ï¼šè¡¨ç¤ºæœ€å°è®°å½•</p><p>3ï¼šè¡¨ç¤ºæœ€å¤§è®°å½•</p><p>ä»å›¾ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬è‡ªå·±æ’å…¥çš„è®°å½•å°±æ˜¯æ™®é€šè®°å½•ï¼Œå®ƒä»¬çš„record_typeå€¼éƒ½æ˜¯0ï¼Œè€Œæœ€å°è®°å½•å’Œæœ€å¤§è®°å½•çš„record_typeå€¼åˆ†åˆ«ä¸º2å’Œ3ã€‚è‡³äºrecord_typeä¸º1çš„æƒ…æ³ï¼Œæˆ‘ä»¬åœ¨ç´¢å¼•çš„æ•°æ®ç»“æ„ç« èŠ‚è®²è¿‡ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ce6e463d-7384-4053-be86-c9941aac665b-5"><p>è¿™ä¸ªå±æ€§è¡¨ç¤ºå½“å‰è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ã€‚</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ’å…¥çš„4æ¡è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®åˆ†åˆ«æ˜¯ï¼š2ã€3ã€4ã€5ã€‚</p><p><span class='p red'>æ€ä¹ˆä¸è§heap_noå€¼ä¸º0å’Œ1çš„è®°å½•å‘¢ï¼Ÿ</span></p><p>MySQLä¼šè‡ªåŠ¨ç»™æ¯ä¸ªé¡µé‡ŒåŠ äº†ä¸¤ä¸ªè®°å½•ï¼Œç”±äºè¿™ä¸¤ä¸ªè®°å½•å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±æ’å…¥çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¹Ÿç§°ä¸ºä¼ªè®°å½•æˆ–è€…è™šæ‹Ÿè®°å½•ã€‚è¿™ä¸¤ä¸ªä¼ªè®°å½•ä¸€ä¸ªä»£è¡¨æœ€å°è®°å½•ï¼Œä¸€ä¸ªä»£è¡¨æœ€å¤§è®°å½• ï¼Œæœ€å°è®°å½•å’Œæœ€å¤§è®°å½•çš„heap_noå€¼åˆ†åˆ«æ˜¯0å’Œ1ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬çš„ä½ç½®æœ€é å‰ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409172134138.png" alt="image-20230409172134138"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ce6e463d-7384-4053-be86-c9941aac665b-6"><p>è®°å½•å¤´ä¿¡æ¯é‡Œè¯¥å±æ€§éå¸¸é‡è¦ï¼Œå®ƒè¡¨ç¤ºä»å½“å‰è®°å½•çš„çœŸå®æ•°æ®åˆ°ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®çš„<span class='p red'>åœ°å€åç§»é‡</span>ã€‚</p><p>æ¯”å¦‚ï¼šç¬¬ä¸€æ¡è®°å½•çš„next_recordå€¼ä¸º32ï¼Œæ„å‘³ç€ä»ç¬¬ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®çš„åœ°å€å¤„å‘åæ‰¾32ä¸ªå­—èŠ‚ä¾¿æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®ã€‚</p><p>æ³¨æ„ï¼Œä¸‹ä¸€æ¡è®°å½•æŒ‡å¾—å¹¶ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬æ’å…¥é¡ºåºçš„ä¸‹ä¸€æ¡è®°å½•ï¼Œè€Œæ˜¯æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§çš„é¡ºåºçš„ä¸‹ä¸€æ¡è®°å½•ã€‚è€Œä¸”è§„å®šInfimumè®°å½•ï¼ˆä¹Ÿå°±æ˜¯æœ€å°è®°å½•ï¼‰çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯æœ¬é¡µä¸­ä¸»é”®å€¼æœ€å°çš„ç”¨æˆ·è®°å½•ï¼Œè€Œæœ¬é¡µä¸­ä¸»é”®å€¼æœ€å¤§çš„ç”¨æˆ·è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯ Supremumè®°å½•ï¼ˆä¹Ÿå°±æ˜¯æœ€å¤§è®°å½•ï¼‰ã€‚ä¸‹å›¾ç”¨ç®­å¤´ä»£æ›¿åç§»é‡è¡¨ç¤ºnext_recordã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409172406642.png" alt="image-20230409172406642"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ce6e463d-7384-4053-be86-c9941aac665b-7"><div class="tabs" id="70d723f3-2c00-4b25-a70b-7a274858ff57"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#70d723f3-2c00-4b25-a70b-7a274858ff57-1"><i class="fas fa-cat"></i>åˆ é™¤æ“ä½œ</button></li><li class="tab"><button type="button" data-href="#70d723f3-2c00-4b25-a70b-7a274858ff57-2"><i class="fas fa-horse"></i>æ·»åŠ æ“ä½œ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="70d723f3-2c00-4b25-a70b-7a274858ff57-1"><p>ä»è¡¨ä¸­åˆ é™¤æ‰ä¸€æ¡è®°å½•ï¼Œè¿™ä¸ªé“¾è¡¨ä¹Ÿæ˜¯ä¼šè·Ÿç€å˜åŒ–ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DELETE</span> <span class="keyword">FROM</span> page_demo <span class="keyword">WHERE</span> c1 <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.02</span> sec) </span><br></pre></td></tr></table></figure><p>åˆ æ‰ç¬¬2æ¡è®°å½•åçš„ç¤ºæ„å›¾å°±æ˜¯ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409172641654.png" alt="image-20230409172641654" style="zoom:67%;" /><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œåˆ é™¤ç¬¬2æ¡è®°å½•å‰åä¸»è¦å‘ç”Ÿäº†è¿™äº›å˜åŒ–ï¼š</p><ul><li><p>ç¬¬2æ¡è®°å½•å¹¶æ²¡æœ‰ä»å­˜å‚¨ç©ºé—´ä¸­ç§»é™¤ï¼Œè€Œæ˜¯æŠŠè¯¥æ¡è®°å½•çš„delete_maskå€¼è®¾ç½®ä¸º1ã€‚</p></li><li><p>ç¬¬2æ¡è®°å½•çš„next_recordå€¼å˜ä¸ºäº†0ï¼Œæ„å‘³ç€è¯¥è®°å½•æ²¡æœ‰ä¸‹ä¸€æ¡è®°å½•äº†ã€‚</p></li><li><p>ç¬¬1æ¡è®°å½•çš„next_recordæŒ‡å‘äº†ç¬¬3æ¡è®°å½•ã€‚</p></li><li><p>æœ€å¤§è®°å½•çš„n_ownedå€¼ä»5 å˜æˆäº† 4ã€‚</p></li></ul><p>æ‰€ä»¥ï¼Œä¸è®ºæˆ‘ä»¬æ€ä¹ˆå¯¹é¡µä¸­çš„è®°å½•åšå¢åˆ æ”¹æ“ä½œï¼ŒInnoDBå§‹ç»ˆä¼šç»´æŠ¤ä¸€æ¡è®°å½•çš„å•é“¾è¡¨é“¾è¡¨ä¸­çš„å„ä¸ªèŠ‚ç‚¹æ˜¯æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§çš„é¡ºåºè¿æ¥èµ·æ¥çš„ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="70d723f3-2c00-4b25-a70b-7a274858ff57-2"><p>ä¸»é”®å€¼ä¸º2çš„è®°å½•è¢«æˆ‘ä»¬åˆ æ‰äº†ï¼Œä½†æ˜¯å­˜å‚¨ç©ºé—´å´æ²¡æœ‰å›æ”¶ï¼Œå¦‚æœæˆ‘ä»¬å†æ¬¡æŠŠè¿™æ¡è®°å½•æ’å…¥åˆ°è¡¨ä¸­ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> page_demo <span class="keyword">VALUES</span>(<span class="number">2</span>, <span class="number">200</span>, <span class="string">&#x27;tong&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è®°å½•çš„å­˜å‚¨æƒ…å†µï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409173114316.png" alt="image-20230409173114316" style="zoom:67%;" /><p>ç›´æ¥å¤ç”¨äº†åŸæ¥è¢«åˆ é™¤è®°å½•çš„å­˜å‚¨ç©ºé—´ã€‚</p><p>è¯´æ˜ï¼š</p><p>å½“æ•°æ®é¡µä¸­å­˜åœ¨å¤šæ¡è¢«åˆ é™¤æ‰çš„è®°å½•æ—¶ï¼Œè¿™äº›è®°å½•çš„next_recordå±æ€§å°†ä¼šæŠŠè¿™äº›è¢«åˆ é™¤æ‰çš„è®°å½•ç»„æˆä¸€ä¸ªåƒåœ¾é“¾è¡¨ï¼Œä»¥å¤‡ä¹‹åé‡ç”¨è¿™éƒ¨åˆ†å­˜å‚¨ç©ºé—´ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="4-2-Compact">4.2 Compact</h3><div class="tabs" id="12e24f34-fb99-424f-88d2-97607ea35cc0"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#12e24f34-fb99-424f-88d2-97607ea35cc0-1"><i class="fas fa-award"></i>Compact</button></li><li class="tab"><button type="button" data-href="#12e24f34-fb99-424f-88d2-97607ea35cc0-2"><i class="fas fa-baseball-ball"></i>å˜æˆå­—æ®µé•¿åº¦åˆ—è¡¨</button></li><li class="tab"><button type="button" data-href="#12e24f34-fb99-424f-88d2-97607ea35cc0-3"><i class="fas fa-bone"></i>NULLå€¼åˆ—è¡¨</button></li><li class="tab"><button type="button" data-href="#12e24f34-fb99-424f-88d2-97607ea35cc0-4"><i class="fas fa-anchor"></i>è®°å½•å¤´ä¿¡æ¯</button></li><li class="tab"><button type="button" data-href="#12e24f34-fb99-424f-88d2-97607ea35cc0-5"><i class="fas fa-candy-cane"></i>çœŸå®æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="12e24f34-fb99-424f-88d2-97607ea35cc0-1"><p>åœ¨MySQL 5.1ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤è®¾ç½®ä¸ºCompactè¡Œæ ¼å¼ã€‚ä¸€æ¡å®Œæ•´çš„è®°å½•å…¶å®å¯ä»¥è¢«åˆ†ä¸ºè®°å½•çš„é¢å¤–ä¿¡æ¯å’Œè®°å½•çš„çœŸå®æ•°æ®ä¸¤å¤§éƒ¨åˆ†ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409192626770.png" alt="image-20230409192626770" style="zoom: 50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="12e24f34-fb99-424f-88d2-97607ea35cc0-2"><p>MySQLæ”¯æŒä¸€äº›å˜é•¿çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚VARCHAR(M)ã€VARBINARY(M)ã€TEXTç±»å‹ï¼Œ BLOBç±»å‹ï¼Œè¿™äº›æ•°æ®ç±»å‹ä¿®é¥°åˆ—ç§°ä¸º<span class='p red'>å˜é•¿å­—æ®µ</span>ï¼Œå˜é•¿å­—æ®µä¸­å­˜å‚¨å¤šå°‘å­—èŠ‚çš„æ•°æ®ä¸æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å­˜å‚¨çœŸå®æ•°æ®çš„æ—¶å€™éœ€è¦é¡ºä¾¿æŠŠè¿™äº›æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿå­˜èµ·æ¥ã€‚<span class='p red'>åœ¨ Compactè¡Œæ ¼å¼ä¸­ï¼ŒæŠŠæ‰€æœ‰å˜é•¿å­—æ®µçš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚é•¿åº¦éƒ½å­˜æ”¾åœ¨è®°å½•çš„å¼€å¤´éƒ¨ä½ä»è€Œå½¢æˆä¸€ä¸ªå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‚</span></p><p>æ³¨æ„ï¼šè¿™é‡Œé¢å­˜å‚¨çš„å˜é•¿é•¿åº¦å’Œå­—æ®µé¡ºåºæ˜¯åè¿‡æ¥çš„ã€‚æ¯”å¦‚ä¸¤ä¸ªvarcharå­—æ®µåœ¨è¡¨ç»“æ„çš„é¡ºåºæ˜¯a(10)ï¼Œb(15)ã€‚é‚£ä¹ˆåœ¨å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ä¸­å­˜å‚¨çš„é•¿åº¦é¡ºåºå°±æ˜¯15ï¼Œ10ï¼Œæ˜¯åè¿‡æ¥çš„ã€‚</p><p>ä»¥record_test_tableè¡¨ä¸­çš„ç¬¬ä¸€æ¡è®°å½•ä¸¾ä¾‹ï¼šå› ä¸ºrecord_test_tableè¡¨çš„col1ã€ col2ã€col4åˆ—éƒ½æ˜¯VARCHAR(8)ç±»å‹çš„ï¼Œæ‰€ä»¥è¿™ä¸‰ä¸ªåˆ—çš„å€¼çš„é•¿åº¦éƒ½éœ€è¦ä¿å­˜åœ¨è®°å½•å¼€å¤´å¤„ï¼Œæ³¨æ„record_test_tableè¡¨ä¸­çš„å„ä¸ªåˆ—éƒ½ä½¿ç”¨çš„æ˜¯asciå­—ç¬¦é›†ï¼ˆæ¯ä¸ªå­—ç¬¦åªéœ€è¦ 1ä¸ªå­—èŠ‚æ¥è¿›è¡Œç¼–ç ï¼‰ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409194639922.png" alt="image-20230409194639922" style="zoom:50%;float: right;margin-top:30px;" /><table><thead><tr><th style="text-align:center">åˆ—å</th><th style="text-align:center">å­˜å‚¨å†…å®¹</th><th style="text-align:center">å†…å®¹é•¿åº¦(åè¿›åˆ¶è¡¨ç¤º)</th><th style="text-align:center">å†…å®¹é•¿åº¦(åå…­è¿›åˆ¶è¡¨ç¤º)</th></tr></thead><tbody><tr><td style="text-align:center">col1</td><td style="text-align:center">â€˜zhangsanâ€™</td><td style="text-align:center">8</td><td style="text-align:center">0x08</td></tr><tr><td style="text-align:center">col2</td><td style="text-align:center">â€˜lisiâ€™</td><td style="text-align:center">4</td><td style="text-align:center">ox04</td></tr><tr><td style="text-align:center">col4</td><td style="text-align:center">â€˜songhkâ€™</td><td style="text-align:center">6</td><td style="text-align:center">0x06</td></tr></tbody></table><p>åˆå› ä¸ºè¿™äº›é•¿åº¦å€¼éœ€è¦æŒ‰ç…§åˆ—çš„é€†åºå­˜æ”¾ï¼Œæ‰€ä»¥æœ€åå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨çš„å­—èŠ‚ä¸²ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºçš„æ•ˆæœå°±æ˜¯ï¼ˆå„ä¸ªå­—èŠ‚ä¹‹é—´å®é™…ä¸Šæ²¡æœ‰ç©ºæ ¼ï¼Œç”¨ç©ºæ ¼éš”å¼€åªæ˜¯æ–¹ä¾¿ç†è§£ï¼‰ï¼š</p><p>06 04 08</p><p>æŠŠè¿™ä¸ªå­—èŠ‚ä¸²ç»„æˆçš„å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨å¡«å…¥ä¸Šè¾¹çš„ç¤ºæ„å›¾ä¸­çš„æ•ˆæœå°±æ˜¯ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409194924706.png" alt="image-20230409194924706"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="12e24f34-fb99-424f-88d2-97607ea35cc0-3"><p>Compactè¡Œæ ¼å¼ä¼šæŠŠå¯ä»¥ä¸ºNULLçš„åˆ—ç»Ÿä¸€ç®¡ç†èµ·æ¥ï¼Œå­˜åœ¨ä¸€ä¸ªæ ‡è®°ä¸ºNULLå€¼åˆ—è¡¨ä¸­ã€‚</p><p>å¦‚æœè¡¨ä¸­æ²¡æœ‰å…è®¸å­˜å‚¨ NULL çš„åˆ—ï¼Œåˆ™ NULLå€¼åˆ—è¡¨ä¹Ÿä¸å­˜åœ¨äº†ã€‚</p><p><span class='p red'>ä¸ºä»€ä¹ˆå®šä¹‰NULLå€¼åˆ—è¡¨ï¼Ÿ</span></p><p>ä¹‹æ‰€ä»¥è¦å­˜å‚¨NULLæ˜¯å› ä¸ºæ•°æ®éƒ½æ˜¯éœ€è¦å¯¹é½çš„ï¼Œå¦‚æœæ²¡æœ‰æ ‡æ³¨å‡ºæ¥NULLå€¼çš„ä½ç½®ï¼Œå°±æœ‰å¯èƒ½åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™å‡ºç°æ··ä¹±ã€‚å¦‚æœä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç¬¦å·æ”¾åˆ°ç›¸åº”çš„æ•°æ®ä½è¡¨ç¤ºç©ºç½®çš„è¯ï¼Œè™½ç„¶èƒ½è¾¾åˆ°æ•ˆæœï¼Œä½†æ˜¯è¿™æ ·å¾ˆæµªè´¹ç©ºé—´ï¼Œæ‰€ä»¥ç›´æ¥å°±åœ¨è¡Œæ•°æ®å¾—å¤´éƒ¨å¼€è¾Ÿå‡ºä¸€å—ç©ºé—´ä¸“é—¨ç”¨æ¥è®°å½•è¯¥è¡Œæ•°æ®å“ªäº›æ˜¯éç©ºæ•°æ®ï¼Œå“ªäº›æ˜¯ç©ºæ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><ol><li><p>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º1æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ºNULLã€‚</p></li><li><p>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º0æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ä¸ºNULLã€‚</p></li></ol><p>ä¾‹å¦‚ï¼šå­—æ®µ aã€bã€cï¼Œå…¶ä¸­aæ˜¯ä¸»é”®ï¼Œåœ¨æŸä¸€è¡Œä¸­å­˜å‚¨çš„æ•°ä¾æ¬¡æ˜¯ a=1ã€ b=nullã€ c=2ã€‚</p><p>é‚£ä¹ˆCompactè¡Œæ ¼å¼ä¸­çš„NULLå€¼åˆ—è¡¨ä¸­å­˜å‚¨ï¼š01ã€‚ç¬¬ä¸€ä¸ª0è¡¨ç¤ºcä¸ä¸ºnullï¼Œç¬¬äºŒä¸ª1è¡¨ç¤ºbæ˜¯nullã€‚è¿™é‡Œä¹‹æ‰€ä»¥æ²¡æœ‰aæ˜¯å› ä¸ºæ•°æ®åº“ä¼šè‡ªåŠ¨è·³è¿‡ä¸»é”®ï¼Œå› ä¸ºä¸»é”®è‚¯å®šæ˜¯éNULLä¸”å”¯ä¸€çš„ï¼Œåœ¨NULLå€¼åˆ—è¡¨çš„æ•°æ®ä¸­å°±ä¼šè‡ªåŠ¨è·³è¿‡ä¸»é”®ã€‚</p><p>record_test_tableçš„ä¸¤æ¡è®°å½•çš„NULLå€¼åˆ—è¡¨å°±å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409195734964.png" alt="image-20230409195734964" style="zoom: 50%;" /><blockquote><p>æ³¨æ„ï¼šInnoDB æ˜¯ç”¨æ•´æ•°å­—èŠ‚çš„äºŒè¿›åˆ¶ä½æ¥è¡¨ç¤º NULL å€¼åˆ—è¡¨çš„ï¼Œä¸è¶³ 8 ä½ï¼Œè¦åœ¨é«˜ä½è¡¥ 0ã€‚</p><p>å½“æ•°æ®è¡¨çš„å­—æ®µéƒ½å®šä¹‰æˆ NOT NULL çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¡¨é‡Œçš„è¡Œæ ¼å¼å°±ä¸ä¼šæœ‰ NULL å€¼åˆ—è¡¨äº†ã€‚</p><p>ã€ŒNULL å€¼åˆ—è¡¨ã€çš„ç©ºé—´ä¸æ˜¯å›ºå®š 1 å­—èŠ‚çš„ã€‚å½“ä¸€æ¡è®°å½•æœ‰ 9 ä¸ªå­—æ®µå€¼éƒ½æ˜¯ NULLï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»º 2 å­—èŠ‚ç©ºé—´çš„ã€ŒNULL å€¼åˆ—è¡¨ã€ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="12e24f34-fb99-424f-88d2-97607ea35cc0-4"><p><a href="#jump">ç‚¹å‡»è·³è½¬â†‘â†‘â†‘â†‘</a></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="12e24f34-fb99-424f-88d2-97607ea35cc0-5"><p>è®°å½•çš„çœŸå®æ•°æ®é™¤äº†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„åˆ—çš„æ•°æ®ä»¥å¤–ï¼Œè¿˜ä¼šæœ‰ä¸‰ä¸ªéšè—åˆ—ï¼š</p><table><thead><tr><th>åˆ—å</th><th>æ˜¯å¦å¿…é¡»</th><th>å ç”¨ç©ºé—´</th><th>æè¿°</th></tr></thead><tbody><tr><td>row_id</td><td>å¦</td><td>6å­—èŠ‚</td><td>è¡ŒIDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•</td></tr><tr><td>transaction _id</td><td>æ˜¯</td><td>6å­—èŠ‚</td><td>äº‹åŠ¡ID</td></tr><tr><td>rollpointer</td><td>æ˜¯</td><td>7å­—èŠ‚</td><td>å›æ»šæŒ‡é’ˆ</td></tr></tbody></table><p>å®é™…ä¸Šè¿™å‡ ä¸ªåˆ—çš„çœŸæ­£åç§°å…¶å®æ˜¯ï¼š<code>DB_ROW_ID</code>ã€<code>DB_TRX_ID</code>ã€<code>DB_ROLL_PTR</code>ã€‚</p><ul><li><p>ä¸€ä¸ªè¡¨æ²¡æœ‰æ‰‹åŠ¨å®šä¹‰ä¸»é”®ï¼Œåˆ™ä¼šé€‰å–ä¸€ä¸ªUniqueé”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœè¿Uniqueé”®éƒ½æ²¡æœ‰å®šä¹‰çš„è¯ï¼Œåˆ™ä¼šä¸ºè¡¨é»˜è®¤æ·»åŠ ä¸€ä¸ªåä¸ºrow_idçš„éšè—åˆ—ä½œä¸ºä¸»é”®ã€‚æ‰€ä»¥row_idæ˜¯åœ¨æ²¡æœ‰è‡ªå®šä¹‰ä¸»é”®ä»¥åŠUniqueé”®çš„æƒ…å†µä¸‹æ‰ä¼šå­˜åœ¨çš„ã€‚</p></li><li><p>äº‹åŠ¡IDå’Œå›æ»šæŒ‡é’ˆåœ¨åé¢çš„ã€ŠMySQLäº‹åŠ¡æ—¥å¿—ã€‹ç« èŠ‚ä¸­è®²è§£ã€‚</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="4-3-è¡Œæº¢å‡º">4.3 è¡Œæº¢å‡º</h3><p>å¤§ä½“ä¸Compactæ ¼å¼ç›¸åŒ</p><blockquote><p>è¡Œæº¢å‡º</p></blockquote><span class='p red'>InnoDBå­˜å‚¨å¼•æ“å¯ä»¥å°†ä¸€æ¡è®°å½•ä¸­çš„æŸäº›æ•°æ®å­˜å‚¨åœ¨çœŸæ­£çš„æ•°æ®é¡µé¢ä¹‹å¤–ã€‚</span><p>å¾ˆå¤šDBAå–œæ¬¢MySQLæ•°æ®åº“æä¾›çš„VARCHAR(M)ç±»å‹ï¼Œè®¤ä¸ºå¯ä»¥å­˜æ”¾65535å­—èŠ‚ã€‚è¿™æ˜¯çœŸçš„å—ï¼Ÿå¦‚æœæˆ‘ä»¬ä½¿ç”¨ asciiå­—ç¬¦é›†çš„è¯ï¼Œä¸€ä¸ªå­—ç¬¦å°±ä»£è¡¨ä¸€ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬çœ‹çœ‹VARCHAR(65535)æ˜¯å¦å¯ç”¨ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> varchar_size_demo</span><br><span class="line">( c <span class="type">VARCHAR</span>(<span class="number">65535</span>) ) </span><br><span class="line">CHARSET<span class="operator">=</span>ascii ROW_FORMAT<span class="operator">=</span>Compact;</span><br><span class="line"></span><br><span class="line">ERROR <span class="number">1118</span> (<span class="number">42000</span>): <span class="type">Row</span> size too large. The maximum <span class="type">row</span> size <span class="keyword">for</span> the used <span class="keyword">table</span> type, <span class="keyword">not</span> counting BLOBs, <span class="keyword">is</span> <span class="number">65535.</span> This includes storage overhead, <span class="keyword">check</span> the manual. You have <span class="keyword">to</span> change <span class="keyword">some</span> columns <span class="keyword">to</span> TEXT <span class="keyword">or</span> BLOBs </span><br></pre></td></tr></table></figure><p>æŠ¥é”™ä¿¡æ¯è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šMySQLå¯¹ä¸€æ¡è®°å½•å ç”¨çš„æœ€å¤§å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™åˆ¶çš„ï¼Œé™¤BLOBæˆ–è€…TEXTç±»å‹çš„åˆ—ä¹‹å¤–ï¼Œ å…¶ä»–æ‰€æœ‰çš„åˆ—ï¼ˆä¸åŒ…æ‹¬éšè—åˆ—å’Œè®°å½•å¤´ä¿¡æ¯ï¼‰å ç”¨çš„å­—èŠ‚é•¿åº¦åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡65535ä¸ªå­—èŠ‚ã€‚</p><p>è¿™ä¸ª65535ä¸ªå­—èŠ‚é™¤äº†åˆ—æœ¬èº«çš„æ•°æ®ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›å…¶ä»–çš„æ•°æ®ï¼Œä»¥Compactè¡Œæ ¼å¼ä¸ºä¾‹ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ä¸ºäº†å­˜å‚¨ä¸€ä¸ªVARCHAR(M)ç±»å‹çš„åˆ—ï¼Œé™¤äº†çœŸå®æ•°æ®å æœ‰ç©ºé—´ä»¥å¤–ï¼Œè¿˜éœ€è¦è®°å½•çš„é¢å¤–ä¿¡æ¯ã€‚</p><p>å¦‚æœè¯¥VARCHARç±»å‹çš„åˆ—æ²¡æœ‰NOT NULLå±æ€§ï¼Œé‚£æœ€å¤šåªèƒ½å­˜å‚¨65532ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå› ä¸ºå˜é•¿å­—æ®µçš„é•¿åº¦å ç”¨ 2ä¸ªå­—èŠ‚ï¼ŒNULLå€¼æ ‡è¯†éœ€è¦å ç”¨1ä¸ªå­—èŠ‚ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> varchar_size_demo( </span><br><span class="line">  c <span class="type">VARCHAR</span>(<span class="number">65532</span>)) </span><br><span class="line">  CHARSET<span class="operator">=</span>ascii ROW_FORMAT<span class="operator">=</span>Compact; </span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸€ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯16KBï¼Œä¹Ÿå°±æ˜¯16384å­—èŠ‚ï¼Œè€Œä¸€ä¸ªVARCHAR(M)ç±»å‹çš„åˆ—å°±æœ€å¤šå¯ä»¥å­˜å‚¨65533ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±å¯èƒ½å‡ºç°ä¸€ä¸ªé¡µå­˜æ”¾ä¸äº†ä¸€æ¡è®°å½•ï¼Œè¿™ç§ç°è±¡ç§°ä¸º<span class='p red'>è¡Œæº¢å‡º</span>ã€‚</p><p>åœ¨Compactå’ŒReduntantè¡Œæ ¼å¼ä¸­ï¼Œå¯¹äºå ç”¨å­˜å‚¨ç©ºé—´éå¸¸å¤§çš„åˆ—ï¼Œåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„åªä¼šå­˜å‚¨è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒæŠŠå‰©ä½™çš„æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å‡ ä¸ªå…¶ä»–çš„é¡µä¸­è¿›è¡Œ<span class='p red'>åˆ†é¡µå­˜å‚¨</span>ï¼Œç„¶åè®°å½•çš„çœŸå®æ•°æ®å¤„ç”¨20ä¸ªå­—èŠ‚å­˜å‚¨æŒ‡å‘è¿™äº›é¡µçš„åœ°å€ï¼ˆå½“ç„¶è¿™20ä¸ªå­—èŠ‚ä¸­è¿˜åŒ…æ‹¬è¿™äº›åˆ†æ•£åœ¨å…¶ä»–é¡µé¢ä¸­çš„æ•°æ®çš„å ç”¨çš„å­—èŠ‚æ•°ï¼‰ï¼Œä»è€Œå¯ä»¥æ‰¾åˆ°å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µã€‚è¿™ç§°ä¸ºé¡µçš„æ‰©å±•ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409205048398.png" alt="image-20230409205048398" style="zoom:50%;" /><hr><h3 id="4-4-Dynamicå’ŒCompressed">4.4 Dynamicå’ŒCompressed</h3><p>åœ¨MySQL 8.0ä¸­ï¼Œé»˜è®¤è¡Œæ ¼å¼å°±æ˜¯Dynamic, Dynamicã€Compressedè¡Œæ ¼å¼å’Œ Compactè¡Œæ ¼å¼æŒºåƒï¼Œåªä¸è¿‡åœ¨å¤„ç†è¡Œæº¢å‡ºæ•°æ®æ—¶æœ‰åˆ†æ­§ï¼š</p><ul><li><p>Compressedå’ŒDynamicä¸¤ç§è®°å½•æ ¼å¼å¯¹äºå­˜æ”¾åœ¨BLOBä¸­çš„æ•°æ®é‡‡ç”¨äº†å®Œå…¨çš„è¡Œæº¢å‡ºçš„æ–¹å¼ã€‚å¦‚å›¾ï¼Œåœ¨æ•°æ®é¡µä¸­åªå­˜æ”¾20ä¸ªå­—èŠ‚çš„æŒ‡é’ˆï¼ˆæº¢å‡ºé¡µçš„åœ°å€ï¼‰ï¼Œå®é™…çš„æ•°æ®éƒ½å­˜æ”¾åœ¨Off Pageï¼ˆæº¢å‡ºé¡µï¼‰ä¸­ã€‚</p></li><li><p>Compactå’ŒRedundantä¸¤ç§æ ¼å¼ä¼šåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®ï¼ˆå­˜æ”¾ 768ä¸ªå‰ç¼€å­—èŠ‚ï¼‰ã€‚</p></li></ul><p>Compressedè¡Œè®°å½•æ ¼å¼çš„å¦ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯ï¼Œå­˜å‚¨åœ¨å…¶ä¸­çš„è¡Œæ•°æ®ä¼šä»¥zlibçš„ç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå› æ­¤å¯¹äºBLOBã€ TEXTã€VARCHARè¿™ç±»å¤§é•¿åº¦ç±»å‹çš„æ•°æ®èƒ½å¤Ÿè¿›è¡Œéå¸¸æœ‰æ•ˆçš„å­˜å‚¨ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409205517998.png" alt="image-20230409205517998"></p><hr><h3 id="4-5-Redundant">4.5 Redundant</h3><p>Redundantæ˜¯MySQL 5.0ç‰ˆæœ¬ä¹‹å‰InnoDBçš„è¡Œè®°å½•å­˜å‚¨æ–¹å¼ï¼ŒMySQL 5.0æ”¯æŒ Redundantæ˜¯ä¸ºäº†å…¼å®¹ä¹‹å‰ç‰ˆæœ¬çš„é¡µæ ¼å¼ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409205743540.png" alt="image-20230409205743540" style="zoom: 50%;" /><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒäºCompactè¡Œè®°å½•æ ¼å¼ï¼ŒRedundantè¡Œæ ¼å¼çš„é¦–éƒ¨æ˜¯ä¸€ä¸ªå­—æ®µé•¿åº¦åç§»åˆ—è¡¨ï¼ŒåŒæ ·æ˜¯æŒ‰ç…§åˆ—çš„é¡ºåº<span class='p red'>é€†åºæ”¾ç½®</span>çš„ã€‚</p><p>ä¸‹è¾¹æˆ‘ä»¬ä»å„ä¸ªæ–¹é¢çœ‹ä¸€ä¸‹Redundantè¡Œæ ¼å¼æœ‰ä»€ä¹ˆä¸åŒçš„åœ°æ–¹ã€‚</p><p>æ³¨æ„Compactè¡Œæ ¼å¼çš„å¼€å¤´æ˜¯å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œè€ŒRedundantè¡Œæ ¼å¼çš„å¼€å¤´æ˜¯å­—æ®µé•¿åº¦åç§»åˆ—è¡¨ï¼Œä¸å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨æœ‰ä¸¤å¤„ä¸åŒï¼š</p><ul><li><p>å°‘äº†â€œå˜é•¿â€ä¸¤ä¸ªå­—ï¼šRedundahtè¡Œæ ¼å¼ä¼šæŠŠè¯¥æ¡è®°å½•ä¸­æ‰€æœ‰åˆ—ï¼ˆåŒ…æ‹¬éšè—åˆ—ï¼‰çš„é•¿åº¦ä¿¡æ¯éƒ½æŒ‰ç…§é€†åºå­˜å‚¨åˆ°å­—æ®µé•¿åº¦åç§»åˆ—è¡¨ã€‚</p></li><li><p>å¤šäº†â€œåç§»â€ä¸¤ä¸ªå­—ï¼šè¿™æ„å‘³ç€è®¡ç®—åˆ—å€¼é•¿åº¦çš„æ–¹å¼ä¸åƒCompactè¡Œæ ¼å¼é‚£ä¹ˆç›´è§‚ ï¼Œå®ƒæ˜¯é‡‡ç”¨ä¸¤ä¸ªç›¸é‚»æ•°å€¼çš„å·®å€¼æ¥è®¡ç®—å„ä¸ªåˆ—å€¼çš„é•¿åº¦ã€‚</p></li></ul><hr><h2 id="5-åŒºã€æ®µä¸ç¢ç‰‡åŒº">5. åŒºã€æ®µä¸ç¢ç‰‡åŒº</h2><div class="tabs" id="e91a6832-e47d-42ac-a2f5-db18557a06f9"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#e91a6832-e47d-42ac-a2f5-db18557a06f9-1"><i class="fas fa-atom"></i>ä¸ºä»€ä¹ˆè¦æœ‰åŒºï¼Ÿ</button></li><li class="tab"><button type="button" data-href="#e91a6832-e47d-42ac-a2f5-db18557a06f9-2"><i class="far fa-sun"></i>ä¸ºä»€ä¹ˆè¦æœ‰æ®µï¼Ÿ</button></li><li class="tab"><button type="button" data-href="#e91a6832-e47d-42ac-a2f5-db18557a06f9-3"><i class="fas fa-wind"></i>ä¸ºä»€ä¹ˆè¦æœ‰ç¢ç‰‡åŒºï¼Ÿ</button></li><li class="tab"><button type="button" data-href="#e91a6832-e47d-42ac-a2f5-db18557a06f9-4"><i class="fas fa-fire-alt"></i>åŒºçš„åˆ†ç±»</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="e91a6832-e47d-42ac-a2f5-db18557a06f9-1"><p><code>B+</code>æ ‘çš„æ¯ä¸€å±‚ä¸­çš„é¡µéƒ½ä¼šå½¢æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¦‚æœæ˜¯<code>ä»¥é¡µä¸ºå•ä½</code>æ¥åˆ†é…å­˜å‚¨ç©ºé—´çš„è¯ï¼ŒåŒå‘é“¾è¡¨ç›¸é‚»çš„ä¸¤ä¸ªé¡µä¹‹é—®çš„<code>ç‰©ç†ä½ç½®å¯èƒ½ç¦»å¾—éå¸¸è¿œ</code>ã€‚æˆ‘ä»¬ä»‹ç»B+æ ‘æ³°å¼•çš„é€‚ç”¨åœºæ™¯çš„æ—¶å€™ç‰¹åˆ«æåˆ°èŒƒå›´æŸ¥è¯¢åªéœ€è¦å®šä½åˆ°æœ€å·¦è¾¹çš„è®°å½•å’Œæœ€å³è¾¹çš„è®°å½•ï¼Œç„¶åæ²¿ç€åŒå‘é“¾è¡¨ä¸€ç›´æ‰«æå°±å¯ä»¥äº†ï¼Œè€Œå¦‚æœé“¾è¡¨ä¸­ç›¸é‚»çš„ä¸¤ä¸ªé¡µç‰©ç†ä½ç½®ç¦»å¾—éå¸¸è¿œï¼Œ å°±æ˜¯æ‰€è°“çš„<code>éšæœºI/0</code>ã€‚å†ä¸€æ¬¡å¼ºè°ƒï¼Œç£ç›˜çš„é€Ÿåº¦å’Œå†…å­˜çš„é€Ÿåº¦å·®äº†å¥½å‡ ä¸ªæ•°é‡çº§ï¼Œ<code>éšæœºI/0æ˜¯éå¸¸æ…¢</code>çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½é‡è®©é“¾è¡¨ä¸­ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®ä¹Ÿç›¸é‚»ï¼Œè¿™æ ·è¿›è¡ŒèŒƒå›´æŸ¥è¯¢çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨æ‰€è°“çš„é¡ºåºI/0ã€‚</p><p>å¼•å…¥<code>åŒº</code>çš„æ¦‚å¿µï¼Œä¸€ä¸ªåŒºå°±æ˜¯åœ¨ç‰©ç†ä½ç½®ä¸Šè¿ç»­çš„<code>64ä¸ªé¡µ</code>ã€‚å› ä¸º InnoDB ä¸­çš„é¡µå¤§å°é»˜è®¤æ˜¯ 16KBï¼Œ æ‰€ä»¥ä¸€ä¸ªåŒºçš„å¤§å°æ˜¯ 64 16KB=<code>1MB</code>ã€‚åœ¨è¡¨ä¸­æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œä¸ºæŸä¸ªç´¢å¼•åˆ†é…ç©ºé—´çš„æ—¶å€™å°±ä¸å†æŒ‰ç…§é¡µä¸ºå•ä½åˆ†é…äº†ï¼Œè€Œæ˜¯æŒ‰ç…§åŒºä¸ºå•ä½åˆ†é…ï¼Œç”šè‡³åœ¨è¡¨ä¸­çš„æ•°æ®ç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œå¯ä»¥ä¸€æ¬¡æ€§åˆ†é…å¤šä¸ªè¿ç»­çš„åŒºã€‚è™½ç„¶å¯èƒ½é€ æˆä¸€ç‚¹ç‚¹ç©ºé—´çš„æµªè´¹ï¼ˆæ•°æ®ä¸è¶³ä»¥å¡«å……æ»¡æ•´ä¸ªåŒºï¼‰ï¼Œä½†æ˜¯ä»æ€§èƒ½è§’åº¦çœ‹ï¼Œå¯ä»¥æ¶ˆé™¤å¾ˆå¤šçš„éšæœºI/0ï¼ŒåŠŸå¤§äºè¿‡ï¼</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e91a6832-e47d-42ac-a2f5-db18557a06f9-2"><p>å¯¹äºèŒƒå›´æŸ¥è¯¢ï¼Œå…¶å®æ˜¯å¯¹B+æ ‘å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•è¿›è¡Œé¡ºåºæ‰«æï¼Œè€Œå¦‚æœä¸åŒºåˆ†<code>å¶å­èŠ‚ç‚¹</code>å’Œ<code>éå¶å­èŠ‚ç‚¹</code>ï¼Œç»Ÿç»ŸæŠŠèŠ‚ç‚¹ä»£è¡¨çš„é¡µé¢æ”¾åˆ°ç”³è¯·åˆ°çš„åŒºä¸­çš„è¯ï¼Œè¿›è¡ŒèŒƒå›´æ‰«æçš„æ•ˆæœå°±å¤§æ‰“æŠ˜æ‰£äº†ã€‚æ‰€ä»¥ InnoDB å¯¹B+æ ‘çš„å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹è¿›è¡Œäº†åŒºåˆ«å¯¹å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´å¶å­èŠ‚ç‚¹æœ‰è‡ªå·±ç‹¬æœ‰çš„åŒºï¼Œéå¶å­èŠ‚ç‚¹ä¹Ÿæœ‰è‡ªå·±ç‹¬æœ‰çš„åŒºã€‚å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆå°±ç®—æ˜¯ä¸€ä¸ª<code>æ®µï¼ˆsegmentï¼‰</code>ï¼Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆä¹Ÿç®—æ˜¯ä¸€ä¸ªæ®µã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç´¢å¼•ä¼šç”Ÿæˆ2ä¸ªæ®µï¼Œä¸€ä¸ª<code>å¶å­èŠ‚ç‚¹æ®µ</code>ï¼Œä¸€ä¸ª<code>éå¶å­èŠ‚ç‚¹æ®µ</code>ã€‚</p><p>é™¤äº†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µä¹‹å¤–ï¼ŒInnoDBä¸­è¿˜æœ‰ä¸ºå­˜å‚¨ä¸€äº›ç‰¹æ®Šçš„æ•°æ®è€Œå®šä¹‰çš„æ®µï¼Œæ¯”å¦‚å›æ»šæ®µã€‚æ‰€ä»¥ï¼Œå¸¸è§çš„æ®µæœ‰<code>æ•°æ®æ®µ</code>ã€<code>ç´¢å¼•æ®µ</code>ã€<code>å›æ»šæ®µ</code>ã€‚æ•°æ®æ®µå³ä¸ºB+æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œç´¢å¼•æ®µå³ä¸ºB+æ ‘çš„éå¶å­èŠ‚ç‚¹ã€‚</p><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå¯¹æ®µçš„ç®¡ç†éƒ½æ˜¯ç”±å¼•æ“è‡ªèº«æ‰€å®Œæˆï¼ŒDBAä¸èƒ½ä¹Ÿæ²¡æœ‰å¿…è¦å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚è¿™ä»ä¸€å®šç¨‹åº¦ä¸Šç®€åŒ–äº†DBAå¯¹äºæ®µçš„ç®¡ç†ã€‚</p><p>æ®µå…¶å®ä¸å¯¹åº”è¡¨ç©ºé—´ä¸­æŸä¸€ä¸ªè¿ç»­çš„ç‰©ç†åŒºåŸŸï¼Œè€Œæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±è‹¥å¹²ä¸ªé›¶æ•£çš„é¡µé¢ä»¥åŠä¸€äº›å®Œæ•´çš„åŒºç»„æˆã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e91a6832-e47d-42ac-a2f5-db18557a06f9-3"><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨åªæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•ä¼šç”Ÿæˆ2ä¸ªæ®µï¼Œè€Œæ®µæ˜¯ä»¥åŒºä¸ºå•ä½ç”³è¯·å­˜å‚¨ç©ºé—´çš„ï¼Œä¸€ä¸ªåŒºé»˜è®¤å ç”¨1M(64* 16Kb =1024Kbï¼‰å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥<span class='p red'>é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªåªå­˜äº†å‡ æ¡è®°å½•çš„å°è¡¨ä¹Ÿéœ€è¦2Mçš„å­˜å‚¨ç©ºé—´ä¹ˆï¼Ÿ</span>ä»¥åæ¯æ¬¡æ·»åŠ ä¸€ä¸ªç´¢å¼•éƒ½è¦å¤šç”³è¯·2Mçš„å­˜å‚¨ç©ºé—´ä¹ˆï¼Ÿè¿™å¯¹äºå­˜å‚¨è®°å½•æ¯”è¾ƒå°‘çš„è¡¨ç®€ç›´æ˜¯å¤©å¤§çš„æµªè´¹ã€‚è¿™ä¸ªé—®é¢˜çš„ç—‡ç»“åœ¨äºåˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬ä»‹ç»çš„åŒºéƒ½æ˜¯éå¸¸<code>çº¯ç²¹</code>çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒºè¢«æ•´ä¸ªåˆ†é…ç»™æŸä¸€ä¸ªæ®µï¼Œæˆ–è€…è¯´åŒºä¸­çš„æ‰€æœ‰é¡µé¢éƒ½æ˜¯ä¸ºäº†å­˜å‚¨åŒä¸€ä¸ªæ®µçš„æ•°æ®è€Œå­˜åœ¨çš„ï¼Œå³ä½¿æ®µçš„æ•°æ®å¡«ä¸æ»¡åŒºä¸­æ‰€æœ‰çš„é¡µé¢ï¼Œé‚£ä½™ä¸‹çš„é¡µé¢ä¹Ÿä¸èƒ½æŒªä½œä»–ç”¨ã€‚</p><p>ä¸ºäº†è€ƒè™‘ä»¥å®Œæ•´çš„åŒºä¸ºå•ä½åˆ†é…ç»™æŸä¸ªæ®µå¯¹äº<code>æ•°æ®é‡è¾ƒå°</code>çš„è¡¨å¤ªæµªè´¹å­˜å‚¨ç©ºé—´çš„è¿™ç§æƒ…å†µï¼ŒInnoDBæå‡ºäº†ä¸€ä¸ª<code>ç¢ç‰‡ï¼ˆfragmentï¼‰åŒº</code>çš„æ¦‚å¿µã€‚åœ¨ä¸€ä¸ªç¢ç‰‡åŒºä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é¡µéƒ½æ˜¯ä¸ºäº†å­˜å‚¨åŒä¸€ä¸ªæ®µçš„æ•°æ®è€Œå­˜åœ¨çš„ï¼Œè€Œæ˜¯ç¢ç‰‡åŒºä¸­çš„é¡µå¯ä»¥ç”¨äºä¸åŒçš„ç›®çš„ï¼Œæ¯”å¦‚æœ‰äº›é¡µç”¨äºæ®µAï¼Œæœ‰äº›é¡µç”¨äºæ®µBï¼Œæœ‰äº›é¡µç”šè‡³å“ªä¸ªæ®µéƒ½ä¸å±äºã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ç©ºé—´ï¼Œå¹¶ä¸å±äºä»»ä½•ä¸€ä¸ªæ®µã€‚</p><p>æ‰€ä»¥æ­¤åä¸ºæŸä¸ªæ®µåˆ†é…å­˜å‚¨ç©ºé—´çš„ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>åœ¨åˆšå¼€å§‹å‘è¡¨ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ®µæ˜¯ä»æŸä¸ªç¢ç‰‡åŒºä»¥å•ä¸ªé¡µé¢ä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´çš„ã€‚</p></li><li><p>å½“æŸä¸ªæ®µå·²ç»å ç”¨äº†32ä¸ªç¢ç‰‡åŒºé¡µé¢ä¹‹åï¼Œå°±ä¼šç”³è¯·ä»¥å®Œæ•´çš„åŒºä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´ã€‚</p></li></ul><p>æ‰€ä»¥ç°åœ¨æ®µä¸èƒ½ä»…å®šä¹‰ä¸ºæ˜¯æŸäº›åŒºçš„é›†åˆï¼Œæ›´ç²¾ç¡®çš„åº”è¯¥æ˜¯<code>æŸäº›é›¶æ•£çš„é¡µé¢</code>ä»¥åŠ<code>ä¸€äº›å®Œæ•´çš„åŒº</code>çš„é›†åˆã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e91a6832-e47d-42ac-a2f5-db18557a06f9-4"><p>åŒºå¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸º4ç§ç±»å‹ï¼š</p><ul><li>ç©ºé—²çš„åŒº (FREE) : ç°åœ¨è¿˜æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªåŒºä¸­çš„ä»»ä½•é¡µé¢ã€‚</li><li>æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº (FREE_FRAG)ï¼šè¡¨ç¤ºç¢ç‰‡åŒºä¸­è¿˜æœ‰å¯ç”¨çš„é¡µé¢ã€‚</li><li>æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº (FULL_FRAG)ï¼šè¡¨ç¤ºç¢ç‰‡åŒºä¸­çš„æ‰€æœ‰é¡µé¢éƒ½è¢«ä½¿ç”¨ï¼Œæ²¡æœ‰ç©ºé—²é¡µé¢ã€‚</li><li>é™„å±äºæŸä¸ªæ®µçš„åŒº (FSEG)ï¼šæ¯ä¸€ä¸ªç´¢å¼•éƒ½å¯ä»¥åˆ†ä¸ºå¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µã€‚</li></ul><p>å¤„äºFREEã€FREE_FRAG ä»¥åŠ FULL_FRAG è¿™ä¸‰ç§çŠ¶æ€çš„åŒºéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç›´å±äºè¡¨ç©ºé—´ã€‚è€Œå¤„äº FSEG çŠ¶æ€çš„åŒºæ˜¯é™„å±äºæŸä¸ªæ®µçš„ã€‚</p><blockquote><p>å¦‚æœæŠŠè¡¨ç©ºé—´æ¯”ä½œæ˜¯ä¸€ä¸ªé›†å›¢å†›ï¼Œæ®µå°±ç›¸å½“äºå¸ˆï¼ŒåŒºå°±ç›¸å½“äºå›¢ã€‚ä¸€èˆ¬çš„å›¢éƒ½æ˜¯éš¶å±äºæŸä¸ªå¸ˆçš„ï¼Œå°±åƒæ˜¯å¤„äº FSEG çš„åŒºå…¨éƒ¨éš¶å±äºæŸä¸ªæ®µï¼Œè€Œå¤„äº FREEã€FREE_FRAG ä»¥åŠ FULL_FRAG è¿™ä¸‰ç§çŠ¶æ€çš„åŒºå´ç›´æ¥éš¶å±äºè¡¨ç©ºé—´ï¼Œå°±åƒç‹¬ç«‹å›¢ç›´æ¥å¬å‘½äºå†›éƒ¨ä¸€æ ·ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h2 id="6-è¡¨ç©ºé—´">6. è¡¨ç©ºé—´</h2><p>è¡¨ç©ºé—´å¯ä»¥çœ‹åšæ˜¯InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å­˜æ”¾åœ¨è¡¨ç©ºé—´ä¸­ã€‚</p><p>è¡¨ç©ºé—´æ˜¯ä¸€ä¸ª<code>é€»è¾‘å®¹å™¨</code>ï¼Œè¡¨ç©ºé—´å­˜å‚¨çš„å¯¹è±¡æ˜¯æ®µï¼Œåœ¨ä¸€ä¸ªè¡¨ç©ºé—´ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ®µï¼Œä½†æ˜¯ä¸€ä¸ªæ®µåªèƒ½å±äºä¸€ä¸ªè¡¨ç©ºé—´ã€‚è¡¨ç©ºé—´æ•°æ®åº“ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ç©ºé—´ç»„æˆï¼Œè¡¨ç©ºé—´ä»ç®¡ç†ä¸Šå¯ä»¥åˆ’åˆ†ä¸º<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>(System tablespace)ã€<code>ç‹¬ç«‹è¡¨ç©ºé—´</code>(File-per-table tablespace)ã€<code>æ’¤é”€è¡¨ç©ºé—´</code>(Undo Tablespaceï¼‰å’Œ<code>ä¸´æ—¶è¡¨ç©ºé—´</code>(Temporary Tablespace) ç­‰ã€‚</p><div class="tabs" id="2b23fb45-4f28-461f-a1f8-c4694ddcc12d"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2b23fb45-4f28-461f-a1f8-c4694ddcc12d-1"><i class="fas fa-bug"></i>ç‹¬ç«‹è¡¨ç©ºé—´</button></li><li class="tab"><button type="button" data-href="#2b23fb45-4f28-461f-a1f8-c4694ddcc12d-2"><i class="fas fa-cannabis"></i>ç³»ç»Ÿè¡¨ç©ºé—´</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2b23fb45-4f28-461f-a1f8-c4694ddcc12d-1"><p>ç‹¬ç«‹è¡¨ç©ºé—´ï¼Œå³æ¯å¼ è¡¨æœ‰ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯æ•°æ®å’Œç´¢å¼•ä¿¡æ¯éƒ½ä¼šä¿å­˜åœ¨è‡ªå·±çš„è¡¨ç©ºé—´ä¸­ã€‚ç‹¬ç«‹çš„è¡¨ç©ºé—´ (å³ï¼šå•è¡¨) å¯ä»¥åœ¨ä¸åŒçš„æ•°æ®åº“ä¹‹é—´è¿›è¡Œ<code>è¿ç§»</code>ã€‚</p><p>ç©ºé—´å¯ä»¥å›æ”¶ (DROP TABLE æ“ä½œå¯è‡ªåŠ¨å›æ”¶è¡¨ç©ºé—´ï¼›å…¶ä»–æƒ…å†µï¼Œè¡¨ç©ºé—´ä¸èƒ½è‡ªå·±å›æ”¶) ã€‚å¦‚æœå¯¹äºç»Ÿè®¡åˆ†ææˆ–æ˜¯æ—¥å¿—è¡¨ï¼Œåˆ é™¤å¤§é‡æ•°æ®åå¯ä»¥é€šè¿‡ï¼šalter table TableName engine=innodb; å›æ”¶ä¸ç”¨çš„ç©ºé—´ã€‚å¯¹äºä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´çš„è¡¨ï¼Œä¸ç®¡æ€ä¹ˆåˆ é™¤ï¼Œè¡¨ç©ºé—´çš„ç¢ç‰‡ä¸ä¼šå¤ªä¸¥é‡çš„å½±å“æ€§èƒ½ï¼Œè€Œä¸”è¿˜æœ‰æœºä¼šå¤„ç†ã€‚</p><p><strong>ç‹¬ç«‹è¡¨ç©ºé—´ç»“æ„</strong></p><p>ç‹¬ç«‹è¡¨ç©ºé—´ç”±æ®µã€åŒºã€é¡µç»„æˆã€‚</p><p><strong>çœŸå®è¡¨ç©ºé—´å¯¹åº”çš„æ–‡ä»¶å¤§å°</strong></p><p>æˆ‘ä»¬åˆ°æ•°æ®ç›®å½•é‡Œçœ‹ï¼Œä¼šå‘ç°ä¸€ä¸ªæ–°å»ºçš„è¡¨å¯¹åº”çš„ .ibd æ–‡ä»¶åªå ç”¨äº† 96Kï¼Œæ‰6ä¸ªé¡µé¢å¤§å° (MySQL5.7ä¸­)ï¼Œè¿™æ˜¯å› ä¸ºä¸€å¼€å§‹è¡¨ç©ºé—´å ç”¨çš„ç©ºé—´å¾ˆå°ï¼Œå› ä¸ºè¡¨é‡Œè¾¹éƒ½æ²¡æœ‰æ•°æ®ã€‚ä¸è¿‡åˆ«å¿˜äº†è¿™äº› .ibd æ–‡ä»¶æ˜¯è‡ªæ‰©å±•çš„ï¼Œéšç€è¡¨ä¸­æ•°æ®çš„å¢å¤šï¼Œè¡¨ç©ºé—´å¯¹åº”çš„æ–‡ä»¶ä¹Ÿé€æ¸å¢å¤§ã€‚</p><p><strong>æŸ¥çœ‹ InnoDB çš„è¡¨ç©ºé—´ç±»å‹ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_file_per_table&#x27;</span></span><br></pre></td></tr></table></figure><p>ä½ èƒ½çœ‹åˆ° innodb_file_per_table=ON, è¿™å°±æ„å‘³ç€æ¯å¼ è¡¨éƒ½ä¼šå•è¯ä¿å­˜ä¸€ä¸ª .ibd æ–‡ä»¶ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2b23fb45-4f28-461f-a1f8-c4694ddcc12d-2"><p>ç³»ç»Ÿè¡¨ç©ºé—´çš„ç»“æ„å’Œç‹¬ç«‹è¡¨ç©ºé—´åŸºæœ¬ç±»ä¼¼ï¼Œåªä¸è¿‡ç”±äºæ•´ä¸ªMySQLè¿›ç¨‹åªæœ‰ä¸€ä¸ªç³»ç»Ÿè¡¨ç©ºé—´ï¼Œåœ¨ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ä¼šé¢å¤–è®°å½•ä¸€äº›æœ‰å…³æ•´ä¸ªç³»ç»Ÿä¿¡æ¯çš„é¡µé¢ï¼Œè¿™éƒ¨åˆ†æ˜¯ç‹¬ç«‹è¡¨ç©ºé—´ä¸­æ²¡æœ‰çš„ã€‚</p><p><strong>InnoDBæ•°æ®å­—å…¸</strong></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220621150648770.png" alt="image-20220621150648770"  /><p>åˆ é™¤è¿™äº›æ•°æ®å¹¶ä¸æ˜¯æˆ‘ä»¬ä½¿ç”¨ INSERT è¯­å¥æ’å…¥çš„ç”¨æˆ·æ•°æ®ï¼Œå®é™…ä¸Šæ˜¯ä¸ºäº†æ›´å¥½çš„ç®¡ç†æˆ‘ä»¬è¿™äº›ç”¨æˆ·æ•°æ®è€Œä¸å¾—ä»¥å¼•å…¥çš„ä¸€äº›é¢å¤–æ•°æ®ï¼Œè¿™äº›æ•°æ®é¡µç§°ä¸º å…ƒæ•°æ®ã€‚InnoDB å­˜å‚¨å¼•æ“ç‰¹æ„å®šä¹‰äº†ä¸€äº›åˆ—çš„ å†…éƒ¨ç³»ç»Ÿè¡¨ (internal system table) æ¥è®°å½•è¿™äº›å…ƒæ•°æ®ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220621150924922.png" alt="image-20220621150924922"  /><p>è¿™äº›ç³»ç»Ÿè¡¨ä¹Ÿç§°ä¸º<code>æ•°æ®å­—å…¸</code>ï¼Œå®ƒä»¬éƒ½æ˜¯ä»¥ B+ æ ‘çš„å½¢å¼ä¿å­˜åœ¨ç³»ç»Ÿè¡¨ç©ºé—´çš„æŸä¸ªé¡µé¢ä¸­ã€‚å…¶ä¸­<code>SYS_TABLESã€SYS_COLUMNSã€SYS_INDEXESã€SYS_FIELDS</code>è¿™å››ä¸ªè¡¨å°¤å…¶é‡è¦ï¼Œç§°ä¹‹ä¸ºåŸºæœ¬ç³»ç»Ÿè¡¨ (basic system tables) ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹è¿™4ä¸ªè¡¨çš„ç»“æ„ï¼š</p><div class="tabs" id="5c77cd88-9420-4be4-9487-202f2f71c4b3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#5c77cd88-9420-4be4-9487-202f2f71c4b3-1"><i class="fas fa-seedling"></i>SYS_TABLES</button></li><li class="tab"><button type="button" data-href="#5c77cd88-9420-4be4-9487-202f2f71c4b3-2"><i class="fas fa-leaf"></i>SYS_COLUMNS</button></li><li class="tab"><button type="button" data-href="#5c77cd88-9420-4be4-9487-202f2f71c4b3-3"><i class="fab fa-apple"></i>SYS_INDEXES</button></li><li class="tab"><button type="button" data-href="#5c77cd88-9420-4be4-9487-202f2f71c4b3-4"><i class="fas fa-tree"></i>SYS_FIELDS</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="5c77cd88-9420-4be4-9487-202f2f71c4b3-1"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220621151139759.png" alt="image-20220621151139759"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5c77cd88-9420-4be4-9487-202f2f71c4b3-2"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220621151158361.png" alt="image-20220621151158361"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5c77cd88-9420-4be4-9487-202f2f71c4b3-3"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220621151215274.png" alt="image-20220621151215274"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5c77cd88-9420-4be4-9487-202f2f71c4b3-4"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220621151238157.png" alt="image-20220621151238157"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>æ³¨æ„ï¼šç”¨æˆ·ä¸èƒ½ç›´æ¥è®¿é—® InnoDB çš„è¿™äº›å†…éƒ¨ç³»ç»Ÿè¡¨ï¼Œé™¤éä½ ç›´æ¥å»è§£æç³»ç»Ÿè¡¨ç©ºé—´å¯¹åº”æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚ä¸è¿‡è€ƒè™‘åˆ°æŸ¥çœ‹è¿™äº›è¡¨çš„å†…å®¹å¯èƒ½æœ‰åŠ©äºå¤§å®¶åˆ†æé—®é¢˜ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿæ•°æ®åº“<code>information_schema</code>ä¸­æä¾›äº†ä¸€äº›ä»¥<code>innodb_sys</code>å¼€å¤´çš„è¡¨:</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409224721791.png" alt="image-20230409224721791" style="zoom:50%;float: right" /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USE information_schema;</span><br><span class="line"><span class="keyword">SHOW</span> TABLES <span class="keyword">LIKE</span> <span class="string">&#x27;innodb_sys%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åœ¨<code>information_scheme</code>æ•°æ®åº“ä¸­çš„è¿™äº›ä»¥<code>INNODB_SYS</code>å¼€å¤´çš„è¡¨å¹¶ä¸æ˜¯çœŸæ­£çš„å†…éƒ¨ç³»ç»Ÿè¡¨ (å†…éƒ¨ç³»ç»Ÿè¡¨å°±æ˜¯æˆ‘ä»¬ä¸Šè¾¹ä»¥<code>SYS</code>å¼€å¤´çš„é‚£äº›è¡¨)ï¼Œè€Œæ˜¯åœ¨å­˜å‚¨å¼•æ“å¯åŠ¨æ—¶è¯»å–è¿™äº›ä»¥<code>SYS</code>å¼€å¤´çš„ç³»ç»Ÿè¡¨ï¼Œç„¶åå¡«å……åˆ°è¿™äº›ä»¥<code>INNODB_SYS</code>å¼€å¤´çš„è¡¨ä¸­ã€‚ä»¥<code>INNODB_SYS</code>å¼€å¤´çš„è¡¨å’Œä»¥<code>SYS</code>å¼€å¤´çš„è¡¨ä¸­çš„å­—æ®µå¹¶ä¸å®Œå…¨ä¸€æ ·ï¼Œä½†ä»…ä¾›å¤§å®¶å‚è€ƒå·²ç»è¶³çŸ£ã€‚</p><hr><h2 id="é™„å½•ï¼šæ•°æ®é¡µåŠ è½½çš„ä¸‰ç§æ–¹å¼">é™„å½•ï¼šæ•°æ®é¡µåŠ è½½çš„ä¸‰ç§æ–¹å¼</h2><p>InnoDBä»ç£ç›˜ä¸­è¯»å–æ•°æ®<code>æœ€å°å•ä½</code>æ˜¯æ•°æ®é¡µã€‚è€Œä½ æƒ³å¾—åˆ°çš„ id = xxx çš„æ•°æ®ï¼Œå°±æ˜¯è¿™ä¸ªæ•°æ®é¡µä¼—å¤šè¡Œä¸­çš„ä¸€è¡Œã€‚</p><p>å¯¹äºMySQLå­˜æ”¾çš„æ•°æ®ï¼Œé€»è¾‘æ¦‚å¿µä¸Šæˆ‘ä»¬ç§°ä¹‹ä¸ºè¡¨ï¼Œåœ¨ç£ç›˜ç­‰ç‰©ç†å±‚é¢è€Œè¨€æ˜¯æŒ‰<code>æ•°æ®é¡µ</code>å½¢å¼è¿›è¡Œå­˜æ”¾çš„ï¼Œå½“å…¶åŠ è½½åˆ° MySQL ä¸­æˆ‘ä»¬ç§°ä¹‹ä¸º<code>ç¼“å­˜é¡µ</code>ã€‚</p><p>å¦‚æœç¼“å†²æ± æ²¡æœ‰è¯¥é¡µæ•°æ®ï¼Œé‚£ä¹ˆç¼“å†²æ± æœ‰ä»¥ä¸‹ä¸‰ç§è¯»å–æ•°æ®çš„æ–¹å¼ï¼Œæ¯ç§æ–¹å¼çš„è¯»å–é€Ÿç‡æ˜¯ä¸åŒçš„ï¼š</p><div class="tabs" id="d1e131f6-5cb4-4dbf-8cae-9d380d3d2be5"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#d1e131f6-5cb4-4dbf-8cae-9d380d3d2be5-1"><i class="fas fa-award"></i>1.å†…å­˜è¯»å–</button></li><li class="tab"><button type="button" data-href="#d1e131f6-5cb4-4dbf-8cae-9d380d3d2be5-2"><i class="fas fa-baseball-ball"></i>2.éšæœºè¯»å–</button></li><li class="tab"><button type="button" data-href="#d1e131f6-5cb4-4dbf-8cae-9d380d3d2be5-3"><i class="fas fa-bone"></i>3.é¡ºåºè¯»å–</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="d1e131f6-5cb4-4dbf-8cae-9d380d3d2be5-1"><p>å¦‚æœè¯¥æ•°æ®å­˜åœ¨äºå†…å­˜ä¸­ï¼ŒåŸºæœ¬ä¸Šæ‰§è¡Œæ—¶é—´åœ¨ 1ms å·¦å³ï¼Œæ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220621135638283.png" alt="image-20220621135638283"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d1e131f6-5cb4-4dbf-8cae-9d380d3d2be5-2"><p>å¦‚æœæ•°æ®æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œå°±éœ€è¦åœ¨ç£ç›˜ä¸Šå¯¹è¯¥é¡µè¿›è¡ŒæŸ¥æ‰¾ï¼Œæ•´ä½“æ—¶é—´é¢„ä¼°åœ¨<code>10ms</code>å·¦å³ï¼Œè¿™ 10ms ä¸­æœ‰ 6ms æ˜¯ç£ç›˜çš„å®é™…ç¹å¿™æ—¶é—´ï¼ˆåŒ…æ‹¬äº†<code>å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´</code>ï¼‰ï¼Œæœ‰3ms æ˜¯å¯¹å¯èƒ½å‘ç”Ÿçš„æ’é˜Ÿæ—¶é—´çš„ä¼°è®¡å€¼ï¼Œå¦å¤–è¿˜æœ‰ 1ms çš„ä¼ è¾“æ—¶é—´ï¼Œå°†é¡µä»ç£å¯†æœåŠ¡å™¨ç¼“å†²åŒºä¼ è¾“åˆ°æ•°æ®åº“ç¼“å†²åŒºä¸­ã€‚è¿™ 10ms çœ‹èµ·æ¥å¾ˆå¿«ï¼Œä½†å®é™…ä¸Šå¯¹äºæ•°æ®åº“æ¥è¯´æ¶ˆè€—çš„æ—¶é—´å·²ç»éå¸¸é•¿äº†ï¼Œå› ä¸ºè¿™è¿˜åªæ˜¯ä¸€ä¸ªé¡µçš„è¯»å–æ—¶é—´ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409221031496.png" alt="image-20230409221031496"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d1e131f6-5cb4-4dbf-8cae-9d380d3d2be5-3"><p>é¡ºåºè¯»å–å…¶å®æ˜¯ä¸€ç§æ‰¹é‡è¯»å–çš„æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬è¯·æ±‚çš„<code>æ•°æ®åœ¨ç£ç›˜ä¸Šå¾€å¾€éƒ½æ˜¯ç›¸é‚»å­˜å‚¨çš„</code>ï¼Œé¡ºåºè¯»å–å¯ä»¥å¸®æˆ‘ä»¬æ‰¹é‡è¯»å–é¡µé¢ï¼Œè¿™æ ·çš„è¯ï¼Œä¸€æ¬¡æ€§åŠ è½½åˆ°ç¼“å†²æ± ä¸­å°±ä¸éœ€è¦å†å¯¹å…¶ä»–é¡µé¢å•ç‹¬è¿›è¡Œç£ç›˜1/0æ“ä½œäº†ã€‚å¦‚æœä¸€ä¸ªç£ç›˜çš„ååé‡æ˜¯ 40MB/Sï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ª 16KB å¤§å°çš„é¡µæ¥è¯´ï¼Œä¸€æ¬¡å¯ä»¥é¡ºåºè¯»å– 2560 (40MB/16KB) ä¸ªé¡µï¼Œç›¸å½“äºä¸€ä¸ªé¡µçš„è¯»å–æ—¶é—´ä¸º 0.4msã€‚é‡‡ç”¨æ‰¹é‡è¯»å–çš„æ–¹å¼ï¼Œå³ä½¿æ˜¯ä»ç£ç›˜ä¸Šè¿›è¡Œè¯»å–ï¼Œæ•ˆç‡ä¹Ÿæ¯”ä»å†…å­˜ä¸­åªå•ç‹¬è¯»å–ä¸€ä¸ªé¡µçš„æ•ˆç‡è¦é«˜ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> ]]></content>
    
    
    <summary type="html">InnoDBæ•°æ®å­˜å‚¨ç»“æ„</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQLç´¢å¼•æ•°æ®ç»“æ„</title>
    <link href="https://wuwawawa.github.io/posts/d81d61c1.html"/>
    <id>https://wuwawawa.github.io/posts/d81d61c1.html</id>
    <published>2023-04-08T00:00:00.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<blockquote><span class='p red'>ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•?</span></blockquote><p>â€‹ç´¢å¼•æ˜¯å­˜å‚¨å¼•æ“ç”¨äºå¿«é€Ÿæ‰¾åˆ°æ•°æ®è®°å½•çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°±å¥½æ¯”ä¸€æœ¬æ•™ç§‘ä¹¦çš„ç›®å½•éƒ¨åˆ†ï¼Œé€šè¿‡ç›®å½•ä¸­æ‰¾åˆ°å¯¹åº”æ–‡ç« çš„é¡µç ï¼Œä¾¿å¯å¿«é€Ÿå®šä½åˆ°éœ€è¦çš„æ–‡ç« ã€‚MySQLä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œè¿›è¡Œæ•°æ®æŸ¥æ‰¾æ—¶ï¼Œé¦–å…ˆæŸ¥çœ‹æŸ¥è¯¢æ¡ä»¶æ˜¯å¦å‘½ä¸­æŸæ¡ç´¢å¼•ï¼Œç¬¦åˆåˆ™<code>é€šè¿‡ç´¢å¼•æŸ¥æ‰¾</code>ç›¸å…³æ•°æ®ï¼Œå¦‚æœä¸ç¬¦åˆåˆ™éœ€è¦<code>å…¨è¡¨æ‰«æ</code>ï¼Œå³éœ€è¦ä¸€æ¡ä¸€æ¡åœ°æŸ¥æ‰¾è®°å½•ï¼Œç›´åˆ°æ‰¾åˆ°ä¸æ¡ä»¶ç¬¦åˆçš„è®°å½•ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616141351236.png" alt="image-20220616141351236" style="zoom:80%;" /><p>â€‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•°æ®åº“æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œæ•°æ®<code>åˆ†å¸ƒåœ¨ç¡¬ç›˜ä¸åŒçš„ä½ç½®ä¸Šé¢</code>ï¼Œè¯»å–æ•°æ®æ—¶ï¼Œæ‘†è‡‚éœ€è¦å‰åæ‘†åŠ¨æŸ¥è¯¢æ•°æ®ï¼Œè¿™æ ·æ“ä½œéå¸¸æ¶ˆè€—æ—¶é—´ã€‚å¦‚æœ<code>æ•°æ®é¡ºåºæ‘†æ”¾</code>ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦ä»1åˆ°6è¡ŒæŒ‰é¡ºåºè¯»å–ï¼Œè¿™æ ·å°±ç›¸å½“äºè¿›è¡Œäº†6æ¬¡IOæ“ä½œï¼Œ<code>ä¾æ—§éå¸¸è€—æ—¶</code>ã€‚å¦‚æœæˆ‘ä»¬ä¸å€ŸåŠ©ä»»ä½•ç´¢å¼•ç»“æ„å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½æ•°æ®çš„è¯ï¼Œæˆ‘ä»¬æŸ¥æ‰¾ Col 2 = 89 è¿™æ¡è®°å½•ï¼Œå°±è¦é€è¡Œå»æŸ¥æ‰¾ã€å»æ¯”è¾ƒã€‚ä»Col 2 = 34 å¼€å§‹ï¼Œè¿›è¡Œæ¯”è¾ƒï¼Œå‘ç°ä¸æ˜¯ï¼Œç»§ç»­ä¸‹ä¸€è¡Œã€‚æˆ‘ä»¬å½“å‰çš„è¡¨åªæœ‰ä¸åˆ°10è¡Œæ•°æ®ï¼Œä½†å¦‚æœè¡¨å¾ˆå¤§çš„è¯ï¼Œæœ‰<code>ä¸Šåƒä¸‡æ¡æ•°æ®</code>ï¼Œå°±æ„å‘³ç€è¦åš<code>å¾ˆå¤šå¾ˆå¤šæ¬¡ç¡¬ç›˜I/0</code>æ‰èƒ½æ‰¾åˆ°ã€‚ç°åœ¨è¦æŸ¥æ‰¾ Col 2 = 89 è¿™æ¡è®°å½•ã€‚CPUå¿…é¡»å…ˆå»ç£ç›˜æŸ¥æ‰¾è¿™æ¡è®°å½•ï¼Œæ‰¾åˆ°ä¹‹ååŠ è½½åˆ°å†…å­˜ï¼Œå†å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚è¿™ä¸ªè¿‡ç¨‹æœ€è€—æ—¶é—´å°±æ˜¯ç£ç›˜I/Oï¼ˆæ¶‰åŠåˆ°ç£ç›˜çš„æ—‹è½¬æ—¶é—´ï¼ˆé€Ÿåº¦è¾ƒå¿«ï¼‰ï¼Œç£å¤´çš„å¯»é“æ—¶é—´(é€Ÿåº¦æ…¢ã€è´¹æ—¶)ï¼‰</p><p>å‡å¦‚ç»™æ•°æ®ä½¿ç”¨<code>äºŒå‰æ ‘</code>è¿™æ ·çš„æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616142723266.png" alt="image-20220616142723266" style="zoom: 50%;" /><p>å¯¹å­—æ®µ Col 2 æ·»åŠ äº†ç´¢å¼•ï¼Œå°±ç›¸å½“äºåœ¨ç¡¬ç›˜ä¸Šä¸º Col 2 ç»´æŠ¤äº†ä¸€ä¸ªç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œå³è¿™ä¸ª<code>äºŒå‰æœç´¢æ ‘</code>ã€‚äºŒå‰æœç´¢æ ‘çš„æ¯ä¸ªç»“ç‚¹å­˜å‚¨çš„æ˜¯<code>(K, V) ç»“æ„</code>ï¼Œkey æ˜¯ Col 2ï¼Œvalue æ˜¯è¯¥ key æ‰€åœ¨è¡Œçš„æ–‡ä»¶æŒ‡é’ˆï¼ˆåœ°å€ï¼‰ã€‚æ¯”å¦‚ï¼šè¯¥äºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹å°±æ˜¯ï¼š<code>(34, 0x07)</code>ã€‚ç°åœ¨å¯¹ Col 2 æ·»åŠ äº†ç´¢å¼•ï¼Œè¿™æ—¶å†å»æŸ¥æ‰¾ Col 2 = 89 è¿™æ¡è®°å½•çš„æ—¶å€™ä¼šå…ˆå»æŸ¥æ‰¾è¯¥äºŒå‰æœç´¢æ ‘ï¼ˆäºŒå‰æ ‘çš„éå†æŸ¥æ‰¾ï¼‰ã€‚è¯» 34 åˆ°å†…å­˜ï¼Œ89 &gt; 34; ç»§ç»­å³ä¾§æ•°æ®ï¼Œè¯» 89 åˆ°å†…å­˜ï¼Œ89==89ï¼›æ‰¾åˆ°æ•°æ®è¿”å›ã€‚æ‰¾åˆ°ä¹‹åå°±æ ¹æ®å½“å‰ç»“ç‚¹çš„ value å¿«é€Ÿå®šä½åˆ°è¦æŸ¥æ‰¾çš„è®°å½•å¯¹åº”çš„åœ°å€ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåªéœ€è¦<code>æŸ¥æ‰¾ä¸¤æ¬¡</code>å°±å¯ä»¥å®šä½åˆ°è®°å½•çš„åœ°å€ï¼ŒæŸ¥è¯¢é€Ÿåº¦å°±æé«˜äº†ã€‚</p><p>è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å»ºç´¢å¼•ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†<code>å‡å°‘ç£ç›˜I/Oçš„æ¬¡æ•°</code>ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿç‡ã€‚</p><hr><h2 id="1-ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹">1. ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹</h2><p>MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼š<span class='p red'>ç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚</span></p><span class='p green'>ç´¢å¼•çš„æœ¬è´¨</span>ï¼šç´¢å¼•æ˜¯æ•°æ®ç»“æ„ã€‚ä½ å¯ä»¥ç®€å•ç†è§£ä¸ºâ€œæ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„â€ï¼Œæ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•ã€‚ è¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼æŒ‡å‘æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„çš„åŸºç¡€ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³• ã€‚<br/><p>ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“ä¸­å®ç°ï¼Œå› æ­¤æ¯ç§å­˜å‚¨å¼•æ“çš„ç´¢å¼•ä¸ä¸€å®šå®Œå…¨ç›¸åŒï¼Œå¹¶ä¸”æ¯ç§å­˜å‚¨å¼•æ“ä¸ä¸€å®šæ”¯æŒæ‰€æœ‰ç´¢å¼•ç±»å‹ã€‚åŒæ—¶ï¼Œå­˜å‚¨å¼•æ“å¯ä»¥å®šä¹‰æ¯ä¸ªè¡¨çš„ æœ€å¤§ç´¢å¼•å’Œ æœ€å¤§ç´¢å¼•é•¿åº¦ã€‚æ‰€æœ‰å­˜å‚¨å¼•æ“æ”¯æŒæ¯ä¸ªè¡¨è‡³å°‘16ä¸ªç´¢å¼•ï¼Œæ€»ç´¢å¼•é•¿åº¦è‡³å°‘ä¸º256å­—èŠ‚ã€‚æœ‰äº›å­˜å‚¨å¼•æ“æ”¯æŒæ›´å¤šçš„ç´¢å¼•æ•°å’Œæ›´å¤§çš„ç´¢å¼•é•¿åº¦ã€‚</p><div class="tabs" id="6b6452ca-3179-4180-9a5f-03a5089a65c3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#6b6452ca-3179-4180-9a5f-03a5089a65c3-1"><i class="fas fa-award"></i>ä¼˜ç‚¹</button></li><li class="tab"><button type="button" data-href="#6b6452ca-3179-4180-9a5f-03a5089a65c3-2"><i class="fas fa-baseball-ball"></i>ç¼ºç‚¹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="6b6452ca-3179-4180-9a5f-03a5089a65c3-1"><p>ï¼ˆ1ï¼‰ç±»ä¼¼å¤§å­¦å›¾ä¹¦é¦†å»ºä¹¦ç›®ç´¢å¼•ï¼Œæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½<code>æ•°æ®åº“çš„IOæˆæœ¬</code>ï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•æœ€ä¸»è¦çš„åŸå› ã€‚</p><p>ï¼ˆ2ï¼‰é€šè¿‡åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œ<code>æ•°æ®çš„å”¯ä¸€æ€§</code>ã€‚</p><p>ï¼ˆ3ï¼‰åœ¨å®ç°æ•°æ®çš„ å‚è€ƒå®Œæ•´æ€§æ–¹é¢ï¼Œå¯ä»¥<code>åŠ é€Ÿè¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥</code>ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºæœ‰ä¾èµ–å…³ç³»çš„å­è¡¨å’Œçˆ¶è¡¨è”åˆæŸ¥è¯¢æ—¶ï¼Œ å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>ï¼ˆ4ï¼‰åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥æ˜¾è‘—<code>å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºçš„æ—¶é—´</code>ï¼Œé™ä½äº†CPUçš„æ¶ˆè€—ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6b6452ca-3179-4180-9a5f-03a5089a65c3-2"><p>å¢åŠ ç´¢å¼•ä¹Ÿæœ‰è®¸å¤šä¸åˆ©çš„æ–¹é¢ï¼Œä¸»è¦è¡¨ç°åœ¨å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><p>ï¼ˆ1ï¼‰åˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦<code>è€—è´¹æ—¶é—´</code>ï¼Œå¹¶ä¸”éšç€æ•°æ®é‡çš„å¢åŠ ï¼Œæ‰€è€—è´¹çš„æ—¶é—´ä¹Ÿä¼šå¢åŠ ã€‚</p><p>ï¼ˆ2ï¼‰ç´¢å¼•éœ€è¦å <code>ç£ç›˜ç©ºé—´</code>ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œ å­˜å‚¨åœ¨ç£ç›˜ä¸Š ï¼Œå¦‚æœæœ‰å¤§é‡çš„ç´¢å¼•ï¼Œç´¢å¼•æ–‡ä»¶å°±å¯èƒ½æ¯”æ•°æ®æ–‡ä»¶æ›´å¿«è¾¾åˆ°æœ€å¤§æ–‡ä»¶å°ºå¯¸ã€‚</p><p>ï¼ˆ3ï¼‰è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼š<code>é™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦</code>ã€‚å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€åœ°ç»´æŠ¤ï¼Œè¿™æ ·å°±é™ä½äº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚ å› æ­¤ï¼Œé€‰æ‹©ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ç´¢å¼•çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p><p>å› æ­¤ï¼Œé€‰æ‹©ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ç´¢å¼•çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p><blockquote><p>æç¤ºï¼š</p><p>ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œä½†æ˜¯ä¼šå½±å“æ’å…¥è®°å½•çš„é€Ÿåº¦ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯å…ˆåˆ é™¤è¡¨ä¸­çš„ç´¢å¼•ï¼Œç„¶åæ’å…¥æ•°æ®ï¼Œæ’å…¥å®Œæˆåå†åˆ›å»ºç´¢å¼•ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><blockquote><span class='p green'>InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”-é€’è¿›çš„æ–¹å¼</span></blockquote><h2 id="2-æ— ç´¢å¼•ä¸‹çš„æŸ¥æ‰¾">2. æ— ç´¢å¼•ä¸‹çš„æŸ¥æ‰¾</h2><p>å…ˆæ¥çœ‹ä¸€ä¸ªç²¾ç¡®åŒ¹é…çš„ä¾‹å­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [åˆ—ååˆ—è¡¨] <span class="keyword">FROM</span> è¡¨å <span class="keyword">WHERE</span> åˆ—å <span class="operator">=</span> xxx;</span><br></pre></td></tr></table></figure><div class="tabs" id="482166e2-fc75-42e4-9c3f-2da254c45bc1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#482166e2-fc75-42e4-9c3f-2da254c45bc1-1"><i class="fas fa-bug"></i>åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾</button></li><li class="tab"><button type="button" data-href="#482166e2-fc75-42e4-9c3f-2da254c45bc1-2"><i class="fas fa-cannabis"></i>åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="482166e2-fc75-42e4-9c3f-2da254c45bc1-1"><p>å‡è®¾ç›®å‰è¡¨ä¸­çš„è®°å½•æ¯”è¾ƒå°‘ï¼Œæ‰€æœ‰çš„è®°å½•éƒ½å¯ä»¥è¢«å­˜æ”¾åˆ°ä¸€ä¸ªé¡µä¸­ï¼Œåœ¨æŸ¥æ‰¾è®°å½•çš„æ—¶å€™å¯ä»¥æ ¹æ®æœç´¢æ¡ä»¶çš„ä¸åŒåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li><p>ä»¥ä¸»é”®ä¸ºæœç´¢æ¡ä»¶</p><p>å¯ä»¥åœ¨é¡µç›®å½•ä¸­ä½¿ç”¨<code>äºŒåˆ†æ³•</code>å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹ç”¨åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šè®°å½•ã€‚</p></li><li><p>ä»¥å…¶ä»–åˆ—ä½œä¸ºæœç´¢æ¡ä»¶</p><p>å› ä¸ºåœ¨æ•°æ®é¡µä¸­å¹¶æ²¡æœ‰å¯¹éä¸»é”®åˆ—ç®€å†æ‰€è°“çš„é¡µç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½ç›¸åº”çš„æ§½ã€‚è¿™ç§æƒ…å†µä¸‹åªèƒ½ä»<code>æœ€å°è®°å½•</code>å¼€å§‹<code>ä¾æ¬¡éå†å•é“¾è¡¨ä¸­çš„æ¯æ¡è®°å½•</code>ï¼Œ ç„¶åå¯¹æ¯”æ¯æ¡è®°å½•æ˜¯ä¸æ˜¯ç¬¦åˆæœç´¢æ¡ä»¶ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§æŸ¥æ‰¾çš„æ•ˆç‡æ˜¯éå¸¸ä½çš„ã€‚</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="482166e2-fc75-42e4-9c3f-2da254c45bc1-2"><p>åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾è®°å½•çš„æ´»åŠ¨å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>å®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µã€‚</li><li>ä»æ‰€åœ¨çš„é¡µå†…ä¸­æŸ¥æ‰¾ç›¸åº”çš„è®°å½•ã€‚</li></ol><p>åœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¸è®ºæ˜¯æ ¹æ®ä¸»é”®åˆ—æˆ–è€…å…¶ä»–åˆ—çš„å€¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œç”±äºæˆ‘ä»¬å¹¶ä¸èƒ½å¿«é€Ÿçš„å®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µï¼Œæ‰€ä»¥åªèƒ½ ä»<code>ç¬¬ä¸€ä¸ªé¡µ</code>æ²¿ç€<code>åŒå‘é“¾è¡¨</code>ä¸€ç›´å¾€ä¸‹æ‰¾ï¼Œåœ¨æ¯ä¸€ä¸ªé¡µä¸­æ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„æŸ¥æ‰¾æ–¹å¼å»æŸ¥ æ‰¾æŒ‡å®šçš„è®°å½•ã€‚å› ä¸ºè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼æ˜¾ç„¶æ˜¯ è¶…çº§è€—æ—¶ çš„ã€‚å¦‚æœä¸€ä¸ªè¡¨æœ‰ä¸€äº¿æ¡è®°å½•å‘¢ï¼Ÿæ­¤æ—¶<code>ç´¢å¼•</code>åº”è¿è€Œç”Ÿã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h2 id="3-è®¾è®¡ç´¢å¼•">3. è®¾è®¡ç´¢å¼•</h2><div class="tabs" id="cba09c0a-f57e-4b13-ac4b-18f08dac81a7"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#cba09c0a-f57e-4b13-ac4b-18f08dac81a7-1"><i class="fas fa-bug"></i>1</button></li><li class="tab"><button type="button" data-href="#cba09c0a-f57e-4b13-ac4b-18f08dac81a7-2"><i class="fas fa-cannabis"></i>2</button></li><li class="tab"><button type="button" data-href="#cba09c0a-f57e-4b13-ac4b-18f08dac81a7-3"><i class="fas fa-candy-cane"></i>3</button></li><li class="tab"><button type="button" data-href="#cba09c0a-f57e-4b13-ac4b-18f08dac81a7-4"><i class="fas fa-child"></i>4</button></li><li class="tab"><button type="button" data-href="#cba09c0a-f57e-4b13-ac4b-18f08dac81a7-5"><i class="fas fa-fire-alt"></i>5</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="cba09c0a-f57e-4b13-ac4b-18f08dac81a7-1"><p>å»ºä¸€ä¸ªè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> index_demo(</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> c1 <span class="type">INT</span>,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> c2 <span class="type">INT</span>,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> c3 <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">PRIMARY</span> KEY(c1)</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> ) ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–°å»ºçš„<code>index_demo</code>è¡¨ä¸­æœ‰2ä¸ªINTç±»å‹çš„åˆ—ï¼Œ1ä¸ªCHAR(1)ç±»å‹çš„åˆ—ï¼Œè€Œä¸”æˆ‘ä»¬è§„å®šäº†c1åˆ—ä¸ºä¸»é”®ï¼Œ è¿™ä¸ªè¡¨ä½¿ç”¨<code>Compact</code>è¡Œæ ¼å¼æ¥å®é™…å­˜å‚¨è®°å½•çš„ã€‚è¿™é‡Œæˆ‘ä»¬ç®€åŒ–äº†index_demoè¡¨çš„è¡Œæ ¼å¼ç¤ºæ„å›¾ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616152453203.png" alt="image-20220616152453203" style="zoom:50%;" /><p>æˆ‘ä»¬åªåœ¨ç¤ºæ„å›¾é‡Œå±•ç¤ºè®°å½•çš„è¿™å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>record_type ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºè®°å½•çš„ç±»å‹ï¼Œ 0 è¡¨ç¤ºæ™®é€šè®°å½•ã€ 2 è¡¨ç¤ºæœ€å°è®°å½•ã€ 3 è¡¨ç¤ºæœ€å¤§è®°å½•ã€ 1 æš‚æ—¶è¿˜æ²¡ç”¨è¿‡ï¼Œä¸‹é¢è®²ã€‚</li><li>mysql&gt; CREATE TABLE index_demo( -&gt; c1 INT, -&gt; c2 INT, -&gt; c3 CHAR(1), -&gt; PRIMARY KEY(c1) -&gt; ) ROW_FORMAT = Compact; next_record ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¡åœ°å€ç›¸å¯¹äºæœ¬æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼Œæˆ‘ä»¬ç”¨ ç®­å¤´æ¥è¡¨æ˜ä¸‹ä¸€æ¡è®°å½•æ˜¯è°ã€‚</li><li>å„ä¸ªåˆ—çš„å€¼ ï¼šè¿™é‡Œåªè®°å½•åœ¨ index_demo è¡¨ä¸­çš„ä¸‰ä¸ªåˆ—ï¼Œåˆ†åˆ«æ˜¯ c1 ã€c2 å’Œ c3 ã€‚</li><li>å…¶ä»–ä¿¡æ¯ ï¼šé™¤äº†ä¸Šè¿°3ç§ä¿¡æ¯ä»¥å¤–çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ä»–éšè—åˆ—çš„å€¼ä»¥åŠè®°å½•çš„é¢å¤–ä¿¡æ¯ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cba09c0a-f57e-4b13-ac4b-18f08dac81a7-2"><p>å°†è®°å½•æ ¼å¼ç¤ºæ„å›¾çš„å…¶ä»–ä¿¡æ¯é¡¹æš‚æ—¶å»æ‰å¹¶æŠŠå®ƒç«–èµ·æ¥çš„æ•ˆæœå°±æ˜¯è¿™æ · å’Œ æŠŠä¸€äº›è®°å½•æ”¾åˆ°é¡µé‡Œçš„ç¤ºæ„å›¾å°±æ˜¯ï¼š</p><div class="fj-gallery"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616152727234.png" alt="image-20220616152727234" style="zoom: 50%;" /><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616152651878.png" alt="image-20220616152651878" style="zoom:50%;" />          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cba09c0a-f57e-4b13-ac4b-18f08dac81a7-3"><p>æˆ‘ä»¬åœ¨æ ¹æ®æŸä¸ªæœç´¢æ¡ä»¶æŸ¥æ‰¾ä¸€äº›è®°å½•æ—¶ä¸ºä»€ä¹ˆè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µå‘¢ï¼Ÿå› ä¸ºå„ä¸ªé¡µä¸­çš„è®°å½•å¹¶æ²¡æœ‰è§„å¾‹ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„æœç´¢æ¡ä»¶åŒ¹é…å“ªäº›é¡µä¸­çš„è®°å½•ï¼Œæ‰€ä»¥ä¸å¾—ä¸ä¾æ¬¡éå†æ‰€æœ‰çš„æ•°æ®é¡µã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬<code>æƒ³å¿«é€Ÿçš„å®šä½åˆ°éœ€è¦æŸ¥æ‰¾çš„è®°å½•åœ¨å“ªäº›æ•°æ®é¡µ</code>ä¸­è¯¥å’‹åŠï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸ºå¿«é€Ÿå®šä½è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µè€Œå»ºç«‹ä¸€ä¸ªç›®å½• ï¼Œå»ºè¿™ä¸ªç›®å½•å¿…é¡»å®Œæˆä¸‹è¾¹è¿™äº›äº‹ï¼š</p><p>*<code>ä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚</code></p><p>å‡è®¾ï¼šæ¯é¡µæœ€å¤šèƒ½å­˜æ”¾3æ¡è®°å½•ï¼ˆå®é™…ä¸Šä¸€ä¸ªæ•°æ®é¡µéå¸¸å¤§ï¼Œå¯ä»¥å­˜æ”¾ä¸‹å¥½å¤šè®°å½•ï¼‰ã€‚</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> index_demo <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="number">4</span>, <span class="string">&#x27;u&#x27;</span>), (<span class="number">3</span>, <span class="number">9</span>, <span class="string">&#x27;d&#x27;</span>), (<span class="number">5</span>, <span class="number">3</span>, <span class="string">&#x27;y&#x27;</span>);</span><br></pre></td></tr></table></figure><p>â€‹      é‚£ä¹ˆè¿™äº›è®°å½•ä»¥åŠæŒ‰ç…§ä¸»é”®å€¼çš„å¤§å°ä¸²è”æˆä¸€ä¸ªå•å‘é“¾è¡¨äº†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616153518456.png" alt="image-20220616153518456" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cba09c0a-f57e-4b13-ac4b-18f08dac81a7-4"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œ index_demo è¡¨ä¸­çš„3æ¡è®°å½•éƒ½è¢«æ’å…¥åˆ°äº†ç¼–å·ä¸º10çš„æ•°æ®é¡µä¸­äº†ã€‚æ­¤æ—¶æˆ‘ä»¬å†æ¥æ’å…¥ä¸€æ¡è®°å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> index_demo <span class="keyword">VALUES</span>(<span class="number">4</span>, <span class="number">4</span>, <span class="string">&#x27;a&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>é¡µ10</code>æœ€å¤šåªèƒ½æ”¾3æ¡è®°å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¾—ä¸å†åˆ†é…ä¸€ä¸ªæ–°é¡µï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616155306705.png" alt="image-20220616155306705" style="zoom:50%;" /><p>æ³¨æ„ï¼šæ–°åˆ†é…çš„<code>æ•°æ®é¡µç¼–å·å¯èƒ½å¹¶ä¸æ˜¯è¿ç»­çš„</code>ã€‚å®ƒä»¬åªæ˜¯é€šè¿‡ç»´æŠ¤è€…ä¸Šä¸€ä¸ªé¡µå’Œä¸‹ä¸€ä¸ªé¡µçš„ç¼–å·è€Œå»ºç«‹äº†<code>é“¾è¡¨</code>å…³ç³»ã€‚å¦å¤–ï¼Œ<code>é¡µ10</code>ä¸­ç”¨æˆ·è®°å½•æœ€å¤§çš„ä¸»é”®å€¼æ˜¯5ï¼Œè€Œ<code>é¡µ28</code>ä¸­æœ‰ä¸€æ¡è®°å½•çš„ä¸»é”®å€¼æ˜¯4ï¼Œå› ä¸º5&gt;4ï¼Œæ‰€ä»¥è¿™å°±ä¸ç¬¦åˆä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼çš„è¦æ±‚ï¼Œæ‰€ä»¥åœ¨æ’å…¥ä¸»é”®å€¼ä¸º4çš„è®°å½•çš„æ—¶å€™éœ€è¦ä¼´éšç€ä¸€æ¬¡<code>è®°å½•ç§»åŠ¨</code>ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸»é”®å€¼ä¸º5çš„è®°å½•ç§»åŠ¨åˆ°é¡µ28ä¸­ï¼Œç„¶åå†æŠŠä¸»é”®å€¼ä¸º4çš„è®°å½•æ’å…¥åˆ°é¡µ10ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616160216525.png" alt="image-20220616160216525" style="zoom:50%;" /><p>è¿™ä¸ªè¿‡ç¨‹è¡¨æ˜äº†åœ¨å¯¹é¡µä¸­çš„è®°å½•è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ä¸€äº›è¯¸å¦‚<code>è®°å½•ç§»åŠ¨</code>çš„æ“ä½œæ¥å§‹ç»ˆä¿è¯è¿™ä¸ªçŠ¶æ€ä¸€ç›´æˆç«‹ï¼šä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<code>é¡µåˆ†è£‚</code>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cba09c0a-f57e-4b13-ac4b-18f08dac81a7-5"><p>ç»™æ‰€æœ‰çš„é¡µå»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ã€‚</p><p>ç”±äºæ•°æ®é¡µçš„<code>ç¼–å·å¯èƒ½æ˜¯ä¸è¿ç»­</code>çš„ï¼Œæ‰€ä»¥åœ¨å‘ index_demo è¡¨ä¸­æ’å…¥è®¸å¤šæ¡è®°å½•åï¼Œå¯èƒ½æ˜¯è¿™æ ·çš„æ•ˆæœï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616160619525.png" alt="image-20220616160619525" style="zoom:50%;" /><p>æˆ‘ä»¬éœ€è¦ç»™å®ƒä»¬åšä¸ª<code>ç›®å½•</code>ï¼Œæ¯ä¸ªé¡µå¯¹åº”ä¸€ä¸ªç›®å½•é¡¹ï¼Œæ¯ä¸ªç›®å½•é¡¹åŒ…æ‹¬ä¸‹è¾¹ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>1ï¼‰é¡µçš„ç”¨æˆ·è®°å½•ä¸­æœ€å°çš„ä¸»é”®å€¼ï¼Œæˆ‘ä»¬ç”¨<code>key</code>æ¥è¡¨ç¤ºã€‚</p><p>2ï¼‰é¡µå·ï¼Œæˆ‘ä»¬ç”¨<code>page_on</code>è¡¨ç¤ºã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616160857381.png" alt="image-20220616160857381" style="zoom:50%;" /><p>ä»¥ é¡µ28 ä¸ºä¾‹ï¼Œå®ƒå¯¹åº” ç›®å½•é¡¹2 ï¼Œè¿™ä¸ªç›®å½•é¡¹ä¸­åŒ…å«ç€è¯¥é¡µçš„é¡µå· 28 ä»¥åŠè¯¥é¡µä¸­ç”¨æˆ·è®°å½•çš„æœ€å°ä¸»é”®å€¼ 5 ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå‡ ä¸ªç›®å½•é¡¹åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸Šè¿ç»­å­˜å‚¨ï¼ˆæ¯”å¦‚ï¼šæ•°ç»„ï¼‰ï¼Œå°±å¯ä»¥å®ç°æ ¹æ®ä¸»é”®å€¼å¿«é€ŸæŸ¥æ‰¾æŸæ¡è®°å½•çš„åŠŸèƒ½äº†ã€‚æ¯”å¦‚ï¼šæŸ¥æ‰¾ä¸»é”®å€¼ä¸º 20 çš„è®°å½•ï¼Œå…·ä½“æŸ¥æ‰¾è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</p><ol><li>å…ˆä»ç›®å½•é¡¹ä¸­æ ¹æ® äºŒåˆ†æ³•å¿«é€Ÿç¡®å®šå‡ºä¸»é”®å€¼ä¸º 20 çš„è®°å½•åœ¨ ç›®å½•é¡¹3 ä¸­ï¼ˆå› ä¸º 12 &lt; 20 &lt; 209 ï¼‰ï¼Œå®ƒå¯¹åº”çš„é¡µæ˜¯é¡µ9 ã€‚</li><li>å†æ ¹æ®å‰è¾¹è¯´çš„åœ¨é¡µä¸­æŸ¥æ‰¾è®°å½•çš„æ–¹å¼å» é¡µ9 ä¸­å®šä½å…·ä½“çš„è®°å½•ã€‚</li></ol><p>è‡³æ­¤ï¼Œé’ˆå¯¹æ•°æ®é¡µåšçš„ç®€æ˜“ç›®å½•å°±æå®šäº†ã€‚è¿™ä¸ªç›®å½•æœ‰ä¸€ä¸ªåˆ«åï¼Œç§°ä¸º<code>ç´¢å¼•</code>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><blockquote><span class='p green'>åŸºäºä¸Šé¢è®¾è®¡å‡ºçš„ç´¢å¼•æˆ‘ä»¬è¿›è¡Œè¿­ä»£</span></blockquote><h2 id="4-InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ">4. InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</h2><div class="tabs" id="1c9644dd-b3c9-48ae-8bc2-1d34214b03d0"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1c9644dd-b3c9-48ae-8bc2-1d34214b03d0-1"><i class="fas fa-atom"></i>â‘  è¿­ä»£1æ¬¡</button></li><li class="tab"><button type="button" data-href="#1c9644dd-b3c9-48ae-8bc2-1d34214b03d0-2"><i class="far fa-sun"></i>â‘¡ è¿­ä»£2æ¬¡</button></li><li class="tab"><button type="button" data-href="#1c9644dd-b3c9-48ae-8bc2-1d34214b03d0-3"><i class="fas fa-wind"></i>â‘¢ è¿­ä»£3æ¬¡</button></li><li class="tab"><button type="button" data-href="#1c9644dd-b3c9-48ae-8bc2-1d34214b03d0-4"><i class="fas fa-fire-alt"></i>B+Tree</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1c9644dd-b3c9-48ae-8bc2-1d34214b03d0-1"><blockquote><p><span class='p green'>ç›®å½•é¡¹çºªå½•çš„é¡µ</span></p></blockquote><p>ä¸Šè¾¹ç§°ä¸ºä¸€ä¸ªç®€æ˜“çš„ç´¢å¼•æ–¹æ¡ˆï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸ºäº†åœ¨æ ¹æ®ä¸»é”®å€¼è¿›è¡ŒæŸ¥æ‰¾æ—¶ä½¿ç”¨<code>äºŒåˆ†æ³•</code>å¿«é€Ÿå®šä½å…·ä½“çš„ç›®å½•é¡¹è€Œ<code>å‡è®¾</code>æ‰€æœ‰ç›®å½•é¡¹éƒ½å¯ä»¥åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸Š<code>è¿ç»­å­˜å‚¨</code>ï¼Œä½†æ˜¯è¿™æ ·åšæœ‰å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li><p>InnoDBæ˜¯ä½¿ç”¨é¡µæ¥ä½œä¸ºç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œæœ€å¤šèƒ½ä¿è¯<code>16KB</code>çš„è¿ç»­å­˜å‚¨ç©ºé—´ï¼Œè€Œéšç€è¡¨ä¸­è®°å½•æ•°é‡çš„å¢å¤šï¼Œéœ€è¦<code>éå¸¸å¤§çš„è¿ç»­çš„å­˜å‚¨ç©ºé—´</code>æ‰èƒ½æŠŠæ‰€æœ‰çš„ç›®å½•é¡¹éƒ½æ”¾ä¸‹ï¼Œè¿™å¯¹è®°å½•æ•°é‡éå¸¸å¤šçš„è¡¨æ˜¯ä¸ç°å®çš„ã€‚</p></li><li><p>æˆ‘ä»¬æ—¶å¸¸ä¼šå¯¹<code>è®°å½•è¿›è¡Œå¢åˆ </code>ï¼Œå‡è®¾æˆ‘ä»¬æŠŠ<code>é¡µ28</code>ä¸­çš„è®°å½•éƒ½å·é™¤äº†ï¼Œé‚£æ„å‘³ç€<code>ç›®å½•é¡¹2</code>ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼Œè¿™å°±éœ€è¦æŠŠç›®å½•é¡¹2åçš„ç›®å½•é¡¹éƒ½å‘å‰ç§»åŠ¨ä¸€ä¸‹ï¼Œè¿™æ ·ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„æ“ä½œæ•ˆç‡å¾ˆå·®ã€‚</p></li></ul><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§å¯ä»¥<code>çµæ´»ç®¡ç†æ‰€æœ‰ç›®å½•é¡¹</code>çš„æ–¹å¼ã€‚æˆ‘ä»¬å‘ç°ç›®å½•é¡¹å…¶å®é•¿å¾—è·Ÿæˆ‘ä»¬çš„ç”¨æˆ·è®°å½•å·®ä¸å¤šï¼Œåªä¸è¿‡ç›®å½•é¡¹ä¸­çš„ä¸¤ä¸ªåˆ—æ˜¯<code>ä¸»é”®</code>å’Œ<code>é¡µå·</code>è€Œå·²ï¼Œä¸ºäº†å’Œç”¨æˆ·è®°å½•åšä¸€ä¸‹åŒºåˆ†ï¼Œæˆ‘ä»¬æŠŠè¿™äº›ç”¨æ¥è¡¨ç¤ºç›®å½•é¡¹çš„è®°å½•ç§°ä¸º<code>ç›®å½•é¡¹è®°å½•</code>ã€‚é‚£InnoDBæ€ä¹ˆåŒºåˆ†ä¸€æ¡è®°å½•æ˜¯æ™®é€šçš„<code>ç”¨æˆ·è®°å½•</code>è¿˜æ˜¯<code>ç›®å½•é¡¹è®°å½•</code>å‘¢ï¼Ÿä½¿ç”¨è®°å½•å¤´ä¿¡æ¯é‡Œçš„ record_type å±æ€§ï¼Œå®ƒçš„å„ä¸ªå–å€¼ä»£è¡¨çš„æ„æ€å¦‚ä¸‹ï¼š</p><ul><li>0ï¼šæ™®é€šçš„ç”¨æˆ·è®°å½•</li><li>1ï¼šç›®å½•é¡¹è®°å½•</li><li>2ï¼šæœ€å°è®°å½•</li><li>3ï¼šæœ€å¤§è®°å½•</li></ul><p>æˆ‘ä»¬æŠŠå‰è¾¹ä½¿ç”¨åˆ°çš„ç›®å½•é¡¹æ”¾åˆ°æ•°æ®é¡µä¸­çš„æ ·å­å°±æ˜¯è¿™æ ·ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616162944404.png" alt="image-20220616162944404" style="zoom:67%;" /><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ–°åˆ†é…äº†ä¸€ä¸ªç¼–å·ä¸º30çš„é¡µæ¥ä¸“é—¨å­˜å‚¨ç›®å½•é¡¹è®°å½•ã€‚è¿™é‡Œå†æ¬¡å¼ºè°ƒ<code>ç›®å½•é¡¹è®°å½•</code>å’Œæ™®é€šçš„<code>ç”¨æˆ·è®°å½•</code>çš„<span class='p red'>ä¸åŒç‚¹</span>ï¼š</p><p>*<code>ç›®å½•é¡¹è®°å½•</code>çš„ record_type å€¼æ˜¯1ï¼Œè€Œ<code>æ™®é€šç”¨æˆ·è®°å½•</code>çš„ record_type å€¼æ˜¯0ã€‚</p><ul><li>ç›®å½•é¡¹è®°å½•åªæœ‰<code>ä¸»é”®å€¼å’Œé¡µçš„ç¼–å·</code>ä¸¤ä¸ªåˆ—ï¼Œè€Œæ™®é€šçš„ç”¨æˆ·è®°å½•çš„åˆ—æ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ï¼Œå¯èƒ½åŒ…å«<code>å¾ˆå¤šåˆ—</code>ï¼Œå¦å¤–è¿˜æœ‰InnoDBè‡ªå·±æ·»åŠ çš„éšè—åˆ—ã€‚</li><li>äº†è§£ï¼šè®°å½•å¤´ä¿¡æ¯é‡Œè¿˜æœ‰ä¸€ä¸ªå«<code>min_rec_mask</code>çš„å±æ€§ï¼Œåªæœ‰åœ¨å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µä¸­çš„ä¸»é”®å€¼æœ€å°çš„<code>ç›®å½•é¡¹è®°å½•</code>çš„<code>min_rec_mask</code>å€¼ä¸º<code>1</code>ï¼Œå…¶ä»–åˆ«çš„è®°å½•çš„<code>min_rec_mask</code>å€¼éƒ½æ˜¯<code>0</code>ã€‚</li></ul><p><span class='p red'>ç›¸åŒç‚¹</span>ï¼šä¸¤è€…ç”¨çš„æ˜¯ä¸€æ ·çš„æ•°æ®é¡µï¼Œéƒ½ä¼šä¸ºä¸»é”®å€¼ç”Ÿæˆ<code>Page Directory ï¼ˆé¡µç›®å½•ï¼‰</code>ï¼Œä»è€Œåœ¨æŒ‰ç…§ä¸»é”®å€¼è¿›è¡ŒæŸ¥æ‰¾æ—¶å¯ä»¥ä½¿ç”¨<code>äºŒåˆ†æ³•</code>æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>ç°åœ¨ä»¥æŸ¥æ‰¾ä¸»é”®ä¸º 20 çš„è®°å½•ä¸ºä¾‹ï¼Œæ ¹æ®æŸä¸ªä¸»é”®å€¼å»æŸ¥æ‰¾è®°å½•çš„æ­¥éª¤å°±å¯ä»¥å¤§è‡´æ‹†åˆ†æˆä¸‹è¾¹ä¸¤æ­¥ï¼š</p><ol><li>å…ˆåˆ°å­˜å‚¨ ç›®å½•é¡¹è®°å½• çš„é¡µï¼Œä¹Ÿå°±æ˜¯é¡µ30ä¸­é€šè¿‡ äºŒåˆ†æ³• å¿«é€Ÿå®šä½åˆ°å¯¹åº”ç›®å½•é¡¹ï¼Œå› ä¸º 12 &lt; 20 &lt; 209 ï¼Œæ‰€ä»¥å®šä½åˆ°å¯¹åº”çš„è®°å½•æ‰€åœ¨çš„é¡µå°±æ˜¯é¡µ9ã€‚</li><li>å†åˆ°å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µ9ä¸­æ ¹æ® äºŒåˆ†æ³• å¿«é€Ÿå®šä½åˆ°ä¸»é”®å€¼ä¸º 20 çš„ç”¨æˆ·è®°å½•ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1c9644dd-b3c9-48ae-8bc2-1d34214b03d0-2"><p><span class='p green'>å¤šä¸ªç›®å½•é¡¹çºªå½•çš„é¡µ</span></p><p>è™½ç„¶è¯´<code>ç›®å½•é¡¹è®°å½•</code>ä¸­åªå­˜å‚¨ä¸»é”®å€¼å’Œå¯¹åº”çš„é¡µå·ï¼Œæ¯”ç”¨æˆ·è®°å½•éœ€è¦çš„å­˜å‚¨ç©ºé—´å°å¤šäº†ï¼Œä½†æ˜¯ä¸è®ºæ€ä¹ˆè¯´ä¸€ä¸ªé¡µåªæœ‰<code>16KB</code>å¤§å°ï¼Œèƒ½å­˜æ”¾çš„<code>ç›®å½•é¡¹è®°å½•</code>ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œé‚£å¦‚æœè¡¨ä¸­çš„æ•°æ®å¤ªå¤šï¼Œä»¥è‡³äºä¸€ä¸ªæ•°æ®é¡µä¸è¶³ä»¥å­˜æ”¾æ‰€æœ‰çš„ç›®å½•é¡¹è®°å½•ï¼Œå¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µ<code>æœ€å¤šåªèƒ½å­˜æ”¾4æ¡ç›®å½•é¡¹è®°å½•</code>ï¼Œæ‰€ä»¥å¦‚æœæ­¤æ—¶æˆ‘ä»¬å†å‘ä¸Šå›¾ä¸­æ’å…¥ä¸€æ¡ä¸»é”®å€¼ä¸º320 çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œé‚£å°±éœ€è¦åˆ†é…ä¸€ä¸ªæ–°çš„å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616171135082.png" alt="image-20220616171135082" style="zoom: 67%;" /><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æ’å…¥äº†ä¸€æ¡ä¸»é”®å€¼ä¸º320çš„ç”¨æˆ·è®°å½•ä¹‹åéœ€è¦ä¸¤ä¸ªæ–°çš„æ•°æ®é¡µï¼š</p><ul><li>ä¸ºå­˜å‚¨è¯¥ç”¨æˆ·è®°å½•è€Œæ–°ç”Ÿæˆäº† é¡µ31 ã€‚</li><li>å› ä¸ºåŸå…ˆå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„ é¡µ30çš„å®¹é‡å·²æ»¡ ï¼ˆæˆ‘ä»¬å‰è¾¹å‡è®¾åªèƒ½å­˜å‚¨4æ¡ç›®å½•é¡¹è®°å½•ï¼‰ï¼Œæ‰€ä»¥ä¸å¾— ä¸éœ€è¦ä¸€ä¸ªæ–°çš„ é¡µ32 æ¥å­˜æ”¾ é¡µ31 å¯¹åº”çš„ç›®å½•é¡¹ã€‚</li></ul><p>ç°åœ¨å› ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µä¸æ­¢ä¸€ä¸ªï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®ä¸»é”®å€¼æŸ¥æ‰¾ä¸€æ¡ç”¨æˆ·è®°å½•å¤§è‡´éœ€è¦3ä¸ªæ­¥éª¤ï¼Œä»¥æŸ¥æ‰¾ä¸»é”®å€¼ä¸º 20 çš„è®°å½•ä¸ºä¾‹ï¼š</p><ol><li>ç¡®å®š ç›®å½•é¡¹è®°å½•é¡µ æˆ‘ä»¬ç°åœ¨çš„å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µæœ‰ä¸¤ä¸ªï¼Œå³ é¡µ30 å’Œ é¡µ32 ï¼Œåˆå› ä¸ºé¡µ30è¡¨ç¤ºçš„ç›®å½•é¡¹çš„ä¸»é”®å€¼çš„ èŒƒå›´æ˜¯ [1, 320) ï¼Œé¡µ32è¡¨ç¤ºçš„ç›®å½•é¡¹çš„ä¸»é”®å€¼ä¸å°äº 320 ï¼Œæ‰€ä»¥ä¸»é”®å€¼ä¸º 20 çš„è®°å½•å¯¹åº”çš„ç›® å½•é¡¹è®°å½•åœ¨ é¡µ30 ä¸­ã€‚</li><li>é€šè¿‡ç›®å½•é¡¹è®°å½•é¡µ ç¡®å®šç”¨æˆ·è®°å½•çœŸå®æ‰€åœ¨çš„é¡µ ã€‚ åœ¨ä¸€ä¸ªå­˜å‚¨ ç›®å½•é¡¹è®°å½• çš„é¡µä¸­é€šè¿‡ä¸»é”®å€¼å®šä½ä¸€æ¡ç›®å½•é¡¹è®°å½•çš„æ–¹å¼è¯´è¿‡äº†ã€‚</li><li>åœ¨çœŸå®å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1c9644dd-b3c9-48ae-8bc2-1d34214b03d0-3"><p><code>ç›®å½•é¡¹è®°å½•é¡µçš„ç›®å½•é¡µ</code></p><p>é—®é¢˜æ¥äº†ï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢æ­¥éª¤çš„ç¬¬1æ­¥ä¸­æˆ‘ä»¬éœ€è¦å®šä½å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µï¼Œä½†æ˜¯è¿™äº›<code>é¡µæ˜¯ä¸è¿ç»­çš„</code>ï¼Œå¦‚æœæˆ‘ä»¬è¡¨ä¸­çš„æ•°æ®éå¸¸å¤šåˆ™ä¼š<code>äº§ç”Ÿå¾ˆå¤šå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µ</code>ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆæ ¹æ®ä¸»é”®å€¼å¿«é€Ÿå®šä½ä¸€ä¸ªå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µå‘¢ï¼Ÿé‚£å°±ä¸ºè¿™äº›å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µå†ç”Ÿæˆä¸€ä¸ª<code>æ›´é«˜çº§çš„ç›®å½•</code>ï¼Œå°±åƒæ˜¯ä¸€ä¸ªå¤šçº§ç›®å½•ä¸€æ ·ï¼Œ<code>å¤§ç›®å½•é‡ŒåµŒå¥—å°ç›®å½•</code>ï¼Œå°ç›®å½•é‡Œæ‰æ˜¯å®é™…çš„æ•°æ®ï¼Œæ‰€ä»¥ç°åœ¨å„ä¸ªé¡µçš„ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·å­ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616173512780.png" alt="image-20220616173512780" style="zoom:67%;" /><p>å¦‚å›¾ï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªå­˜å‚¨æ›´é«˜çº§ç›®å½•é¡¹çš„ é¡µ33 ï¼Œè¿™ä¸ªé¡µä¸­çš„ä¸¤æ¡è®°å½•åˆ†åˆ«ä»£è¡¨é¡µ30å’Œé¡µ32ï¼Œå¦‚æœç”¨ æˆ·è®°å½•çš„ä¸»é”®å€¼åœ¨ [1, 320) ä¹‹é—´ï¼Œåˆ™åˆ°é¡µ30ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„ç›®å½•é¡¹è®°å½•ï¼Œå¦‚æœä¸»é”®å€¼ ä¸å°äº320 çš„ è¯ï¼Œå°±åˆ°é¡µ32ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„ç›®å½•é¡¹è®°å½•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¾¹è¿™ä¸ªå›¾æ¥æè¿°å®ƒï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616173717538.png" alt="image-20220616173717538"></p><p>è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒçš„åç§°æ˜¯ B+æ ‘ ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1c9644dd-b3c9-48ae-8bc2-1d34214b03d0-4"><p>ä¸è®ºæ˜¯å­˜æ”¾<code>ç”¨æˆ·è®°å½•</code>çš„æ•°æ®é¡µï¼Œè¿˜æ˜¯å­˜æ”¾<code>ç›®å½•é¡¹è®°å½•</code>çš„æ•°æ®é¡µï¼Œæˆ‘ä»¬éƒ½æŠŠå®ƒä»¬å­˜æ”¾åˆ°B+æ ‘è¿™ä¸ªæ•°æ®ç»“æ„ä¸­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°è¿™äº›æ•°æ®é¡µä¸º<code>èŠ‚ç‚¹</code>ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„å®é™…ç”¨æˆ·è®°å½•å…¶å®éƒ½å­˜æ”¾åœ¨B+æ ‘çš„æœ€åº•å±‚çš„èŠ‚ç‚¹ä¸Šï¼Œè¿™äº›èŠ‚ç‚¹ä¹Ÿè¢«ç§°ä¸º<code>å¶å­èŠ‚ç‚¹</code>ï¼Œå…¶ä½™ç”¨æ¥å­˜æ”¾<code>ç›®å½•é¡¹</code>çš„èŠ‚ç‚¹ç§°ä¸º<code>éå¶å­èŠ‚ç‚¹</code>æˆ–è€…<code>å†…èŠ‚ç‚¹</code>ï¼Œå…¶ä¸­B+æ ‘æœ€ä¸Šè¾¹çš„é‚£ä¸ªèŠ‚ç‚¹ä¹Ÿç§°ä¸º<code>æ ¹èŠ‚ç‚¹</code>ã€‚</p><p>ä¸€ä¸ªB+æ ‘çš„èŠ‚ç‚¹å…¶å®å¯ä»¥åˆ†æˆå¥½å¤šå±‚ï¼Œè§„å®šæœ€ä¸‹è¾¹çš„é‚£å±‚ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾æˆ‘ä»¬ç”¨æˆ·è®°å½•çš„é‚£å±‚ä¸ºç¬¬ 0 å±‚ï¼Œ ä¹‹åä¾æ¬¡å¾€ä¸ŠåŠ ã€‚ä¹‹å‰æˆ‘ä»¬åšäº†ä¸€ä¸ªéå¸¸æç«¯çš„å‡è®¾ï¼šå­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µ æœ€å¤šå­˜æ”¾3æ¡è®°å½• ï¼Œå­˜æ”¾ç›®å½•é¡¹ è®°å½•çš„é¡µ æœ€å¤šå­˜æ”¾4æ¡è®°å½• ã€‚å…¶å®çœŸå®ç¯å¢ƒä¸­ä¸€ä¸ªé¡µå­˜æ”¾çš„è®°å½•æ•°é‡æ˜¯éå¸¸å¤§çš„ï¼Œå‡è®¾æ‰€æœ‰å­˜æ”¾ç”¨æˆ·è®°å½• çš„å¶å­èŠ‚ç‚¹ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥å­˜æ”¾ 100æ¡ç”¨æˆ·è®°å½• ï¼Œæ‰€æœ‰å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥å­˜ æ”¾ 1000æ¡ç›®å½•é¡¹è®°å½• ï¼Œé‚£ä¹ˆï¼š</p><ul><li>å¦‚æœB+æ ‘åªæœ‰1å±‚ï¼Œä¹Ÿå°±æ˜¯åªæœ‰1ä¸ªç”¨äºå­˜æ”¾ç”¨æˆ·è®°å½•çš„èŠ‚ç‚¹ï¼Œæœ€å¤šèƒ½å­˜æ”¾ 100 æ¡è®°å½•ã€‚</li><li>å¦‚æœB+æ ‘æœ‰2å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾ 1000Ã—100=10,0000 æ¡è®°å½•ã€‚</li><li>å¦‚æœB+æ ‘æœ‰3å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾ 1000Ã—1000Ã—100=1,0000,0000 æ¡è®°å½•ã€‚</li><li>å¦‚æœB+æ ‘æœ‰4å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾ 1000Ã—1000Ã—1000Ã—100=1000,0000,0000 æ¡è®°å½•ã€‚ç›¸å½“å¤šçš„è®°å½•ï¼</li></ul><p>ä½ çš„è¡¨é‡Œèƒ½å­˜æ”¾<code>100000000000</code>æ¡è®°å½•å—ï¼Ÿæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨åˆ°çš„<code>B+æ ‘éƒ½ä¸ä¼šè¶…è¿‡4å±‚</code>ï¼Œé‚£æˆ‘ä»¬é€šè¿‡ä¸»é”®å€¼å»æŸ¥æ‰¾æŸæ¡è®°å½•æœ€å¤šåªéœ€è¦åš4ä¸ªé¡µé¢å†…çš„æŸ¥æ‰¾ï¼ˆæŸ¥æ‰¾3ä¸ªç›®å½•é¡¹é¡µå’Œä¸€ä¸ªç”¨æˆ·è®°å½•é¡µï¼‰ï¼Œåˆå› ä¸ºåœ¨æ¯ä¸ªé¡µé¢å†…æœ‰æ‰€è°“çš„<code>Page Directory</code>ï¼ˆé¡µç›®å½•ï¼‰ï¼Œæ‰€ä»¥åœ¨é¡µé¢å†…ä¹Ÿå¯ä»¥é€šè¿‡<code>äºŒåˆ†æ³•</code>å®ç°å¿«é€Ÿ å®šä½è®°å½•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h2 id="5-å¸¸è§ç´¢å¼•">5. å¸¸è§ç´¢å¼•</h2><p>ç´¢å¼•æŒ‰ç…§ç‰©ç†å®ç°æ–¹å¼ï¼Œç´¢å¼•å¯ä»¥åˆ†ä¸º 2 ç§ï¼šèšç°‡ï¼ˆèšé›†ï¼‰å’Œéèšç°‡ï¼ˆéèšé›†ï¼‰ç´¢å¼•ã€‚æˆ‘ä»¬ä¹ŸæŠŠéèšé›†ç´¢å¼•ç§°ä¸ºäºŒçº§ç´¢å¼•æˆ–è€…è¾…åŠ©ç´¢å¼•ã€‚</p><h3 id="5-1-èšç°‡ç´¢å¼•">5.1 èšç°‡ç´¢å¼•</h3><p>èšç°‡ç´¢å¼•å¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ï¼Œè€Œæ˜¯<code>ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼</code>ï¼ˆæ‰€æœ‰çš„ç”¨æˆ·è®°å½•éƒ½å­˜å‚¨åœ¨äº†å¶å­ç»“ç‚¹ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<code>ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•</code>ã€‚</p><blockquote><p>æœ¯è¯­&quot;èšç°‡&quot;è¡¨ç¤ºå½“å‰æ•°æ®è¡Œå’Œç›¸é‚»çš„é”®å€¼èšç°‡çš„å­˜å‚¨åœ¨ä¸€èµ·</p></blockquote><div class="tabs" id="4e502af4-b25a-4711-9b33-2e8c93a36db4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#4e502af4-b25a-4711-9b33-2e8c93a36db4-1"><i class="fas fa-atom"></i>ç‰¹ç‚¹</button></li><li class="tab"><button type="button" data-href="#4e502af4-b25a-4711-9b33-2e8c93a36db4-2"><i class="far fa-sun"></i>ä¼˜ç‚¹</button></li><li class="tab"><button type="button" data-href="#4e502af4-b25a-4711-9b33-2e8c93a36db4-3"><i class="fas fa-wind"></i>ç¼ºç‚¹</button></li><li class="tab"><button type="button" data-href="#4e502af4-b25a-4711-9b33-2e8c93a36db4-4"><i class="fas fa-fire-alt"></i>é™åˆ¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="4e502af4-b25a-4711-9b33-2e8c93a36db4-1"><ul><li><p>ä½¿ç”¨è®°å½•ä¸»é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼Œè¿™åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢çš„å«ä¹‰ï¼š</p><p>*<code>é¡µå†…</code>çš„è®°å½•æ˜¯æŒ‰ç…§ä¸»é”®çš„å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>å•å‘é“¾è¡¨</code>ã€‚</p><ul><li>å„ä¸ªå­˜æ”¾<code>ç”¨æˆ·è®°å½•çš„é¡µ</code>ä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>åŒå‘é“¾è¡¨</code>ã€‚</li><li>å­˜æ”¾<code>ç›®å½•é¡¹è®°å½•çš„é¡µ</code>åˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œåœ¨åŒä¸€å±‚æ¬¡ä¸­çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç›®å½•é¡¹è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>åŒå‘é“¾è¡¨</code>ã€‚</li></ul></li><li><p>B+æ ‘çš„ å¶å­èŠ‚ç‚¹ å­˜å‚¨çš„æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p><p>æ‰€è°“å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œå°±æ˜¯æŒ‡è¿™ä¸ªè®°å½•ä¸­å­˜å‚¨äº†æ‰€æœ‰åˆ—çš„å€¼ï¼ˆåŒ…æ‹¬éšè—åˆ—ï¼‰ã€‚</p></li></ul><p>æˆ‘ä»¬æŠŠå…·æœ‰è¿™ä¸¤ç§ç‰¹æ€§çš„B+æ ‘ç§°ä¸ºèšç°‡ç´¢å¼•ï¼Œæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨è¿™ä¸ª<code>èšç°‡ç´¢å¼•</code>çš„å¶å­èŠ‚ç‚¹å¤„ã€‚è¿™ç§èšç°‡ç´¢å¼•å¹¶ä¸éœ€è¦æˆ‘ä»¬åœ¨MySQLè¯­å¥ä¸­æ˜¾å¼çš„ä½¿ç”¨<code>INDEX</code>è¯­å¥å»åˆ›å»ºï¼Œ<code>InnDB</code>å­˜å‚¨å¼•æ“ä¼š<code>è‡ªåŠ¨</code>çš„ä¸ºæˆ‘ä»¬åˆ›å»ºèšç°‡ç´¢å¼•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4e502af4-b25a-4711-9b33-2e8c93a36db4-2"><p>*<code>æ•°æ®è®¿é—®æ›´å¿«</code>ï¼Œå› ä¸ºèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿«</p><ul><li>èšç°‡ç´¢å¼•å¯¹äºä¸»é”®çš„<code>æ’åºæŸ¥æ‰¾</code>å’Œ<code>èŒƒå›´æŸ¥æ‰¾</code>é€Ÿåº¦éå¸¸å¿«</li><li>æŒ‰ç…§èšç°‡ç´¢å¼•æ’åˆ—é¡ºåºï¼ŒæŸ¥è¯¢æ˜¾ç¤ºä¸€å®šèŒƒå›´æ•°æ®çš„æ—¶å€™ï¼Œç”±äºæ•°æ®éƒ½æ˜¯ç´§å¯†ç›¸è¿ï¼Œæ•°æ®åº“ä¸ç”¨ä»å¤š ä¸ªæ•°æ®å—ä¸­æå–æ•°æ®ï¼Œæ‰€ä»¥<code>èŠ‚çœäº†å¤§é‡çš„ioæ“ä½œ</code>ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4e502af4-b25a-4711-9b33-2e8c93a36db4-3"><p>*<code>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåº</code>ï¼ŒæŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥æ˜¯æœ€å¿«çš„æ–¹å¼ï¼Œå¦åˆ™å°†ä¼šå‡ºç°é¡µåˆ†è£‚ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ª<code>è‡ªå¢çš„IDåˆ—ä¸ºä¸»é”®</code><br>*<code>æ›´æ–°ä¸»é”®çš„ä»£ä»·å¾ˆé«˜</code>ï¼Œå› ä¸ºå°†ä¼šå¯¼è‡´è¢«æ›´æ–°çš„è¡Œç§»åŠ¨ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬å®šä¹‰<strong>ä¸»é”®ä¸ºä¸å¯æ›´æ–°</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4e502af4-b25a-4711-9b33-2e8c93a36db4-4"><ul><li><p>å¯¹äºMysQLæ•°æ®åº“ç›®å‰åªæœ‰InnoDBæ•°æ®å¼•æ“æ”¯æŒèšç°‡ç´¢åˆ—ï¼Œè€ŒMyISAMå¹¶ä¸æ”¯æŒèšç°‡ç´¢å¼•ã€‚</p></li><li><p>ç”±äºæ•°æ®ç‰©ç†å­˜å‚¨æ’åºæ–¹å¼åªèƒ½æœ‰ä¸€ç§ï¼Œæ‰€ä»¥æ¯ä¸ªMySQLçš„è¡¨åªèƒ½æœ‰ä¸€ä¸ª<code>èšç°‡ç´¢å¼•</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚</p></li><li><p>å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼ŒInnodbä¼šé€‰æ‹©<code>éç©ºçš„å”¯ä¸€ç´¢å¼•</code>ä»£æ›¿ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼ŒInnodbä¼šéšå¼çš„å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ã€‚</p></li><li><p>ä¸ºäº†å……åˆ†åˆ©ç”¨èšç°‡ç´¢å¼•çš„èšç°‡çš„ç‰¹æ€§ï¼Œæ‰€ä»¥innodbè¡¨çš„ä¸»é”®åˆ—å°½é‡é€‰ç”¨<code>æœ‰åºçš„é¡ºåºid</code>ï¼Œè€Œä¸å»ºè®®ç”¨æ— åºçš„idï¼Œ æ¯”å¦‚UUIDã€MD5ã€HASHã€å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®æ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿ã€‚</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h3 id="5-2-äºŒçº§ç´¢å¼•">5.2 äºŒçº§ç´¢å¼•</h3><p>ä¸Šè¾¹ä»‹ç»çš„<code>èšç°‡ç´¢å¼•</code>åªèƒ½åœ¨æœç´¢æ¡ä»¶æ˜¯<code>ä¸»é”®å€¼</code>æ—¶æ‰èƒ½å‘æŒ¥ä½œç”¨ï¼Œå› ä¸ºB+æ ‘ä¸­çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”®è¿›è¡Œæ’åºçš„ã€‚é‚£å¦‚æœæˆ‘ä»¬æƒ³ä»¥åˆ«çš„åˆ—ä½œä¸ºæœç´¢æ¡ä»¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè‚¯å®šä¸èƒ½æ˜¯ä»å¤´åˆ°å°¾æ²¿ç€é“¾è¡¨ä¾æ¬¡éå†è®°å½•ä¸€éã€‚</p><p>ç­”æ¡ˆï¼šæˆ‘ä»¬å¯ä»¥<code>å¤šå»ºå‡ é¢—B+æ ‘</code>ï¼Œä¸åŒçš„B+æ ‘ä¸­çš„æ•°æ®é‡‡ç”¨ä¸åŒçš„æ’åˆ—è§„åˆ™ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬ç”¨<code>c2</code>åˆ—çš„å¤§å°ä½œä¸ºæ•°æ®é¡µã€é¡µä¸­è®°å½•çš„æ’åºè§„åˆ™ï¼Œå†å»ºä¸€é¢—B+æ ‘ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616203852043.png" alt="image-20220616203852043" style="zoom: 50%;" /><ul><li><p>ä½¿ç”¨è®°å½•c2åˆ—çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼Œè¿™åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢çš„å«ä¹‰ï¼š</p><ul><li>é¡µå†…çš„è®°å½•æ˜¯æŒ‰ç…§c2åˆ—çš„å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>å•å‘é“¾è¡¨</code>ã€‚</li><li>å„ä¸ªå­˜æ”¾<code>ç”¨æˆ·è®°å½•çš„é¡µ</code>ä¹Ÿæ˜¯æ ¹æ®é¡µä¸­è®°å½•çš„c2åˆ—å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>åŒå‘é“¾è¡¨</code>ã€‚</li><li>å­˜æ”¾<code>ç›®å½•é¡¹è®°å½•çš„é¡µ</code>åˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œåœ¨åŒä¸€å±‚æ¬¡ä¸­çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç›®å½•é¡¹è®°å½•çš„c2åˆ—å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>åŒå‘é“¾è¡¨</code>ã€‚</li></ul></li><li><p>B+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„å¹¶ä¸æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè€Œåªæ˜¯<code>c2åˆ—+ä¸»é”®</code>è¿™ä¸¤ä¸ªåˆ—çš„å€¼ã€‚</p></li><li><p>ç›®å½•é¡¹è®°å½•ä¸­ä¸å†æ˜¯<code>ä¸»é”®+é¡µå·</code>çš„æ­é…ï¼Œè€Œå˜æˆäº†<code>c2åˆ—+é¡µå·</code>çš„æ­é…ã€‚</p></li></ul><p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç°åœ¨æƒ³é€šè¿‡c2åˆ—çš„å€¼æŸ¥æ‰¾æŸäº›è®°å½•çš„è¯å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬åˆšåˆšå»ºå¥½çš„è¿™ä¸ªB+æ ‘äº†ã€‚ä»¥æŸ¥æ‰¾c2åˆ—çš„å€¼ä¸º<code>4</code>çš„è®°å½•ä¸ºä¾‹ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>ç¡®å®š<code>ç›®å½•é¡¹è®°å½•é¡µ</code></p><p>æ ¹æ®<code>æ ¹é¡µé¢</code>ï¼Œä¹Ÿå°±æ˜¯<code>é¡µ44</code>ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°<code>ç›®å½•é¡¹è®°å½•</code>æ‰€åœ¨çš„é¡µä¸º<code>é¡µ42</code>(å› ä¸º2â‰¤ 4â‰¤9ï¼‰ã€‚</p></li><li><p>é€šè¿‡<code>ç›®å½•é¡¹è®°å½•é¡µ</code>ç¡®å®šç”¨æˆ·è®°å½•çœŸå®æ‰€åœ¨çš„é¡µã€‚</p><p>åœ¨<code>é¡µ42</code>ä¸­å¯ä»¥å¿«é€Ÿå®šä½åˆ°å®é™…å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µï¼Œä½†æ˜¯ç”±äº c2 åˆ—å¹¶æ²¡æœ‰å”¯ä¸€æ€§çº¦æŸï¼Œæ‰€ä»¥c2 åˆ—å€¼ä¸º4çš„è®°å½•å¯èƒ½åˆ†å¸ƒåœ¨å¤šä¸ªæ•°æ®é¡µä¸­ï¼Œåˆå› ä¸º2ï¼œ4â‰¤4ï¼Œæ‰€ä»¥ç¡®å®šå®é™…å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µåœ¨é¡µ34å’Œé¡µ35ä¸­ã€‚</p></li><li><p>åœ¨çœŸå®å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</p><p>åˆ°é¡µ34å’Œé¡µ35 ä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</p></li><li><p>ä½†æ˜¯è¿™ä¸ªB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•åªå­˜å‚¨äº† c2å’Œc1ï¼ˆä¹Ÿå°±æ˜¯ä¸»é”®ï¼‰ä¸¤ä¸ªåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å†æ ¹æ®ä¸»é”®å€¼å»èšç°‡ç´¢å¼•ä¸­å†æŸ¥æ‰¾ä¸€éå®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p></li></ol><blockquote><p>æ¦‚å¿µï¼š<span class='p red'>å›è¡¨</span></p></blockquote><p>æˆ‘ä»¬æ ¹æ®è¿™ä¸ªä»¥c2åˆ—å¤§å°æ’åºçš„B+æ ‘åªèƒ½ç¡®å®šæˆ‘ä»¬è¦æŸ¥æ‰¾è®°å½•çš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ ¹ æ®c2åˆ—çš„å€¼æŸ¥æ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œä»ç„¶éœ€è¦åˆ° èšç°‡ç´¢å¼• ä¸­å†æŸ¥ä¸€éï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º å›è¡¨ ã€‚ä¹Ÿå°± æ˜¯æ ¹æ®c2åˆ—çš„å€¼æŸ¥è¯¢ä¸€æ¡å®Œæ•´çš„ç”¨æˆ·è®°å½•éœ€è¦ä½¿ç”¨åˆ° 2 æ£µB+æ ‘ï¼</p><blockquote><p><strong>é—®é¢˜</strong>ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä¸€æ¬¡ å›è¡¨ æ“ä½œå‘¢ï¼Ÿç›´æ¥æŠŠå®Œæ•´çš„ç”¨æˆ·è®°å½•æ”¾åˆ°å¶å­èŠ‚ç‚¹ä¸OKå—ï¼Ÿ</p></blockquote><p><strong>å›ç­”</strong>ï¼š</p><p>å¦‚æœæŠŠå®Œæ•´çš„ç”¨æˆ·è®°å½•æ”¾åˆ°å¶å­ç»“ç‚¹æ˜¯å¯ä»¥ä¸ç”¨å›è¡¨ã€‚ä½†æ˜¯<code>å¤ªå åœ°æ–¹</code>äº†ï¼Œç›¸å½“äºæ¯å»ºç«‹ä¸€è¯¾B+æ ‘éƒ½éœ€è¦æŠŠæ‰€æœ‰çš„ç”¨æˆ·è®°å½•å†éƒ½æ‹·è´ä¸€éï¼Œè¿™å°±æœ‰ç‚¹å¤ªæµªè´¹å­˜å‚¨ç©ºé—´äº†ã€‚</p><p>å› ä¸ºè¿™ç§æŒ‰ç…§<code>éä¸»é”®åˆ—</code>å»ºç«‹çš„B+æ ‘éœ€è¦ä¸€æ¬¡å›è¡¨æ“ä½œæ‰å¯ä»¥å®šä½åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œæ‰€ä»¥è¿™ç§B+æ ‘ä¹Ÿè¢«ç§°ä¸º<code>äºŒçº§ç´¢å¼•</code>ï¼Œæˆ–è€…è¾…åŠ©ç´¢å¼•ã€‚ç”±äºä½¿ç”¨çš„æ˜¯c2åˆ—çš„å¤§å°ä½œä¸ºB+æ ‘çš„æ’åºè§„åˆ™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°è¿™ä¸ªB+æ ‘ä¸ºc2åˆ—ç®€å†çš„ç´¢å¼•ã€‚</p><p>éèšç°‡ç´¢å¼•çš„å­˜åœ¨ä¸å½±å“æ•°æ®åœ¨èšç°‡ç´¢å¼•ä¸­çš„ç»„ç»‡ï¼Œæ‰€ä»¥ä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616213109383.png" alt="image-20220616213109383" style="zoom:50%;" /><p>å°ç»“ï¼šèšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•çš„åŸç†ä¸åŒï¼Œåœ¨ä½¿ç”¨ä¸Šä¹Ÿæœ‰ä¸€äº›åŒºåˆ«ï¼š</p><ol><li>èšç°‡ç´¢å¼•çš„<code>å¶å­èŠ‚ç‚¹</code>å­˜å‚¨çš„å°±æ˜¯æˆ‘ä»¬çš„<code>æ•°æ®è®°å½•</code>, éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯<code>æ•°æ®ä½ç½®</code>ã€‚éèšç°‡ç´¢å¼•ä¸ä¼šå½±å“æ•°æ®è¡¨çš„ç‰©ç†å­˜å‚¨é¡ºåºã€‚</li><li>ä¸€ä¸ªè¡¨<code>åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•</code>ï¼Œå› ä¸ºåªèƒ½æœ‰ä¸€ç§æ’åºå­˜å‚¨çš„æ–¹å¼ï¼Œä½†å¯ä»¥æœ‰<code>å¤šä¸ªéèšç°‡ç´¢å¼•</code>ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªç´¢å¼•ç›®å½•æä¾›æ•°æ®æ£€ç´¢ã€‚</li><li>ä½¿ç”¨èšç°‡ç´¢å¼•çš„æ—¶å€™ï¼Œæ•°æ®çš„<code>æŸ¥è¯¢æ•ˆç‡é«˜</code>ï¼Œä½†å¦‚æœå¯¹æ•°æ®è¿›è¡Œæ’å…¥ï¼Œåˆ é™¤ï¼Œæ›´æ–°ç­‰æ“ä½œï¼Œæ•ˆç‡ä¼šæ¯”éèšç°‡ç´¢å¼•ä½ã€‚</li></ol><hr><h3 id="5-3-è”åˆç´¢å¼•">5.3 è”åˆç´¢å¼•</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶ä»¥å¤šä¸ªåˆ—çš„å¤§å°ä½œä¸ºæ’åºè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ä¸ºå¤šä¸ªåˆ—å»ºç«‹ç´¢å¼•ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬æƒ³è®©B+æ ‘æŒ‰ ç…§ c2å’Œc3åˆ— çš„å¤§å°è¿›è¡Œæ’åºï¼Œè¿™ä¸ªåŒ…å«ä¸¤å±‚å«ä¹‰ï¼š</p><ul><li>å…ˆæŠŠå„ä¸ªè®°å½•å’Œé¡µæŒ‰ç…§c2åˆ—è¿›è¡Œæ’åºã€‚</li><li>åœ¨è®°å½•çš„c2åˆ—ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨c3åˆ—è¿›è¡Œæ’åº</li></ul><p>ä¸ºc2å’Œc3å»ºç«‹çš„ç´¢å¼•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220616215251172.png" alt="image-20220616215251172" style="zoom:50%;" /><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æ¯æ¡ç›®å½•é¡¹éƒ½æœ‰c2ã€c3ã€é¡µå·è¿™ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå„æ¡è®°å½•å…ˆæŒ‰ç…§c2åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œå¦‚æœè®°å½•çš„c2åˆ—ç›¸åŒï¼Œåˆ™æŒ‰ç…§c3åˆ—çš„å€¼è¿›è¡Œæ’åº</li><li>B+æ ‘å¶å­èŠ‚ç‚¹å¤„çš„ç”¨æˆ·è®°å½•ç”±c2ã€c3å’Œä¸»é”®c1åˆ—ç»„æˆ</li></ul><p>æ³¨æ„ä¸€ç‚¹ï¼Œä»¥c2å’Œc3åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹çš„B+æ ‘ç§°ä¸º è”åˆç´¢å¼• ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªäºŒçº§ç´¢å¼•ã€‚å®ƒçš„æ„ æ€ä¸åˆ†åˆ«ä¸ºc2å’Œc3åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•çš„è¡¨è¿°æ˜¯ä¸åŒçš„ï¼Œä¸åŒç‚¹å¦‚ä¸‹ï¼š</p><ul><li>å»ºç«‹ è”åˆç´¢å¼• åªä¼šå»ºç«‹å¦‚ä¸Šå›¾ä¸€æ ·çš„1æ£µB+æ ‘ã€‚</li><li>ä¸ºc2å’Œc3åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•ä¼šåˆ†åˆ«ä»¥c2å’Œc3åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹2æ£µB+æ ‘ã€‚</li></ul><hr><h2 id="6-InnoDBçš„B-æ ‘ç´¢å¼•æ³¨æ„äº‹é¡¹">6. InnoDBçš„B+æ ‘ç´¢å¼•æ³¨æ„äº‹é¡¹</h2><div class="tabs" id="4f022a31-b74b-4ef2-b25f-3cf21e66465d"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#4f022a31-b74b-4ef2-b25f-3cf21e66465d-1"><i class="fas fa-award"></i>1.æ ¹é¡µé¢ä½ç½®ä¸‡å¹´ä¸åŠ¨</button></li><li class="tab"><button type="button" data-href="#4f022a31-b74b-4ef2-b25f-3cf21e66465d-2"><i class="fas fa-baseball-ball"></i>2.ä¸€ä¸ªé¡µé¢æœ€å°‘å­˜å‚¨2æ¡è®°å½•</button></li><li class="tab"><button type="button" data-href="#4f022a31-b74b-4ef2-b25f-3cf21e66465d-3"><i class="fas fa-bone"></i>3.å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="4f022a31-b74b-4ef2-b25f-3cf21e66465d-1"><p>æˆ‘ä»¬å‰è¾¹ä»‹ç»B+æ ‘ç´¢å¼•çš„æ—¶å€™ï¼Œä¸ºäº†å¤§å®¶ç†è§£ä¸Šçš„æ–¹ä¾¿ï¼Œå…ˆæŠŠå­˜å‚¨ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹éƒ½ç”»å‡ºæ¥ï¼Œç„¶åæ¥ç€ç”»å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ï¼Œå®é™…ä¸ŠB+æ ‘çš„å½¢æˆè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p>å®é™…ä¸ŠB+æ ‘çš„å½¢æˆè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>æ¯å½“ä¸ºæŸä¸ªè¡¨åˆ›å»ºä¸€ä¸ªB+æ ‘ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ä¸æ˜¯äººä¸ºåˆ›å»ºçš„ï¼Œé»˜è®¤å°±æœ‰ï¼‰çš„æ—¶å€™ï¼Œéƒ½ä¼šä¸ºè¿™ä¸ªç´¢å¼•åˆ›å»ºä¸€ä¸ª<code>æ ¹ç»“ç‚¹</code>é¡µé¢ã€‚æœ€å¼€å§‹è¡¨ä¸­æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ¯ä¸ªB+æ ‘ç´¢å¼•å¯¹åº”çš„<code>æ ¹ç»“ç‚¹</code>ä¸­å³æ²¡æœ‰ç”¨æˆ·è®°å½•ï¼Œä¹Ÿæ²¡æœ‰ç›®å½•é¡¹è®°å½•ã€‚</li><li>éšåå‘è¡¨ä¸­æ’å…¥ç”¨æˆ·è®°å½•æ—¶ï¼Œå…ˆæŠŠç”¨æˆ·è®°å½•å­˜å‚¨åˆ°è¿™ä¸ª<code>æ ¹èŠ‚ç‚¹</code>ä¸­ã€‚</li><li>å½“æ ¹èŠ‚ç‚¹ä¸­çš„å¯ç”¨<code>ç©ºé—´ç”¨å®Œæ—¶</code>ç»§ç»­æ’å…¥è®°å½•ï¼Œæ­¤æ—¶ä¼šå°†æ ¹èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰è®°å½•å¤åˆ¶åˆ°ä¸€ä¸ªæ–°åˆ†é…çš„é¡µï¼Œæ¯”å¦‚<code>é¡µa</code>ä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªæ–°é¡µè¿›è¡Œ<code>é¡µåˆ†è£‚</code>çš„æ“ä½œï¼Œå¾—åˆ°å¦ä¸€ä¸ªæ–°é¡µï¼Œæ¯”å¦‚<code>é¡µb</code>ã€‚è¿™æ—¶æ–°æ’å…¥çš„è®°å½•æ ¹æ®é”®å€¼ï¼ˆä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•ä¸­çš„ä¸»é”®å€¼ï¼ŒäºŒçº§ç´¢å¼•ä¸­å¯¹åº”çš„ç´¢å¼•åˆ—çš„å€¼ï¼‰çš„å¤§å°å°±ä¼šè¢«åˆ†é…åˆ°<code>é¡µa</code>æˆ–è€…<code>é¡µb</code>ä¸­ï¼Œè€Œ<code>æ ¹èŠ‚ç‚¹</code>ä¾¿å‡çº§ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šä¸€ä¸ªB+æ ‘ç´¢å¼•çš„æ ¹èŠ‚ç‚¹è‡ªè¯ç”Ÿä¹‹æ—¥èµ·ï¼Œä¾¿ä¸ä¼šå†ç§»åŠ¨ã€‚è¿™æ ·åªè¦æˆ‘ä»¬å¯¹æŸä¸ªè¡¨å»ºè®®ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆå®ƒçš„æ ¹èŠ‚ç‚¹çš„é¡µå·ä¾¿ä¼šè¢«è®°å½•åˆ°æŸä¸ªåœ°æ–¹ã€‚ç„¶åå‡¡æ˜¯<code>InnoDB</code>å­˜å‚¨å¼•æ“éœ€è¦ç”¨åˆ°è¿™ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œéƒ½ä¼šä»å“ªä¸ªå›ºå®šçš„åœ°æ–¹å–å‡ºæ ¹èŠ‚ç‚¹çš„é¡µå·ï¼Œä»è€Œæ¥è®¿é—®è¿™ä¸ªç´¢å¼•ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4f022a31-b74b-4ef2-b25f-3cf21e66465d-2"><p>ä¸€ä¸ªB+æ ‘åªéœ€è¦å¾ˆå°‘çš„å±‚çº§å°±å¯ä»¥è½»æ¾å­˜å‚¨æ•°äº¿æ¡è®°å½•ï¼ŒæŸ¥è¯¢é€Ÿåº¦ç›¸å½“ä¸é”™ï¼è¿™æ˜¯å› ä¸ºB+æ ‘æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¤§çš„å¤šå±‚çº§ç›®å½•ï¼Œæ¯ç»è¿‡ä¸€ä¸ªç›®å½•æ—¶éƒ½ä¼šè¿‡æ»¤æ‰è®¸å¤šæ— æ•ˆçš„å­ç›®å½•ï¼Œç›´åˆ°æœ€åè®¿é—®åˆ°å­˜å‚¨çœŸå®æ•°æ®çš„ç›®å½•ã€‚é‚£å¦‚æœä¸€ä¸ªå¤§çš„ç›®å½•ä¸­åªå­˜æ”¾ä¸€ä¸ªå­ç›®å½•æ˜¯ä¸ªå•¥æ•ˆæœå‘¢ï¼Ÿé‚£å°±æ˜¯ç›®å½•å±‚çº§éå¸¸éå¸¸å¤šï¼Œè€Œä¸”æœ€åçš„é‚£ä¸ªå­˜æ”¾çœŸå®æ•°æ®çš„ç›®å½•ä¸­åªå­˜æ”¾ä¸€æ¡æ•°æ®ã€‚æ‰€ä»¥ <strong>InnoDB çš„ä¸€ä¸ªæ•°æ®é¡µè‡³å°‘å¯ä»¥å­˜æ”¾ä¸¤æ¡è®°å½•</strong>ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="4f022a31-b74b-4ef2-b25f-3cf21e66465d-3"><p>å†…èŠ‚ç‚¹ï¼šç”¨æ¥å­˜ç›®å½•é¡¹çš„èŠ‚ç‚¹</p><p>æˆ‘ä»¬çŸ¥é“B+æ ‘ç´¢å¼•çš„å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å†…å®¹æ˜¯<code>ç´¢å¼•åˆ— + é¡µå·</code>çš„æ­é…ï¼Œä½†æ˜¯è¿™ä¸ªæ­é…å¯¹äºäºŒçº§ç´¢å¼•æ¥è¯´æœ‰ç‚¹ä¸ä¸¥è°¨ã€‚è¿˜æ‹¿ index_demo è¡¨ä¸ºä¾‹ï¼Œå‡è®¾è¿™ä¸ªè¡¨ä¸­çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617151918786.png" alt="image-20220617151918786"></p><p>å¦‚æœäºŒçº§ç´¢å¼•ä¸­ç›®å½•é¡¹è®°å½•çš„å†…å®¹åªæ˜¯<code>ç´¢å¼•åˆ— + é¡µå·</code>çš„æ­é…çš„è¯ï¼Œé‚£ä¹ˆä¸º<code>c2</code>åˆ—ç®€å†ç´¢å¼•åçš„B+æ ‘åº”è¯¥é•¿è¿™æ ·ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617152906690.png" alt="image-20220617152906690"></p><p>å¦‚æœæˆ‘ä»¬æƒ³æ–°æ’å…¥ä¸€è¡Œè®°å½•ï¼Œå…¶ä¸­<code>c1</code>ã€<code>c2</code>ã€<code>c3</code>çš„å€¼åˆ†åˆ«æ˜¯:<code>9</code>ã€<code>1</code>ã€<code>c</code>, é‚£ä¹ˆåœ¨ä¿®æ”¹è¿™ä¸ªä¸º c2 åˆ—å»ºç«‹çš„äºŒçº§ç´¢å¼•å¯¹åº”çš„ B+ æ ‘æ—¶ä¾¿ç¢°åˆ°äº†ä¸ªå¤§é—®é¢˜ï¼šç”±äº<code>é¡µ3</code>ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±<code>c2åˆ— + é¡µå·</code>çš„å€¼æ„æˆçš„ï¼Œ<code>é¡µ3</code>ä¸­çš„ä¸¤æ¡ç›®å½•é¡¹è®°å½•å¯¹åº”çš„ c2 åˆ—çš„å€¼éƒ½æ˜¯1ï¼Œè€Œæˆ‘ä»¬<code>æ–°æ’å…¥çš„è¿™æ¡è®°å½•</code>çš„ c2 åˆ—çš„å€¼ä¹Ÿæ˜¯<code>1</code>ï¼Œé‚£æˆ‘ä»¬è¿™æ¡æ–°æ’å…¥çš„è®°å½•åˆ°åº•åº”è¯¥æ”¾åœ¨<code>é¡µ4</code>ä¸­ï¼Œè¿˜æ˜¯åº”è¯¥æ”¾åœ¨<code>é¡µ5</code>ä¸­ï¼Ÿç­”æ¡ˆï¼šå¯¹ä¸èµ·ï¼Œæ‡µäº†</p><p>ä¸ºäº†è®©æ–°æ’å…¥è®°å½•æ‰¾åˆ°è‡ªå·±åœ¨é‚£ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦<strong>ä¿è¯åœ¨B+æ ‘çš„åŒä¸€å±‚é¡µèŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•é™¤é¡µå·è¿™ä¸ªå­—æ®µä»¥å¤–æ˜¯å”¯ä¸€çš„</strong>ã€‚æ‰€ä»¥å¯¹äºäºŒçº§ç´¢å¼•çš„å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•çš„å†…å®¹å®é™…ä¸Šæ˜¯ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆçš„ï¼š</p><ul><li>ç´¢å¼•åˆ—çš„å€¼</li><li>ä¸»é”®å€¼</li><li>é¡µå·</li></ul><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬æŠŠ<code>ä¸»é”®å€¼</code>ä¹Ÿæ·»åŠ åˆ°äºŒçº§ç´¢å¼•å†…èŠ‚ç‚¹ä¸­çš„ç›®å½•é¡¹è®°å½•ï¼Œè¿™æ ·å°±èƒ½ä¿ä½ B+ æ ‘æ¯ä¸€å±‚èŠ‚ç‚¹ä¸­å„æ¡ç›®å½•é¡¹è®°å½•é™¤é¡µå·è¿™ä¸ªå­—æ®µå¤–æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºc2å»ºç«‹äºŒçº§ç´¢å¼•åçš„ç¤ºæ„å›¾å®é™…ä¸Šåº”è¯¥æ˜¯è¿™æ ·å­çš„ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617154135258.png" alt="image-20220617154135258"></p><p>è¿™æ ·æˆ‘ä»¬å†æ’å…¥è®°å½•<code>(9, 1, 'c')</code>æ—¶ï¼Œç”±äº<code>é¡µ3</code>ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±<code>c2åˆ— + ä¸»é”® + é¡µå·</code>çš„å€¼æ„æˆçš„ï¼Œå¯ä»¥å…ˆæŠŠæ–°çºªå½•çš„<code>c2</code>åˆ—çš„å€¼å’Œ<code>é¡µ3</code>ä¸­å„ç›®å½•é¡¹è®°å½•çš„<code>c2</code>åˆ—çš„å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœ<code>c2</code>åˆ—çš„å€¼ç›¸åŒçš„è¯ï¼Œå¯ä»¥æ¥ç€æ¯”è¾ƒä¸»é”®å€¼ï¼Œå› ä¸ºB+æ ‘åŒä¸€å±‚ä¸­ä¸åŒç›®å½•é¡¹è®°å½•çš„<code>c2åˆ— + ä¸»é”®</code>çš„å€¼è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æœ€åè‚¯å®šèƒ½å®šä½å”¯ä¸€çš„ä¸€æ¡ç›®å½•é¡¹è®°å½•ï¼Œåœ¨æœ¬ä¾‹ä¸­æœ€åç¡®å®šæ–°çºªå½•åº”è¯¥è¢«æ’å…¥åˆ°<code>é¡µ5</code>ä¸­ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><h2 id="7-MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ">7. MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</h2><p>Bæ ‘ç´¢å¼•ä½¿ç”¨å­˜å‚¨å¼•æ“å¦‚è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th style="text-align:center">ç´¢å¼• / å­˜å‚¨å¼•æ“</th><th style="text-align:center">MyISAM</th><th style="text-align:center">InnoDB</th><th style="text-align:center">Memory</th></tr></thead><tbody><tr><td style="text-align:center">B-Treeç´¢å¼•</td><td style="text-align:center">æ”¯æŒ</td><td style="text-align:center">æ”¯æŒ</td><td style="text-align:center">æ”¯æŒ</td></tr></tbody></table><p>å³ä½¿å¤šä¸ªå­˜å‚¨å¼•æ“æ”¯æŒåŒä¸€ç§ç±»å‹çš„ç´¢å¼•ï¼Œä½†æ˜¯ä»–ä»¬çš„å®ç°åŸç†ä¹Ÿæ˜¯ä¸åŒçš„ã€‚Innodbå’ŒMyISAMé»˜è®¤çš„ç´¢å¼•æ˜¯Btreeç´¢å¼•ï¼›è€ŒMemoryé»˜è®¤çš„ç´¢å¼•æ˜¯Hashç´¢å¼•ã€‚</p><p>MyISAMå¼•æ“ä½¿ç”¨<code>B+Tree</code>ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶å­èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯<code>æ•°æ®è®°å½•çš„åœ°å€</code>ã€‚</p><h3 id="7-1-MyISAMç´¢å¼•çš„åŸç†">7.1 MyISAMç´¢å¼•çš„åŸç†</h3><p>æˆ‘ä»¬çŸ¥é“<code>InnoDBä¸­ç´¢å¼•å³æ•°æ®</code>ï¼Œä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•çš„é‚£æ£µB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­å·±ç»æŠŠæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½åŒ…å«äº†ï¼Œ è€Œ<code>MyISAM</code>çš„ç´¢å¼•æ–¹æ¡ˆè™½ç„¶ä¹Ÿä½¿ç”¨æ ‘å½¢ç»“æ„ï¼Œä½†æ˜¯å´<code>å°†ç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜å‚¨</code>ï¼š</p><ul><li><p>å°†è¡¨ä¸­çš„è®°å½•<code>æŒ‰ç…§è®°å½•çš„æ’å…¥é¡ºåº</code>å•ç‹¬å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç§°ä¹‹ä¸º<code>æ•°æ®æ–‡ä»¶</code>ã€‚è¿™ä¸ªæ–‡ä»¶å¹¶ä¸åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ•°æ®é¡µï¼Œæœ‰å¤šå°‘è®°å½•å°±å¾€è¿™ä¸ªæ–‡ä»¶ä¸­å¡å¤šå°‘è®°å½•å°±æˆäº†ã€‚ç”±äºåœ¨æ’å…¥æ•°æ®çš„æ—¶å€™å¹¶æ²¡æœ‰åˆ»æ„æŒ‰ç…§ä¸»é”®å¤§å°æ’åºï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸èƒ½åœ¨è¿™äº›æ•°æ®ä¸Šä½¿ç”¨äºŒåˆ†æ³•è¿›è¡ŒæŸ¥æ‰¾ã€‚</p></li><li><p>ä½¿ç”¨<code>MyISAM</code>å­˜å‚¨å¼•æ“çš„è¡¨ä¼šæŠŠç´¢å¼•ä¿¡æ¯å¦å¤–å­˜å‚¨åˆ°ä¸€ä¸ªç§°ä¸º<code>ç´¢å¼•æ–‡ä»¶</code>çš„å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚<code>MyISAM</code>ä¼šå•ç‹¬ä¸ºè¡¨çš„ä¸»é”®åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œåªä¸è¿‡åœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„ä¸æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè€Œæ˜¯<code>ä¸»é”®å€¼ +æ•°æ®è®°å½•åœ°å€</code>çš„ç»„åˆã€‚</p></li></ul><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409133104671.png" alt="image-20230409133104671" style="zoom:50%;" /><p>è¿™é‡Œè®¾è¡¨ä¸€å…±æœ‰ä¸‰åˆ—ï¼Œå‡è®¾æˆ‘ä»¬ä»¥Col1ä¸ºä¸»é”®ï¼Œä¸Šå›¾æ˜¯ä¸€ä¸ªMyISAMè¡¨çš„ä¸»ç´¢å¼•(Primary key) ç¤ºæ„ã€‚å¯ä»¥çœ‹å‡º MyISAMçš„ç´¢å¼•æ–‡ä»¶ä»…ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚åœ¨MyISAMä¸­ï¼Œä¸»é”®ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•(Secondary key)åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»é”®ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€ŒäºŒçº§ç´¢å¼•çš„keyå¯ä»¥é‡å¤ã€‚å¦‚æœæˆ‘ä»¬åœ¨Col2ä¸Šå»ºç«‹ä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼Œåˆ™æ­¤ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230409133213129.png" alt="image-20230409133213129" style="zoom:50%;" /><p>åŒæ ·ä¹Ÿæ˜¯ä¸€æ£µB+Treeï¼ŒdataåŸŸä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚å› æ­¤ï¼ŒMyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºï¼šé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚</p><h3 id="7-2-MyISAM-ä¸-InnoDBå¯¹æ¯”">7.2 MyISAM ä¸ InnoDBå¯¹æ¯”</h3><span class='p red'>MyISAMçš„ç´¢å¼•æ–¹å¼éƒ½æ˜¯â€œéèšç°‡â€çš„ï¼Œä¸InnoDBåŒ…å«1ä¸ªèšç°‡ç´¢å¼•æ˜¯ä¸åŒçš„ã€‚</span>å°ç»“ä¸¤ç§å¼•æ“ä¸­ç´¢å¼•çš„åŒºåˆ«ï¼š<p>â‘  åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸»é”®å€¼å¯¹<code>èšç°‡ç´¢å¼•</code>è¿›è¡Œä¸€æ¬¡æŸ¥æ‰¾å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œè€Œåœ¨ MyISAM ä¸­å´éœ€è¦è¿›è¡Œä¸€æ¬¡<code>å›è¡¨</code>æ“ä½œï¼Œæ„å‘³ç€MyISAMä¸­å»ºç«‹çš„ç´¢å¼•ç›¸å½“äºå…¨éƒ¨éƒ½æ˜¯<code>äºŒçº§ç´¢å¼•</code>ã€‚</p><p>â‘¡ InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œè€ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯<code>åˆ†ç¦»çš„</code>ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•° æ®è®°å½•çš„åœ°å€ã€‚</p><p>â‘¢ InnoDBçš„éèšç°‡ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•<code>ä¸»é”®çš„å€¼</code>ï¼Œè€ŒMyISAMç´¢å¼•è®°å½•çš„æ˜¯<code>åœ°å€</code>ã€‚æ¢å¥è¯è¯´ï¼Œ InnoDBçš„æ‰€æœ‰éèšç°‡ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚</p><p>â‘£ MyISAMçš„å›è¡¨æ“ä½œæ˜¯ååˆ†<code>å¿«é€Ÿ</code>çš„ï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®çš„ï¼Œåè§‚InnoDBæ˜¯é€š è¿‡è·å–ä¸»é”®ä¹‹åå†å»èšç°‡ç´¢å¼•é‡Œæ‰¾è®°å½•ï¼Œè™½ç„¶è¯´ä¹Ÿä¸æ…¢ï¼Œä½†è¿˜æ˜¯æ¯”ä¸ä¸Šç›´æ¥ç”¨åœ°å€å»è®¿é—®ã€‚</p><p>â‘¤ InnoDBè¦æ±‚è¡¨<code>å¿…é¡»æœ‰ä¸»é”®</code>ï¼ˆ MyISAMå¯ä»¥æ²¡æœ‰ ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ª å¯ä»¥éç©ºä¸”å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ã€‚å¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéš å«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å‹ã€‚</p><p>â‘¥ MyISAMæ— è®ºä¸»é”®ç´¢å¼•è¿˜æ˜¯äºŒçº§ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ï¼Œè€ŒInnoDBçš„ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ã€‚</p><p><strong>å°ç»“ï¼š</strong></p><p>äº†è§£ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•å®ç°æ–¹å¼å¯¹äºæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éå¸¸æœ‰å¸®åŠ©ã€‚æ¯”å¦‚ï¼š</p><p>ä¸¾ä¾‹1ï¼šçŸ¥é“äº†InnoDBçš„ç´¢å¼•å®ç°åï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½<code>ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®</code>ï¼Œå› ä¸ºæ‰€æœ‰äºŒçº§ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»é”®ç´¢å¼•ä¼šä»¤äºŒçº§ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚</p><p>ä¸¾ä¾‹2ï¼šç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€æ£µB+Treeï¼Œéå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶ï¼Œæ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆï¼Œè€Œä½¿ç”¨<code>è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©</code>ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230408165518725.png" alt="image-20230408165518725" style="zoom: 33%;" /><h2 id="8-ç´¢å¼•çš„ä»£ä»·">8. ç´¢å¼•çš„ä»£ä»·</h2><p>ç´¢å¼•æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¯ä¸èƒ½ä¹±å»ºï¼Œå®ƒåœ¨ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½ä¼šæœ‰æ¶ˆè€—ï¼š</p><ul><li><p>ç©ºé—´ä¸Šçš„ä»£ä»·</p><p>æ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•éƒ½è¦ä¸ºå®ƒå»ºç«‹ä¸€æ£µB+æ ‘ï¼Œæ¯ä¸€æ£µB+æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µï¼Œä¸€ä¸ªé¡µé»˜è®¤ä¼š å ç”¨ 16KB çš„å­˜å‚¨ç©ºé—´ï¼Œä¸€æ£µå¾ˆå¤§çš„B+æ ‘ç”±è®¸å¤šæ•°æ®é¡µç»„æˆï¼Œé‚£å°±æ˜¯å¾ˆå¤§çš„ä¸€ç‰‡å­˜å‚¨ç©ºé—´ã€‚</p></li><li><p>æ—¶é—´ä¸Šçš„ä»£ä»·</p><p>æ¯æ¬¡å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œ å¢ã€åˆ ã€æ”¹ æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å»ä¿®æ”¹å„ä¸ªB+æ ‘ç´¢å¼•ã€‚è€Œä¸”æˆ‘ä»¬è®²è¿‡ï¼ŒB+æ ‘æ¯ å±‚èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ ä»å°åˆ°å¤§çš„é¡ºåºæ’åº è€Œç»„æˆäº† åŒå‘é“¾è¡¨ ã€‚ä¸è®ºæ˜¯å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•ï¼Œè¿˜ æ˜¯å†…èŠ‚ç‚¹ä¸­çš„è®°å½•ï¼ˆä¹Ÿå°±æ˜¯ä¸è®ºæ˜¯ç”¨æˆ·è®°å½•è¿˜æ˜¯ç›®å½•é¡¹è®°å½•ï¼‰éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåº è€Œå½¢æˆäº†ä¸€ä¸ªå•å‘é“¾è¡¨ã€‚è€Œå¢ã€åˆ ã€æ”¹æ“ä½œå¯èƒ½ä¼šå¯¹èŠ‚ç‚¹å’Œè®°å½•çš„æ’åºé€ æˆç ´åï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“éœ€ è¦é¢å¤–çš„æ—¶é—´è¿›è¡Œä¸€äº› è®°å½•ç§»ä½ ï¼Œé¡µé¢åˆ†è£‚ ã€é¡µé¢å›æ”¶ ç­‰æ“ä½œæ¥ç»´æŠ¤å¥½èŠ‚ç‚¹å’Œè®°å½•çš„æ’åºã€‚å¦‚æœ æˆ‘ä»¬å»ºäº†è®¸å¤šç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•å¯¹åº”çš„B+æ ‘éƒ½è¦è¿›è¡Œç›¸å…³çš„ç»´æŠ¤æ“ä½œï¼Œä¼šç»™æ€§èƒ½æ‹–åè…¿ã€‚</p></li></ul><blockquote><p>ä¸€ä¸ªè¡¨ä¸Šç´¢å¼•å»ºçš„è¶Šå¤šï¼Œå°±ä¼šå ç”¨è¶Šå¤šçš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨å¢åˆ æ”¹è®°å½•çš„æ—¶å€™æ€§èƒ½å°±è¶Šå·®ã€‚ä¸ºäº†èƒ½å»ºç«‹åˆå¥½åˆå°‘çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¾—å­¦å­¦è¿™äº›ç´¢å¼•åœ¨å“ªäº›æ¡ä»¶ä¸‹èµ·ä½œç”¨çš„ã€‚</p></blockquote><h2 id="9-ç´¢å¼•æ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§">9. ç´¢å¼•æ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§</h2><p>ä»MySQLçš„è§’åº¦è®²ï¼Œä¸å¾—ä¸è€ƒè™‘ä¸€ä¸ªç°å®é—®é¢˜å°±æ˜¯ç£ç›˜IOã€‚å¦‚æœæˆ‘ä»¬èƒ½è®©ç´¢å¼•çš„æ•°æ®ç»“æ„å°½é‡å‡å°‘ç¡¬ç›˜çš„V/0æ“ä½œï¼Œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¹Ÿå°±è¶Šå°ã€‚å¯ä»¥è¯´ï¼Œ<code>ç£ç›˜çš„I/0</code>æ“ä½œæ¬¡æ•°å¯¹ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡è‡³å…³é‡è¦ã€‚</p><p>æŸ¥æ‰¾éƒ½æ˜¯ç´¢å¼•æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ç´¢å¼•éå¸¸å¤§ï¼Œå°¤å…¶æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œå½“æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œç´¢å¼•çš„å¤§å°æœ‰å¯èƒ½å‡ ä¸ªGç”šè‡³æ›´å¤šï¼Œä¸ºäº†å‡å°‘ç´¢å¼•åœ¨å†…å­˜çš„å ç”¨ï¼Œ<span class='p red'>æ•°æ®åº“ç´¢å¼•æ˜¯å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜ä¸Šçš„ã€‚</span>å½“æˆ‘ä»¬åˆ©ç”¨ç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™ï¼Œ ä¸å¯èƒ½æŠŠæ•´ä¸ªç´¢å¼•å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œåªèƒ½<code>é€ä¸€åŠ è½½</code>ï¼Œé‚£ä¹ˆMySQLè¡¡é‡æŸ¥è¯¢æ•ˆç‡çš„æ ‡å‡†å°±æ˜¯ç£ç›˜IOæ¬¡æ•°ã€‚</p><h3 id="9-1-å…¨è¡¨æŸ¥è¯¢">9.1 å…¨è¡¨æŸ¥è¯¢</h3><p>ç›¸å½“äºé¡ºåºæŸ¥æ‰¾ã€‚</p><p>è¿™é‡Œéƒ½æ‡’å¾—è¯´äº†ã€‚</p><h3 id="9-2-HashæŸ¥è¯¢">9.2 HashæŸ¥è¯¢</h3><p>Hash æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆè¢«ç§°ä¸ºæ•£åˆ—å‡½æ•°ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤§å¹…æå‡æ£€ç´¢æ•°æ®çš„æ•ˆç‡ã€‚</p><p>Hash ç®—æ³•æ˜¯é€šè¿‡æŸç§ç¡®å®šæ€§çš„ç®—æ³•ï¼ˆæ¯”å¦‚ MD5ã€ SHA1ã€ SHA2ã€ SHA3) å°†è¾“å…¥è½¬å˜ä¸ºè¾“å‡ºã€‚<code>ç›¸åŒçš„è¾“å…¥æ°¸è¿œå¯ä»¥å¾—åˆ°ç›¸åŒçš„è¾“å‡º</code>ï¼Œå‡è®¾è¾“å…¥å†…å®¹æœ‰å¾®å°åå·®ï¼Œåœ¨è¾“å‡ºä¸­é€šå¸¸ä¼šæœ‰ä¸åŒçš„ç»“æœã€‚</p><p>ä¸¾ä¾‹ï¼šå¦‚æœä½ æƒ³è¦éªŒè¯ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒï¼Œé‚£ä¹ˆä½ ä¸éœ€è¦æŠŠä¸¤ä»½æ–‡ä»¶ç›´æ¥æ‹¿æ¥æ¯”å¯¹ï¼Œåªéœ€è¦è®©å¯¹æ–¹æŠŠ Hash å‡½æ•°è®¡ç®—å¾—åˆ°çš„ç»“æœå‘Šè¯‰ä½ å³å¯ï¼Œç„¶ååœ¨æœ¬åœ°åŒæ ·å¯¹æ–‡ä»¶è¿›è¡Œ Hash å‡½æ•°çš„è¿ç®—ï¼Œæœ€åé€šè¿‡æ¯”è¾ƒè¿™ä¸¤ä¸ª Hash å‡½æ•°çš„ç»“æœæ˜¯å¦ç›¸åŒï¼Œå°±å¯ä»¥çŸ¥é“è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒã€‚</p><p>åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦çš„æ•°æ®ç»“æ„ï¼Œå¸¸è§çš„æœ‰ä¸¤ç±»ï¼š</p><p>(1) æ ‘ï¼Œä¾‹å¦‚å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ŒæŸ¥è¯¢/æ’å…¥/ä¿®æ”¹/åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<code>O(log2N)</code>;</p><p>(2)å“ˆå¸Œï¼Œä¾‹å¦‚HashMapï¼ŒæŸ¥è¯¢/æ’å…¥/ä¿®æ”¹/åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<code>O(1)</code>; (key, value)</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617162153587.png" alt="image-20220617162153587" style="zoom:67%;" /><p>é‡‡ç”¨ Hash è¿›è¡Œæ£€ç´ æ•ˆç‡éå¸¸é«˜ï¼ŒåŸºæœ¬ä¸Šä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥æ‰¾åˆ°æ•°æ®ï¼Œè€Œ B+æ ‘éœ€è¦è‡ªé¡¶å‘ä¸‹ä¾æ¬¡æŸ¥æ‰¾ï¼Œå¤šæ¬¡è®¿é—®èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°æ•°æ®ï¼Œä¸­é—´éœ€è¦å¤šæ¬¡IO æ“ä½œï¼Œ<code>ä»æ•ˆç‡æ¥è¯´ Hash æ¯” B+ æ ‘æ›´å¿«</code>ã€‚</p><p>åœ¨å“ˆå¸Œçš„æ–¹å¼ä¸‹ï¼Œä¸€ä¸ªå…ƒç´ kå¤„äºh(k)ä¸­ï¼Œå³åˆ©ç”¨å“ˆå¸Œå‡½æ•°hï¼Œæ ¹æ®å…³é”®å­—kè®¡ç®—å‡ºæ§½çš„ä½ç½®ã€‚å‡½æ•°hå°†å…³é”®å­—åŸŸæ˜ å°„åˆ°å“ˆå¸Œè¡¨T[0â€¦m-1]çš„æ§½ä½ä¸Šã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617162604272.png" alt="image-20220617162604272" style="zoom:67%;" /><p>ä¸Šå›¾ä¸­å“ˆå¸Œå‡½æ•°hæœ‰å¯èƒ½å°†ä¸¤ä¸ªä¸åŒçš„å…³é”®å­—æ˜ å°„åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¿™å«åš<code>ç¢°æ’</code>ï¼Œåœ¨æ•°æ®åº“ä¸­ä¸€èˆ¬é‡‡ç”¨<code>é“¾æ¥æ³•</code>æ¥è§£å†³ã€‚åœ¨é“¾æ¥æ³•ä¸­ï¼Œå°†æ•£åˆ—åˆ°åŒä¸€æ§½ä½çš„å…ƒç´ æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617162703006.png" alt="image-20220617162703006" style="zoom:67%;" /><span class='p green'>å®éªŒï¼šä½“ä¼šæ•°ç»„å’Œhashè¡¨çš„æŸ¥æ‰¾æ–¹é¢çš„æ•ˆç‡åŒºåˆ«</span><div class="tabs" id="e62a39b3-0bfb-45cb-841a-341c07fdc320"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#e62a39b3-0bfb-45cb-841a-341c07fdc320-1"><i class="fas fa-seedling"></i>æ•°ç»„æŸ¥è¯¢</button></li><li class="tab"><button type="button" data-href="#e62a39b3-0bfb-45cb-841a-341c07fdc320-2"><i class="fas fa-leaf"></i>HashæŸ¥è¯¢</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="e62a39b3-0bfb-45cb-841a-341c07fdc320-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®—æ³•å¤æ‚åº¦ä¸º O(n)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100000</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; arr.length;i++)&#123;</span><br><span class="line">        arr[i] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j&lt;=<span class="number">100000</span>;j++)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> j;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; arr.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(temp == arr[i])&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;timeï¼š &quot;</span> + (end - start)); </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//timeï¼š 823</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="e62a39b3-0bfb-45cb-841a-341c07fdc320-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®—æ³•å¤æ‚åº¦ä¸º O(1)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    HashSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(<span class="number">100000</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; <span class="number">100000</span>;i++)&#123;</span><br><span class="line">    set.add(i + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j&lt;=<span class="number">100000</span>;j++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> j;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">contains</span> <span class="operator">=</span> set.contains(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;timeï¼š &quot;</span> + (end - start)); </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//timeï¼š 5</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><span class='p red'>Hashç»“æ„æ•ˆç‡é«˜ï¼Œé‚£ä¸ºä»€ä¹ˆç´¢å¼•ç»“æ„è¦è®¾è®¡æˆæ ‘å‹å‘¢ï¼Ÿ</span><p>åŸå› 1ï¼šHash ç´¢å¼•|ä»…èƒ½æ»¡è¶³(=)(&lt;&gt;)å’Œ IN æŸ¥è¯¢ã€‚å¦‚æœè¿›è¡Œ<code>èŒƒå›´æŸ¥è¯¢</code>ï¼Œå“ˆå¸Œå‹çš„ç´¢å¼•ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šé€€åŒ–ä¸º o(n)ï¼›è€Œæ ‘å‹çš„â€œæœ‰åºâ€ç‰¹æ€§ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒO(log2N) çš„é«˜æ•ˆç‡ã€‚</p><p>åŸå› 2ï¼šHash ç´¢å¼•è¿˜æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œæ•°æ®çš„å­˜å‚¨æ˜¯<code>æ²¡æœ‰é¡ºåºçš„</code>ï¼Œåœ¨ ORDER BY çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Hash ç´¢å¼•è¿˜éœ€è¦å¯¹æ•°æ®é‡æ–°æ’åºã€‚</p><p>åŸå› 3ï¼šå¯¹äºè”åˆç´¢å¼•çš„æƒ…å†µï¼ŒHash å€¼æ˜¯å°†è”åˆç´¢å¼•é”®åˆå¹¶åä¸€èµ·æ¥è®¡ç®—çš„ï¼Œæ— æ³•å¯¹å•ç‹¬çš„ä¸€ä¸ªé”®æˆ–è€…å‡ ä¸ªç´¢å¼•é”®è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>åŸå› 4ï¼šå¯¹äºç­‰å€¼æŸ¥è¯¢æ¥è¯´ï¼Œé€šå¸¸ Hash ç´¢å¼•çš„æ•ˆç‡æ›´é«˜ï¼Œä¸è¿‡ä¹Ÿå­˜åœ¨ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯<code>ç´¢å¼•åˆ—çš„é‡å¤å€¼å¦‚æœå¾ˆå¤šï¼Œæ•ˆç‡å°±ä¼šé™ä½</code>ã€‚è¿™æ˜¯å› ä¸ºé‡åˆ° Hash å†²çªæ—¶ï¼Œéœ€è¦éå†æ¡¶ä¸­çš„è¡ŒæŒ‡é’ˆæ¥è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾åˆ°æŸ¥è¯¢çš„å…³é”®å­—ï¼Œéå¸¸è€—æ—¶ã€‚æ‰€ä»¥ï¼ŒHash ç´¢å¼•é€šå¸¸ä¸ä¼šç”¨åˆ°é‡å¤å€¼å¤šçš„åˆ—ä¸Šï¼Œæ¯”å¦‚åˆ—ä¸ºæ€§åˆ«ã€å¹´é¾„çš„æƒ…å†µç­‰ã€‚</p><span class='p green'>Hashç´¢å¼•é€‚ç”¨å­˜å‚¨å¼•æ“å¦‚è¡¨æ‰€ç¤ºï¼š</span><table><thead><tr><th style="text-align:center">ç´¢å¼• / å­˜å‚¨å¼•æ“</th><th style="text-align:center">MyISAM</th><th style="text-align:center">InnoDB</th><th style="text-align:center">Memory</th></tr></thead><tbody><tr><td style="text-align:center">HASHç´¢å¼•</td><td style="text-align:center">ä¸æ”¯æŒ</td><td style="text-align:center">ä¸æ”¯æŒ</td><td style="text-align:center">æ”¯æŒ</td></tr></tbody></table><span class='p green'>Hashç´¢å¼•çš„é€‚ç”¨æ€§ï¼š</span><p>Hash ç´¢å¼•å­˜åœ¨ç€å¾ˆå¤šé™åˆ¶ï¼Œç›¸æ¯”ä¹‹ä¸‹åœ¨æ•°æ®åº“ä¸­ B+ æ ‘ç´¢å¼•çš„ä½¿ç”¨é¢ä¼šæ›´å¹¿ï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€äº›åœºæ™¯é‡‡ç”¨ Hash ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼Œæ¯”å¦‚åœ¨é”®å€¼å‹ï¼ˆKey-Valueï¼‰æ•°æ®åº“ä¸­ï¼Œ<code>Redis å­˜å‚¨çš„æ ¸å¿ƒå°±æ˜¯ Hash è¡¨</code>ã€‚</p><p>MySQL ä¸­çš„ Memory å­˜å‚¨å¼•æ“æ”¯æŒ Hash å­˜å‚¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ç”¨åˆ°æŸ¥è¯¢çš„ä¸´æ—¶è¡¨æ—¶ï¼Œå°±å¯ä»¥é€‰æ‹© Memory å­˜å‚¨å¼•æ“ï¼ŒæŠŠæŸä¸ªå­—æ®µè®¾ç½®ä¸º Hash ç´¢å¼•ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œè¿›è¡Œ Hash è®¡ç®—ä¹‹åé•¿åº¦å¯ä»¥ç¼©çŸ­åˆ°å‡ ä¸ªå­—èŠ‚ã€‚å½“å­—æ®µçš„é‡å¤åº¦ä½ï¼Œè€Œä¸”ç»å¸¸éœ€è¦è¿›è¡Œ<code>ç­‰å€¼æŸ¥è¯¢</code>çš„æ—¶å€™ï¼Œé‡‡ç”¨ Hash ç´¢å¼•æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p>å¦å¤–ï¼ŒInnoDB æœ¬èº«ä¸æ”¯æŒ Hash ç´¢å¼•ï¼Œä½†æ˜¯æä¾›<code>è‡ªé€‚åº” Hash ç´¢å¼•</code>(Adaptive Hash Index)ã€‚ä»€ä¹ˆæƒ…å†µä¸‹æ‰ä¼šä½¿ç”¨è‡ªé€‚åº” Hash ç´¢å¼•å‘¢ï¼Ÿå¦‚æœæŸä¸ªæ•°æ®ç»å¸¸è¢«è®¿é—®ï¼Œå½“æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šå°†è¿™ä¸ªæ•°æ®é¡µçš„åœ°å€å­˜æ”¾åˆ° Hash è¡¨ä¸­ã€‚è¿™æ ·ä¸‹æ¬¡æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥æ‰¾åˆ°è¿™ä¸ªé¡µé¢çš„æ‰€åœ¨ä½ç½®ã€‚è¿™æ ·è®© B+ æ ‘ä¹Ÿå…·å¤‡äº† Hash ç´¢å¼•çš„ä¼˜ç‚¹ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230408171742687.png" alt="image-20230408171742687" style="zoom:50%;" /><p>é‡‡ç”¨è‡ªé€‚åº” Hash ç´¢å¼•ç›®çš„æ˜¯æ–¹ä¾¿æ ¹æ® SQL çš„æŸ¥è¯¢æ¡ä»¶åŠ é€Ÿå®šä½åˆ°å¶å­èŠ‚ç‚¹ï¼Œç‰¹åˆ«æ˜¯å½“ B+ æ ‘æ¯”è¾ƒæ·±çš„æ—¶ å€™ï¼Œé€šè¿‡è‡ªé€‚åº” Hash ç´¢å¼•å¯ä»¥æ˜æ˜¾æé«˜æ•°æ®çš„æ£€ç´¢æ•ˆç‡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ innodb_adaptive_hash_index å˜é‡æ¥æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†è‡ªé€‚åº” Hashï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%adaptive_hash_index&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="9-3-äºŒå‰æœç´¢æ ‘">9.3 äºŒå‰æœç´¢æ ‘</h3><p>å¦‚æœæˆ‘ä»¬åˆ©ç”¨äºŒå‰æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œé‚£ä¹ˆç£ç›˜çš„IOæ¬¡æ•°å’Œç´¢å¼•æ ‘çš„é«˜åº¦æ˜¯ç›¸å…³çš„ã€‚</p><span class='p green'>1. äºŒå‰æœç´¢æ ‘çš„ç‰¹ç‚¹</span><ul><li>ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹åº¦ä¸èƒ½è¶…è¿‡2</li><li>å·¦å­èŠ‚ç‚¹ &lt; æœ¬èŠ‚ç‚¹; å³å­èŠ‚ç‚¹ &gt;= æœ¬èŠ‚ç‚¹ï¼Œæ¯”æˆ‘å¤§çš„å‘å³ï¼Œæ¯”æˆ‘å°çš„å‘å·¦</li></ul><span class='p green'>2. æŸ¥æ‰¾è§„åˆ™</span><div class="tabs" id="bb3fbfa4-cf47-4fee-a9e6-15bfe4762219"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#bb3fbfa4-cf47-4fee-a9e6-15bfe4762219-1"><i class="fas fa-award"></i>1</button></li><li class="tab"><button type="button" data-href="#bb3fbfa4-cf47-4fee-a9e6-15bfe4762219-2"><i class="fas fa-baseball-ball"></i>2</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="bb3fbfa4-cf47-4fee-a9e6-15bfe4762219-1"><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœ€åŸºç¡€çš„äºŒå‰æœç´¢æ ‘ (Binary Search Treeï¼‰ï¼Œæœç´¢æŸä¸ªèŠ‚ç‚¹å’Œæ’å…¥èŠ‚ç‚¹çš„è§„åˆ™ä¸€æ ·ï¼Œæˆ‘ä»¬å‡è®¾æœç´¢æ’å…¥çš„æ•°å€¼ä¸º key:</p><ol><li>å¦‚æœ key å¤§äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™åœ¨å³å­æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼›</li><li>å¦‚æœ key å°äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™åœ¨å·¦å­æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼›</li><li>å¦‚æœ key ç­‰äºæ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°äº†è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿”å›æ ¹èŠ‚ç‚¹å³å¯ã€‚</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯¹æ•°åˆ— ï¼ˆ34ï¼Œ22ï¼Œ89ï¼Œ5,23ï¼Œ77ï¼Œ91ï¼‰åˆ›é€ å‡ºæ¥çš„äºŒåˆ†æŸ¥æ‰¾æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617164022728.png" alt="image-20220617164022728" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bb3fbfa4-cf47-4fee-a9e6-15bfe4762219-2"><p>ä½†æ˜¯ç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯æœ‰æ—¶å€™äºŒå‰æ ‘çš„æ·±åº¦éå¸¸å¤§ï¼Œæ¯”å¦‚ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617164053134.png" alt="image-20220617164053134" style="zoom:50%;" /><p>ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå°±éœ€è¦ å‡å°‘ç£ç›˜IOæ•° ã€‚ä¸ºäº†å‡å°‘ç£ç›˜IOçš„æ¬¡æ•°ï¼Œå°±éœ€è¦å°½é‡ é™ä½æ ‘çš„é«˜åº¦ ï¼Œéœ€è¦æŠŠ åŸæ¥â€œç˜¦é«˜â€çš„æ ‘ç»“æ„å˜çš„â€œçŸ®èƒ–â€ï¼Œæ ‘çš„æ¯å±‚çš„åˆ†å‰è¶Šå¤šè¶Šå¥½ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h3 id="9-4-AVLæ ‘">9.4 AVLæ ‘</h3><p>ä¸ºäº†è§£å†³ä¸Šé¢äºŒå‰æŸ¥æ‰¾æ ‘é€€åŒ–æˆé“¾è¡¨çš„é—®é¢˜ï¼Œäººä»¬æå‡ºäº†<code>å¹³è¡¡äºŒå‰æœç´¢æ ‘</code>(Balanced Binary Tree)ï¼Œåˆç§°ä¸º AVLæ ‘ï¼ˆæœ‰åˆ«äºAVLç®—æ³•ï¼‰ï¼Œå®ƒåœ¨äºŒå‰æœç´¢æ ‘çš„åŸºç¡€ä¸Šå¢åŠ äº†çº¦æŸï¼Œå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><span class='p red'>å®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚</span><p>è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œå¸¸è§çš„å¹³è¡¡äºŒå‰æ ‘æœ‰å¾ˆå¤šç§ï¼ŒåŒ…æ‹¬äº†å¹³è¡¡äºŒå‰æœç´¢æ ‘ã€çº¢é»‘æ ‘ã€æ•°å †ã€ä¼¸å±•æ ‘ã€‚å¹³è¡¡äºŒå‰æœç´¢æ ‘æ˜¯æœ€æ—©æå‡ºæ¥çš„è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œå½“æˆ‘ä»¬æåˆ°å¹³è¡¡äºŒå‰æ ‘æ—¶ä¸€èˆ¬æŒ‡çš„å°±æ˜¯å¹³è¡¡äºŒå‰æœç´¢æ ‘ã€‚äº‹å®ä¸Šï¼Œç¬¬ä¸€æ£µæ ‘å°±å±äºå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæœç´¢æ—¶é—´å¤æ‚åº¦å°±æ˜¯ 0(log2n)ã€‚</p><p>æ•°æ®æŸ¥è¯¢çš„æ—¶é—´ä¸»è¦ä¾èµ–äºç£ç›˜I/0 çš„æ¬¡æ•°ï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨äºŒå‰æ ‘çš„å½¢å¼ï¼Œå³ä½¿é€šè¿‡å¹³è¡¡äºŒå‰æœç´¢æ ‘è¿›è¡Œäº†æ”¹è¿›ï¼Œæ ‘çš„æ·±åº¦ä¹Ÿæ˜¯ O(log2n)ï¼Œå½“næ¯”è¾ƒå¤§æ—¶ï¼Œæ·±åº¦ä¹Ÿæ˜¯æ¯”è¾ƒé«˜çš„ï¼Œæ¯”å¦‚ä¸‹å›¾çš„æƒ…å†µï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617165105005.png" alt="image-20220617165105005"></p><p>æ¯è®¿é—®ä¸€æ¬¡èŠ‚ç‚¹å°±éœ€è¦è¿›è¡Œä¸€æ¬¡ç£ç›˜ I/O æ“ä½œï¼Œå¯¹äºä¸Šé¢çš„æ ‘æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ 5æ¬¡ I/O æ“ä½œã€‚è™½ç„¶å¹³è¡¡äºŒå‰æ ‘çš„æ•ˆç‡é«˜ï¼Œä½†æ˜¯æ ‘çš„æ·±åº¦ä¹ŸåŒæ ·é«˜ï¼Œè¿™å°±æ„å‘³ç€ç£ç›˜ I/O æ“ä½œæ¬¡æ•°å¤šï¼Œä¼šå½±å“æ•´ä½“æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p><p>é’ˆå¯¹åŒæ ·çš„æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æŠŠäºŒå‰æ ‘æ”¹æˆ M å‰æ ‘ ï¼ˆM&gt;2ï¼‰å‘¢ï¼Ÿå½“ M=3 æ—¶ï¼ŒåŒæ ·çš„ 31 ä¸ªèŠ‚ç‚¹å¯ä»¥ç”±ä¸‹é¢ çš„ä¸‰å‰æ ‘æ¥è¿›è¡Œå­˜å‚¨ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617165124685.png" alt="image-20220617165124685"></p><p>ä½ èƒ½çœ‹åˆ°æ­¤æ—¶æ ‘çš„é«˜åº¦é™ä½äº†ï¼Œå½“æ•°æ®é‡ N å¤§çš„æ—¶å€™ï¼Œä»¥åŠæ ‘çš„åˆ†å‰æ ‘ M å¤§çš„æ—¶å€™ï¼ŒMå‰æ ‘çš„é«˜åº¦ä¼šè¿œå°äºäºŒå‰æ ‘çš„é«˜åº¦ (M &gt; 2)ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ`æ ‘ä»â€œç˜¦é«˜â€ å˜ â€œçŸ®èƒ–â€ã€‚</p><h3 id="9-5-B-Tree">9.5 B-Tree</h3><p>B æ ‘çš„è‹±æ–‡æ˜¯ Balance Treeï¼Œä¹Ÿå°±æ˜¯<code>å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘</code>ã€‚ç®€å†™ä¸º B-Treeã€‚å®ƒçš„é«˜åº¦è¿œå°äºå¹³è¡¡äºŒå‰æ ‘çš„é«˜åº¦ã€‚</p><p>B æ ‘çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230408172814225.png" alt="image-20230408172814225" style="zoom:67%;" /><p>Bæ ‘ä½œä¸ºå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œå®ƒçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå¯ä»¥åŒ…æ‹¬Mä¸ªå­èŠ‚ç‚¹ï¼Œ<code>M ç§°ä¸ºB æ ‘çš„é˜¶</code>ã€‚æ¯ä¸ªç£ç›˜å—ä¸­åŒ…æ‹¬äº†<code>å…³é”®å­—</code>å’Œ<code>å­èŠ‚ç‚¹çš„æŒ‡é’ˆ</code>ã€‚å¦‚æœä¸€ä¸ªç£ç›˜å—ä¸­åŒ…æ‹¬äº†Ã—ä¸ªå…³é”®å­—ï¼Œé‚£ä¹ˆæŒ‡é’ˆæ•°å°±æ˜¯x+1ã€‚å¯¹äºä¸€ä¸ª100é˜¶çš„Bæ ‘æ¥è¯´ï¼Œå¦‚æœæœ‰3å±‚çš„è¯æœ€å¤šå¯ä»¥å­˜å‚¨çº¦ 100 ä¸‡çš„ç´¢å¼•æ•°æ®ã€‚å¯¹äºå¤§é‡çš„ç´¢å¼•æ•°æ®æ¥è¯´ï¼Œé‡‡ç”¨Bæ ‘çš„ç»“æ„æ˜¯éå¸¸é€‚åˆçš„ï¼Œå› ä¸ºæ ‘çš„é«˜åº¦è¦è¿œå°äºäºŒå‰æ ‘çš„é«˜åº¦ã€‚</p><div class="tabs" id="d93e2ac0-53b2-466b-b0ac-56143caf62d2"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#d93e2ac0-53b2-466b-b0ac-56143caf62d2-1"><i class="fas fa-award"></i>Bæ ‘ç‰¹æ€§</button></li><li class="tab"><button type="button" data-href="#d93e2ac0-53b2-466b-b0ac-56143caf62d2-2"><i class="fas fa-baseball-ball"></i>Bæ ‘çš„æŸ¥æ‰¾</button></li><li class="tab"><button type="button" data-href="#d93e2ac0-53b2-466b-b0ac-56143caf62d2-3"><i class="fas fa-bone"></i>å°ç»“</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="d93e2ac0-53b2-466b-b0ac-56143caf62d2-1"><p>ä¸€ä¸ª M é˜¶çš„ B æ ‘ï¼ˆM&gt;2ï¼‰æœ‰ä»¥ä¸‹çš„ç‰¹æ€§ï¼š</p><ol><li>æ ¹èŠ‚ç‚¹çš„å„¿å­æ•°çš„èŒƒå›´æ˜¯ [2,M]ã€‚</li><li>æ¯ä¸ªä¸­é—´èŠ‚ç‚¹åŒ…å« k-1 ä¸ªå…³é”®å­—å’Œ k ä¸ªå­©å­ï¼Œå­©å­çš„æ•°é‡ = å…³é”®å­—çš„æ•°é‡ +1ï¼Œk çš„å–å€¼èŒƒå›´ä¸º [ceil(M/2), M]ã€‚</li><li>å¶å­èŠ‚ç‚¹åŒ…æ‹¬ k-1 ä¸ªå…³é”®å­—ï¼ˆå¶å­èŠ‚ç‚¹æ²¡æœ‰å­©å­ï¼‰ï¼Œk çš„å–å€¼èŒƒå›´ä¸º [ceil(M/2), M]ã€‚</li><li>å‡è®¾ä¸­é—´èŠ‚ç‚¹èŠ‚ç‚¹çš„å…³é”®å­—ä¸ºï¼šKey[1], Key[2], â€¦, Key[k-1]ï¼Œä¸”å…³é”®å­—æŒ‰ç…§å‡åºæ’åºï¼Œå³ Key[i]&lt;Key[i+1]ã€‚æ­¤æ—¶ k-1 ä¸ªå…³é”®å­—ç›¸å½“äºåˆ’åˆ†äº† k ä¸ªèŒƒå›´ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ k ä¸ªæŒ‡é’ˆï¼Œå³ä¸ºï¼šP[1], P[2], â€¦, P[k]ï¼Œå…¶ä¸­ P[1] æŒ‡å‘å…³é”®å­—å°äº Key[1] çš„å­æ ‘ï¼ŒP[i] æŒ‡å‘å…³é”®å­—å±äº (Key[i-1], Key[i]) çš„å­æ ‘ï¼ŒP[k] æŒ‡å‘å…³é”®å­—å¤§äº Key[k-1] çš„å­æ ‘ã€‚</li><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹ä½äºåŒä¸€å±‚ã€‚</li></ol><p>ä¸Šé¢é‚£å¼ å›¾æ‰€è¡¨ç¤ºçš„ B æ ‘å°±æ˜¯ä¸€æ£µ 3 é˜¶çš„ B æ ‘ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ç£ç›˜å— 2ï¼Œé‡Œé¢çš„å…³é”®å­—ä¸ºï¼ˆ8ï¼Œ12ï¼‰ï¼Œå®ƒ æœ‰ 3 ä¸ªå­©å­ (3ï¼Œ5)ï¼Œ(9ï¼Œ10) å’Œ (13ï¼Œ15)ï¼Œä½ èƒ½çœ‹åˆ° (3ï¼Œ5) å°äº 8ï¼Œ(9ï¼Œ10) åœ¨ 8 å’Œ 12 ä¹‹é—´ï¼Œè€Œ (13ï¼Œ15) å¤§äº 12ï¼Œåˆšå¥½ç¬¦åˆåˆšæ‰æˆ‘ä»¬ç»™å‡ºçš„ç‰¹å¾ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d93e2ac0-53b2-466b-b0ac-56143caf62d2-2"><p>ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ç”¨ B æ ‘è¿›è¡ŒæŸ¥æ‰¾ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦ æŸ¥æ‰¾çš„å…³é”®å­—æ˜¯ 9 ï¼Œé‚£ä¹ˆæ­¥éª¤å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li>æˆ‘ä»¬ä¸æ ¹èŠ‚ç‚¹çš„å…³é”®å­— (17ï¼Œ35ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œ9 å°äº 17 é‚£ä¹ˆå¾—åˆ°æŒ‡é’ˆ P1ï¼›</li><li>æŒ‰ç…§æŒ‡é’ˆ P1 æ‰¾åˆ°ç£ç›˜å— 2ï¼Œå…³é”®å­—ä¸ºï¼ˆ8ï¼Œ12ï¼‰ï¼Œå› ä¸º 9 åœ¨ 8 å’Œ 12 ä¹‹é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°æŒ‡é’ˆ P2ï¼›</li><li>æŒ‰ç…§æŒ‡é’ˆ P2 æ‰¾åˆ°ç£ç›˜å— 6ï¼Œå…³é”®å­—ä¸ºï¼ˆ9ï¼Œ10ï¼‰ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†å…³é”®å­— 9ã€‚</li></ol><p>ä½ èƒ½çœ‹å‡ºæ¥åœ¨ B æ ‘çš„æœç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒçš„æ¬¡æ•°å¹¶ä¸å°‘ï¼Œä½†å¦‚æœæŠŠæ•°æ®è¯»å–å‡ºæ¥ç„¶ååœ¨å†…å­˜ä¸­è¿›è¡Œæ¯” è¾ƒï¼Œè¿™ä¸ªæ—¶é—´å°±æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚è€Œè¯»å–ç£ç›˜å—æœ¬èº«éœ€è¦è¿›è¡Œ I/O æ“ä½œï¼Œæ¶ˆè€—çš„æ—¶é—´æ¯”åœ¨å†…å­˜ä¸­è¿›è¡Œ æ¯”è¾ƒæ‰€éœ€è¦çš„æ—¶é—´è¦å¤šï¼Œæ˜¯æ•°æ®æŸ¥æ‰¾ç”¨æ—¶çš„é‡è¦å› ç´ ã€‚ B æ ‘ç›¸æ¯”äºå¹³è¡¡äºŒå‰æ ‘æ¥è¯´ç£ç›˜ I/O æ“ä½œè¦å°‘ ï¼Œ åœ¨æ•°æ®æŸ¥è¯¢ä¸­æ¯”å¹³è¡¡äºŒå‰æ ‘æ•ˆç‡è¦é«˜ã€‚æ‰€ä»¥ åªè¦æ ‘çš„é«˜åº¦è¶³å¤Ÿä½ï¼ŒIOæ¬¡æ•°è¶³å¤Ÿå°‘ï¼Œå°±å¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d93e2ac0-53b2-466b-b0ac-56143caf62d2-3"><p>å°ç»“ï¼š</p><ol><li><p>Bæ ‘åœ¨æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™å¦‚æœå¯¼è‡´æ ‘ä¸å¹³è¡¡ï¼Œå°±é€šè¿‡è‡ªåŠ¨è°ƒæ•´èŠ‚ç‚¹çš„ä½ç½®æ¥ä¿æŒæ ‘çš„è‡ªå¹³è¡¡ã€‚</p></li><li><p>å…³é”®å­—é›†åˆåˆ†å¸ƒåœ¨æ•´æ£µæ ‘ä¸­ï¼Œå³å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹éƒ½å­˜æ”¾æ•°æ®ã€‚æœç´¢æœ‰å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹ç»“æŸ</p></li><li><p>å…¶æœç´¢æ€§èƒ½ç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†å†…åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾ã€‚</p></li></ol><p><strong>å†ä¸¾ä¾‹1ï¼š</strong></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617170526488.png" alt="image-20220617170526488"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h3 id="9-6-B-Tree">9.6 B+Tree</h3><p>B+æ ‘ä¹Ÿæ˜¯ä¸€ç§å¤šè·¯æœç´¢æ ‘ï¼Œ<code>åŸºäºBæ ‘åšå‡ºäº†æ”¹è¿›</code>ï¼Œä¸»æµçš„ DBMS éƒ½æ”¯æŒB+æ ‘çš„ç´ å¼•æ–¹å¼ï¼Œæ¯”å¦‚ MysQLã€‚ç›¸æ¯”äºB-Treeï¼Œ<code>B+Treeé€‚åˆæ–‡ä»¶ç´¢å¼•ç³»ç»Ÿ</code>ã€‚</p><div class="tabs" id="1bffc484-0b50-4c32-87fa-96e851899c74"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1bffc484-0b50-4c32-87fa-96e851899c74-1"><i class="fas fa-bug"></i>ä¸Bæ ‘çš„å·®å¼‚</button></li><li class="tab"><button type="button" data-href="#1bffc484-0b50-4c32-87fa-96e851899c74-2"><i class="fas fa-cannabis"></i>æŸ¥æ‰¾</button></li><li class="tab"><button type="button" data-href="#1bffc484-0b50-4c32-87fa-96e851899c74-3"><i class="fas fa-candy-cane"></i>æ€è€ƒ</button></li><li class="tab"><button type="button" data-href="#1bffc484-0b50-4c32-87fa-96e851899c74-4"><i class="fas fa-child"></i>æ€è€ƒ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1bffc484-0b50-4c32-87fa-96e851899c74-1"><ol><li>æœ‰ k ä¸ªå­©å­çš„èŠ‚ç‚¹å°±æœ‰ k ä¸ªå…³é”®å­—ã€‚ä¹Ÿå°±æ˜¯å­©å­æ•°é‡ = å…³é”®å­—æ•°ï¼Œè€Œ B æ ‘ä¸­ï¼Œå­©å­æ•°é‡ = å…³é”®å­—æ•° +1ã€‚</li><li>éå¶å­èŠ‚ç‚¹çš„å…³é”®å­—ä¹Ÿä¼šåŒæ—¶å­˜åœ¨åœ¨å­èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”æ˜¯åœ¨å­èŠ‚ç‚¹ä¸­æ‰€æœ‰å…³é”®å­—çš„æœ€å¤§ï¼ˆæˆ–æœ€ å°ï¼‰ã€‚</li><li>éå¶å­èŠ‚ç‚¹ä»…ç”¨äºç´¢å¼•ï¼Œä¸ä¿å­˜æ•°æ®è®°å½•ï¼Œè·Ÿè®°å½•æœ‰å…³çš„ä¿¡æ¯éƒ½æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚è€Œ B æ ‘ä¸­ï¼Œ<code>éå¶å­èŠ‚ç‚¹æ—¢ä¿å­˜ç´¢å¼•ï¼Œä¹Ÿä¿å­˜æ•°æ®è®°å½•</code>ã€‚</li><li>æ‰€æœ‰å…³é”®å­—éƒ½åœ¨å¶å­èŠ‚ç‚¹å‡ºç°ï¼Œå¶å­èŠ‚ç‚¹æ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œè€Œä¸”å¶å­èŠ‚ç‚¹æœ¬èº«æŒ‰ç…§å…³é”®å­—çš„å¤§ å°ä»å°åˆ°å¤§é¡ºåºé“¾æ¥ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1bffc484-0b50-4c32-87fa-96e851899c74-2"><p>ä¸‹å›¾å°±æ˜¯ä¸€æ£µ B+æ ‘ï¼Œé˜¶æ•°ä¸º 3ï¼Œæ ¹èŠ‚ç‚¹ä¸­çš„å…³é”®å­—1ã€18ã€35 åˆ†åˆ«æ˜¯å­èŠ‚ç‚¹(1ï¼Œ8, 14)ï¼Œ(18,24ï¼Œ31ï¼‰å’Œ (35ï¼Œ 41ï¼Œ53ï¼‰ä¸­çš„æœ€å°å€¼ã€‚æ¯ä¸€å±‚çˆ¶èŠ‚ç‚¹çš„å…³é”®å­—éƒ½ä¼šå‡ºç°åœ¨ä¸‹ä¸€å±‚çš„å­èŠ‚ç‚¹çš„å…³é”®å­—ä¸­ï¼Œå› æ­¤åœ¨å¶å­èŠ‚ç‚¹ä¸­åŒ…æ‹¬äº†æ‰€æœ‰çš„å…³é”®å­—ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230408183115135.png" alt="image-20230408183115135" style="zoom: 50%;" /><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾å…³é”®å­— 16ï¼ŒB+ æ ‘ä¼šè‡ªé¡¶å‘ä¸‹é€å±‚è¿›è¡ŒæŸ¥æ‰¾ï¼š</p><ol><li>ä¸æ ¹èŠ‚ç‚¹çš„å…³é”®å­—(1ï¼Œ18ï¼Œ35) è¿›è¡Œæ¯”è¾ƒï¼Œ16åœ¨1å’Œ18ä¹‹é—´ï¼Œå¾—åˆ°æŒ‡é’ˆ P1ï¼ˆæŒ‡å‘ç£ç›˜å—2ï¼‰</li><li>æ‰¾åˆ°ç£ç›˜å—2ï¼Œå…³é”®å­—ä¸ºï¼ˆ1ï¼Œ8ï¼Œ14ï¼‰ï¼Œå› ä¸º 16å¤§äº14ï¼Œæ‰€ä»¥å¾—åˆ°æŒ‡é’ˆ P3ï¼ˆæŒ‡å‘ç£ç›˜å—7ï¼‰</li><li>æ‰¾åˆ°ç£ç›˜å—7ï¼Œå…³é”®å­—ä¸ºï¼ˆ14ï¼Œ16ï¼Œ17ï¼‰ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†å…³é”®å­— 16ï¼Œæ‰€ä»¥å¯ä»¥æ‰¾åˆ°å…³é”®å­—16æ‰€å¯¹åº”çš„æ•°æ®ã€‚</li></ol><p>æ•´ä¸ªè¿‡ç¨‹ä¸€å…±è¿›è¡Œäº†3æ¬¡I/0æ“ä½œï¼Œçœ‹èµ·æ¥ B+æ ‘å’ŒBæ ‘çš„æŸ¥è¯¢è¿‡ç¨‹å·®ä¸å¤šï¼Œä½†æ˜¯ B+æ ‘å’ŒBæ ‘æœ‰ä¸ªæ ¹æœ¬çš„å·®å¼‚åœ¨äºï¼Œ<span class='p red'>B+æ ‘çš„ä¸­é—´èŠ‚ç‚¹å¹¶ä¸ç›´æ¥å­˜å‚¨æ•°æ®</span>ã€‚è¿™æ ·çš„å¥½å¤„éƒ½æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œ<span class='p red'>B+ æ ‘æŸ¥è¯¢æ•ˆç‡æ›´ç¨³å®š</span>ã€‚å› ä¸º B+æ ‘æ¯æ¬¡åªæœ‰è®¿é—®åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°å¯¹åº”çš„æ•°æ®ï¼Œè€Œåœ¨Bæ ‘ä¸­ï¼Œéå¶å­èŠ‚ç‚¹ä¹Ÿä¼šå­˜å‚¨æ•°æ®ï¼Œè¿™æ ·å°±ä¼šé€ æˆæŸ¥è¯¢æ•ˆç‡ä¸ç¨³å®šçš„æƒ…å†µï¼Œæœ‰æ—¶å€™è®¿é—®åˆ°äº†éå¶å­èŠ‚ç‚¹å°±å¯ä»¥æ‰¾åˆ°å…³é”®å­—ï¼Œè€Œæœ‰æ—¶éœ€è¦è®¿é—®åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°å…³é”®å­—ã€‚</p><p>å…¶æ¬¡ï¼Œ<span class='p red'>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜</span>ã€‚è¿™æ˜¯å› ä¸ºé€šå¸¸B+æ ‘æ¯”Bæ ‘æ›´çŸ®èƒ–ï¼ˆé˜¶æ•°æ›´å¤§ï¼Œæ·±åº¦æ›´ä½ï¼‰ï¼ŒæŸ¥è¯¢æ‰€éœ€è¦çš„ç£ç›˜ V/0 ä¹Ÿä¼šæ›´å°‘ã€‚åŒæ ·çš„ç£ç›˜é¡µå¤§å°ï¼ŒB+ æ ‘å¯ä»¥å­˜å‚¨æ›´å¤šçš„èŠ‚ç‚¹å…³é”®å­—ã€‚</p><p>ä¸ä»…æ˜¯å¯¹å•ä¸ªå…³é”®å­—çš„æŸ¥è¯¢ä¸Šï¼Œ<span class='p red'>åœ¨æŸ¥è¯¢èŒƒå›´ä¸Šï¼ŒB+æ ‘çš„æ•ˆç‡ä¹Ÿæ¯” Bæ ‘é«˜</span>ã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰å…³é”®å­—éƒ½å‡ºç°åœ¨ B+ æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œå¶å­èŠ‚ç‚¹ä¹‹é—´ä¼šæœ‰æŒ‡é’ˆï¼Œæ•°æ®åˆæ˜¯é€’å¢çš„ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èŒƒå›´æŸ¥æ‰¾å¯ä»¥é€šè¿‡æŒ‡é’ˆè¿æ¥æŸ¥æ‰¾ã€‚è€Œåœ¨Bæ ‘ä¸­åˆ™éœ€è¦é€šè¿‡ä¸­åºéå†æ‰èƒ½å®ŒæˆæŸ¥è¯¢èŒƒå›´çš„æŸ¥æ‰¾ï¼Œæ•ˆç‡è¦ä½å¾ˆå¤šã€‚</p><blockquote><p>B æ ‘å’Œ B+ æ ‘éƒ½å¯ä»¥ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œåœ¨ MySQL ä¸­é‡‡ç”¨çš„æ˜¯ B+ æ ‘ã€‚</p><p>ä½†Bæ ‘å’ŒB+æ ‘å„æœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œä¸èƒ½è¯´B+æ ‘å®Œå…¨æ¯”Bæ ‘å¥½ï¼Œåä¹‹äº¦ç„¶ã€‚</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1bffc484-0b50-4c32-87fa-96e851899c74-3"><blockquote><p>æ€è€ƒé¢˜ï¼šä¸ºäº†å‡å°‘IOï¼Œç´¢å¼•æ ‘ä¼šä¸€æ¬¡æ€§åŠ è½½å—ï¼Ÿ</p></blockquote><p>1ã€æ•°æ®åº“ç´¢å¼•æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œå¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå¿…ç„¶å¯¼è‡´ç´¢å¼•çš„å¤§å°ä¹Ÿä¼šå¾ˆå¤§ï¼Œè¶…è¿‡å‡ ä¸ªGã€‚<br>2ã€å½“æˆ‘ä»¬åˆ©ç”¨ç´¢å¼•æŸ¥è¯¢æ—¶å€™ï¼Œæ˜¯ä¸å¯èƒ½å°†å…¨éƒ¨å‡ ä¸ªGçš„ç´¢å¼•éƒ½åŠ è½½è¿›å†…å­˜çš„ï¼Œæˆ‘ä»¬èƒ½åšçš„åªèƒ½æ˜¯ï¼šé€ä¸€åŠ è½½æ¯ä¸€ä¸ªç£ç›˜é¡µï¼Œå› ä¸ºç£ç›˜é¡µå¯¹åº”ç€ç´¢å¼•læ ‘çš„èŠ‚ç‚¹ã€‚</p><blockquote><p>æ€è€ƒé¢˜ï¼šB+æ ‘çš„å­˜å‚¨èƒ½åŠ›å¦‚ä½•ï¼Ÿä¸ºä½•è¯´ä¸€èˆ¬æŸ¥æ‰¾è¡Œè®°å½•ï¼Œæœ€å¤šåªéœ€1~3æ¬¡ç£ç›˜IO</p></blockquote><p>InnoDB å­˜å‚¨å¼•/æ“ä¸­é¡µçš„å¤§å°ä¸º 16KBï¼Œä¸€èˆ¬è¡¨çš„ä¸»é”®ç±»å‹ä¸ºINTï¼ˆå ç”¨4ä¸ªå­—èŠ‚ï¼‰æˆ– BIGINTï¼ˆå ç”¨8ä¸ªå­—èŠ‚ï¼‰ï¼ŒæŒ‡é’ˆç±»å‹ä¹Ÿä¸€èˆ¬ä¸º4æˆ–8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡µï¼ˆB+Tree ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹)ä¸­å¤§æ¦‚å­˜å‚¨ 16KB/(8B+8B)=1K ä¸ªé”®å€¼ï¼ˆå› ä¸ºæ˜¯ä¼°å€¼ï¼Œä¸ºæ–¹ä¾¿è®¡ç®—ï¼Œè¿™é‡Œçš„Kå–å€¼ä¸º 10^3ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ·±åº¦ä¸º3çš„ B+Tree ç´¢å¼•å¯ä»¥ç»´æŠ¤ 10^3* 10^3* 10^3=10 äº¿æ¡è®°å½•ã€‚ï¼ˆè¿™é‡Œå‡å®šä¸€ä¸ªæ•°æ®é¡µä¹Ÿå­˜å‚¨10^3æ¡è¡Œè®°å½•æ•°æ®äº†ï¼‰</p><p>å®é™…æƒ…å†µä¸­æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸èƒ½å¡«å……æ»¡ï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­ï¼Œ<code>B+Tree çš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨ 2~4 å±‚</code>ã€‚MySQLçš„ InnoDB å­˜å‚¨å¼•æ“åœ¨è®¾è®¡æ—¶æ˜¯å°†æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶æœ€å¤šåªéœ€è¦1~3 æ¬¡ç£ç›Š I/Oæ“ä½œã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1bffc484-0b50-4c32-87fa-96e851899c74-4"><blockquote><p>æ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆè¯´B+æ ‘æ¯”B-æ ‘æ›´é€‚åˆå®é™…åº”ç”¨ä¸­æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç´¢å¼•å’Œæ•°æ®åº“ç´¢å¼•ï¼Ÿ</p></blockquote><ol><li><p>B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½</p><p>B+æ ‘çš„å†…éƒ¨ç»“ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆã€‚å› æ­¤å…¶å†…éƒ¨ç»“ç‚¹ç›¸å¯¹B æ ‘æ›´å°ã€‚å¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨ç»“ç‚¹çš„å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€ç›˜å—ä¸­ï¼Œé‚£ä¹ˆç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šã€‚ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šã€‚ç›¸å¯¹æ¥è¯´IOè¯»å†™æ¬¡æ•°ä¹Ÿå°±é™ä½äº†ã€‚</p></li><li><p>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š</p><p>ç”±äºéç»ˆç»“ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„ç»“ç‚¹ï¼Œè€Œåªæ˜¯å¶å­ç»“ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ã€‚æ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚</p></li></ol><blockquote><p>æ€è€ƒé¢˜ï¼šHash ç´¢å¼•ä¸ B+ æ ‘ç´¢å¼•çš„åŒºåˆ«</p></blockquote><ol><li><p>Hash ç´¢å¼•<code>ä¸èƒ½è¿›è¡ŒèŒƒå›´æŸ¥è¯¢</code>ï¼Œè€Œ B+ æ ‘å¯ä»¥ã€‚è¿™æ˜¯å› ä¸º Hash ç´¢å¼•æŒ‡å‘çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œè€Œ B+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸ªæœ‰åºçš„é“¾è¡¨ã€‚</p></li><li><p>Hash ç´¢å¼•<code>ä¸æ”¯æŒè”åˆç´¢å¼•çš„æœ€å·¦ä¾§åŸåˆ™</code>ï¼ˆå³è”åˆç´¢å¼•çš„éƒ¨åˆ†ç´¢å¼•æ— æ³•ä½¿ç”¨ï¼‰ï¼Œè€ŒB+ æ ‘å¯ä»¥ã€‚å¯¹äºè”åˆç´¢å¼•æ¥è¯´ï¼ŒHash ç´¢å¼•åœ¨è®¡ç®— Hash å€¼çš„æ—¶å€™æ˜¯å°†ç´¢å¼•é”®åˆå¹¶åå†ä¸€èµ·è®¡ç®— Hash å€¼ï¼Œæ‰€ä»¥ä¸ä¼šé’ˆå¯¹æ¯ä¸ªç´¢å¼•å•ç‹¬è®¡ç®— Hash å€¼ã€‚å› æ­¤å¦‚æœç”¨åˆ°è”åˆç´¢å¼•çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªç´¢å¼•æ—¶ï¼Œè”åˆç´¢å¼•æ— æ³•è¢«åˆ©ç”¨ã€‚</p></li><li><p>Hash æ³°å¼•<code>ä¸æ”¯æŒ ORDER BY æ’åº</code>ï¼Œå› ä¸º Hash ç´¢å¼•æŒ‡å‘çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œå› æ­¤æ— æ³•èµ·åˆ°æ’åºä¼˜åŒ–çš„ä½œç”¨ï¼Œè€ŒB+æ ‘ç´¢å¼•æ•°æ®æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥èµ·åˆ°å¯¹è¯¥å­—æ®µ ORDER BY æ’åºä¼˜åŒ–çš„ä½œç”¨ã€‚åŒç†ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•ç”¨ Hash ç´¢å¼•è¿›è¡Œ<code>æ¨¡ç³ŠæŸ¥è¯¢</code>ï¼Œè€Œ B+ æ ‘ä½¿ç”¨ LIKE è¿›è¡Œæ¨¡æ¹–æŸ¥è¯¢çš„æ—¶å€™ï¼ŒLIKE åé¢åæ¨¡ç³ŠæŸ¥è¯¢ï¼ˆæ¯”å¦‚ï¼…ç»“å°¾ï¼‰çš„è¯å°±å¯ä»¥èµ·åˆ°ä¼˜åŒ–ä½œç”¨ã€‚</p></li><li><p>InnoDB<code>ä¸æ”¯æŒå“ˆå¸Œç´ å¼•</code></p></li></ol><blockquote><p>æ€è€ƒé¢˜ï¼šHash ç´¢å¼•ä¸ B+ æ ‘ç´¢å¼•æ˜¯åœ¨å»ºç´¢å¼•çš„æ—¶å€™æ‰‹åŠ¨æŒ‡å®šçš„å—ï¼Ÿ</p></blockquote><p>ä½ èƒ½çœ‹åˆ°ï¼Œé’ˆå¯¹ InnoDB å’Œ MyISAM å­˜å‚¨å¼•æ“ï¼Œéƒ½ä¼šé»˜è®¤é‡‡ç”¨ B+ æ ‘ç´¢å¼•ï¼Œæ— æ³•ä½¿ç”¨ Hash ç´¢å¼•ã€‚InnoDB æä¾›çš„è‡ªé€‚åº” Hash æ˜¯ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šçš„ã€‚å¦‚æœæ˜¯ Memory/Heap å’ŒNDB å­˜å‚¨å¼•æ“ï¼Œæ˜¯å¯ä»¥è¿›è¡Œé€‰æ‹© Hash ç´¢å¼•çš„ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="9-7-Ræ ‘">9.7 Ræ ‘</h3><p>R-Treeåœ¨MySQLå¾ˆå°‘ä½¿ç”¨ï¼Œä»…æ”¯æŒ<code>geometry</code>æ•°æ®ç±»å‹ ï¼Œæ”¯æŒè¯¥ç±»å‹çš„å­˜å‚¨å¼•æ“åªæœ‰myisamã€bdbã€ innodbã€ndbã€archiveå‡ ç§ã€‚ä¸¾ä¸ªRæ ‘åœ¨ç°å®é¢†åŸŸä¸­èƒ½å¤Ÿè§£å†³çš„ä¾‹å­ï¼šæŸ¥æ‰¾20è‹±é‡Œä»¥å†…æ‰€æœ‰çš„é¤å…ã€‚å¦‚æœ æ²¡æœ‰Ræ ‘ä½ ä¼šæ€ä¹ˆè§£å†³ï¼Ÿä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šæŠŠé¤å…çš„åæ ‡(x,y)åˆ†ä¸ºä¸¤ä¸ªå­—æ®µå­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œä¸€ä¸ªå­—æ®µè®° å½•ç»åº¦ï¼Œå¦ä¸€ä¸ªå­—æ®µè®°å½•çº¬åº¦ã€‚è¿™æ ·çš„è¯æˆ‘ä»¬å°±éœ€è¦éå†æ‰€æœ‰çš„é¤å…è·å–å…¶ä½ç½®ä¿¡æ¯ï¼Œç„¶åè®¡ç®—æ˜¯å¦æ»¡ è¶³è¦æ±‚ã€‚å¦‚æœä¸€ä¸ªåœ°åŒºæœ‰100å®¶é¤å…çš„è¯ï¼Œæˆ‘ä»¬å°±è¦è¿›è¡Œ100æ¬¡ä½ç½®è®¡ç®—æ“ä½œäº†ï¼Œå¦‚æœåº”ç”¨åˆ°è°·æ­Œã€ç™¾åº¦ åœ°å›¾è¿™ç§è¶…å¤§æ•°æ®åº“ä¸­ï¼Œè¿™ç§æ–¹æ³•ä¾¿å¿…å®šä¸å¯è¡Œäº†ã€‚Ræ ‘å°±å¾ˆå¥½çš„ è§£å†³äº†è¿™ç§é«˜ç»´ç©ºé—´æœç´¢é—®é¢˜ ã€‚å®ƒæŠŠB æ ‘çš„æ€æƒ³å¾ˆå¥½çš„æ‰©å±•åˆ°äº†å¤šç»´ç©ºé—´ï¼Œé‡‡ç”¨äº†Bæ ‘åˆ†å‰²ç©ºé—´çš„æ€æƒ³ï¼Œå¹¶åœ¨æ·»åŠ ã€åˆ é™¤æ“ä½œæ—¶é‡‡ç”¨åˆå¹¶ã€åˆ†è§£ ç»“ç‚¹çš„æ–¹æ³•ï¼Œä¿è¯æ ‘çš„å¹³è¡¡æ€§ã€‚å› æ­¤ï¼ŒRæ ‘å°±æ˜¯ä¸€æ£µç”¨æ¥ å­˜å‚¨é«˜ç»´æ•°æ®çš„å¹³è¡¡æ ‘ ã€‚ç›¸å¯¹äºB-Treeï¼ŒR-Tree çš„ä¼˜åŠ¿åœ¨äºèŒƒå›´æŸ¥æ‰¾ã€‚</p><table><thead><tr><th style="text-align:center">ç´¢å¼• / å­˜å‚¨å¼•æ“</th><th style="text-align:center">MyISAM</th><th style="text-align:center">InnoDB</th><th style="text-align:center">Memory</th></tr></thead><tbody><tr><td style="text-align:center">R-Treeç´¢å¼•</td><td style="text-align:center">æ”¯æŒ</td><td style="text-align:center">æ”¯æŒ</td><td style="text-align:center">ä¸æ”¯æŒ</td></tr></tbody></table><h3 id="9-8-å°ç»“">9.8 å°ç»“</h3><p>ä½¿ç”¨ç´¢å¼•å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»æµ·é‡çš„æ•°æ®ä¸­å¿«é€Ÿå®šä½æƒ³è¦æŸ¥æ‰¾çš„æ•°æ®ï¼Œä¸è¿‡ç´¢å¼•|ä¹Ÿå­˜åœ¨ä¸€äº›ä¸è¶³ï¼Œæ¯”å¦‚å ç”¨å­˜å‚¨ç©ºé—´ã€é™ä½æ•°æ®åº“å†™æ“ä½œçš„æ€§èƒ½ç­‰ï¼Œå¦‚æœæœ‰å¤šä¸ªç´¢å¼•è¿˜ä¼šå¢åŠ ç´¢å¼•é€‰æ‹©çš„æ—¶é—´ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œéœ€è¦å¹³è¡¡ç´¢å¼•çš„åˆ©ï¼ˆæå‡æŸ¥è¯¢æ•ˆç‡ï¼‰å’Œå¼Šï¼ˆç»´æŠ¤ç´¢å¼•æ‰€éœ€çš„ä»£ä»·ï¼‰ã€‚</p><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŸºäºéœ€æ±‚å’Œæ•°æ®æœ¬èº«çš„åˆ†å¸ƒæƒ…å†µæ¥ç¡®å®šæ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œå°½ç®¡<code>ç´¢å¼•ä¸æ˜¯ä¸‡èƒ½çš„</code>ï¼Œä½†<code>æ•°æ®æ•°æ®é‡å¤§çš„æ—¶å€™ä¸ä½¿ç”¨å»å¼•æ˜¯ä¸å¯æƒ³è±¡çš„</code>ï¼Œæ¯•ç«Ÿç´¢å¼•çš„æœ¬è´¨ï¼Œæ˜¯å¸®åŠ©æˆ‘ä»¬æå‡æ•°æ®æ£€è¡¨çš„æ•ˆç‡ã€‚</p><h3 id="9-9-é™„å½•ï¼šç®—æ³•çš„æ—¶é—´å¤æ‚åº¦">9.9 é™„å½•ï¼šç®—æ³•çš„æ—¶é—´å¤æ‚åº¦</h3><p>åŒä¸€é—®é¢˜å¯ç”¨ä¸åŒç®—æ³•è§£å†³ï¼Œè€Œä¸€ä¸ªç®—æ³•çš„è´¨é‡ä¼˜åŠ£å°†å½±å“åˆ°ç®—æ³•ä¹ƒè‡³ç¨‹åºçš„æ•ˆç‡ã€‚ç®—æ³•åˆ†æçš„ç›®çš„åœ¨ äºé€‰æ‹©åˆé€‚ç®—æ³•å’Œæ”¹è¿›ç®—æ³•ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220617175516191.png" alt="image-20220617175516191"></p>]]></content>
    
    
    <summary type="html">å¸¸è§ç´¢å¼•ã€InnoDBå’ŒMyISAMä¸­ç´¢å¼•æ–¹æ¡ˆ</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQLé€»è¾‘æ¶æ„ä¸å­˜å‚¨å¼•æ“</title>
    <link href="https://wuwawawa.github.io/posts/13910bb8.html"/>
    <id>https://wuwawawa.github.io/posts/13910bb8.html</id>
    <published>2023-04-07T01:37:06.000Z</published>
    <updated>2023-04-18T07:12:30.420Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-é€»è¾‘æ¶æ„">1. é€»è¾‘æ¶æ„</h2><h3 id="1-1-é€»è¾‘æ¶æ„å‰–æ">1.1 é€»è¾‘æ¶æ„å‰–æ</h3><h4 id="1-1-1-æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚">1.1.1 æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</h4><p>é¦–å…ˆMySQLæ˜¯å…¸å‹çš„C/Sæ¶æ„ï¼Œå³<code>Clinet/Server æ¶æ„</code>ï¼ŒæœåŠ¡ç«¯ç¨‹åºä½¿ç”¨çš„mysqldã€‚</p><p>ä¸è®ºå®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹æ˜¯é‡‡ç”¨å“ªç§æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œæœ€åå®ç°çš„æ•ˆæœæ˜¯ï¼š<span class='p green'>å®¢æˆ·ç«¯è¿›ç¨‹å‘æœåŠ¡å™¨è¿›ç¨‹å‘é€ä¸€æ®µæ–‡æœ¬ï¼ˆSQLè¯­å¥ï¼‰ï¼ŒæœåŠ¡å™¨è¿›ç¨‹å¤„ç†åå†å‘å®¢æˆ·ç«¯è¿›ç¨‹å‘é€ä¸€æ®µæ–‡æœ¬ï¼ˆå¤„ç†ç»“æœï¼‰ã€‚</span></p><p>é‚£æœåŠ¡å™¨è¿›ç¨‹å¯¹å®¢æˆ·ç«¯è¿›ç¨‹å‘é€çš„è¯·æ±‚åšäº†ä»€ä¹ˆå¤„ç†ï¼Œæ‰èƒ½äº§ç”Ÿæœ€åçš„å¤„ç†ç»“æœå‘¢ï¼Ÿè¿™é‡Œä»¥æŸ¥è¯¢è¯·æ±‚ä¸ºä¾‹å±•ç¤ºï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615133227202.png" alt="image-20210615133227202" style="zoom: 67%;" /><hr><h4 id="1-1-2-Connectors">1.1.2 Connectors</h4><p>Connectors, æŒ‡çš„æ˜¯ä¸åŒè¯­è¨€ä¸­ä¸SQLçš„äº¤äº’ã€‚MySQLé¦–å…ˆæ˜¯ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œåœ¨TCPä¹‹ä¸Šå®šä¹‰äº†è‡ªå·±çš„åº”ç”¨å±‚åè®®ã€‚æ‰€ä»¥è¦ä½¿ç”¨MySQLï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»£ç ï¼Œè·ŸMySQL Server<code>å»ºç«‹TCPè¿æ¥</code>ï¼Œä¹‹åæŒ‰ç…§å…¶å®šä¹‰å¥½çš„åè®®è¿›è¡Œäº¤äº’ã€‚æˆ–è€…æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•æ˜¯è°ƒç”¨SDKï¼Œæ¯”å¦‚Native C APIã€JDBCã€PHPç­‰å„è¯­è¨€MySQL Connecotr,æˆ–è€…é€šè¿‡ODBCã€‚ä½†é€šè¿‡SDKæ¥è®¿é—®MySQLï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨TCPè¿æ¥ä¸Šé€šè¿‡MySQLåè®®è·ŸMySQLè¿›è¡Œäº¤äº’</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230407101006728.png" alt="image-20230407101006728" style="zoom: 33%;" /><hr><h4 id="1-1-3-ä¸‰å±‚æ¶æ„">1.1.3 ä¸‰å±‚æ¶æ„</h4><span class='p blue'>MySQL Serverç»“æ„å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸‰å±‚ï¼š</span><div class="tabs" id="0fbe1939-61e3-4457-8c80-315887cf7bd1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#0fbe1939-61e3-4457-8c80-315887cf7bd1-1"><i class="fas fa-award"></i>ç¬¬ä¸€å±‚:è¿æ¥å±‚</button></li><li class="tab"><button type="button" data-href="#0fbe1939-61e3-4457-8c80-315887cf7bd1-2"><i class="fas fa-baseball-ball"></i>ç¬¬äºŒå±‚:æœåŠ¡å±‚</button></li><li class="tab"><button type="button" data-href="#0fbe1939-61e3-4457-8c80-315887cf7bd1-3"><i class="fas fa-bone"></i>ç¬¬ä¸‰å±‚:å¼•æ“å±‚</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="0fbe1939-61e3-4457-8c80-315887cf7bd1-1"><p>ç³»ç»Ÿï¼ˆå®¢æˆ·ç«¯ï¼‰è®¿é—® MySQL æœåŠ¡å™¨å‰ï¼Œåšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å»ºç«‹<code>TCP è¿æ¥</code>ã€‚ ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥æˆåŠŸåï¼Œ MySQL æœåŠ¡å™¨å¯¹ TCP ä¼ è¾“è¿‡æ¥çš„è´¦å·å¯†ç åšèº«ä»½è®¤è¯ã€æƒé™è·å–ã€‚</p><ul><li>ç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä¼šæ”¶åˆ°ä¸€ä¸ªAccess denied for useré”™è¯¯ï¼Œå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œ</li><li>ç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œä¼šä»æƒé™è¡¨æŸ¥å‡ºè´¦å·æ‹¥æœ‰çš„æƒé™ä¸è¿æ¥å…³è”ï¼Œä¹‹åçš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™</li></ul><blockquote><p>å¦‚ä½•æŸ¥çœ‹ MySQL æœåŠ¡è¢«å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†ï¼Ÿ</p></blockquote><p>å¦‚æœä½ æƒ³çŸ¥é“å½“å‰ MySQL æœåŠ¡è¢«å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†ï¼Œä½ å¯ä»¥æ‰§è¡Œ<code>show processlist</code>å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/%E6%9F%A5%E7%9C%8B%E8%BF%9E%E6%8E%A5.png" alt="img"></p><p>æ¯”å¦‚ä¸Šå›¾çš„æ˜¾ç¤ºç»“æœï¼Œå…±æœ‰ä¸¤ä¸ªç”¨æˆ·åä¸º root çš„ç”¨æˆ·è¿æ¥äº† MySQL æœåŠ¡ï¼Œå…¶ä¸­ id ä¸º 6 çš„ç”¨æˆ·çš„ Command åˆ—çš„çŠ¶æ€ä¸º<code>Sleep</code>ï¼Œè¿™æ„å‘³ç€è¯¥ç”¨æˆ·è¿æ¥å®Œ MySQL æœåŠ¡å°±æ²¡æœ‰å†æ‰§è¡Œè¿‡ä»»ä½•å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªç©ºé—²çš„è¿æ¥ï¼Œå¹¶ä¸”ç©ºé—²çš„æ—¶é•¿æ˜¯ 736 ç§’ï¼ˆ Time åˆ—ï¼‰ã€‚</p><blockquote><p>ç©ºé—²è¿æ¥ä¼šä¸€ç›´å ç”¨ç€å—ï¼Ÿ</p></blockquote><p>å½“ç„¶ä¸æ˜¯äº†ï¼ŒMySQL å®šä¹‰äº†ç©ºé—²è¿æ¥çš„æœ€å¤§ç©ºé—²æ—¶é•¿ï¼Œç”±<code>wait_timeout</code>å‚æ•°æ§åˆ¶çš„ï¼Œé»˜è®¤å€¼æ˜¯ 8 å°æ—¶ï¼ˆ28880ç§’ï¼‰ï¼Œå¦‚æœç©ºé—²è¿æ¥è¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;wait_timeout&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> wait_timeout  <span class="operator">|</span> <span class="number">28800</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ–­å¼€ç©ºé—²çš„è¿æ¥ï¼Œä½¿ç”¨çš„æ˜¯ kill connection + id çš„å‘½ä»¤ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> kill connection <span class="operator">+</span><span class="number">6</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå¤„äºç©ºé—²çŠ¶æ€çš„è¿æ¥è¢«æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€åï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å¹¶ä¸ä¼šé©¬ä¸ŠçŸ¥é“ï¼Œç­‰åˆ°å®¢æˆ·ç«¯åœ¨å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œæ‰ä¼šæ”¶åˆ°è¿™æ ·çš„æŠ¥é”™â€œERROR 2013 (HY000): Lost connection to MySQL server during queryâ€ã€‚</p><blockquote><p>MySQL çš„è¿æ¥æ•°æœ‰é™åˆ¶å—ï¼Ÿ</p></blockquote><p>MySQL æœåŠ¡æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç”± max_connections å‚æ•°æ§åˆ¶ï¼Œæ¯”å¦‚æˆ‘çš„ MySQL æœåŠ¡é»˜è®¤æ˜¯ 151 ä¸ª,è¶…è¿‡è¿™ä¸ªå€¼ï¼Œç³»ç»Ÿå°±ä¼šæ‹’ç»æ¥ä¸‹æ¥çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶æŠ¥é”™æç¤ºâ€œToo many connectionsâ€ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;max_connections&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> max_connections <span class="operator">|</span> <span class="number">151</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>MySQL çš„è¿æ¥ä¹Ÿè·Ÿ HTTP ä¸€æ ·ï¼Œæœ‰çŸ­è¿æ¥å’Œé•¿è¿æ¥çš„æ¦‚å¿µï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çŸ­è¿æ¥</span></span><br><span class="line">è¿æ¥ mysql æœåŠ¡ï¼ˆTCP ä¸‰æ¬¡æ¡æ‰‹ï¼‰</span><br><span class="line">æ‰§è¡Œsql</span><br><span class="line">æ–­å¼€ mysql æœåŠ¡ï¼ˆTCP å››æ¬¡æŒ¥æ‰‹ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="comment">// é•¿è¿æ¥</span></span><br><span class="line">è¿æ¥ mysql æœåŠ¡ï¼ˆTCP ä¸‰æ¬¡æ¡æ‰‹ï¼‰</span><br><span class="line">æ‰§è¡Œsql</span><br><span class="line">æ‰§è¡Œsql</span><br><span class="line">æ‰§è¡Œsql</span><br><span class="line">....</span><br><span class="line">æ–­å¼€ mysql æœåŠ¡ï¼ˆTCP å››æ¬¡æŒ¥æ‰‹ï¼‰</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨é•¿è¿æ¥çš„å¥½å¤„å°±æ˜¯å¯ä»¥å‡å°‘å»ºç«‹è¿æ¥å’Œæ–­å¼€è¿æ¥çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯æ¨èä½¿ç”¨é•¿è¿æ¥ã€‚</p><p>ä½†æ˜¯ï¼Œä½¿ç”¨é•¿è¿æ¥åå¯èƒ½ä¼šå ç”¨å†…å­˜å¢å¤šï¼Œå› ä¸º MySQL åœ¨æ‰§è¡ŒæŸ¥è¯¢è¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨å†…å­˜ç®¡ç†è¿æ¥å¯¹è±¡ï¼Œè¿™äº›è¿æ¥å¯¹è±¡èµ„æºåªæœ‰åœ¨è¿æ¥æ–­å¼€æ—¶æ‰ä¼šé‡Šæ”¾ã€‚å¦‚æœé•¿è¿æ¥ç´¯è®¡å¾ˆå¤šï¼Œå°†å¯¼è‡´ MySQL æœåŠ¡å ç”¨å†…å­˜å¤ªå¤§ï¼Œæœ‰å¯èƒ½ä¼šè¢«ç³»ç»Ÿå¼ºåˆ¶æ€æ‰ï¼Œè¿™æ ·ä¼šå‘ç”Ÿ MySQL æœåŠ¡å¼‚å¸¸é‡å¯çš„ç°è±¡ã€‚</p><blockquote><p>æ€ä¹ˆè§£å†³é•¿è¿æ¥å ç”¨å†…å­˜çš„é—®é¢˜ï¼Ÿ</p></blockquote><p>æœ‰ä¸¤ç§è§£å†³æ–¹å¼ã€‚</p><p>ç¬¬ä¸€ç§ï¼Œ<span class='p blue'>å®šæœŸæ–­å¼€é•¿è¿æ¥</span>ã€‚æ—¢ç„¶æ–­å¼€è¿æ¥åå°±ä¼šé‡Šæ”¾è¿æ¥å ç”¨çš„å†…å­˜èµ„æºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®šæœŸæ–­å¼€é•¿è¿æ¥ã€‚</p><p>ç¬¬äºŒç§ï¼Œ<span class='p blue'>å®¢æˆ·ç«¯ä¸»åŠ¨é‡ç½®è¿æ¥</span>ã€‚MySQL 5.7 ç‰ˆæœ¬å®ç°äº†<code>mysql_reset_connection()</code>å‡½æ•°çš„æ¥å£ï¼Œæ³¨æ„è¿™æ˜¯æ¥å£å‡½æ•°ä¸æ˜¯å‘½ä»¤ï¼Œé‚£ä¹ˆå½“å®¢æˆ·ç«¯æ‰§è¡Œäº†ä¸€ä¸ªå¾ˆå¤§çš„æ“ä½œåï¼Œåœ¨ä»£ç é‡Œè°ƒç”¨ mysql_reset_connection å‡½æ•°æ¥é‡ç½®è¿æ¥ï¼Œè¾¾åˆ°é‡Šæ”¾å†…å­˜çš„æ•ˆæœã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€ã€‚</p><p>è‡³æ­¤ï¼Œè¿æ¥å™¨çš„å·¥ä½œåšå®Œäº†ï¼Œç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p><ul><li>ä¸å®¢æˆ·ç«¯è¿›è¡Œ TCP ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼›</li><li>æ ¡éªŒå®¢æˆ·ç«¯çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œåˆ™ä¼šæŠ¥é”™ï¼›</li><li>å¦‚æœç”¨æˆ·åå’Œå¯†ç éƒ½å¯¹äº†ï¼Œä¼šè¯»å–è¯¥ç”¨æˆ·çš„æƒé™ï¼Œç„¶ååé¢çš„æƒé™é€»è¾‘åˆ¤æ–­éƒ½åŸºäºæ­¤æ—¶è¯»å–åˆ°çš„æƒé™ï¼›</li></ul><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230407113921814.png" alt="image-20230407113921814"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0fbe1939-61e3-4457-8c80-315887cf7bd1-2"><p>ç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆ<code>ç¼“å­˜çš„æŸ¥è¯¢</code>ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–åŠéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚</p><p>åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼š<code>è§£ææŸ¥è¯¢</code>å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨<code>è§£ææ ‘</code>ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„<code>ä¼˜åŒ–</code>ï¼šå¦‚ç¡®å®šæŸ¥è¯¢è¡¨çš„é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œæœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚</p><p>å¦‚æœæ˜¯SELECTè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼š<code>æŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜</code>ã€‚å¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œè¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230407101606147.png" alt="image-20230407101606147" style="zoom:25%;" /><div class="tabs" id="68644226-2ebd-4896-90d5-8e8e1fac02c8"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#68644226-2ebd-4896-90d5-8e8e1fac02c8-1"><i class="fas fa-award"></i>SQL Interface:SQLæ¥å£</button></li><li class="tab"><button type="button" data-href="#68644226-2ebd-4896-90d5-8e8e1fac02c8-2"><i class="fas fa-baseball-ball"></i>Parser:è§£æå™¨</button></li><li class="tab"><button type="button" data-href="#68644226-2ebd-4896-90d5-8e8e1fac02c8-3"><i class="fas fa-bone"></i>Optimizer:æŸ¥è¯¢ä¼˜åŒ–å™¨</button></li><li class="tab"><button type="button" data-href="#68644226-2ebd-4896-90d5-8e8e1fac02c8-4"><i class="fas fa-anchor"></i>Caches&Buffers:æŸ¥è¯¢ç¼“å­˜ç»„ä»¶</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="68644226-2ebd-4896-90d5-8e8e1fac02c8-1"><ul><li>æ¥æ”¶ç”¨æˆ·çš„SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚SELECT â€¦ FROMå°±æ˜¯è°ƒç”¨SQL Interface</li><li>MySQLæ”¯æŒDMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰ã€DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰ã€å­˜å‚¨è¿‡ç¨‹ã€è§†å›¾ã€è§¦å‘å™¨ã€è‡ªå®š ä¹‰å‡½æ•°ç­‰å¤šç§SQLè¯­è¨€æ¥å£</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="68644226-2ebd-4896-90d5-8e8e1fac02c8-2"><ul><li>åœ¨è§£æå™¨ä¸­å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€‚å°†SQLè¯­å¥åˆ†è§£æˆæ•°æ®ç»“æ„ï¼Œå¹¶å°†è¿™ä¸ªç»“æ„ ä¼ é€’åˆ°åç»­æ­¥éª¤ï¼Œä»¥åSQLè¯­å¥çš„ä¼ é€’å’Œå¤„ç†å°±æ˜¯åŸºäºè¿™ä¸ªç»“æ„çš„ã€‚å¦‚æœåœ¨åˆ†è§£æ„æˆä¸­é‡åˆ°é”™è¯¯ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ªSQLè¯­å¥æ˜¯ä¸åˆç†çš„ã€‚</li><li>åœ¨SQLå‘½ä»¤ä¼ é€’åˆ°è§£æå™¨çš„æ—¶å€™ä¼šè¢«è§£æå™¨éªŒè¯å’Œè§£æï¼Œå¹¶ä¸ºå…¶åˆ›å»º è¯­æ³•æ ‘ ï¼Œå¹¶æ ¹æ®æ•°æ®å­— å…¸ä¸°å¯ŒæŸ¥è¯¢è¯­æ³•æ ‘ï¼Œä¼š éªŒè¯è¯¥å®¢æˆ·ç«¯æ˜¯å¦å…·æœ‰æ‰§è¡Œè¯¥æŸ¥è¯¢çš„æƒé™ ã€‚åˆ›å»ºå¥½è¯­æ³•æ ‘åï¼ŒMySQLè¿˜ ä¼šå¯¹SQlæŸ¥è¯¢è¿›è¡Œè¯­æ³•ä¸Šçš„ä¼˜åŒ–ï¼Œè¿›è¡ŒæŸ¥è¯¢é‡å†™ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="68644226-2ebd-4896-90d5-8e8e1fac02c8-3"><ul><li>SQLè¯­å¥åœ¨è¯­æ³•è§£æä¹‹åã€æŸ¥è¯¢ä¹‹å‰ä¼šä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨ç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œç”Ÿæˆä¸€ä¸ª æ‰§è¡Œè®¡åˆ’ ã€‚</li><li>è¿™ä¸ªæ‰§è¡Œè®¡åˆ’è¡¨æ˜åº”è¯¥ ä½¿ç”¨å“ªäº›ç´¢å¼• è¿›è¡ŒæŸ¥è¯¢ï¼ˆå…¨è¡¨æ£€ç´¢è¿˜æ˜¯ä½¿ç”¨ç´¢å¼•æ£€ç´¢ï¼‰ï¼Œè¡¨ä¹‹é—´çš„è¿ æ¥é¡ºåºå¦‚ä½•ï¼Œæœ€åä¼šæŒ‰ç…§æ‰§è¡Œè®¡åˆ’ä¸­çš„æ­¥éª¤è°ƒç”¨å­˜å‚¨å¼•æ“æä¾›çš„æ–¹æ³•æ¥çœŸæ­£çš„æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°† æŸ¥è¯¢ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</li><li>å®ƒä½¿ç”¨â€œ é€‰å–-æŠ•å½±-è¿æ¥ â€ç­–ç•¥è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> gender <span class="operator">=</span> <span class="string">&#x27;å¥³&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªSELECTæŸ¥è¯¢å…ˆæ ¹æ®WHEREè¯­å¥è¿›è¡Œ é€‰å– ï¼Œè€Œä¸æ˜¯å°†è¡¨å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥ä»¥åå†è¿›è¡Œgenderè¿‡æ»¤ã€‚ è¿™ä¸ªSELECTæŸ¥è¯¢å…ˆæ ¹æ®idå’Œnameè¿›è¡Œå±æ€§ æŠ•å½± ï¼Œè€Œä¸æ˜¯å°†å±æ€§å…¨éƒ¨å–å‡ºä»¥åå†è¿›è¡Œè¿‡ æ»¤ï¼Œå°†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶ è¿æ¥ èµ·æ¥ç”Ÿæˆæœ€ç»ˆæŸ¥è¯¢ç»“æœã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="68644226-2ebd-4896-90d5-8e8e1fac02c8-4"><ul><li>MySQLå†…éƒ¨ç»´æŒç€ä¸€äº›Cacheå’ŒBufferï¼Œæ¯”å¦‚Query Cacheç”¨æ¥ç¼“å­˜ä¸€æ¡SELECTè¯­å¥çš„æ‰§è¡Œç»“ æœï¼Œå¦‚æœèƒ½å¤Ÿåœ¨å…¶ä¸­æ‰¾åˆ°å¯¹åº”çš„æŸ¥è¯¢ç»“æœï¼Œé‚£ä¹ˆå°±ä¸å¿…å†è¿›è¡ŒæŸ¥è¯¢è§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œçš„æ•´ä¸ªè¿‡ ç¨‹äº†ï¼Œç›´æ¥å°†ç»“æœåé¦ˆç»™å®¢æˆ·ç«¯ã€‚</li><li>è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkeyç¼“å­˜ï¼Œæƒé™ç¼“å­˜ç­‰ ã€‚ è¿™ä¸ªæŸ¥è¯¢ç¼“å­˜å¯ä»¥åœ¨ ä¸åŒå®¢æˆ·ç«¯ä¹‹é—´å…±äº« ã€‚</li><li>ä»MySQL 5.7.20å¼€å§‹ï¼Œä¸æ¨èä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶åœ¨ MySQL 8.0ä¸­åˆ é™¤ ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0fbe1939-61e3-4457-8c80-315887cf7bd1-3"><p>æ’ä»¶å¼å­˜å‚¨å¼•æ“å±‚ï¼ˆ Storage Enginesï¼‰ï¼Œ<span class='p red'>çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œå¯¹ç‰©ç†æœåŠ¡å™¨çº§åˆ«ç»´æŠ¤çš„åº•å±‚æ•°æ®æ‰§è¡Œæ“ä½œ</span>ï¼ŒæœåŠ¡å™¨é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰çš„åŠŸèƒ½ä¸åŒï¼Œè¿™æ · æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€è¦è¿›è¡Œé€‰å–ã€‚</p><p>MySQL 8.0.25é»˜è®¤æ”¯æŒçš„å­˜å‚¨å¼•æ“å¦‚ä¸‹ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615140556893.png" alt="image-20210615140556893"></p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230407102134972.png" alt="image-20230407102134972" style="zoom:33%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h4 id="1-1-4-å­˜å‚¨å±‚">1.1.4 å­˜å‚¨å±‚</h4><p>æ‰€æœ‰çš„æ•°æ®ï¼Œæ•°æ®åº“ã€è¡¨çš„å®šä¹‰ï¼Œè¡¨çš„æ¯ä¸€è¡Œçš„å†…å®¹ï¼Œç´¢å¼•ï¼Œéƒ½æ˜¯å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿ ä¸Šï¼Œä»¥<code>æ–‡ä»¶</code>çš„æ–¹å¼å­˜åœ¨çš„ï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚å½“ç„¶æœ‰äº›å­˜å‚¨å¼•æ“æ¯”å¦‚InnoDBï¼Œä¹Ÿæ”¯æŒä¸ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿç›´æ¥ç®¡ç†è£¸è®¾å¤‡ï¼Œä½†ç°ä»£æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ä½¿å¾—è¿™æ ·åšæ²¡æœ‰å¿…è¦äº†ã€‚åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç£ç›˜ï¼Œå¯ä»¥ä½¿ç”¨ DASã€NASã€SANç­‰å„ç§å­˜å‚¨ç³»ç»Ÿã€‚</p><h4 id="1-1-5-å°ç»“">1.1.5 å°ç»“</h4><p>MySQLæ¶æ„å›¾æœ¬èŠ‚å¼€ç¯‡æ‰€ç¤ºã€‚ä¸‹é¢ä¸ºäº†ç†Ÿæ‚‰SQLæ‰§è¡Œæµç¨‹æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–å¦‚ä¸‹ï¼š</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615140710351.png" alt="image-20210615140710351" style="zoom: 50%;" /><p>ç®€åŒ–ä¸ºä¸‰å±‚ç»“æ„ï¼š</p><ol><li><span class='p green'>è¿æ¥å±‚</span>ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å‘é€ SQL è‡³æœåŠ¡å™¨ç«¯ï¼› </li><li><span class='p green'>SQL å±‚ï¼ˆæœåŠ¡å±‚ï¼‰</span>ï¼šå¯¹ SQL è¯­å¥è¿›è¡ŒæŸ¥è¯¢å¤„ç†ï¼›ä¸æ•°æ®åº“æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼æ— å…³ï¼›</li><li><span class='p green'>å­˜å‚¨å¼•æ“å±‚</span>ï¼šä¸æ•°æ®åº“æ–‡ä»¶æ‰“äº¤é“ï¼Œè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ã€‚</li></ol><hr><h3 id="1-2-SQLæ‰§è¡Œæµç¨‹">1.2 SQLæ‰§è¡Œæµç¨‹</h3><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615141934531.png" alt="image-20210615141934531" style="zoom: 67%;" /><span class='p red'>MySQLçš„æŸ¥è¯¢æµç¨‹ï¼š</span><div class="tabs" id="0cb8e838-e6d5-4c70-ad46-d60c36ceaeac"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#0cb8e838-e6d5-4c70-ad46-d60c36ceaeac-1"><i class="fas fa-atom"></i>æŸ¥è¯¢ç¼“å­˜</button></li><li class="tab"><button type="button" data-href="#0cb8e838-e6d5-4c70-ad46-d60c36ceaeac-2"><i class="far fa-sun"></i>è§£æå™¨</button></li><li class="tab"><button type="button" data-href="#0cb8e838-e6d5-4c70-ad46-d60c36ceaeac-3"><i class="fas fa-wind"></i>ä¼˜åŒ–å™¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="0cb8e838-e6d5-4c70-ad46-d60c36ceaeac-1"><p>Server å¦‚æœåœ¨æŸ¥è¯¢ç¼“å­˜ä¸­å‘ç°äº†è¿™æ¡ SQL è¯­å¥ï¼Œå°±ä¼šç›´æ¥å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±è¿›å…¥åˆ°è§£æå™¨é˜¶æ®µã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå› ä¸º<span class='p red'>æŸ¥è¯¢ç¼“å­˜å¾€å¾€æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥åœ¨ MySQL8.0 ä¹‹åå°±æŠ›å¼ƒäº†è¿™ä¸ªåŠŸèƒ½ã€‚</span></p><p><span class='p red'>å¤§å¤šæ•°æƒ…å†µæŸ¥è¯¢ç¼“å­˜å°±æ˜¯ä¸ªé¸¡è‚‹ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</span></p><blockquote><p>æŸ¥è¯¢ç¼“å­˜æ˜¯æå‰æŠŠæŸ¥è¯¢ç»“æœç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·ä¸‹æ¬¡ä¸éœ€è¦æ‰§è¡Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°ç»“æœã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨MySQL ä¸­çš„æŸ¥è¯¢ç¼“å­˜ï¼Œä¸æ˜¯ç¼“å­˜æŸ¥è¯¢è®¡åˆ’ï¼Œè€Œæ˜¯æŸ¥è¯¢å¯¹åº”çš„ç»“æœã€‚è¿™å°±æ„å‘³ç€æŸ¥è¯¢åŒ¹é…çš„é²æ£’æ€§å¤§å¤§é™ä½ï¼Œåªæœ‰<code>ç›¸åŒçš„æŸ¥è¯¢æ“ä½œ</code>æ‰ä¼šå‘½ä¸­æŸ¥è¯¢ç¼“å­˜ã€‚ä¸¤ä¸ªæŸ¥è¯¢è¯·æ±‚åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒï¼ˆä¾‹å¦‚ï¼šç©ºæ ¼ã€æ³¨é‡Šã€å¤§å°å†™ï¼‰ï¼Œéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸ä¼šå‘½ä¸­ã€‚å› æ­¤ MySQL çš„æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ã€‚</p><p>åŒæ—¶ï¼Œå¦‚æœæŸ¥è¯¢è¯·æ±‚ä¸­åŒ…å«æŸäº›ç³»ç»Ÿå‡½æ•°ã€ç”¨æˆ·è‡ªå®šä¹‰å˜é‡å’Œå‡½æ•°ã€ä¸€äº›ç³»ç»Ÿè¡¨ï¼Œå¦‚ mysql ã€information_schemaã€ performance_schema æ•°æ®åº“ä¸­çš„è¡¨ï¼Œé‚£è¿™ä¸ªè¯·æ±‚å°±ä¸ä¼šè¢«ç¼“å­˜ã€‚ä»¥æŸäº›ç³»ç»Ÿå‡½æ•°ä¸¾ä¾‹ï¼Œå¯èƒ½åŒæ ·çš„å‡½æ•°çš„ä¸¤æ¬¡è°ƒç”¨ä¼šäº§ç”Ÿä¸ä¸€æ ·çš„ç»“æœï¼Œæ¯”å¦‚å‡½æ•°<code>NOW</code>ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šäº§ç”Ÿæœ€æ–°çš„å½“å‰æ—¶é—´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ä¸­è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£å³ä½¿æŸ¥è¯¢è¯·æ±‚çš„æ–‡æœ¬ä¿¡æ¯éƒ½ä¸€æ ·ï¼Œé‚£ä¸åŒæ—¶é—´çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹Ÿåº”è¯¥å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶å°±ç¼“å­˜äº†ï¼Œé‚£ç¬¬äºŒæ¬¡æŸ¥è¯¢çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœå°±æ˜¯é”™è¯¯çš„ï¼</p><p>æ­¤å¤–ï¼Œæ—¢ç„¶æ˜¯ç¼“å­˜ï¼Œé‚£å°±æœ‰å®ƒç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ã€‚MySQLçš„ç¼“å­˜ç³»ç»Ÿä¼šç›‘æµ‹æ¶‰åŠåˆ°çš„æ¯å¼ è¡¨ï¼Œåªè¦è¯¥è¡¨çš„ç»“æ„æˆ–è€…æ•°æ®è¢«ä¿®æ”¹ï¼Œå¦‚å¯¹è¯¥è¡¨ä½¿ç”¨äº†<code>INSERT</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>ã€<code>TRUNCATE TABLE</code>ã€<code>ALTERTABLE</code>ã€<code>DROP TABLE</code>æˆ–<code>DROP DATABASE</code>è¯­å¥ï¼Œé‚£ä½¿ç”¨è¯¥è¡¨çš„æ‰€æœ‰é«˜é€Ÿç¼“å­˜æŸ¥è¯¢éƒ½å°†å˜ä¸ºæ— æ•ˆå¹¶ä»é«˜é€Ÿç¼“å­˜ä¸­åˆ é™¤ï¼å¯¹äºæ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½ã€‚</p></blockquote><p>æ€»ä¹‹ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ã€‚</p><p>ä¸€èˆ¬å»ºè®®å¤§å®¶åœ¨é™æ€è¡¨é‡Œä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œä»€ä¹ˆå«<code>é™æ€è¡¨</code>å‘¢ï¼Ÿå°±æ˜¯ä¸€èˆ¬æˆ‘ä»¬æå°‘æ›´æ–°çš„è¡¨ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨ã€å­—å…¸è¡¨ï¼Œè¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚MySQLä¹Ÿæä¾›äº†è¿™ç§â€œ<code>æŒ‰éœ€ä½¿ç”¨</code>â€çš„æ–¹å¼ã€‚ä½ å¯ä»¥å°† my.cnf å‚æ•° query_cache_type è®¾ç½®æˆ DEMANDï¼Œä»£è¡¨å½“ sql è¯­å¥ä¸­æœ‰ SQL_CACHEå…³é”®å­—æ—¶æ‰ç¼“å­˜ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0cb8e838-e6d5-4c70-ad46-d60c36ceaeac-2"><p>åœ¨è§£æå™¨ä¸­å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€‚</p><p>å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚é¦–å…ˆï¼ŒMySQLéœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆï¼Œå› æ­¤éœ€è¦å¯¹SQLè¯­å¥åšè§£æã€‚SQLè¯­å¥çš„åˆ†æåˆ†ä¸ºè¯æ³•åˆ†æä¸è¯­æ³•åˆ†æã€‚</p><p>åˆ†æå™¨å…ˆåšâ€œ<code>è¯æ³•åˆ†æ</code>â€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡ SQL è¯­å¥ï¼ŒMySQL éœ€è¦è¯†åˆ«å‡ºé‡Œé¢ çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚</p><p>MySQL ä»ä½ è¾“å…¥çš„&quot;select&quot;è¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­ å¥ã€‚å®ƒä¹Ÿè¦æŠŠå­—ç¬¦ä¸²â€œTâ€è¯†åˆ«æˆâ€œè¡¨å Tâ€ï¼ŒæŠŠå­—ç¬¦ä¸²â€œIDâ€è¯†åˆ«æˆâ€œåˆ— IDâ€ã€‚</p><p>æ¥ç€ï¼Œè¦åšâ€œ<code>è¯­æ³•åˆ†æ</code>â€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ï¼ˆæ¯”å¦‚ï¼šBisonï¼‰ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“ å…¥çš„è¿™ä¸ª SQL è¯­å¥æ˜¯å¦<code>æ»¡è¶³ MySQL è¯­æ³•</code>ã€‚</p><p>select department_id,job_id, avg(salary) from employees group by department_id;</p><p>å¦‚æœSQLè¯­å¥æ­£ç¡®ï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ªè¿™æ ·çš„è¯­æ³•æ ‘ï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615162031427.png" alt="image-20210615162031427"></p><p>ä¸‹å›¾æ˜¯SQLåˆ†è¯åˆ†æçš„è¿‡ç¨‹æ­¥éª¤:</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615163338495.png" alt="image-20210615163338495"></p><p>è‡³æ­¤è§£æå™¨çš„å·¥ä½œä»»åŠ¡ä¹ŸåŸºæœ¬åœ†æ»¡äº†ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="0cb8e838-e6d5-4c70-ad46-d60c36ceaeac-3"><p>åœ¨ä¼˜åŒ–å™¨ä¸­ä¼šç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œæ¯”å¦‚æ˜¯æ ¹æ®<code>å…¨è¡¨æ£€ç´¢</code>ï¼Œè¿˜æ˜¯æ ¹æ®<code>ç´¢å¼•æ£€ç´¢</code>ç­‰ã€‚</p><p>ç»è¿‡è§£é‡Šå™¨ï¼ŒMySQLå°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚<strong>ä¸€æ¡æŸ¥è¯¢å¯ä»¥æœ‰å¾ˆå¤šç§æ‰§è¡Œæ–¹å¼ï¼Œæœ€åéƒ½è¿”å›ç›¸åŒçš„ç»“æœã€‚ä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯æ‰¾åˆ°è¿™å…¶ä¸­æœ€å¥½çš„æ‰§è¡Œè®¡åˆ’</strong>ã€‚</p><p>æ¯”å¦‚ï¼šä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è” (join) çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåºï¼Œè¿˜æœ‰è¡¨è¾¾å¼ç®€åŒ–ã€å­æŸ¥è¯¢è½¬ä¸ºè¿æ¥ã€å¤–è¿æ¥è½¬ä¸ºå†…è¿æ¥ç­‰ã€‚</p><p>ä¸¾ä¾‹ï¼šå¦‚ä¸‹è¯­å¥æ˜¯æ‰§è¡Œä¸¤ä¸ªè¡¨çš„ joinï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1 <span class="keyword">join</span> test2 <span class="keyword">using</span>(ID)</span><br><span class="line"><span class="keyword">where</span> test1.name<span class="operator">=</span><span class="string">&#x27;zhangwei&#x27;</span> <span class="keyword">and</span> test2.name<span class="operator">=</span><span class="string">&#x27;mysqlé«˜çº§è¯¾ç¨‹&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>æ–¹æ¡ˆ1ï¼šå¯ä»¥å…ˆä»è¡¨ test1 é‡Œé¢å–å‡º name='zhangweiâ€™çš„è®°å½•çš„ ID å€¼ï¼Œå†æ ¹æ® ID å€¼å…³è”åˆ°è¡¨ test2ï¼Œå†åˆ¤<br>æ–­ test2 é‡Œé¢ nameçš„å€¼æ˜¯å¦ç­‰äº â€˜mysqlé«˜çº§è¯¾ç¨‹â€™ã€‚</p><p>æ–¹æ¡ˆ2ï¼šå¯ä»¥å…ˆä»è¡¨ test2 é‡Œé¢å–å‡º name=â€˜mysqlé«˜çº§è¯¾ç¨‹â€™ çš„è®°å½•çš„ ID å€¼ï¼Œå†æ ¹æ® ID å€¼å…³è”åˆ° test1ï¼Œ<br>å†åˆ¤æ–­ test1 é‡Œé¢ nameçš„å€¼æ˜¯å¦ç­‰äº zhangweiã€‚</p><p>è¿™ä¸¤ç§æ‰§è¡Œæ–¹æ³•çš„é€»è¾‘ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ•ˆç‡ä¼šæœ‰ä¸åŒï¼Œè€Œä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªæ–¹æ¡ˆã€‚ä¼˜åŒ–<br>å™¨é˜¶æ®µå®Œæˆåï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆå°±ç¡®å®šä¸‹æ¥äº†ï¼Œç„¶åè¿›å…¥æ‰§è¡Œå™¨é˜¶æ®µã€‚<br>å¦‚æœä½ è¿˜æœ‰ä¸€äº›ç–‘é—®ï¼Œæ¯”å¦‚ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆé€‰æ‹©ç´¢å¼•çš„ï¼Œæœ‰æ²¡æœ‰å¯èƒ½é€‰æ‹©é”™ç­‰ã€‚åé¢è®²åˆ°ç´¢å¼•æˆ‘ä»¬å†è°ˆã€‚</p></blockquote><p>åœ¨æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸­ï¼Œå¯ä»¥åˆ†ä¸º<code>é€»è¾‘æŸ¥è¯¢</code>ä¼˜åŒ–é˜¶æ®µå’Œ<code>ç‰©ç†æŸ¥è¯¢</code>ä¼˜åŒ–é˜¶æ®µã€‚</p><p>é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–å°±æ˜¯é€šè¿‡æ”¹å˜SQLè¯­å¥çš„å†…å®¹æ¥ä½¿å¾—SQLæŸ¥è¯¢æ›´é«˜æ•ˆï¼ŒåŒæ—¶ä¸ºç‰©ç†æŸ¥è¯¢ä¼˜åŒ–æä¾›æ›´å¤šçš„å€™é€‰æ‰§è¡Œè®¡åˆ’ã€‚é€šå¸¸é‡‡ç”¨çš„æ–¹å¼æ˜¯å¯¹SQLè¯­å¥è¿›è¡Œ<code>ç­‰ä»·å˜æ¢</code>ï¼Œå¯¹æŸ¥è¯¢è¿›è¡Œ<code>é‡å†™</code>ï¼Œè€ŒæŸ¥è¯¢é‡å†™çš„æ•°å­¦åŸºç¡€å°±æ˜¯å…³ç³»ä»£æ•°ã€‚å¯¹æ¡ä»¶è¡¨è¾¾å¼è¿›è¡Œç­‰ä»·è°“è¯é‡å†™ã€æ¡ä»¶ç®€åŒ–ï¼Œå¯¹è§†å›¾è¿›è¡Œé‡å†™ï¼Œå¯¹å­æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œå¯¹è¿æ¥è¯­ä¹‰è¿›è¡Œäº†å¤–è¿æ¥æ¶ˆé™¤ã€åµŒå¥—è¿æ¥æ¶ˆé™¤ç­‰ã€‚</p><p>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–æ˜¯åŸºäºå…³ç³»ä»£æ•°è¿›è¡Œçš„æŸ¥è¯¢é‡å†™ï¼Œè€Œå…³ç³»ä»£æ•°çš„æ¯ä¸€æ­¥éƒ½å¯¹åº”ç€ç‰©ç†è®¡ç®—ï¼Œè¿™äº›ç‰©ç†è®¡ç®—å¾€å¾€å­˜åœ¨å¤šç§ç®—æ³•ï¼Œå› æ­¤éœ€è¦è®¡ç®—å„ç§ç‰©ç†è·¯å¾„çš„ä»£ä»·ï¼Œä»ä¸­é€‰æ‹©ä»£ä»·æœ€å°çš„ä½œä¸ºæ‰§è¡Œè®¡åˆ’ã€‚åœ¨è¿™ä¸ªé˜¶æ®µé‡Œï¼Œå¯¹äºå•è¡¨å’Œå¤šè¡¨è¿æ¥çš„æ“ä½œï¼Œéœ€è¦é«˜æ•ˆåœ°<code>ä½¿ç”¨ç´¢å¼•</code>ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>è‡³æ­¤ï¼Œè¿™ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†ã€‚å¯¹äºæœ‰ç´¢å¼•çš„è¡¨ï¼Œæ‰§è¡Œçš„é€»è¾‘ä¹Ÿå·®ä¸å¤šã€‚</p><p>SQL è¯­å¥åœ¨ MySQL ä¸­çš„æµç¨‹æ˜¯ï¼š<code>SQLè¯­å¥</code>â†’<code>æŸ¥è¯¢ç¼“å­˜</code>â†’<code>è§£æå™¨</code>â†’<code>ä¼˜åŒ–å™¨</code>â†’<code>æ‰§è¡Œå™¨</code>ã€‚</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615164722975.png" alt="image-20210615164722975"></p><!-- endtab --><hr><h3 id="1-3-æ•°æ®åº“ç¼“å†²æ± -buffer-pool">1.3 æ•°æ®åº“ç¼“å†²æ± (buffer pool)</h3><p><code>InnoDB</code>å­˜å‚¨å¼•æ“æ˜¯ä»¥é¡µä¸ºå•ä½æ¥ç®¡ç†å­˜å‚¨ç©ºé—´çš„ï¼Œæˆ‘ä»¬è¿›è¡Œçš„å¢åˆ æ”¹æŸ¥æ“ä½œå…¶å®æœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨è®¿é—®é¡µé¢ï¼ˆåŒ…æ‹¬è¯»é¡µé¢ã€å†™é¡µé¢ã€åˆ›å»ºæ–°é¡µé¢ç­‰æ“ä½œï¼‰ã€‚è€Œç£ç›˜ I/O éœ€è¦æ¶ˆè€—çš„æ—¶é—´å¾ˆå¤šï¼Œè€Œåœ¨å†…å­˜ä¸­è¿›è¡Œæ“ä½œï¼Œæ•ˆç‡åˆ™ä¼šé«˜å¾ˆå¤šï¼Œä¸ºäº†èƒ½è®©æ•°æ®è¡¨æˆ–è€…ç´¢å¼•ä¸­çš„æ•°æ®éšæ—¶è¢«æˆ‘ä»¬æ‰€ç”¨ï¼ŒDBMS ä¼šç”³è¯·å ç”¨å†…å­˜æ¥ä½œä¸ºæ•°æ®<code>ç¼“å†²æ± </code>ï¼Œåœ¨çœŸæ­£è®¿é—®é¡µé¢ä¹‹å‰ï¼Œéœ€è¦æŠŠåœ¨ç£ç›˜ä¸Šçš„é¡µç¼“å­˜åˆ°å†…å­˜ä¸­çš„ Buffer Pool ä¹‹åæ‰å¯ä»¥è®¿é—®ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥è®©ç£ç›˜æ´»åŠ¨æœ€å°åŒ–ï¼Œä»è€Œ<code>å‡å°‘ä¸ç£ç›˜ç›´æ¥è¿›è¡Œ I/O çš„æ—¶é—´</code>ã€‚è¦çŸ¥é“ï¼Œè¿™ç§ç­–ç•¥å¯¹æå‡ SQL è¯­å¥çš„æŸ¥è¯¢æ€§èƒ½æ¥è¯´è‡³å…³é‡è¦ã€‚å¦‚æœç´¢å¼•çš„æ•°æ®åœ¨ç¼“å†²æ± é‡Œï¼Œé‚£ä¹ˆè®¿é—®çš„æˆæœ¬å°±ä¼šé™ä½å¾ˆå¤šã€‚</p><p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­æœ‰ä¸€éƒ¨åˆ†æ•°æ®ä¼šæ”¾åˆ°å†…å­˜ä¸­ï¼Œç¼“å†²æ± åˆ™å äº†è¿™éƒ¨åˆ†å†…å­˜çš„å¤§éƒ¨åˆ†ï¼Œå®ƒç”¨æ¥å­˜å‚¨å„ç§æ•°æ®çš„ç¼“å­˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615175309751.png" alt="image-20210615175309751"></p><p>ä»å›¾ä¸­ï¼Œä½ èƒ½çœ‹åˆ° InnoDB ç¼“å†²æ± åŒ…æ‹¬äº†æ•°æ®é¡µã€ç´¢å¼•é¡µã€æ’å…¥ç¼“å†²ã€é”ä¿¡æ¯ã€è‡ªé€‚åº” Hash å’Œæ•°æ®å­—å…¸ä¿¡æ¯ç­‰ã€‚</p><span class='p red'>ç¼“å­˜æ± çš„é‡è¦æ€§ï¼š</span><p>å¯¹äºä½¿ç”¨<code>InnoDB</code>ä½œä¸ºå­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œä¸ç®¡æ˜¯ç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®çš„ç´¢å¼•ï¼ˆåŒ…æ‹¬èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•ï¼‰ï¼Œè¿˜æ˜¯å„ç§ç³»ç»Ÿæ•°æ®ï¼Œéƒ½æ˜¯ä»¥<code>é¡µ</code>çš„å½¢å¼å­˜æ”¾åœ¨<code>è¡¨ç©ºé—´</code>ä¸­çš„ï¼Œè€Œæ‰€è°“çš„è¡¨ç©ºé—´åªä¸è¿‡æ˜¯InnoDBå¯¹æ–‡ä»¶ç³»ç»Ÿä¸Šä¸€ä¸ªæˆ–å‡ ä¸ªå®é™…æ–‡ä»¶çš„æŠ½è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„æ•°æ®è¯´åˆ°åº•è¿˜æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ã€‚ä½†æ˜¯å„ä½ä¹Ÿéƒ½çŸ¥é“ï¼Œç£ç›˜çš„é€Ÿåº¦æ…¢çš„è·Ÿä¹Œé¾Ÿä¸€æ ·ï¼Œæ€ä¹ˆèƒ½é…å¾—ä¸Š<code>â€œå¿«å¦‚é£ï¼Œç–¾å¦‚ç”µâ€çš„CPU</code>å‘¢ï¼Ÿè¿™é‡Œï¼Œç¼“å†²æ± å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¶ˆé™¤CPUå’Œç£ç›˜ä¹‹é—´çš„<code>é¸¿æ²Ÿ</code>ã€‚æ‰€ä»¥ InnoDBå­˜å‚¨å¼•æ“åœ¨å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œå½“éœ€è¦è®¿é—®æŸä¸ªé¡µçš„æ•°æ®æ—¶ï¼Œå°±ä¼šæŠŠ<code>å®Œæ•´çš„é¡µçš„æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜</code>ä¸­ï¼Œ ä¹Ÿå°±æ˜¯è¯´å³ä½¿æˆ‘ä»¬åªéœ€è¦è®¿é—®ä¸€ä¸ªé¡µçš„ä¸€æ¡è®°å½•ï¼Œé‚£ä¹Ÿéœ€è¦å…ˆæŠŠæ•´ä¸ªé¡µçš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å°†æ•´ä¸ªé¡µåŠ è½½åˆ°å†…å­˜ä¸­åå°±å¯ä»¥è¿›è¡Œè¯»å†™è®¿é—®äº†ï¼Œåœ¨è¿›è¡Œå®Œè¯»å†™è®¿é—®ä¹‹åå¹¶ä¸ç€æ€¥æŠŠè¯¥é¡µå¯¹åº”çš„å†…å­˜ç©ºé—´é‡Šæ”¾æ‰ï¼Œè€Œæ˜¯å°†å…¶<code>ç¼“å­˜</code>èµ·æ¥ï¼Œè¿™æ ·å°†æ¥æœ‰è¯·æ±‚å†æ¬¡è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œå°±å¯ä»¥<code>çœå»ç£ç›˜IO</code>çš„å¼€é”€äº†ã€‚</p><span class='p green'>ç¼“å­˜åŸåˆ™ï¼š</span><p>â€œ<code>ä½ç½® * é¢‘æ¬¡</code>â€è¿™ä¸ªåŸåˆ™ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å¯¹ I/O è®¿é—®æ•ˆç‡è¿›è¡Œä¼˜åŒ–ã€‚</p><p>é¦–å…ˆï¼Œä½ç½®å†³å®šæ•ˆç‡ï¼Œæä¾›ç¼“å†²æ± å°±æ˜¯ä¸ºäº†åœ¨å†…å­˜ä¸­å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®ã€‚</p><p>å…¶æ¬¡ï¼Œé¢‘æ¬¡å†³å®šä¼˜å…ˆçº§é¡ºåºã€‚å› ä¸ºç¼“å†²æ± çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚ç£ç›˜æœ‰ 200Gï¼Œä½†æ˜¯å†…å­˜åªæœ‰ 16Gï¼Œç¼“å†²æ± å¤§å°åªæœ‰ 1Gï¼Œå°±æ— æ³•å°†æ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°ç¼“å†²æ± é‡Œï¼Œè¿™æ—¶å°±æ¶‰åŠåˆ°ä¼˜å…ˆçº§é¡ºåºï¼Œä¼š<code>ä¼˜å…ˆå¯¹ä½¿ç”¨é¢‘æ¬¡é«˜çš„çƒ­æ•°æ®è¿›è¡ŒåŠ è½½</code>ã€‚</p><span class='p green'>ç¼“å†²æ± çš„é¢„è¯»ç‰¹æ€§:</span><p>ç¼“å†²æ± çš„ä½œç”¨å°±æ˜¯æå‡ I/O æ•ˆç‡ï¼Œè€Œæˆ‘ä»¬è¿›è¡Œè¯»å–æ•°æ®çš„æ—¶å€™å­˜åœ¨ä¸€ä¸ªâ€œå±€éƒ¨æ€§åŸç†â€ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä½¿ç”¨äº†ä¸€äº›æ•°æ®ï¼Œ<strong>å¤§æ¦‚ç‡è¿˜ä¼šä½¿ç”¨å®ƒå‘¨å›´çš„ä¸€äº›æ•°æ®</strong>ï¼Œå› æ­¤é‡‡ç”¨â€œé¢„è¯»â€çš„æœºåˆ¶æå‰åŠ è½½ï¼Œå¯ä»¥å‡å°‘æœªæ¥å¯èƒ½çš„ç£ç›˜ I/O æ“ä½œã€‚</p><blockquote><p>ç¼“å†²æ± å’ŒæŸ¥è¯¢ç¼“å­˜æ˜¯ä¸€ä¸ªä¸œè¥¿å—ï¼Ÿ <span class='p red'>å¦</span></p></blockquote><p>æŸ¥è¯¢ç¼“å­˜æ˜¯ææŸ¥è¯¢ç»“æœç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·ä¸‹æ¬¡ä¸éœ€è¦æ‰§è¡Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°ç»“æœã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨ MySQL ä¸­çš„æŸ¥è¯¢ç¼“å­˜ï¼Œä¸æ˜¯ç¼“å­˜æŸ¥è¯¢è®¡åˆ’ï¼Œè€Œæ˜¯æŸ¥è¯¢å¯¹åº”çš„ç»“æœã€‚å› ä¸ºå‘½ä¸­æ¡ä»¶è‹›åˆ»ï¼Œè€Œä¸”åªè¦æ•°æ®è¡¨å‘ç”Ÿå˜åŒ–ï¼ŒæŸ¥è¯¢ç¼“å­˜å°±ä¼šå¤±æ•ˆï¼Œå› æ­¤å‘½ä¸­ç‡ä½ã€‚</p><blockquote><span class='p blue'>ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®ï¼Ÿ</span></blockquote><p>ç¼“å†²æ± ç®¡ç†å™¨ä¼šå°½é‡å°†ç»å¸¸ä½¿ç”¨çš„æ•°æ®ä¿å­˜èµ·æ¥ï¼Œåœ¨æ•°æ®åº“è¿›è¡Œé¡µé¢è¯»æ“ä½œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ¤æ–­è¯¥é¡µé¢æ˜¯å¦åœ¨ç¼“å†²æ± ä¸­ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥è¯»å–ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šé€šè¿‡å†…å­˜æˆ–ç£ç›˜å°†é¡µé¢å­˜æ”¾åˆ°ç¼“å†²æ± ä¸­å†è¿›è¡Œè¯»å–ã€‚</p><p>ç¼“å­˜åœ¨æ•°æ®åº“ä¸­çš„ç»“æ„å’Œä½œç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615193131719.png" alt="image-20210615193131719"></p><blockquote><span class='p green'>å¦‚æœæˆ‘ä»¬æ‰§è¡Œ SQL è¯­å¥çš„æ—¶å€™æ›´æ–°äº†ç¼“å­˜æ± ä¸­çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®ä¼šé©¬ä¸ŠåŒæ­¥åˆ°ç£ç›˜ä¸Šå—ï¼Ÿ</span></blockquote><p>å®é™…ä¸Šï¼Œå½“æˆ‘ä»¬å¯¹æ•°æ®åº“ä¸­çš„è®°å½•è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šä¿®æ”¹ç¼“å†²æ± ä¸­é¡µé‡Œé¢çš„è®°å½•ä¿¡æ¯ï¼Œç„¶åæ•°æ®åº“ä¼š<code>ä»¥ä¸€å®šçš„é¢‘ç‡åˆ·æ–°</code>åˆ°ç£ç›˜ä¸­ã€‚æ³¨æ„å¹¶ä¸æ˜¯æ¯æ¬¡å‘ç”Ÿæ›´æ–°æ“ä½œï¼Œéƒ½ä¼šç«‹å³è¿›è¡Œç£ç›˜å›å†™ã€‚ç¼“å†²æ± ä¼šé‡‡ç”¨ä¸€ç§å«åš<code>checkpoint çš„æœºåˆ¶</code>å°†æ•°æ®å›å†™åˆ°ç£ç›˜ä¸Šï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æå‡äº†æ•°æ®åº“çš„æ•´ä½“æ€§èƒ½ã€‚</p><p>æ¯”å¦‚ï¼Œå½“<code>ç¼“å†²æ± ä¸å¤Ÿç”¨</code>æ—¶ï¼Œéœ€è¦é‡Šæ”¾æ‰ä¸€äº›ä¸å¸¸ç”¨çš„é¡µï¼Œæ­¤æ—¶å°±å¯ä»¥å¼ºè¡Œé‡‡ç”¨checkpointçš„æ–¹å¼ï¼Œå°†ä¸å¸¸ç”¨çš„è„é¡µå›å†™åˆ°ç£ç›˜ä¸Šï¼Œç„¶åå†ä»ç¼“å­˜æ± ä¸­å°†è¿™äº›é¡µé‡Šæ”¾æ‰ã€‚è¿™é‡Œçš„è„é¡µ (dirty page) æŒ‡çš„æ˜¯ç¼“å†²æ± ä¸­è¢«ä¿®æ”¹è¿‡çš„é¡µï¼Œä¸ç£ç›˜ä¸Šçš„æ•°æ®é¡µä¸ä¸€è‡´ã€‚</p><blockquote><span class='p blue'>å¦‚ä½•æŸ¥çœ‹/è®¾ç½®ç¼“å†²æ± çš„å¤§å°ã€å®ä¾‹ä¸ªæ•°</span></blockquote><div class="tabs" id="c76b8aba-bf80-42f3-994e-f232c80ccf91"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#c76b8aba-bf80-42f3-994e-f232c80ccf91-1"><i class="fas fa-atom"></i>è®¾ç½®å¤§å°</button></li><li class="tab"><button type="button" data-href="#c76b8aba-bf80-42f3-994e-f232c80ccf91-2"><i class="far fa-sun"></i>è®¾ç½®Buffer Poolå®ä¾‹æ•°</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="c76b8aba-bf80-42f3-994e-f232c80ccf91-1"><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ MySQL MyISAM å­˜å‚¨å¼•æ“ï¼Œå®ƒåªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜æ•°æ®ï¼Œå¯¹åº”çš„é”®ç¼“å­˜å‚æ•°ä¸º<code>key_buffer_size</code>ï¼Œä½ å¯ä»¥ç”¨å®ƒè¿›è¡ŒæŸ¥çœ‹ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ InnoDB å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹ innodb_buffer_pool_size å˜é‡æ¥æŸ¥çœ‹ç¼“å†²æ± çš„å¤§å°ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_buffer_pool_size&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615214847480.png" alt="image-20210615214847480" style="zoom:80%;" /><p>ä½ èƒ½çœ‹åˆ°æ­¤æ—¶ InnoDB çš„ç¼“å†²æ± å¤§å°åªæœ‰ 134217728/1024/1024=128MBã€‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ç¼“å†²æ± å¤§å°ï¼Œæ¯”å¦‚æ”¹ä¸º256MBï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> innodb_buffer_pool_size <span class="operator">=</span> <span class="number">268435456</span>;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[server]</span><br><span class="line">innodb_buffer_pool_size <span class="operator">=</span> <span class="number">268435456</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="c76b8aba-bf80-42f3-994e-f232c80ccf91-2"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[server]</span><br><span class="line">innodb_buffer_pool_instances <span class="operator">=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è¡¨æ˜æˆ‘ä»¬è¦åˆ›å»º2ä¸ª<code>Buffer Pool</code>å®ä¾‹ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•æŸ¥çœ‹ç¼“å†²æ± çš„ä¸ªæ•°ï¼Œä½¿ç”¨å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_buffer_pool_instances&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230407190758971.png" alt="image-20230407190758971"></p><p>é‚£æ¯ä¸ª Buffer Pool å®ä¾‹å®é™…å å¤šå°‘å†…å­˜ç©ºé—´å‘¢ï¼Ÿå…¶å®ä½¿ç”¨è¿™ä¸ªå…¬å¼ç®—å‡ºæ¥çš„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_buffer_pool_size<span class="operator">/</span>innodb_buffer_pool_instances</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯æ€»å…±çš„å¤§å°é™¤ä»¥å®ä¾‹çš„ä¸ªæ•°ï¼Œç»“æœå°±æ˜¯æ¯ä¸ª Buffer Pool å®ä¾‹å ç”¨çš„å¤§å°ã€‚</p><p>ä¸è¿‡ä¹Ÿä¸æ˜¯è¯´ Buffer Pool å®ä¾‹åˆ›å»ºçš„è¶Šå¤šè¶Šå¥½ï¼Œåˆ†åˆ«ç®¡ç†å„ä¸ª Buffer Pool ä¹Ÿæ˜¯éœ€è¦æ€§èƒ½å¼€é”€çš„ï¼ŒInnDBè§„å®šï¼šå½“innodb_buffer_pool_sizeçš„å€¼å°äº1Gçš„æ—¶å€™è®¾ç½®å¤šä¸ªå®ä¾‹æ˜¯æ— æ•ˆçš„ï¼ŒInnoDBä¼šé»˜è®¤æŠŠinnodb_buffer_pool_instancesçš„å€¼ä¿®æ”¹ä¸º1ã€‚è€Œæˆ‘ä»¬é¼“åŠ±åœ¨ Buffer Pool å¤§äºç­‰äº 1G çš„æ—¶å€™è®¾ç½®å¤šä¸ª Buffer Pool å®ä¾‹ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <hr><blockquote><span class='p red'>å¼•ç”³é—®é¢˜ï¼šæˆ‘æ›´æ–°åˆ°ä¸€åŠçªç„¶å‘ç”Ÿé”™è¯¯äº†ï¼Œæƒ³è¦å›æ»šåˆ°æ›´æ–°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè¿æ•°æ®æŒä¹…åŒ–çš„ä¿è¯ã€äº‹åŠ¡å›æ»šéƒ½åšä¸åˆ°è¿˜è°ˆä»€ä¹ˆå´©æºƒæ¢å¤ï¼Ÿ</span></blockquote><p>Buffer Poolæ˜¯MySQLå†…å­˜ç»“æ„ä¸­ååˆ†æ ¸å¿ƒçš„ä¸€ä¸ªç»„æˆï¼Œä½ å¯ä»¥å…ˆæŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªé»‘ç›’å­ã€‚</p><p>é»‘ç›’ä¸‹çš„æ›´æ–°æ•°æ®æµç¨‹</p><p>å½“æˆ‘ä»¬æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆå» Buffer Pool ä¸­æŸ¥è¯¢ã€‚å¦‚æœ Buffer Pool ä¸­ä¸å­˜åœ¨ï¼Œå­˜å‚¨å¼•æ“ä¼šå…ˆå°†æ•°æ®ä»ç£ç›˜åŠ è½½åˆ° Buffer Pool ä¸­ï¼Œç„¶åå°†æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ï¼›åŒç†ï¼Œå½“æˆ‘ä»¬æ›´æ–°æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨äº Buffer Poolï¼ŒåŒæ ·ä¼šå…ˆæ•°æ®åŠ è½½è¿›æ¥ï¼Œç„¶åä¿®æ”¹å†…å­˜çš„æ•°æ®ã€‚è¢«ä¿®æ”¹çš„æ•°æ®ä¼šåœ¨ä¹‹åç»Ÿä¸€åˆ·å…¥ç£ç›˜ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615222455867.png" alt="image-20210615222455867" style="zoom:75%;" /><span class='p green'>ç­”æ¡ˆï¼šRedo Log & Undo Log</span><hr><h2 id="2-å­˜å‚¨å¼•æ“">2. å­˜å‚¨å¼•æ“</h2><p>ä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œäººä»¬æŠŠ<code>è¿æ¥ç®¡ç†ã€æŸ¥è¯¢ç»¶å­˜ã€è¯­æ³•è§£æã€æŸ¥è¯¢ä¼˜åŒ–</code>è¿™äº›å¹¶ä¸æ¶‰åŠçœŸå®æ•°æ®å­˜å‚¨çš„åŠŸèƒ½åˆ’åˆ†ä¸º<code>MySQL server</code>çš„åŠŸèƒ½ï¼ŒæŠŠçœŸå®å­˜å–æ•°æ®çš„åŠŸèƒ½åˆ’åˆ†ä¸º<code>å­˜å‚¨å¼•æ“</code>çš„åŠŸèƒ½ã€‚æ‰€ä»¥åœ¨<code>MySQL server</code>å®Œæˆäº†æŸ¥è¯¢ä¼˜åŒ–åï¼Œåªéœ€æŒ‰ç…§ç”Ÿæˆçš„<code>æ‰§è¡Œè®¡åˆ’</code>è°ƒç”¨åº•å±‚å­˜å‚¨å¼•æ“æä¾›çš„APlï¼Œè·å–åˆ°æ•°æ®åè¿”å›ç»™å®¢æˆ·ç«¯å°±å¥½äº†ã€‚</p><p>MySQLä¸­æåˆ°äº†å­˜å‚¨å¼•æ“çš„æ¦‚å¿µã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<code>å­˜å‚¨å¼•æ“å°±æ˜¯æŒ‡è¡¨çš„ç±»å‹ã€‚</code>å…¶å®å­˜å‚¨å¼•æ“ä»¥å‰å«åš<code>è¡¨å¤„ç†å™¨</code>ï¼Œåæ¥æ”¹åä¸º<code>å­˜å‚¨å¼•æ“</code>ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯æ¥æ”¶ä¸Šå±‚ä¼ ä¸‹æ¥çš„æŒ‡ä»¤ï¼Œç„¶åå¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæå–æˆ–å†™å…¥æ“ä½œã€‚</p><div class="tabs" id="dba4892e-9f59-4cb2-8845-6951a1a2cae8"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#dba4892e-9f59-4cb2-8845-6951a1a2cae8-1"><i class="fas fa-bug"></i>æŸ¥çœ‹å­˜å‚¨å¼•æ“</button></li><li class="tab"><button type="button" data-href="#dba4892e-9f59-4cb2-8845-6951a1a2cae8-2"><i class="fas fa-cannabis"></i>ä¿®æ”¹ç³»ç»Ÿå­˜å‚¨å¼•æ“</button></li><li class="tab"><button type="button" data-href="#dba4892e-9f59-4cb2-8845-6951a1a2cae8-3"><i class="fas fa-candy-cane"></i>è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="dba4892e-9f59-4cb2-8845-6951a1a2cae8-1"><p>æŸ¥çœ‹mysqlæä¾›ä»€ä¹ˆå­˜å‚¨å¼•æ“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> engines;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615223831995.png" alt="image-20210615223831995"></p><p>æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%storage_engine%&#x27;</span>;</span><br><span class="line">#æˆ–</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@default</span>_storage_engine;</span><br></pre></td></tr></table></figure><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210615224249491.png" alt="image-20210615224249491" style="zoom:60%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dba4892e-9f59-4cb2-8845-6951a1a2cae8-2"><p>ä¿®æ”¹é»˜è®¤çš„å­˜å‚¨å¼•æ“</p><p>å¦‚æœåœ¨åˆ›å»ºè¡¨çš„è¯­å¥ä¸­æ²¡æœ‰æ˜¾å¼æŒ‡å®šè¡¨çš„å­˜å‚¨å¼•æ“çš„è¯ï¼Œé‚£å°±ä¼šé»˜è®¤ä½¿ç”¨ InnoDB ä½œä¸ºè¡¨çš„å­˜å‚¨å¼•æ“ã€‚ å¦‚æœæˆ‘ä»¬æƒ³æ”¹å˜è¡¨çš„é»˜è®¤å­˜å‚¨å¼•æ“çš„è¯ï¼Œå¯ä»¥è¿™æ ·å†™å¯åŠ¨æœåŠ¡å™¨çš„å‘½ä»¤è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> DEFAULT_STORAGE_ENGINE<span class="operator">=</span>MyISAM;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¿®æ”¹ my.cnf æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span><span class="operator">-</span>storage<span class="operator">-</span>engine<span class="operator">=</span>MyISAM</span><br><span class="line"># é‡å¯æœåŠ¡</span><br><span class="line">systemctl restart mysqld.service</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dba4892e-9f59-4cb2-8845-6951a1a2cae8-3"><p>æˆ‘ä»¬ä¹‹å‰åˆ›å»ºè¡¨çš„è¯­å¥éƒ½æ²¡æœ‰æŒ‡å®šè¡¨çš„å­˜å‚¨å¼•æ“ï¼Œé‚£å°±ä¼šä½¿ç”¨é»˜è®¤çš„å­˜å‚¨å¼•æ“ InnoDB ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ˜¾ å¼çš„æŒ‡å®šä¸€ä¸‹è¡¨çš„å­˜å‚¨å¼•æ“ï¼Œé‚£å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å(</span><br><span class="line">å»ºè¡¨è¯­å¥;</span><br><span class="line">) ENGINE <span class="operator">=</span> å­˜å‚¨å¼•æ“åç§°;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¡¨å·²ç»å»ºå¥½äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹è¾¹è¿™ä¸ªè¯­å¥æ¥ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å ENGINE <span class="operator">=</span> å­˜å‚¨å¼•æ“åç§°;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ engine_demo_table è¡¨çš„å­˜å‚¨å¼•æ“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> engine_demo_table ENGINE <span class="operator">=</span> InnoDB;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="2-1-å¼•æ“ä»‹ç»">2.1 å¼•æ“ä»‹ç»</h3><div class="tabs" id="53809b56-a6af-4480-8840-c5311d4bd7af"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-1"><i class="fas fa-cat"></i>1</button></li><li class="tab"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-2"><i class="fas fa-horse"></i>2</button></li><li class="tab"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-3"><i class="fas fa-dove"></i>3</button></li><li class="tab"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-4"><i class="fas fa-dragon"></i>4</button></li><li class="tab"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-5"><i class="fas fa-atom"></i>5</button></li><li class="tab"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-6"><i class="far fa-sun"></i>6</button></li><li class="tab"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-7"><i class="fas fa-wind"></i>7</button></li><li class="tab"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-8"><i class="fas fa-fire-alt"></i>8</button></li><li class="tab"><button type="button" data-href="#53809b56-a6af-4480-8840-c5311d4bd7af-9"><i class="fas fa-tree"></i>9</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="53809b56-a6af-4480-8840-c5311d4bd7af-1"><p><span class='p green'>InnoDB å¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“</span></p><p>MySQLä»3.23å¼€å§‹å°±åŒ…å«InnoDBå­˜å‚¨å¼•æ“ã€‚<code>å¤§äºç­‰äº5.5ä¹‹åï¼Œé»˜è®¤é‡‡ç”¨InnoDBå¼•æ“</code>ã€‚</p><p>InnoDBæ˜¯MySQLçš„<code>é»˜è®¤äº‹åŠ¡å‹å¼•æ“</code>ï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥å¤„ç†å¤§é‡çš„çŸ­æœŸ(short-lived)äº‹åŠ¡ã€‚å¯ä»¥ç¡®ä¿äº‹åŠ¡çš„å®Œæ•´æäº¤(Commit)å’Œå›æ»š(Rollback)ã€‚</p><p>é™¤äº†å¢åŠ å’ŒæŸ¥è¯¢å¤–ï¼Œè¿˜éœ€è¦æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆï¼Œåº”ä¼˜å…ˆé€‰æ‹©InnoDBå­˜å‚¨å¼•æ“ã€‚ <span class='p red'>é™¤éæœ‰éå¸¸ç‰¹åˆ«çš„åŸå› éœ€è¦ä½¿ç”¨å…¶ä»–çš„å­˜å‚¨å¼•æ“ï¼Œå¦åˆ™åº”è¯¥ä¼˜å…ˆè€ƒè™‘InnoDBå¼•æ“ã€‚</span></p><p>æ•°æ®æ–‡ä»¶ç»“æ„ï¼š</p><ul><li>è¡¨å.frm å­˜å‚¨è¡¨ç»“æ„<span class='p red'>ï¼ˆMySQL8.0æ—¶ï¼Œåˆå¹¶åœ¨è¡¨å.ibdä¸­ï¼Œå³æ²¡æœ‰.frmï¼‰</span></li><li>è¡¨å.ibd å­˜å‚¨æ•°æ®å’Œç´¢å¼•</li></ul><p>InnoDBæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ã€‚</p><ul><li>åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå­—å…¸æ•°æ®ä»¥å…ƒæ•°æ®æ–‡ä»¶ã€éäº‹åŠ¡è¡¨ç­‰æ¥å­˜å‚¨ã€‚ç°åœ¨è¿™äº›å…ƒæ•°æ®æ–‡ä»¶è¢«åˆ é™¤ äº†ã€‚æ¯”å¦‚ï¼š<code>.frm , .par  , .trn, .isl , .db , .opt</code>ç­‰éƒ½åœ¨MySQL8.0ä¸­ä¸å­˜åœ¨äº†ã€‚</li></ul><p>å¯¹æ¯”MyISAMçš„å­˜å‚¨å¼•æ“ï¼Œ<code>InnoDBå†™çš„å¤„ç†æ•ˆç‡å·®ä¸€äº›</code>ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿å­˜æ•°æ®å’Œç´¢å¼•ã€‚</p><p>MyISAMåªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ®ï¼›InnoDBä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œ<code>å¯¹å†…å­˜è¦æ±‚è¾ƒé«˜</code>ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="53809b56-a6af-4480-8840-c5311d4bd7af-2"><p><span class='p green'>MyISAM å¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“</span></p><p>MyISAMæä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ï¼Œä½†MyISAM<code>ä¸æ”¯æŒäº‹åŠ¡ã€è¡Œçº§ é”ã€å¤–é”®</code>ï¼Œæœ‰ä¸€ä¸ªæ¯«æ— ç–‘é—®çš„ç¼ºé™·å°±æ˜¯<code>å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤</code>ã€‚</p><p>5.5ä¹‹å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“</p><p>ä¼˜åŠ¿æ˜¯<code>è®¿é—®çš„é€Ÿåº¦å¿«</code>ï¼Œå¯¹äº‹åŠ¡å®Œæ•´æ€§æ²¡æœ‰è¦æ±‚æˆ–è€…ä»¥SELECTã€INSERTä¸ºä¸»çš„åº”ç”¨</p><p>é’ˆå¯¹æ•°æ®ç»Ÿè®¡æœ‰é¢å¤–çš„å¸¸æ•°å­˜å‚¨ã€‚æ•…è€Œ count(*) çš„æŸ¥è¯¢æ•ˆç‡å¾ˆé«˜ æ•°æ®æ–‡ä»¶ç»“æ„ï¼š</p><ul><li>è¡¨å.frm å­˜å‚¨è¡¨ç»“æ„</li><li>è¡¨å.MYD å­˜å‚¨æ•°æ® (MYData)</li><li>è¡¨å.MYI å­˜å‚¨ç´¢å¼• (MYIndex)</li></ul><p>åº”ç”¨åœºæ™¯ï¼šåªè¯»åº”ç”¨æˆ–è€…ä»¥è¯»ä¸ºä¸»çš„ä¸šåŠ¡</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="53809b56-a6af-4480-8840-c5311d4bd7af-3"><p>Archive å¼•æ“ï¼šç”¨äºæ•°æ®å­˜æ¡£</p><p>archive æ˜¯å½’æ¡£çš„æ„æ€ï¼Œä»…ä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ï¼ˆè¡Œè¢«æ’å…¥åä¸èƒ½å†ä¿®æ”¹ï¼‰ã€‚</p><p>åœ¨MySQL5.5ä»¥åæ”¯æŒç´¢å¼•åŠŸèƒ½ã€‚</p><p>æ‹¥æœ‰å¾ˆå¥½çš„å‹ç¼©æœºåˆ¶ï¼Œä½¿ç”¨z1ibå‹ç¼©åº“ï¼Œåœ¨è®°å½•è¯·æ±‚çš„æ—¶å€™å®æ—¶çš„è¿›è¡Œå‹ç¼©ï¼Œç»å¸¸è¢«ç”¨æ¥ä½œä¸ºä»“åº“ä½¿ç”¨ã€‚</p><p>åˆ›å»ºARCHIVEè¡¨æ—¶ï¼Œå­˜å‚¨å¼•æ“ä¼šåˆ›å»ºåç§°ä»¥è¡¨åå¼€å¤´çš„æ–‡ä»¶ã€‚æ•°æ®æ–‡ä»¶çš„æ‰©å±•åä¸º.ARZã€‚</p><p>æ ¹æ®è‹±æ–‡çš„æµ‹è¯•ç»“è®ºæ¥çœ‹ï¼ŒåŒæ ·æ•°æ®é‡ä¸‹ï¼ŒArchiveè¡¨æ¯”MyISAMè¡¨è¦å°å¤§çº¦75%ï¼Œæ¯”æ”¯æŒäº‹åŠ¡å¤„ç†çš„InnoDBè¡¨å°å¤§çº¦83%ã€‚</p><p>ARCHIVEå­˜å‚¨å¼•æ“é‡‡ç”¨äº†<code>è¡Œçº§é”</code>ã€‚è¯¥ARCHIVEå¼•æ“æ”¯æŒ AUTO_ INCREMENT åˆ—å±æ€§ã€‚AUTO_INCREMENTåˆ—å¯ä»¥å…·æœ‰å”¯ä¸€ç´¢å¼•æˆ–éå”¯ä¸€ç´¢å¼•ã€‚å°è¯•åœ¨ä»»ä½•å…¶ä»–åˆ—ä¸Šåˆ›å»ºç´¢å¼•ä¼šå¯¼è‡´é”™è¯¯ã€‚</p><p>Archiveè¡¨é€‚åˆ<code>æ—¥å¿—å’Œæ•°æ®é‡‡é›†ï¼ˆæ¡£æ¡ˆï¼‰ç±»åº”ç”¨</code>ï¼›é€‚åˆå­˜å‚¨å¤§é‡çš„ç‹¬ç«‹çš„ä½œä¸ºå†å²è®°å½•çš„æ•°æ®ã€‚æ‹¥æœ‰å¾ˆé«˜çš„æ’å…¥é€Ÿåº¦ï¼Œä½†æ˜¯å¯¹æŸ¥è¯¢çš„æ”¯æŒè¾ƒå·®ã€‚</p><p>ä¸‹è¡¨å±•ç¤ºäº†ARCHIVE å­˜å‚¨å¼•æ“åŠŸèƒ½</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210616124743732.png" alt="image-20210616124743732"  /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="53809b56-a6af-4480-8840-c5311d4bd7af-4"><p>Blackhole å¼•æ“ï¼šä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="53809b56-a6af-4480-8840-c5311d4bd7af-5"><p>CSV å¼•æ“ï¼šå­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹</p><p>CSVå¼•æ“å¯ä»¥å°†æ™®é€šçš„CSVæ–‡ä»¶ä½œä¸ºMySQLçš„è¡¨æ¥å¤„ç†ï¼Œä½†ä¸æ”¯æŒç´¢å¼•ã€‚</p><p>CSVå¼•æ“å¯ä»¥ä½œä¸ºä¸€ç§æ•°æ®äº¤æ¢çš„æœºåˆ¶ï¼Œéå¸¸æœ‰ç”¨ã€‚</p><p>CSVå­˜å‚¨çš„æ•°æ®ç›´æ¥å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿé‡Œï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæˆ–è€…exceè¯»å–ã€‚</p><p>å¯¹äºæ•°æ®çš„å¿«é€Ÿå¯¼å…¥ã€å¯¼å‡ºæ˜¯æœ‰æ˜æ˜¾ä¼˜åŠ¿çš„ã€‚</p><p>åˆ›å»ºCSVè¡¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªçº¯æ–‡æœ¬æ•°æ®æ–‡ä»¶ï¼Œå…¶åç§°ä»¥è¡¨åå¼€å¤´å¹¶å¸¦æœ‰.CSVæ‰©å±•åã€‚å½“ä½ å°†æ•°æ®å­˜å‚¨åˆ°è¡¨ä¸­æ—¶ï¼Œå­˜å‚¨å¼•æ“å°†å…¶ä»¥é€—å·åˆ†éš”å€¼æ ¼å¼ä¿å­˜åˆ°æ•°æ®æ–‡ä»¶ä¸­ã€‚</p><p>ä½¿ç”¨æ¡ˆä¾‹å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test (i <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, c <span class="type">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>) ENGINE <span class="operator">=</span> CSV;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.06</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> test <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">&#x27;record one&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;record two&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">2</span> <span class="keyword">rows</span> affected (<span class="number">0.05</span> sec)</span><br><span class="line">Records: <span class="number">2</span> Duplicates: <span class="number">0</span> Warnings: <span class="number">0</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test;</span><br><span class="line"><span class="operator">+</span><span class="comment">---+------------+</span></span><br><span class="line"><span class="operator">|</span> i <span class="operator">|</span>      c     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---+------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> record <span class="keyword">one</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> record two <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---+------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>åˆ›å»ºCSVè¡¨è¿˜ä¼šåˆ›å»ºç›¸åº”çš„å…ƒæ–‡ä»¶ ï¼Œç”¨äº å­˜å‚¨è¡¨çš„çŠ¶æ€ å’Œ è¡¨ä¸­å­˜åœ¨çš„è¡Œæ•° ã€‚æ­¤æ–‡ä»¶çš„åç§°ä¸è¡¨çš„åç§°ç›¸ åŒï¼Œåç¼€ä¸º CSM ã€‚å¦‚å›¾æ‰€ç¤º</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210616125342599.png" alt="image-20210616125342599"></p><p>å¦‚æœæ£€æŸ¥ test.CSV é€šè¿‡æ‰§è¡Œä¸Šè¿°è¯­å¥åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œå…¶å†…å®¹ä½¿ç”¨Notepad++æ‰“å¼€å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;1&quot;,&quot;record one&quot;</span><br><span class="line">&quot;2&quot;,&quot;record two&quot;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ ¼å¼å¯ä»¥è¢« Microsoft Excel ç­‰ç”µå­è¡¨æ ¼åº”ç”¨ç¨‹åºè¯»å–ï¼Œç”šè‡³å†™å…¥ã€‚ä½¿ç”¨Microsoft Excelæ‰“å¼€å¦‚å›¾æ‰€ç¤º</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20210616125448555.png" alt="image-20210616125448555"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="53809b56-a6af-4480-8840-c5311d4bd7af-6"><p>Memory å¼•æ“ï¼šç½®äºå†…å­˜çš„è¡¨</p><p><strong>æ¦‚è¿°ï¼š</strong></p><p>Memoryé‡‡ç”¨çš„é€»è¾‘ä»‹è´¨æ˜¯å†…å­˜ ï¼Œå“åº”é€Ÿåº¦å¾ˆå¿« ï¼Œä½†æ˜¯å½“mysqldå®ˆæŠ¤è¿›ç¨‹å´©æºƒçš„æ—¶å€™æ•°æ®ä¼šä¸¢å¤± ã€‚å¦å¤–ï¼Œè¦æ±‚å­˜å‚¨çš„æ•°æ®æ˜¯æ•°æ®é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼Œæ¯”å¦‚ï¼ŒBlobå’ŒTextç±»å‹çš„æ•°æ®ä¸å¯ç”¨(é•¿åº¦ä¸å›ºå®šçš„)ã€‚</p><p><strong>ä¸»è¦ç‰¹å¾ï¼š</strong></p><ul><li>MemoryåŒæ—¶ æ”¯æŒå“ˆå¸Œï¼ˆHASHï¼‰ç´¢å¼• å’Œ B+æ ‘ç´¢å¼• ã€‚</li><li>Memoryè¡¨è‡³å°‘æ¯”MyISAMè¡¨è¦å¿«ä¸€ä¸ªæ•°é‡çº§ ã€‚</li><li>MEMORY è¡¨çš„å¤§å°æ˜¯å—åˆ°é™åˆ¶ çš„ã€‚è¡¨çš„å¤§å°ä¸»è¦å–å†³äºä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ max_rows å’Œ max_heap_table_size ã€‚å…¶ä¸­ï¼Œmax_rowså¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶æŒ‡å®šï¼›max_heap_table_sizeçš„å¤§å°é»˜ è®¤ä¸º16MBï¼Œå¯ä»¥æŒ‰éœ€è¦è¿›è¡Œæ‰©å¤§ã€‚</li><li>æ•°æ®æ–‡ä»¶ä¸ç´¢å¼•æ–‡ä»¶åˆ†å¼€å­˜å‚¨ã€‚</li><li>ç¼ºç‚¹ï¼šå…¶æ•°æ®æ˜“ä¸¢å¤±ï¼Œç”Ÿå‘½å‘¨æœŸçŸ­ã€‚åŸºäºè¿™ä¸ªç¼ºé™·ï¼Œé€‰æ‹©MEMORYå­˜å‚¨å¼•æ“æ—¶éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚</li></ul><p><strong>ä½¿ç”¨Memoryå­˜å‚¨å¼•æ“çš„åœºæ™¯ï¼š</strong></p><ol><li>ç›®æ ‡æ•°æ®æ¯”è¾ƒå° ï¼Œè€Œä¸”éå¸¸é¢‘ç¹çš„è¿›è¡Œè®¿é—® ï¼Œåœ¨å†…å­˜ä¸­å­˜æ”¾æ•°æ®ï¼Œå¦‚æœå¤ªå¤§çš„æ•°æ®ä¼šé€ æˆå†…å­˜æº¢å‡º ã€‚å¯ä»¥é€šè¿‡å‚æ•° max_heap_table_size æ§åˆ¶Memoryè¡¨çš„å¤§å°ï¼Œé™åˆ¶Memoryè¡¨çš„æœ€å¤§çš„å¤§å°ã€‚</li><li>å¦‚æœæ•°æ®æ˜¯ä¸´æ—¶çš„ ï¼Œè€Œä¸”å¿…é¡»ç«‹å³å¯ç”¨å¾—åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ”¾åœ¨å†…å­˜ä¸­ã€‚</li><li>å­˜å‚¨åœ¨Memoryè¡¨ä¸­çš„æ•°æ®å¦‚æœçªç„¶é—´ä¸¢å¤±çš„è¯ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„å…³ç³» ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="53809b56-a6af-4480-8840-c5311d4bd7af-7"><p>Federated å¼•æ“ï¼šè®¿é—®è¿œç¨‹è¡¨</p><p><strong>Federatedå¼•æ“æ˜¯è®¿é—®å…¶ä»–MySQLæœåŠ¡å™¨çš„ä¸€ä¸ª ä»£ç† ï¼Œå°½ç®¡è¯¥å¼•æ“çœ‹èµ·æ¥æä¾›äº†ä¸€ç§å¾ˆå¥½çš„ è·¨æœåŠ¡ å™¨çš„çµæ´»æ€§ ï¼Œä½†ä¹Ÿç»å¸¸å¸¦æ¥é—®é¢˜ï¼Œå› æ­¤ é»˜è®¤æ˜¯ç¦ç”¨çš„ ã€‚</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="53809b56-a6af-4480-8840-c5311d4bd7af-8"><p>Mergeå¼•æ“ï¼šç®¡ç†å¤šä¸ªMyISAMè¡¨æ„æˆçš„è¡¨é›†åˆ</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="53809b56-a6af-4480-8840-c5311d4bd7af-9"><p>NDBå¼•æ“ï¼šMySQLé›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“</p><p>ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ ç¯å¢ƒï¼Œç±»ä¼¼äº Oracle çš„ RAC é›†ç¾¤ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="2-2-MyISAMå’ŒInnoDBå¯¹æ¯”">2.2 MyISAMå’ŒInnoDBå¯¹æ¯”</h3><table><thead><tr><th style="text-align:center">å¯¹æ¯”é€‰é¡¹</th><th style="text-align:center">MyISAM</th><th style="text-align:center">InnoDB</th></tr></thead><tbody><tr><td style="text-align:center">å¤–é”®</td><td style="text-align:center">ä¸æ”¯æŒ</td><td style="text-align:center">æ”¯æŒ</td></tr><tr><td style="text-align:center">äº‹åŠ¡</td><td style="text-align:center">ä¸æ”¯æŒ</td><td style="text-align:center">æ”¯æŒ</td></tr><tr><td style="text-align:center">è¡Œè¡¨é”</td><td style="text-align:center">è¡¨é”ï¼Œå³ä½¿æ“ä½œä¸€æ¡è®°å½•ä¹Ÿä¼šé”ä½æ•´ä¸ªè¡¨ï¼Œä¸é€‚åˆé«˜å¹¶å‘çš„æ“ä½œ</td><td style="text-align:center">è¡Œé”ï¼Œæ“ä½œæ—¶åªé”æŸä¸€è¡Œï¼Œä¸å¯¹å…¶å®ƒè¡Œæœ‰å½±å“ï¼Œé€‚åˆé«˜å¹¶å‘çš„æ“ä½œ</td></tr><tr><td style="text-align:center">ç¼“å­˜</td><td style="text-align:center">åªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ®</td><td style="text-align:center">ä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œå¯¹å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“</td></tr><tr><td style="text-align:center">è‡ªå¸¦ç³»ç»Ÿè¡¨ä½¿ç”¨</td><td style="text-align:center">Y</td><td style="text-align:center">N</td></tr><tr><td style="text-align:center">å…³æ³¨ç‚¹</td><td style="text-align:center">æ€§èƒ½ï¼šèŠ‚çœèµ„æºã€æ¶ˆè€—å°‘ã€ç®€å•ä¸šåŠ¡</td><td style="text-align:center">äº‹åŠ¡ï¼šå¹¶å‘å†™ã€äº‹åŠ¡ã€æ›´å¤§èµ„æº</td></tr><tr><td style="text-align:center">é»˜è®¤å®‰è£…</td><td style="text-align:center">Y</td><td style="text-align:center">Y</td></tr><tr><td style="text-align:center">é»˜è®¤ä½¿ç”¨</td><td style="text-align:center">N</td><td style="text-align:center">Y</td></tr></tbody></table><blockquote><p>è¡¥å……ï¼šä¸ºä»€ä¹ˆInnoDBæ²¡æœ‰åƒMyISAMé‚£æ ·è®°å½•è¡¨çš„æ€»è¡Œæ•°ï¼Ÿ</p></blockquote><p>å¯¹äºMyISAMï¼š<br>å› ä¸ºMySQLå¯¹è¯¥å¼•æ“çš„countæœ‰å¯¹åº”ä¼˜åŒ–ï¼Œç²¾ç¡®çš„è¡Œæ•°ä¼šè¢«å‚¨å­˜åœ¨å­˜å‚¨å¼•æ“ä¸­ï¼Œå› æ­¤æ­¤ç±»æ²¡æœ‰whereæ¡ä»¶çš„å•è¡¨æ€»è¡Œæ•°æŸ¥è¯¢ä¼šè¿…é€Ÿè¿”å›ç»“æœã€‚<br>å¯¹äºInnoDBï¼š<br>å› ä¸ºInnoDBçš„äº‹åŠ¡ç‰¹æ€§ï¼Œåœ¨åŒä¸€æ—¶åˆ»è¡¨ä¸­çš„è¡Œæ•°å¯¹äºä¸åŒçš„äº‹åŠ¡è€Œè¨€æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› æ­¤countç»Ÿè®¡ä¼šè®¡ç®—å¯¹äºå½“å‰äº‹åŠ¡è€Œè¨€å¯ä»¥ç»Ÿè®¡åˆ°çš„è¡Œæ•°ï¼Œè€Œä¸æ˜¯å°†æ€»è¡Œæ•°å‚¨å­˜èµ·æ¥æ–¹ä¾¿å¿«é€ŸæŸ¥è¯¢ã€‚InnoDBä¼šå°è¯•éå†ä¸€ä¸ªå°½å¯èƒ½å°çš„ç´¢å¼•é™¤éä¼˜åŒ–å™¨æç¤ºä½¿ç”¨åˆ«çš„ç´¢å¼•ã€‚å¦‚æœäºŒçº§ç´¢å¼•ä¸å­˜åœ¨ï¼ŒInnoDBè¿˜ä¼šå°è¯•å»éå†å…¶ä»–èšç°‡ç´¢å¼•ã€‚<br>å¦‚æœç´¢å¼•å¹¶æ²¡æœ‰å®Œå…¨å¤„äºInnoDBç»´æŠ¤çš„ç¼“å†²åŒºï¼ˆBuffer Poolï¼‰ä¸­ï¼Œcountæ“ä½œä¼šæ¯”è¾ƒè´¹æ—¶ã€‚å¯ä»¥å»ºç«‹ä¸€ä¸ªè®°å½•æ€»è¡Œæ•°çš„è¡¨å¹¶è®©ä½ çš„ç¨‹åºåœ¨INSERT/DELETEæ—¶æ›´æ–°å¯¹åº”çš„æ•°æ®ã€‚å’Œä¸Šé¢æåˆ°çš„é—®é¢˜ä¸€æ ·ï¼Œå¦‚æœæ­¤æ—¶å­˜åœ¨å¤šä¸ªäº‹åŠ¡çš„è¯è¿™ç§æ–¹æ¡ˆä¹Ÿä¸å¤ªå¥½ç”¨ã€‚å¦‚æœå¾—åˆ°å¤§è‡´çš„è¡Œæ•°å€¼å·²ç»è¶³å¤Ÿæ»¡è¶³éœ€æ±‚å¯ä»¥å°è¯•SHOW TABLE STATUS</p><hr><h3 id="2-3-è¯¾å¤–è¡¥å……">2.3 è¯¾å¤–è¡¥å……</h3><blockquote><p>é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ªå­˜å‚¨å¼•æ“ï¼Ÿ</p></blockquote><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230407200425135.png" alt="image-20230407200425135"></p><ul><li>Percona ä¸º MySQL æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œäº†æ”¹è¿›ï¼Œåœ¨åŠŸèƒ½å’Œæ€§èƒ½ä¸Šè¾ƒ MySQL æœ‰å¾ˆæ˜¾è‘—çš„æå‡ã€‚</li><li>è¯¥ç‰ˆæœ¬æå‡äº†åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹çš„ InnoDB çš„æ€§èƒ½ã€ä¸º DBA æä¾›ä¸€äº›éå¸¸æœ‰ç”¨çš„æ€§èƒ½è¯Šæ–­å·¥å…·ï¼›å¦å¤–æœ‰æ›´å¤šçš„å‚æ•°å’Œå‘½ä»¤æ¥æ§åˆ¶æœåŠ¡å™¨è¡Œä¸ºã€‚</li><li>è¯¥å…¬å¸æ–°å»ºäº†ä¸€æ¬¾å­˜å‚¨å¼•æ“å«Xtradb å®Œå…¨å¯ä»¥æ›¿ä»£Innodb ï¼Œå¹¶ä¸”åœ¨æ€§èƒ½å’Œå¹¶å‘ä¸Šåšå¾—æ›´å¥½</li><li>é˜¿é‡Œå·´å·´å¤§éƒ¨åˆ†mysqlæ•°æ®åº“å…¶å®ä½¿ç”¨çš„perconaçš„åŸå‹åŠ ä»¥ä¿®æ”¹ã€‚</li></ul><blockquote><p>1ã€InnoDBçš„ä¼˜åŠ¿</p></blockquote><p>InnoDBå­˜å‚¨å¼•æ“åœ¨å®é™…åº”ç”¨ä¸­æ‹¥æœ‰è¯¸å¤šä¼˜åŠ¿ï¼Œæ¯”å¦‚æ“ä½œä¾¿åˆ©ã€æé«˜äº†æ•°æ®åº“çš„æ€§èƒ½ã€ç»´æŠ¤æˆæœ¬ä½ç­‰ã€‚å¦‚æœç”±äºç¡¬ä»¶æˆ–è½¯ä»¶çš„åŸå› å¯¼è‡´æœåŠ¡å™¨å´©æºƒï¼Œé‚£ä¹ˆåœ¨é‡å¯æœåŠ¡å™¨ä¹‹åä¸éœ€è¦è¿›è¡Œé¢å¤–çš„æ“ä½œã€‚InnoDBå´©æºƒæ¢å¤åŠŸèƒ½è‡ªåŠ¨å°†ä¹‹å‰æäº¤çš„å†…å®¹å®šå‹ï¼Œç„¶åæ’¤é”€æ²¡æœ‰æäº¤çš„è¿›ç¨‹ï¼Œé‡å¯ä¹‹åç»§ç»­ä»å´©æºƒç‚¹å¼€å§‹æ‰§è¡Œã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“åœ¨ä¸»å†…å­˜ä¸­ç»´æŠ¤ç¼“å†²æ± ï¼Œé«˜é¢‘ç‡ä½¿ç”¨çš„æ•°æ®å°†åœ¨å†…å­˜ä¸­ç›´æ¥è¢«å¤„ç†ã€‚è¿™ç§ç¼“å­˜æ–¹å¼åº”ç”¨äºå¤šç§ä¿¡æ¯ï¼ŒåŠ é€Ÿäº†å¤„ç†è¿›ç¨‹ã€‚</p><p>åœ¨ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œç‰©ç†å†…å­˜ä¸­é«˜è¾¾80%çš„éƒ¨åˆ†è¢«åº”ç”¨äºç¼“å†²æ± ã€‚å¦‚æœéœ€è¦å°†æ•°æ®æ’å…¥ä¸åŒçš„è¡¨ä¸­ï¼Œå¯ä»¥è®¾ç½®å¤–é”®åŠ å¼ºæ•°æ®çš„å®Œæ•´æ€§ã€‚æ›´æ–°æˆ–è€…åˆ é™¤æ•°æ®ï¼Œå…³è”æ•°æ®å°†ä¼šè¢«è‡ªåŠ¨æ›´æ–°æˆ–åˆ é™¤ã€‚å¦‚æœè¯•å›¾å°†æ•°æ®æ’å…¥ä»è¡¨ï¼Œä½†åœ¨ä¸»è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œæ’å…¥çš„æ•°æ®å°†è¢«è‡ªåŠ¨ç§»é™¤ã€‚å¦‚æœç£ç›˜æˆ–å†…å­˜ä¸­çš„æ•°æ®å‡ºç°å´©æºƒï¼Œåœ¨ä½¿ç”¨è„æ•°æ®ä¹‹å‰ï¼Œæ ¡éªŒå’Œæœºåˆ¶ä¼šå‘å‡ºè­¦å‘Šã€‚å½“æ¯ä¸ªè¡¨çš„ä¸»é”®éƒ½è®¾ç½®åˆç†æ—¶ï¼Œä¸è¿™äº›åˆ—æœ‰å…³çš„æ“ä½œä¼šè¢«è‡ªåŠ¨ä¼˜åŒ–ã€‚æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œé€šè¿‡åšæ”¹å˜ç¼“å†²è‡ªåŠ¨æœºåˆ¶è¿›è¡Œä¼˜åŒ–ã€‚<code>InnoDBä¸ä»…æ”¯æŒå½“å‰è¯»å†™ï¼Œä¹Ÿä¼šç¼“å†²æ”¹å˜çš„æ•°æ®åˆ°æ•°æ®æµç£ç›˜ã€‚</code></p><p>InnoDBçš„æ€§èƒ½ä¼˜åŠ¿ä¸åªå­˜åœ¨äºé•¿æ—¶è¿è¡ŒæŸ¥è¯¢çš„å¤§å‹è¡¨ã€‚åœ¨åŒä¸€åˆ—å¤šæ¬¡è¢«æŸ¥è¯¢æ—¶ï¼Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ä¼šæé«˜æŸ¥è¯¢çš„é€Ÿåº¦ã€‚ä½¿ç”¨InnoDBå¯ä»¥å‹ç¼©è¡¨å’Œç›¸å…³çš„ç´¢å¼•ï¼Œ<code>å¯ä»¥åœ¨ä¸å½±å“æ€§èƒ½å’Œå¯ç”¨æ€§çš„æƒ…å†µä¸‹åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•</code>ã€‚å¯¹äºå¤§å‹æ–‡æœ¬å’ŒBLOBæ•°æ®ï¼Œä½¿ç”¨åŠ¨æ€è¡Œå½¢å¼ï¼Œè¿™ç§å­˜å‚¨å¸ƒå±€æ›´é«˜æ•ˆã€‚é€šè¿‡æŸ¥è¯¢INFORMATION_SCHEMAåº“ä¸­çš„è¡¨å¯ä»¥ç›‘æ§å­˜å‚¨å¼•æ“çš„å†…éƒ¨å·¥ä½œã€‚åœ¨åŒä¸€ä¸ªè¯­å¥ä¸­ï¼ŒInnoDBè¡¨å¯ä»¥ä¸å…¶ä»–å­˜å‚¨å¼•æ“è¡¨æ··ç”¨ã€‚å³ä½¿æœ‰äº›æ“ä½œç³»ç»Ÿé™åˆ¶æ–‡ä»¶å¤§å°ä¸º2GBï¼ŒInnoDBä»ç„¶å¯ä»¥å¤„ç†ã€‚<code>å½“å¤„ç†å¤§æ•°æ®é‡æ—¶ï¼ŒInnoDBå…¼é¡¾CPUï¼Œä»¥è¾¾åˆ°æœ€å¤§æ€§èƒ½ã€‚</code></p><blockquote><p>2ã€InnoDBå’ŒACIDæ¨¡å‹</p></blockquote><p>ACIDæ¨¡å‹æ˜¯ä¸€ç³»åˆ—æ•°æ®åº“è®¾è®¡è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ç€é‡å¼ºè°ƒå¯é æ€§ï¼Œè€Œå¯é æ€§å¯¹äºå•†ä¸šæ•°æ®å’Œä»»åŠ¡å…³é”®å‹åº”ç”¨éå¸¸é‡è¦ã€‚MySQLåŒ…å«ç±»ä¼¼InnoDBå­˜å‚¨å¼•æ“çš„ç»„ä»¶ï¼Œä¸ACIDæ¨¡å‹ç´§å¯†ç›¸è¿ï¼Œè¿™æ ·å‡ºç°æ„å¤–æ—¶ï¼Œæ•°æ®ä¸ä¼šå´©æºƒï¼Œç»“æœä¸ä¼šå¤±çœŸã€‚å¦‚æœä¾èµ–ACIDæ¨¡å‹ï¼Œå¯ä»¥ä¸ä½¿ç”¨ä¸€è‡´æ€§æ£€æŸ¥å’Œå´©æºƒæ¢å¤æœºåˆ¶ã€‚å¦‚æœæ‹¥æœ‰é¢å¤–çš„è½¯ä»¶ä¿æŠ¤ï¼Œæå¯é çš„ç¡¬ä»¶æˆ–è€…åº”ç”¨å¯ä»¥å®¹å¿ä¸€å°éƒ¨åˆ†çš„æ•°æ®ä¸¢å¤±å’Œä¸ä¸€è‡´ï¼Œå¯ä»¥å°†MySQLè®¾ç½®è°ƒæ•´ä¸ºåªä¾èµ–éƒ¨åˆ†ACIDç‰¹æ€§ï¼Œä»¥è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½ã€‚ä¸‹é¢è®²è§£InnoDBå­˜å‚¨å¼•æ“ä¸ACIDæ¨¡å‹ç›¸åŒä½œç”¨çš„å››ä¸ªæ–¹é¢ã€‚</p><div class="tabs" id="8e9b218f-011e-4c55-bc56-637a8c82aaeb"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#8e9b218f-011e-4c55-bc56-637a8c82aaeb-1"><i class="fas fa-seedling"></i>åŸå­æ–¹é¢</button></li><li class="tab"><button type="button" data-href="#8e9b218f-011e-4c55-bc56-637a8c82aaeb-2"><i class="fas fa-leaf"></i>ä¸€è‡´æ€§æ–¹é¢</button></li><li class="tab"><button type="button" data-href="#8e9b218f-011e-4c55-bc56-637a8c82aaeb-3"><i class="fab fa-apple"></i>éš”ç¦»æ–¹é¢</button></li><li class="tab"><button type="button" data-href="#8e9b218f-011e-4c55-bc56-637a8c82aaeb-4"><i class="fas fa-tree"></i>è€ä¹…æ€§æ–¹é¢</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="8e9b218f-011e-4c55-bc56-637a8c82aaeb-1"><p>ACIDçš„åŸå­æ–¹é¢ä¸»è¦æ¶‰åŠInnoDBäº‹åŠ¡ï¼Œä¸MySQLç›¸å…³çš„ç‰¹æ€§ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>è‡ªåŠ¨æäº¤è®¾ç½®ã€‚</li><li>COMMITè¯­å¥ã€‚</li><li>ROLLBACKè¯­å¥ã€‚</li><li>æ“ä½œINFORMATION_SCHEMAåº“ä¸­çš„è¡¨æ•°æ®ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8e9b218f-011e-4c55-bc56-637a8c82aaeb-2"><p>ACIDæ¨¡å‹çš„ä¸€è‡´æ€§ä¸»è¦æ¶‰åŠä¿æŠ¤æ•°æ®ä¸å´©æºƒçš„å†…éƒ¨InnoDBå¤„ç†è¿‡ç¨‹ï¼Œä¸MySQLç›¸å…³çš„ç‰¹æ€§ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>InnoDBåŒå†™ç¼“å­˜ã€‚</li><li>InnoDBå´©æºƒæ¢å¤ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8e9b218f-011e-4c55-bc56-637a8c82aaeb-3"><p>éš”ç¦»æ˜¯åº”ç”¨äºäº‹åŠ¡çš„çº§åˆ«ï¼Œä¸MySQLç›¸å…³çš„ç‰¹æ€§ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>è‡ªåŠ¨æäº¤è®¾ç½®ã€‚</li><li>SET ISOLATION LEVELè¯­å¥ã€‚</li><li>InnoDBé”çš„ä½çº§åˆ«ä¿¡æ¯ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8e9b218f-011e-4c55-bc56-637a8c82aaeb-4"><p>ACIDæ¨¡å‹çš„è€ä¹…æ€§ä¸»è¦æ¶‰åŠä¸ç¡¬ä»¶é…ç½®ç›¸äº’å½±å“çš„MySQLè½¯ä»¶ç‰¹æ€§ã€‚ç”±äºç¡¬ä»¶å¤æ‚å¤šæ ·åŒ–ï¼Œè€ä¹…æ€§æ–¹é¢æ²¡æœ‰å…·ä½“çš„è§„åˆ™å¯å¾ªã€‚ä¸MySQLç›¸å…³çš„ç‰¹æ€§æœ‰ï¼š</p><ul><li>InnoDBåŒå†™ç¼“å­˜ï¼Œé€šè¿‡innodb_doublewriteé…ç½®é¡¹é…ç½®ã€‚</li><li>é…ç½®é¡¹innodb_flush_log_at_trx_commitã€‚</li><li>é…ç½®é¡¹sync_binlogã€‚</li><li>é…ç½®é¡¹innodb_file_per_tableã€‚</li><li>å­˜å‚¨è®¾å¤‡çš„å†™å…¥ç¼“å­˜ã€‚</li><li>å­˜å‚¨è®¾å¤‡çš„å¤‡ç”¨ç”µæ± ç¼“å­˜ã€‚</li><li>è¿è¡ŒMySQLçš„æ“ä½œç³»ç»Ÿã€‚</li><li>æŒç»­çš„ç”µåŠ›ä¾›åº”ã€‚</li><li>å¤‡ä»½ç­–ç•¥ã€‚</li><li>å¯¹åˆ†å¸ƒå¼æˆ–æ‰˜ç®¡çš„åº”ç”¨ï¼Œæœ€ä¸»è¦çš„åœ¨äºç¡¬ä»¶è®¾å¤‡çš„åœ°ç‚¹ä»¥åŠç½‘ç»œæƒ…å†µã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>3ã€InnoDBæ¶æ„</p></blockquote><ol><li><p>ç¼“å†²æ±  ç¼“å†²æ± æ˜¯ä¸»å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œç”¨æ¥ç¼“å­˜å·²ä½¿ç”¨çš„è¡¨å’Œç´¢å¼•æ•°æ®ã€‚ç¼“å†²æ± ä½¿å¾—ç»å¸¸è¢«ä½¿ç”¨çš„æ•°æ®èƒ½å¤Ÿç›´æ¥åœ¨å†…å­˜ä¸­è·å¾—ï¼Œä»è€Œæé«˜é€Ÿåº¦ã€‚</p></li><li><p>æ›´æ”¹ç¼“å­˜ æ›´æ”¹ç¼“å­˜æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå½“å—å½±å“çš„ç´¢å¼•é¡µä¸åœ¨ç¼“å­˜ä¸­æ—¶ï¼Œæ›´æ”¹ç¼“å­˜ä¼šç¼“å­˜è¾…åŠ©ç´¢å¼•é¡µçš„æ›´æ”¹ã€‚ç´¢å¼•é¡µè¢«å…¶ä»–è¯»å–æ“ä½œæ—¶ä¼šåŠ è½½åˆ°ç¼“å­˜æ± ï¼Œç¼“å­˜çš„æ›´æ”¹å†…å®¹å°±ä¼šè¢«åˆå¹¶ã€‚ä¸åŒäºé›†ç¾¤ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•å¹¶éç‹¬ä¸€æ— äºŒçš„ã€‚å½“ç³»ç»Ÿå¤§éƒ¨åˆ†é—²ç½®æ—¶ï¼Œæ¸…é™¤æ“ä½œä¼šå®šæœŸè¿è¡Œï¼Œå°†æ›´æ–°çš„ç´¢å¼•é¡µåˆ·å…¥ç£ç›˜ã€‚æ›´æ–°ç¼“å­˜åˆå¹¶æœŸé—´ï¼Œå¯èƒ½ä¼šå¤§å¤§é™ä½æŸ¥è¯¢çš„æ€§èƒ½ã€‚åœ¨å†…å­˜ä¸­ï¼Œæ›´æ–°ç¼“å­˜å ç”¨ä¸€éƒ¨åˆ†InnoDBç¼“å†²æ± ã€‚åœ¨ç£ç›˜ä¸­ï¼Œæ›´æ–°ç¼“å­˜æ˜¯ç³»ç»Ÿè¡¨ç©ºé—´çš„ä¸€éƒ¨åˆ†ã€‚æ›´æ–°ç¼“å­˜çš„æ•°æ®ç±»å‹ç”±innodb_change_bufferingé…ç½®é¡¹ç®¡ç†ã€‚</p></li><li><p>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼• è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•å°†è´Ÿè½½å’Œè¶³å¤Ÿçš„å†…å­˜ç»“åˆèµ·æ¥ï¼Œä½¿å¾—InnoDBåƒå†…å­˜æ•°æ®åº“ä¸€æ ·è¿è¡Œï¼Œä¸éœ€è¦é™ä½äº‹åŠ¡ä¸Šçš„æ€§èƒ½æˆ–å¯é æ€§ã€‚è¿™ä¸ªç‰¹æ€§é€šè¿‡innodb_adaptive_hash_indexé€‰é¡¹é…ç½®ï¼Œæˆ–è€…é€šè¿‡â€“skip-innodb_adaptive_hash_indexå‘½ä»¤è¡Œåœ¨æœåŠ¡å¯åŠ¨æ—¶å…³é—­ã€‚</p></li><li><p>é‡åšæ—¥å¿—ç¼“å­˜ é‡åšæ—¥å¿—ç¼“å­˜å­˜æ”¾è¦æ”¾å…¥é‡åšæ—¥å¿—çš„æ•°æ®ã€‚é‡åšæ—¥å¿—ç¼“å­˜å¤§å°é€šè¿‡innodb_log_buffer_sizeé…ç½®é¡¹é…ç½®ã€‚é‡åšæ—¥å¿—ç¼“å­˜ä¼šå®šæœŸåœ°å°†æ—¥å¿—æ–‡ä»¶åˆ·å…¥ç£ç›˜ã€‚å¤§å‹çš„é‡åšæ—¥å¿—ç¼“å­˜ä½¿å¾—å¤§å‹äº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸è¿è¡Œè€Œä¸éœ€è¦å†™å…¥ç£ç›˜ã€‚</p></li><li><p>ç³»ç»Ÿè¡¨ç©ºé—´ ç³»ç»Ÿè¡¨ç©ºé—´åŒ…æ‹¬InnoDBæ•°æ®å­—å…¸ã€åŒå†™ç¼“å­˜ã€æ›´æ–°ç¼“å­˜å’Œæ’¤é”€æ—¥å¿—ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬è¡¨å’Œç´¢å¼•æ•°æ®ã€‚å¤šè¡¨å…±äº«ï¼Œç³»ç»Ÿè¡¨ç©ºé—´è¢«è§†ä¸ºå…±äº«è¡¨ç©ºé—´ã€‚</p></li><li><p>åŒå†™ç¼“å­˜ åŒå†™ç¼“å­˜ä½äºç³»ç»Ÿè¡¨ç©ºé—´ä¸­ï¼Œç”¨äºå†™å…¥ä»ç¼“å­˜æ± åˆ·æ–°çš„æ•°æ®é¡µã€‚åªæœ‰åœ¨åˆ·æ–°å¹¶å†™å…¥åŒå†™ç¼“å­˜åï¼ŒInnoDBæ‰ä¼šå°†æ•°æ®é¡µå†™å…¥åˆé€‚çš„ä½ç½®ã€‚</p></li><li><p>æ’¤é”€æ—¥å¿— æ’¤é”€æ—¥å¿—æ˜¯ä¸€ç³»åˆ—ä¸äº‹åŠ¡ç›¸å…³çš„æ’¤é”€è®°å½•çš„é›†åˆï¼ŒåŒ…å«å¦‚ä½•æ’¤é”€äº‹åŠ¡æœ€è¿‘çš„æ›´æ”¹ã€‚å¦‚æœå…¶ä»–äº‹åŠ¡è¦æŸ¥è¯¢åŸå§‹æ•°æ®ï¼Œå¯ä»¥ä»æ’¤é”€æ—¥å¿—è®°å½•ä¸­è¿½æº¯æœªæ›´æ”¹çš„æ•°æ®ã€‚æ’¤é”€æ—¥å¿—å­˜åœ¨äºæ’¤é”€æ—¥å¿—ç‰‡æ®µä¸­ï¼Œè¿™äº›ç‰‡æ®µåŒ…å«äºå›æ»šç‰‡æ®µä¸­ã€‚</p></li><li><p>æ¯ä¸ªè¡¨ä¸€ä¸ªæ–‡ä»¶çš„è¡¨ç©ºé—´ æ¯ä¸ªè¡¨ä¸€ä¸ªæ–‡ä»¶çš„è¡¨ç©ºé—´æ˜¯æŒ‡æ¯ä¸ªå•ç‹¬çš„è¡¨ç©ºé—´åˆ›å»ºåœ¨è‡ªèº«çš„æ•°æ®æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ã€‚è¿™ä¸ªåŠŸèƒ½é€šè¿‡innodb_file_per_tableé…ç½®é¡¹å¼€å¯ã€‚æ¯ä¸ªè¡¨ç©ºé—´ç”±ä¸€ä¸ªå•ç‹¬çš„.ibdæ•°æ®æ–‡ä»¶ä»£è¡¨ï¼Œè¯¥æ–‡ä»¶é»˜è®¤è¢«åˆ›å»ºåœ¨æ•°æ®åº“ç›®å½•ä¸­ã€‚</p></li><li><p>é€šç”¨è¡¨ç©ºé—´ ä½¿ç”¨CREATE TABLESPACEè¯­æ³•åˆ›å»ºå…±äº«çš„InnoDBè¡¨ç©ºé—´ã€‚é€šç”¨è¡¨ç©ºé—´å¯ä»¥åˆ›å»ºåœ¨MySQLæ•°æ®ç›®å½•ä¹‹å¤–èƒ½å¤Ÿç®¡ç†å¤šä¸ªè¡¨å¹¶æ”¯æŒæ‰€æœ‰è¡Œæ ¼å¼çš„è¡¨ã€‚</p></li><li><p>æ’¤é”€è¡¨ç©ºé—´ æ’¤é”€è¡¨ç©ºé—´ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…å«æ’¤é”€æ—¥å¿—çš„æ–‡ä»¶ç»„æˆã€‚æ’¤é”€è¡¨ç©ºé—´çš„æ•°é‡ç”±innodb_undo_tablespacesé…ç½®é¡¹é…ç½®ã€‚</p></li><li><p>ä¸´æ—¶è¡¨ç©ºé—´ ç”¨æˆ·åˆ›å»ºçš„ä¸´æ—¶è¡¨ç©ºé—´å’ŒåŸºäºç£ç›˜çš„å†…éƒ¨ä¸´æ—¶è¡¨éƒ½åˆ›å»ºäºä¸´æ—¶è¡¨ç©ºé—´ã€‚innodb_temp_data_file_pathé…ç½®é¡¹å®šä¹‰äº†ç›¸å…³çš„è·¯å¾„ã€åç§°ã€å¤§å°å’Œå±æ€§ã€‚å¦‚æœè¯¥å€¼ä¸ºç©ºï¼Œé»˜è®¤ä¼šåœ¨innodb_data_home_dirå˜é‡æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨æ‰©å±•çš„æ•°æ®æ–‡ä»¶ã€‚</p></li><li><p>é‡åšæ—¥å¿— é‡åšæ—¥å¿—æ˜¯åŸºäºç£ç›˜çš„æ•°æ®ç»“æ„ï¼Œåœ¨å´©æºƒæ¢å¤æœŸé—´ä½¿ç”¨ï¼Œç”¨æ¥çº æ­£æ•°æ®ã€‚æ­£å¸¸æ“ä½œæœŸé—´ï¼Œé‡åšæ—¥å¿—ä¼šå°†è¯·æ±‚æ•°æ®è¿›è¡Œç¼–ç ï¼Œè¿™äº›è¯·æ±‚ä¼šæ”¹å˜InnoDBè¡¨æ•°æ®ã€‚é‡åˆ°æ„å¤–å´©æºƒåï¼Œæœªå®Œæˆçš„æ›´æ”¹ä¼šè‡ªåŠ¨åœ¨åˆå§‹åŒ–æœŸé—´é‡æ–°è¿›è¡Œã€‚</p></li></ol>]]></content>
    
    
    <summary type="html">MySQLé€»è¾‘æ¶æ„ã€SQLæ‰§è¡Œæµç¨‹ã€å­˜å‚¨å¼•æ“</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://wuwawawa.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://wuwawawa.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>9.ThreadLocal</title>
    <link href="https://wuwawawa.github.io/posts/5ce1.html"/>
    <id>https://wuwawawa.github.io/posts/5ce1.html</id>
    <published>2023-04-05T11:30:22.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ThreadLocalç®€ä»‹">1. ThreadLocalç®€ä»‹</h2><h3 id="1-1-ThreadLocalæ˜¯ä»€ä¹ˆ">1.1 ThreadLocalæ˜¯ä»€ä¹ˆ</h3><p>ThreadLocalæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡ä¸æ­£å¸¸çš„å˜é‡ä¸åŒï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—® ThreadLocalå®ä¾‹çš„æ—¶å€™ï¼ˆé€šè¿‡å…¶getã€setæ–¹æ³•ï¼‰éƒ½æœ‰è‡ªå·±çš„ã€ç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰›æœ¬ã€‚ThreadLocalå®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ç§æœ‰é™æ€å­—æ®µï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯å¸Œæœ›å°†çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·IDæˆ–äº‹åŠ¡IDï¼‰ä¸çº¿ç¨‹å…³è”èµ·æ¥ã€‚</p><p>â‘ . ThreadLocalæœ¬åœ°çº¿ç¨‹å˜é‡,<span class='p green'>çº¿ç¨‹è‡ªå¸¦çš„å˜é‡å‰¯æœ¬</span>(å®ç°äº†æ¯ä¸€ä¸ªçº¿ç¨‹å‰¯æœ¬éƒ½æœ‰ä¸€ä¸ªä¸“å±çš„æœ¬åœ°å˜é‡,ä¸»è¦è§£å†³çš„å°±æ˜¯è®©æ¯ä¸€ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼,è‡ªå·±ç”¨è‡ªå·±çš„,ä¸è·Ÿåˆ«äººäº‰æŠ¢ã€‚é€šè¿‡ä½¿ç”¨get()å’Œset()æ–¹æ³•,è·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨çš„é—®é¢˜)</p><p>â‘¡. synchronizedæˆ–è€…lock,æœ‰ä¸ªç®¡ç†å‘˜,å¥½æ¯”,ç°åœ¨å¤§å®¶ç­¾åˆ°,å¤šä¸ªåŒå­¦(çº¿ç¨‹),ä½†æ˜¯åªæœ‰ä¸€åªç¬”,åªèƒ½åŒä¸€ä¸ªæ—¶é—´,åªæœ‰ä¸€ä¸ªçº¿ç¨‹(åŒå­¦)ç­¾åˆ°,åŠ é”(åŒæ­¥æœºåˆ¶æ˜¯ä»¥æ—¶é—´æ¢ç©ºé—´,æ‰§è¡Œæ—¶é—´ä¸ä¸€æ ·,ç±»ä¼¼äºæ’é˜Ÿ)</p><p>â‘¢. ThreadLocal,äººäººæœ‰ä»½,æ¯ä¸ªåŒå­¦æ‰‹ä¸Šéƒ½æœ‰ä¸€æ”¯ç¬”,è‡ªå·±ç”¨è‡ªå·±çš„,ä¸ç”¨å†åŠ é”æ¥ç»´æŒç§©åº(åŒæ­¥æœºåˆ¶æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´,ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä»½å˜é‡çš„å‰¯æœ¬,ä»è€Œå®ç°åŒæ—¶è®¿é—®,äº’ä¸å¹²æ‰°åŒæ—¶è®¿é—®,è‚¯å®šæ•ˆç‡é«˜å•Š)</p><hr><h3 id="1-2-apiä»‹ç»">1.2 apiä»‹ç»</h3><div class="tabs" id="8f937209-a42d-4813-b981-8b52eed9e500"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#8f937209-a42d-4813-b981-8b52eed9e500-1"><i class="fas fa-bug"></i>API</button></li><li class="tab"><button type="button" data-href="#8f937209-a42d-4813-b981-8b52eed9e500-2"><i class="fas fa-cannabis"></i>withInitialæºç åˆ†æ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="8f937209-a42d-4813-b981-8b52eed9e500-1"><p>â‘ .<code>protected T initialValue():initialValue()</code>:è¿”å›æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å½“å‰çº¿ç¨‹çš„&quot;åˆå§‹å€¼&quot;(å¯¹äºinitialValue()è¾ƒä¸ºè€æ—§,jdk1.8åˆåŠ å…¥äº†withInitial()æ–¹æ³•)</p><p>â‘¡.<code>static &lt;S&gt; ThreadLocal&lt;S&gt; withInitial(Supplier&lt;? extends S&gt; supplier)</code>:åˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡,å˜é‡çš„åˆå§‹å€¼æ˜¯é€šè¿‡è°ƒç”¨<code>get</code>æ–¹æ³•æ¥<code>Supplier</code>ã€‚</p><p>â‘¢.<code>T get()</code>:è¿”å›å½“å‰çº¿ç¨‹çš„æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å‰¯æœ¬ä¸­çš„å€¼</p><p>â‘£.<code>void set(T value)</code>:å°†å½“å‰çº¿ç¨‹çš„æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å‰¯æœ¬è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼</p><p>â‘¤.<code>void remove()</code>:åˆ é™¤æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å½“å‰çº¿ç¨‹çš„å€¼</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230405195310770.png" alt="image-20230405195310770" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="8f937209-a42d-4813-b981-8b52eed9e500-2"><p>è°ƒç”¨<code>static &lt;S&gt; ThreadLocal&lt;S&gt; withInitial(Supplier&lt;? extends S&gt; supplier)</code>åˆ›å»ºThreadLocalæ—¶</p><p>ä¾‹å¦‚ï¼š<code>ThreadLocal&lt;Integer&gt; threadLocal= ThreadLocal.withInitial(()-&gt;0);</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; ThreadLocal&lt;S&gt; <span class="title function_">withInitial</span><span class="params">(Supplier&lt;? extends S&gt; supplier)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuppliedThreadLocal</span>&lt;&gt;(supplier);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®åˆ™ï¼šè¿”å›äº†ThreadLocalçš„å­ç±»ï¼ŒThreadLocal çš„æ‰©å±•ï¼Œä»æŒ‡å®šçš„Supplierè·å–å…¶åˆå§‹å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">SuppliedThreadLocal</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">ThreadLocal</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Supplier&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; supplier;</span><br><span class="line"></span><br><span class="line">    SuppliedThreadLocal(Supplier&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; supplier) &#123;</span><br><span class="line">        <span class="built_in">this</span>.supplier = Objects.requireNonNull(supplier);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> T <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> supplier.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="1-3-ç¤ºä¾‹">1.3 ç¤ºä¾‹</h3><p>éœ€æ±‚ï¼š5ä¸ªé”€å”®å‘˜å–æˆ¿å­(ç›¸å½“äºäº”ä¸ªçº¿ç¨‹)ï¼Œå„è‡ªç‹¬ç«‹é”€å”®ï¼Œé›†å›¢é«˜å±‚åªå…³å¿ƒæ¯ä¸ªé”€å”®å‘˜å‡ºå”®å¤šå°‘å¥—æˆ¿å­ã€‚</p><div class="tabs" id="82428b19-8304-4700-bde9-f4ea56c0a683"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#82428b19-8304-4700-bde9-f4ea56c0a683-1"><i class="fas fa-award"></i>Houseç±»</button></li><li class="tab"><button type="button" data-href="#82428b19-8304-4700-bde9-f4ea56c0a683-2"><i class="fas fa-baseball-ball"></i>ç»Ÿè®¡</button></li><li class="tab"><button type="button" data-href="#82428b19-8304-4700-bde9-f4ea56c0a683-3"><i class="fas fa-bone"></i>çº æ­£</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="82428b19-8304-4700-bde9-f4ea56c0a683-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">House</span>&#123;</span><br><span class="line"></span><br><span class="line">    ThreadLocal&lt;Integer&gt; threadLocal= ThreadLocal.withInitial(()-&gt;<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saleHouse</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//T get():è¿”å›å½“å‰çº¿ç¨‹çš„æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å‰¯æœ¬ä¸­çš„å€¼ã€‚</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">value</span> <span class="operator">=</span> threadLocal.get();</span><br><span class="line">        value++;</span><br><span class="line">        <span class="comment">//void set(T value):å°†å½“å‰çº¿ç¨‹çš„æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å‰¯æœ¬è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚</span></span><br><span class="line">        threadLocal.set(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="82428b19-8304-4700-bde9-f4ea56c0a683-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">House</span> <span class="variable">house</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">House</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">5</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="type">int</span> size=<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">5</span>)+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=size;j++)&#123;</span><br><span class="line">                house.saleHouse();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;å…±è®¡å–å‡º:&quot;</span>+house.threadLocal.get());</span><br><span class="line">        &#125;,String.valueOf(i)).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1å…±è®¡å–å‡º:2</span></span><br><span class="line"><span class="comment">//2å…±è®¡å–å‡º:3</span></span><br><span class="line"><span class="comment">//4å…±è®¡å–å‡º:2</span></span><br><span class="line"><span class="comment">//3å…±è®¡å–å‡º:1</span></span><br><span class="line"><span class="comment">//5å…±è®¡å–å‡º:5</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="82428b19-8304-4700-bde9-f4ea56c0a683-3"><p>é˜¿é‡Œè§„èŒƒï¼šå¿…é¡»å›æ”¶è‡ªå®šä¹‰çš„ThreadLocalå˜é‡è®°å½•çš„å½“å‰çº¿ç¨‹çš„å€¼ï¼Œå°¤å…¶åœ¨<code>çº¿ç¨‹æ± åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹ç»å¸¸ä¼šè¢«å¤ç”¨</code>ï¼Œå¦‚æœä¸æ¸…ç†è‡ªå®šä¹‰çš„ThreadLocalå˜é‡ï¼Œå¯èƒ½ä¼šå½±å“åç»­ä¸šåŠ¡é€»è¾‘å’Œé€ æˆå†…å­˜æ³„éœ²ç­‰é—®é¢˜ã€‚å°½é‡åœ¨ä»£ç ä¸­ä½¿ç”¨try-finallyå—è¿›è¡Œå›æ”¶ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>æ€»ç»“</p><p>â‘ . å› ä¸ºæ¯ä¸ªThreadå†…æœ‰è‡ªå·±çš„å®ä¾‹å‰¯æœ¬ä¸”è¯¥å‰¯æœ¬åªç”±å½“å‰çº¿ç¨‹è‡ªå·±ä½¿ç”¨</p><p>â‘¡. æ—¢ç„¶å…¶ä»–Threadä¸å¯è®¿é—®,é‚£å°±ä¸å­˜åœ¨å¤šçº¿ç¨‹å…±äº«çš„é—®é¢˜</p><p>â‘¢. ç»Ÿä¸€è®¾ç½®åˆå§‹å€¼,ä½†æ˜¯æ¯ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªå€¼çš„ä¿®æ”¹éƒ½æ˜¯å„è‡ªçº¿ç¨‹äº’ç›¸ç‹¬ç«‹çš„</p><p>â‘£. åŠ å…¥synchronizedæˆ–è€…lockæ§åˆ¶çº¿ç¨‹çš„è®¿é—®é¡ºåº,è€ŒThreadLocaläººæ‰‹ä¸€ä»½,å¤§å®¶å„è‡ªå®‰å¥½,æ²¡å¿…è¦æŠ¢å¤º</p><hr><h2 id="2-ThreadLocalæºç åˆ†æ">2. ThreadLocalæºç åˆ†æ</h2><blockquote><p>Thread  |  ThreadLocal  |  ThreadLocalMap  å…³ç³»</p></blockquote><div class="tabs" id="aa9edaf1-e423-4c3e-92c4-7709665abd12"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#aa9edaf1-e423-4c3e-92c4-7709665abd12-1"><i class="fas fa-seedling"></i>â‘ . Threadå’ŒThreadLocal</button></li><li class="tab"><button type="button" data-href="#aa9edaf1-e423-4c3e-92c4-7709665abd12-2"><i class="fas fa-leaf"></i>â‘¡. ThreadLocalå’ŒThreadLocalMap</button></li><li class="tab"><button type="button" data-href="#aa9edaf1-e423-4c3e-92c4-7709665abd12-3"><i class="fab fa-apple"></i>æ€»ç»“</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="aa9edaf1-e423-4c3e-92c4-7709665abd12-1"><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/20210406191343536.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aa9edaf1-e423-4c3e-92c4-7709665abd12-2"><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230405210602560.png" alt="image-20230405210602560" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aa9edaf1-e423-4c3e-92c4-7709665abd12-3"><ul><li>Threadç±»ä¸­æœ‰ä¸€ä¸ªThreadLocal.ThreadLocalMap threadLocals = nullçš„å˜é‡,è¿™ä¸ªThreadLocalç›¸å½“äºæ˜¯Threadç±»å’ŒThreadLocalMapçš„æ¡¥æ¢,åœ¨ThreadLocalä¸­æœ‰é™æ€å†…éƒ¨ç±»ThreadLocalMap,ThreadLocalMapä¸­æœ‰Entryæ•°ç»„</li><li>å½“æˆ‘ä»¬ä¸ºthreadLocalå˜é‡èµ‹å€¼,å®é™…ä¸Šå°±æ˜¯ä»¥å½“å‰threadLocalå®ä¾‹ä¸ºkey,å€¼ä¸ºvalueçš„Entryå¾€è¿™ä¸ªthreadLocalMapä¸­å­˜æ”¾</li></ul><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230405210717894.png" alt="image-20230405210717894" style="zoom:50%;" /><p>ThreadLocalMapä»å­—é¢ä¸Šå°±å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªä¿å­˜ThreadLocalå¯¹è±¡çš„map(å…¶å®æ˜¯ä»¥ThreadLocalä¸ºKey)ï¼Œä¸è¿‡æ˜¯ç»è¿‡äº†ä¸¤å±‚åŒ…è£…çš„ThreadLocalå¯¹è±¡ã€‚</p><p>JVMå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªçº¿ç¨‹ç‰ˆçš„Map&lt;ThreadLocal,Value&gt;(é€šè¿‡ThreadLocalå¯¹è±¡çš„setæ–¹æ³•ï¼Œç»“æœæŠŠThreadLocalå¯¹è±¡è‡ªå·±å½“åškey, æ”¾è¿›äº† ThreadLoalMapä¸­),æ¯ä¸ªçº¿ç¨‹è¦ç”¨åˆ°è¿™ä¸ªTçš„æ—¶å€™ï¼Œç”¨å½“å‰çš„çº¿ç¨‹å»Mapé‡Œé¢è·å–ï¼Œé€šè¿‡è¿™æ ·è®©æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰äº†è‡ªå·±ç‹¬ç«‹çš„å˜é‡ï¼Œäººæ‰‹ä¸€ä»½ï¼Œç«äº‰æ¡ä»¶è¢«å½»åº•æ¶ˆé™¤ï¼Œåœ¨å¹¶å‘æ¨¡å¼ä¸‹æ˜¯ç»å¯¹å®‰å…¨çš„å˜é‡ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="2-1-setæ–¹æ³•è¯¦è§£">2.1 setæ–¹æ³•è¯¦è§£</h3><ul><li>â‘ . é¦–å…ˆè·å–å½“å‰çº¿ç¨‹,å¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªMap</li><li>â‘¡. å¦‚æœè·å–çš„Mapä¸ä¸ºç©º,åˆ™å°†å‚æ•°è®¾ç½®åˆ°Mapä¸­(å½“å‰ThreadLocalçš„å¼•ç”¨ä½œä¸ºkey)</li><li>â‘¢. å¦‚æœMapä¸ºç©º,åˆ™ç»™è¯¥çº¿ç¨‹åˆ›å»º Map,å¹¶è®¾ç½®åˆå§‹å€¼</li></ul><div class="tabs" id="fbb5bde0-61cc-47e4-92de-1a5fc5a605ae"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-1"><i class="fas fa-bug"></i>set(T value)</button></li><li class="tab"><button type="button" data-href="#fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-2"><i class="fas fa-cannabis"></i>getMap(Thread t)</button></li><li class="tab"><button type="button" data-href="#fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-3"><i class="fas fa-candy-cane"></i>createMap(Thread t, T firstValue)</button></li><li class="tab"><button type="button" data-href="#fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-4"><i class="fas fa-child"></i>ThreadLocalMap(ThreadLocal<?> firstKey, Object firstValue)</button></li><li class="tab"><button type="button" data-href="#fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-5"><i class="fas fa-dragon"></i>set(ThreadLocal<?> key, Object value)</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocalMap <span class="title function_">getMap</span><span class="params">(Thread t)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">createMap</span><span class="params">(Thread t, T firstValue)</span> &#123;</span><br><span class="line">    t.threadLocals = <span class="keyword">new</span> <span class="title class_">ThreadLocalMap</span>(<span class="built_in">this</span>, firstValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–table</span></span><br><span class="line">    table = <span class="keyword">new</span> <span class="title class_">Entry</span>[INITIAL_CAPACITY];</span><br><span class="line">    <span class="comment">//è®¡ç®—ç´¢å¼•(é‡ç‚¹ä»£ç )</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>);</span><br><span class="line">    <span class="comment">////è®¾ç½®å€¼</span></span><br><span class="line">    table[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(firstKey, firstValue);</span><br><span class="line">    size = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//è®¾ç½®é˜ˆå€¼</span></span><br><span class="line">    setThreshold(INITIAL_CAPACITY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="fbb5bde0-61cc-47e4-92de-1a5fc5a605ae-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;</span><br><span class="line"></span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    <span class="comment">//è®¡ç®—ç´¢å¼•</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//æ‰¾åˆ°keyå¯¹åº”çš„Entry</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">         e != <span class="literal">null</span>;</span><br><span class="line">         e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (k == key) &#123;</span><br><span class="line">            e.value = value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (k == <span class="literal">null</span>) &#123;</span><br><span class="line">            replaceStaleEntry(key, value, i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tab[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(key, value);</span><br><span class="line">    <span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> ++size;</span><br><span class="line">    <span class="keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)</span><br><span class="line">        rehash();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="2-2-getæ–¹æ³•è¯¦è§£">2.2 getæ–¹æ³•è¯¦è§£</h3><p>å…ˆè·å–å½“å‰çº¿ç¨‹çš„ThreadLocalMapå˜é‡,å¦‚æœå­˜åœ¨åˆ™è¿”å›å€¼,ä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶è¿”å›åˆå§‹å€¼</p><div class="tabs" id="f87e3815-791e-4062-bb4f-336b351895d4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#f87e3815-791e-4062-bb4f-336b351895d4-1"><i class="fas fa-atom"></i>get()</button></li><li class="tab"><button type="button" data-href="#f87e3815-791e-4062-bb4f-336b351895d4-2"><i class="far fa-sun"></i>setInitialValue()</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="f87e3815-791e-4062-bb4f-336b351895d4-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰çº¿ç¨‹ä¸­ä¿å­˜ThreadLocalçš„å€¼</span></span><br><span class="line"><span class="comment"> * å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰æ­¤ThreadLocalå˜é‡,</span></span><br><span class="line"><span class="comment"> * åˆ™å®ƒä¼šé€šè¿‡è°ƒç”¨&#123;<span class="doctag">@link</span> #initialValue&#125; æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›å½“å‰çº¿ç¨‹å¯¹åº”æ­¤ThreadLocalçš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="comment">// å¦‚æœæ­¤mapå­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ä»¥å½“å‰çš„ThreadLocal ä¸º key,è°ƒç”¨getEntryè·å–å¯¹åº”çš„å­˜å‚¨å®ä½“e</span></span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">// å¯¹eè¿›è¡Œåˆ¤ç©º</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="comment">// è·å–å­˜å‚¨å®ä½“ e å¯¹åº”çš„ valueå€¼</span></span><br><span class="line">            <span class="comment">// å³ä¸ºæˆ‘ä»¬æƒ³è¦çš„å½“å‰çº¿ç¨‹å¯¹åº”æ­¤ThreadLocalçš„å€¼</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ– : æœ‰ä¸¤ç§æƒ…å†µæœ‰æ‰§è¡Œå½“å‰ä»£ç </span></span><br><span class="line"><span class="comment">     * ç¬¬ä¸€ç§æƒ…å†µ: mapä¸å­˜åœ¨,è¡¨ç¤ºæ­¤çº¿ç¨‹æ²¡æœ‰ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * ç¬¬äºŒç§æƒ…å†µ: mapå­˜åœ¨, ä½†æ˜¯æ²¡æœ‰ä¸å½“å‰ThreadLocalå…³è”çš„entry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f87e3815-791e-4062-bb4f-336b351895d4-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the initial value åˆå§‹åŒ–åçš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> T <span class="title function_">setInitialValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨initialValueè·å–åˆå§‹åŒ–çš„å€¼</span></span><br><span class="line">    <span class="comment">// æ­¤æ–¹æ³•å¯ä»¥è¢«å­ç±»é‡å†™, å¦‚æœä¸é‡å†™é»˜è®¤è¿”å›null</span></span><br><span class="line">    <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> initialValue();</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­mapæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">// å­˜åœ¨åˆ™è°ƒç”¨map.setè®¾ç½®æ­¤å®ä½“entry</span></span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// 1)å½“å‰çº¿ç¨‹Thread ä¸å­˜åœ¨ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">        <span class="comment">// 2)åˆ™è°ƒç”¨createMapè¿›è¡ŒThreadLocalMapå¯¹è±¡çš„åˆå§‹åŒ–</span></span><br><span class="line">        <span class="comment">// 3)å¹¶å°† t(å½“å‰çº¿ç¨‹)å’Œvalue(tå¯¹åº”çš„å€¼)ä½œä¸ºç¬¬ä¸€ä¸ªentryå­˜æ”¾è‡³ThreadLocalMapä¸­</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">    <span class="comment">// è¿”å›è®¾ç½®çš„å€¼value</span></span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h3 id="2-3-removeæ–¹æ³•è¯¦è§£">2.3 removeæ–¹æ³•è¯¦è§£</h3><ul><li>â‘ . é¦–å…ˆè·å–å½“å‰çº¿ç¨‹,å¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªMap</li><li>â‘¡. å¦‚æœè·å–çš„Mapä¸ä¸ºç©º,åˆ™ç§»é™¤å½“å‰ThreadLocalå¯¹è±¡å¯¹åº”çš„entry</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤å½“å‰çº¿ç¨‹ä¸­ä¿å­˜çš„ThreadLocalå¯¹åº”çš„å®ä½“entry</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">m</span> <span class="operator">=</span> getMap(Thread.currentThread());</span><br><span class="line">    <span class="comment">// å¦‚æœæ­¤mapå­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (m != <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">// å­˜åœ¨åˆ™è°ƒç”¨map.remove</span></span><br><span class="line">        <span class="comment">// ä»¥å½“å‰ThreadLocalä¸ºkeyåˆ é™¤å¯¹åº”çš„å®ä½“entry</span></span><br><span class="line">        m.remove(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-ThreadLocalå†…å­˜æ³„æ¼é—®é¢˜">3. ThreadLocalå†…å­˜æ³„æ¼é—®é¢˜</h2><blockquote><p>ä¸ºä»€ä¹ˆEntryä½¿ç”¨å¼±å¼•ç”¨?</p></blockquote><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230405233131908.png" alt="image-20230405233131908" style="zoom:50%;" /><div class="tabs" id="82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2-1"><i class="fas fa-award"></i>1</button></li><li class="tab"><button type="button" data-href="#82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2-2"><i class="fas fa-baseball-ball"></i>2</button></li><li class="tab"><button type="button" data-href="#82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2-3"><i class="fas fa-bone"></i>3</button></li><li class="tab"><button type="button" data-href="#82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2-4"><i class="fas fa-anchor"></i>æ¸…é™¤è„Entry</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">function01</span><span class="params">()</span>&#123;</span><br><span class="line">    ThreadLocal&lt;String&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();  <span class="comment">//line1</span></span><br><span class="line">    tl.set(<span class="string">&quot;LuckyBoy&quot;</span>);                            <span class="comment">//line2</span></span><br><span class="line">    tl.get();                                      <span class="comment">//line3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>line1æ–°å»ºäº†ä¸€ä¸ªThreadLocalå¯¹è±¡ï¼Œtlæ˜¯å¼ºå¼•ç”¨æŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼›</p><p>line2è°ƒç”¨set()æ–¹æ³•åæ–°å»ºä¸€ä¸ªEntryï¼Œé€šè¿‡æºç å¯çŸ¥Entryå¯¹è±¡é‡Œçš„kæ˜¯å¼±å¼•ç”¨æŒ‡å‘è¿™ä¸ªå¯¹è±¡ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230405230616586.png" alt="image-20230405230616586" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2-2"><p>å½“fumction1æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œæ ˆå¸§é”€æ¯å¼ºå¼•ç”¨tlä¹Ÿå°±æ²¡æœ‰äº†ã€‚ä½†æ­¤æ—¶çº¿ç¨‹çš„ ThreadLocalMapé‡ŒæŸä¸ªentryçš„keyå¼•ç”¨è¿˜æŒ‡å‘è¿™ä¸ªå¯¹è±¡</p><p>è‹¥è¿™ä¸ªkeyå¼•ç”¨æ˜¯å¼ºå¼•ç”¨ï¼Œæ–­äº†ä¸€ä¸ªå¼ºå¼•ç”¨è¿˜ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå°±ä¼šå¯¼è‡´keyæŒ‡å‘çš„ThreadLocalå¯¹è±¡åŠvæŒ‡å‘çš„å¯¹è±¡ä¸èƒ½è¢«gcå›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ï¼›</p><p>è‹¥è¿™ä¸ªkeyå¼•ç”¨æ˜¯å¼±å¼•ç”¨å°±å¤§æ¦‚ç‡ä¼šå‡å°‘å†…å­˜æ³„æ¼çš„é—®é¢˜(è¿˜æœ‰ä¸€ä¸ªkeyä¸ºnulçš„é›·ï¼Œç¬¬2ä¸ªå‘åé¢è®²)ã€‚</p><p>ä½¿ç”¨å¼±å¼•ç”¨ï¼Œ å°±å¯ä»¥ä½¿<code>ThreadLocalå¯¹è±¡</code>åœ¨æ–¹æ³•æ‰§è¡Œå®Œååé¡ºåˆ©è¢«å›æ”¶ä¸”Entryçš„keyå¼•ç”¨æŒ‡å‘ä¸ºnullã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2-3"><p>â‘ . ThreadLocalMapä½¿ç”¨ThreadLocalçš„å¼±å¼•ç”¨ä½œä¸ºkey,å¦‚æœä¸€ä¸ªThreadLocalæ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨å¼•ç”¨ä»–,é‚£ä¹ˆç³»ç»Ÿgcçš„æ—¶å€™,è¿™ä¸ªThreadLocalåŠ¿å¿…ä¼šè¢«å›æ”¶,è¿™æ ·ä¸€æ¥,ThreadLocalMapä¸­å°±ä¼šå‡ºç°keyä¸ºnullçš„Entry,å°±æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›keyä¸ºnullçš„Entryçš„value,å¦‚æœå½“å‰çº¿ç¨‹å†è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯(æ¯”å¦‚æ­£å¥½ç”¨åœ¨çº¿ç¨‹æ± ),è¿™äº›keyä¸ºnullçš„Entryçš„valueå°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼ºå¼•ç”¨é“¾</p><p>â‘¡. è™½ç„¶å¼±å¼•ç”¨,ä¿è¯äº†keyæŒ‡å‘çš„ThreadLocalå¯¹è±¡èƒ½è¢«åŠæ—¶å›æ”¶,ä½†æ˜¯væŒ‡å‘çš„valueå¯¹è±¡æ˜¯éœ€è¦ThreadLocalMapè°ƒç”¨getã€setæ—¶å‘ç°keyä¸ºnullæ—¶æ‰ä¼šå»å›æ”¶æ•´ä¸ªentryã€value</p><p>â‘¢. å› æ­¤å¼±å¼•ç”¨ä¸èƒ½100%ä¿è¯å†…å­˜ä¸æ³„éœ²ã€‚æˆ‘ä»¬è¦åœ¨ä¸ä½¿ç”¨æŸä¸ªThreadLocalå¯¹è±¡å,æ‰‹åŠ¨è°ƒç”¨remoevæ–¹æ³•æ¥åˆ é™¤å®ƒ,å°¤å…¶æ˜¯åœ¨çº¿ç¨‹æ± ä¸­,ä¸ä»…ä»…æ˜¯å†…å­˜æ³„éœ²çš„é—®é¢˜,å› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯é‡å¤ä½¿ç”¨çš„,æ„å‘³ç€è¿™ä¸ªçº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡ä¹Ÿæ˜¯é‡å¤ä½¿ç”¨çš„,å¦‚æœæˆ‘ä»¬ä¸æ‰‹åŠ¨è°ƒç”¨removeæ–¹æ³•,é‚£ä¹ˆåé¢çš„çº¿ç¨‹å°±æœ‰å¯èƒ½è·å–åˆ°ä¸Šä¸ªçº¿ç¨‹é—ç•™ä¸‹æ¥çš„valueå€¼,é€ æˆbug</p><p>â‘£. å¦‚æœå½“å‰threadè¿è¡Œç»“æŸ,threadLocal,threadLocalMap, Entryæ²¡æœ‰å¼•ç”¨é“¾å¯è¾¾,åœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™éƒ½ä¼šè¢«ç³»ç»Ÿè¿›è¡Œå›æ”¶</p><p>â‘¤. ä½†åœ¨å®é™…ä½¿ç”¨ä¸­æˆ‘ä»¬æœ‰æ—¶å€™ä¼šç”¨çº¿ç¨‹æ± å»ç»´æŠ¤æˆ‘ä»¬çš„çº¿ç¨‹,æ¯”å¦‚åœ¨Executors.newFixedThreadPool()æ—¶åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™,ä¸ºäº†å¤ç”¨çº¿ç¨‹æ˜¯ä¸ä¼šç»“æŸçš„,æ‰€ä»¥threadLocalå†…å­˜æ³„æ¼å°±å€¼å¾—æˆ‘ä»¬å°å¿ƒ</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="82c55e9f-4744-4f2e-8b2e-2aeb23d58dc2-4"><p>ä»å‰é¢çš„set,getEntry,remove æ–¹æ³•çœ‹å‡ºï¼Œåœ¨threadLocalçš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œé’ˆå¯¹threadLocalå­˜åœ¨çš„å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œ éƒ½ä¼šé€šè¿‡expungeStaleEntry, cleanSomeSlots,replace StaleEntryè¿™ä¸‰ä¸ªæ–¹æ³•æ¸…ç†æ‰keyä¸ºFulçš„è„entryã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h2 id="4-ThreadLocalå°æ€»ç»“">4. ThreadLocalå°æ€»ç»“</h2><p>â‘ . ThreadLocal å¹¶ä¸è§£å†³çº¿ç¨‹é—´å…±äº«æ•°æ®çš„é—®é¢˜</p><p>â‘¡. ThreadLocal é€‚ç”¨äºå˜é‡åœ¨çº¿ç¨‹é—´éš”ç¦»ä¸”åœ¨æ–¹æ³•é—´å…±äº«çš„åœºæ™¯</p><p>â‘¢. ThreadLocal é€šè¿‡éšå¼çš„åœ¨ä¸åŒçº¿ç¨‹å†…åˆ›å»ºç‹¬ç«‹å®ä¾‹å‰¯æœ¬é¿å…äº†å®ä¾‹çº¿ç¨‹å®‰å…¨çš„é—®é¢˜æ¯ä¸ªçº¿ç¨‹æŒæœ‰ä¸€ä¸ªåªå±äºè‡ªå·±çš„ä¸“å±Mapå¹¶ç»´æŠ¤äº†ThreadLocalå¯¹è±¡ä¸å…·ä½“å®ä¾‹çš„æ˜ å°„ï¼Œ è¯¥Mapç”±äºåªè¢«æŒæœ‰å®ƒçš„çº¿ç¨‹è®¿é—®ï¼Œæ•…ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨ä»¥åŠé”çš„é—®é¢˜</p><p>â‘£. ThreadLocalMapçš„Entryå¯¹ ThreadLocalçš„çš„å¼•ç”¨ä¸ºå¼±å¼•ç”¨ï¼Œé¿å…äº†ThreadLocalå¯¹è±¡æ— æ³•è¢«å›æ”¶çš„é—®é¢˜</p><p>â‘¤. ç”¨å®Œä¹‹åä¸€å®šè¦removeæ“ä½œ</p>]]></content>
    
    
    <summary type="html">ThreadLocal</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="JUC" scheme="https://wuwawawa.github.io/tags/JUC/"/>
    
  </entry>
  
  <entry>
    <title>8.CompletableFuture</title>
    <link href="https://wuwawawa.github.io/posts/2400b711.html"/>
    <id>https://wuwawawa.github.io/posts/2400b711.html</id>
    <published>2023-04-05T02:10:27.000Z</published>
    <updated>2023-04-18T06:20:49.224Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Future">1. Future</h2><p>Futureæ˜¯Java5æ–°åŠ çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›äº†ä¸€ç§å¼‚æ­¥å¹¶è¡Œè®¡ç®—çš„åŠŸèƒ½ã€‚å¦‚æœä¸»çº¿ç¨‹éœ€è¦æ‰§è¡Œä¸€ä¸ªå¾ˆè€—æ—¶çš„è®¡ç®—ä»»åŠ¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡FutureæŠŠè¿™ä¸ªä»»åŠ¡æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ä¸»çº¿ç¨‹ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡æˆ–è€…å…ˆè¡Œç»“æŸï¼Œå†é€šè¿‡Futureè·å–è®¡ç®—ç»“æœã€‚</p><p>Futureæ¥å£(FutureTaskå®ç°ç±»)å®šä¹‰äº†æ“ä½œå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œå¦‚è·å–å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œã€åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆã€åˆ¤æ–­ä»»åŠ¡æ‰§è¡Œæ˜¯å¦å®Œæ¯•ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°è¯•å–æ¶ˆæ‰§è¡Œæ­¤ä»»åŠ¡</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">cancel</span><span class="params">(<span class="type">boolean</span> mayInterruptIfRunning)</span>;</span><br><span class="line"><span class="comment">//åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isCancelled</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">//åˆ¤æ–­ä»»åŠ¡æ‰§è¡Œæ˜¯å¦å®Œæ¯•</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isDone</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">//è·å–å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">V <span class="title function_">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException;</span><br><span class="line"><span class="comment">//å¸¦è¶…æ—¶æ—¶é—´è·å–ä»»åŠ¡ç»“æœ</span></span><br><span class="line">V <span class="title function_">get</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span></span><br><span class="line">       <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸»çº¿ç¨‹è®©ä¸€ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå­çº¿ç¨‹å¯èƒ½æ¯”è¾ƒè€—æ—¶ï¼Œå¯åŠ¨å­çº¿ç¨‹å¼€å§‹æ‰§è¡Œä»»åŠ¡åï¼Œ ä¸»çº¿ç¨‹å°±å»åšå…¶ä»–äº‹æƒ…äº†ï¼Œå¿™å…¶å®ƒäº‹æƒ…æˆ–è€…å…ˆæ‰§è¡Œå®Œï¼Œè¿‡äº†ä¸€ä¼šæ‰å»è·å–å­ä»»åŠ¡çš„æ‰§è¡Œç»“æœæˆ–å˜æ›´çš„ä»»åŠ¡çŠ¶æ€ã€‚<code>Futureæ¥å£å¯ä»¥ä¸ºä¸»çº¿ç¨‹å¼€ä¸€ä¸ªåˆ†æ”¯ä»»åŠ¡ï¼Œä¸“é—¨ä¸ºä¸»çº¿ç¨‹å¤„ç†è€—æ—¶å’Œè´¹åŠ›çš„å¤æ‚ä¸šåŠ¡ã€‚</code></p><p>eg.æ¯”å¦‚ä¸»çº¿ç¨‹è®©ä¸€ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå­çº¿ç¨‹å¯èƒ½æ¯”è¾ƒè€—æ—¶ï¼Œå¯åŠ¨å­çº¿ç¨‹å¼€å§‹æ‰§è¡Œä»»åŠ¡åï¼Œä¸»çº¿ç¨‹å°±å»åšå…¶ä»–äº‹æƒ…äº†ï¼Œè¿‡äº†ä¸€ä¼šæ‰å»è·å–å­ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚è€å¸ˆåœ¨ä¸Šè¯¾ï¼Œä½†æ˜¯å£æ¸´ï¼Œäºæ˜¯è®©ç­é•¿è¿™ä¸ªçº¿ç¨‹å»ä¹°æ°´ï¼Œè‡ªå·±å¯ä»¥ç»§ç»­ä¸Šè¯¾ï¼Œå®ç°äº†å¼‚æ­¥ä»»åŠ¡ã€‚</p><h2 id="2-FutureTask">2. FutureTask</h2><h3 id="2-1-å¼•å…¥">2.1 å¼•å…¥</h3><p>å¼‚æ­¥å¤šçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œä¸”æœ‰è¿”å›ç»“æœï¼Œä¸‰ä¸ªç‰¹ç‚¹ï¼šå¤šçº¿ç¨‹/æœ‰è¿”å›/å¼‚æ­¥ä»»åŠ¡</p><div class="tabs" id="f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e-1"><i class="fas fa-atom"></i>å¤šçº¿ç¨‹</button></li><li class="tab"><button type="button" data-href="#f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e-2"><i class="far fa-sun"></i>æœ‰è¿”å›</button></li><li class="tab"><button type="button" data-href="#f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e-3"><i class="fas fa-wind"></i>å¼‚æ­¥ä»»åŠ¡</button></li><li class="tab"><button type="button" data-href="#f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e-4"><i class="fas fa-fire-alt"></i>ç»„åˆ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Mythread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Mythread1</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>Runnable æ¥å£ æ²¡æœ‰è¿”å›å€¼ , Callable æ¥å£æœ‰è¿”å›å€¼</p></li><li><p>Runnable æ¥å£ æœ‰æŠ›å¼‚å¸¸ , Callable æ¥å£æ²¡æœ‰æŠ›å¼‚å¸¸</p></li></ol><p><code>ä½†æ˜¯Callable æ¥å£ä¸èƒ½æ›¿æ¢ Runnable ï¼Œå› ä¸ºthread ç±»çš„æ„é€ æ–¹æ³•ä¸­æ ¹æœ¬å°±æ²¡æœ‰ Callable è¿™ä¸ªç±»å‹çš„å‚æ•°ï¼Œåªæœ‰Runnableç±»å‹å‚æ•° ï¼Œè¿™æ—¶æˆ‘ä»¬æ— æ³•ç›´æ¥ä½¿ç”¨ Callable æ¥å®ç°å¤šçº¿ç¨‹</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e-3"><p>å¼‚æ­¥ä»»åŠ¡å¯ä»¥é€šè¿‡å®ç°Futureæ¥å£å®ç°</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="f30d28f3-bc66-4e97-8cc5-b2b95bc89e3e-4"><p>å¦‚ä½•å®ç°å¤šçº¿ç¨‹/æœ‰è¿”å›/å¼‚æ­¥ä»»åŠ¡ æµç¨‹ä»¥åŠæ€æƒ³</p><ol><li>æˆ‘ä»¬æ— æ³•ç›´æ¥ä¼ å…¥ä¸€ä¸ª callable çš„æ¥å£ç±»å‹ , è¿™æ—¶éœ€è¦æ‰¾åˆ°ä¸€ä¸ªä¸­é—´äºº , å°†ä»–ä»¬è”ç³»èµ·æ¥</li><li>æˆ‘ä»¬çŸ¥é“ Thread ç±»ä¸­å¯ä»¥ä¼ å…¥ä¸€ä¸ª Runnable æ¥å£ , æ‰€ä»¥æ ¹æ®è¿™ä¸ªå°±å¯ä»¥ä¼ å…¥ Runnableçš„å®ç°å­ç±»æˆ–è€…æ˜¯Runnable çš„ä¸€äº›å­æ¥å£ , å¯ä»¥å‘ç°å®ƒæœ‰ä¸€ä¸ªå«åš RunnableFuture å­æ¥å£,è¿™ä¸ªå­æ¥å£è¿˜æœ‰ä¸€ä¸ªå®ç°å­ç±» å«åš FutureTask (ä¸­é—´äºº)</li><li>è¿™ä¸ª FutureTaskç±» , ä»–æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³• , FutureTask (Callable<V> callable) , è¿™æ—¶æˆ‘ä»¬å¯ä»¥å‘ç° , å®ƒèƒ½å¤Ÿä¼ å…¥ä¸€ä¸ª Callable æ¥å£ç±»å‹çš„å‚æ•°</li><li>è¿™æ—¶å°±è¿æ¥ä¸Šäº† , æˆ‘åœ¨ Thread ä¸­ä¼ å…¥ä¸€ä¸ª futureTask (ç›¸å½“äº Runnable çš„å­™å­)ï¼ŒThread å°±é—´æ¥æ€§çš„ è¾¾æˆäº†é€šè¿‡ä½¿ç”¨ Callable æ¥å£ + FutureTask æ¥å®ç°å¤šçº¿ç¨‹/æœ‰è¿”å›/å¼‚æ­¥ä»»åŠ¡è¿™ä¸‰ä¸ªç‰¹ç‚¹</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>FutureTask è§åçŸ¥æ„ : &quot; æœªæ¥çš„ä»»åŠ¡ &quot; , å°±æ˜¯ä½¿ç”¨å®ƒå°±å¤„ç†ä¸€ä»¶æ¯”è¾ƒå¤æ‚çš„äº‹æƒ… , å¼‚æ­¥è°ƒç”¨ , åœ¨ä¸å½±å“ä¸»çº¿ç¨‹çš„æ­£å¸¸æ‰§è¡Œçš„å‰æä¸‹ , å¦å¯ä¸€æ¡çº¿ç¨‹å»åšæŸäº›å¤æ‚è€—æ—¶çš„äº‹æƒ… , æœ€åå¤„ç†å®Œæˆååœ¨å’Œä¸»çº¿ç¨‹æ±‡æ€»ã€‚</p><p>åœ¨ä¸»çº¿ç¨‹ä¸­éœ€è¦æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ—¶ï¼Œä½†åˆä¸æƒ³é˜»å¡ä¸»çº¿ç¨‹æ—¶ï¼Œå¯ä»¥æŠŠè¿™äº›ä½œä¸šäº¤ç»™   FutureTask å¯¹è±¡ åœ¨åå°å®Œæˆ<br>å½“ä¸»çº¿ç¨‹å°†æ¥éœ€è¦æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ FutureTask å¯¹è±¡ è·å¾—åå°ä½œä¸šçš„è®¡ç®—ç»“æœæˆ–è€…æ‰§è¡ŒçŠ¶æ€ã€‚<br>ä¸€èˆ¬ FutureTask å¤šç”¨äºè€—æ—¶çš„è®¡ç®—ï¼Œä¸»çº¿ç¨‹å¯ä»¥åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡åï¼Œå†å»è·å–ç»“æœã€‚<br>ä»…åœ¨è®¡ç®—å®Œæˆæ—¶æ‰èƒ½æ£€ç´¢ç»“æœ , å¦‚æœè®¡ç®—å°šæœªå®Œæˆï¼Œåˆ™é˜»å¡ get æ–¹æ³•ã€‚ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œå°±ä¸èƒ½å†é‡æ–°å¼€å§‹æˆ–å–æ¶ˆè®¡ç®—ã€‚get æ–¹æ³•è·å–ç»“æœåªæœ‰åœ¨è®¡ç®—å®Œæˆæ—¶è·å–ï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡è½¬å…¥å®ŒæˆçŠ¶æ€ï¼Œç„¶åä¼šè¿”å›ç»“æœæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚åªè®¡ç®—ä¸€æ¬¡ , å› æ­¤éœ€è¦å°† get æ–¹æ³•æ”¾åˆ°æœ€å , å¦åˆ™ä¼šå‡ºç°é˜»å¡ã€‚</p><h3 id="2-2-ä¼˜ç¼ºç‚¹">2.2 ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹</strong></p><p>future+çº¿ç¨‹æ± å¼‚æ­¥å¤šçº¿ç¨‹ä»»åŠ¡é…åˆï¼Œèƒ½æ˜¾è‘—æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p><div class="tabs" id="codetabs4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#codetabs4-1"><i class="fas fa-seedling"></i>ä»£ç </button></li><li class="tab"><button type="button" data-href="#codetabs4-2"><i class="fas fa-leaf"></i>è¾“å‡º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="codetabs4-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">    <span class="type">long</span> startTime=System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;FutureTask&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        <span class="type">int</span> j=i;</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;task&quot;</span>+j+<span class="string">&quot; over&quot;</span>;</span><br><span class="line">        &#125;));</span><br><span class="line">        threadPool.submit(list.get(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    list.forEach((task)-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(task.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">long</span> endTime=System.currentTimeMillis();</span><br><span class="line">    System.out.println(endTime-startTime);</span><br><span class="line">    threadPool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="codetabs4-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">task0 over</span><br><span class="line">task1 over</span><br><span class="line">task2 over</span><br><span class="line"><span class="number">674</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>ç¼ºç‚¹</strong></p><div class="tabs" id="2c8e9a02-9d9d-44aa-bff5-5899faa336b8"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2c8e9a02-9d9d-44aa-bff5-5899faa336b8-1"><i class="fas fa-atom"></i>get()é˜»å¡</button></li><li class="tab"><button type="button" data-href="#2c8e9a02-9d9d-44aa-bff5-5899faa336b8-2"><i class="far fa-sun"></i>isDone()è½®è¯¢ç©ºè½¬</button></li><li class="tab"><button type="button" data-href="#2c8e9a02-9d9d-44aa-bff5-5899faa336b8-3"><i class="fas fa-fire-alt"></i>ç»“è®º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2c8e9a02-9d9d-44aa-bff5-5899faa336b8-1"><p>ä¸€æ—¦è°ƒç”¨get()æ–¹æ³•ï¼Œä¸ç®¡æ˜¯å¦è®¡ç®—å®Œæˆï¼Œéƒ½ä¼šå¯¼è‡´é˜»å¡ï¼ˆæ‰€ä»¥ä¸€èˆ¬getæ–¹æ³•æ”¾åˆ°æœ€åï¼‰</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2c8e9a02-9d9d-44aa-bff5-5899faa336b8-2"><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨Geté˜»å¡ï¼Œå¯ä»¥ç­‰ä»»åŠ¡ä»€ä¹ˆæ—¶å€™å®Œæˆäº†ï¼Œæˆ‘ä»¬å†Get</p><p>åˆ©ç”¨if(Task.isDone())çš„æ–¹å¼ä½¿å¾—ä»–åœ¨ç»“æŸä¹‹åæ‰get(),ä½†æ˜¯ä¹Ÿä¼šæ¶ˆè€—cpu</p><p>è½®è¯¢çš„æ–¹å¼ä¼šè€—è´¹æ— è°“çš„CPUèµ„æºï¼Œè€Œä¸”ä¹Ÿä¸è§å¾—èƒ½åŠæ—¶åœ°å¾—åˆ°è®¡ç®—ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(task.isDone())&#123;</span><br><span class="line">        System.out.println(task.get());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æš‚åœ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¤„ç†ä¸­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2c8e9a02-9d9d-44aa-bff5-5899faa336b8-3"><p>Futureå¯¹äºç»“æœçš„è·å–ä¸æ˜¯å¾ˆå‹å¥½ï¼Œåªèƒ½é€šè¿‡é˜»å¡æˆ–è½®è¯¢çš„æ–¹å¼å¾—åˆ°ä»»åŠ¡çš„ç»“æœã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h3 id="2-3-åº”ç”¨ç°çŠ¶">2.3 åº”ç”¨ç°çŠ¶</h3><p>å¯¹äºç®€å•çš„ä¸šåŠ¡åœºæ™¯ä½¿ç”¨Futureå®Œå…¨OKï¼Œä½†æ˜¯é¢å¯¹å¤æ‚çš„éœ€æ±‚ä¸‹ï¼Œä¾‹å¦‚ï¼š</p><ul><li><p>å›è°ƒé€šçŸ¥</p><p>åº”å¯¹Futureçš„å®Œæˆæ—¶é—´ï¼Œå®Œæˆäº†å¯ä»¥å‘Šè¯‰æˆ‘ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å›è°ƒé€šçŸ¥ã€‚é€šè¿‡è½®è¯¢çš„æ–¹å¼å»åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œè¿™æ ·éå¸¸å CPUå¹¶ä¸”ä»£ç ä¹Ÿä¸ä¼˜é›…</p></li><li><p>åˆ›å»ºå¼‚æ­¥ä»»åŠ¡</p><p>Future+çº¿ç¨‹æ± é…åˆ</p></li><li><p>å¤šä¸ªä»»åŠ¡å‰åä¾èµ–å¯ä»¥ç»„åˆ</p><p>æƒ³å°†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„è®¡ç®—ç»“æœç»„åˆèµ·æ¥ï¼Œåä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„è®¡ç®—ç»“æœéœ€è¦å‰ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„å€¼ï¼Œå°†ä¸¤ä¸ªæˆ–å¤šä¸ªå¼‚æ­¥è®¡ç®—åˆæˆä¸€ä¸ªå¼‚æ­¥è®¡ç®—ï¼Œè¿™å‡ ä¸ªå¼‚æ­¥è®¡ç®—ç›¸äº’ç‹¬ç«‹ï¼ŒåŒæ—¶åé¢è¿™ä¸ªåˆä¾èµ–å‰ä¸€ä¸ªå¤„ç†çš„ç»“æœã€‚æ¯”å¦‚ä¹°é±¼-åŠ æ–™-çƒ¹é¥ª</p></li><li><p>å¯¹è®¡ç®—é€Ÿåº¦é€‰æœ€å¿«</p><p>å½“Futureé›†åˆä¸­æŸä¸ªä»»åŠ¡æœ€å¿«ç»“æŸæ—¶ï¼Œè¿”å›ç»“æœï¼Œè¿”å›ç¬¬ä¸€åå¤„ç†ç»“æœã€‚</p></li><li><p>â€¦</p><p>ä½¿ç”¨Futureä¹‹å‰æä¾›çš„é‚£ç‚¹APIå°±å›Šä¸­ç¾æ¶©ï¼Œå¤„ç†èµ·æ¥ä¸å¤Ÿä¼˜é›…ï¼Œè¿™æ—¶å€™è¿˜æ˜¯è®©CompletableFutureä»¥å£°æ˜å¼çš„æ–¹å¼ä¼˜é›…çš„å¤„ç†è¿™äº›éœ€æ±‚ä»iåˆ°i++ï¼Œo(n_n)Oå“ˆå“ˆ~<br>Futureèƒ½å¹²çš„ï¼ŒCompletableFutureéƒ½èƒ½å¹²ã€‚</p></li></ul><h2 id="3-CompletableFuture">3. CompletableFuture</h2><h3 id="3-1-å¯¹Futureçš„æ”¹è¿›">3.1 å¯¹Futureçš„æ”¹è¿›</h3><p>get()æ–¹æ³•åœ¨Future è®¡ç®—å®Œæˆä¹‹å‰ä¼šä¸€ç›´å¤„åœ¨é˜»å¡çŠ¶æ€ä¸‹ï¼ŒisDone()æ–¹æ³•å®¹æ˜“è€—èµ€CPUèµ„æºï¼Œå¯¹äºçœŸæ­£çš„å¼‚æ­¥å¤„ç†æˆ‘ä»¬å¸Œæœ›æ˜¯å¯ä»¥é€šè¿‡ä¼ å…¥å›è°ƒå‡½æ•°ï¼Œåœ¨Futureç»“æŸæ—¶è‡ªåŠ¨è°ƒç”¨è¯¥å›è°ƒå‡½æ•°ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ç­‰å¾…ç»“æœã€‚</p><p><code>é˜»å¯¨çš„æ–¹å¼å’Œå¼‚æ­¥ç¼–ç¨‹çš„è®¾è®¡ç†å¿µç›¸è¿èƒŒï¼Œè€Œè½®è¯¢çš„æ–¹å¼ä¼šè€—è´¹æ— è°“çš„CPUèµ„æºã€‚</code></p><p>å› æ­¤ï¼Œ JDK8è®¾è®¡å‡ºCompletableFutureã€‚CompletableFutureæä¾›äº†ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼ç±»ä¼¼çš„æœºåˆ¶ï¼Œå¯ä»¥è®©ä»»åŠ¡æ‰§è¡Œå®Œæˆåé€šçŸ¥ç›‘å¬çš„ä¸€æ–¹ã€‚å®ƒæ˜¯Futureçš„åŠŸèƒ½å¢å¼ºç‰ˆï¼Œå‡å°‘é˜»å¡å’Œè½®è¯¢å¯ä»¥ä¼ å…¥å›è°ƒå¯¹è±¡ï¼Œå½“å¼‚æ­¥ä»»åŠ¡å®Œæˆæˆ–è€…å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨å›è°ƒå¯¹è±¡çš„å›è°ƒæ–¹æ³•ã€‚</p><hr><p>ç±»æ¶æ„</p><p>CompletableFutureåŒæ—¶å®ç°äº†ä¸¤ä¸ªæ¥å£CompletionStageæ¥å£å’ŒFutureæ¥å£ã€‚</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230405132328616.png" alt="image-20230405132328616" style="zoom:50%;" /><p>Completionstageä»£è¡¨å¼‚æ­¥è®¡ç®—è¿‡ç¨‹ä¸­çš„æŸä¸€ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªé˜¶æ®µå®Œæˆä»¥åå¯èƒ½ä¼šè§¦å‘å¦å¤–ä¸€ä¸ªé˜¶æ®µã€‚</p><p>ä¸€ä¸ªé˜¶æ®µçš„è®¡ç®—æ‰§è¡Œå¯ä»¥æ˜¯ä¸€ä¸ªFunction,Consumeræˆ–è€…Runnableã€‚æ¯”å¦‚ï¼š<code>stage.thenApply(x-&gt;square(x)).thenAccept (x -&gt; System.out.print(x)).thenRun(()-&gt; System.out.println())</code></p><p>ä¸€ä¸ªé˜¶æ®µçš„æ‰§è¡Œå¯èƒ½æ˜¯è¢«å•ä¸ªé˜¶æ®µçš„å®Œæˆè§¦å‘ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”±å¤šä¸ªé˜¶æ®µä¸€èµ·è§¦å‘</p><hr><p>åœ¨Java8ä¸­ï¼ŒCompletableFutureæä¾›äº†éå¸¸å¼ºå¤§çš„Futureçš„æ‰©å±•åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œå¹¶ä¸”æä¾›äº†å‡½æ•°å¼ç¼–ç¨‹çš„èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å›è°ƒçš„æ–¹å¼å¤„ç†è®¡ç®—ç»“æœï¼Œä¹Ÿæä¾›äº†è½¬æ¢å’Œç»„åˆCompletableFuture çš„æ–¹æ³•ã€‚å®ƒå¯èƒ½ä»£è¡¨â€”ä¸ªæ˜ç¡®å®Œæˆçš„Futureï¼Œä¹Ÿæœ‰å¯èƒ½ä»£è¡¨ä¸€ä¸ªå®Œæˆé˜¶æ®µ(CompletionStageï¼‰ï¼Œå®ƒæ”¯æŒåœ¨è®¡ç®—å®Œæˆä»¥åè§¦å‘ä¸€äº›å‡½æ•°æˆ–æ‰§è¡ŒæŸäº›åŠ¨ä½œã€‚</p><hr><h3 id="3-2-å››ä¸ªæ ¸å¿ƒé™æ€æ–¹æ³•">3.2 å››ä¸ªæ ¸å¿ƒé™æ€æ–¹æ³•</h3><p>åˆ©ç”¨æ ¸å¿ƒçš„å››ä¸ªé™æ€æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¼‚æ­¥æ“ä½œ | ä¸å»ºè®®ç”¨newï¼Œç›´æ¥newå‡ºæ¥çš„æ˜¯ä¸å®Œæ•´çš„</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>æ²¡æœ‰æŒ‡å®šExecutorçš„æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤çš„ForkJoinPool.commPool()ä½œä¸ºå®ƒçš„çº¿ç¨‹æ± æ‰§è¡Œå¼‚æ­¥ä»£ç ã€‚</li><li>å¦‚æœæŒ‡å®šçº¿ç¨‹æ± ï¼Œåˆ™ä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„æˆ–è€…ç‰¹åˆ«æŒ‡å®šçš„çº¿ç¨‹æ± æ‰§è¡Œå¼‚æ­¥ä»£ç ã€‚</li></ul><p>å…¶ä¸­ï¼ŒrunAsyncæ— è¿”å›å€¼ï¼ŒsupplyAsyncæœ‰è¿”å›å€¼ã€‚</p><div class="tabs" id="fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6-1"><i class="fas fa-bug"></i>runAsync</button></li><li class="tab"><button type="button" data-href="#fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6-2"><i class="fas fa-cannabis"></i>runAsync+çº¿ç¨‹æ± </button></li><li class="tab"><button type="button" data-href="#fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6-3"><i class="fas fa-candy-cane"></i>supplyAsync</button></li><li class="tab"><button type="button" data-href="#fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6-4"><i class="fas fa-child"></i>supplyAsync+çº¿ç¨‹æ± </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6-1"><p><code>public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable)</code></p><p>Void ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œä¸ç»å¸¸ç”¨åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    CompletableFuture&lt;Void&gt; voidCompletableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="comment">//åœé¡¿å‡ ç§’çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(voidCompletableFuture.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ForkJoinPool.commonPool-worker-<span class="number">1</span></span><br><span class="line"><span class="literal">null</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6-2"><p><code>public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable,Executor executor)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);<span class="comment">//åŠ å…¥çº¿ç¨‹æ± </span></span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; voidCompletableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="comment">//åœé¡¿å‡ ç§’çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,executorService);</span><br><span class="line">    System.out.println(voidCompletableFuture.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span></span><br><span class="line"><span class="literal">null</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6-3"><p><code>public static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    CompletableFuture&lt;String&gt; objectCompletableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;helllo supplyasync&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(objectCompletableFuture.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ForkJoinPool.commonPool-worker-<span class="number">1</span></span><br><span class="line">helllo supplyasync</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="fc6817d3-06f5-49b8-a9c2-a1a2c8b295f6-4"><p><code>public static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier,Executor executor)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);<span class="comment">//åŠ å…¥çº¿ç¨‹æ± </span></span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;String&gt; objectCompletableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;helllo supplyasync&quot;</span>;</span><br><span class="line">    &#125;,executorService);</span><br><span class="line">    System.out.println(objectCompletableFuture.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span></span><br><span class="line">helllo supplyasync</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="3-3-åŸºæœ¬åŠŸèƒ½">3.3 åŸºæœ¬åŠŸèƒ½</h3><div class="tabs" id="d0a8342f-04a1-42bb-b173-a75a043f9cf1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#d0a8342f-04a1-42bb-b173-a75a043f9cf1-1"><i class="fas fa-award"></i>å®ŒæˆFutureçš„åŠŸèƒ½</button></li><li class="tab"><button type="button" data-href="#d0a8342f-04a1-42bb-b173-a75a043f9cf1-2"><i class="fas fa-baseball-ball"></i>å‡å°‘é˜»å¡å’Œè½®è¯¢</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="d0a8342f-04a1-42bb-b173-a75a043f9cf1-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    CompletableFuture&lt;Object&gt; objectCompletableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;----å‰¯çº¿ç¨‹come in&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> ThreadLocalRandom.current().nextInt(<span class="number">10</span>);<span class="comment">//äº§ç”Ÿä¸€ä¸ªéšæœºæ•°</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;1ç§’é’Ÿåå‡ºç»“æœ&quot;</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;çº¿ç¨‹å…ˆå»å¿™å…¶ä»–ä»»åŠ¡&quot;</span>);</span><br><span class="line">    System.out.println(objectCompletableFuture.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ForkJoinPool.commonPool-worker-<span class="number">1</span>----å‰¯çº¿ç¨‹come in</span><br><span class="line">mainçº¿ç¨‹å…ˆå»å¿™å…¶ä»–ä»»åŠ¡</span><br><span class="line"><span class="number">1</span>ç§’é’Ÿåå‡ºç»“æœ<span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure><p>joinå’Œgetå¯¹æ¯”</p><ul><li>åŠŸèƒ½å‡ ä¹ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºç¼–ç æ—¶æ˜¯å¦éœ€è¦æŠ›å‡ºå¼‚å¸¸<ul><li>get()æ–¹æ³•éœ€è¦æŠ›å‡ºå¼‚å¸¸</li><li>join()æ–¹æ³•ä¸éœ€è¦æŠ›å‡ºå¼‚å¸¸</li></ul></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="d0a8342f-04a1-42bb-b173-a75a043f9cf1-2"><p><code>CompletableFuture</code>é€šè¿‡<code>whenComplete</code>æ¥<strong>å‡å°‘é˜»å¡å’Œè½®è¯¢</strong>ï¼ˆè‡ªåŠ¨å›è°ƒï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;--------å‰¯çº¿ç¨‹come in&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> ThreadLocalRandom.current().nextInt(<span class="number">10</span>);<span class="comment">//äº§ç”Ÿéšæœºæ•°</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;).whenComplete((v,e) -&gt; &#123;<span class="comment">//æ²¡æœ‰å¼‚å¸¸,væ˜¯å€¼ï¼Œeæ˜¯å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span>(e == <span class="literal">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;------------------è®¡ç®—å®Œæˆï¼Œæ›´æ–°ç³»ç»ŸupdataValue&quot;</span>+v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).exceptionally(e-&gt;&#123;<span class="comment">//æœ‰å¼‚å¸¸çš„æƒ…å†µ</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚å¸¸æƒ…å†µ&quot;</span>+e.getCause()+<span class="string">&quot;\t&quot;</span>+e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­ï¼šæš‚åœ3ç§’é’Ÿçº¿ç¨‹</span></span><br><span class="line">    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;çº¿ç¨‹å…ˆå»å¿™å…¶ä»–ä»»åŠ¡&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ForkJoinPool.commonPool-worker-<span class="number">1</span>--------å‰¯çº¿ç¨‹come in</span><br><span class="line">mainçº¿ç¨‹å…ˆå»å¿™å…¶ä»–ä»»åŠ¡</span><br><span class="line">------------------è®¡ç®—å®Œæˆï¼Œæ›´æ–°ç³»ç»ŸupdataValue7</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>CompletableFutureä¼˜ç‚¹æ€»ç»“</p><ul><li>å¼‚æ­¥ä»»åŠ¡ç»“æŸæ—¶ï¼Œä¼š<strong>è‡ªåŠ¨å›è°ƒ</strong>æŸä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼›</li><li>ä¸»çº¿ç¨‹è®¾ç½®å¥½å›è°ƒåï¼Œä¸å†å…³å¿ƒå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œå¼‚æ­¥ä»»åŠ¡ä¹‹é—´å¯ä»¥é¡ºåºæ‰§è¡Œ</li><li>å¼‚æ­¥ä»»åŠ¡å‡ºé”™æ—¶ï¼Œä¼šè‡ªåŠ¨å›è°ƒæŸä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚</li></ul><hr><h3 id="3-4-å®æˆ˜ç²¾è®²">3.4 å®æˆ˜ç²¾è®²</h3><blockquote><p>1éœ€æ±‚è¯´æ˜<br>åŒä¸€æ¬¾äº§å“ï¼ŒåŒæ—¶æœç´¢å‡ºåŒæ¬¾äº§å“åœ¨å„å¤§ç”µå•†å¹³å°çš„å”®ä»·ï¼›</p><p>2è¾“å‡ºè¿”å›ï¼š<br>å‡ºæ¥ç»“æœå¸Œæœ›æ˜¯åŒæ¬¾äº§å“çš„åœ¨ä¸åŒåœ°æ–¹çš„ä»·æ ¼æ¸…å•åˆ—è¡¨ï¼Œ è¿”å›ä¸€ä¸ªList<String><br>ã€Šmysqlã€‹in jd price is 88.05<br>ã€Šmysqlã€‹in dang dang price is 86.11<br>ã€Šmysqlã€‹in tao bao price is 90.43</p><p>3è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¯¹åŒä¸€ä¸ªå•†å“åœ¨å„ä¸ªå¹³å°ä¸Šçš„ä»·æ ¼ï¼Œè¦æ±‚è·å¾—ä¸€ä¸ªæ¸…å•åˆ—è¡¨<br>1   stepbystep   ï¼Œ æŒ‰éƒ¨å°±ç­ï¼Œ æŸ¥å®Œäº¬ä¸œæŸ¥æ·˜å®ï¼Œ æŸ¥å®Œæ·˜å®æŸ¥å¤©çŒ«â€¦<br>2   all in       ï¼Œä¸‡ç®­é½å‘ï¼Œä¸€å£æ°”å¤šçº¿ç¨‹å¼‚æ­¥ä»»åŠ¡åŒæ—¶æŸ¥è¯¢ã€‚ã€‚ã€‚</p></blockquote><p>åŸºæœ¬æ¡†æ¶æ­å»º</p><div class="tabs" id="423e5b22-a9ff-4ac1-aeb4-0e694dd2a889"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#423e5b22-a9ff-4ac1-aeb4-0e694dd2a889-1"><i class="fas fa-atom"></i>NetMall</button></li><li class="tab"><button type="button" data-href="#423e5b22-a9ff-4ac1-aeb4-0e694dd2a889-2"><i class="far fa-sun"></i>æŒ‰éƒ¨å°±ç­</button></li><li class="tab"><button type="button" data-href="#423e5b22-a9ff-4ac1-aeb4-0e694dd2a889-3"><i class="fas fa-wind"></i>ä¸‡ç®­é½å‘</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="423e5b22-a9ff-4ac1-aeb4-0e694dd2a889-1"><p>æ¨¡æ‹Ÿç”µå•†ç½‘ç«™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NetMall</span>&#123;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String netMallName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NetMall</span><span class="params">(String netMallName)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.netMallName = netMallName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calcPrice</span><span class="params">(String productName)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ThreadLocalRandom.current().nextDouble() * <span class="number">2</span> + productName.charAt(<span class="number">0</span>);<span class="comment">//ç”¨è¿™å¥è¯æ¥æ¨¡æ‹Ÿä»·æ ¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="423e5b22-a9ff-4ac1-aeb4-0e694dd2a889-2"><p>ç›¸å½“äºæ˜¯ä¸€ä¸ªä¸€ä¸ªæŒ‰éƒ¨å°±ç­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Case</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;NetMall&gt; list = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">NetMall</span>(<span class="string">&quot;jd&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">NetMall</span>(<span class="string">&quot;dangdang&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">NetMall</span>(<span class="string">&quot;taobao&quot;</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">getPrice</span><span class="params">(List&lt;NetMall&gt; list,String productName)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list</span><br><span class="line">                .stream() <span class="comment">//----æµå¼è®¡ç®—åšäº†æ˜ å°„ï¼ˆåˆ©ç”¨mapï¼‰ï¼Œå¸Œæœ›å‡ºæ¥çš„æ˜¯æœ‰æ ¼å¼çš„å­—ç¬¦ä¸²ï¼ˆåˆ©ç”¨String.formatï¼‰,%æ˜¯å ä½ç¬¦</span></span><br><span class="line">                .map(netMall -&gt; String.format(productName + <span class="string">&quot; in %s price is %.2f&quot;</span>,</span><br><span class="line">                        netMall.getNetMallName(),<span class="comment">//ç¬¬ä¸€ä¸ª%</span></span><br><span class="line">                        netMall.calcPrice(productName))).collect(Collectors.toList());<span class="comment">//ç¬¬äºŒä¸ª%</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        List&lt;String&gt; list1 = getPrice(list, <span class="string">&quot;mysql&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(String element:list1)&#123;</span><br><span class="line">            System.out.println(element);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;---å½“å‰æ“ä½œèŠ±è´¹æ—¶é—´----costTime:&quot;</span>+(endTime-startTime)+<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql in jd price is <span class="number">110.48</span></span><br><span class="line">mysql in dangdang price is <span class="number">109.06</span></span><br><span class="line">mysql in taobao price is <span class="number">110.96</span></span><br><span class="line">---å½“å‰æ“ä½œèŠ±è´¹æ—¶é—´----costTime:<span class="number">3098</span>æ¯«ç§’</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="423e5b22-a9ff-4ac1-aeb4-0e694dd2a889-3"><p>è¿™é‡Œæ˜¯åˆ©ç”¨å¼‚æ­¥çº¿ç¨‹ï¼Œä¸‡ç®­é½å‘ã€‚æ­¤å¤„ç”¨äº†ä¸¤æ­¥<strong>æµå¼ç¼–ç¨‹</strong>ã€‚æ€§èƒ½å·®è·å·¨å¤§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Case</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;NetMall&gt; list = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">NetMall</span>(<span class="string">&quot;jd&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">NetMall</span>(<span class="string">&quot;dangdang&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">NetMall</span>(<span class="string">&quot;taobao&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä»åŠŸèƒ½åˆ°æ€§èƒ½</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">getPricesByCompletableFuture</span><span class="params">(List&lt;NetMall&gt; list,String productName)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.stream().map(netMall -&gt;</span><br><span class="line">                        CompletableFuture.supplyAsync(() -&gt; String.format(productName + <span class="string">&quot; in %s price is %.2f&quot;</span>,</span><br><span class="line">                                netMall.getNetMallName(),</span><br><span class="line">                                netMall.calcPrice(productName))))<span class="comment">//Stream&lt;CompletableFuture&lt;String&gt;&gt;</span></span><br><span class="line">                .collect(Collectors.toList())<span class="comment">//List&lt;CompletablFuture&lt;String&gt;&gt;</span></span><br><span class="line">                .stream()<span class="comment">//Stream&lt;CompletableFuture&lt;String&gt;</span></span><br><span class="line">                .map(s-&gt;s.join())<span class="comment">//Stream&lt;String&gt;</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        List&lt;String&gt; list2 = getPricesByCompletableFuture(list, <span class="string">&quot;mysql&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(String element:list2)&#123;</span><br><span class="line">            System.out.println(element);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;--æ€§èƒ½ç‰ˆ-å½“å‰æ“ä½œèŠ±è´¹æ—¶é—´----costTime:&quot;</span>+(endTime-startTime)+<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql in jd price is <span class="number">110.52</span></span><br><span class="line">mysql in dangdang price is <span class="number">110.41</span></span><br><span class="line">mysql in taobao price is <span class="number">110.42</span></span><br><span class="line">--æ€§èƒ½ç‰ˆ-å½“å‰æ“ä½œèŠ±è´¹æ—¶é—´----costTime:<span class="number">1137</span>æ¯«ç§’</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h3 id="3-5-å¸¸ç”¨API">3.5 å¸¸ç”¨API</h3><h4 id="3-5-1-è·å¾—ç»“æœå’Œè§¦å‘è®¡ç®—">3.5.1 è·å¾—ç»“æœå’Œè§¦å‘è®¡ç®—</h4><div class="tabs" id="7aa97ce1-9a0e-4617-b937-a3c60341596f"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c60341596f-1"><i class="fas fa-bug"></i>API</button></li><li class="tab"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c60341596f-2"><i class="fas fa-cannabis"></i>ä»£ç æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7aa97ce1-9a0e-4617-b937-a3c60341596f-1"><p>è·å–ç»“æœ</p><p>-<code>public T get()</code>ä¸è§ä¸æ•£ï¼Œå®¹æ˜“é˜»å¡</p><p>-<code>public T get(long timeout,TimeUnit unit)</code>è¿‡æ—¶ä¸å€™ï¼Œè¶…è¿‡æ—¶é—´ä¼šçˆ†å¼‚å¸¸<br>-<code>public T join()</code>ç±»ä¼¼äºget()ï¼ŒåŒºåˆ«åœ¨äºæ˜¯å¦éœ€è¦æŠ›å‡ºå¼‚å¸¸<br>-<code>public T getNow(T valueIfAbsent)</code></p><ul><li>æ²¡æœ‰è®¡ç®—å®Œæˆçš„æƒ…å†µä¸‹ï¼Œç»™ä¸€ä¸ªæ›¿ä»£ç»“æœ</li><li>ç«‹å³è·å–ç»“æœä¸é˜»å¡<ul><li>è®¡ç®—å®Œï¼Œè¿”å›è®¡ç®—å®Œæˆåçš„ç»“æœ</li><li>æ²¡ç®—å®Œï¼Œè¿”å›è®¾å®šçš„valueAbsent</li></ul></li></ul><p>ä¸»åŠ¨è§¦å‘è®¡ç®—</p><p>-<code>public boolean complete(T value)</code>æ˜¯å¦ç«‹å³æ‰“æ–­get()æ–¹æ³•è¿”å›æ‹¬å·å€¼</p><ul><li>æ‰§è¡Œè¦2sï¼Œç­‰å¾…åªæœ‰1sï¼Œæ‰€ä»¥è¿˜æ²¡æ‰§è¡Œå®Œå°±è¢«æ‰“æ–­äº†ã€‚è¿”å›trueè¡¨ç¤ºæ‰“æ–­äº†è·å–è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´æ¥è¿”å›äº†å¤‡èƒå€¼valueï¼›å¦‚æœæ²¡æ‰“æ–­ï¼Œè¿”å›false å’ŒåŸæ¥çš„è®¡ç®—å®Œæˆç»“æœ</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7aa97ce1-9a0e-4617-b937-a3c60341596f-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompletableFutureAPIDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        CompletableFuture&lt;String&gt; uCompletableFuture = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);<span class="comment">//æ‰§è¡Œéœ€è¦2ç§’</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);<span class="comment">//ç­‰å¾…éœ€è¦1ç§’</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="comment">// System.out.println(uCompletableFuture.getNow(&quot;xxx&quot;));//æ‰§2-ç­‰1 è¿”å›xxx</span></span><br><span class="line">        System.out.println(uCompletableFuture.complete(<span class="string">&quot;completeValue&quot;</span>)+<span class="string">&quot;\t&quot;</span>+uCompletableFuture.get());</span><br><span class="line">      <span class="comment">//æ‰§2-ç­‰1 è¿”å›true+å¤‡èƒå€¼completeValue</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h4 id="3-5-2-å¯¹è®¡ç®—ç»“æœè¿›è¡Œå¤„ç†">3.5.2 å¯¹è®¡ç®—ç»“æœè¿›è¡Œå¤„ç†</h4><div class="tabs" id="7aa97ce1-9a0e-4617-b937-a3c603415961"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c603415961-1"><i class="fas fa-bug"></i>API</button></li><li class="tab"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c603415961-2"><i class="fas fa-cannabis"></i>thenApplyæ¼”ç¤º</button></li><li class="tab"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c603415961-3"><i class="fas fa-anchor"></i>handleæ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7aa97ce1-9a0e-4617-b937-a3c603415961-1"><p><code>thenApply</code>è®¡ç®—ç»“æœå­˜åœ¨åœ¨ä¾èµ–å…³ç³»ï¼Œä½¿å¾—çº¿ç¨‹ä¸²è¡ŒåŒ–ã€‚å› ä¸ºä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥ä¸€æ—¦æœ‰å¼‚å¸¸ï¼Œç›´æ¥å«åœã€‚</p><p><code>handle</code>ç±»ä¼¼äºthenApplyï¼Œä½†æ˜¯æœ‰å¼‚å¸¸çš„è¯ä»ç„¶å¯ä»¥å¾€ä¸‹èµ°ä¸€æ­¥ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7aa97ce1-9a0e-4617-b937-a3c603415961-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//å½“ä¸€ä¸ªçº¿ç¨‹ä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ç”¨ thenApply æ–¹æ³•æ¥æŠŠè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸²è¡ŒåŒ–,</span></span><br><span class="line">    CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">1</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;).thenApply(f -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;222&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> f + <span class="number">2</span>;</span><br><span class="line">    &#125;).thenApply(f -&gt; &#123;</span><br><span class="line">        <span class="comment">//int age = 10/0; // å¼‚å¸¸æƒ…å†µï¼šé‚£æ­¥å‡ºé”™å°±åœåœ¨é‚£æ­¥ã€‚</span></span><br><span class="line">        System.out.println(<span class="string">&quot;333&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> f + <span class="number">3</span>;</span><br><span class="line">    &#125;).whenCompleteAsync((v,e) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;*****v: &quot;</span>+v);</span><br><span class="line">    &#125;).exceptionally(e -&gt; &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:</span></span><br><span class="line">    <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">2</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-----æ­£å¸¸æƒ…å†µ</span></span><br><span class="line"><span class="comment">//111</span></span><br><span class="line"><span class="comment">//222</span></span><br><span class="line"><span class="comment">//333</span></span><br><span class="line"><span class="comment">//----è®¡ç®—ç»“æœï¼š 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-----å¼‚å¸¸æƒ…å†µ</span></span><br><span class="line"><span class="comment">//111</span></span><br><span class="line"><span class="comment">//å¼‚å¸¸.....</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7aa97ce1-9a0e-4617-b937-a3c603415961-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompletableFutureDemo2</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å½“ä¸€ä¸ªçº¿ç¨‹ä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ç”¨ handle æ–¹æ³•æ¥æŠŠè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸²è¡ŒåŒ–,</span></span><br><span class="line">        <span class="comment">// å¼‚å¸¸æƒ…å†µï¼šæœ‰å¼‚å¸¸ä¹Ÿå¯ä»¥å¾€ä¸‹ä¸€æ­¥èµ°ï¼Œæ ¹æ®å¸¦çš„å¼‚å¸¸å‚æ•°å¯ä»¥è¿›ä¸€æ­¥å¤„ç†</span></span><br><span class="line">        CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">1</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;).handle((f,e) -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">0</span>;<span class="comment">//å¼‚å¸¸è¯­å¥</span></span><br><span class="line">            System.out.println(<span class="string">&quot;222&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> f + <span class="number">2</span>;</span><br><span class="line">        &#125;).handle((f,e) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;333&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> f + <span class="number">3</span>;</span><br><span class="line">        &#125;).whenCompleteAsync((v,e) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;*****v: &quot;</span>+v);</span><br><span class="line">        &#125;).exceptionally(e -&gt; &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:</span></span><br><span class="line">        <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">2</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-----å¼‚å¸¸æƒ…å†µ</span></span><br><span class="line"><span class="comment">//111</span></span><br><span class="line"><span class="comment">//333</span></span><br><span class="line"><span class="comment">//å¼‚å¸¸ï¼Œå¯ä»¥çœ‹åˆ°å¤šèµ°äº†ä¸€æ­¥333</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h4 id="3-5-3-å¯¹è®¡ç®—ç»“æœè¿›è¡Œæ¶ˆè´¹">3.5.3 å¯¹è®¡ç®—ç»“æœè¿›è¡Œæ¶ˆè´¹</h4><div class="tabs" id="7aa97ce1-9a0e-4617-b937-a3c6034159212"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c6034159212-1"><i class="fas fa-bug"></i>API</button></li><li class="tab"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c6034159212-2"><i class="fas fa-cannabis"></i>ä»£ç æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7aa97ce1-9a0e-4617-b937-a3c6034159212-1"><p><code>thenAccept</code>æ¥æ”¶ä»»åŠ¡çš„å¤„ç†ç»“æœï¼Œå¹¶æ¶ˆè´¹å¤„ç†ï¼Œæ— è¿”å›ç»“æœ</p><blockquote><p>è¡¥å……</p><p>thenRun</p><ul><li>thenRun(Runnable runnable)</li><li>ä»»åŠ¡Aæ‰§è¡Œå®Œæ‰§è¡ŒBï¼Œå¹¶ä¸”Bä¸éœ€è¦Açš„ç»“æœ</li></ul><p>thenAccept</p><ul><li>thenAccept(Consumer action)</li><li>ä»»åŠ¡Aæ‰§è¡Œå®Œæ‰§è¡ŒBï¼ŒBéœ€è¦Açš„ç»“æœï¼Œä½†æ˜¯ä»»åŠ¡Bæ— è¿”å›å€¼</li></ul><p>thenApply</p><ul><li>thenApply(Function fn)</li><li>ä»»åŠ¡Aæ‰§è¡Œå®Œæ‰§è¡ŒBï¼ŒBéœ€è¦Açš„ç»“æœï¼ŒåŒæ—¶ä»»åŠ¡Bæœ‰è¿”å›å€¼</li></ul></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7aa97ce1-9a0e-4617-b937-a3c6034159212-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException</span><br><span class="line">&#123;</span><br><span class="line">    CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;).thenApply(f -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> f + <span class="number">2</span>;</span><br><span class="line">    &#125;).thenApply(f -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> f + <span class="number">3</span>;</span><br><span class="line">    &#125;).thenApply(f -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> f + <span class="number">4</span>;</span><br><span class="line">    &#125;).thenAccept(r -&gt; System.out.println(r));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//6</span></span><br><span class="line"><span class="comment">//æ¶ˆè´¹ä¸€ä¸‹ï¼Œç›´æ¥å¾—åˆ°6</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h4 id="3-5-4-å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨">3.5.4 å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨</h4><div class="tabs" id="7aa97ce1-9a0e-4617-b937-a3c603415963"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c603415963-1"><i class="fas fa-bug"></i>API</button></li><li class="tab"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c603415963-2"><i class="fas fa-cannabis"></i>ä»£ç æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7aa97ce1-9a0e-4617-b937-a3c603415963-1"><p><code>applyToEither</code>:ä¸¤ä¸ªä»»åŠ¡æœ‰ä¸€ä¸ªæ‰§è¡Œå®Œæˆï¼Œè·å–å®ƒçš„è¿”å›å€¼ï¼Œå¤„ç†ä»»åŠ¡æœ‰æ–°çš„è¿”å›å€¼</p><p><code>acceptEither</code>:ä¸¤ä¸ªä»»åŠ¡æœ‰ä¸€ä¸ªæ‰§è¡Œå®Œæˆï¼Œè·å–å®ƒçš„è¿”å›å€¼ï¼Œå¤„ç†ä»»åŠ¡ï¼Œæ²¡æœ‰æ–°çš„è¿”å›å€¼</p><p><code>runAfterEither</code>:ä¸¤ä¸ªä»»åŠ¡æœ‰ä¸€ä¸ªæ‰§è¡Œå®Œæˆï¼Œä¸éœ€è¦è·å–ç»“æœï¼Œä¹Ÿæ²¡æœ‰è¿”å›å€¼</p><p><code>anyOf</code>ï¼šè·å–ç‡å…ˆå®Œæˆçš„ä»»åŠ¡ç»“æœ</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7aa97ce1-9a0e-4617-b937-a3c603415963-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException</span><br><span class="line">&#123;</span><br><span class="line">    CompletableFuture&lt;String&gt; play1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in &quot;</span>);</span><br><span class="line">        <span class="comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">2</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;paly1è®¡ç®—å®Œæˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;play1 &quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;String&gt; play2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in &quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">1</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;paly2è®¡ç®—å®Œæˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;play2&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;String&gt; thenCombineResult = play1.applyToEither(play2, f -&gt; &#123;<span class="comment">//å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨</span></span><br><span class="line">        <span class="keyword">return</span> f + <span class="string">&quot; is winner&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + thenCombineResult.get());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ForkJoinPool.commonPool-worker-1---come in </span></span><br><span class="line"><span class="comment">//ForkJoinPool.commonPool-worker-2---come in </span></span><br><span class="line"><span class="comment">//paly2è®¡ç®—å®Œæˆ</span></span><br><span class="line"><span class="comment">//mainplay2 is winner</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h4 id="3-5-5-å¯¹è®¡ç®—ç»“æœè¿›è¡Œç»„åˆ">3.5.5 å¯¹è®¡ç®—ç»“æœè¿›è¡Œç»„åˆ</h4><div class="tabs" id="7aa97ce1-9a0e-4617-b937-a3c603415964"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c603415964-1"><i class="fas fa-bug"></i>API</button></li><li class="tab"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c603415964-2"><i class="fas fa-cannabis"></i>åˆ†è§£ç‰ˆ</button></li><li class="tab"><button type="button" data-href="#7aa97ce1-9a0e-4617-b937-a3c603415964-3"><i class="fas fa-anchor"></i>åˆå¹¶ç‰ˆ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="7aa97ce1-9a0e-4617-b937-a3c603415964-1"><p><code>thenCombine</code>ï¼šç»„åˆä¸¤ä¸ª futureï¼Œè·å–ä¸¤ä¸ª future çš„è¿”å›ç»“æœï¼Œå¹¶è¿”å›å½“å‰ä»»åŠ¡çš„è¿”å›å€¼</p><p><code>thenAcceptBoth</code>ï¼šç»„åˆä¸¤ä¸ª futureï¼Œè·å–ä¸¤ä¸ª future ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œç„¶åå¤„ç†ä»»åŠ¡ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</p><p><code>runAfterBoth</code>ï¼šç»„åˆä¸¤ä¸ª futureï¼Œä¸éœ€è¦è·å– future çš„ç»“æœï¼Œåªéœ€ä¸¤ä¸ª future å¤„ç†å®Œä»»åŠ¡åï¼Œ å¤„ç†è¯¥ä»»åŠ¡ã€‚</p><p><code>allOf</code>ï¼šå½“æ‰€æœ‰ç»™å®šçš„ä»»åŠ¡å®Œæˆåï¼Œè¿”å›ä¸€ä¸ªå…¨æ–°çš„å·²å®ŒæˆCompletableFuture</p><blockquote><p>å…¶ä¸­ä»»åŠ¡ç»„åˆéƒ½è¦å®Œæˆ</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7aa97ce1-9a0e-4617-b937-a3c603415964-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException</span><br><span class="line">&#123;</span><br><span class="line">    CompletableFuture&lt;Integer&gt; completableFuture1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in &quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; completableFuture2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in &quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; thenCombineResult = completableFuture1.thenCombine(completableFuture2, (x, y) -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in &quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    System.out.println(thenCombineResult.get());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ForkJoinPool.commonPool-worker-1---come in </span></span><br><span class="line"><span class="comment">//ForkJoinPool.commonPool-worker-1---come in </span></span><br><span class="line"><span class="comment">//main---come in </span></span><br><span class="line"><span class="comment">//30</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="7aa97ce1-9a0e-4617-b937-a3c603415964-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException</span><br><span class="line">&#123;</span><br><span class="line">    CompletableFuture&lt;Integer&gt; thenCombineResult = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in 1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;).thenCombine(CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in 2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;), (x,y) -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in 3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;).thenCombine(CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in 4&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">30</span>;</span><br><span class="line">    &#125;),(a,b) -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;---come in 5&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(thenCombineResult.get());</span><br><span class="line">    System.out.println(<span class="string">&quot;-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:</span></span><br><span class="line">    <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">10</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ForkJoinPool.commonPool-worker-1---come in 1</span></span><br><span class="line"><span class="comment">//ForkJoinPool.commonPool-worker-1---come in 2</span></span><br><span class="line"><span class="comment">//main---come in 3</span></span><br><span class="line"><span class="comment">//ForkJoinPool.commonPool-worker-1---come in 4</span></span><br><span class="line"><span class="comment">//main---come in 5</span></span><br><span class="line"><span class="comment">//60</span></span><br><span class="line"><span class="comment">//-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h3 id="3-6-CompleteFutureå’Œçº¿ç¨‹æ± ">3.6 CompleteFutureå’Œçº¿ç¨‹æ± </h3><div class="tabs" id="91b48b3c-345b-4d1c-92e0-9a3b25ef1583"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#91b48b3c-345b-4d1c-92e0-9a3b25ef1583-1"><i class="fas fa-atom"></i>åŒºåˆ«</button></li><li class="tab"><button type="button" data-href="#91b48b3c-345b-4d1c-92e0-9a3b25ef1583-2"><i class="far fa-sun"></i>ç»“è®º1-ç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#91b48b3c-345b-4d1c-92e0-9a3b25ef1583-3"><i class="fas fa-wind"></i>ç»“è®º2.1-ç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#91b48b3c-345b-4d1c-92e0-9a3b25ef1583-4"><i class="fas fa-fire-alt"></i>ç»“è®º2.2-ç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#91b48b3c-345b-4d1c-92e0-9a3b25ef1583-5"><i class="fas fa-child"></i>ç»“è®º2.3-ç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#91b48b3c-345b-4d1c-92e0-9a3b25ef1583-6"><i class="fas fa-candy-cane"></i>ç»“è®º3-ç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="91b48b3c-345b-4d1c-92e0-9a3b25ef1583-1"><p>ä¸Šé¢çš„å‡ ä¸ªæ–¹æ³•éƒ½æœ‰æ™®é€šç‰ˆæœ¬å’Œåé¢åŠ Asyncçš„ç‰ˆæœ¬</p><p>ä»¥thenRunå’ŒthenRunAsyncä¸ºä¾‹ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>å…ˆçœ‹ç»“è®º</p><ol><li><p>æ²¡æœ‰ä¼ å…¥è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œéƒ½ç”¨é»˜è®¤çº¿ç¨‹æ± ForkJoinPool</p></li><li><p>ä¼ å…¥äº†ä¸€ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± å¦‚æœä½ æ‰§è¡Œç¬¬ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œä¼ å…¥äº†ä¸€ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± </p><ul><li>è°ƒç”¨thenRunæ–¹æ³•æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œåˆ™ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯ç”¨åŒä¸€ä¸ªçº¿ç¨‹æ± </li><li>è°ƒç”¨thenRunAsyncæ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œåˆ™ç¬¬ä¸€ä¸ªä»»åŠ¡ä½¿ç”¨çš„æ˜¯ä½ è‡ªå·±ä¼ å…¥çš„çº¿ç¨‹æ± ï¼Œç¬¬äºŒä¸ªä»»åŠ¡æ²¡æœ‰ä¼ å…¥çº¿ç¨‹æ± å‚æ•°åˆ™ä½¿ç”¨çš„æ˜¯é»˜è®¤ForkJoinçº¿ç¨‹æ± </li><li>è°ƒç”¨thenRunAsyncæ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œä¼ å…¥äº†çº¿ç¨‹æ± ï¼Œåˆ™ä½¿ç”¨ä½ ä¼ å…¥çš„çº¿ç¨‹æ± </li></ul></li><li><p>ä¹Ÿæœ‰å¯èƒ½å¤„ç†å¤ªå¿«ï¼Œç³»ç»Ÿä¼˜åŒ–åˆ‡æ¢åŸåˆ™ï¼Œç›´æ¥ä½¿ç”¨mainçº¿ç¨‹å¤„ç†ï¼ˆæŠŠsleepå»æ‰ï¼‰</p></li></ol><p>å…¶å®ƒå¦‚ï¼šthenAcceptå’ŒthenAcceptAsyncï¼ŒthenApplyå’ŒthenApplyAsyncç­‰ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä¹Ÿæ˜¯åŒç†</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="91b48b3c-345b-4d1c-92e0-9a3b25ef1583-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;1å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;ç»“æŸæ—¶é—´&quot;</span>+<span class="string">&quot;\t&quot;</span>+System.currentTimeMillis());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;abcd&quot;</span>;</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;2å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;ç»“æŸæ—¶é—´&quot;</span>+<span class="string">&quot;\t&quot;</span>+System.currentTimeMillis());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;3å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;ç»“æŸæ—¶é—´&quot;</span>+<span class="string">&quot;\t&quot;</span>+System.currentTimeMillis());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;4å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;ç»“æŸæ—¶é—´&quot;</span>+<span class="string">&quot;\t&quot;</span>+System.currentTimeMillis());</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1å·ä»»åŠ¡ForkJoinPool.commonPool-worker-1ç»“æŸæ—¶é—´1680685553341</span></span><br><span class="line"><span class="comment">//2å·ä»»åŠ¡ForkJoinPool.commonPool-worker-1ç»“æŸæ—¶é—´1680685553366</span></span><br><span class="line"><span class="comment">//3å·ä»»åŠ¡ForkJoinPool.commonPool-worker-1ç»“æŸæ—¶é—´1680685553391</span></span><br><span class="line"><span class="comment">//4å·ä»»åŠ¡ForkJoinPool.commonPool-worker-1ç»“æŸæ—¶é—´1680685553415</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="91b48b3c-345b-4d1c-92e0-9a3b25ef1583-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">    CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;1å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;abcd&quot;</span>;</span><br><span class="line">    &#125;,threadPool).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;2å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;3å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;4å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1å·ä»»åŠ¡pool-1-thread-1</span></span><br><span class="line"><span class="comment">//2å·ä»»åŠ¡pool-1-thread-1</span></span><br><span class="line"><span class="comment">//3å·ä»»åŠ¡pool-1-thread-1</span></span><br><span class="line"><span class="comment">//4å·ä»»åŠ¡pool-1-thread-1</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="91b48b3c-345b-4d1c-92e0-9a3b25ef1583-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">    CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;1å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;abcd&quot;</span>;</span><br><span class="line">    &#125;,threadPool).thenRunAsync(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;2å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;3å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;4å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1å·ä»»åŠ¡pool-1-thread-1</span></span><br><span class="line"><span class="comment">//2å·ä»»åŠ¡ForkJoinPool.commonPool-worker-1</span></span><br><span class="line"><span class="comment">//3å·ä»»åŠ¡ForkJoinPool.commonPool-worker-1</span></span><br><span class="line"><span class="comment">//4å·ä»»åŠ¡ForkJoinPool.commonPool-worker-1</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="91b48b3c-345b-4d1c-92e0-9a3b25ef1583-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">    CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;1å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;abcd&quot;</span>;</span><br><span class="line">    &#125;,threadPool).thenRunAsync(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;2å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;,threadPool).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;3å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;4å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1å·ä»»åŠ¡pool-1-thread-1</span></span><br><span class="line"><span class="comment">//2å·ä»»åŠ¡pool-1-thread-2</span></span><br><span class="line"><span class="comment">//3å·ä»»åŠ¡pool-1-thread-2</span></span><br><span class="line"><span class="comment">//4å·ä»»åŠ¡pool-1-thread-2</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="91b48b3c-345b-4d1c-92e0-9a3b25ef1583-6"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">    CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">        <span class="comment">//try &#123;TimeUnit.MILLISECONDS.sleep(20);&#125; catch (InterruptedException e) &#123;e.printStackTrace();&#125;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;abcd&quot;</span>;</span><br><span class="line">    &#125;,threadPool).thenRunAsync(()-&gt;&#123;</span><br><span class="line">        <span class="comment">//try &#123;TimeUnit.MILLISECONDS.sleep(20);&#125; catch (InterruptedException e) &#123;e.printStackTrace();&#125;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;2å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="comment">//try &#123;TimeUnit.MILLISECONDS.sleep(20);&#125; catch (InterruptedException e) &#123;e.printStackTrace();&#125;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;3å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;).thenRun(()-&gt;&#123;</span><br><span class="line">        <span class="comment">//try &#123;TimeUnit.MILLISECONDS.sleep(20);&#125; catch (InterruptedException e) &#123;e.printStackTrace();&#125;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;4å·ä»»åŠ¡&quot;</span>+<span class="string">&quot;\t&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1å·ä»»åŠ¡pool-1-thread-1</span></span><br><span class="line"><span class="comment">//2å·ä»»åŠ¡main</span></span><br><span class="line"><span class="comment">//3å·ä»»åŠ¡main</span></span><br><span class="line"><span class="comment">//4å·ä»»åŠ¡main</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> ]]></content>
    
    
    <summary type="html">Futureã€CompletableFuture</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="JUC" scheme="https://wuwawawa.github.io/tags/JUC/"/>
    
  </entry>
  
  <entry>
    <title>7.2 çº¿ç¨‹å®‰å…¨é›†åˆç±»</title>
    <link href="https://wuwawawa.github.io/posts/b7fbfe85.html"/>
    <id>https://wuwawawa.github.io/posts/b7fbfe85.html</id>
    <published>2023-04-04T05:33:05.000Z</published>
    <updated>2023-04-18T06:20:49.219Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-çº¿ç¨‹å®‰å…¨é›†åˆç±»æ¦‚è¿°">1. çº¿ç¨‹å®‰å…¨é›†åˆç±»æ¦‚è¿°</h2><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220316174115768.png" alt="image-20220316174115768"></p><p>çº¿ç¨‹å®‰å…¨é›†åˆç±»å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><ul><li>é—ç•™çš„çº¿ç¨‹å®‰å…¨é›†åˆå¦‚<code>Hashtable</code>ï¼Œ<code>Vector</code></li><li>ä½¿ç”¨<code>Collections</code>è£…é¥°çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼Œå¦‚ï¼š<br>-<code>Collections.synchronizedCollection</code><br>-<code>Collections.synchronizedList</code><br>-<code>Collections.synchronizedMap</code><br>-<code>Collections.synchronizedSet</code><br>-<code>Collections.synchronizedNavigableMap</code><br>-<code>Collections.synchronizedNavigableSet </code><br>-<code>Collections.synchronizedSortedMap</code><br>-<code>Collections.synchronizedSortedSet</code><ul><li>è¯´æ˜ï¼šä»¥ä¸Šé›†åˆå‡é‡‡ç”¨ä¿®é¥°æ¨¡å¼è®¾è®¡ï¼Œå°†éçº¿ç¨‹å®‰å…¨çš„é›†åˆåŒ…è£…åï¼Œåœ¨è°ƒç”¨æ–¹æ³•æ—¶åŒ…è£¹äº†ä¸€å±‚synchronizedä»£ç å—ã€‚å…¶å¹¶å‘æ€§å¹¶ä¸æ¯”é—ç•™çš„å®‰å…¨é›†åˆå¥½ã€‚</li></ul></li><li>java.util.concurrent.*</li></ul><p>é‡ç‚¹ä»‹ç»<code>java.util.concurrent.*</code>ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆç±»ï¼Œå¯ä»¥å‘ç°å®ƒä»¬æœ‰è§„å¾‹ï¼Œé‡Œé¢åŒ…å«ä¸‰ç±»å…³é”®è¯ï¼š Blockingã€CopyOnWriteã€Concurrent</p><ul><li>Blocking å¤§éƒ¨åˆ†å®ç°åŸºäºé”ï¼Œå¹¶æä¾›ç”¨æ¥é˜»å¡çš„æ–¹æ³•</li><li>CopyOnWrite ä¹‹ç±»å®¹å™¨ä¿®æ”¹å¼€é”€ç›¸å¯¹è¾ƒé‡</li><li>Concurrent ç±»å‹çš„å®¹å™¨<ul><li>å†…éƒ¨å¾ˆå¤šæ“ä½œä½¿ç”¨ cas ä¼˜åŒ–ï¼Œä¸€èˆ¬å¯ä»¥æä¾›è¾ƒé«˜ååé‡</li><li>å¼±ä¸€è‡´æ€§<ul><li>éå†æ—¶å¼±ä¸€è‡´æ€§ï¼Œä¾‹å¦‚ï¼Œå½“åˆ©ç”¨è¿­ä»£å™¨éå†æ—¶ï¼Œå¦‚æœå®¹å™¨å‘ç”Ÿä¿®æ”¹ï¼Œè¿­ä»£å™¨ä»ç„¶å¯ä»¥ç»§ç»­è¿›è¡Œé å†ï¼Œè¿™æ—¶å†…å®¹æ˜¯æ—§çš„</li><li>æ±‚å¤§å°å¼±ä¸€è‡´æ€§ï¼Œsize æ“ä½œæœªå¿…æ˜¯ 100% å‡†ç¡®</li><li>è¯»å–å¼±ä¸€è‡´æ€§</li></ul></li></ul></li></ul><blockquote><p>éå†æ—¶å¦‚æœå‘ç”Ÿäº†ä¿®æ”¹ï¼Œå¯¹äºéå®‰å…¨å®¹å™¨æ¥è®²ï¼Œä½¿ç”¨ <strong>fail-fast</strong> æœºåˆ¶ä¹Ÿå°±æ˜¯è®©éå†ç«‹åˆ»å¤±è´¥ï¼ŒæŠ›å‡º ConcurrentModificationExceptionï¼Œä¸å†ç»§ç»­éå†</p></blockquote><h2 id="2-ConcurrentHashMap">2. ConcurrentHashMap</h2><p>å•è¯è®¡æ•°</p><p>åœ¨26ä¸ªæ–‡ä»¶ä¸­ï¼Œ26ä¸ªè‹±æ–‡å­—æ¯æ¯ä¸ªéƒ½æœ‰200ä¸ªå­˜åœ¨åœ¨è¿™26ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ ç°åœ¨éœ€è¦ä»æ–‡ä»¶ä¸­ç»Ÿè®¡å‡ºæ¯ä¸ªå­—æ¯çš„ä¸ªæ•°ã€‚å¦‚æœç»Ÿè®¡æ­£ç¡®ï¼Œé‚£ä¹ˆæ¯ä¸ªå­—æ¯çš„ä¸ªæ•°è¯¥ä¸º200ä¸ªã€‚</p><div class="tabs" id="6a32eea2-e5a0-46cb-a7ed-2f2789203ef0"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#6a32eea2-e5a0-46cb-a7ed-2f2789203ef0-1"><i class="fas fa-bug"></i>æµ‹è¯•ä»£ç </button></li><li class="tab"><button type="button" data-href="#6a32eea2-e5a0-46cb-a7ed-2f2789203ef0-2"><i class="fas fa-cannabis"></i>HashMapç»Ÿè®¡</button></li><li class="tab"><button type="button" data-href="#6a32eea2-e5a0-46cb-a7ed-2f2789203ef0-3"><i class="fas fa-candy-cane"></i>é”™è¯¯ä½¿ç”¨ConcurrentHashMap</button></li><li class="tab"><button type="button" data-href="#6a32eea2-e5a0-46cb-a7ed-2f2789203ef0-4"><i class="fas fa-child"></i>æ­£ç¡®ä½¿ç”¨ConcurrentHashMap</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="6a32eea2-e5a0-46cb-a7ed-2f2789203ef0-1"><p>ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯æä¾› Mapå’Œç»Ÿè®¡æ–¹æ³•å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;V&gt; <span class="keyword">void</span> <span class="title function_">demo</span><span class="params">(Supplier&lt;Map&lt;String, V&gt;&gt; supplier, BiConsumer&lt;Map&lt;String, V&gt;, List&lt;String&gt;&gt; consumer)</span> &#123;</span><br><span class="line">    Map&lt;String, V&gt; counterMap = supplier.get();</span><br><span class="line">    List&lt;Thread&gt; ts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">26</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            List&lt;String&gt; words = readFromFile(idx);</span><br><span class="line">            consumer.accept(counterMap, words);</span><br><span class="line">        &#125;);</span><br><span class="line">        ts.add(thread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ts.forEach(t -&gt; t.start());</span><br><span class="line">    ts.forEach(t -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    System.out.println(counterMap);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">readFromFile</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    ArrayList&lt;String&gt; words = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;tmp/&quot;</span> + i + <span class="string">&quot;.txt&quot;</span>)))) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">word</span> <span class="operator">=</span> in.readLine();</span><br><span class="line">            <span class="keyword">if</span> (word == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            words.add(word);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> words;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6a32eea2-e5a0-46cb-a7ed-2f2789203ef0-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">demo(</span><br><span class="line">        () -&gt;<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,Integer&gt;(),</span><br><span class="line">        (map,words)-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span>(String word :words)&#123;</span><br><span class="line"></span><br><span class="line">             <span class="type">Integer</span> <span class="variable">counter</span> <span class="operator">=</span>map.get(word);</span><br><span class="line">             <span class="type">int</span> <span class="variable">newValue</span> <span class="operator">=</span>counter==<span class="literal">null</span>?<span class="number">1</span>:counter+<span class="number">1</span>;</span><br><span class="line">             map.put(word,newValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;a=<span class="number">189</span>, b=<span class="number">198</span>, c=<span class="number">200</span>, d=<span class="number">188</span>, e=<span class="number">198</span>, f=<span class="number">188</span>, g=<span class="number">173</span>, h=<span class="number">198</span>, i=<span class="number">183</span>, j=<span class="number">200</span>, k=<span class="number">184</span>, l=<span class="number">189</span>, m=<span class="number">162</span>, n=<span class="number">200</span>, o=<span class="number">200</span>, p=<span class="number">194</span>, q=<span class="number">200</span>, r=<span class="number">185</span>, s=<span class="number">200</span>, t=<span class="number">200</span>, u=<span class="number">97</span>, v=<span class="number">92</span>, w=<span class="number">167</span>, x=<span class="number">200</span>, y=<span class="number">198</span>, z=<span class="number">190</span>&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6a32eea2-e5a0-46cb-a7ed-2f2789203ef0-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">demo(</span><br><span class="line">        () -&gt;<span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String,Integer&gt;(),</span><br><span class="line">        (map,words)-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span>(String word :words)&#123;</span><br><span class="line">             <span class="type">Integer</span> <span class="variable">counter</span> <span class="operator">=</span>map.get(word);</span><br><span class="line">             <span class="type">int</span> <span class="variable">newValue</span> <span class="operator">=</span>counter==<span class="literal">null</span>?<span class="number">1</span>:counter+<span class="number">1</span>;</span><br><span class="line">             map.put(word,newValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;a=<span class="number">196</span>, b=<span class="number">199</span>, c=<span class="number">141</span>, d=<span class="number">135</span>, e=<span class="number">188</span>, f=<span class="number">129</span>, g=<span class="number">183</span>, h=<span class="number">184</span>, i=<span class="number">132</span>, j=<span class="number">130</span>, k=<span class="number">169</span>, l=<span class="number">48</span>, m=<span class="number">141</span>, n=<span class="number">185</span>, o=<span class="number">197</span>, p=<span class="number">41</span>, q=<span class="number">34</span>, r=<span class="number">105</span>, s=<span class="number">199</span>, t=<span class="number">55</span>, u=<span class="number">186</span>, v=<span class="number">158</span>, w=<span class="number">67</span>, x=<span class="number">69</span>, y=<span class="number">125</span>, z=<span class="number">188</span>&#125;</span><br></pre></td></tr></table></figure><p>é”™è¯¯åŸå› ï¼š</p><ul><li>ConcurrentHashMapè™½ç„¶æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¤šä¸ªæ–¹æ³•çš„ç»„åˆå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="6a32eea2-e5a0-46cb-a7ed-2f2789203ef0-4"><p>åŸæ¥æ˜¯å…ˆè¦æ£€æŸ¥è¿™ä¸ªkeyæœ‰æ²¡æœ‰ï¼Œæ²¡æœ‰çš„è¯è¿›è¡ŒPutï¼Œè¿™ä¸ªç»„åˆå°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„äº†ã€‚</p><p>computIfAbsentæ–¹æ³•çš„ä½œç”¨æ˜¯ï¼šå½“mapä¸­ä¸å­˜åœ¨ä»¥å‚æ•°1ä¸ºkeyå¯¹åº”çš„valueæ—¶ï¼Œä¼šå°†å‚æ•°2å‡½æ•°å¼æ¥å£çš„è¿”å›å€¼ä½œä¸ºvalueï¼Œputè¿›mapä¸­ï¼Œç„¶åè¿”å›è¯¥valueã€‚å¦‚æœå­˜åœ¨keyï¼Œåˆ™ç›´æ¥è¿”å›valueã€‚ä»¥ä¸Šä¸¤éƒ¨å‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">demo(</span><br><span class="line">        () -&gt; <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, LongAdder&gt;(<span class="number">8</span>,<span class="number">0.75f</span>,<span class="number">8</span>),</span><br><span class="line"></span><br><span class="line">        (map, words) -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¦‚æœç¼ºå°‘ä¸€ä¸ª keyï¼Œåˆ™è®¡ç®—ç”Ÿæˆä¸€ä¸ª value , ç„¶åå°†  key value æ”¾å…¥ map</span></span><br><span class="line">              <span class="comment">// ä¿è¯ get Put åŸå­æ€§</span></span><br><span class="line">                <span class="type">LongAdder</span> <span class="variable">value</span> <span class="operator">=</span> map.computeIfAbsent(word, (key) -&gt; <span class="keyword">new</span> <span class="title class_">LongAdder</span>());</span><br><span class="line">                <span class="comment">// æ‰§è¡Œç´¯åŠ </span></span><br><span class="line">              <span class="comment">// ä¿è¯ç´¯åŠ åŸå­æ€§</span></span><br><span class="line">                value.increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;a=<span class="number">200</span>, b=<span class="number">200</span>, c=<span class="number">200</span>, d=<span class="number">200</span>, e=<span class="number">200</span>, f=<span class="number">200</span>, g=<span class="number">200</span>, h=<span class="number">200</span>, i=<span class="number">200</span>, j=<span class="number">200</span>, k=<span class="number">200</span>, l=<span class="number">200</span>, m=<span class="number">200</span>, n=<span class="number">200</span>, o=<span class="number">200</span>, p=<span class="number">200</span>, q=<span class="number">200</span>, r=<span class="number">200</span>, s=<span class="number">200</span>, t=<span class="number">200</span>, u=<span class="number">200</span>, v=<span class="number">200</span>, w=<span class="number">200</span>, x=<span class="number">200</span>, y=<span class="number">200</span>, z=<span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="2-1-ConcurrentHashMap-åŸç†">2.1 ConcurrentHashMap åŸç†</h3><h4 id="2-1-1-HashMap-å¹¶å‘æ­»é“¾">2.1.1 HashMap å¹¶å‘æ­»é“¾</h4><p>æ³¨æ„</p><ul><li>è¦åœ¨ JDK 7 ä¸‹è¿è¡Œï¼Œå¦åˆ™æ‰©å®¹æœºåˆ¶å’Œ hash çš„è®¡ç®—æ–¹æ³•éƒ½å˜äº†ï¼ˆJDK7 æ’å…¥é‡‡ç”¨å¤´æ’æ³• JDKé‡‡ç”¨å°¾æ’æ³• ä¸ƒä¸Šå…«ä¸‹ï¼‰</li><li>ä»¥ä¸‹æµ‹è¯•ä»£ç æ˜¯ç²¾å¿ƒå‡†å¤‡çš„ï¼Œä¸è¦éšä¾¿æ”¹åŠ¨ JDK7 æ‰©å®¹å¹¶å‘æ­»é“¾</li></ul><div class="tabs" id="52ba4830-c292-46ee-b675-b4b7d2516a78"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#52ba4830-c292-46ee-b675-b4b7d2516a78-1"><i class="fas fa-bug"></i>æµ‹è¯•ä»£ç </button></li><li class="tab"><button type="button" data-href="#52ba4830-c292-46ee-b675-b4b7d2516a78-2"><i class="fas fa-cannabis"></i>æ­»é“¾å¤ç°</button></li><li class="tab"><button type="button" data-href="#52ba4830-c292-46ee-b675-b4b7d2516a78-3"><i class="fas fa-candy-cane"></i>æºç å¤ç°</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="52ba4830-c292-46ee-b675-b4b7d2516a78-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// 1, 35, 16, 50 å½“å¤§å°ä¸º16æ—¶ï¼Œå®ƒä»¬åœ¨ä¸€ä¸ªæ¡¶å†…</span></span><br><span class="line">    <span class="keyword">final</span> HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line">    <span class="comment">// æ”¾ 12 ä¸ªå…ƒç´ </span></span><br><span class="line">    map.put(<span class="number">2</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">3</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">4</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">5</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">6</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">7</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">8</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">9</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">10</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">16</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">35</span>, <span class="literal">null</span>);</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="literal">null</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰©å®¹å‰å¤§å°[main]:&quot;</span>+map.size());</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// æ”¾ç¬¬ 13 ä¸ªå…ƒç´ , å‘ç”Ÿæ‰©å®¹</span></span><br><span class="line">            map.put(<span class="number">50</span>, <span class="literal">null</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰©å®¹åå¤§å°[Thread-0]:&quot;</span>+map.size());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// æ”¾ç¬¬ 13 ä¸ªå…ƒç´ , å‘ç”Ÿæ‰©å®¹</span></span><br><span class="line">            map.put(<span class="number">50</span>, <span class="literal">null</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰©å®¹åå¤§å°[Thread-1]:&quot;</span>+map.size());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != h &amp;&amp; k <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        <span class="keyword">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br><span class="line">    &#125;</span><br><span class="line">    h ^= k.hashCode();</span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">20</span>) ^ (h &gt;&gt;&gt; <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="number">7</span>) ^ (h &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="52ba4830-c292-46ee-b675-b4b7d2516a78-2"><p>è°ƒè¯•å·¥å…·ä½¿ç”¨ idea</p><p>åœ¨ HashMap æºç  590 è¡ŒåŠ æ–­ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> newTable.length;</span><br></pre></td></tr></table></figure><p>æ–­ç‚¹çš„æ¡ä»¶å¦‚ä¸‹ï¼Œç›®çš„æ˜¯è®© HashMap åœ¨æ‰©å®¹ä¸º 32 æ—¶ï¼Œå¹¶ä¸”çº¿ç¨‹ä¸º Thread-0 æˆ– Thread-1 æ—¶åœä¸‹æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">newTable.length==<span class="number">32</span> &amp;&amp;</span><br><span class="line"> (</span><br><span class="line"> Thread.currentThread().getName().equals(<span class="string">&quot;Thread-0&quot;</span>)||</span><br><span class="line"> Thread.currentThread().getName().equals(<span class="string">&quot;Thread-1&quot;</span>)</span><br><span class="line"> )</span><br></pre></td></tr></table></figure><p>æ–­ç‚¹æš‚åœæ–¹å¼é€‰æ‹© Threadï¼Œå¦åˆ™åœ¨è°ƒè¯• Thread-0 æ—¶ï¼ŒThread-1 æ— æ³•æ¢å¤è¿è¡Œ</p><p>è¿è¡Œä»£ç ï¼Œç¨‹åºåœ¨é¢„æ–™çš„æ–­ç‚¹ä½ç½®åœäº†ä¸‹æ¥ï¼Œè¾“å‡º</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">é•¿åº¦ä¸º16æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key </span><br><span class="line">1 </span><br><span class="line">16 </span><br><span class="line">35 </span><br><span class="line">50 </span><br><span class="line">é•¿åº¦ä¸º32æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key </span><br><span class="line">1 </span><br><span class="line">35 </span><br><span class="line">æ‰©å®¹å‰å¤§å°[main]:12 </span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿›å…¥æ‰©å®¹æµç¨‹è°ƒè¯•</p><p>åœ¨ HashMap æºç  594 è¡ŒåŠ æ–­ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Entry&lt;K,V&gt; next = e.next; <span class="comment">// 593</span></span><br><span class="line"><span class="keyword">if</span> (rehash) <span class="comment">// 594</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸ºäº†è§‚å¯Ÿ e èŠ‚ç‚¹å’Œ next èŠ‚ç‚¹çš„çŠ¶æ€ï¼ŒThread-0 å•æ­¥æ‰§è¡Œåˆ° 594 è¡Œï¼Œå† 594 å¤„å†æ·»åŠ ä¸€ä¸ªæ–­ç‚¹ï¼ˆæ¡ä»¶ Thread.currentThread().getName().equals(â€œThread-0â€)ï¼‰</p><p>è¿™æ—¶å¯ä»¥åœ¨ Variables é¢æ¿è§‚å¯Ÿåˆ° e å’Œ next å˜é‡ï¼Œä½¿ç”¨<code>view as -&gt; Object</code>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e (<span class="number">1</span>)-&gt;(<span class="number">35</span>)-&gt;(<span class="number">16</span>)-&gt;<span class="literal">null</span> </span><br><span class="line"><span class="title function_">next</span> <span class="params">(<span class="number">35</span>)</span>-&gt;(<span class="number">16</span>)-&gt;<span class="literal">null</span> </span><br></pre></td></tr></table></figure><p>åœ¨ Threads é¢æ¿é€‰ä¸­ Thread-1 æ¢å¤è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºæ–°çš„å†…å®¹å¦‚ä¸‹ï¼ŒThread-1 æ‰©å®¹å·²å®Œæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newTable[<span class="number">1</span>] (<span class="number">35</span>)-&gt;(<span class="number">1</span>)-&gt;<span class="literal">null</span> </span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‰©å®¹åå¤§å°:13 </span><br></pre></td></tr></table></figure><p>è¿™æ—¶ Thread-0 è¿˜åœåœ¨ 594 å¤„ï¼Œ Variables é¢æ¿å˜é‡çš„çŠ¶æ€å·²ç»å˜åŒ–ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e (<span class="number">1</span>)-&gt;<span class="literal">null</span> </span><br><span class="line"><span class="title function_">next</span> <span class="params">(<span class="number">35</span>)</span>-&gt;(<span class="number">1</span>)-&gt;<span class="literal">null</span> </span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸º Thread-1 æ‰©å®¹æ—¶é“¾è¡¨ä¹Ÿæ˜¯ååŠ å…¥çš„å…ƒç´ æ”¾å…¥é“¾è¡¨å¤´ï¼Œå› æ­¤é“¾è¡¨å°±å€’è¿‡æ¥äº†ï¼Œä½† Thread-1 è™½ç„¶ç»“ æœæ­£ç¡®ï¼Œä½†å®ƒç»“æŸå Thread-0 è¿˜è¦ç»§ç»­è¿è¡Œ</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥å•æ­¥è°ƒè¯•ï¼ˆF8ï¼‰è§‚å¯Ÿæ­»é“¾çš„äº§ç”Ÿäº†</p><p>ä¸‹ä¸€è½®å¾ªç¯åˆ° 594ï¼Œå°† e æ¬è¿åˆ° newTable é“¾è¡¨å¤´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">newTable[<span class="number">1</span>] (<span class="number">1</span>)-&gt;<span class="literal">null</span> </span><br><span class="line"><span class="title function_">e</span> <span class="params">(<span class="number">35</span>)</span>-&gt;(<span class="number">1</span>)-&gt;<span class="literal">null</span> </span><br><span class="line"><span class="title function_">next</span> <span class="params">(<span class="number">1</span>)</span>-&gt;<span class="literal">null</span></span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€è½®å¾ªç¯åˆ° 594ï¼Œå°† e æ¬è¿åˆ° newTable é“¾è¡¨å¤´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">newTable[<span class="number">1</span>] (<span class="number">35</span>)-&gt;(<span class="number">1</span>)-&gt;<span class="literal">null</span> </span><br><span class="line"><span class="title function_">e</span> <span class="params">(<span class="number">1</span>)</span>-&gt;<span class="literal">null</span> </span><br><span class="line">next <span class="literal">null</span> </span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">e.next = newTable[<span class="number">1</span>];</span><br><span class="line"><span class="comment">// è¿™æ—¶ e (1,35)</span></span><br><span class="line"><span class="comment">// è€Œ newTable[1] (35,1)-&gt;(1,35) å› ä¸ºæ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">newTable[<span class="number">1</span>] = e; </span><br><span class="line"><span class="comment">// å†å°è¯•å°† e ä½œä¸ºé“¾è¡¨å¤´, æ­»é“¾å·²æˆ</span></span><br><span class="line">e = next;</span><br><span class="line"><span class="comment">// è™½ç„¶ next æ˜¯ null, ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªé“¾è¡¨çš„å¤åˆ¶, ä½†æ­»é“¾å·²ç»å½¢æˆäº†</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="52ba4830-c292-46ee-b675-b4b7d2516a78-3"><p>HashMap çš„å¹¶å‘æ­»é“¾å‘ç”Ÿåœ¨æ‰©å®¹æ—¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°† table è¿ç§»è‡³ newTable</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(Entry[] newTable, <span class="type">boolean</span> rehash)</span> &#123; </span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> newTable.length;</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e : table) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">null</span> != e) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">            <span class="comment">// 1 å¤„</span></span><br><span class="line">            <span class="keyword">if</span> (rehash) &#123;</span><br><span class="line">                e.hash = <span class="literal">null</span> == e.key ? <span class="number">0</span> : hash(e.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(e.hash, newCapacity);</span><br><span class="line">            <span class="comment">// 2 å¤„</span></span><br><span class="line">            <span class="comment">// å°†æ–°å…ƒç´ åŠ å…¥ newTable[i], åŸ newTable[i] ä½œä¸ºæ–°å…ƒç´ çš„ next</span></span><br><span class="line">            e.next = newTable[i];</span><br><span class="line">            newTable[i] = e;</span><br><span class="line">            e = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾ map ä¸­åˆå§‹å…ƒç´ æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">åŸå§‹é“¾è¡¨ï¼Œæ ¼å¼ï¼š[ä¸‹æ ‡] (key,next)</span><br><span class="line">[<span class="number">1</span>] (<span class="number">1</span>,<span class="number">35</span>)-&gt;(<span class="number">35</span>,<span class="number">16</span>)-&gt;(<span class="number">16</span>,<span class="literal">null</span>)</span><br><span class="line">çº¿ç¨‹ a æ‰§è¡Œåˆ° <span class="number">1</span> å¤„ ï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ e ä¸º (<span class="number">1</span>,<span class="number">35</span>)ï¼Œè€Œå±€éƒ¨å˜é‡ next ä¸º (<span class="number">35</span>,<span class="number">16</span>) çº¿ç¨‹ a æŒ‚èµ·</span><br><span class="line">çº¿ç¨‹ b å¼€å§‹æ‰§è¡Œ</span><br><span class="line">ç¬¬ä¸€æ¬¡å¾ªç¯</span><br><span class="line">[<span class="number">1</span>] (<span class="number">1</span>,<span class="literal">null</span>)</span><br><span class="line">ç¬¬äºŒæ¬¡å¾ªç¯</span><br><span class="line">[<span class="number">1</span>] (<span class="number">35</span>,<span class="number">1</span>)-&gt;(<span class="number">1</span>,<span class="literal">null</span>)</span><br><span class="line">ç¬¬ä¸‰æ¬¡å¾ªç¯</span><br><span class="line">[<span class="number">1</span>] (<span class="number">35</span>,<span class="number">1</span>)-&gt;(<span class="number">1</span>,<span class="literal">null</span>)</span><br><span class="line">[<span class="number">17</span>] (<span class="number">16</span>,<span class="literal">null</span>)</span><br><span class="line">åˆ‡æ¢å›çº¿ç¨‹ aï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ e å’Œ next è¢«æ¢å¤ï¼Œå¼•ç”¨æ²¡å˜ä½†å†…å®¹å˜äº†ï¼še çš„å†…å®¹è¢«æ”¹ä¸º (<span class="number">1</span>,<span class="literal">null</span>)ï¼Œè€Œ next çš„å†…</span><br><span class="line">å®¹è¢«æ”¹ä¸º (<span class="number">35</span>,<span class="number">1</span>) å¹¶é“¾å‘ (<span class="number">1</span>,<span class="literal">null</span>)</span><br><span class="line">ç¬¬ä¸€æ¬¡å¾ªç¯</span><br><span class="line">[<span class="number">1</span>] (<span class="number">1</span>,<span class="literal">null</span>)</span><br><span class="line">ç¬¬äºŒæ¬¡å¾ªç¯ï¼Œæ³¨æ„è¿™æ—¶ e æ˜¯ (<span class="number">35</span>,<span class="number">1</span>) å¹¶é“¾å‘ (<span class="number">1</span>,<span class="literal">null</span>) æ‰€ä»¥ next åˆæ˜¯ (<span class="number">1</span>,<span class="literal">null</span>)</span><br><span class="line">[<span class="number">1</span>] (<span class="number">35</span>,<span class="number">1</span>)-&gt;(<span class="number">1</span>,<span class="literal">null</span>)</span><br><span class="line">ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼Œe æ˜¯ (<span class="number">1</span>,<span class="literal">null</span>)ï¼Œè€Œ next æ˜¯ <span class="literal">null</span>ï¼Œä½† e è¢«æ”¾å…¥é“¾è¡¨å¤´ï¼Œè¿™æ · e.next å˜æˆäº† <span class="number">35</span> ï¼ˆ<span class="number">2</span> å¤„ï¼‰</span><br><span class="line">[<span class="number">1</span>] (<span class="number">1</span>,<span class="number">35</span>)-&gt;(<span class="number">35</span>,<span class="number">1</span>)-&gt;(<span class="number">1</span>,<span class="number">35</span>)</span><br><span class="line">å·²ç»æ˜¯æ­»é“¾äº†</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>å°ç»“</strong></p><ul><li>ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨äº†éçº¿ç¨‹å®‰å…¨çš„ map é›†åˆ</li><li>JDK 8 è™½ç„¶å°†æ‰©å®¹ç®—æ³•åšäº†è°ƒæ•´ï¼Œä¸å†å°†å…ƒç´ åŠ å…¥é“¾è¡¨å¤´ï¼ˆè€Œæ˜¯ä¿æŒä¸æ‰©å®¹å‰ä¸€æ ·çš„é¡ºåºï¼‰ï¼Œä½†ä»ä¸æ„å‘³ç€èƒ½ å¤Ÿåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½å¤Ÿå®‰å…¨æ‰©å®¹ï¼Œè¿˜ä¼šå‡ºç°å…¶å®ƒé—®é¢˜ï¼ˆå¦‚æ‰©å®¹ä¸¢æ•°æ®ï¼‰</li></ul><h4 id="2-1-2-JDK8-CHM">2.1.2 JDK8 CHM</h4><div class="tabs" id="828127d7-517f-4c92-83cb-1be3abb84ae2"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#828127d7-517f-4c92-83cb-1be3abb84ae2-1"><i class="fas fa-bug"></i>é‡è¦å±æ€§å’Œå†…éƒ¨ç±»</button></li><li class="tab"><button type="button" data-href="#828127d7-517f-4c92-83cb-1be3abb84ae2-2"><i class="fas fa-cannabis"></i>é‡è¦æ–¹æ³•</button></li><li class="tab"><button type="button" data-href="#828127d7-517f-4c92-83cb-1be3abb84ae2-3"><i class="fas fa-candy-cane"></i>æ„é€ å™¨åˆ†æ</button></li><li class="tab"><button type="button" data-href="#828127d7-517f-4c92-83cb-1be3abb84ae2-4"><i class="fas fa-child"></i>getæµç¨‹</button></li><li class="tab"><button type="button" data-href="#828127d7-517f-4c92-83cb-1be3abb84ae2-5"><i class="fas fa-award"></i>put æµç¨‹</button></li><li class="tab"><button type="button" data-href="#828127d7-517f-4c92-83cb-1be3abb84ae2-6"><i class="fas fa-baseball-ball"></i>sizeè®¡ç®—</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="828127d7-517f-4c92-83cb-1be3abb84ae2-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤ä¸º 0</span></span><br><span class="line"><span class="comment">// å½“åˆå§‹åŒ–æ—¶, ä¸º -1</span></span><br><span class="line"><span class="comment">// å½“æ‰©å®¹æ—¶, ä¸º -(1 + æ‰©å®¹çº¿ç¨‹æ•°)</span></span><br><span class="line"><span class="comment">// å½“åˆå§‹åŒ–æˆ–æ‰©å®¹å®Œæˆåï¼Œä¸º ä¸‹ä¸€æ¬¡çš„æ‰©å®¹çš„é˜ˆå€¼å¤§å°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="type">int</span> sizeCtl;</span><br><span class="line"><span class="comment">// æ•´ä¸ª ConcurrentHashMap å°±æ˜¯ä¸€ä¸ª Node[]</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry&lt;K,V&gt; &#123;&#125;</span><br><span class="line"><span class="comment">// hash è¡¨</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"><span class="comment">// æ‰©å®¹æ—¶çš„ æ–° hash è¡¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] nextTable;</span><br><span class="line"><span class="comment">// æ‰©å®¹æ—¶å¦‚æœæŸä¸ª bin è¿ç§»å®Œæ¯•, ç”¨ ForwardingNode ä½œä¸ºæ—§ table bin çš„å¤´ç»“ç‚¹</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ForwardingNode</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">Node</span>&lt;K,V&gt; &#123;&#125;</span><br><span class="line"><span class="comment">// ç”¨åœ¨ compute ä»¥åŠ computeIfAbsent æ—¶, ç”¨æ¥å ä½, è®¡ç®—å®Œæˆåæ›¿æ¢ä¸ºæ™®é€š Node</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ReservationNode</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">Node</span>&lt;K,V&gt; &#123;&#125;</span><br><span class="line"><span class="comment">// ä½œä¸º treebin çš„å¤´èŠ‚ç‚¹, å­˜å‚¨ root å’Œ first</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TreeBin</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">Node</span>&lt;K,V&gt; &#123;&#125;</span><br><span class="line"><span class="comment">// ä½œä¸º treebin çš„èŠ‚ç‚¹, å­˜å‚¨ parent, left, right</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">Node</span>&lt;K,V&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="828127d7-517f-4c92-83cb-1be3abb84ae2-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å– Node[] ä¸­ç¬¬ i ä¸ª Node</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; Node&lt;K,V&gt; <span class="title function_">tabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="type">int</span> i)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// cas ä¿®æ”¹ Node[] ä¸­ç¬¬ i ä¸ª Node çš„å€¼, c ä¸ºæ—§å€¼, v ä¸ºæ–°å€¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="type">boolean</span> <span class="title function_">casTabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="type">int</span> i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç›´æ¥ä¿®æ”¹ Node[] ä¸­ç¬¬ i ä¸ª Node çš„å€¼, v ä¸ºæ–°å€¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="keyword">void</span> <span class="title function_">setTabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="type">int</span> i, Node&lt;K,V&gt; v)</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="828127d7-517f-4c92-83cb-1be3abb84ae2-3"><p>å¯ä»¥çœ‹åˆ°å®ç°äº†æ‡’æƒ°åˆå§‹åŒ–ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä»…ä»…è®¡ç®—äº† table çš„å¤§å°ï¼Œä»¥ååœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰ä¼šçœŸæ­£åˆ›å»º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ConcurrentHashMap</span><span class="params">(<span class="type">int</span> initialCapacity, <span class="type">float</span> loadFactor, <span class="type">int</span> concurrencyLevel)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(loadFactor &gt; <span class="number">0.0f</span>) || initialCapacity &lt; <span class="number">0</span> || concurrencyLevel &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; concurrencyLevel) <span class="comment">// Use at least as many bins</span></span><br><span class="line">        initialCapacity = concurrencyLevel; <span class="comment">// as estimated threads</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> (<span class="type">long</span>)(<span class="number">1.0</span> + (<span class="type">long</span>)initialCapacity / loadFactor);</span><br><span class="line">    <span class="comment">// tableSizeFor ä»ç„¶æ˜¯ä¿è¯è®¡ç®—çš„å¤§å°æ˜¯ 2^n, å³ 16,32,64 ... </span></span><br><span class="line">    <span class="type">int</span> <span class="variable">cap</span> <span class="operator">=</span> (size &gt;= (<span class="type">long</span>)MAXIMUM_CAPACITY) ?</span><br><span class="line">        MAXIMUM_CAPACITY : tableSizeFor((<span class="type">int</span>)size);</span><br><span class="line">    <span class="built_in">this</span>.sizeCtl = cap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="828127d7-517f-4c92-83cb-1be3abb84ae2-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; <span class="type">int</span> n, eh; K ek;</span><br><span class="line">    <span class="comment">// spread æ–¹æ³•èƒ½ç¡®ä¿è¿”å›ç»“æœæ˜¯æ­£æ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> spread(key.hashCode());</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (e = tabAt(tab, (n - <span class="number">1</span>) &amp; h)) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå¤´ç»“ç‚¹å·²ç»æ˜¯è¦æŸ¥æ‰¾çš„ key</span></span><br><span class="line">        <span class="keyword">if</span> ((eh = e.hash) == h) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((ek = e.key) == key || (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek)))</span><br><span class="line">                <span class="keyword">return</span> e.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// hash ä¸ºè´Ÿæ•°è¡¨ç¤ºè¯¥ bin åœ¨æ‰©å®¹ä¸­æˆ–æ˜¯ treebin, è¿™æ—¶è°ƒç”¨ find æ–¹æ³•æ¥æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (eh &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> (p = e.find(h, key)) != <span class="literal">null</span> ? p.val : <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// æ­£å¸¸éå†é“¾è¡¨, ç”¨ equals æ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.hash == h &amp;&amp;</span><br><span class="line">                ((ek = e.key) == key || (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek))))</span><br><span class="line">                <span class="keyword">return</span> e.val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><ul><li>å¦‚æœtableä¸ä¸ºç©ºä¸”é•¿åº¦å¤§äº0ä¸”ç´¢å¼•ä½ç½®æœ‰å…ƒç´ <ul><li>if å¤´èŠ‚ç‚¹keyçš„hashå€¼ç›¸ç­‰<ul><li>å¤´èŠ‚ç‚¹çš„keyæŒ‡å‘åŒä¸€ä¸ªåœ°å€æˆ–è€…equals<ul><li>è¿”å›value</li></ul></li></ul></li><li>else if å¤´èŠ‚ç‚¹çš„hashä¸ºè´Ÿæ•°ï¼ˆbinåœ¨æ‰©å®¹æˆ–è€…æ˜¯treebinï¼‰<ul><li>è°ƒç”¨findæ–¹æ³•æŸ¥æ‰¾</li></ul></li><li>è¿›å…¥å¾ªç¯ï¼ˆeä¸ä¸ºç©ºï¼‰ï¼š<ul><li>èŠ‚ç‚¹keyçš„hashå€¼ç›¸ç­‰ï¼Œä¸”keyæŒ‡å‘åŒä¸€ä¸ªåœ°å€æˆ–equals<ul><li>è¿”å›value</li></ul></li></ul></li></ul></li><li>è¿”å›null</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="828127d7-517f-4c92-83cb-1be3abb84ae2-5"><p>ä»¥ä¸‹æ•°ç»„ç®€ç§°ï¼ˆtableï¼‰ï¼Œé“¾è¡¨ç®€ç§°ï¼ˆbinï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(key, value, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(K key, V value, <span class="type">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span> || value == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="comment">// å…¶ä¸­ spread æ–¹æ³•ä¼šç»¼åˆé«˜ä½ä½ä½, å…·æœ‰æ›´å¥½çš„ hash æ€§</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> spread(key.hashCode());</span><br><span class="line">    <span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">        <span class="comment">// f æ˜¯é“¾è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// fh æ˜¯é“¾è¡¨å¤´ç»“ç‚¹çš„ hash</span></span><br><span class="line">        <span class="comment">// i æ˜¯é“¾è¡¨åœ¨ table ä¸­çš„ä¸‹æ ‡</span></span><br><span class="line">        Node&lt;K,V&gt; f; <span class="type">int</span> n, i, fh;</span><br><span class="line">        <span class="comment">// è¦åˆ›å»º table</span></span><br><span class="line">        <span class="keyword">if</span> (tab == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ– table ä½¿ç”¨äº† cas, æ— éœ€ synchronized åˆ›å»ºæˆåŠŸ, è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯</span></span><br><span class="line">            tab = initTable();</span><br><span class="line">        <span class="comment">// è¦åˆ›å»ºé“¾è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ·»åŠ é“¾è¡¨å¤´ä½¿ç”¨äº† cas, æ— éœ€ synchronized</span></span><br><span class="line">            <span class="keyword">if</span> (casTabAt(tab, i, <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="literal">null</span>)))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¸®å¿™æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">            <span class="comment">// å¸®å¿™ä¹‹å, è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯</span></span><br><span class="line">            tab = helpTransfer(tab, f);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldVal</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">// é”ä½é“¾è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                <span class="comment">// å†æ¬¡ç¡®è®¤é“¾è¡¨å¤´èŠ‚ç‚¹æ²¡æœ‰è¢«ç§»åŠ¨</span></span><br><span class="line">                <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                    <span class="comment">// é“¾è¡¨</span></span><br><span class="line">                    <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        binCount = <span class="number">1</span>;</span><br><span class="line">                        <span class="comment">// éå†é“¾è¡¨</span></span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                            K ek;</span><br><span class="line">                            <span class="comment">// æ‰¾åˆ°ç›¸åŒçš„ key</span></span><br><span class="line">                            <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                                ((ek = e.key) == key ||</span><br><span class="line">                                 (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                oldVal = e.val;</span><br><span class="line">                                <span class="comment">// æ›´æ–°</span></span><br><span class="line">                                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                    e.val = value;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            Node&lt;K,V&gt; pred = e;</span><br><span class="line">                            <span class="comment">// å·²ç»æ˜¯æœ€åçš„èŠ‚ç‚¹äº†, æ–°å¢ Node, è¿½åŠ è‡³é“¾è¡¨å°¾</span></span><br><span class="line">                            <span class="keyword">if</span> ((e = e.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                                pred.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key,</span><br><span class="line">                                                          value, <span class="literal">null</span>);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// çº¢é»‘æ ‘</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                        Node&lt;K,V&gt; p;</span><br><span class="line">                        binCount = <span class="number">2</span>;</span><br><span class="line">                        <span class="comment">// putTreeVal ä¼šçœ‹ key æ˜¯å¦å·²ç»åœ¨æ ‘ä¸­, æ˜¯, åˆ™è¿”å›å¯¹åº”çš„ TreeNode</span></span><br><span class="line">                        <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                                              value)) != <span class="literal">null</span>) &#123;</span><br><span class="line">                            oldVal = p.val;</span><br><span class="line">                            <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                p.val = value;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// é‡Šæ”¾é“¾è¡¨å¤´èŠ‚ç‚¹çš„é”</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123; </span><br><span class="line">                <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                    <span class="comment">// å¦‚æœé“¾è¡¨é•¿åº¦ &gt;= æ ‘åŒ–é˜ˆå€¼(8), è¿›è¡Œé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                    treeifyBin(tab, i);</span><br><span class="line">                <span class="keyword">if</span> (oldVal != <span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> oldVal;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¢åŠ  size è®¡æ•°</span></span><br><span class="line">    addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; <span class="type">int</span> sc;</span><br><span class="line">    <span class="keyword">while</span> ((tab = table) == <span class="literal">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((sc = sizeCtl) &lt; <span class="number">0</span>)</span><br><span class="line">            Thread.<span class="keyword">yield</span>();</span><br><span class="line">        <span class="comment">// å°è¯•å°† sizeCtl è®¾ç½®ä¸º -1ï¼ˆè¡¨ç¤ºåˆå§‹åŒ– tableï¼‰</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc, -<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="comment">// è·å¾—é”, åˆ›å»º table, è¿™æ—¶å…¶å®ƒçº¿ç¨‹ä¼šåœ¨ while() å¾ªç¯ä¸­ yield ç›´è‡³ table åˆ›å»º</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> (sc &gt; <span class="number">0</span>) ? sc : DEFAULT_CAPACITY;</span><br><span class="line">                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>&lt;?,?&gt;[n];</span><br><span class="line">                    table = tab = nt;</span><br><span class="line">                    sc = n - (n &gt;&gt;&gt; <span class="number">2</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                sizeCtl = sc;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tab;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// check æ˜¯ä¹‹å‰ binCount çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">addCount</span><span class="params">(<span class="type">long</span> x, <span class="type">int</span> check)</span> &#123;</span><br><span class="line">    CounterCell[] as; <span class="type">long</span> b, s;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="comment">// å·²ç»æœ‰äº† counterCells, å‘ cell ç´¯åŠ </span></span><br><span class="line">        (as = counterCells) != <span class="literal">null</span> ||</span><br><span class="line">        <span class="comment">// è¿˜æ²¡æœ‰, å‘ baseCount ç´¯åŠ </span></span><br><span class="line">        !U.compareAndSwapLong(<span class="built_in">this</span>, BASECOUNT, b = baseCount, s = b + x)</span><br><span class="line">    ) &#123;</span><br><span class="line">        CounterCell a; <span class="type">long</span> v; <span class="type">int</span> m;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            <span class="comment">// è¿˜æ²¡æœ‰ counterCells</span></span><br><span class="line">            as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">            <span class="comment">// è¿˜æ²¡æœ‰ cell</span></span><br><span class="line">            (a = as[ThreadLocalRandom.getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">            <span class="comment">// cell cas å¢åŠ è®¡æ•°å¤±è´¥</span></span><br><span class="line">            !(uncontended = U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºç´¯åŠ å•å…ƒæ•°ç»„å’Œcell, ç´¯åŠ é‡è¯•</span></span><br><span class="line">            fullAddCount(x, uncontended);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (check &lt;= <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// è·å–å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">        s = sumCount();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (check &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab, nt; <span class="type">int</span> n, sc;</span><br><span class="line">        <span class="keyword">while</span> (s &gt;= (<span class="type">long</span>)(sc = sizeCtl) &amp;&amp; (tab = table) != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">               (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">rs</span> <span class="operator">=</span> resizeStamp(n);</span><br><span class="line">            <span class="keyword">if</span> (sc &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="number">1</span> ||</span><br><span class="line">                    sc == rs + MAX_RESIZERS || (nt = nextTable) == <span class="literal">null</span> ||</span><br><span class="line">                    transferIndex &lt;= <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// newtable å·²ç»åˆ›å»ºäº†ï¼Œå¸®å¿™æ‰©å®¹</span></span><br><span class="line">                <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc, sc + <span class="number">1</span>))</span><br><span class="line">                    transfer(tab, nt);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// éœ€è¦æ‰©å®¹ï¼Œè¿™æ—¶ newtable æœªåˆ›å»º</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc,</span><br><span class="line">                                         (rs &lt;&lt; RESIZE_STAMP_SHIFT) + <span class="number">2</span>))</span><br><span class="line">                transfer(tab, <span class="literal">null</span>);</span><br><span class="line">            s = sumCount();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><ul><li>è¿›å…¥forå¾ªç¯ï¼š<ul><li>if  tableä¸ºnullæˆ–è€…é•¿åº¦ ä¸º0<ul><li>åˆå§‹åŒ–è¡¨</li></ul></li><li>else if ç´¢å¼•å¤„æ— èŠ‚ç‚¹<ul><li>åˆ›å»ºèŠ‚ç‚¹ï¼Œå¡«å…¥keyå’Œvalueï¼Œæ”¾å…¥tableï¼Œé€€å‡ºå¾ªç¯</li></ul></li><li>else if ç´¢å¼•å¤„èŠ‚ç‚¹çš„hashå€¼ä¸ºMOVEï¼ˆForwardingNodeï¼‰ï¼Œè¡¨ç¤ºæ­£åœ¨æ‰©å®¹å’Œè¿ç§»<ul><li>å¸®å¿™</li></ul></li><li>else<ul><li>é”ä½å¤´èŠ‚ç‚¹<ul><li>if å†æ¬¡ç¡®è®¤å¤´èŠ‚ç‚¹æ²¡æœ‰è¢«ç§»åŠ¨<ul><li>if  å¤´èŠ‚ç‚¹hashå€¼å¤§äº0ï¼ˆè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼‰<ul><li>éå†é“¾è¡¨æ‰¾åˆ°å¯¹åº”keyï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºã€‚</li></ul></li><li>else if èŠ‚ç‚¹ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹<ul><li>è°ƒç”¨<code>putTreeVal</code>æŸ¥çœ‹æ˜¯å¦æœ‰å¯¹åº”keyçš„æ•°èŠ‚ç‚¹<ul><li>å¦‚æœæœ‰ä¸”ä¸ºè¦†ç›–æ¨¡å¼ï¼Œå°†å€¼è¦†ç›–ï¼Œè¿”å›æ—§å€¼</li><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºå¹¶æ’å…¥ï¼Œè¿”å›null</li></ul></li></ul></li></ul></li><li>è§£é”</li></ul></li><li>if binCountä¸ä¸º0<ul><li>å¦‚æœbinCountå¤§äºæ ‘åŒ–é˜ˆå€¼8<ul><li>æ ‘åŒ–</li></ul></li><li>å¦‚æœæ—§å€¼ä¸ä¸ºnull<ul><li>è¿”å›æ—§å€¼</li></ul></li><li>break</li></ul></li></ul></li></ul></li><li>å¢åŠ sizeè®¡æ•°</li><li>return null</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="828127d7-517f-4c92-83cb-1be3abb84ae2-6"><p>size è®¡ç®—å®é™…å‘ç”Ÿåœ¨ putï¼Œremove æ”¹å˜é›†åˆå…ƒç´ çš„æ“ä½œä¹‹ä¸­</p><ul><li>æ²¡æœ‰ç«äº‰å‘ç”Ÿï¼Œå‘ baseCount ç´¯åŠ è®¡æ•°</li><li>æœ‰ç«äº‰å‘ç”Ÿï¼Œæ–°å»º counterCellsï¼Œå‘å…¶ä¸­çš„ä¸€ä¸ª cell ç´¯åŠ è®¡<ul><li>counterCells åˆå§‹æœ‰ä¸¤ä¸ª cell</li><li>å¦‚æœè®¡æ•°ç«äº‰æ¯”è¾ƒæ¿€çƒˆï¼Œä¼šåˆ›å»ºæ–°çš„ cell æ¥ç´¯åŠ è®¡æ•°</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">n</span> <span class="operator">=</span> sumCount();</span><br><span class="line">    <span class="keyword">return</span> ((n &lt; <span class="number">0L</span>) ? <span class="number">0</span> :</span><br><span class="line">            (n &gt; (<span class="type">long</span>)Integer.MAX_VALUE) ? Integer.MAX_VALUE :</span><br><span class="line">            (<span class="type">int</span>)n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">final</span> <span class="type">long</span> <span class="title function_">sumCount</span><span class="params">()</span> &#123;</span><br><span class="line">    CounterCell[] as = counterCells; CounterCell a;</span><br><span class="line">    <span class="comment">// å°† baseCount è®¡æ•°ä¸æ‰€æœ‰ cell è®¡æ•°ç´¯åŠ </span></span><br><span class="line">    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> baseCount;</span><br><span class="line">    <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                sum += a.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>æ€»ç»“</p><p><strong>Java 8</strong> æ•°ç»„ï¼ˆNodeï¼‰ +ï¼ˆ é“¾è¡¨ Node | çº¢é»‘æ ‘ TreeNode ï¼‰ ä»¥ä¸‹æ•°ç»„ç®€ç§°ï¼ˆtableï¼‰ï¼Œé“¾è¡¨ç®€ç§°ï¼ˆbinï¼‰</p><ul><li>åˆå§‹åŒ–ï¼Œä½¿ç”¨ cas æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ‡’æƒ°åˆå§‹åŒ– table</li><li>æ ‘åŒ–ï¼Œå½“ table.length &lt; 64 æ—¶ï¼Œå…ˆå°è¯•æ‰©å®¹ï¼Œè¶…è¿‡ 64 æ—¶ï¼Œå¹¶ä¸” bin.length &gt; 8 æ—¶ï¼Œä¼šå°†é“¾è¡¨æ ‘åŒ–ï¼Œæ ‘åŒ–è¿‡ç¨‹ ä¼šç”¨ synchronized é”ä½é“¾è¡¨å¤´</li><li>putï¼Œå¦‚æœè¯¥ bin å°šæœªåˆ›å»ºï¼Œåªéœ€è¦ä½¿ç”¨ cas åˆ›å»º binï¼›å¦‚æœå·²ç»æœ‰äº†ï¼Œé”ä½é“¾è¡¨å¤´è¿›è¡Œåç»­ put æ“ä½œï¼Œå…ƒç´  æ·»åŠ è‡³ bin çš„å°¾éƒ¨</li><li>getï¼Œæ— é”æ“ä½œä»…éœ€è¦ä¿è¯å¯è§æ€§ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­ get æ“ä½œæ‹¿åˆ°çš„æ˜¯ ForwardingNode å®ƒä¼šè®© get æ“ä½œåœ¨æ–° table è¿›è¡Œæœç´¢</li><li>æ‰©å®¹ï¼Œæ‰©å®¹æ—¶ä»¥ bin ä¸ºå•ä½è¿›è¡Œï¼Œéœ€è¦å¯¹ bin è¿›è¡Œ synchronizedï¼Œä½†è¿™æ—¶å¦™çš„æ˜¯å…¶å®ƒç«äº‰çº¿ç¨‹ä¹Ÿä¸æ˜¯æ— äº‹å¯ åšï¼Œå®ƒä»¬ä¼šå¸®åŠ©æŠŠå…¶å®ƒ bin è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹æ—¶å¹³å‡åªæœ‰ 1/6 çš„èŠ‚ç‚¹ä¼šæŠŠå¤åˆ¶åˆ°æ–° table ä¸­</li><li>sizeï¼Œå…ƒç´ ä¸ªæ•°ä¿å­˜åœ¨ baseCount ä¸­ï¼Œå¹¶å‘æ—¶çš„ä¸ªæ•°å˜åŠ¨ä¿å­˜åœ¨ CounterCell[] å½“ä¸­ã€‚æœ€åç»Ÿè®¡æ•°é‡æ—¶ç´¯åŠ  å³å¯</li></ul><p>æºç åˆ†æ <a href="http://www.importnew.com/28263.html">http://www.importnew.com/28263.html</a></p><p>å…¶å®ƒå®ç° <a href="https://github.com/boundary/high-scale-lib">Cliff Clickâ€™s high scale lib</a></p></blockquote><h4 id="2-1-3-JDK7-CHM">2.1.3 JDK7 CHM</h4><p>å®ƒç»´æŠ¤äº†ä¸€ä¸ª segment æ•°ç»„ï¼Œæ¯ä¸ª segment å¯¹åº”ä¸€æŠŠé”</p><ul><li>ä¼˜ç‚¹ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒçš„ segmentï¼Œå®é™…æ˜¯æ²¡æœ‰å†²çªçš„ï¼Œè¿™ä¸ jdk8 ä¸­æ˜¯ç±»ä¼¼çš„</li><li>ç¼ºç‚¹ï¼šSegments æ•°ç»„é»˜è®¤å¤§å°ä¸º16ï¼Œè¿™ä¸ªå®¹é‡åˆå§‹åŒ–æŒ‡å®šåå°±ä¸èƒ½æ”¹å˜äº†ï¼Œå¹¶ä¸”ä¸æ˜¯æ‡’æƒ°åˆå§‹åŒ–</li></ul><div class="tabs" id="5b6f4c97-ee01-4078-ac5f-49d57c177243"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#5b6f4c97-ee01-4078-ac5f-49d57c177243-1"><i class="fas fa-bug"></i>æ„é€ å™¨åˆ†æ</button></li><li class="tab"><button type="button" data-href="#5b6f4c97-ee01-4078-ac5f-49d57c177243-2"><i class="fas fa-cannabis"></i>put æµç¨‹</button></li><li class="tab"><button type="button" data-href="#5b6f4c97-ee01-4078-ac5f-49d57c177243-3"><i class="fas fa-candy-cane"></i>rehashæµç¨‹</button></li><li class="tab"><button type="button" data-href="#5b6f4c97-ee01-4078-ac5f-49d57c177243-4"><i class="fas fa-child"></i>get æµç¨‹</button></li><li class="tab"><button type="button" data-href="#5b6f4c97-ee01-4078-ac5f-49d57c177243-5"><i class="fas fa-cat"></i>size è®¡ç®—</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="5b6f4c97-ee01-4078-ac5f-49d57c177243-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ConcurrentHashMap</span><span class="params">(<span class="type">int</span> initialCapacity, <span class="type">float</span> loadFactor, <span class="type">int</span> concurrencyLevel)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(loadFactor &gt; <span class="number">0</span>) || initialCapacity &lt; <span class="number">0</span> || concurrencyLevel &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    <span class="keyword">if</span> (concurrencyLevel &gt; MAX_SEGMENTS)</span><br><span class="line">        concurrencyLevel = MAX_SEGMENTS;</span><br><span class="line">    <span class="comment">// ssize å¿…é¡»æ˜¯ 2^n, å³ 2, 4, 8, 16 ... è¡¨ç¤ºäº† segments æ•°ç»„çš„å¤§å°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">sshift</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ssize</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (ssize &lt; concurrencyLevel) &#123;</span><br><span class="line">        ++sshift;</span><br><span class="line">        ssize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// segmentShift é»˜è®¤æ˜¯ 32 - 4 = 28</span></span><br><span class="line">    <span class="built_in">this</span>.segmentShift = <span class="number">32</span> - sshift;</span><br><span class="line">    <span class="comment">// segmentMask é»˜è®¤æ˜¯ 15 å³ 0000 0000 0000 1111</span></span><br><span class="line">    <span class="built_in">this</span>.segmentMask = ssize - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> initialCapacity / ssize;</span><br><span class="line">    <span class="keyword">if</span> (c * ssize &lt; initialCapacity)</span><br><span class="line">        ++c;</span><br><span class="line">    <span class="type">int</span> <span class="variable">cap</span> <span class="operator">=</span> MIN_SEGMENT_TABLE_CAPACITY;</span><br><span class="line">    <span class="keyword">while</span> (cap &lt; c)</span><br><span class="line">        cap &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// åˆ›å»º segments and segments[0]</span></span><br><span class="line">    Segment&lt;K,V&gt; s0 =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Segment</span>&lt;K,V&gt;(loadFactor, (<span class="type">int</span>)(cap * loadFactor),</span><br><span class="line">                         (HashEntry&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">HashEntry</span>[cap]);</span><br><span class="line">    Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Segment</span>[ssize];</span><br><span class="line">    UNSAFE.putOrderedObject(ss, SBASE, s0); <span class="comment">// ordered write of segments[0]</span></span><br><span class="line">    <span class="built_in">this</span>.segments = ss;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å®Œæˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317180837785.png" alt="image-20220317180837785" style="zoom:50%;" /><p>å¯ä»¥çœ‹åˆ° ConcurrentHashMap æ²¡æœ‰å®ç°æ‡’æƒ°åˆå§‹åŒ–ï¼Œç©ºé—´å ç”¨ä¸å‹å¥½</p><p>å…¶ä¸­ this.segmentShift å’Œ this.segmentMask çš„ä½œç”¨æ˜¯å†³å®šå°† key çš„ hash ç»“æœåŒ¹é…åˆ°å“ªä¸ª segment</p><p>ä¾‹å¦‚ï¼Œæ ¹æ®æŸä¸€ hash å€¼æ±‚ segment ä½ç½®ï¼Œå…ˆå°†é«˜ä½å‘ä½ä½ç§»åŠ¨ this.segmentShift ä½</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317180919562.png" alt="image-20220317180919562"></p><p>ç»“æœå†ä¸ this.segmentMask åšä½äºè¿ç®—ï¼Œæœ€ç»ˆå¾—åˆ° 1010 å³ä¸‹æ ‡ä¸º 10 çš„ segment</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317180935914.png" alt="image-20220317180935914"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5b6f4c97-ee01-4078-ac5f-49d57c177243-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    Segment&lt;K,V&gt; s;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> hash(key);</span><br><span class="line">    <span class="comment">// è®¡ç®—å‡º segment ä¸‹æ ‡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾— segment å¯¹è±¡, åˆ¤æ–­æ˜¯å¦ä¸º null, æ˜¯åˆ™åˆ›å»ºè¯¥ segment</span></span><br><span class="line">    <span class="keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject </span><br><span class="line">         (segments, (j &lt;&lt; SSHIFT) + SBASE)) == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// è¿™æ—¶ä¸èƒ½ç¡®å®šæ˜¯å¦çœŸçš„ä¸º null, å› ä¸ºå…¶å®ƒçº¿ç¨‹ä¹Ÿå‘ç°è¯¥ segment ä¸º null,</span></span><br><span class="line">        <span class="comment">// å› æ­¤åœ¨ ensureSegment é‡Œç”¨ cas æ–¹å¼ä¿è¯è¯¥ segment å®‰å…¨æ€§</span></span><br><span class="line">        s = ensureSegment(j);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿›å…¥ segment çš„put æµç¨‹</span></span><br><span class="line">    <span class="keyword">return</span> s.put(key, hash, value, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>segment ç»§æ‰¿äº†å¯é‡å…¥é”ï¼ˆReentrantLockï¼‰ï¼Œå®ƒçš„ put æ–¹æ³•ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> V <span class="title function_">put</span><span class="params">(K key, <span class="type">int</span> hash, V value, <span class="type">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class="line">    <span class="comment">// å°è¯•åŠ é”</span></span><br><span class="line">    HashEntry&lt;K,V&gt; node = tryLock() ? <span class="literal">null</span> :</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æˆåŠŸ, è¿›å…¥ scanAndLockForPut æµç¨‹</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å¤šæ ¸ cpu æœ€å¤š tryLock 64 æ¬¡, è¿›å…¥ lock æµç¨‹</span></span><br><span class="line">    <span class="comment">// åœ¨å°è¯•æœŸé—´, è¿˜å¯ä»¥é¡ºä¾¿çœ‹è¯¥èŠ‚ç‚¹åœ¨é“¾è¡¨ä¸­æœ‰æ²¡æœ‰, å¦‚æœæ²¡æœ‰é¡ºä¾¿åˆ›å»ºå‡ºæ¥</span></span><br><span class="line">    scanAndLockForPut(key, hash, value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œåˆ°è¿™é‡Œ segment å·²ç»è¢«æˆåŠŸåŠ é”, å¯ä»¥å®‰å…¨æ‰§è¡Œ</span></span><br><span class="line">    V oldValue;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        HashEntry&lt;K,V&gt;[] tab = table;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (tab.length - <span class="number">1</span>) &amp; hash;</span><br><span class="line">        HashEntry&lt;K,V&gt; first = entryAt(tab, index);</span><br><span class="line">        <span class="keyword">for</span> (HashEntry&lt;K,V&gt; e = first;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ›´æ–°</span></span><br><span class="line">                K k;</span><br><span class="line">                <span class="keyword">if</span> ((k = e.key) == key ||</span><br><span class="line">                    (e.hash == hash &amp;&amp; key.equals(k))) &#123; </span><br><span class="line">                    oldValue = e.value;</span><br><span class="line">                    <span class="keyword">if</span> (!onlyIfAbsent) &#123;</span><br><span class="line">                        e.value = value;</span><br><span class="line">                        ++modCount;</span><br><span class="line">                    &#125; <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                e = e.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ–°å¢</span></span><br><span class="line">                <span class="comment">// 1) ä¹‹å‰ç­‰å¾…é”æ—¶, node å·²ç»è¢«åˆ›å»º, next æŒ‡å‘é“¾è¡¨å¤´</span></span><br><span class="line">                <span class="keyword">if</span> (node != <span class="literal">null</span>)</span><br><span class="line">                    node.setNext(first);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="comment">// 2) åˆ›å»ºæ–° node</span></span><br><span class="line">                    node = <span class="keyword">new</span> <span class="title class_">HashEntry</span>&lt;K,V&gt;(hash, key, value, first);</span><br><span class="line">                <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> count + <span class="number">1</span>; </span><br><span class="line">                <span class="comment">// 3) æ‰©å®¹</span></span><br><span class="line">                <span class="keyword">if</span> (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)</span><br><span class="line">                    rehash(node);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="comment">// å°† node ä½œä¸ºé“¾è¡¨å¤´</span></span><br><span class="line">                    setEntryAt(tab, index, node);</span><br><span class="line">                ++modCount;</span><br><span class="line">                count = c;</span><br><span class="line">                oldValue = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5b6f4c97-ee01-4078-ac5f-49d57c177243-3"><p>å‘ç”Ÿåœ¨ put ä¸­ï¼Œå› ä¸ºæ­¤æ—¶å·²ç»è·å¾—äº†é”ï¼Œå› æ­¤ rehash æ—¶ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rehash</span><span class="params">(HashEntry&lt;K,V&gt; node)</span> &#123;</span><br><span class="line">    HashEntry&lt;K,V&gt;[] oldTable = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> oldTable.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    threshold = (<span class="type">int</span>)(newCapacity * loadFactor);</span><br><span class="line">    HashEntry&lt;K,V&gt;[] newTable =</span><br><span class="line">        (HashEntry&lt;K,V&gt;[]) <span class="keyword">new</span> <span class="title class_">HashEntry</span>[newCapacity];</span><br><span class="line">    <span class="type">int</span> <span class="variable">sizeMask</span> <span class="operator">=</span> newCapacity - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; oldCapacity ; i++) &#123;</span><br><span class="line">        HashEntry&lt;K,V&gt; e = oldTable[i];</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            HashEntry&lt;K,V&gt; next = e.next;</span><br><span class="line">            <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> e.hash &amp; sizeMask;</span><br><span class="line">            <span class="keyword">if</span> (next == <span class="literal">null</span>) <span class="comment">// Single node on list</span></span><br><span class="line">                newTable[idx] = e;</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">// Reuse consecutive sequence at same slot</span></span><br><span class="line">                HashEntry&lt;K,V&gt; lastRun = e;</span><br><span class="line">                <span class="type">int</span> <span class="variable">lastIdx</span> <span class="operator">=</span> idx;</span><br><span class="line">                <span class="comment">// è¿‡ä¸€éé“¾è¡¨, å°½å¯èƒ½æŠŠ rehash å idx ä¸å˜çš„èŠ‚ç‚¹é‡ç”¨</span></span><br><span class="line">                <span class="keyword">for</span> (HashEntry&lt;K,V&gt; last = next;</span><br><span class="line">                     last != <span class="literal">null</span>;</span><br><span class="line">                     last = last.next) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> last.hash &amp; sizeMask;</span><br><span class="line">                    <span class="keyword">if</span> (k != lastIdx) &#123;</span><br><span class="line">                        lastIdx = k;</span><br><span class="line">                        lastRun = last;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                newTable[lastIdx] = lastRun;</span><br><span class="line">                <span class="comment">// å‰©ä½™èŠ‚ç‚¹éœ€è¦æ–°å»º</span></span><br><span class="line">                <span class="keyword">for</span> (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123;</span><br><span class="line">                    <span class="type">V</span> <span class="variable">v</span> <span class="operator">=</span> p.value;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> p.hash;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> h &amp; sizeMask;</span><br><span class="line">                    HashEntry&lt;K,V&gt; n = newTable[k];</span><br><span class="line">                    newTable[k] = <span class="keyword">new</span> <span class="title class_">HashEntry</span>&lt;K,V&gt;(h, p.key, v, n);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰©å®¹å®Œæˆ, æ‰åŠ å…¥æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">nodeIndex</span> <span class="operator">=</span> node.hash &amp; sizeMask; <span class="comment">// add the new node</span></span><br><span class="line">    node.setNext(newTable[nodeIndex]);</span><br><span class="line">    newTable[nodeIndex] = node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›¿æ¢ä¸ºæ–°çš„ HashEntry table</span></span><br><span class="line">    table = newTable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™„ï¼Œè°ƒè¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    ConcurrentHashMap&lt;Integer, String&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> hash(i);</span><br><span class="line">        <span class="type">int</span> <span class="variable">segmentIndex</span> <span class="operator">=</span> (hash &gt;&gt;&gt; <span class="number">28</span>) &amp; <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">if</span> (segmentIndex == <span class="number">4</span> &amp;&amp; hash % <span class="number">8</span> == <span class="number">2</span>) &#123;</span><br><span class="line">            System.out.println(i + <span class="string">&quot;\t&quot;</span> + segmentIndex + <span class="string">&quot;\t&quot;</span> + hash % <span class="number">2</span> + <span class="string">&quot;\t&quot;</span> + hash % <span class="number">4</span> +</span><br><span class="line">                               <span class="string">&quot;\t&quot;</span> + hash % <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    map.put(<span class="number">15</span>, <span class="string">&quot;value&quot;</span>); <span class="comment">// 2 æ‰©å®¹ä¸º 4 15 çš„ hash%8 ä¸å…¶ä»–ä¸åŒ</span></span><br><span class="line">    map.put(<span class="number">169</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    map.put(<span class="number">197</span>, <span class="string">&quot;value&quot;</span>); <span class="comment">// 4 æ‰©å®¹ä¸º 8</span></span><br><span class="line">    map.put(<span class="number">341</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    map.put(<span class="number">484</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    map.put(<span class="number">545</span>, <span class="string">&quot;value&quot;</span>); <span class="comment">// 8 æ‰©å®¹ä¸º 16</span></span><br><span class="line">    map.put(<span class="number">912</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    map.put(<span class="number">941</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="number">0</span> != h) &amp;&amp; (k <span class="keyword">instanceof</span> String)) &#123;</span><br><span class="line">        <span class="keyword">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br><span class="line">    &#125;</span><br><span class="line">    h ^= k.hashCode();</span><br><span class="line">    <span class="comment">// Spread bits to regularize both segment and index locations,</span></span><br><span class="line">    <span class="comment">// using variant of single-word Wang/Jenkins hash.</span></span><br><span class="line">    h += (h &lt;&lt; <span class="number">15</span>) ^ <span class="number">0xffffcd7d</span>;</span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">10</span>);</span><br><span class="line">    h += (h &lt;&lt; <span class="number">3</span>);</span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">6</span>);</span><br><span class="line">    h += (h &lt;&lt; <span class="number">2</span>) + (h &lt;&lt; <span class="number">14</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> h ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5b6f4c97-ee01-4078-ac5f-49d57c177243-4"><p>get æ—¶å¹¶æœªåŠ é”ï¼Œç”¨äº† UNSAFE æ–¹æ³•ä¿è¯äº†å¯è§æ€§ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­ï¼Œget å…ˆå‘ç”Ÿå°±ä»æ—§è¡¨å–å†…å®¹ï¼Œget åå‘ç”Ÿå°±ä»æ–° è¡¨å–å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Segment&lt;K,V&gt; s; <span class="comment">// manually integrate access methods to reduce overhead</span></span><br><span class="line">    HashEntry&lt;K,V&gt;[] tab;</span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> hash(key);</span><br><span class="line">    <span class="comment">// u ä¸º segment å¯¹è±¡åœ¨æ•°ç»„ä¸­çš„åç§»é‡</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">u</span> <span class="operator">=</span> (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE;</span><br><span class="line">    <span class="comment">// s å³ä¸º segment</span></span><br><span class="line">    <span class="keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">        (tab = s.table) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile</span><br><span class="line">             (tab, ((<span class="type">long</span>)(((tab.length - <span class="number">1</span>) &amp; h)) &lt;&lt; TSHIFT) + TBASE);</span><br><span class="line">             e != <span class="literal">null</span>; e = e.next) &#123;</span><br><span class="line">            K k;</span><br><span class="line">            <span class="keyword">if</span> ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k)))</span><br><span class="line">                <span class="keyword">return</span> e.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="5b6f4c97-ee01-4078-ac5f-49d57c177243-5"><ul><li>è®¡ç®—å…ƒç´ ä¸ªæ•°å‰ï¼Œå…ˆä¸åŠ é”è®¡ç®—ä¸¤æ¬¡ï¼Œå¦‚æœå‰åä¸¤æ¬¡ç»“æœå¦‚ä¸€æ ·ï¼Œè®¤ä¸ºä¸ªæ•°æ­£ç¡®è¿”å›</li><li>å¦‚æœä¸ä¸€æ ·ï¼Œè¿›è¡Œé‡è¯•ï¼Œé‡è¯•æ¬¡æ•°è¶…è¿‡ 3ï¼Œå°†æ‰€æœ‰ segment é”ä½ï¼Œé‡æ–°è®¡ç®—ä¸ªæ•°è¿”å›</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Try a few times to get accurate count. On failure due to</span></span><br><span class="line">    <span class="comment">// continuous async changes in table, resort to locking.</span></span><br><span class="line">    <span class="keyword">final</span> Segment&lt;K,V&gt;[] segments = <span class="built_in">this</span>.segments;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="type">boolean</span> overflow; <span class="comment">// true if size overflows 32 bits</span></span><br><span class="line">    <span class="type">long</span> sum; <span class="comment">// sum of modCounts</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">last</span> <span class="operator">=</span> <span class="number">0L</span>; <span class="comment">// previous sum</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">retries</span> <span class="operator">=</span> -<span class="number">1</span>; <span class="comment">// first iteration isn&#x27;t retry</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (retries++ == RETRIES_BEFORE_LOCK) &#123;</span><br><span class="line">                <span class="comment">// è¶…è¿‡é‡è¯•æ¬¡æ•°, éœ€è¦åˆ›å»ºæ‰€æœ‰ segment å¹¶åŠ é”</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; segments.length; ++j)</span><br><span class="line">                    ensureSegment(j).lock(); <span class="comment">// force creation</span></span><br><span class="line">            &#125;</span><br><span class="line">            sum = <span class="number">0L</span>;</span><br><span class="line">            size = <span class="number">0</span>;</span><br><span class="line">            overflow = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; segments.length; ++j) &#123;</span><br><span class="line">                Segment&lt;K,V&gt; seg = segmentAt(segments, j);</span><br><span class="line">                <span class="keyword">if</span> (seg != <span class="literal">null</span>) &#123;</span><br><span class="line">                    sum += seg.modCount;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> seg.count;</span><br><span class="line">                    <span class="keyword">if</span> (c &lt; <span class="number">0</span> || (size += c) &lt; <span class="number">0</span>)</span><br><span class="line">                        overflow = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (sum == last)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            last = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (retries &gt; RETRIES_BEFORE_LOCK) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; segments.length; ++j)</span><br><span class="line">                segmentAt(segments, j).unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> overflow ? Integer.MAX_VALUE : size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="3-BlockingQueue">3. BlockingQueue</h2><p>åŸºæœ¬çš„å…¥é˜Ÿå‡ºé˜Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedBlockingQueue</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractQueue</span>&lt;E&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">BlockingQueue</span>&lt;E&gt;, java.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        E item;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸‹åˆ—ä¸‰ç§æƒ…å†µä¹‹ä¸€</span></span><br><span class="line"><span class="comment"> * - çœŸæ­£çš„åç»§èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * - è‡ªå·±, å‘ç”Ÿåœ¨å‡ºé˜Ÿæ—¶</span></span><br><span class="line"><span class="comment"> * - null, è¡¨ç¤ºæ˜¯æ²¡æœ‰åç»§èŠ‚ç‚¹, æ˜¯æœ€åäº†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line">        Node(E x) &#123; item = x; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tabs" id="2c4556f8-464e-43e9-b401-f7a2b3f91591"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2c4556f8-464e-43e9-b401-f7a2b3f91591-1"><i class="fas fa-atom"></i>åˆå§‹åŒ–é“¾è¡¨</button></li><li class="tab"><button type="button" data-href="#2c4556f8-464e-43e9-b401-f7a2b3f91591-2"><i class="far fa-sun"></i>èŠ‚ç‚¹å…¥é˜Ÿ</button></li><li class="tab"><button type="button" data-href="#2c4556f8-464e-43e9-b401-f7a2b3f91591-3"><i class="fas fa-wind"></i>å‡ºé˜Ÿ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2c4556f8-464e-43e9-b401-f7a2b3f91591-1"><p><code>last = head = new Node(null);</code>Dummy èŠ‚ç‚¹ç”¨æ¥å ä½ï¼Œitem ä¸º null</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220316215902936.png" alt="image-20220316215902936"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2c4556f8-464e-43e9-b401-f7a2b3f91591-2"><p><code>last = last.next = node;</code></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220316215925456.png" alt="image-20220316215925456"></p><p>å†æ¥ä¸€ä¸ªèŠ‚ç‚¹å…¥é˜Ÿ<code>last = last.next = node;</code></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220316215949461.png" alt="image-20220316215949461"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2c4556f8-464e-43e9-b401-f7a2b3f91591-3"><h5 id=""></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸´æ—¶å˜é‡hç”¨æ¥æŒ‡å‘å“¨å…µ</span></span><br><span class="line">Node&lt;E&gt; h = head;</span><br><span class="line"><span class="comment">//firstç”¨æ¥æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">Node&lt;E&gt; first = h.next;</span><br><span class="line">h.next = h; <span class="comment">// help GC</span></span><br><span class="line"><span class="comment">//headèµ‹å€¼ä¸ºfirstï¼Œè¡¨ç¤ºfirstèŠ‚ç‚¹å°±æ˜¯ä¸‹ä¸€ä¸ªå“¨å…µã€‚</span></span><br><span class="line">head = first;</span><br><span class="line"><span class="type">E</span> <span class="variable">x</span> <span class="operator">=</span> first.item;</span><br><span class="line"><span class="comment">//åˆ é™¤firstèŠ‚ç‚¹ä¸­çš„æ•°æ®ï¼Œè¡¨ç¤ºçœŸæ­£æˆä¸ºäº†å“¨å…µï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å‡ºé˜Ÿã€‚</span></span><br><span class="line">first.item = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">return</span> x;</span><br></pre></td></tr></table></figure><p><code>h = head</code></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317142826808.png" alt="image-20220317142826808"></p><p><code>first = h.next</code></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317142906729.png" alt="image-20220317142906729"></p><p><code>h.next = h</code></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317142924725.png" alt="image-20220317142924725"></p><p><code>head = first</code></p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317142942832.png" alt="image-20220317142942832"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">E</span> <span class="variable">x</span> <span class="operator">=</span> first.item;</span><br><span class="line">first.item = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">return</span> x;</span><br></pre></td></tr></table></figure><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317143001497.png" alt="image-20220317143001497"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <p>åŠ é”åˆ†æ</p><p><strong>é«˜æ˜ä¹‹å¤„</strong>åœ¨äºç”¨äº†ä¸¤æŠŠé”å’Œ dummy èŠ‚ç‚¹</p><ul><li>ç”¨ä¸€æŠŠé”ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œæœ€å¤šåªå…è®¸æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼ŒäºŒé€‰ä¸€ï¼‰æ‰§è¡Œ</li><li>ç”¨ä¸¤æŠŠé”ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œå¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ï¼ˆä¸€ä¸ªç”Ÿäº§è€…ä¸ä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰æ‰§è¡Œ<ul><li>æ¶ˆè´¹è€…ä¸æ¶ˆè´¹è€…çº¿ç¨‹ä»ç„¶ä¸²è¡Œ</li><li>ç”Ÿäº§è€…ä¸ç”Ÿäº§è€…çº¿ç¨‹ä»ç„¶ä¸²è¡Œ</li></ul></li></ul><p>çº¿ç¨‹å®‰å…¨åˆ†æ</p><ul><li>å½“èŠ‚ç‚¹æ€»æ•°å¤§äº 2 æ—¶ï¼ˆåŒ…æ‹¬ dummy èŠ‚ç‚¹ï¼‰ï¼ŒputLock ä¿è¯çš„æ˜¯ last èŠ‚ç‚¹çš„çº¿ç¨‹å®‰å…¨ï¼ŒtakeLock ä¿è¯çš„æ˜¯ head èŠ‚ç‚¹çš„çº¿ç¨‹å®‰å…¨ã€‚ä¸¤æŠŠé”ä¿è¯äº†å…¥é˜Ÿå’Œå‡ºé˜Ÿæ²¡æœ‰ç«äº‰</li><li>å½“èŠ‚ç‚¹æ€»æ•°ç­‰äº 2 æ—¶ï¼ˆå³ä¸€ä¸ª dummy èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ­£å¸¸èŠ‚ç‚¹ï¼‰è¿™æ—¶å€™ï¼Œä»ç„¶æ˜¯ä¸¤æŠŠé”é”ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸ä¼šç«äº‰</li><li>å½“èŠ‚ç‚¹æ€»æ•°ç­‰äº 1 æ—¶ï¼ˆå°±ä¸€ä¸ª dummy èŠ‚ç‚¹ï¼‰è¿™æ—¶ take çº¿ç¨‹ä¼šè¢« notEmpty æ¡ä»¶é˜»å¡ï¼Œæœ‰ç«äº‰ï¼Œä¼šé˜»å¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨äº put(é˜»å¡) offer(éé˜»å¡)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">putLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="comment">// ç”¨æˆ· take(é˜»å¡) poll(éé˜»å¡)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">takeLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br></pre></td></tr></table></figure><div class="tabs" id="086864a5-94c2-483a-809a-97b3071fab65"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#086864a5-94c2-483a-809a-97b3071fab65-1"><i class="fas fa-award"></i>put æ“ä½œ</button></li><li class="tab"><button type="button" data-href="#086864a5-94c2-483a-809a-97b3071fab65-2"><i class="fas fa-baseball-ball"></i>take æ“ä½œ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="086864a5-94c2-483a-809a-97b3071fab65-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">//LinkedBlockingQueueä¸æ”¯æŒç©ºå…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> (e == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;E&gt;(e);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">putLock</span> <span class="operator">=</span> <span class="built_in">this</span>.putLock;</span><br><span class="line">    <span class="comment">// count ç”¨æ¥ç»´æŠ¤å…ƒç´ è®¡æ•°</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    putLock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ»¡äº†ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">while</span> (count.get() == capacity) &#123;</span><br><span class="line">            <span class="comment">// å€’è¿‡æ¥è¯»å°±å¥½: ç­‰å¾… notFull</span></span><br><span class="line">            notFull.await();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ‰ç©ºä½, å…¥é˜Ÿä¸”è®¡æ•°åŠ ä¸€</span></span><br><span class="line">        enqueue(node);</span><br><span class="line">        c = count.getAndIncrement(); </span><br><span class="line">        <span class="comment">// é™¤äº†è‡ªå·± put ä»¥å¤–, é˜Ÿåˆ—è¿˜æœ‰ç©ºä½, ç”±è‡ªå·±å«é†’å…¶ä»– put çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (c + <span class="number">1</span> &lt; capacity)</span><br><span class="line">            notFull.signal();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        putLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœé˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªå…ƒç´ , å«é†’ take çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// è¿™é‡Œè°ƒç”¨çš„æ˜¯ notEmpty.signal() è€Œä¸æ˜¯ notEmpty.signalAll() æ˜¯ä¸ºäº†å‡å°‘ç«äº‰</span></span><br><span class="line">        signalNotEmpty();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="086864a5-94c2-483a-809a-97b3071fab65-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    E x;</span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">takeLock</span> <span class="operator">=</span> <span class="built_in">this</span>.takeLock;</span><br><span class="line">    takeLock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (count.get() == <span class="number">0</span>) &#123;</span><br><span class="line">            notEmpty.await();</span><br><span class="line">        &#125;</span><br><span class="line">        x = dequeue();</span><br><span class="line">        c = count.getAndDecrement();</span><br><span class="line">        <span class="keyword">if</span> (c &gt; <span class="number">1</span>)</span><br><span class="line">            notEmpty.signal();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        takeLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªç©ºä½æ—¶, å«é†’ put çº¿ç¨‹</span></span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œå‡ºé˜Ÿ, ç¬¬ä¸€ä¸ªçº¿ç¨‹æ»¡è¶³ c == capacity, ä½†åç»­çº¿ç¨‹ c &lt; capacity</span></span><br><span class="line">    <span class="keyword">if</span> (c == capacity)</span><br><span class="line">        <span class="comment">// è¿™é‡Œè°ƒç”¨çš„æ˜¯ notFull.signal() è€Œä¸æ˜¯ notFull.signalAll() æ˜¯ä¸ºäº†å‡å°‘ç«äº‰</span></span><br><span class="line">        signalNotFull()</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç”± put å”¤é†’ put æ˜¯ä¸ºäº†é¿å…ä¿¡å·ä¸è¶³</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h2 id="4-ConcurrentLinkedQueue">4. ConcurrentLinkedQueue</h2><p>ConcurrentLinkedQueue çš„è®¾è®¡ä¸ LinkedBlockingQueue éå¸¸åƒï¼Œä¹Ÿæ˜¯</p><ul><li>ä¸¤æŠŠã€é”ã€‘ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œå¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ï¼ˆä¸€ä¸ªç”Ÿäº§è€…ä¸ä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰æ‰§è¡Œ</li><li>dummy èŠ‚ç‚¹çš„å¼•å…¥è®©ä¸¤æŠŠã€é”ã€‘å°†æ¥é”ä½çš„æ˜¯ä¸åŒå¯¹è±¡ï¼Œé¿å…ç«äº‰</li><li>åªæ˜¯è¿™ã€é”ã€‘ä½¿ç”¨äº† cas æ¥å®ç°</li></ul><p>äº‹å®ä¸Šï¼ŒConcurrentLinkedQueue åº”ç”¨è¿˜æ˜¯éå¸¸å¹¿æ³›çš„</p><p>ä¾‹å¦‚ä¹‹å‰è®²çš„ Tomcat çš„ Connector ç»“æ„æ—¶ï¼ŒAcceptor ä½œä¸ºç”Ÿäº§è€…å‘ Poller æ¶ˆè´¹è€…ä¼ é€’äº‹ä»¶ä¿¡æ¯æ—¶ï¼Œæ­£æ˜¯é‡‡ç”¨äº† ConcurrentLinkedQueue å°† SocketChannel ç»™ Poller ä½¿ç”¨</p><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20230404204402766.png" alt="image-20230404204402766"></p><h2 id="5-CopyOnWriteArrayList">5. CopyOnWriteArrayList</h2><p><code>CopyOnWriteArraySet</code>æ˜¯å®ƒçš„é©¬ç”² åº•å±‚å®ç°é‡‡ç”¨äº† å†™å…¥æ—¶æ‹·è´ çš„æ€æƒ³ï¼Œå¢åˆ æ”¹æ“ä½œä¼šå°†åº•å±‚æ•°ç»„æ‹·è´ä¸€ä»½ï¼Œæ›´ æ”¹æ“ä½œåœ¨æ–°æ•°ç»„ä¸Šæ‰§è¡Œï¼Œè¿™æ—¶ä¸å½±å“å…¶å®ƒçº¿ç¨‹çš„<strong>å¹¶å‘è¯»</strong>ï¼Œ<strong>è¯»å†™åˆ†ç¦»</strong>ã€‚ ä»¥æ–°å¢ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ—§çš„æ•°ç»„</span></span><br><span class="line">        Object[] es = getArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> es.length;</span><br><span class="line">        <span class="comment">// æ‹·è´æ–°çš„æ•°ç»„ï¼ˆè¿™é‡Œæ˜¯æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œä½†ä¸å½±å“å…¶å®ƒè¯»çº¿ç¨‹ï¼‰</span></span><br><span class="line">        es = Arrays.copyOf(es, len + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// æ·»åŠ æ–°å…ƒç´ </span></span><br><span class="line">        es[len] = e;</span><br><span class="line">        <span class="comment">// æ›¿æ¢æ—§çš„æ•°ç»„</span></span><br><span class="line">        setArray(es);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„æºç ç‰ˆæœ¬æ˜¯ Java 11ï¼Œåœ¨ Java 1.8 ä¸­ä½¿ç”¨çš„æ˜¯å¯é‡å…¥é”è€Œä¸æ˜¯ synchronized</p></blockquote><p>å…¶å®ƒè¯»æ“ä½œå¹¶æœªåŠ é”ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forEach</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> E&gt; action)</span> &#123;</span><br><span class="line">    Objects.requireNonNull(action);</span><br><span class="line">    <span class="keyword">for</span> (Object x : getArray()) &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> (E) x;</span><br><span class="line">        action.accept(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€‚åˆã€è¯»å¤šå†™å°‘ã€çš„åº”ç”¨åœºæ™¯</p><h3 id="5-1-get-å¼±ä¸€è‡´æ€§">5.1 get å¼±ä¸€è‡´æ€§</h3><p><img src="https://lmy-picbed.oss-cn-hangzhou.aliyuncs.com/blog/image-20220317202641399.png" alt="image-20220317202641399"></p><table><thead><tr><th style="text-align:center">æ—¶é—´ç‚¹</th><th style="text-align:center">æ“ä½œ</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Thread-0 getArray()</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Thread-1 getArray()</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Thread-1 setArray(arrayCopy)</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">Thread-0 array[index]</td></tr></tbody></table><blockquote><p>ä¸å®¹æ˜“æµ‹è¯•ï¼Œä½†é—®é¢˜ç¡®å®å­˜åœ¨</p></blockquote><h3 id="5-2-è¿­ä»£å™¨å¼±ä¸€è‡´æ€§">5.2 è¿­ä»£å™¨å¼±ä¸€è‡´æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CopyOnWriteArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line">Iterator&lt;Integer&gt; iter = list.iterator();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    list.remove(<span class="number">0</span>);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;).start();</span><br><span class="line">sleep1s();</span><br><span class="line"><span class="comment">//æ­¤æ—¶ä¸»çº¿ç¨‹çš„iteratorä¾æ—§æŒ‡å‘æ—§çš„æ•°ç»„ã€‚</span></span><br><span class="line"><span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">    System.out.println(iter.next());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸è¦è§‰å¾—å¼±ä¸€è‡´æ€§å°±ä¸å¥½</p><ul><li>æ•°æ®åº“çš„ MVCC éƒ½æ˜¯å¼±ä¸€è‡´æ€§çš„è¡¨ç°</li><li>å¹¶å‘é«˜å’Œä¸€è‡´æ€§æ˜¯çŸ›ç›¾çš„ï¼Œéœ€è¦æƒè¡¡</li></ul></blockquote>]]></content>
    
    
    <summary type="html">çº¿ç¨‹å®‰å…¨é›†åˆç±»(ConcurrentHashMapã€BlockingQueueã€ConcurrentLinkedQueue)</summary>
    
    
    
    <category term="Java" scheme="https://wuwawawa.github.io/categories/Java/"/>
    
    
    <category term="JUC" scheme="https://wuwawawa.github.io/tags/JUC/"/>
    
  </entry>
  
</feed>
